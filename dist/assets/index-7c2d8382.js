function Cte(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in n)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();var Ch=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ks(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var WP={exports:{}},aw={},FP={exports:{}},tn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qy=Symbol.for("react.element"),pte=Symbol.for("react.portal"),mte=Symbol.for("react.fragment"),yte=Symbol.for("react.strict_mode"),vte=Symbol.for("react.profiler"),bte=Symbol.for("react.provider"),Bte=Symbol.for("react.context"),Gte=Symbol.for("react.forward_ref"),wte=Symbol.for("react.suspense"),xte=Symbol.for("react.memo"),Ste=Symbol.for("react.lazy"),nk=Symbol.iterator;function Rte(n){return n===null||typeof n!="object"?null:(n=nk&&n[nk]||n["@@iterator"],typeof n=="function"?n:null)}var _P={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},VP=Object.assign,TP={};function RC(n,e,t){this.props=n,this.context=e,this.refs=TP,this.updater=t||_P}RC.prototype.isReactComponent={};RC.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};RC.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function NP(){}NP.prototype=RC.prototype;function RF(n,e,t){this.props=n,this.context=e,this.refs=TP,this.updater=t||_P}var ZF=RF.prototype=new NP;ZF.constructor=RF;VP(ZF,RC.prototype);ZF.isPureReactComponent=!0;var ik=Array.isArray,kP=Object.prototype.hasOwnProperty,MF={current:null},LP={key:!0,ref:!0,__self:!0,__source:!0};function HP(n,e,t){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)kP.call(e,i)&&!LP.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];r.children=l}if(n&&n.defaultProps)for(i in a=n.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:qy,type:n,key:s,ref:o,props:r,_owner:MF.current}}function Zte(n,e){return{$$typeof:qy,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function EF(n){return typeof n=="object"&&n!==null&&n.$$typeof===qy}function Mte(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var rk=/\/+/g;function VS(n,e){return typeof n=="object"&&n!==null&&n.key!=null?Mte(""+n.key):e.toString(36)}function UG(n,e,t,i,r){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case qy:case pte:o=!0}}if(o)return o=n,r=r(o),n=i===""?"."+VS(o,0):i,ik(r)?(t="",n!=null&&(t=n.replace(rk,"$&/")+"/"),UG(r,e,t,"",function(c){return c})):r!=null&&(EF(r)&&(r=Zte(r,t+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(rk,"$&/")+"/")+n)),e.push(r)),1;if(o=0,i=i===""?".":i+":",ik(n))for(var a=0;a<n.length;a++){s=n[a];var l=i+VS(s,a);o+=UG(s,e,t,l,r)}else if(l=Rte(n),typeof l=="function")for(n=l.call(n),a=0;!(s=n.next()).done;)s=s.value,l=i+VS(s,a++),o+=UG(s,e,t,l,r);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Vb(n,e,t){if(n==null)return n;var i=[],r=0;return UG(n,i,"","",function(s){return e.call(t,s,r++)}),i}function Ete(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Ds={current:null},QG={transition:null},Wte={ReactCurrentDispatcher:Ds,ReactCurrentBatchConfig:QG,ReactCurrentOwner:MF};tn.Children={map:Vb,forEach:function(n,e,t){Vb(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Vb(n,function(){e++}),e},toArray:function(n){return Vb(n,function(e){return e})||[]},only:function(n){if(!EF(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};tn.Component=RC;tn.Fragment=mte;tn.Profiler=vte;tn.PureComponent=RF;tn.StrictMode=yte;tn.Suspense=wte;tn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Wte;tn.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var i=VP({},n.props),r=n.key,s=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=MF.current),e.key!==void 0&&(r=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)kP.call(e,l)&&!LP.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:qy,type:n.type,key:r,ref:s,props:i,_owner:o}};tn.createContext=function(n){return n={$$typeof:Bte,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:bte,_context:n},n.Consumer=n};tn.createElement=HP;tn.createFactory=function(n){var e=HP.bind(null,n);return e.type=n,e};tn.createRef=function(){return{current:null}};tn.forwardRef=function(n){return{$$typeof:Gte,render:n}};tn.isValidElement=EF;tn.lazy=function(n){return{$$typeof:Ste,_payload:{_status:-1,_result:n},_init:Ete}};tn.memo=function(n,e){return{$$typeof:xte,type:n,compare:e===void 0?null:e}};tn.startTransition=function(n){var e=QG.transition;QG.transition={};try{n()}finally{QG.transition=e}};tn.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};tn.useCallback=function(n,e){return Ds.current.useCallback(n,e)};tn.useContext=function(n){return Ds.current.useContext(n)};tn.useDebugValue=function(){};tn.useDeferredValue=function(n){return Ds.current.useDeferredValue(n)};tn.useEffect=function(n,e){return Ds.current.useEffect(n,e)};tn.useId=function(){return Ds.current.useId()};tn.useImperativeHandle=function(n,e,t){return Ds.current.useImperativeHandle(n,e,t)};tn.useInsertionEffect=function(n,e){return Ds.current.useInsertionEffect(n,e)};tn.useLayoutEffect=function(n,e){return Ds.current.useLayoutEffect(n,e)};tn.useMemo=function(n,e){return Ds.current.useMemo(n,e)};tn.useReducer=function(n,e,t){return Ds.current.useReducer(n,e,t)};tn.useRef=function(n){return Ds.current.useRef(n)};tn.useState=function(n){return Ds.current.useState(n)};tn.useSyncExternalStore=function(n,e,t){return Ds.current.useSyncExternalStore(n,e,t)};tn.useTransition=function(){return Ds.current.useTransition()};tn.version="18.2.0";FP.exports=tn;var M=FP.exports;const L=Ks(M),UM=Cte({__proto__:null,default:L},[M]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fte=M,_te=Symbol.for("react.element"),Vte=Symbol.for("react.fragment"),Tte=Object.prototype.hasOwnProperty,Nte=Fte.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,kte={key:!0,ref:!0,__self:!0,__source:!0};function zP(n,e,t){var i,r={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)Tte.call(e,i)&&!kte.hasOwnProperty(i)&&(r[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:_te,type:n,key:s,ref:o,props:r,_owner:Nte.current}}aw.Fragment=Vte;aw.jsx=zP;aw.jsxs=zP;WP.exports=aw;var WF=WP.exports;const O0=WF.Fragment,We=WF.jsx,cn=WF.jsxs;var QM={},XP={exports:{}},sa={},YP={exports:{}},KP={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(H,Y){var K=H.length;H.push(Y);e:for(;0<K;){var Q=K-1>>>1,P=H[Q];if(0<r(P,Y))H[Q]=Y,H[K]=P,K=Q;else break e}}function t(H){return H.length===0?null:H[0]}function i(H){if(H.length===0)return null;var Y=H[0],K=H.pop();if(K!==Y){H[0]=K;e:for(var Q=0,P=H.length,ne=P>>>1;Q<ne;){var oe=2*(Q+1)-1,$=H[oe],de=oe+1,ge=H[de];if(0>r($,K))de<P&&0>r(ge,$)?(H[Q]=ge,H[de]=K,Q=de):(H[Q]=$,H[oe]=K,Q=oe);else if(de<P&&0>r(ge,K))H[Q]=ge,H[de]=K,Q=de;else break e}}return Y}function r(H,Y){var K=H.sortIndex-Y.sortIndex;return K!==0?K:H.id-Y.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],c=[],g=1,u=null,d=3,h=!1,f=!1,I=!1,A=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(H){for(var Y=t(c);Y!==null;){if(Y.callback===null)i(c);else if(Y.startTime<=H)i(c),Y.sortIndex=Y.expirationTime,e(l,Y);else break;Y=t(c)}}function b(H){if(I=!1,v(H),!f)if(t(l)!==null)f=!0,U(w);else{var Y=t(c);Y!==null&&J(b,Y.startTime-H)}}function w(H,Y){f=!1,I&&(I=!1,p(B),B=-1),h=!0;var K=d;try{for(v(Y),u=t(l);u!==null&&(!(u.expirationTime>Y)||H&&!W());){var Q=u.callback;if(typeof Q=="function"){u.callback=null,d=u.priorityLevel;var P=Q(u.expirationTime<=Y);Y=n.unstable_now(),typeof P=="function"?u.callback=P:u===t(l)&&i(l),v(Y)}else i(l);u=t(l)}if(u!==null)var ne=!0;else{var oe=t(c);oe!==null&&J(b,oe.startTime-Y),ne=!1}return ne}finally{u=null,d=K,h=!1}}var G=!1,x=null,B=-1,R=5,Z=-1;function W(){return!(n.unstable_now()-Z<R)}function F(){if(x!==null){var H=n.unstable_now();Z=H;var Y=!0;try{Y=x(!0,H)}finally{Y?T():(G=!1,x=null)}}else G=!1}var T;if(typeof y=="function")T=function(){y(F)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,z=V.port2;V.port1.onmessage=F,T=function(){z.postMessage(null)}}else T=function(){A(F,0)};function U(H){x=H,G||(G=!0,T())}function J(H,Y){B=A(function(){H(n.unstable_now())},Y)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(H){H.callback=null},n.unstable_continueExecution=function(){f||h||(f=!0,U(w))},n.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<H?Math.floor(1e3/H):5},n.unstable_getCurrentPriorityLevel=function(){return d},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(H){switch(d){case 1:case 2:case 3:var Y=3;break;default:Y=d}var K=d;d=Y;try{return H()}finally{d=K}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(H,Y){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var K=d;d=H;try{return Y()}finally{d=K}},n.unstable_scheduleCallback=function(H,Y,K){var Q=n.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?Q+K:Q):K=Q,H){case 1:var P=-1;break;case 2:P=250;break;case 5:P=1073741823;break;case 4:P=1e4;break;default:P=5e3}return P=K+P,H={id:g++,callback:Y,priorityLevel:H,startTime:K,expirationTime:P,sortIndex:-1},K>Q?(H.sortIndex=K,e(c,H),t(l)===null&&H===t(c)&&(I?(p(B),B=-1):I=!0,J(b,K-Q))):(H.sortIndex=P,e(l,H),f||h||(f=!0,U(w))),H},n.unstable_shouldYield=W,n.unstable_wrapCallback=function(H){var Y=d;return function(){var K=d;d=Y;try{return H.apply(this,arguments)}finally{d=K}}}})(KP);YP.exports=KP;var Lte=YP.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DP=M,ea=Lte;function Oe(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var PP=new Set,J0={};function Bf(n,e){JA(n,e),JA(n+"Capture",e)}function JA(n,e){for(J0[n]=e,n=0;n<e.length;n++)PP.add(e[n])}var Ng=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),OM=Object.prototype.hasOwnProperty,Hte=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,sk={},ok={};function zte(n){return OM.call(ok,n)?!0:OM.call(sk,n)?!1:Hte.test(n)?ok[n]=!0:(sk[n]=!0,!1)}function Xte(n,e,t,i){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Yte(n,e,t,i){if(e===null||typeof e>"u"||Xte(n,e,t,i))return!0;if(i)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ps(n,e,t,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Er={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Er[n]=new Ps(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Er[e]=new Ps(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Er[n]=new Ps(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Er[n]=new Ps(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Er[n]=new Ps(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Er[n]=new Ps(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Er[n]=new Ps(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Er[n]=new Ps(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Er[n]=new Ps(n,5,!1,n.toLowerCase(),null,!1,!1)});var FF=/[\-:]([a-z])/g;function _F(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(FF,_F);Er[e]=new Ps(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(FF,_F);Er[e]=new Ps(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(FF,_F);Er[e]=new Ps(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Er[n]=new Ps(n,1,!1,n.toLowerCase(),null,!1,!1)});Er.xlinkHref=new Ps("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Er[n]=new Ps(n,1,!1,n.toLowerCase(),null,!0,!0)});function VF(n,e,t,i){var r=Er.hasOwnProperty(e)?Er[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Yte(e,t,r,i)&&(t=null),i||r===null?zte(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):r.mustUseProperty?n[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,i=r.attributeNamespace,t===null?n.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,i?n.setAttributeNS(i,e,t):n.setAttribute(e,t))))}var jg=DP.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Tb=Symbol.for("react.element"),tA=Symbol.for("react.portal"),nA=Symbol.for("react.fragment"),TF=Symbol.for("react.strict_mode"),JM=Symbol.for("react.profiler"),UP=Symbol.for("react.provider"),QP=Symbol.for("react.context"),NF=Symbol.for("react.forward_ref"),jM=Symbol.for("react.suspense"),qM=Symbol.for("react.suspense_list"),kF=Symbol.for("react.memo"),Vu=Symbol.for("react.lazy"),OP=Symbol.for("react.offscreen"),ak=Symbol.iterator;function kp(n){return n===null||typeof n!="object"?null:(n=ak&&n[ak]||n["@@iterator"],typeof n=="function"?n:null)}var Ci=Object.assign,TS;function Jm(n){if(TS===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);TS=e&&e[1]||""}return`
`+TS+n}var NS=!1;function kS(n,e){if(!n||NS)return"";NS=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){i=c}n.call(e.prototype)}else{try{throw Error()}catch(c){i=c}n()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var l=`
`+r[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{NS=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Jm(n):""}function Kte(n){switch(n.tag){case 5:return Jm(n.type);case 16:return Jm("Lazy");case 13:return Jm("Suspense");case 19:return Jm("SuspenseList");case 0:case 2:case 15:return n=kS(n.type,!1),n;case 11:return n=kS(n.type.render,!1),n;case 1:return n=kS(n.type,!0),n;default:return""}}function $M(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case nA:return"Fragment";case tA:return"Portal";case JM:return"Profiler";case TF:return"StrictMode";case jM:return"Suspense";case qM:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case QP:return(n.displayName||"Context")+".Consumer";case UP:return(n._context.displayName||"Context")+".Provider";case NF:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case kF:return e=n.displayName||null,e!==null?e:$M(n.type)||"Memo";case Vu:e=n._payload,n=n._init;try{return $M(n(e))}catch{}}return null}function Dte(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return $M(e);case 8:return e===TF?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function hd(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function JP(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Pte(n){var e=JP(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),i=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Nb(n){n._valueTracker||(n._valueTracker=Pte(n))}function jP(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return n&&(i=JP(n)?n.checked?"true":"false":n.value),n=i,n!==t?(e.setValue(n),!0):!1}function H1(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function eE(n,e){var t=e.checked;return Ci({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function lk(n,e){var t=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;t=hd(e.value!=null?e.value:t),n._wrapperState={initialChecked:i,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function qP(n,e){e=e.checked,e!=null&&VF(n,"checked",e,!1)}function tE(n,e){qP(n,e);var t=hd(e.value),i=e.type;if(t!=null)i==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(i==="submit"||i==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?nE(n,e.type,t):e.hasOwnProperty("defaultValue")&&nE(n,e.type,hd(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function ck(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function nE(n,e,t){(e!=="number"||H1(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var jm=Array.isArray;function ZA(n,e,t,i){if(n=n.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<n.length;t++)r=e.hasOwnProperty("$"+n[t].value),n[t].selected!==r&&(n[t].selected=r),r&&i&&(n[t].defaultSelected=!0)}else{for(t=""+hd(t),e=null,r=0;r<n.length;r++){if(n[r].value===t){n[r].selected=!0,i&&(n[r].defaultSelected=!0);return}e!==null||n[r].disabled||(e=n[r])}e!==null&&(e.selected=!0)}}function iE(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Oe(91));return Ci({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function gk(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Oe(92));if(jm(t)){if(1<t.length)throw Error(Oe(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:hd(t)}}function $P(n,e){var t=hd(e.value),i=hd(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),i!=null&&(n.defaultValue=""+i)}function uk(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function eU(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function rE(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?eU(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var kb,tU=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,i,r){MSApp.execUnsafeLocalFunction(function(){return n(e,t,i,r)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(kb=kb||document.createElement("div"),kb.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=kb.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function j0(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var I0={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ute=["Webkit","ms","Moz","O"];Object.keys(I0).forEach(function(n){Ute.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),I0[e]=I0[n]})});function nU(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||I0.hasOwnProperty(n)&&I0[n]?(""+e).trim():e+"px"}function iU(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var i=t.indexOf("--")===0,r=nU(t,e[t],i);t==="float"&&(t="cssFloat"),i?n.setProperty(t,r):n[t]=r}}var Qte=Ci({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function sE(n,e){if(e){if(Qte[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Oe(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Oe(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Oe(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Oe(62))}}function oE(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var aE=null;function LF(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var lE=null,MA=null,EA=null;function dk(n){if(n=tv(n)){if(typeof lE!="function")throw Error(Oe(280));var e=n.stateNode;e&&(e=dw(e),lE(n.stateNode,n.type,e))}}function rU(n){MA?EA?EA.push(n):EA=[n]:MA=n}function sU(){if(MA){var n=MA,e=EA;if(EA=MA=null,dk(n),e)for(n=0;n<e.length;n++)dk(e[n])}}function oU(n,e){return n(e)}function aU(){}var LS=!1;function lU(n,e,t){if(LS)return n(e,t);LS=!0;try{return oU(n,e,t)}finally{LS=!1,(MA!==null||EA!==null)&&(aU(),sU())}}function q0(n,e){var t=n.stateNode;if(t===null)return null;var i=dw(t);if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(n=n.type,i=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!i;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Oe(231,e,typeof t));return t}var cE=!1;if(Ng)try{var Lp={};Object.defineProperty(Lp,"passive",{get:function(){cE=!0}}),window.addEventListener("test",Lp,Lp),window.removeEventListener("test",Lp,Lp)}catch{cE=!1}function Ote(n,e,t,i,r,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(g){this.onError(g)}}var A0=!1,z1=null,X1=!1,gE=null,Jte={onError:function(n){A0=!0,z1=n}};function jte(n,e,t,i,r,s,o,a,l){A0=!1,z1=null,Ote.apply(Jte,arguments)}function qte(n,e,t,i,r,s,o,a,l){if(jte.apply(this,arguments),A0){if(A0){var c=z1;A0=!1,z1=null}else throw Error(Oe(198));X1||(X1=!0,gE=c)}}function Gf(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function cU(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function hk(n){if(Gf(n)!==n)throw Error(Oe(188))}function $te(n){var e=n.alternate;if(!e){if(e=Gf(n),e===null)throw Error(Oe(188));return e!==n?null:n}for(var t=n,i=e;;){var r=t.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){t=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===t)return hk(r),n;if(s===i)return hk(r),e;s=s.sibling}throw Error(Oe(188))}if(t.return!==i.return)t=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===t){o=!0,t=r,i=s;break}if(a===i){o=!0,i=r,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,i=r;break}if(a===i){o=!0,i=s,t=r;break}a=a.sibling}if(!o)throw Error(Oe(189))}}if(t.alternate!==i)throw Error(Oe(190))}if(t.tag!==3)throw Error(Oe(188));return t.stateNode.current===t?n:e}function gU(n){return n=$te(n),n!==null?uU(n):null}function uU(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=uU(n);if(e!==null)return e;n=n.sibling}return null}var dU=ea.unstable_scheduleCallback,fk=ea.unstable_cancelCallback,ene=ea.unstable_shouldYield,tne=ea.unstable_requestPaint,Ei=ea.unstable_now,nne=ea.unstable_getCurrentPriorityLevel,HF=ea.unstable_ImmediatePriority,hU=ea.unstable_UserBlockingPriority,Y1=ea.unstable_NormalPriority,ine=ea.unstable_LowPriority,fU=ea.unstable_IdlePriority,lw=null,Ac=null;function rne(n){if(Ac&&typeof Ac.onCommitFiberRoot=="function")try{Ac.onCommitFiberRoot(lw,n,void 0,(n.current.flags&128)===128)}catch{}}var bl=Math.clz32?Math.clz32:ane,sne=Math.log,one=Math.LN2;function ane(n){return n>>>=0,n===0?32:31-(sne(n)/one|0)|0}var Lb=64,Hb=4194304;function qm(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function K1(n,e){var t=n.pendingLanes;if(t===0)return 0;var i=0,r=n.suspendedLanes,s=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~r;a!==0?i=qm(a):(s&=o,s!==0&&(i=qm(s)))}else o=t&~r,o!==0?i=qm(o):s!==0&&(i=qm(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=i;0<e;)t=31-bl(e),r=1<<t,i|=n[t],e&=~r;return i}function lne(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function cne(n,e){for(var t=n.suspendedLanes,i=n.pingedLanes,r=n.expirationTimes,s=n.pendingLanes;0<s;){var o=31-bl(s),a=1<<o,l=r[o];l===-1?(!(a&t)||a&i)&&(r[o]=lne(a,e)):l<=e&&(n.expiredLanes|=a),s&=~a}}function uE(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function IU(){var n=Lb;return Lb<<=1,!(Lb&4194240)&&(Lb=64),n}function HS(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function $y(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-bl(e),n[e]=t}function gne(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var i=n.eventTimes;for(n=n.expirationTimes;0<t;){var r=31-bl(t),s=1<<r;e[r]=0,i[r]=-1,n[r]=-1,t&=~s}}function zF(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var i=31-bl(t),r=1<<i;r&e|n[i]&e&&(n[i]|=e),t&=~r}}var Zn=0;function AU(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var CU,XF,pU,mU,yU,dE=!1,zb=[],ju=null,qu=null,$u=null,$0=new Map,ey=new Map,Nu=[],une="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ik(n,e){switch(n){case"focusin":case"focusout":ju=null;break;case"dragenter":case"dragleave":qu=null;break;case"mouseover":case"mouseout":$u=null;break;case"pointerover":case"pointerout":$0.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ey.delete(e.pointerId)}}function Hp(n,e,t,i,r,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=tv(e),e!==null&&XF(e)),n):(n.eventSystemFlags|=i,e=n.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),n)}function dne(n,e,t,i,r){switch(e){case"focusin":return ju=Hp(ju,n,e,t,i,r),!0;case"dragenter":return qu=Hp(qu,n,e,t,i,r),!0;case"mouseover":return $u=Hp($u,n,e,t,i,r),!0;case"pointerover":var s=r.pointerId;return $0.set(s,Hp($0.get(s)||null,n,e,t,i,r)),!0;case"gotpointercapture":return s=r.pointerId,ey.set(s,Hp(ey.get(s)||null,n,e,t,i,r)),!0}return!1}function vU(n){var e=Wh(n.target);if(e!==null){var t=Gf(e);if(t!==null){if(e=t.tag,e===13){if(e=cU(t),e!==null){n.blockedOn=e,yU(n.priority,function(){pU(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function OG(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=hE(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var i=new t.constructor(t.type,t);aE=i,t.target.dispatchEvent(i),aE=null}else return e=tv(t),e!==null&&XF(e),n.blockedOn=t,!1;e.shift()}return!0}function Ak(n,e,t){OG(n)&&t.delete(e)}function hne(){dE=!1,ju!==null&&OG(ju)&&(ju=null),qu!==null&&OG(qu)&&(qu=null),$u!==null&&OG($u)&&($u=null),$0.forEach(Ak),ey.forEach(Ak)}function zp(n,e){n.blockedOn===e&&(n.blockedOn=null,dE||(dE=!0,ea.unstable_scheduleCallback(ea.unstable_NormalPriority,hne)))}function ty(n){function e(r){return zp(r,n)}if(0<zb.length){zp(zb[0],n);for(var t=1;t<zb.length;t++){var i=zb[t];i.blockedOn===n&&(i.blockedOn=null)}}for(ju!==null&&zp(ju,n),qu!==null&&zp(qu,n),$u!==null&&zp($u,n),$0.forEach(e),ey.forEach(e),t=0;t<Nu.length;t++)i=Nu[t],i.blockedOn===n&&(i.blockedOn=null);for(;0<Nu.length&&(t=Nu[0],t.blockedOn===null);)vU(t),t.blockedOn===null&&Nu.shift()}var WA=jg.ReactCurrentBatchConfig,D1=!0;function fne(n,e,t,i){var r=Zn,s=WA.transition;WA.transition=null;try{Zn=1,YF(n,e,t,i)}finally{Zn=r,WA.transition=s}}function Ine(n,e,t,i){var r=Zn,s=WA.transition;WA.transition=null;try{Zn=4,YF(n,e,t,i)}finally{Zn=r,WA.transition=s}}function YF(n,e,t,i){if(D1){var r=hE(n,e,t,i);if(r===null)JS(n,e,i,P1,t),Ik(n,i);else if(dne(r,n,e,t,i))i.stopPropagation();else if(Ik(n,i),e&4&&-1<une.indexOf(n)){for(;r!==null;){var s=tv(r);if(s!==null&&CU(s),s=hE(n,e,t,i),s===null&&JS(n,e,i,P1,t),s===r)break;r=s}r!==null&&i.stopPropagation()}else JS(n,e,i,null,t)}}var P1=null;function hE(n,e,t,i){if(P1=null,n=LF(i),n=Wh(n),n!==null)if(e=Gf(n),e===null)n=null;else if(t=e.tag,t===13){if(n=cU(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return P1=n,null}function bU(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(nne()){case HF:return 1;case hU:return 4;case Y1:case ine:return 16;case fU:return 536870912;default:return 16}default:return 16}}var Xu=null,KF=null,JG=null;function BU(){if(JG)return JG;var n,e=KF,t=e.length,i,r="value"in Xu?Xu.value:Xu.textContent,s=r.length;for(n=0;n<t&&e[n]===r[n];n++);var o=t-n;for(i=1;i<=o&&e[t-i]===r[s-i];i++);return JG=r.slice(n,1<i?1-i:void 0)}function jG(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Xb(){return!0}function Ck(){return!1}function oa(n){function e(t,i,r,s,o){this._reactName=t,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Xb:Ck,this.isPropagationStopped=Ck,this}return Ci(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Xb)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Xb)},persist:function(){},isPersistent:Xb}),e}var ZC={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},DF=oa(ZC),ev=Ci({},ZC,{view:0,detail:0}),Ane=oa(ev),zS,XS,Xp,cw=Ci({},ev,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:PF,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Xp&&(Xp&&n.type==="mousemove"?(zS=n.screenX-Xp.screenX,XS=n.screenY-Xp.screenY):XS=zS=0,Xp=n),zS)},movementY:function(n){return"movementY"in n?n.movementY:XS}}),pk=oa(cw),Cne=Ci({},cw,{dataTransfer:0}),pne=oa(Cne),mne=Ci({},ev,{relatedTarget:0}),YS=oa(mne),yne=Ci({},ZC,{animationName:0,elapsedTime:0,pseudoElement:0}),vne=oa(yne),bne=Ci({},ZC,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Bne=oa(bne),Gne=Ci({},ZC,{data:0}),mk=oa(Gne),wne={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xne={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sne={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Rne(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=Sne[n])?!!e[n]:!1}function PF(){return Rne}var Zne=Ci({},ev,{key:function(n){if(n.key){var e=wne[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=jG(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?xne[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:PF,charCode:function(n){return n.type==="keypress"?jG(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?jG(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Mne=oa(Zne),Ene=Ci({},cw,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),yk=oa(Ene),Wne=Ci({},ev,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:PF}),Fne=oa(Wne),_ne=Ci({},ZC,{propertyName:0,elapsedTime:0,pseudoElement:0}),Vne=oa(_ne),Tne=Ci({},cw,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Nne=oa(Tne),kne=[9,13,27,32],UF=Ng&&"CompositionEvent"in window,C0=null;Ng&&"documentMode"in document&&(C0=document.documentMode);var Lne=Ng&&"TextEvent"in window&&!C0,GU=Ng&&(!UF||C0&&8<C0&&11>=C0),vk=String.fromCharCode(32),bk=!1;function wU(n,e){switch(n){case"keyup":return kne.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xU(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var iA=!1;function Hne(n,e){switch(n){case"compositionend":return xU(e);case"keypress":return e.which!==32?null:(bk=!0,vk);case"textInput":return n=e.data,n===vk&&bk?null:n;default:return null}}function zne(n,e){if(iA)return n==="compositionend"||!UF&&wU(n,e)?(n=BU(),JG=KF=Xu=null,iA=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return GU&&e.locale!=="ko"?null:e.data;default:return null}}var Xne={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Bk(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!Xne[n.type]:e==="textarea"}function SU(n,e,t,i){rU(i),e=U1(e,"onChange"),0<e.length&&(t=new DF("onChange","change",null,t,i),n.push({event:t,listeners:e}))}var p0=null,ny=null;function Yne(n){kU(n,0)}function gw(n){var e=oA(n);if(jP(e))return n}function Kne(n,e){if(n==="change")return e}var RU=!1;if(Ng){var KS;if(Ng){var DS="oninput"in document;if(!DS){var Gk=document.createElement("div");Gk.setAttribute("oninput","return;"),DS=typeof Gk.oninput=="function"}KS=DS}else KS=!1;RU=KS&&(!document.documentMode||9<document.documentMode)}function wk(){p0&&(p0.detachEvent("onpropertychange",ZU),ny=p0=null)}function ZU(n){if(n.propertyName==="value"&&gw(ny)){var e=[];SU(e,ny,n,LF(n)),lU(Yne,e)}}function Dne(n,e,t){n==="focusin"?(wk(),p0=e,ny=t,p0.attachEvent("onpropertychange",ZU)):n==="focusout"&&wk()}function Pne(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return gw(ny)}function Une(n,e){if(n==="click")return gw(e)}function Qne(n,e){if(n==="input"||n==="change")return gw(e)}function One(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var xl=typeof Object.is=="function"?Object.is:One;function iy(n,e){if(xl(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var r=t[i];if(!OM.call(e,r)||!xl(n[r],e[r]))return!1}return!0}function xk(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Sk(n,e){var t=xk(n);n=0;for(var i;t;){if(t.nodeType===3){if(i=n+t.textContent.length,n<=e&&i>=e)return{node:t,offset:e-n};n=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=xk(t)}}function MU(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?MU(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function EU(){for(var n=window,e=H1();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=H1(n.document)}return e}function QF(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function Jne(n){var e=EU(),t=n.focusedElem,i=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&MU(t.ownerDocument.documentElement,t)){if(i!==null&&QF(t)){if(e=i.start,n=i.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var r=t.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!n.extend&&s>i&&(r=i,i=s,s=r),r=Sk(t,s);var o=Sk(t,i);r&&o&&(n.rangeCount!==1||n.anchorNode!==r.node||n.anchorOffset!==r.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),n.removeAllRanges(),s>i?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var jne=Ng&&"documentMode"in document&&11>=document.documentMode,rA=null,fE=null,m0=null,IE=!1;function Rk(n,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;IE||rA==null||rA!==H1(i)||(i=rA,"selectionStart"in i&&QF(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),m0&&iy(m0,i)||(m0=i,i=U1(fE,"onSelect"),0<i.length&&(e=new DF("onSelect","select",null,e,t),n.push({event:e,listeners:i}),e.target=rA)))}function Yb(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var sA={animationend:Yb("Animation","AnimationEnd"),animationiteration:Yb("Animation","AnimationIteration"),animationstart:Yb("Animation","AnimationStart"),transitionend:Yb("Transition","TransitionEnd")},PS={},WU={};Ng&&(WU=document.createElement("div").style,"AnimationEvent"in window||(delete sA.animationend.animation,delete sA.animationiteration.animation,delete sA.animationstart.animation),"TransitionEvent"in window||delete sA.transitionend.transition);function uw(n){if(PS[n])return PS[n];if(!sA[n])return n;var e=sA[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in WU)return PS[n]=e[t];return n}var FU=uw("animationend"),_U=uw("animationiteration"),VU=uw("animationstart"),TU=uw("transitionend"),NU=new Map,Zk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function wd(n,e){NU.set(n,e),Bf(e,[n])}for(var US=0;US<Zk.length;US++){var QS=Zk[US],qne=QS.toLowerCase(),$ne=QS[0].toUpperCase()+QS.slice(1);wd(qne,"on"+$ne)}wd(FU,"onAnimationEnd");wd(_U,"onAnimationIteration");wd(VU,"onAnimationStart");wd("dblclick","onDoubleClick");wd("focusin","onFocus");wd("focusout","onBlur");wd(TU,"onTransitionEnd");JA("onMouseEnter",["mouseout","mouseover"]);JA("onMouseLeave",["mouseout","mouseover"]);JA("onPointerEnter",["pointerout","pointerover"]);JA("onPointerLeave",["pointerout","pointerover"]);Bf("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Bf("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Bf("onBeforeInput",["compositionend","keypress","textInput","paste"]);Bf("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Bf("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Bf("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var $m="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),eie=new Set("cancel close invalid load scroll toggle".split(" ").concat($m));function Mk(n,e,t){var i=n.type||"unknown-event";n.currentTarget=t,qte(i,e,void 0,n),n.currentTarget=null}function kU(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var i=n[t],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;Mk(r,a,c),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;Mk(r,a,c),s=l}}}if(X1)throw n=gE,X1=!1,gE=null,n}function jn(n,e){var t=e[yE];t===void 0&&(t=e[yE]=new Set);var i=n+"__bubble";t.has(i)||(LU(e,n,2,!1),t.add(i))}function OS(n,e,t){var i=0;e&&(i|=4),LU(t,n,i,e)}var Kb="_reactListening"+Math.random().toString(36).slice(2);function ry(n){if(!n[Kb]){n[Kb]=!0,PP.forEach(function(t){t!=="selectionchange"&&(eie.has(t)||OS(t,!1,n),OS(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Kb]||(e[Kb]=!0,OS("selectionchange",!1,e))}}function LU(n,e,t,i){switch(bU(e)){case 1:var r=fne;break;case 4:r=Ine;break;default:r=YF}t=r.bind(null,e,t,n),r=void 0,!cE||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?n.addEventListener(e,t,{capture:!0,passive:r}):n.addEventListener(e,t,!0):r!==void 0?n.addEventListener(e,t,{passive:r}):n.addEventListener(e,t,!1)}function JS(n,e,t,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=Wh(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}lU(function(){var c=s,g=LF(t),u=[];e:{var d=NU.get(n);if(d!==void 0){var h=DF,f=n;switch(n){case"keypress":if(jG(t)===0)break e;case"keydown":case"keyup":h=Mne;break;case"focusin":f="focus",h=YS;break;case"focusout":f="blur",h=YS;break;case"beforeblur":case"afterblur":h=YS;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=pk;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=pne;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=Fne;break;case FU:case _U:case VU:h=vne;break;case TU:h=Vne;break;case"scroll":h=Ane;break;case"wheel":h=Nne;break;case"copy":case"cut":case"paste":h=Bne;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=yk}var I=(e&4)!==0,A=!I&&n==="scroll",p=I?d!==null?d+"Capture":null:d;I=[];for(var y=c,v;y!==null;){v=y;var b=v.stateNode;if(v.tag===5&&b!==null&&(v=b,p!==null&&(b=q0(y,p),b!=null&&I.push(sy(y,b,v)))),A)break;y=y.return}0<I.length&&(d=new h(d,f,null,t,g),u.push({event:d,listeners:I}))}}if(!(e&7)){e:{if(d=n==="mouseover"||n==="pointerover",h=n==="mouseout"||n==="pointerout",d&&t!==aE&&(f=t.relatedTarget||t.fromElement)&&(Wh(f)||f[kg]))break e;if((h||d)&&(d=g.window===g?g:(d=g.ownerDocument)?d.defaultView||d.parentWindow:window,h?(f=t.relatedTarget||t.toElement,h=c,f=f?Wh(f):null,f!==null&&(A=Gf(f),f!==A||f.tag!==5&&f.tag!==6)&&(f=null)):(h=null,f=c),h!==f)){if(I=pk,b="onMouseLeave",p="onMouseEnter",y="mouse",(n==="pointerout"||n==="pointerover")&&(I=yk,b="onPointerLeave",p="onPointerEnter",y="pointer"),A=h==null?d:oA(h),v=f==null?d:oA(f),d=new I(b,y+"leave",h,t,g),d.target=A,d.relatedTarget=v,b=null,Wh(g)===c&&(I=new I(p,y+"enter",f,t,g),I.target=v,I.relatedTarget=A,b=I),A=b,h&&f)t:{for(I=h,p=f,y=0,v=I;v;v=iI(v))y++;for(v=0,b=p;b;b=iI(b))v++;for(;0<y-v;)I=iI(I),y--;for(;0<v-y;)p=iI(p),v--;for(;y--;){if(I===p||p!==null&&I===p.alternate)break t;I=iI(I),p=iI(p)}I=null}else I=null;h!==null&&Ek(u,d,h,I,!1),f!==null&&A!==null&&Ek(u,A,f,I,!0)}}e:{if(d=c?oA(c):window,h=d.nodeName&&d.nodeName.toLowerCase(),h==="select"||h==="input"&&d.type==="file")var w=Kne;else if(Bk(d))if(RU)w=Qne;else{w=Pne;var G=Dne}else(h=d.nodeName)&&h.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(w=Une);if(w&&(w=w(n,c))){SU(u,w,t,g);break e}G&&G(n,d,c),n==="focusout"&&(G=d._wrapperState)&&G.controlled&&d.type==="number"&&nE(d,"number",d.value)}switch(G=c?oA(c):window,n){case"focusin":(Bk(G)||G.contentEditable==="true")&&(rA=G,fE=c,m0=null);break;case"focusout":m0=fE=rA=null;break;case"mousedown":IE=!0;break;case"contextmenu":case"mouseup":case"dragend":IE=!1,Rk(u,t,g);break;case"selectionchange":if(jne)break;case"keydown":case"keyup":Rk(u,t,g)}var x;if(UF)e:{switch(n){case"compositionstart":var B="onCompositionStart";break e;case"compositionend":B="onCompositionEnd";break e;case"compositionupdate":B="onCompositionUpdate";break e}B=void 0}else iA?wU(n,t)&&(B="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(B="onCompositionStart");B&&(GU&&t.locale!=="ko"&&(iA||B!=="onCompositionStart"?B==="onCompositionEnd"&&iA&&(x=BU()):(Xu=g,KF="value"in Xu?Xu.value:Xu.textContent,iA=!0)),G=U1(c,B),0<G.length&&(B=new mk(B,n,null,t,g),u.push({event:B,listeners:G}),x?B.data=x:(x=xU(t),x!==null&&(B.data=x)))),(x=Lne?Hne(n,t):zne(n,t))&&(c=U1(c,"onBeforeInput"),0<c.length&&(g=new mk("onBeforeInput","beforeinput",null,t,g),u.push({event:g,listeners:c}),g.data=x))}kU(u,e)})}function sy(n,e,t){return{instance:n,listener:e,currentTarget:t}}function U1(n,e){for(var t=e+"Capture",i=[];n!==null;){var r=n,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=q0(n,t),s!=null&&i.unshift(sy(n,s,r)),s=q0(n,e),s!=null&&i.push(sy(n,s,r))),n=n.return}return i}function iI(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Ek(n,e,t,i,r){for(var s=e._reactName,o=[];t!==null&&t!==i;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,r?(l=q0(t,s),l!=null&&o.unshift(sy(t,l,a))):r||(l=q0(t,s),l!=null&&o.push(sy(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var tie=/\r\n?/g,nie=/\u0000|\uFFFD/g;function Wk(n){return(typeof n=="string"?n:""+n).replace(tie,`
`).replace(nie,"")}function Db(n,e,t){if(e=Wk(e),Wk(n)!==e&&t)throw Error(Oe(425))}function Q1(){}var AE=null,CE=null;function pE(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var mE=typeof setTimeout=="function"?setTimeout:void 0,iie=typeof clearTimeout=="function"?clearTimeout:void 0,Fk=typeof Promise=="function"?Promise:void 0,rie=typeof queueMicrotask=="function"?queueMicrotask:typeof Fk<"u"?function(n){return Fk.resolve(null).then(n).catch(sie)}:mE;function sie(n){setTimeout(function(){throw n})}function jS(n,e){var t=e,i=0;do{var r=t.nextSibling;if(n.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(i===0){n.removeChild(r),ty(e);return}i--}else t!=="$"&&t!=="$?"&&t!=="$!"||i++;t=r}while(t);ty(e)}function ed(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function _k(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var MC=Math.random().toString(36).slice(2),gc="__reactFiber$"+MC,oy="__reactProps$"+MC,kg="__reactContainer$"+MC,yE="__reactEvents$"+MC,oie="__reactListeners$"+MC,aie="__reactHandles$"+MC;function Wh(n){var e=n[gc];if(e)return e;for(var t=n.parentNode;t;){if(e=t[kg]||t[gc]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=_k(n);n!==null;){if(t=n[gc])return t;n=_k(n)}return e}n=t,t=n.parentNode}return null}function tv(n){return n=n[gc]||n[kg],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function oA(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Oe(33))}function dw(n){return n[oy]||null}var vE=[],aA=-1;function xd(n){return{current:n}}function $n(n){0>aA||(n.current=vE[aA],vE[aA]=null,aA--)}function Xn(n,e){aA++,vE[aA]=n.current,n.current=e}var fd={},us=xd(fd),Ao=xd(!1),lf=fd;function jA(n,e){var t=n.type.contextTypes;if(!t)return fd;var i=n.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in t)r[s]=e[s];return i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=r),r}function Co(n){return n=n.childContextTypes,n!=null}function O1(){$n(Ao),$n(us)}function Vk(n,e,t){if(us.current!==fd)throw Error(Oe(168));Xn(us,e),Xn(Ao,t)}function HU(n,e,t){var i=n.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return t;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(Oe(108,Dte(n)||"Unknown",r));return Ci({},t,i)}function J1(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||fd,lf=us.current,Xn(us,n),Xn(Ao,Ao.current),!0}function Tk(n,e,t){var i=n.stateNode;if(!i)throw Error(Oe(169));t?(n=HU(n,e,lf),i.__reactInternalMemoizedMergedChildContext=n,$n(Ao),$n(us),Xn(us,n)):$n(Ao),Xn(Ao,t)}var pg=null,hw=!1,qS=!1;function zU(n){pg===null?pg=[n]:pg.push(n)}function lie(n){hw=!0,zU(n)}function Sd(){if(!qS&&pg!==null){qS=!0;var n=0,e=Zn;try{var t=pg;for(Zn=1;n<t.length;n++){var i=t[n];do i=i(!0);while(i!==null)}pg=null,hw=!1}catch(r){throw pg!==null&&(pg=pg.slice(n+1)),dU(HF,Sd),r}finally{Zn=e,qS=!1}}return null}var lA=[],cA=0,j1=null,q1=0,Sa=[],Ra=0,cf=null,wg=1,xg="";function ph(n,e){lA[cA++]=q1,lA[cA++]=j1,j1=n,q1=e}function XU(n,e,t){Sa[Ra++]=wg,Sa[Ra++]=xg,Sa[Ra++]=cf,cf=n;var i=wg;n=xg;var r=32-bl(i)-1;i&=~(1<<r),t+=1;var s=32-bl(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,wg=1<<32-bl(e)+r|t<<r|i,xg=s+n}else wg=1<<s|t<<r|i,xg=n}function OF(n){n.return!==null&&(ph(n,1),XU(n,1,0))}function JF(n){for(;n===j1;)j1=lA[--cA],lA[cA]=null,q1=lA[--cA],lA[cA]=null;for(;n===cf;)cf=Sa[--Ra],Sa[Ra]=null,xg=Sa[--Ra],Sa[Ra]=null,wg=Sa[--Ra],Sa[Ra]=null}var Jo=null,Qo=null,oi=!1,Il=null;function YU(n,e){var t=Wa(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function Nk(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Jo=n,Qo=ed(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Jo=n,Qo=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=cf!==null?{id:wg,overflow:xg}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Wa(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Jo=n,Qo=null,!0):!1;default:return!1}}function bE(n){return(n.mode&1)!==0&&(n.flags&128)===0}function BE(n){if(oi){var e=Qo;if(e){var t=e;if(!Nk(n,e)){if(bE(n))throw Error(Oe(418));e=ed(t.nextSibling);var i=Jo;e&&Nk(n,e)?YU(i,t):(n.flags=n.flags&-4097|2,oi=!1,Jo=n)}}else{if(bE(n))throw Error(Oe(418));n.flags=n.flags&-4097|2,oi=!1,Jo=n}}}function kk(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Jo=n}function Pb(n){if(n!==Jo)return!1;if(!oi)return kk(n),oi=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!pE(n.type,n.memoizedProps)),e&&(e=Qo)){if(bE(n))throw KU(),Error(Oe(418));for(;e;)YU(n,e),e=ed(e.nextSibling)}if(kk(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Oe(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Qo=ed(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Qo=null}}else Qo=Jo?ed(n.stateNode.nextSibling):null;return!0}function KU(){for(var n=Qo;n;)n=ed(n.nextSibling)}function qA(){Qo=Jo=null,oi=!1}function jF(n){Il===null?Il=[n]:Il.push(n)}var cie=jg.ReactCurrentBatchConfig;function dl(n,e){if(n&&n.defaultProps){e=Ci({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}var $1=xd(null),e2=null,gA=null,qF=null;function $F(){qF=gA=e2=null}function e_(n){var e=$1.current;$n($1),n._currentValue=e}function GE(n,e,t){for(;n!==null;){var i=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),n===t)break;n=n.return}}function FA(n,e){e2=n,qF=gA=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(uo=!0),n.firstContext=null)}function Ha(n){var e=n._currentValue;if(qF!==n)if(n={context:n,memoizedValue:e,next:null},gA===null){if(e2===null)throw Error(Oe(308));gA=n,e2.dependencies={lanes:0,firstContext:n}}else gA=gA.next=n;return e}var Fh=null;function t_(n){Fh===null?Fh=[n]:Fh.push(n)}function DU(n,e,t,i){var r=e.interleaved;return r===null?(t.next=t,t_(e)):(t.next=r.next,r.next=t),e.interleaved=t,Lg(n,i)}function Lg(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Tu=!1;function n_(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function PU(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Wg(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function td(n,e,t){var i=n.updateQueue;if(i===null)return null;if(i=i.shared,gn&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Lg(n,t)}return r=i.interleaved,r===null?(e.next=e,t_(i)):(e.next=r.next,r.next=e),i.interleaved=e,Lg(n,t)}function qG(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,zF(n,t)}}function Lk(n,e){var t=n.updateQueue,i=n.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var r=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?r=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?r=s=e:s=s.next=e}else r=s=e;t={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function t2(n,e,t,i){var r=n.updateQueue;Tu=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var g=n.alternate;g!==null&&(g=g.updateQueue,a=g.lastBaseUpdate,a!==o&&(a===null?g.firstBaseUpdate=c:a.next=c,g.lastBaseUpdate=l))}if(s!==null){var u=r.baseState;o=0,g=c=l=null,a=s;do{var d=a.lane,h=a.eventTime;if((i&d)===d){g!==null&&(g=g.next={eventTime:h,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=n,I=a;switch(d=e,h=t,I.tag){case 1:if(f=I.payload,typeof f=="function"){u=f.call(h,u,d);break e}u=f;break e;case 3:f.flags=f.flags&-65537|128;case 0:if(f=I.payload,d=typeof f=="function"?f.call(h,u,d):f,d==null)break e;u=Ci({},u,d);break e;case 2:Tu=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,d=r.effects,d===null?r.effects=[a]:d.push(a))}else h={eventTime:h,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},g===null?(c=g=h,l=u):g=g.next=h,o|=d;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;d=a,a=d.next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}while(1);if(g===null&&(l=u),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=g,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);uf|=o,n.lanes=o,n.memoizedState=u}}function Hk(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var i=n[e],r=i.callback;if(r!==null){if(i.callback=null,i=t,typeof r!="function")throw Error(Oe(191,r));r.call(i)}}}var UU=new DP.Component().refs;function wE(n,e,t,i){e=n.memoizedState,t=t(i,e),t=t==null?e:Ci({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var fw={isMounted:function(n){return(n=n._reactInternals)?Gf(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var i=Ls(),r=id(n),s=Wg(i,r);s.payload=e,t!=null&&(s.callback=t),e=td(n,s,r),e!==null&&(Bl(e,n,r,i),qG(e,n,r))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var i=Ls(),r=id(n),s=Wg(i,r);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=td(n,s,r),e!==null&&(Bl(e,n,r,i),qG(e,n,r))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Ls(),i=id(n),r=Wg(t,i);r.tag=2,e!=null&&(r.callback=e),e=td(n,r,i),e!==null&&(Bl(e,n,i,t),qG(e,n,i))}};function zk(n,e,t,i,r,s,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!iy(t,i)||!iy(r,s):!0}function QU(n,e,t){var i=!1,r=fd,s=e.contextType;return typeof s=="object"&&s!==null?s=Ha(s):(r=Co(e)?lf:us.current,i=e.contextTypes,s=(i=i!=null)?jA(n,r):fd),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=fw,n.stateNode=e,e._reactInternals=n,i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=s),e}function Xk(n,e,t,i){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==n&&fw.enqueueReplaceState(e,e.state,null)}function xE(n,e,t,i){var r=n.stateNode;r.props=t,r.state=n.memoizedState,r.refs=UU,n_(n);var s=e.contextType;typeof s=="object"&&s!==null?r.context=Ha(s):(s=Co(e)?lf:us.current,r.context=jA(n,s)),r.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(wE(n,e,s,t),r.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&fw.enqueueReplaceState(r,r.state,null),t2(n,t,r,i),r.state=n.memoizedState),typeof r.componentDidMount=="function"&&(n.flags|=4194308)}function Yp(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Oe(309));var i=t.stateNode}if(!i)throw Error(Oe(147,n));var r=i,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;a===UU&&(a=r.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof n!="string")throw Error(Oe(284));if(!t._owner)throw Error(Oe(290,n))}return n}function Ub(n,e){throw n=Object.prototype.toString.call(e),Error(Oe(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function Yk(n){var e=n._init;return e(n._payload)}function OU(n){function e(p,y){if(n){var v=p.deletions;v===null?(p.deletions=[y],p.flags|=16):v.push(y)}}function t(p,y){if(!n)return null;for(;y!==null;)e(p,y),y=y.sibling;return null}function i(p,y){for(p=new Map;y!==null;)y.key!==null?p.set(y.key,y):p.set(y.index,y),y=y.sibling;return p}function r(p,y){return p=rd(p,y),p.index=0,p.sibling=null,p}function s(p,y,v){return p.index=v,n?(v=p.alternate,v!==null?(v=v.index,v<y?(p.flags|=2,y):v):(p.flags|=2,y)):(p.flags|=1048576,y)}function o(p){return n&&p.alternate===null&&(p.flags|=2),p}function a(p,y,v,b){return y===null||y.tag!==6?(y=sR(v,p.mode,b),y.return=p,y):(y=r(y,v),y.return=p,y)}function l(p,y,v,b){var w=v.type;return w===nA?g(p,y,v.props.children,b,v.key):y!==null&&(y.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===Vu&&Yk(w)===y.type)?(b=r(y,v.props),b.ref=Yp(p,y,v),b.return=p,b):(b=r1(v.type,v.key,v.props,null,p.mode,b),b.ref=Yp(p,y,v),b.return=p,b)}function c(p,y,v,b){return y===null||y.tag!==4||y.stateNode.containerInfo!==v.containerInfo||y.stateNode.implementation!==v.implementation?(y=oR(v,p.mode,b),y.return=p,y):(y=r(y,v.children||[]),y.return=p,y)}function g(p,y,v,b,w){return y===null||y.tag!==7?(y=Ph(v,p.mode,b,w),y.return=p,y):(y=r(y,v),y.return=p,y)}function u(p,y,v){if(typeof y=="string"&&y!==""||typeof y=="number")return y=sR(""+y,p.mode,v),y.return=p,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Tb:return v=r1(y.type,y.key,y.props,null,p.mode,v),v.ref=Yp(p,null,y),v.return=p,v;case tA:return y=oR(y,p.mode,v),y.return=p,y;case Vu:var b=y._init;return u(p,b(y._payload),v)}if(jm(y)||kp(y))return y=Ph(y,p.mode,v,null),y.return=p,y;Ub(p,y)}return null}function d(p,y,v,b){var w=y!==null?y.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return w!==null?null:a(p,y,""+v,b);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Tb:return v.key===w?l(p,y,v,b):null;case tA:return v.key===w?c(p,y,v,b):null;case Vu:return w=v._init,d(p,y,w(v._payload),b)}if(jm(v)||kp(v))return w!==null?null:g(p,y,v,b,null);Ub(p,v)}return null}function h(p,y,v,b,w){if(typeof b=="string"&&b!==""||typeof b=="number")return p=p.get(v)||null,a(y,p,""+b,w);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Tb:return p=p.get(b.key===null?v:b.key)||null,l(y,p,b,w);case tA:return p=p.get(b.key===null?v:b.key)||null,c(y,p,b,w);case Vu:var G=b._init;return h(p,y,v,G(b._payload),w)}if(jm(b)||kp(b))return p=p.get(v)||null,g(y,p,b,w,null);Ub(y,b)}return null}function f(p,y,v,b){for(var w=null,G=null,x=y,B=y=0,R=null;x!==null&&B<v.length;B++){x.index>B?(R=x,x=null):R=x.sibling;var Z=d(p,x,v[B],b);if(Z===null){x===null&&(x=R);break}n&&x&&Z.alternate===null&&e(p,x),y=s(Z,y,B),G===null?w=Z:G.sibling=Z,G=Z,x=R}if(B===v.length)return t(p,x),oi&&ph(p,B),w;if(x===null){for(;B<v.length;B++)x=u(p,v[B],b),x!==null&&(y=s(x,y,B),G===null?w=x:G.sibling=x,G=x);return oi&&ph(p,B),w}for(x=i(p,x);B<v.length;B++)R=h(x,p,B,v[B],b),R!==null&&(n&&R.alternate!==null&&x.delete(R.key===null?B:R.key),y=s(R,y,B),G===null?w=R:G.sibling=R,G=R);return n&&x.forEach(function(W){return e(p,W)}),oi&&ph(p,B),w}function I(p,y,v,b){var w=kp(v);if(typeof w!="function")throw Error(Oe(150));if(v=w.call(v),v==null)throw Error(Oe(151));for(var G=w=null,x=y,B=y=0,R=null,Z=v.next();x!==null&&!Z.done;B++,Z=v.next()){x.index>B?(R=x,x=null):R=x.sibling;var W=d(p,x,Z.value,b);if(W===null){x===null&&(x=R);break}n&&x&&W.alternate===null&&e(p,x),y=s(W,y,B),G===null?w=W:G.sibling=W,G=W,x=R}if(Z.done)return t(p,x),oi&&ph(p,B),w;if(x===null){for(;!Z.done;B++,Z=v.next())Z=u(p,Z.value,b),Z!==null&&(y=s(Z,y,B),G===null?w=Z:G.sibling=Z,G=Z);return oi&&ph(p,B),w}for(x=i(p,x);!Z.done;B++,Z=v.next())Z=h(x,p,B,Z.value,b),Z!==null&&(n&&Z.alternate!==null&&x.delete(Z.key===null?B:Z.key),y=s(Z,y,B),G===null?w=Z:G.sibling=Z,G=Z);return n&&x.forEach(function(F){return e(p,F)}),oi&&ph(p,B),w}function A(p,y,v,b){if(typeof v=="object"&&v!==null&&v.type===nA&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case Tb:e:{for(var w=v.key,G=y;G!==null;){if(G.key===w){if(w=v.type,w===nA){if(G.tag===7){t(p,G.sibling),y=r(G,v.props.children),y.return=p,p=y;break e}}else if(G.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===Vu&&Yk(w)===G.type){t(p,G.sibling),y=r(G,v.props),y.ref=Yp(p,G,v),y.return=p,p=y;break e}t(p,G);break}else e(p,G);G=G.sibling}v.type===nA?(y=Ph(v.props.children,p.mode,b,v.key),y.return=p,p=y):(b=r1(v.type,v.key,v.props,null,p.mode,b),b.ref=Yp(p,y,v),b.return=p,p=b)}return o(p);case tA:e:{for(G=v.key;y!==null;){if(y.key===G)if(y.tag===4&&y.stateNode.containerInfo===v.containerInfo&&y.stateNode.implementation===v.implementation){t(p,y.sibling),y=r(y,v.children||[]),y.return=p,p=y;break e}else{t(p,y);break}else e(p,y);y=y.sibling}y=oR(v,p.mode,b),y.return=p,p=y}return o(p);case Vu:return G=v._init,A(p,y,G(v._payload),b)}if(jm(v))return f(p,y,v,b);if(kp(v))return I(p,y,v,b);Ub(p,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,y!==null&&y.tag===6?(t(p,y.sibling),y=r(y,v),y.return=p,p=y):(t(p,y),y=sR(v,p.mode,b),y.return=p,p=y),o(p)):t(p,y)}return A}var $A=OU(!0),JU=OU(!1),nv={},Cc=xd(nv),ay=xd(nv),ly=xd(nv);function _h(n){if(n===nv)throw Error(Oe(174));return n}function i_(n,e){switch(Xn(ly,e),Xn(ay,n),Xn(Cc,nv),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:rE(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=rE(e,n)}$n(Cc),Xn(Cc,e)}function eC(){$n(Cc),$n(ay),$n(ly)}function jU(n){_h(ly.current);var e=_h(Cc.current),t=rE(e,n.type);e!==t&&(Xn(ay,n),Xn(Cc,t))}function r_(n){ay.current===n&&($n(Cc),$n(ay))}var ui=xd(0);function n2(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var $S=[];function s_(){for(var n=0;n<$S.length;n++)$S[n]._workInProgressVersionPrimary=null;$S.length=0}var $G=jg.ReactCurrentDispatcher,eR=jg.ReactCurrentBatchConfig,gf=0,Ai=null,ji=null,dr=null,i2=!1,y0=!1,cy=0,gie=0;function Ur(){throw Error(Oe(321))}function o_(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!xl(n[t],e[t]))return!1;return!0}function a_(n,e,t,i,r,s){if(gf=s,Ai=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,$G.current=n===null||n.memoizedState===null?fie:Iie,n=t(i,r),y0){s=0;do{if(y0=!1,cy=0,25<=s)throw Error(Oe(301));s+=1,dr=ji=null,e.updateQueue=null,$G.current=Aie,n=t(i,r)}while(y0)}if($G.current=r2,e=ji!==null&&ji.next!==null,gf=0,dr=ji=Ai=null,i2=!1,e)throw Error(Oe(300));return n}function l_(){var n=cy!==0;return cy=0,n}function tc(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return dr===null?Ai.memoizedState=dr=n:dr=dr.next=n,dr}function za(){if(ji===null){var n=Ai.alternate;n=n!==null?n.memoizedState:null}else n=ji.next;var e=dr===null?Ai.memoizedState:dr.next;if(e!==null)dr=e,ji=n;else{if(n===null)throw Error(Oe(310));ji=n,n={memoizedState:ji.memoizedState,baseState:ji.baseState,baseQueue:ji.baseQueue,queue:ji.queue,next:null},dr===null?Ai.memoizedState=dr=n:dr=dr.next=n}return dr}function gy(n,e){return typeof e=="function"?e(n):e}function tR(n){var e=za(),t=e.queue;if(t===null)throw Error(Oe(311));t.lastRenderedReducer=n;var i=ji,r=i.baseQueue,s=t.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,t.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,l=null,c=s;do{var g=c.lane;if((gf&g)===g)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:n(i,c.action);else{var u={lane:g,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=u,o=i):l=l.next=u,Ai.lanes|=g,uf|=g}c=c.next}while(c!==null&&c!==s);l===null?o=i:l.next=a,xl(i,e.memoizedState)||(uo=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,t.lastRenderedState=i}if(n=t.interleaved,n!==null){r=n;do s=r.lane,Ai.lanes|=s,uf|=s,r=r.next;while(r!==n)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function nR(n){var e=za(),t=e.queue;if(t===null)throw Error(Oe(311));t.lastRenderedReducer=n;var i=t.dispatch,r=t.pending,s=e.memoizedState;if(r!==null){t.pending=null;var o=r=r.next;do s=n(s,o.action),o=o.next;while(o!==r);xl(s,e.memoizedState)||(uo=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,i]}function qU(){}function $U(n,e){var t=Ai,i=za(),r=e(),s=!xl(i.memoizedState,r);if(s&&(i.memoizedState=r,uo=!0),i=i.queue,c_(nQ.bind(null,t,i,n),[n]),i.getSnapshot!==e||s||dr!==null&&dr.memoizedState.tag&1){if(t.flags|=2048,uy(9,tQ.bind(null,t,i,r,e),void 0,null),Cr===null)throw Error(Oe(349));gf&30||eQ(t,e,r)}return r}function eQ(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Ai.updateQueue,e===null?(e={lastEffect:null,stores:null},Ai.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function tQ(n,e,t,i){e.value=t,e.getSnapshot=i,iQ(e)&&rQ(n)}function nQ(n,e,t){return t(function(){iQ(e)&&rQ(n)})}function iQ(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!xl(n,t)}catch{return!0}}function rQ(n){var e=Lg(n,1);e!==null&&Bl(e,n,1,-1)}function Kk(n){var e=tc();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:gy,lastRenderedState:n},e.queue=n,n=n.dispatch=hie.bind(null,Ai,n),[e.memoizedState,n]}function uy(n,e,t,i){return n={tag:n,create:e,destroy:t,deps:i,next:null},e=Ai.updateQueue,e===null?(e={lastEffect:null,stores:null},Ai.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(i=t.next,t.next=n,n.next=i,e.lastEffect=n)),n}function sQ(){return za().memoizedState}function e1(n,e,t,i){var r=tc();Ai.flags|=n,r.memoizedState=uy(1|e,t,void 0,i===void 0?null:i)}function Iw(n,e,t,i){var r=za();i=i===void 0?null:i;var s=void 0;if(ji!==null){var o=ji.memoizedState;if(s=o.destroy,i!==null&&o_(i,o.deps)){r.memoizedState=uy(e,t,s,i);return}}Ai.flags|=n,r.memoizedState=uy(1|e,t,s,i)}function Dk(n,e){return e1(8390656,8,n,e)}function c_(n,e){return Iw(2048,8,n,e)}function oQ(n,e){return Iw(4,2,n,e)}function aQ(n,e){return Iw(4,4,n,e)}function lQ(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function cQ(n,e,t){return t=t!=null?t.concat([n]):null,Iw(4,4,lQ.bind(null,e,n),t)}function g_(){}function gQ(n,e){var t=za();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&o_(e,i[1])?i[0]:(t.memoizedState=[n,e],n)}function uQ(n,e){var t=za();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&o_(e,i[1])?i[0]:(n=n(),t.memoizedState=[n,e],n)}function dQ(n,e,t){return gf&21?(xl(t,e)||(t=IU(),Ai.lanes|=t,uf|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,uo=!0),n.memoizedState=t)}function uie(n,e){var t=Zn;Zn=t!==0&&4>t?t:4,n(!0);var i=eR.transition;eR.transition={};try{n(!1),e()}finally{Zn=t,eR.transition=i}}function hQ(){return za().memoizedState}function die(n,e,t){var i=id(n);if(t={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null},fQ(n))IQ(e,t);else if(t=DU(n,e,t,i),t!==null){var r=Ls();Bl(t,n,i,r),AQ(t,e,i)}}function hie(n,e,t){var i=id(n),r={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null};if(fQ(n))IQ(e,r);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(r.hasEagerState=!0,r.eagerState=a,xl(a,o)){var l=e.interleaved;l===null?(r.next=r,t_(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}t=DU(n,e,r,i),t!==null&&(r=Ls(),Bl(t,n,i,r),AQ(t,e,i))}}function fQ(n){var e=n.alternate;return n===Ai||e!==null&&e===Ai}function IQ(n,e){y0=i2=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function AQ(n,e,t){if(t&4194240){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,zF(n,t)}}var r2={readContext:Ha,useCallback:Ur,useContext:Ur,useEffect:Ur,useImperativeHandle:Ur,useInsertionEffect:Ur,useLayoutEffect:Ur,useMemo:Ur,useReducer:Ur,useRef:Ur,useState:Ur,useDebugValue:Ur,useDeferredValue:Ur,useTransition:Ur,useMutableSource:Ur,useSyncExternalStore:Ur,useId:Ur,unstable_isNewReconciler:!1},fie={readContext:Ha,useCallback:function(n,e){return tc().memoizedState=[n,e===void 0?null:e],n},useContext:Ha,useEffect:Dk,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,e1(4194308,4,lQ.bind(null,e,n),t)},useLayoutEffect:function(n,e){return e1(4194308,4,n,e)},useInsertionEffect:function(n,e){return e1(4,2,n,e)},useMemo:function(n,e){var t=tc();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var i=tc();return e=t!==void 0?t(e):e,i.memoizedState=i.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},i.queue=n,n=n.dispatch=die.bind(null,Ai,n),[i.memoizedState,n]},useRef:function(n){var e=tc();return n={current:n},e.memoizedState=n},useState:Kk,useDebugValue:g_,useDeferredValue:function(n){return tc().memoizedState=n},useTransition:function(){var n=Kk(!1),e=n[0];return n=uie.bind(null,n[1]),tc().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var i=Ai,r=tc();if(oi){if(t===void 0)throw Error(Oe(407));t=t()}else{if(t=e(),Cr===null)throw Error(Oe(349));gf&30||eQ(i,e,t)}r.memoizedState=t;var s={value:t,getSnapshot:e};return r.queue=s,Dk(nQ.bind(null,i,s,n),[n]),i.flags|=2048,uy(9,tQ.bind(null,i,s,t,e),void 0,null),t},useId:function(){var n=tc(),e=Cr.identifierPrefix;if(oi){var t=xg,i=wg;t=(i&~(1<<32-bl(i)-1)).toString(32)+t,e=":"+e+"R"+t,t=cy++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=gie++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},Iie={readContext:Ha,useCallback:gQ,useContext:Ha,useEffect:c_,useImperativeHandle:cQ,useInsertionEffect:oQ,useLayoutEffect:aQ,useMemo:uQ,useReducer:tR,useRef:sQ,useState:function(){return tR(gy)},useDebugValue:g_,useDeferredValue:function(n){var e=za();return dQ(e,ji.memoizedState,n)},useTransition:function(){var n=tR(gy)[0],e=za().memoizedState;return[n,e]},useMutableSource:qU,useSyncExternalStore:$U,useId:hQ,unstable_isNewReconciler:!1},Aie={readContext:Ha,useCallback:gQ,useContext:Ha,useEffect:c_,useImperativeHandle:cQ,useInsertionEffect:oQ,useLayoutEffect:aQ,useMemo:uQ,useReducer:nR,useRef:sQ,useState:function(){return nR(gy)},useDebugValue:g_,useDeferredValue:function(n){var e=za();return ji===null?e.memoizedState=n:dQ(e,ji.memoizedState,n)},useTransition:function(){var n=nR(gy)[0],e=za().memoizedState;return[n,e]},useMutableSource:qU,useSyncExternalStore:$U,useId:hQ,unstable_isNewReconciler:!1};function tC(n,e){try{var t="",i=e;do t+=Kte(i),i=i.return;while(i);var r=t}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:r,digest:null}}function iR(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function SE(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var Cie=typeof WeakMap=="function"?WeakMap:Map;function CQ(n,e,t){t=Wg(-1,t),t.tag=3,t.payload={element:null};var i=e.value;return t.callback=function(){o2||(o2=!0,NE=i),SE(n,e)},t}function pQ(n,e,t){t=Wg(-1,t),t.tag=3;var i=n.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;t.payload=function(){return i(r)},t.callback=function(){SE(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){SE(n,e),typeof i!="function"&&(nd===null?nd=new Set([this]):nd.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function Pk(n,e,t){var i=n.pingCache;if(i===null){i=n.pingCache=new Cie;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(t)||(r.add(t),n=Eie.bind(null,n,e,t),e.then(n,n))}function Uk(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function Qk(n,e,t,i,r){return n.mode&1?(n.flags|=65536,n.lanes=r,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Wg(-1,1),e.tag=2,td(t,e,1))),t.lanes|=1),n)}var pie=jg.ReactCurrentOwner,uo=!1;function Es(n,e,t,i){e.child=n===null?JU(e,null,t,i):$A(e,n.child,t,i)}function Ok(n,e,t,i,r){t=t.render;var s=e.ref;return FA(e,r),i=a_(n,e,t,i,s,r),t=l_(),n!==null&&!uo?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,Hg(n,e,r)):(oi&&t&&OF(e),e.flags|=1,Es(n,e,i,r),e.child)}function Jk(n,e,t,i,r){if(n===null){var s=t.type;return typeof s=="function"&&!p_(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,mQ(n,e,s,i,r)):(n=r1(t.type,null,i,e,e.mode,r),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&r)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:iy,t(o,i)&&n.ref===e.ref)return Hg(n,e,r)}return e.flags|=1,n=rd(s,i),n.ref=e.ref,n.return=e,e.child=n}function mQ(n,e,t,i,r){if(n!==null){var s=n.memoizedProps;if(iy(s,i)&&n.ref===e.ref)if(uo=!1,e.pendingProps=i=s,(n.lanes&r)!==0)n.flags&131072&&(uo=!0);else return e.lanes=n.lanes,Hg(n,e,r)}return RE(n,e,t,i,r)}function yQ(n,e,t){var i=e.pendingProps,r=i.children,s=n!==null?n.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Xn(dA,Ko),Ko|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Xn(dA,Ko),Ko|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:t,Xn(dA,Ko),Ko|=i}else s!==null?(i=s.baseLanes|t,e.memoizedState=null):i=t,Xn(dA,Ko),Ko|=i;return Es(n,e,r,t),e.child}function vQ(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function RE(n,e,t,i,r){var s=Co(t)?lf:us.current;return s=jA(e,s),FA(e,r),t=a_(n,e,t,i,s,r),i=l_(),n!==null&&!uo?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,Hg(n,e,r)):(oi&&i&&OF(e),e.flags|=1,Es(n,e,t,r),e.child)}function jk(n,e,t,i,r){if(Co(t)){var s=!0;J1(e)}else s=!1;if(FA(e,r),e.stateNode===null)t1(n,e),QU(e,t,i),xE(e,t,i,r),i=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=t.contextType;typeof c=="object"&&c!==null?c=Ha(c):(c=Co(t)?lf:us.current,c=jA(e,c));var g=t.getDerivedStateFromProps,u=typeof g=="function"||typeof o.getSnapshotBeforeUpdate=="function";u||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&Xk(e,o,i,c),Tu=!1;var d=e.memoizedState;o.state=d,t2(e,i,o,r),l=e.memoizedState,a!==i||d!==l||Ao.current||Tu?(typeof g=="function"&&(wE(e,t,g,i),l=e.memoizedState),(a=Tu||zk(e,t,a,i,d,l,c))?(u||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,PU(n,e),a=e.memoizedProps,c=e.type===e.elementType?a:dl(e.type,a),o.props=c,u=e.pendingProps,d=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=Ha(l):(l=Co(t)?lf:us.current,l=jA(e,l));var h=t.getDerivedStateFromProps;(g=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==u||d!==l)&&Xk(e,o,i,l),Tu=!1,d=e.memoizedState,o.state=d,t2(e,i,o,r);var f=e.memoizedState;a!==u||d!==f||Ao.current||Tu?(typeof h=="function"&&(wE(e,t,h,i),f=e.memoizedState),(c=Tu||zk(e,t,c,i,d,f,l)||!1)?(g||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,f,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,f,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=f),o.props=i,o.state=f,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=1024),i=!1)}return ZE(n,e,t,i,s,r)}function ZE(n,e,t,i,r,s){vQ(n,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&Tk(e,t,!1),Hg(n,e,s);i=e.stateNode,pie.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,n!==null&&o?(e.child=$A(e,n.child,null,s),e.child=$A(e,null,a,s)):Es(n,e,a,s),e.memoizedState=i.state,r&&Tk(e,t,!0),e.child}function bQ(n){var e=n.stateNode;e.pendingContext?Vk(n,e.pendingContext,e.pendingContext!==e.context):e.context&&Vk(n,e.context,!1),i_(n,e.containerInfo)}function qk(n,e,t,i,r){return qA(),jF(r),e.flags|=256,Es(n,e,t,i),e.child}var ME={dehydrated:null,treeContext:null,retryLane:0};function EE(n){return{baseLanes:n,cachePool:null,transitions:null}}function BQ(n,e,t){var i=e.pendingProps,r=ui.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(r|=1),Xn(ui,r&1),n===null)return BE(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,n=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=pw(o,i,0,null),n=Ph(n,i,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=EE(t),e.memoizedState=ME,n):u_(e,o));if(r=n.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return mie(n,e,o,i,a,r,t);if(s){s=i.fallback,o=e.mode,r=n.child,a=r.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=rd(r,l),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=rd(a,s):(s=Ph(s,o,t,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=n.child.memoizedState,o=o===null?EE(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=n.childLanes&~t,e.memoizedState=ME,i}return s=n.child,n=s.sibling,i=rd(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=t),i.return=e,i.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=i,e.memoizedState=null,i}function u_(n,e){return e=pw({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function Qb(n,e,t,i){return i!==null&&jF(i),$A(e,n.child,null,t),n=u_(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function mie(n,e,t,i,r,s,o){if(t)return e.flags&256?(e.flags&=-257,i=iR(Error(Oe(422))),Qb(n,e,o,i)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=pw({mode:"visible",children:i.children},r,0,null),s=Ph(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&$A(e,n.child,null,o),e.child.memoizedState=EE(o),e.memoizedState=ME,s);if(!(e.mode&1))return Qb(n,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(Oe(419)),i=iR(s,i,void 0),Qb(n,e,o,i)}if(a=(o&n.childLanes)!==0,uo||a){if(i=Cr,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,Lg(n,r),Bl(i,n,r,-1))}return C_(),i=iR(Error(Oe(421))),Qb(n,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=n.child,e=Wie.bind(null,n),r._reactRetry=e,null):(n=s.treeContext,Qo=ed(r.nextSibling),Jo=e,oi=!0,Il=null,n!==null&&(Sa[Ra++]=wg,Sa[Ra++]=xg,Sa[Ra++]=cf,wg=n.id,xg=n.overflow,cf=e),e=u_(e,i.children),e.flags|=4096,e)}function $k(n,e,t){n.lanes|=e;var i=n.alternate;i!==null&&(i.lanes|=e),GE(n.return,e,t)}function rR(n,e,t,i,r){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=t,s.tailMode=r)}function GQ(n,e,t){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Es(n,e,i.children,t),i=ui.current,i&2)i=i&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&$k(n,t,e);else if(n.tag===19)$k(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}i&=1}if(Xn(ui,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)n=t.alternate,n!==null&&n2(n)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),rR(e,!1,r,t,s);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(n=r.alternate,n!==null&&n2(n)===null){e.child=r;break}n=r.sibling,r.sibling=t,t=r,r=n}rR(e,!0,t,null,s);break;case"together":rR(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function t1(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Hg(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),uf|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(Oe(153));if(e.child!==null){for(n=e.child,t=rd(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=rd(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function yie(n,e,t){switch(e.tag){case 3:bQ(e),qA();break;case 5:jU(e);break;case 1:Co(e.type)&&J1(e);break;case 4:i_(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;Xn($1,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(Xn(ui,ui.current&1),e.flags|=128,null):t&e.child.childLanes?BQ(n,e,t):(Xn(ui,ui.current&1),n=Hg(n,e,t),n!==null?n.sibling:null);Xn(ui,ui.current&1);break;case 19:if(i=(t&e.childLanes)!==0,n.flags&128){if(i)return GQ(n,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Xn(ui,ui.current),i)break;return null;case 22:case 23:return e.lanes=0,yQ(n,e,t)}return Hg(n,e,t)}var wQ,WE,xQ,SQ;wQ=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};WE=function(){};xQ=function(n,e,t,i){var r=n.memoizedProps;if(r!==i){n=e.stateNode,_h(Cc.current);var s=null;switch(t){case"input":r=eE(n,r),i=eE(n,i),s=[];break;case"select":r=Ci({},r,{value:void 0}),i=Ci({},i,{value:void 0}),s=[];break;case"textarea":r=iE(n,r),i=iE(n,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(n.onclick=Q1)}sE(t,i);var o;t=null;for(c in r)if(!i.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var a=r[c];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(J0.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(a=r!=null?r[c]:void 0,i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(s||(s=[]),s.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(J0.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&jn("scroll",n),s||a===l||(s=[])):(s=s||[]).push(c,l))}t&&(s=s||[]).push("style",t);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};SQ=function(n,e,t,i){t!==i&&(e.flags|=4)};function Kp(n,e){if(!oi)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:i.sibling=null}}function Qr(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,i=0;if(e)for(var r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=n,r=r.sibling;else for(r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=n,r=r.sibling;return n.subtreeFlags|=i,n.childLanes=t,e}function vie(n,e,t){var i=e.pendingProps;switch(JF(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qr(e),null;case 1:return Co(e.type)&&O1(),Qr(e),null;case 3:return i=e.stateNode,eC(),$n(Ao),$n(us),s_(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(n===null||n.child===null)&&(Pb(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Il!==null&&(HE(Il),Il=null))),WE(n,e),Qr(e),null;case 5:r_(e);var r=_h(ly.current);if(t=e.type,n!==null&&e.stateNode!=null)xQ(n,e,t,i,r),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(Oe(166));return Qr(e),null}if(n=_h(Cc.current),Pb(e)){i=e.stateNode,t=e.type;var s=e.memoizedProps;switch(i[gc]=e,i[oy]=s,n=(e.mode&1)!==0,t){case"dialog":jn("cancel",i),jn("close",i);break;case"iframe":case"object":case"embed":jn("load",i);break;case"video":case"audio":for(r=0;r<$m.length;r++)jn($m[r],i);break;case"source":jn("error",i);break;case"img":case"image":case"link":jn("error",i),jn("load",i);break;case"details":jn("toggle",i);break;case"input":lk(i,s),jn("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},jn("invalid",i);break;case"textarea":gk(i,s),jn("invalid",i)}sE(t,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&Db(i.textContent,a,n),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Db(i.textContent,a,n),r=["children",""+a]):J0.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&jn("scroll",i)}switch(t){case"input":Nb(i),ck(i,s,!0);break;case"textarea":Nb(i),uk(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=Q1)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=eU(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof i.is=="string"?n=o.createElement(t,{is:i.is}):(n=o.createElement(t),t==="select"&&(o=n,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):n=o.createElementNS(n,t),n[gc]=e,n[oy]=i,wQ(n,e,!1,!1),e.stateNode=n;e:{switch(o=oE(t,i),t){case"dialog":jn("cancel",n),jn("close",n),r=i;break;case"iframe":case"object":case"embed":jn("load",n),r=i;break;case"video":case"audio":for(r=0;r<$m.length;r++)jn($m[r],n);r=i;break;case"source":jn("error",n),r=i;break;case"img":case"image":case"link":jn("error",n),jn("load",n),r=i;break;case"details":jn("toggle",n),r=i;break;case"input":lk(n,i),r=eE(n,i),jn("invalid",n);break;case"option":r=i;break;case"select":n._wrapperState={wasMultiple:!!i.multiple},r=Ci({},i,{value:void 0}),jn("invalid",n);break;case"textarea":gk(n,i),r=iE(n,i),jn("invalid",n);break;default:r=i}sE(t,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?iU(n,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&tU(n,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&j0(n,l):typeof l=="number"&&j0(n,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(J0.hasOwnProperty(s)?l!=null&&s==="onScroll"&&jn("scroll",n):l!=null&&VF(n,s,l,o))}switch(t){case"input":Nb(n),ck(n,i,!1);break;case"textarea":Nb(n),uk(n);break;case"option":i.value!=null&&n.setAttribute("value",""+hd(i.value));break;case"select":n.multiple=!!i.multiple,s=i.value,s!=null?ZA(n,!!i.multiple,s,!1):i.defaultValue!=null&&ZA(n,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(n.onclick=Q1)}switch(t){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Qr(e),null;case 6:if(n&&e.stateNode!=null)SQ(n,e,n.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(Oe(166));if(t=_h(ly.current),_h(Cc.current),Pb(e)){if(i=e.stateNode,t=e.memoizedProps,i[gc]=e,(s=i.nodeValue!==t)&&(n=Jo,n!==null))switch(n.tag){case 3:Db(i.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Db(i.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else i=(t.nodeType===9?t:t.ownerDocument).createTextNode(i),i[gc]=e,e.stateNode=i}return Qr(e),null;case 13:if($n(ui),i=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(oi&&Qo!==null&&e.mode&1&&!(e.flags&128))KU(),qA(),e.flags|=98560,s=!1;else if(s=Pb(e),i!==null&&i.dehydrated!==null){if(n===null){if(!s)throw Error(Oe(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Oe(317));s[gc]=e}else qA(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Qr(e),s=!1}else Il!==null&&(HE(Il),Il=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(i=i!==null,i!==(n!==null&&n.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(n===null||ui.current&1?$i===0&&($i=3):C_())),e.updateQueue!==null&&(e.flags|=4),Qr(e),null);case 4:return eC(),WE(n,e),n===null&&ry(e.stateNode.containerInfo),Qr(e),null;case 10:return e_(e.type._context),Qr(e),null;case 17:return Co(e.type)&&O1(),Qr(e),null;case 19:if($n(ui),s=e.memoizedState,s===null)return Qr(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)Kp(s,!1);else{if($i!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=n2(n),o!==null){for(e.flags|=128,Kp(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=t,t=e.child;t!==null;)s=t,n=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,n=o.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Xn(ui,ui.current&1|2),e.child}n=n.sibling}s.tail!==null&&Ei()>nC&&(e.flags|=128,i=!0,Kp(s,!1),e.lanes=4194304)}else{if(!i)if(n=n2(o),n!==null){if(e.flags|=128,i=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Kp(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!oi)return Qr(e),null}else 2*Ei()-s.renderingStartTime>nC&&t!==1073741824&&(e.flags|=128,i=!0,Kp(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Ei(),e.sibling=null,t=ui.current,Xn(ui,i?t&1|2:t&1),e):(Qr(e),null);case 22:case 23:return A_(),i=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Ko&1073741824&&(Qr(e),e.subtreeFlags&6&&(e.flags|=8192)):Qr(e),null;case 24:return null;case 25:return null}throw Error(Oe(156,e.tag))}function bie(n,e){switch(JF(e),e.tag){case 1:return Co(e.type)&&O1(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return eC(),$n(Ao),$n(us),s_(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return r_(e),null;case 13:if($n(ui),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(Oe(340));qA()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return $n(ui),null;case 4:return eC(),null;case 10:return e_(e.type._context),null;case 22:case 23:return A_(),null;case 24:return null;default:return null}}var Ob=!1,is=!1,Bie=typeof WeakSet=="function"?WeakSet:Set,at=null;function uA(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(i){vi(n,e,i)}else t.current=null}function FE(n,e,t){try{t()}catch(i){vi(n,e,i)}}var e9=!1;function Gie(n,e){if(AE=D1,n=EU(),QF(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var i=t.getSelection&&t.getSelection();if(i&&i.rangeCount!==0){t=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,c=0,g=0,u=n,d=null;t:for(;;){for(var h;u!==t||r!==0&&u.nodeType!==3||(a=o+r),u!==s||i!==0&&u.nodeType!==3||(l=o+i),u.nodeType===3&&(o+=u.nodeValue.length),(h=u.firstChild)!==null;)d=u,u=h;for(;;){if(u===n)break t;if(d===t&&++c===r&&(a=o),d===s&&++g===i&&(l=o),(h=u.nextSibling)!==null)break;u=d,d=u.parentNode}u=h}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(CE={focusedElem:n,selectionRange:t},D1=!1,at=e;at!==null;)if(e=at,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,at=n;else for(;at!==null;){e=at;try{var f=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var I=f.memoizedProps,A=f.memoizedState,p=e.stateNode,y=p.getSnapshotBeforeUpdate(e.elementType===e.type?I:dl(e.type,I),A);p.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var v=e.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Oe(163))}}catch(b){vi(e,e.return,b)}if(n=e.sibling,n!==null){n.return=e.return,at=n;break}at=e.return}return f=e9,e9=!1,f}function v0(n,e,t){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&n)===n){var s=r.destroy;r.destroy=void 0,s!==void 0&&FE(e,t,s)}r=r.next}while(r!==i)}}function Aw(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}}function _E(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function RQ(n){var e=n.alternate;e!==null&&(n.alternate=null,RQ(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[gc],delete e[oy],delete e[yE],delete e[oie],delete e[aie])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function ZQ(n){return n.tag===5||n.tag===3||n.tag===4}function t9(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||ZQ(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function VE(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Q1));else if(i!==4&&(n=n.child,n!==null))for(VE(n,e,t),n=n.sibling;n!==null;)VE(n,e,t),n=n.sibling}function TE(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(i!==4&&(n=n.child,n!==null))for(TE(n,e,t),n=n.sibling;n!==null;)TE(n,e,t),n=n.sibling}var xr=null,hl=!1;function Cu(n,e,t){for(t=t.child;t!==null;)MQ(n,e,t),t=t.sibling}function MQ(n,e,t){if(Ac&&typeof Ac.onCommitFiberUnmount=="function")try{Ac.onCommitFiberUnmount(lw,t)}catch{}switch(t.tag){case 5:is||uA(t,e);case 6:var i=xr,r=hl;xr=null,Cu(n,e,t),xr=i,hl=r,xr!==null&&(hl?(n=xr,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):xr.removeChild(t.stateNode));break;case 18:xr!==null&&(hl?(n=xr,t=t.stateNode,n.nodeType===8?jS(n.parentNode,t):n.nodeType===1&&jS(n,t),ty(n)):jS(xr,t.stateNode));break;case 4:i=xr,r=hl,xr=t.stateNode.containerInfo,hl=!0,Cu(n,e,t),xr=i,hl=r;break;case 0:case 11:case 14:case 15:if(!is&&(i=t.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&FE(t,e,o),r=r.next}while(r!==i)}Cu(n,e,t);break;case 1:if(!is&&(uA(t,e),i=t.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=t.memoizedProps,i.state=t.memoizedState,i.componentWillUnmount()}catch(a){vi(t,e,a)}Cu(n,e,t);break;case 21:Cu(n,e,t);break;case 22:t.mode&1?(is=(i=is)||t.memoizedState!==null,Cu(n,e,t),is=i):Cu(n,e,t);break;default:Cu(n,e,t)}}function n9(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new Bie),e.forEach(function(i){var r=Fie.bind(null,n,i);t.has(i)||(t.add(i),i.then(r,r))})}}function $a(n,e){var t=e.deletions;if(t!==null)for(var i=0;i<t.length;i++){var r=t[i];try{var s=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:xr=a.stateNode,hl=!1;break e;case 3:xr=a.stateNode.containerInfo,hl=!0;break e;case 4:xr=a.stateNode.containerInfo,hl=!0;break e}a=a.return}if(xr===null)throw Error(Oe(160));MQ(s,o,r),xr=null,hl=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){vi(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)EQ(e,n),e=e.sibling}function EQ(n,e){var t=n.alternate,i=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if($a(e,n),Kl(n),i&4){try{v0(3,n,n.return),Aw(3,n)}catch(I){vi(n,n.return,I)}try{v0(5,n,n.return)}catch(I){vi(n,n.return,I)}}break;case 1:$a(e,n),Kl(n),i&512&&t!==null&&uA(t,t.return);break;case 5:if($a(e,n),Kl(n),i&512&&t!==null&&uA(t,t.return),n.flags&32){var r=n.stateNode;try{j0(r,"")}catch(I){vi(n,n.return,I)}}if(i&4&&(r=n.stateNode,r!=null)){var s=n.memoizedProps,o=t!==null?t.memoizedProps:s,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&qP(r,s),oE(a,o);var c=oE(a,s);for(o=0;o<l.length;o+=2){var g=l[o],u=l[o+1];g==="style"?iU(r,u):g==="dangerouslySetInnerHTML"?tU(r,u):g==="children"?j0(r,u):VF(r,g,u,c)}switch(a){case"input":tE(r,s);break;case"textarea":$P(r,s);break;case"select":var d=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var h=s.value;h!=null?ZA(r,!!s.multiple,h,!1):d!==!!s.multiple&&(s.defaultValue!=null?ZA(r,!!s.multiple,s.defaultValue,!0):ZA(r,!!s.multiple,s.multiple?[]:"",!1))}r[oy]=s}catch(I){vi(n,n.return,I)}}break;case 6:if($a(e,n),Kl(n),i&4){if(n.stateNode===null)throw Error(Oe(162));r=n.stateNode,s=n.memoizedProps;try{r.nodeValue=s}catch(I){vi(n,n.return,I)}}break;case 3:if($a(e,n),Kl(n),i&4&&t!==null&&t.memoizedState.isDehydrated)try{ty(e.containerInfo)}catch(I){vi(n,n.return,I)}break;case 4:$a(e,n),Kl(n);break;case 13:$a(e,n),Kl(n),r=n.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(f_=Ei())),i&4&&n9(n);break;case 22:if(g=t!==null&&t.memoizedState!==null,n.mode&1?(is=(c=is)||g,$a(e,n),is=c):$a(e,n),Kl(n),i&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!g&&n.mode&1)for(at=n,g=n.child;g!==null;){for(u=at=g;at!==null;){switch(d=at,h=d.child,d.tag){case 0:case 11:case 14:case 15:v0(4,d,d.return);break;case 1:uA(d,d.return);var f=d.stateNode;if(typeof f.componentWillUnmount=="function"){i=d,t=d.return;try{e=i,f.props=e.memoizedProps,f.state=e.memoizedState,f.componentWillUnmount()}catch(I){vi(i,t,I)}}break;case 5:uA(d,d.return);break;case 22:if(d.memoizedState!==null){r9(u);continue}}h!==null?(h.return=d,at=h):r9(u)}g=g.sibling}e:for(g=null,u=n;;){if(u.tag===5){if(g===null){g=u;try{r=u.stateNode,c?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=u.stateNode,l=u.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=nU("display",o))}catch(I){vi(n,n.return,I)}}}else if(u.tag===6){if(g===null)try{u.stateNode.nodeValue=c?"":u.memoizedProps}catch(I){vi(n,n.return,I)}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===n)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===n)break e;for(;u.sibling===null;){if(u.return===null||u.return===n)break e;g===u&&(g=null),u=u.return}g===u&&(g=null),u.sibling.return=u.return,u=u.sibling}}break;case 19:$a(e,n),Kl(n),i&4&&n9(n);break;case 21:break;default:$a(e,n),Kl(n)}}function Kl(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(ZQ(t)){var i=t;break e}t=t.return}throw Error(Oe(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(j0(r,""),i.flags&=-33);var s=t9(n);TE(n,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=t9(n);VE(n,a,o);break;default:throw Error(Oe(161))}}catch(l){vi(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function wie(n,e,t){at=n,WQ(n)}function WQ(n,e,t){for(var i=(n.mode&1)!==0;at!==null;){var r=at,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||Ob;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||is;a=Ob;var c=is;if(Ob=o,(is=l)&&!c)for(at=r;at!==null;)o=at,l=o.child,o.tag===22&&o.memoizedState!==null?s9(r):l!==null?(l.return=o,at=l):s9(r);for(;s!==null;)at=s,WQ(s),s=s.sibling;at=r,Ob=a,is=c}i9(n)}else r.subtreeFlags&8772&&s!==null?(s.return=r,at=s):i9(n)}}function i9(n){for(;at!==null;){var e=at;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:is||Aw(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!is)if(t===null)i.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:dl(e.type,t.memoizedProps);i.componentDidUpdate(r,t.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Hk(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}Hk(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var g=c.memoizedState;if(g!==null){var u=g.dehydrated;u!==null&&ty(u)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Oe(163))}is||e.flags&512&&_E(e)}catch(d){vi(e,e.return,d)}}if(e===n){at=null;break}if(t=e.sibling,t!==null){t.return=e.return,at=t;break}at=e.return}}function r9(n){for(;at!==null;){var e=at;if(e===n){at=null;break}var t=e.sibling;if(t!==null){t.return=e.return,at=t;break}at=e.return}}function s9(n){for(;at!==null;){var e=at;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Aw(4,e)}catch(l){vi(e,t,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){vi(e,r,l)}}var s=e.return;try{_E(e)}catch(l){vi(e,s,l)}break;case 5:var o=e.return;try{_E(e)}catch(l){vi(e,o,l)}}}catch(l){vi(e,e.return,l)}if(e===n){at=null;break}var a=e.sibling;if(a!==null){a.return=e.return,at=a;break}at=e.return}}var xie=Math.ceil,s2=jg.ReactCurrentDispatcher,d_=jg.ReactCurrentOwner,Na=jg.ReactCurrentBatchConfig,gn=0,Cr=null,Yi=null,Mr=0,Ko=0,dA=xd(0),$i=0,dy=null,uf=0,Cw=0,h_=0,b0=null,co=null,f_=0,nC=1/0,hg=null,o2=!1,NE=null,nd=null,Jb=!1,Yu=null,a2=0,B0=0,kE=null,n1=-1,i1=0;function Ls(){return gn&6?Ei():n1!==-1?n1:n1=Ei()}function id(n){return n.mode&1?gn&2&&Mr!==0?Mr&-Mr:cie.transition!==null?(i1===0&&(i1=IU()),i1):(n=Zn,n!==0||(n=window.event,n=n===void 0?16:bU(n.type)),n):1}function Bl(n,e,t,i){if(50<B0)throw B0=0,kE=null,Error(Oe(185));$y(n,t,i),(!(gn&2)||n!==Cr)&&(n===Cr&&(!(gn&2)&&(Cw|=t),$i===4&&ku(n,Mr)),po(n,i),t===1&&gn===0&&!(e.mode&1)&&(nC=Ei()+500,hw&&Sd()))}function po(n,e){var t=n.callbackNode;cne(n,e);var i=K1(n,n===Cr?Mr:0);if(i===0)t!==null&&fk(t),n.callbackNode=null,n.callbackPriority=0;else if(e=i&-i,n.callbackPriority!==e){if(t!=null&&fk(t),e===1)n.tag===0?lie(o9.bind(null,n)):zU(o9.bind(null,n)),rie(function(){!(gn&6)&&Sd()}),t=null;else{switch(AU(i)){case 1:t=HF;break;case 4:t=hU;break;case 16:t=Y1;break;case 536870912:t=fU;break;default:t=Y1}t=HQ(t,FQ.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function FQ(n,e){if(n1=-1,i1=0,gn&6)throw Error(Oe(327));var t=n.callbackNode;if(_A()&&n.callbackNode!==t)return null;var i=K1(n,n===Cr?Mr:0);if(i===0)return null;if(i&30||i&n.expiredLanes||e)e=l2(n,i);else{e=i;var r=gn;gn|=2;var s=VQ();(Cr!==n||Mr!==e)&&(hg=null,nC=Ei()+500,Dh(n,e));do try{Zie();break}catch(a){_Q(n,a)}while(1);$F(),s2.current=s,gn=r,Yi!==null?e=0:(Cr=null,Mr=0,e=$i)}if(e!==0){if(e===2&&(r=uE(n),r!==0&&(i=r,e=LE(n,r))),e===1)throw t=dy,Dh(n,0),ku(n,i),po(n,Ei()),t;if(e===6)ku(n,i);else{if(r=n.current.alternate,!(i&30)&&!Sie(r)&&(e=l2(n,i),e===2&&(s=uE(n),s!==0&&(i=s,e=LE(n,s))),e===1))throw t=dy,Dh(n,0),ku(n,i),po(n,Ei()),t;switch(n.finishedWork=r,n.finishedLanes=i,e){case 0:case 1:throw Error(Oe(345));case 2:mh(n,co,hg);break;case 3:if(ku(n,i),(i&130023424)===i&&(e=f_+500-Ei(),10<e)){if(K1(n,0)!==0)break;if(r=n.suspendedLanes,(r&i)!==i){Ls(),n.pingedLanes|=n.suspendedLanes&r;break}n.timeoutHandle=mE(mh.bind(null,n,co,hg),e);break}mh(n,co,hg);break;case 4:if(ku(n,i),(i&4194240)===i)break;for(e=n.eventTimes,r=-1;0<i;){var o=31-bl(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=Ei()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*xie(i/1960))-i,10<i){n.timeoutHandle=mE(mh.bind(null,n,co,hg),i);break}mh(n,co,hg);break;case 5:mh(n,co,hg);break;default:throw Error(Oe(329))}}}return po(n,Ei()),n.callbackNode===t?FQ.bind(null,n):null}function LE(n,e){var t=b0;return n.current.memoizedState.isDehydrated&&(Dh(n,e).flags|=256),n=l2(n,e),n!==2&&(e=co,co=t,e!==null&&HE(e)),n}function HE(n){co===null?co=n:co.push.apply(co,n)}function Sie(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var i=0;i<t.length;i++){var r=t[i],s=r.getSnapshot;r=r.value;try{if(!xl(s(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ku(n,e){for(e&=~h_,e&=~Cw,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-bl(e),i=1<<t;n[t]=-1,e&=~i}}function o9(n){if(gn&6)throw Error(Oe(327));_A();var e=K1(n,0);if(!(e&1))return po(n,Ei()),null;var t=l2(n,e);if(n.tag!==0&&t===2){var i=uE(n);i!==0&&(e=i,t=LE(n,i))}if(t===1)throw t=dy,Dh(n,0),ku(n,e),po(n,Ei()),t;if(t===6)throw Error(Oe(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,mh(n,co,hg),po(n,Ei()),null}function I_(n,e){var t=gn;gn|=1;try{return n(e)}finally{gn=t,gn===0&&(nC=Ei()+500,hw&&Sd())}}function df(n){Yu!==null&&Yu.tag===0&&!(gn&6)&&_A();var e=gn;gn|=1;var t=Na.transition,i=Zn;try{if(Na.transition=null,Zn=1,n)return n()}finally{Zn=i,Na.transition=t,gn=e,!(gn&6)&&Sd()}}function A_(){Ko=dA.current,$n(dA)}function Dh(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,iie(t)),Yi!==null)for(t=Yi.return;t!==null;){var i=t;switch(JF(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&O1();break;case 3:eC(),$n(Ao),$n(us),s_();break;case 5:r_(i);break;case 4:eC();break;case 13:$n(ui);break;case 19:$n(ui);break;case 10:e_(i.type._context);break;case 22:case 23:A_()}t=t.return}if(Cr=n,Yi=n=rd(n.current,null),Mr=Ko=e,$i=0,dy=null,h_=Cw=uf=0,co=b0=null,Fh!==null){for(e=0;e<Fh.length;e++)if(t=Fh[e],i=t.interleaved,i!==null){t.interleaved=null;var r=i.next,s=t.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}t.pending=i}Fh=null}return n}function _Q(n,e){do{var t=Yi;try{if($F(),$G.current=r2,i2){for(var i=Ai.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}i2=!1}if(gf=0,dr=ji=Ai=null,y0=!1,cy=0,d_.current=null,t===null||t.return===null){$i=1,dy=e,Yi=null;break}e:{var s=n,o=t.return,a=t,l=e;if(e=Mr,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,g=a,u=g.tag;if(!(g.mode&1)&&(u===0||u===11||u===15)){var d=g.alternate;d?(g.updateQueue=d.updateQueue,g.memoizedState=d.memoizedState,g.lanes=d.lanes):(g.updateQueue=null,g.memoizedState=null)}var h=Uk(o);if(h!==null){h.flags&=-257,Qk(h,o,a,s,e),h.mode&1&&Pk(s,c,e),e=h,l=c;var f=e.updateQueue;if(f===null){var I=new Set;I.add(l),e.updateQueue=I}else f.add(l);break e}else{if(!(e&1)){Pk(s,c,e),C_();break e}l=Error(Oe(426))}}else if(oi&&a.mode&1){var A=Uk(o);if(A!==null){!(A.flags&65536)&&(A.flags|=256),Qk(A,o,a,s,e),jF(tC(l,a));break e}}s=l=tC(l,a),$i!==4&&($i=2),b0===null?b0=[s]:b0.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var p=CQ(s,l,e);Lk(s,p);break e;case 1:a=l;var y=s.type,v=s.stateNode;if(!(s.flags&128)&&(typeof y.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(nd===null||!nd.has(v)))){s.flags|=65536,e&=-e,s.lanes|=e;var b=pQ(s,a,e);Lk(s,b);break e}}s=s.return}while(s!==null)}NQ(t)}catch(w){e=w,Yi===t&&t!==null&&(Yi=t=t.return);continue}break}while(1)}function VQ(){var n=s2.current;return s2.current=r2,n===null?r2:n}function C_(){($i===0||$i===3||$i===2)&&($i=4),Cr===null||!(uf&268435455)&&!(Cw&268435455)||ku(Cr,Mr)}function l2(n,e){var t=gn;gn|=2;var i=VQ();(Cr!==n||Mr!==e)&&(hg=null,Dh(n,e));do try{Rie();break}catch(r){_Q(n,r)}while(1);if($F(),gn=t,s2.current=i,Yi!==null)throw Error(Oe(261));return Cr=null,Mr=0,$i}function Rie(){for(;Yi!==null;)TQ(Yi)}function Zie(){for(;Yi!==null&&!ene();)TQ(Yi)}function TQ(n){var e=LQ(n.alternate,n,Ko);n.memoizedProps=n.pendingProps,e===null?NQ(n):Yi=e,d_.current=null}function NQ(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=bie(t,e),t!==null){t.flags&=32767,Yi=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{$i=6,Yi=null;return}}else if(t=vie(t,e,Ko),t!==null){Yi=t;return}if(e=e.sibling,e!==null){Yi=e;return}Yi=e=n}while(e!==null);$i===0&&($i=5)}function mh(n,e,t){var i=Zn,r=Na.transition;try{Na.transition=null,Zn=1,Mie(n,e,t,i)}finally{Na.transition=r,Zn=i}return null}function Mie(n,e,t,i){do _A();while(Yu!==null);if(gn&6)throw Error(Oe(327));t=n.finishedWork;var r=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Oe(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(gne(n,s),n===Cr&&(Yi=Cr=null,Mr=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Jb||(Jb=!0,HQ(Y1,function(){return _A(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=Na.transition,Na.transition=null;var o=Zn;Zn=1;var a=gn;gn|=4,d_.current=null,Gie(n,t),EQ(t,n),Jne(CE),D1=!!AE,CE=AE=null,n.current=t,wie(t),tne(),gn=a,Zn=o,Na.transition=s}else n.current=t;if(Jb&&(Jb=!1,Yu=n,a2=r),s=n.pendingLanes,s===0&&(nd=null),rne(t.stateNode),po(n,Ei()),e!==null)for(i=n.onRecoverableError,t=0;t<e.length;t++)r=e[t],i(r.value,{componentStack:r.stack,digest:r.digest});if(o2)throw o2=!1,n=NE,NE=null,n;return a2&1&&n.tag!==0&&_A(),s=n.pendingLanes,s&1?n===kE?B0++:(B0=0,kE=n):B0=0,Sd(),null}function _A(){if(Yu!==null){var n=AU(a2),e=Na.transition,t=Zn;try{if(Na.transition=null,Zn=16>n?16:n,Yu===null)var i=!1;else{if(n=Yu,Yu=null,a2=0,gn&6)throw Error(Oe(331));var r=gn;for(gn|=4,at=n.current;at!==null;){var s=at,o=s.child;if(at.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(at=c;at!==null;){var g=at;switch(g.tag){case 0:case 11:case 15:v0(8,g,s)}var u=g.child;if(u!==null)u.return=g,at=u;else for(;at!==null;){g=at;var d=g.sibling,h=g.return;if(RQ(g),g===c){at=null;break}if(d!==null){d.return=h,at=d;break}at=h}}}var f=s.alternate;if(f!==null){var I=f.child;if(I!==null){f.child=null;do{var A=I.sibling;I.sibling=null,I=A}while(I!==null)}}at=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,at=o;else e:for(;at!==null;){if(s=at,s.flags&2048)switch(s.tag){case 0:case 11:case 15:v0(9,s,s.return)}var p=s.sibling;if(p!==null){p.return=s.return,at=p;break e}at=s.return}}var y=n.current;for(at=y;at!==null;){o=at;var v=o.child;if(o.subtreeFlags&2064&&v!==null)v.return=o,at=v;else e:for(o=y;at!==null;){if(a=at,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Aw(9,a)}}catch(w){vi(a,a.return,w)}if(a===o){at=null;break e}var b=a.sibling;if(b!==null){b.return=a.return,at=b;break e}at=a.return}}if(gn=r,Sd(),Ac&&typeof Ac.onPostCommitFiberRoot=="function")try{Ac.onPostCommitFiberRoot(lw,n)}catch{}i=!0}return i}finally{Zn=t,Na.transition=e}}return!1}function a9(n,e,t){e=tC(t,e),e=CQ(n,e,1),n=td(n,e,1),e=Ls(),n!==null&&($y(n,1,e),po(n,e))}function vi(n,e,t){if(n.tag===3)a9(n,n,t);else for(;e!==null;){if(e.tag===3){a9(e,n,t);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(nd===null||!nd.has(i))){n=tC(t,n),n=pQ(e,n,1),e=td(e,n,1),n=Ls(),e!==null&&($y(e,1,n),po(e,n));break}}e=e.return}}function Eie(n,e,t){var i=n.pingCache;i!==null&&i.delete(e),e=Ls(),n.pingedLanes|=n.suspendedLanes&t,Cr===n&&(Mr&t)===t&&($i===4||$i===3&&(Mr&130023424)===Mr&&500>Ei()-f_?Dh(n,0):h_|=t),po(n,e)}function kQ(n,e){e===0&&(n.mode&1?(e=Hb,Hb<<=1,!(Hb&130023424)&&(Hb=4194304)):e=1);var t=Ls();n=Lg(n,e),n!==null&&($y(n,e,t),po(n,t))}function Wie(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),kQ(n,t)}function Fie(n,e){var t=0;switch(n.tag){case 13:var i=n.stateNode,r=n.memoizedState;r!==null&&(t=r.retryLane);break;case 19:i=n.stateNode;break;default:throw Error(Oe(314))}i!==null&&i.delete(e),kQ(n,t)}var LQ;LQ=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Ao.current)uo=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return uo=!1,yie(n,e,t);uo=!!(n.flags&131072)}else uo=!1,oi&&e.flags&1048576&&XU(e,q1,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;t1(n,e),n=e.pendingProps;var r=jA(e,us.current);FA(e,t),r=a_(null,e,i,n,r,t);var s=l_();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Co(i)?(s=!0,J1(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,n_(e),r.updater=fw,e.stateNode=r,r._reactInternals=e,xE(e,i,n,t),e=ZE(null,e,i,!0,s,t)):(e.tag=0,oi&&s&&OF(e),Es(null,e,r,t),e=e.child),e;case 16:i=e.elementType;e:{switch(t1(n,e),n=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=Vie(i),n=dl(i,n),r){case 0:e=RE(null,e,i,n,t);break e;case 1:e=jk(null,e,i,n,t);break e;case 11:e=Ok(null,e,i,n,t);break e;case 14:e=Jk(null,e,i,dl(i.type,n),t);break e}throw Error(Oe(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:dl(i,r),RE(n,e,i,r,t);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:dl(i,r),jk(n,e,i,r,t);case 3:e:{if(bQ(e),n===null)throw Error(Oe(387));i=e.pendingProps,s=e.memoizedState,r=s.element,PU(n,e),t2(e,i,null,t);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=tC(Error(Oe(423)),e),e=qk(n,e,i,t,r);break e}else if(i!==r){r=tC(Error(Oe(424)),e),e=qk(n,e,i,t,r);break e}else for(Qo=ed(e.stateNode.containerInfo.firstChild),Jo=e,oi=!0,Il=null,t=JU(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(qA(),i===r){e=Hg(n,e,t);break e}Es(n,e,i,t)}e=e.child}return e;case 5:return jU(e),n===null&&BE(e),i=e.type,r=e.pendingProps,s=n!==null?n.memoizedProps:null,o=r.children,pE(i,r)?o=null:s!==null&&pE(i,s)&&(e.flags|=32),vQ(n,e),Es(n,e,o,t),e.child;case 6:return n===null&&BE(e),null;case 13:return BQ(n,e,t);case 4:return i_(e,e.stateNode.containerInfo),i=e.pendingProps,n===null?e.child=$A(e,null,i,t):Es(n,e,i,t),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:dl(i,r),Ok(n,e,i,r,t);case 7:return Es(n,e,e.pendingProps,t),e.child;case 8:return Es(n,e,e.pendingProps.children,t),e.child;case 12:return Es(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,Xn($1,i._currentValue),i._currentValue=o,s!==null)if(xl(s.value,o)){if(s.children===r.children&&!Ao.current){e=Hg(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=Wg(-1,t&-t),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var g=c.pending;g===null?l.next=l:(l.next=g.next,g.next=l),c.pending=l}}s.lanes|=t,l=s.alternate,l!==null&&(l.lanes|=t),GE(s.return,t,e),a.lanes|=t;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(Oe(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),GE(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Es(n,e,r.children,t),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,FA(e,t),r=Ha(r),i=i(r),e.flags|=1,Es(n,e,i,t),e.child;case 14:return i=e.type,r=dl(i,e.pendingProps),r=dl(i.type,r),Jk(n,e,i,r,t);case 15:return mQ(n,e,e.type,e.pendingProps,t);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:dl(i,r),t1(n,e),e.tag=1,Co(i)?(n=!0,J1(e)):n=!1,FA(e,t),QU(e,i,r),xE(e,i,r,t),ZE(null,e,i,!0,n,t);case 19:return GQ(n,e,t);case 22:return yQ(n,e,t)}throw Error(Oe(156,e.tag))};function HQ(n,e){return dU(n,e)}function _ie(n,e,t,i){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Wa(n,e,t,i){return new _ie(n,e,t,i)}function p_(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Vie(n){if(typeof n=="function")return p_(n)?1:0;if(n!=null){if(n=n.$$typeof,n===NF)return 11;if(n===kF)return 14}return 2}function rd(n,e){var t=n.alternate;return t===null?(t=Wa(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function r1(n,e,t,i,r,s){var o=2;if(i=n,typeof n=="function")p_(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case nA:return Ph(t.children,r,s,e);case TF:o=8,r|=8;break;case JM:return n=Wa(12,t,e,r|2),n.elementType=JM,n.lanes=s,n;case jM:return n=Wa(13,t,e,r),n.elementType=jM,n.lanes=s,n;case qM:return n=Wa(19,t,e,r),n.elementType=qM,n.lanes=s,n;case OP:return pw(t,r,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case UP:o=10;break e;case QP:o=9;break e;case NF:o=11;break e;case kF:o=14;break e;case Vu:o=16,i=null;break e}throw Error(Oe(130,n==null?n:typeof n,""))}return e=Wa(o,t,e,r),e.elementType=n,e.type=i,e.lanes=s,e}function Ph(n,e,t,i){return n=Wa(7,n,i,e),n.lanes=t,n}function pw(n,e,t,i){return n=Wa(22,n,i,e),n.elementType=OP,n.lanes=t,n.stateNode={isHidden:!1},n}function sR(n,e,t){return n=Wa(6,n,null,e),n.lanes=t,n}function oR(n,e,t){return e=Wa(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function Tie(n,e,t,i,r){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=HS(0),this.expirationTimes=HS(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=HS(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function m_(n,e,t,i,r,s,o,a,l){return n=new Tie(n,e,t,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Wa(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:i,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},n_(s),n}function Nie(n,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:tA,key:i==null?null:""+i,children:n,containerInfo:e,implementation:t}}function zQ(n){if(!n)return fd;n=n._reactInternals;e:{if(Gf(n)!==n||n.tag!==1)throw Error(Oe(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Co(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Oe(171))}if(n.tag===1){var t=n.type;if(Co(t))return HU(n,t,e)}return e}function XQ(n,e,t,i,r,s,o,a,l){return n=m_(t,i,!0,n,r,s,o,a,l),n.context=zQ(null),t=n.current,i=Ls(),r=id(t),s=Wg(i,r),s.callback=e??null,td(t,s,r),n.current.lanes=r,$y(n,r,i),po(n,i),n}function mw(n,e,t,i){var r=e.current,s=Ls(),o=id(r);return t=zQ(t),e.context===null?e.context=t:e.pendingContext=t,e=Wg(s,o),e.payload={element:n},i=i===void 0?null:i,i!==null&&(e.callback=i),n=td(r,e,o),n!==null&&(Bl(n,r,o,s),qG(n,r,o)),o}function c2(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function l9(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function y_(n,e){l9(n,e),(n=n.alternate)&&l9(n,e)}function kie(){return null}var YQ=typeof reportError=="function"?reportError:function(n){console.error(n)};function v_(n){this._internalRoot=n}yw.prototype.render=v_.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(Oe(409));mw(n,e,null,null)};yw.prototype.unmount=v_.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;df(function(){mw(null,n,null,null)}),e[kg]=null}};function yw(n){this._internalRoot=n}yw.prototype.unstable_scheduleHydration=function(n){if(n){var e=mU();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Nu.length&&e!==0&&e<Nu[t].priority;t++);Nu.splice(t,0,n),t===0&&vU(n)}};function b_(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function vw(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function c9(){}function Lie(n,e,t,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var c=c2(o);s.call(c)}}var o=XQ(e,i,n,0,null,!1,!1,"",c9);return n._reactRootContainer=o,n[kg]=o.current,ry(n.nodeType===8?n.parentNode:n),df(),o}for(;r=n.lastChild;)n.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var c=c2(l);a.call(c)}}var l=m_(n,0,!1,null,null,!1,!1,"",c9);return n._reactRootContainer=l,n[kg]=l.current,ry(n.nodeType===8?n.parentNode:n),df(function(){mw(e,l,t,i)}),l}function bw(n,e,t,i,r){var s=t._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var l=c2(o);a.call(l)}}mw(e,o,n,r)}else o=Lie(t,e,n,r,i);return c2(o)}CU=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=qm(e.pendingLanes);t!==0&&(zF(e,t|1),po(e,Ei()),!(gn&6)&&(nC=Ei()+500,Sd()))}break;case 13:df(function(){var i=Lg(n,1);if(i!==null){var r=Ls();Bl(i,n,1,r)}}),y_(n,1)}};XF=function(n){if(n.tag===13){var e=Lg(n,134217728);if(e!==null){var t=Ls();Bl(e,n,134217728,t)}y_(n,134217728)}};pU=function(n){if(n.tag===13){var e=id(n),t=Lg(n,e);if(t!==null){var i=Ls();Bl(t,n,e,i)}y_(n,e)}};mU=function(){return Zn};yU=function(n,e){var t=Zn;try{return Zn=n,e()}finally{Zn=t}};lE=function(n,e,t){switch(e){case"input":if(tE(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==n&&i.form===n.form){var r=dw(i);if(!r)throw Error(Oe(90));jP(i),tE(i,r)}}}break;case"textarea":$P(n,t);break;case"select":e=t.value,e!=null&&ZA(n,!!t.multiple,e,!1)}};oU=I_;aU=df;var Hie={usingClientEntryPoint:!1,Events:[tv,oA,dw,rU,sU,I_]},Dp={findFiberByHostInstance:Wh,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},zie={bundleType:Dp.bundleType,version:Dp.version,rendererPackageName:Dp.rendererPackageName,rendererConfig:Dp.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:jg.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=gU(n),n===null?null:n.stateNode},findFiberByHostInstance:Dp.findFiberByHostInstance||kie,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var jb=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!jb.isDisabled&&jb.supportsFiber)try{lw=jb.inject(zie),Ac=jb}catch{}}sa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Hie;sa.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!b_(e))throw Error(Oe(200));return Nie(n,e,null,t)};sa.createRoot=function(n,e){if(!b_(n))throw Error(Oe(299));var t=!1,i="",r=YQ;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=m_(n,1,!1,null,null,t,!1,i,r),n[kg]=e.current,ry(n.nodeType===8?n.parentNode:n),new v_(e)};sa.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Oe(188)):(n=Object.keys(n).join(","),Error(Oe(268,n)));return n=gU(e),n=n===null?null:n.stateNode,n};sa.flushSync=function(n){return df(n)};sa.hydrate=function(n,e,t){if(!vw(e))throw Error(Oe(200));return bw(null,n,e,!0,t)};sa.hydrateRoot=function(n,e,t){if(!b_(n))throw Error(Oe(405));var i=t!=null&&t.hydratedSources||null,r=!1,s="",o=YQ;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=XQ(e,null,n,1,t??null,r,!1,s,o),n[kg]=e.current,ry(n),i)for(n=0;n<i.length;n++)t=i[n],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new yw(e)};sa.render=function(n,e,t){if(!vw(e))throw Error(Oe(200));return bw(null,n,e,!1,t)};sa.unmountComponentAtNode=function(n){if(!vw(n))throw Error(Oe(40));return n._reactRootContainer?(df(function(){bw(null,null,n,!1,function(){n._reactRootContainer=null,n[kg]=null})}),!0):!1};sa.unstable_batchedUpdates=I_;sa.unstable_renderSubtreeIntoContainer=function(n,e,t,i){if(!vw(t))throw Error(Oe(200));if(n==null||n._reactInternals===void 0)throw Error(Oe(38));return bw(n,e,t,!1,i)};sa.version="18.2.0-next-9e3b772b8-20220608";function KQ(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(KQ)}catch(n){console.error(n)}}KQ(),XP.exports=sa;var B_=XP.exports;const DQ=Ks(B_);var PQ,g9=B_;PQ=QM.createRoot=g9.createRoot,QM.hydrateRoot=g9.hydrateRoot;function pt(){return pt=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},pt.apply(this,arguments)}/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const wf="150",Xie={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Yie={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},UQ=0,zE=1,QQ=2,Kie=3,OQ=0,Bw=1,G0=2,Vh=3,wo=0,Bi=1,Di=2,Die=2,ei=0,Uh=1,g2=2,XE=3,YE=4,JQ=5,wh=100,jQ=101,qQ=102,KE=103,DE=104,$Q=200,eO=201,tO=202,nO=203,G_=204,w_=205,iO=206,rO=207,sO=208,oO=209,aO=210,x_=0,S_=1,u2=2,hy=3,fy=4,R_=5,Z_=6,Gw=7,iv=0,lO=1,cO=2,Gl=0,gO=1,uO=2,dO=3,M_=4,hO=5,ww=300,zg=301,Id=302,iC=303,Iy=304,EC=306,ds=1e3,Ki=1001,rC=1002,Zt=1003,Ay=1004,Pie=1004,VA=1005,Uie=1005,ut=1006,xw=1007,Qie=1007,wc=1008,Oie=1008,Dn=1009,fO=1010,IO=1011,E_=1012,AO=1013,Sg=1014,Hn=1015,Pi=1016,CO=1017,pO=1018,sd=1020,mO=1021,Yn=1023,Sw=1024,yO=1025,od=1026,Ad=1027,Rw=1028,vO=1029,W_=1030,bO=1031,BO=1033,s1=33776,o1=33777,a1=33778,l1=33779,PE=35840,UE=35841,QE=35842,OE=35843,GO=36196,JE=37492,jE=37496,qE=37808,$E=37809,e3=37810,t3=37811,n3=37812,i3=37813,r3=37814,s3=37815,o3=37816,a3=37817,l3=37818,c3=37819,g3=37820,u3=37821,c1=36492,wO=36283,d3=36284,h3=36285,f3=36286,xO=2200,SO=2201,RO=2202,sC=2300,hf=2301,g1=2302,Th=2400,Nh=2401,Cy=2402,Zw=2500,F_=2501,Jie=0,ZO=1,__=2,ta=3e3,Xt=3001,pr=3200,Sl=3201,Wc=0,MO=1,EO="",fl="srgb",oC="srgb-linear",V_="display-p3",jie=0,u1=7680,qie=7681,$ie=7682,ere=7683,tre=34055,nre=34056,ire=5386,rre=512,sre=513,ore=514,are=515,lre=516,cre=517,gre=518,WO=519,py=35044,d2=35048,ure=35040,dre=35045,hre=35049,fre=35041,Ire=35046,Are=35050,Cre=35042,pre="100",h2="300 es",f2=1035;let aa=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}};const Or=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let u9=1234567;const Qh=Math.PI/180,my=180/Math.PI;function jo(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Or[n&255]+Or[n>>8&255]+Or[n>>16&255]+Or[n>>24&255]+"-"+Or[e&255]+Or[e>>8&255]+"-"+Or[e>>16&15|64]+Or[e>>24&255]+"-"+Or[t&63|128]+Or[t>>8&255]+"-"+Or[t>>16&255]+Or[t>>24&255]+Or[i&255]+Or[i>>8&255]+Or[i>>16&255]+Or[i>>24&255]).toLowerCase()}function Wi(n,e,t){return Math.max(e,Math.min(t,n))}function T_(n,e){return(n%e+e)%e}function mre(n,e,t,i,r){return i+(n-e)*(r-i)/(t-e)}function yre(n,e,t){return n!==e?(t-n)/(e-n):0}function w0(n,e,t){return(1-t)*n+t*e}function vre(n,e,t,i){return w0(n,e,1-Math.exp(-t*i))}function bre(n,e=1){return e-Math.abs(T_(n,e*2)-e)}function Bre(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function Gre(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function wre(n,e){return n+Math.floor(Math.random()*(e-n+1))}function xre(n,e){return n+Math.random()*(e-n)}function Sre(n){return n*(.5-Math.random())}function Rre(n){n!==void 0&&(u9=n);let e=u9+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function Zre(n){return n*Qh}function Mre(n){return n*my}function I3(n){return(n&n-1)===0&&n!==0}function FO(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function _O(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function Ere(n,e,t,i,r){const s=Math.cos,o=Math.sin,a=s(t/2),l=o(t/2),c=s((e+i)/2),g=o((e+i)/2),u=s((e-i)/2),d=o((e-i)/2),h=s((i-e)/2),f=o((i-e)/2);switch(r){case"XYX":n.set(a*g,l*u,l*d,a*c);break;case"YZY":n.set(l*d,a*g,l*u,a*c);break;case"ZXZ":n.set(l*u,l*d,a*g,a*c);break;case"XZX":n.set(a*g,l*f,l*h,a*c);break;case"YXY":n.set(l*h,a*g,l*f,a*c);break;case"ZYZ":n.set(l*f,l*h,a*g,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function Rg(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Tn(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const ss={DEG2RAD:Qh,RAD2DEG:my,generateUUID:jo,clamp:Wi,euclideanModulo:T_,mapLinear:mre,inverseLerp:yre,lerp:w0,damp:vre,pingpong:bre,smoothstep:Bre,smootherstep:Gre,randInt:wre,randFloat:xre,randFloatSpread:Sre,seededRandom:Rre,degToRad:Zre,radToDeg:Mre,isPowerOfTwo:I3,ceilPowerOfTwo:FO,floorPowerOfTwo:_O,setQuaternionFromProperEuler:Ere,normalize:Tn,denormalize:Rg};let pe=class VO{constructor(e=0,t=0){VO.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*i-o*r+e.x,this.y=s*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Ir=class TO{constructor(){TO.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,r,s,o,a,l,c){const g=this.elements;return g[0]=e,g[1]=r,g[2]=a,g[3]=t,g[4]=s,g[5]=l,g[6]=i,g[7]=o,g[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],g=i[4],u=i[7],d=i[2],h=i[5],f=i[8],I=r[0],A=r[3],p=r[6],y=r[1],v=r[4],b=r[7],w=r[2],G=r[5],x=r[8];return s[0]=o*I+a*y+l*w,s[3]=o*A+a*v+l*G,s[6]=o*p+a*b+l*x,s[1]=c*I+g*y+u*w,s[4]=c*A+g*v+u*G,s[7]=c*p+g*b+u*x,s[2]=d*I+h*y+f*w,s[5]=d*A+h*v+f*G,s[8]=d*p+h*b+f*x,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],g=e[8];return t*o*g-t*a*c-i*s*g+i*a*l+r*s*c-r*o*l}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],g=e[8],u=g*o-a*c,d=a*l-g*s,h=c*s-o*l,f=t*u+i*d+r*h;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);const I=1/f;return e[0]=u*I,e[1]=(r*c-g*i)*I,e[2]=(a*i-r*o)*I,e[3]=d*I,e[4]=(g*t-r*l)*I,e[5]=(r*s-a*t)*I,e[6]=h*I,e[7]=(i*l-c*t)*I,e[8]=(o*t-i*s)*I,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-r*c,r*l,-r*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(aR.makeScale(e,t)),this}rotate(e){return this.premultiply(aR.makeRotation(-e)),this}translate(e,t){return this.premultiply(aR.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const aR=new Ir;function NO(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}const Wre={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function hA(n,e){return new Wre[n](e)}function yy(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}let xn=class{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,o,a){let l=i[r+0],c=i[r+1],g=i[r+2],u=i[r+3];const d=s[o+0],h=s[o+1],f=s[o+2],I=s[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=g,e[t+3]=u;return}if(a===1){e[t+0]=d,e[t+1]=h,e[t+2]=f,e[t+3]=I;return}if(u!==I||l!==d||c!==h||g!==f){let A=1-a;const p=l*d+c*h+g*f+u*I,y=p>=0?1:-1,v=1-p*p;if(v>Number.EPSILON){const w=Math.sqrt(v),G=Math.atan2(w,p*y);A=Math.sin(A*G)/w,a=Math.sin(a*G)/w}const b=a*y;if(l=l*A+d*b,c=c*A+h*b,g=g*A+f*b,u=u*A+I*b,A===1-a){const w=1/Math.sqrt(l*l+c*c+g*g+u*u);l*=w,c*=w,g*=w,u*=w}}e[t]=l,e[t+1]=c,e[t+2]=g,e[t+3]=u}static multiplyQuaternionsFlat(e,t,i,r,s,o){const a=i[r],l=i[r+1],c=i[r+2],g=i[r+3],u=s[o],d=s[o+1],h=s[o+2],f=s[o+3];return e[t]=a*f+g*u+l*h-c*d,e[t+1]=l*f+g*d+c*u-a*h,e[t+2]=c*f+g*h+a*d-l*u,e[t+3]=g*f-a*u-l*d-c*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const i=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),g=a(r/2),u=a(s/2),d=l(i/2),h=l(r/2),f=l(s/2);switch(o){case"XYZ":this._x=d*g*u+c*h*f,this._y=c*h*u-d*g*f,this._z=c*g*f+d*h*u,this._w=c*g*u-d*h*f;break;case"YXZ":this._x=d*g*u+c*h*f,this._y=c*h*u-d*g*f,this._z=c*g*f-d*h*u,this._w=c*g*u+d*h*f;break;case"ZXY":this._x=d*g*u-c*h*f,this._y=c*h*u+d*g*f,this._z=c*g*f+d*h*u,this._w=c*g*u-d*h*f;break;case"ZYX":this._x=d*g*u-c*h*f,this._y=c*h*u+d*g*f,this._z=c*g*f-d*h*u,this._w=c*g*u+d*h*f;break;case"YZX":this._x=d*g*u+c*h*f,this._y=c*h*u+d*g*f,this._z=c*g*f-d*h*u,this._w=c*g*u-d*h*f;break;case"XZY":this._x=d*g*u-c*h*f,this._y=c*h*u-d*g*f,this._z=c*g*f+d*h*u,this._w=c*g*u+d*h*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],c=t[2],g=t[6],u=t[10],d=i+a+u;if(d>0){const h=.5/Math.sqrt(d+1);this._w=.25/h,this._x=(g-l)*h,this._y=(s-c)*h,this._z=(o-r)*h}else if(i>a&&i>u){const h=2*Math.sqrt(1+i-a-u);this._w=(g-l)/h,this._x=.25*h,this._y=(r+o)/h,this._z=(s+c)/h}else if(a>u){const h=2*Math.sqrt(1+a-i-u);this._w=(s-c)/h,this._x=(r+o)/h,this._y=.25*h,this._z=(l+g)/h}else{const h=2*Math.sqrt(1+u-i-a);this._w=(o-r)/h,this._x=(s+c)/h,this._y=(l+g)/h,this._z=.25*h}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Wi(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,o=e._w,a=t._x,l=t._y,c=t._z,g=t._w;return this._x=i*g+o*a+r*c-s*l,this._y=r*g+o*l+s*a-i*c,this._z=s*g+o*c+i*l-r*a,this._w=o*g-i*a-r*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+i*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const h=1-t;return this._w=h*o+t*this._w,this._x=h*i+t*this._x,this._y=h*r+t*this._y,this._z=h*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),g=Math.atan2(c,a),u=Math.sin((1-t)*g)/c,d=Math.sin(t*g)/c;return this._w=o*u+this._w*d,this._x=i*u+this._x*d,this._y=r*u+this._y*d,this._z=s*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(s),i*Math.cos(s),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},D=class kO{constructor(e=0,t=0,i=0){kO.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(d9.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(d9.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,c=l*t+o*r-a*i,g=l*i+a*t-s*r,u=l*r+s*i-o*t,d=-s*t-o*i-a*r;return this.x=c*l+d*-s+g*-a-u*-o,this.y=g*l+d*-o+u*-s-c*-a,this.z=u*l+d*-a+c*-o-g*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=r*l-s*a,this.y=s*o-i*l,this.z=i*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return lR.copy(this).projectOnVector(e),this.sub(lR)}reflect(e){return this.sub(lR.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Wi(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const lR=new D,d9=new xn;function TA(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function cR(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}const Fre=new Ir().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),_re=new Ir().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),Ku=new D;function Vre(n){return n.convertSRGBToLinear(),Ku.set(n.r,n.g,n.b).applyMatrix3(_re),n.setRGB(Ku.x,Ku.y,Ku.z)}function Tre(n){return Ku.set(n.r,n.g,n.b).applyMatrix3(Fre),n.setRGB(Ku.x,Ku.y,Ku.z).convertLinearToSRGB()}const Nre={[oC]:n=>n,[fl]:n=>n.convertSRGBToLinear(),[V_]:Vre},kre={[oC]:n=>n,[fl]:n=>n.convertLinearToSRGB(),[V_]:Tre},es={enabled:!1,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(n){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!n},get workingColorSpace(){return oC},set workingColorSpace(n){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(n,e,t){if(this.enabled===!1||e===t||!e||!t)return n;const i=Nre[e],r=kre[t];if(i===void 0||r===void 0)throw new Error(`Unsupported color space conversion, "${e}" to "${t}".`);return r(i(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this.workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this.workingColorSpace)}};let rI,N_=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{rI===void 0&&(rI=yy("canvas")),rI.width=e.width,rI.height=e.height;const i=rI.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=rI}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=yy("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=TA(s[o]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(TA(t[i]/255)*255):t[i]=TA(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},kh=class{constructor(e=null){this.isSource=!0,this.uuid=jo(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(gR(r[o].image)):s.push(gR(r[o]))}else s=gR(r);i.url=s}return t||(e.images[this.uuid]=i),i}};function gR(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?N_.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Lre=0,Pn=class d1 extends aa{constructor(e=d1.DEFAULT_IMAGE,t=d1.DEFAULT_MAPPING,i=Ki,r=Ki,s=ut,o=wc,a=Yn,l=Dn,c=d1.DEFAULT_ANISOTROPY,g=ta){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Lre++}),this.uuid=jo(),this.name="",this.source=new kh(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new pe(0,0),this.repeat=new pe(1,1),this.center=new pe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ir,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=g,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==ww)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ds:e.x=e.x-Math.floor(e.x);break;case Ki:e.x=e.x<0?0:1;break;case rC:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case ds:e.y=e.y-Math.floor(e.y);break;case Ki:e.y=e.y<0?0:1;break;case rC:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};Pn.DEFAULT_IMAGE=null;Pn.DEFAULT_MAPPING=ww;Pn.DEFAULT_ANISOTROPY=1;let Lt=class LO{constructor(e=0,t=0,i=0,r=1){LO.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s;const l=e.elements,c=l[0],g=l[4],u=l[8],d=l[1],h=l[5],f=l[9],I=l[2],A=l[6],p=l[10];if(Math.abs(g-d)<.01&&Math.abs(u-I)<.01&&Math.abs(f-A)<.01){if(Math.abs(g+d)<.1&&Math.abs(u+I)<.1&&Math.abs(f+A)<.1&&Math.abs(c+h+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const v=(c+1)/2,b=(h+1)/2,w=(p+1)/2,G=(g+d)/4,x=(u+I)/4,B=(f+A)/4;return v>b&&v>w?v<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(v),r=G/i,s=x/i):b>w?b<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(b),i=G/r,s=B/r):w<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(w),i=x/s,r=B/s),this.set(i,r,s,t),this}let y=Math.sqrt((A-f)*(A-f)+(u-I)*(u-I)+(d-g)*(d-g));return Math.abs(y)<.001&&(y=1),this.x=(A-f)/y,this.y=(u-I)/y,this.z=(d-g)/y,this.w=Math.acos((c+h+p-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Qt=class extends aa{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Lt(0,0,e,t),this.scissorTest=!1,this.viewport=new Lt(0,0,e,t);const r={width:e,height:t,depth:1};this.texture=new Pn(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:ut,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new kh(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}};class Mw extends Pn{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Zt,this.minFilter=Zt,this.wrapR=Ki,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Hre extends Qt{constructor(e=1,t=1,i=1){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new Mw(null,e,t,i),this.texture.isRenderTargetTexture=!0}}let Oh=class extends Pn{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Zt,this.minFilter=Zt,this.wrapR=Ki,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};class zre extends Qt{constructor(e=1,t=1,i=1){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new Oh(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class k_ extends Qt{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;const s=this.texture;this.texture=[];for(let o=0;o<i;o++)this.texture[o]=s.clone(),this.texture[o].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,s=this.texture.length;r<s;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}let Us=class{constructor(e=new D(1/0,1/0,1/0),t=new D(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,s=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.length;l<c;l+=3){const g=e[l],u=e[l+1],d=e[l+2];g<t&&(t=g),u<i&&(i=u),d<r&&(r=d),g>s&&(s=g),u>o&&(o=u),d>a&&(a=d)}return this.min.set(t,i,r),this.max.set(s,o,a),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,s=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.count;l<c;l++){const g=e.getX(l),u=e.getY(l),d=e.getZ(l);g<t&&(t=g),u<i&&(i=u),d<r&&(r=d),g>s&&(s=g),u>o&&(o=u),d>a&&(a=d)}return this.min.set(t,i,r),this.max.set(s,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Od.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0)if(t&&i.attributes!=null&&i.attributes.position!==void 0){const s=i.attributes.position;for(let o=0,a=s.count;o<a;o++)Od.fromBufferAttribute(s,o).applyMatrix4(e.matrixWorld),this.expandByPoint(Od)}else i.boundingBox===null&&i.computeBoundingBox(),uR.copy(i.boundingBox),uR.applyMatrix4(e.matrixWorld),this.union(uR);const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Od),Od.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Pp),qb.subVectors(this.max,Pp),sI.subVectors(e.a,Pp),oI.subVectors(e.b,Pp),aI.subVectors(e.c,Pp),pu.subVectors(oI,sI),mu.subVectors(aI,oI),Jd.subVectors(sI,aI);let t=[0,-pu.z,pu.y,0,-mu.z,mu.y,0,-Jd.z,Jd.y,pu.z,0,-pu.x,mu.z,0,-mu.x,Jd.z,0,-Jd.x,-pu.y,pu.x,0,-mu.y,mu.x,0,-Jd.y,Jd.x,0];return!dR(t,sI,oI,aI,qb)||(t=[1,0,0,0,1,0,0,0,1],!dR(t,sI,oI,aI,qb))?!1:($b.crossVectors(pu,mu),t=[$b.x,$b.y,$b.z],dR(t,sI,oI,aI,qb))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Od).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Od).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Qc[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Qc[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Qc[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Qc[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Qc[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Qc[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Qc[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Qc[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Qc),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};const Qc=[new D,new D,new D,new D,new D,new D,new D,new D],Od=new D,uR=new Us,sI=new D,oI=new D,aI=new D,pu=new D,mu=new D,Jd=new D,Pp=new D,qb=new D,$b=new D,jd=new D;function dR(n,e,t,i,r){for(let s=0,o=n.length-3;s<=o;s+=3){jd.fromArray(n,s);const a=r.x*Math.abs(jd.x)+r.y*Math.abs(jd.y)+r.z*Math.abs(jd.z),l=e.dot(jd),c=t.dot(jd),g=i.dot(jd);if(Math.max(-Math.max(l,c,g),Math.min(l,c,g))>a)return!1}return!0}const Xre=new Us,Up=new D,hR=new D;let Zl=class{constructor(e=new D,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):Xre.setFromPoints(e).getCenter(i);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Up.subVectors(e,this.center);const t=Up.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(Up,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(hR.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Up.copy(e.center).add(hR)),this.expandByPoint(Up.copy(e.center).sub(hR))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}};const Oc=new D,fR=new D,eB=new D,yu=new D,IR=new D,tB=new D,AR=new D;let WC=class{constructor(e=new D,t=new D(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Oc)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Oc.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Oc.copy(this.origin).addScaledVector(this.direction,t),Oc.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){fR.copy(e).add(t).multiplyScalar(.5),eB.copy(t).sub(e).normalize(),yu.copy(this.origin).sub(fR);const s=e.distanceTo(t)*.5,o=-this.direction.dot(eB),a=yu.dot(this.direction),l=-yu.dot(eB),c=yu.lengthSq(),g=Math.abs(1-o*o);let u,d,h,f;if(g>0)if(u=o*l-a,d=o*a-l,f=s*g,u>=0)if(d>=-f)if(d<=f){const I=1/g;u*=I,d*=I,h=u*(u+o*d+2*a)+d*(o*u+d+2*l)+c}else d=s,u=Math.max(0,-(o*d+a)),h=-u*u+d*(d+2*l)+c;else d=-s,u=Math.max(0,-(o*d+a)),h=-u*u+d*(d+2*l)+c;else d<=-f?(u=Math.max(0,-(-o*s+a)),d=u>0?-s:Math.min(Math.max(-s,-l),s),h=-u*u+d*(d+2*l)+c):d<=f?(u=0,d=Math.min(Math.max(-s,-l),s),h=d*(d+2*l)+c):(u=Math.max(0,-(o*s+a)),d=u>0?s:Math.min(Math.max(-s,-l),s),h=-u*u+d*(d+2*l)+c);else d=o>0?-s:s,u=Math.max(0,-(o*d+a)),h=-u*u+d*(d+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,u),r&&r.copy(fR).addScaledVector(eB,d),h}intersectSphere(e,t){Oc.subVectors(e.center,this.origin);const i=Oc.dot(this.direction),r=Oc.dot(Oc)-i*i,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,o,a,l;const c=1/this.direction.x,g=1/this.direction.y,u=1/this.direction.z,d=this.origin;return c>=0?(i=(e.min.x-d.x)*c,r=(e.max.x-d.x)*c):(i=(e.max.x-d.x)*c,r=(e.min.x-d.x)*c),g>=0?(s=(e.min.y-d.y)*g,o=(e.max.y-d.y)*g):(s=(e.max.y-d.y)*g,o=(e.min.y-d.y)*g),i>o||s>r||((s>i||isNaN(i))&&(i=s),(o<r||isNaN(r))&&(r=o),u>=0?(a=(e.min.z-d.z)*u,l=(e.max.z-d.z)*u):(a=(e.max.z-d.z)*u,l=(e.min.z-d.z)*u),i>l||a>r)||((a>i||i!==i)&&(i=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,Oc)!==null}intersectTriangle(e,t,i,r,s){IR.subVectors(t,e),tB.subVectors(i,e),AR.crossVectors(IR,tB);let o=this.direction.dot(AR),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;yu.subVectors(this.origin,e);const l=a*this.direction.dot(tB.crossVectors(yu,tB));if(l<0)return null;const c=a*this.direction.dot(IR.cross(yu));if(c<0||l+c>o)return null;const g=-a*yu.dot(AR);return g<0?null:this.at(g/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},qe=class A3{constructor(){A3.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,r,s,o,a,l,c,g,u,d,h,f,I,A){const p=this.elements;return p[0]=e,p[4]=t,p[8]=i,p[12]=r,p[1]=s,p[5]=o,p[9]=a,p[13]=l,p[2]=c,p[6]=g,p[10]=u,p[14]=d,p[3]=h,p[7]=f,p[11]=I,p[15]=A,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new A3().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/lI.setFromMatrixColumn(e,0).length(),s=1/lI.setFromMatrixColumn(e,1).length(),o=1/lI.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,s=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(r),c=Math.sin(r),g=Math.cos(s),u=Math.sin(s);if(e.order==="XYZ"){const d=o*g,h=o*u,f=a*g,I=a*u;t[0]=l*g,t[4]=-l*u,t[8]=c,t[1]=h+f*c,t[5]=d-I*c,t[9]=-a*l,t[2]=I-d*c,t[6]=f+h*c,t[10]=o*l}else if(e.order==="YXZ"){const d=l*g,h=l*u,f=c*g,I=c*u;t[0]=d+I*a,t[4]=f*a-h,t[8]=o*c,t[1]=o*u,t[5]=o*g,t[9]=-a,t[2]=h*a-f,t[6]=I+d*a,t[10]=o*l}else if(e.order==="ZXY"){const d=l*g,h=l*u,f=c*g,I=c*u;t[0]=d-I*a,t[4]=-o*u,t[8]=f+h*a,t[1]=h+f*a,t[5]=o*g,t[9]=I-d*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const d=o*g,h=o*u,f=a*g,I=a*u;t[0]=l*g,t[4]=f*c-h,t[8]=d*c+I,t[1]=l*u,t[5]=I*c+d,t[9]=h*c-f,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const d=o*l,h=o*c,f=a*l,I=a*c;t[0]=l*g,t[4]=I-d*u,t[8]=f*u+h,t[1]=u,t[5]=o*g,t[9]=-a*g,t[2]=-c*g,t[6]=h*u+f,t[10]=d-I*u}else if(e.order==="XZY"){const d=o*l,h=o*c,f=a*l,I=a*c;t[0]=l*g,t[4]=-u,t[8]=c*g,t[1]=d*u+I,t[5]=o*g,t[9]=h*u-f,t[2]=f*u-h,t[6]=a*g,t[10]=I*u+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Yre,e,Kre)}lookAt(e,t,i){const r=this.elements;return ko.subVectors(e,t),ko.lengthSq()===0&&(ko.z=1),ko.normalize(),vu.crossVectors(i,ko),vu.lengthSq()===0&&(Math.abs(i.z)===1?ko.x+=1e-4:ko.z+=1e-4,ko.normalize(),vu.crossVectors(i,ko)),vu.normalize(),nB.crossVectors(ko,vu),r[0]=vu.x,r[4]=nB.x,r[8]=ko.x,r[1]=vu.y,r[5]=nB.y,r[9]=ko.y,r[2]=vu.z,r[6]=nB.z,r[10]=ko.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],g=i[1],u=i[5],d=i[9],h=i[13],f=i[2],I=i[6],A=i[10],p=i[14],y=i[3],v=i[7],b=i[11],w=i[15],G=r[0],x=r[4],B=r[8],R=r[12],Z=r[1],W=r[5],F=r[9],T=r[13],V=r[2],z=r[6],U=r[10],J=r[14],H=r[3],Y=r[7],K=r[11],Q=r[15];return s[0]=o*G+a*Z+l*V+c*H,s[4]=o*x+a*W+l*z+c*Y,s[8]=o*B+a*F+l*U+c*K,s[12]=o*R+a*T+l*J+c*Q,s[1]=g*G+u*Z+d*V+h*H,s[5]=g*x+u*W+d*z+h*Y,s[9]=g*B+u*F+d*U+h*K,s[13]=g*R+u*T+d*J+h*Q,s[2]=f*G+I*Z+A*V+p*H,s[6]=f*x+I*W+A*z+p*Y,s[10]=f*B+I*F+A*U+p*K,s[14]=f*R+I*T+A*J+p*Q,s[3]=y*G+v*Z+b*V+w*H,s[7]=y*x+v*W+b*z+w*Y,s[11]=y*B+v*F+b*U+w*K,s[15]=y*R+v*T+b*J+w*Q,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],c=e[13],g=e[2],u=e[6],d=e[10],h=e[14],f=e[3],I=e[7],A=e[11],p=e[15];return f*(+s*l*u-r*c*u-s*a*d+i*c*d+r*a*h-i*l*h)+I*(+t*l*h-t*c*d+s*o*d-r*o*h+r*c*g-s*l*g)+A*(+t*c*u-t*a*h-s*o*u+i*o*h+s*a*g-i*c*g)+p*(-r*a*g-t*l*u+t*a*d+r*o*u-i*o*d+i*l*g)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],g=e[8],u=e[9],d=e[10],h=e[11],f=e[12],I=e[13],A=e[14],p=e[15],y=u*A*c-I*d*c+I*l*h-a*A*h-u*l*p+a*d*p,v=f*d*c-g*A*c-f*l*h+o*A*h+g*l*p-o*d*p,b=g*I*c-f*u*c+f*a*h-o*I*h-g*a*p+o*u*p,w=f*u*l-g*I*l-f*a*d+o*I*d+g*a*A-o*u*A,G=t*y+i*v+r*b+s*w;if(G===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const x=1/G;return e[0]=y*x,e[1]=(I*d*s-u*A*s-I*r*h+i*A*h+u*r*p-i*d*p)*x,e[2]=(a*A*s-I*l*s+I*r*c-i*A*c-a*r*p+i*l*p)*x,e[3]=(u*l*s-a*d*s-u*r*c+i*d*c+a*r*h-i*l*h)*x,e[4]=v*x,e[5]=(g*A*s-f*d*s+f*r*h-t*A*h-g*r*p+t*d*p)*x,e[6]=(f*l*s-o*A*s-f*r*c+t*A*c+o*r*p-t*l*p)*x,e[7]=(o*d*s-g*l*s+g*r*c-t*d*c-o*r*h+t*l*h)*x,e[8]=b*x,e[9]=(f*u*s-g*I*s-f*i*h+t*I*h+g*i*p-t*u*p)*x,e[10]=(o*I*s-f*a*s+f*i*c-t*I*c-o*i*p+t*a*p)*x,e[11]=(g*a*s-o*u*s-g*i*c+t*u*c+o*i*h-t*a*h)*x,e[12]=w*x,e[13]=(g*I*r-f*u*r+f*i*d-t*I*d-g*i*A+t*u*A)*x,e[14]=(f*a*r-o*I*r-f*i*l+t*I*l+o*i*A-t*a*A)*x,e[15]=(o*u*r-g*a*r+g*i*l-t*u*l-o*i*d+t*a*d)*x,this}scale(e){const t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),s=1-i,o=e.x,a=e.y,l=e.z,c=s*o,g=s*a;return this.set(c*o+i,c*a-r*l,c*l+r*a,0,c*a+r*l,g*a+i,g*l-r*o,0,c*l-r*a,g*l+r*o,s*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,o){return this.set(1,i,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,c=s+s,g=o+o,u=a+a,d=s*c,h=s*g,f=s*u,I=o*g,A=o*u,p=a*u,y=l*c,v=l*g,b=l*u,w=i.x,G=i.y,x=i.z;return r[0]=(1-(I+p))*w,r[1]=(h+b)*w,r[2]=(f-v)*w,r[3]=0,r[4]=(h-b)*G,r[5]=(1-(d+p))*G,r[6]=(A+y)*G,r[7]=0,r[8]=(f+v)*x,r[9]=(A-y)*x,r[10]=(1-(d+I))*x,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let s=lI.set(r[0],r[1],r[2]).length();const o=lI.set(r[4],r[5],r[6]).length(),a=lI.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],el.copy(this);const c=1/s,g=1/o,u=1/a;return el.elements[0]*=c,el.elements[1]*=c,el.elements[2]*=c,el.elements[4]*=g,el.elements[5]*=g,el.elements[6]*=g,el.elements[8]*=u,el.elements[9]*=u,el.elements[10]*=u,t.setFromRotationMatrix(el),i.x=s,i.y=o,i.z=a,this}makePerspective(e,t,i,r,s,o){const a=this.elements,l=2*s/(t-e),c=2*s/(i-r),g=(t+e)/(t-e),u=(i+r)/(i-r),d=-(o+s)/(o-s),h=-2*o*s/(o-s);return a[0]=l,a[4]=0,a[8]=g,a[12]=0,a[1]=0,a[5]=c,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=h,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,i,r,s,o){const a=this.elements,l=1/(t-e),c=1/(i-r),g=1/(o-s),u=(t+e)*l,d=(i+r)*c,h=(o+s)*g;return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=-2*g,a[14]=-h,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}};const lI=new D,el=new qe,Yre=new D(0,0,0),Kre=new D(1,1,1),vu=new D,nB=new D,ko=new D,h9=new qe,f9=new xn;let Hi=class HO{constructor(e=0,t=0,i=0,r=HO.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],l=r[1],c=r[5],g=r[9],u=r[2],d=r[6],h=r[10];switch(t){case"XYZ":this._y=Math.asin(Wi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-g,h),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Wi(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(a,h),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,s),this._z=0);break;case"ZXY":this._x=Math.asin(Wi(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,h),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Wi(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Wi(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-g,c),this._y=Math.atan2(-u,s)):(this._x=0,this._y=Math.atan2(a,h));break;case"XZY":this._z=Math.asin(-Wi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-g,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return h9.makeRotationFromQuaternion(e),this.setFromRotationMatrix(h9,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return f9.setFromEuler(this),this.setFromQuaternion(f9,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Hi.DEFAULT_ORDER="XYZ";let Jh=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},Dre=0;const I9=new D,cI=new xn,Jc=new qe,iB=new D,Qp=new D,Pre=new D,Ure=new xn,A9=new D(1,0,0),C9=new D(0,1,0),p9=new D(0,0,1),Qre={type:"added"},m9={type:"removed"};let In=class h1 extends aa{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Dre++}),this.uuid=jo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=h1.DEFAULT_UP.clone();const e=new D,t=new Hi,i=new xn,r=new D(1,1,1);function s(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(s),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new qe},normalMatrix:{value:new Ir}}),this.matrix=new qe,this.matrixWorld=new qe,this.matrixAutoUpdate=h1.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=h1.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Jh,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return cI.setFromAxisAngle(e,t),this.quaternion.multiply(cI),this}rotateOnWorldAxis(e,t){return cI.setFromAxisAngle(e,t),this.quaternion.premultiply(cI),this}rotateX(e){return this.rotateOnAxis(A9,e)}rotateY(e){return this.rotateOnAxis(C9,e)}rotateZ(e){return this.rotateOnAxis(p9,e)}translateOnAxis(e,t){return I9.copy(e).applyQuaternion(this.quaternion),this.position.add(I9.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(A9,e)}translateY(e){return this.translateOnAxis(C9,e)}translateZ(e){return this.translateOnAxis(p9,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Jc.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?iB.copy(e):iB.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),Qp.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Jc.lookAt(Qp,iB,this.up):Jc.lookAt(iB,Qp,this.up),this.quaternion.setFromRotationMatrix(Jc),r&&(Jc.extractRotation(r.matrixWorld),cI.setFromRotationMatrix(Jc),this.quaternion.premultiply(cI.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Qre)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(m9)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(m9)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Jc.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Jc.multiply(e.parent.matrixWorld)),e.applyMatrix4(Jc),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t){let i=[];this[e]===t&&i.push(this);for(let r=0,s=this.children.length;r<s;r++){const o=this.children[r].getObjectsByProperty(e,t);o.length>0&&(i=i.concat(o))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Qp,e,Pre),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Qp,Ure,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++){const s=t[i];(s.matrixWorldAutoUpdate===!0||e===!0)&&s.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++){const a=r[s];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,g=l.length;c<g;c++){const u=l[c];s(e.shapes,u)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(s(e.materials,this.material[l]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];r.animations.push(s(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),g=o(e.images),u=o(e.shapes),d=o(e.skeletons),h=o(e.animations),f=o(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),g.length>0&&(i.images=g),u.length>0&&(i.shapes=u),d.length>0&&(i.skeletons=d),h.length>0&&(i.animations=h),f.length>0&&(i.nodes=f)}return i.object=r,i;function o(a){const l=[];for(const c in a){const g=a[c];delete g.metadata,l.push(g)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}};In.DEFAULT_UP=new D(0,1,0);In.DEFAULT_MATRIX_AUTO_UPDATE=!0;In.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const tl=new D,jc=new D,CR=new D,qc=new D,gI=new D,uI=new D,y9=new D,pR=new D,mR=new D,yR=new D;let Fg=class jI{constructor(e=new D,t=new D,i=new D){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),tl.subVectors(e,t),r.cross(tl);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){tl.subVectors(r,t),jc.subVectors(i,t),CR.subVectors(e,t);const o=tl.dot(tl),a=tl.dot(jc),l=tl.dot(CR),c=jc.dot(jc),g=jc.dot(CR),u=o*c-a*a;if(u===0)return s.set(-2,-1,-1);const d=1/u,h=(c*l-a*g)*d,f=(o*g-a*l)*d;return s.set(1-h-f,f,h)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,qc),qc.x>=0&&qc.y>=0&&qc.x+qc.y<=1}static getUV(e,t,i,r,s,o,a,l){return this.getBarycoord(e,t,i,r,qc),l.set(0,0),l.addScaledVector(s,qc.x),l.addScaledVector(o,qc.y),l.addScaledVector(a,qc.z),l}static isFrontFacing(e,t,i,r){return tl.subVectors(i,t),jc.subVectors(e,t),tl.cross(jc).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return tl.subVectors(this.c,this.b),jc.subVectors(this.a,this.b),tl.cross(jc).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return jI.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return jI.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,s){return jI.getUV(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return jI.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return jI.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,s=this.c;let o,a;gI.subVectors(r,i),uI.subVectors(s,i),pR.subVectors(e,i);const l=gI.dot(pR),c=uI.dot(pR);if(l<=0&&c<=0)return t.copy(i);mR.subVectors(e,r);const g=gI.dot(mR),u=uI.dot(mR);if(g>=0&&u<=g)return t.copy(r);const d=l*u-g*c;if(d<=0&&l>=0&&g<=0)return o=l/(l-g),t.copy(i).addScaledVector(gI,o);yR.subVectors(e,s);const h=gI.dot(yR),f=uI.dot(yR);if(f>=0&&h<=f)return t.copy(s);const I=h*c-l*f;if(I<=0&&c>=0&&f<=0)return a=c/(c-f),t.copy(i).addScaledVector(uI,a);const A=g*f-h*u;if(A<=0&&u-g>=0&&h-f>=0)return y9.subVectors(s,r),a=(u-g)/(u-g+(h-f)),t.copy(r).addScaledVector(y9,a);const p=1/(A+I+d);return o=I*p,a=d*p,t.copy(i).addScaledVector(gI,o).addScaledVector(uI,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},Ore=0,ai=class extends aa{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Ore++}),this.uuid=jo(),this.name="",this.type="Material",this.blending=Uh,this.side=wo,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=G_,this.blendDst=w_,this.blendEquation=wh,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=hy,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=WO,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=u1,this.stencilZFail=u1,this.stencilZPass=u1,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Uh&&(i.blending=this.blending),this.side!==wo&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(t){const s=r(e.textures),o=r(e.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}};const zO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},nl={h:0,s:0,l:0},rB={h:0,s:0,l:0};function vR(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}let Ke=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=fl){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,es.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=es.workingColorSpace){return this.r=e,this.g=t,this.b=i,es.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=es.workingColorSpace){if(e=T_(e,1),t=Wi(t,0,1),i=Wi(i,0,1),t===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,o=2*i-s;this.r=vR(o,s,e+1/3),this.g=vR(o,s,e),this.b=vR(o,s,e-1/3)}return es.toWorkingColorSpace(this,r),this}setStyle(e,t=fl){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(s[1],10))/255,this.g=Math.min(255,parseInt(s[2],10))/255,this.b=Math.min(255,parseInt(s[3],10))/255,es.toWorkingColorSpace(this,t),i(s[4]),this;if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(s[1],10))/100,this.g=Math.min(100,parseInt(s[2],10))/100,this.b=Math.min(100,parseInt(s[3],10))/100,es.toWorkingColorSpace(this,t),i(s[4]),this;break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){const l=parseFloat(s[1])/360,c=parseFloat(s[2])/100,g=parseFloat(s[3])/100;return i(s[4]),this.setHSL(l,c,g,t)}break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.r=parseInt(s.charAt(0)+s.charAt(0),16)/255,this.g=parseInt(s.charAt(1)+s.charAt(1),16)/255,this.b=parseInt(s.charAt(2)+s.charAt(2),16)/255,es.toWorkingColorSpace(this,t),this;if(o===6)return this.r=parseInt(s.charAt(0)+s.charAt(1),16)/255,this.g=parseInt(s.charAt(2)+s.charAt(3),16)/255,this.b=parseInt(s.charAt(4)+s.charAt(5),16)/255,es.toWorkingColorSpace(this,t),this;console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=fl){const i=zO[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=TA(e.r),this.g=TA(e.g),this.b=TA(e.b),this}copyLinearToSRGB(e){return this.r=cR(e.r),this.g=cR(e.g),this.b=cR(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=fl){return es.fromWorkingColorSpace(Jr.copy(this),e),Wi(Jr.r*255,0,255)<<16^Wi(Jr.g*255,0,255)<<8^Wi(Jr.b*255,0,255)<<0}getHexString(e=fl){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=es.workingColorSpace){es.fromWorkingColorSpace(Jr.copy(this),t);const i=Jr.r,r=Jr.g,s=Jr.b,o=Math.max(i,r,s),a=Math.min(i,r,s);let l,c;const g=(a+o)/2;if(a===o)l=0,c=0;else{const u=o-a;switch(c=g<=.5?u/(o+a):u/(2-o-a),o){case i:l=(r-s)/u+(r<s?6:0);break;case r:l=(s-i)/u+2;break;case s:l=(i-r)/u+4;break}l/=6}return e.h=l,e.s=c,e.l=g,e}getRGB(e,t=es.workingColorSpace){return es.fromWorkingColorSpace(Jr.copy(this),t),e.r=Jr.r,e.g=Jr.g,e.b=Jr.b,e}getStyle(e=fl){es.fromWorkingColorSpace(Jr.copy(this),e);const t=Jr.r,i=Jr.g,r=Jr.b;return e!==fl?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${t*255|0},${i*255|0},${r*255|0})`}offsetHSL(e,t,i){return this.getHSL(nl),nl.h+=e,nl.s+=t,nl.l+=i,this.setHSL(nl.h,nl.s,nl.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(nl),e.getHSL(rB);const i=w0(nl.h,rB.h,t),r=w0(nl.s,rB.s,t),s=w0(nl.l,rB.l,t);return this.setHSL(i,r,s),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const Jr=new Ke;Ke.NAMES=zO;let os=class extends ai{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ke(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=iv,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}};const ki=new D,sB=new pe;let Pt=class{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=py,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)sB.fromBufferAttribute(this,t),sB.applyMatrix3(e),this.setXY(t,sB.x,sB.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)ki.fromBufferAttribute(this,t),ki.applyMatrix3(e),this.setXYZ(t,ki.x,ki.y,ki.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)ki.fromBufferAttribute(this,t),ki.applyMatrix4(e),this.setXYZ(t,ki.x,ki.y,ki.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ki.fromBufferAttribute(this,t),ki.applyNormalMatrix(e),this.setXYZ(t,ki.x,ki.y,ki.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ki.fromBufferAttribute(this,t),ki.transformDirection(e),this.setXYZ(t,ki.x,ki.y,ki.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Rg(t,this.array)),t}setX(e,t){return this.normalized&&(t=Tn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Rg(t,this.array)),t}setY(e,t){return this.normalized&&(t=Tn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Rg(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Tn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Rg(t,this.array)),t}setW(e,t){return this.normalized&&(t=Tn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Tn(t,this.array),i=Tn(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=Tn(t,this.array),i=Tn(i,this.array),r=Tn(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=Tn(t,this.array),i=Tn(i,this.array),r=Tn(r,this.array),s=Tn(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==py&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}};class Jre extends Pt{constructor(e,t,i){super(new Int8Array(e),t,i)}}class jre extends Pt{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class qre extends Pt{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class $re extends Pt{constructor(e,t,i){super(new Int16Array(e),t,i)}}let L_=class extends Pt{constructor(e,t,i){super(new Uint16Array(e),t,i)}};class ese extends Pt{constructor(e,t,i){super(new Int32Array(e),t,i)}}let H_=class extends Pt{constructor(e,t,i){super(new Uint32Array(e),t,i)}};class tse extends Pt{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}}let ht=class extends Pt{constructor(e,t,i){super(new Float32Array(e),t,i)}};class nse extends Pt{constructor(e,t,i){super(new Float64Array(e),t,i)}}let ise=0;const pa=new qe,bR=new In,dI=new D,Lo=new Us,Op=new Us,gr=new D;let Et=class XO extends aa{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:ise++}),this.uuid=jo(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(NO(e)?H_:L_)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new Ir().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return pa.makeRotationFromQuaternion(e),this.applyMatrix4(pa),this}rotateX(e){return pa.makeRotationX(e),this.applyMatrix4(pa),this}rotateY(e){return pa.makeRotationY(e),this.applyMatrix4(pa),this}rotateZ(e){return pa.makeRotationZ(e),this.applyMatrix4(pa),this}translate(e,t,i){return pa.makeTranslation(e,t,i),this.applyMatrix4(pa),this}scale(e,t,i){return pa.makeScale(e,t,i),this.applyMatrix4(pa),this}lookAt(e){return bR.lookAt(e),bR.updateMatrix(),this.applyMatrix4(bR.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(dI).negate(),this.translate(dI.x,dI.y,dI.z),this}setFromPoints(e){const t=[];for(let i=0,r=e.length;i<r;i++){const s=e[i];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new ht(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Us);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new D(-1/0,-1/0,-1/0),new D(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){const s=t[i];Lo.setFromBufferAttribute(s),this.morphTargetsRelative?(gr.addVectors(this.boundingBox.min,Lo.min),this.boundingBox.expandByPoint(gr),gr.addVectors(this.boundingBox.max,Lo.max),this.boundingBox.expandByPoint(gr)):(this.boundingBox.expandByPoint(Lo.min),this.boundingBox.expandByPoint(Lo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Zl);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new D,1/0);return}if(e){const i=this.boundingSphere.center;if(Lo.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];Op.setFromBufferAttribute(a),this.morphTargetsRelative?(gr.addVectors(Lo.min,Op.min),Lo.expandByPoint(gr),gr.addVectors(Lo.max,Op.max),Lo.expandByPoint(gr)):(Lo.expandByPoint(Op.min),Lo.expandByPoint(Op.max))}Lo.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)gr.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(gr));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let c=0,g=a.count;c<g;c++)gr.fromBufferAttribute(a,c),l&&(dI.fromBufferAttribute(e,c),gr.add(dI)),r=Math.max(r,i.distanceToSquared(gr))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.array,r=t.position.array,s=t.normal.array,o=t.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Pt(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],g=[];for(let Z=0;Z<a;Z++)c[Z]=new D,g[Z]=new D;const u=new D,d=new D,h=new D,f=new pe,I=new pe,A=new pe,p=new D,y=new D;function v(Z,W,F){u.fromArray(r,Z*3),d.fromArray(r,W*3),h.fromArray(r,F*3),f.fromArray(o,Z*2),I.fromArray(o,W*2),A.fromArray(o,F*2),d.sub(u),h.sub(u),I.sub(f),A.sub(f);const T=1/(I.x*A.y-A.x*I.y);isFinite(T)&&(p.copy(d).multiplyScalar(A.y).addScaledVector(h,-I.y).multiplyScalar(T),y.copy(h).multiplyScalar(I.x).addScaledVector(d,-A.x).multiplyScalar(T),c[Z].add(p),c[W].add(p),c[F].add(p),g[Z].add(y),g[W].add(y),g[F].add(y))}let b=this.groups;b.length===0&&(b=[{start:0,count:i.length}]);for(let Z=0,W=b.length;Z<W;++Z){const F=b[Z],T=F.start,V=F.count;for(let z=T,U=T+V;z<U;z+=3)v(i[z+0],i[z+1],i[z+2])}const w=new D,G=new D,x=new D,B=new D;function R(Z){x.fromArray(s,Z*3),B.copy(x);const W=c[Z];w.copy(W),w.sub(x.multiplyScalar(x.dot(W))).normalize(),G.crossVectors(B,W);const T=G.dot(g[Z])<0?-1:1;l[Z*4]=w.x,l[Z*4+1]=w.y,l[Z*4+2]=w.z,l[Z*4+3]=T}for(let Z=0,W=b.length;Z<W;++Z){const F=b[Z],T=F.start,V=F.count;for(let z=T,U=T+V;z<U;z+=3)R(i[z+0]),R(i[z+1]),R(i[z+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Pt(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let d=0,h=i.count;d<h;d++)i.setXYZ(d,0,0,0);const r=new D,s=new D,o=new D,a=new D,l=new D,c=new D,g=new D,u=new D;if(e)for(let d=0,h=e.count;d<h;d+=3){const f=e.getX(d+0),I=e.getX(d+1),A=e.getX(d+2);r.fromBufferAttribute(t,f),s.fromBufferAttribute(t,I),o.fromBufferAttribute(t,A),g.subVectors(o,s),u.subVectors(r,s),g.cross(u),a.fromBufferAttribute(i,f),l.fromBufferAttribute(i,I),c.fromBufferAttribute(i,A),a.add(g),l.add(g),c.add(g),i.setXYZ(f,a.x,a.y,a.z),i.setXYZ(I,l.x,l.y,l.z),i.setXYZ(A,c.x,c.y,c.z)}else for(let d=0,h=t.count;d<h;d+=3)r.fromBufferAttribute(t,d+0),s.fromBufferAttribute(t,d+1),o.fromBufferAttribute(t,d+2),g.subVectors(o,s),u.subVectors(r,s),g.cross(u),i.setXYZ(d+0,g.x,g.y,g.z),i.setXYZ(d+1,g.x,g.y,g.z),i.setXYZ(d+2,g.x,g.y,g.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)gr.fromBufferAttribute(e,t),gr.normalize(),e.setXYZ(t,gr.x,gr.y,gr.z)}toNonIndexed(){function e(a,l){const c=a.array,g=a.itemSize,u=a.normalized,d=new c.constructor(l.length*g);let h=0,f=0;for(let I=0,A=l.length;I<A;I++){a.isInterleavedBufferAttribute?h=l[I]*a.data.stride+a.offset:h=l[I]*g;for(let p=0;p<g;p++)d[f++]=c[h++]}return new Pt(d,g,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new XO,i=this.index.array,r=this.attributes;for(const a in r){const l=r[a],c=e(l,i);t.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let g=0,u=c.length;g<u;g++){const d=c[g],h=e(d,i);l.push(h)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],g=[];for(let u=0,d=c.length;u<d;u++){const h=c[u];g.push(h.toJSON(e.data))}g.length>0&&(r[l]=g,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const r=e.attributes;for(const c in r){const g=r[c];this.setAttribute(c,g.clone(t))}const s=e.morphAttributes;for(const c in s){const g=[],u=s[c];for(let d=0,h=u.length;d<h;d++)g.push(u[d].clone(t));this.morphAttributes[c]=g}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,g=o.length;c<g;c++){const u=o[c];this.addGroup(u.start,u.count,u.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const v9=new qe,Dl=new WC,oB=new Zl,b9=new D,Jp=new D,jp=new D,qp=new D,BR=new D,aB=new D,lB=new pe,cB=new pe,gB=new pe,GR=new D,uB=new D;let Rn=class extends In{constructor(e=new Et,t=new os){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const i=this.geometry,r=i.attributes.position,s=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(s&&a){aB.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const g=a[l],u=s[l];g!==0&&(BR.fromBufferAttribute(u,e),o?aB.addScaledVector(BR,g):aB.addScaledVector(BR.sub(t),g))}t.add(aB)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){const i=this.geometry,r=this.material,s=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),oB.copy(i.boundingSphere),oB.applyMatrix4(s),Dl.copy(e.ray).recast(e.near),oB.containsPoint(Dl.origin)===!1&&(Dl.intersectSphere(oB,b9)===null||Dl.origin.distanceToSquared(b9)>(e.far-e.near)**2))||(v9.copy(s).invert(),Dl.copy(e.ray).applyMatrix4(v9),i.boundingBox!==null&&Dl.intersectsBox(i.boundingBox)===!1))return;let o;const a=i.index,l=i.attributes.position,c=i.attributes.uv,g=i.attributes.uv2,u=i.groups,d=i.drawRange;if(a!==null)if(Array.isArray(r))for(let h=0,f=u.length;h<f;h++){const I=u[h],A=r[I.materialIndex],p=Math.max(I.start,d.start),y=Math.min(a.count,Math.min(I.start+I.count,d.start+d.count));for(let v=p,b=y;v<b;v+=3){const w=a.getX(v),G=a.getX(v+1),x=a.getX(v+2);o=dB(this,A,e,Dl,c,g,w,G,x),o&&(o.faceIndex=Math.floor(v/3),o.face.materialIndex=I.materialIndex,t.push(o))}}else{const h=Math.max(0,d.start),f=Math.min(a.count,d.start+d.count);for(let I=h,A=f;I<A;I+=3){const p=a.getX(I),y=a.getX(I+1),v=a.getX(I+2);o=dB(this,r,e,Dl,c,g,p,y,v),o&&(o.faceIndex=Math.floor(I/3),t.push(o))}}else if(l!==void 0)if(Array.isArray(r))for(let h=0,f=u.length;h<f;h++){const I=u[h],A=r[I.materialIndex],p=Math.max(I.start,d.start),y=Math.min(l.count,Math.min(I.start+I.count,d.start+d.count));for(let v=p,b=y;v<b;v+=3){const w=v,G=v+1,x=v+2;o=dB(this,A,e,Dl,c,g,w,G,x),o&&(o.faceIndex=Math.floor(v/3),o.face.materialIndex=I.materialIndex,t.push(o))}}else{const h=Math.max(0,d.start),f=Math.min(l.count,d.start+d.count);for(let I=h,A=f;I<A;I+=3){const p=I,y=I+1,v=I+2;o=dB(this,r,e,Dl,c,g,p,y,v),o&&(o.faceIndex=Math.floor(I/3),t.push(o))}}}};function rse(n,e,t,i,r,s,o,a){let l;if(e.side===Bi?l=i.intersectTriangle(o,s,r,!0,a):l=i.intersectTriangle(r,s,o,e.side===wo,a),l===null)return null;uB.copy(a),uB.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(uB);return c<t.near||c>t.far?null:{distance:c,point:uB.clone(),object:n}}function dB(n,e,t,i,r,s,o,a,l){n.getVertexPosition(o,Jp),n.getVertexPosition(a,jp),n.getVertexPosition(l,qp);const c=rse(n,e,t,i,Jp,jp,qp,GR);if(c){r&&(lB.fromBufferAttribute(r,o),cB.fromBufferAttribute(r,a),gB.fromBufferAttribute(r,l),c.uv=Fg.getUV(GR,Jp,jp,qp,lB,cB,gB,new pe)),s&&(lB.fromBufferAttribute(s,o),cB.fromBufferAttribute(s,a),gB.fromBufferAttribute(s,l),c.uv2=Fg.getUV(GR,Jp,jp,qp,lB,cB,gB,new pe));const g={a:o,b:a,c:l,normal:new D,materialIndex:0};Fg.getNormal(Jp,jp,qp,g.normal),c.face=g}return c}let FC=class YO extends Et{constructor(e=1,t=1,i=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],c=[],g=[],u=[];let d=0,h=0;f("z","y","x",-1,-1,i,t,e,o,s,0),f("z","y","x",1,-1,i,t,-e,o,s,1),f("x","z","y",1,1,e,i,t,r,o,2),f("x","z","y",1,-1,e,i,-t,r,o,3),f("x","y","z",1,-1,e,t,i,r,s,4),f("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(l),this.setAttribute("position",new ht(c,3)),this.setAttribute("normal",new ht(g,3)),this.setAttribute("uv",new ht(u,2));function f(I,A,p,y,v,b,w,G,x,B,R){const Z=b/x,W=w/B,F=b/2,T=w/2,V=G/2,z=x+1,U=B+1;let J=0,H=0;const Y=new D;for(let K=0;K<U;K++){const Q=K*W-T;for(let P=0;P<z;P++){const ne=P*Z-F;Y[I]=ne*y,Y[A]=Q*v,Y[p]=V,c.push(Y.x,Y.y,Y.z),Y[I]=0,Y[A]=0,Y[p]=G>0?1:-1,g.push(Y.x,Y.y,Y.z),u.push(P/x),u.push(1-K/B),J+=1}}for(let K=0;K<B;K++)for(let Q=0;Q<x;Q++){const P=d+Q+z*K,ne=d+Q+z*(K+1),oe=d+(Q+1)+z*(K+1),$=d+(Q+1)+z*K;l.push(P,ne,$),l.push(ne,oe,$),H+=6}a.addGroup(h,H,R),h+=H,d+=J}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new YO(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function aC(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[t][i]=r.clone():Array.isArray(r)?e[t][i]=r.slice():e[t][i]=r}}return e}function Zs(n){const e={};for(let t=0;t<n.length;t++){const i=aC(n[t]);for(const r in i)e[r]=i[r]}return e}function sse(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function KO(n){return n.getRenderTarget()===null&&n.outputEncoding===Xt?fl:oC}const Ew={clone:aC,merge:Zs};var ose=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,ase=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;let Nt=class extends ai{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=ose,this.fragmentShader=ase,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=aC(e.uniforms),this.uniformsGroups=sse(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}},_C=class extends In{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new qe,this.projectionMatrix=new qe,this.projectionMatrixInverse=new qe}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},zn=class extends _C{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=my*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Qh*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return my*2*Math.atan(Math.tan(Qh*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Qh*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*r/l,t-=o.offsetY*i/c,r*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};const hI=-90,fI=1;let z_=class extends In{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;const r=new zn(hI,fI,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);const s=new zn(hI,fI,e,t);s.layers=this.layers,s.up.set(0,1,0),s.lookAt(-1,0,0),this.add(s);const o=new zn(hI,fI,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(0,1,0),this.add(o);const a=new zn(hI,fI,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);const l=new zn(hI,fI,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,1),this.add(l);const c=new zn(hI,fI,e,t);c.layers=this.layers,c.up.set(0,1,0),c.lookAt(0,0,-1),this.add(c)}update(e,t){this.parent===null&&this.updateMatrixWorld();const i=this.renderTarget,[r,s,o,a,l,c]=this.children,g=e.getRenderTarget(),u=e.toneMapping,d=e.xr.enabled;e.toneMapping=Gl,e.xr.enabled=!1;const h=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,s),e.setRenderTarget(i,2),e.render(t,o),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,l),i.texture.generateMipmaps=h,e.setRenderTarget(i,5),e.render(t,c),e.setRenderTarget(g),e.toneMapping=u,e.xr.enabled=d,i.texture.needsPMREMUpdate=!0}},rv=class extends Pn{constructor(e,t,i,r,s,o,a,l,c,g){e=e!==void 0?e:[],t=t!==void 0?t:zg,super(e,t,i,r,s,o,a,l,c,g),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},sv=class extends Qt{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new rv(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:ut}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new FC(5,5,5),s=new Nt({name:"CubemapFromEquirect",uniforms:aC(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Bi,blending:ei});s.uniforms.tEquirect.value=t;const o=new Rn(r,s),a=t.minFilter;return t.minFilter===wc&&(t.minFilter=ut),new z_(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,r);e.setRenderTarget(s)}};const wR=new D,lse=new D,cse=new Ir;class ic{constructor(e=new D(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=wR.subVectors(i,t).cross(lse.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(wR),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||cse.getNormalMatrix(e),r=this.coplanarPoint(wR).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const II=new Zl,hB=new D;class Ww{constructor(e=new ic,t=new ic,i=new ic,r=new ic,s=new ic,o=new ic){this.planes=[e,t,i,r,s,o]}set(e,t,i,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,r=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],g=i[6],u=i[7],d=i[8],h=i[9],f=i[10],I=i[11],A=i[12],p=i[13],y=i[14],v=i[15];return t[0].setComponents(a-r,u-l,I-d,v-A).normalize(),t[1].setComponents(a+r,u+l,I+d,v+A).normalize(),t[2].setComponents(a+s,u+c,I+h,v+p).normalize(),t[3].setComponents(a-s,u-c,I-h,v-p).normalize(),t[4].setComponents(a-o,u-g,I-f,v-y).normalize(),t[5].setComponents(a+o,u+g,I+f,v+y).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),II.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(II)}intersectsSprite(e){return II.center.set(0,0,0),II.radius=.7071067811865476,II.applyMatrix4(e.matrixWorld),this.intersectsSphere(II)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(hB.x=r.normal.x>0?e.max.x:e.min.x,hB.y=r.normal.y>0?e.max.y:e.min.y,hB.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(hB)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function DO(){let n=null,e=!1,t=null,i=null;function r(s,o){t(s,o),i=n.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function gse(n,e){const t=e.isWebGL2,i=new WeakMap;function r(c,g){const u=c.array,d=c.usage,h=n.createBuffer();n.bindBuffer(g,h),n.bufferData(g,u,d),c.onUploadCallback();let f;if(u instanceof Float32Array)f=5126;else if(u instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(t)f=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else f=5123;else if(u instanceof Int16Array)f=5122;else if(u instanceof Uint32Array)f=5125;else if(u instanceof Int32Array)f=5124;else if(u instanceof Int8Array)f=5120;else if(u instanceof Uint8Array)f=5121;else if(u instanceof Uint8ClampedArray)f=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:h,type:f,bytesPerElement:u.BYTES_PER_ELEMENT,version:c.version}}function s(c,g,u){const d=g.array,h=g.updateRange;n.bindBuffer(u,c),h.count===-1?n.bufferSubData(u,0,d):(t?n.bufferSubData(u,h.offset*d.BYTES_PER_ELEMENT,d,h.offset,h.count):n.bufferSubData(u,h.offset*d.BYTES_PER_ELEMENT,d.subarray(h.offset,h.offset+h.count)),h.count=-1),g.onUploadCallback()}function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),i.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const g=i.get(c);g&&(n.deleteBuffer(g.buffer),i.delete(c))}function l(c,g){if(c.isGLBufferAttribute){const d=i.get(c);(!d||d.version<c.version)&&i.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const u=i.get(c);u===void 0?i.set(c,r(c,g)):u.version<c.version&&(s(u.buffer,c,g),u.version=c.version)}return{get:o,remove:a,update:l}}class Fc extends Et{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(i),l=Math.floor(r),c=a+1,g=l+1,u=e/a,d=t/l,h=[],f=[],I=[],A=[];for(let p=0;p<g;p++){const y=p*d-o;for(let v=0;v<c;v++){const b=v*u-s;f.push(b,-y,0),I.push(0,0,1),A.push(v/a),A.push(1-p/l)}}for(let p=0;p<l;p++)for(let y=0;y<a;y++){const v=y+c*p,b=y+c*(p+1),w=y+1+c*(p+1),G=y+1+c*p;h.push(v,b,G),h.push(b,w,G)}this.setIndex(h),this.setAttribute("position",new ht(f,3)),this.setAttribute("normal",new ht(I,3)),this.setAttribute("uv",new ht(A,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Fc(e.width,e.height,e.widthSegments,e.heightSegments)}}var use=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,dse=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,hse=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,fse=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Ise=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Ase=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Cse="vec3 transformed = vec3( position );",pse=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,mse=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,yse=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,vse=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,bse=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,Bse=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Gse=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,wse=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,xse=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Sse=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Rse=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Zse=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Mse=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,Ese=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Wse=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Fse=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,_se=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,Vse=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Tse=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Nse="gl_FragColor = linearToOutputTexel( gl_FragColor );",kse=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Lse=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Hse=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,zse=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Xse=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Yse=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Kse=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Dse=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Pse=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Use=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Qse=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Ose=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Jse=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,jse=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,qse=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,$se=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,eoe=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,toe=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,noe=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,ioe=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,roe=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,soe=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,ooe=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,aoe=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,loe=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,coe=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,goe=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,uoe=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,doe=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,hoe=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,foe=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Ioe=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Aoe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Coe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,poe=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,moe=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,yoe=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,voe=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,boe=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,Boe=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,Goe=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,woe=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,xoe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Soe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Roe=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Zoe=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,Moe=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,Eoe=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,Woe=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,Foe=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,_oe=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Voe=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,Toe=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Noe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,koe=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Loe=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Hoe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,zoe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Xoe=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,Yoe=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Koe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Doe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Poe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Uoe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,Qoe=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Ooe=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Joe=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,joe=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,qoe=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,$oe=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,eae=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,tae=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, vec2 fullSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		
		vec2 lodFudge = pow( 1.95, lod ) / fullSize;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec2 fullSize = vec2( textureSize( sampler, 0 ) );
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), fullSize, floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), fullSize, ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,nae=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,iae=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,rae=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,sae=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,oae=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,aae=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,lae=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const cae=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,gae=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,uae=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,dae=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,hae=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fae=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Iae=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Aae=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,Cae=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,pae=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,mae=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,yae=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,vae=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,bae=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Bae=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Gae=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,wae=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,xae=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Sae=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Rae=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Zae=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Mae=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Eae=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Wae=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Fae=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,_ae=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Vae=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Tae=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Nae=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,kae=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Lae=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Hae=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,zae=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Xae=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,bt={alphamap_fragment:use,alphamap_pars_fragment:dse,alphatest_fragment:hse,alphatest_pars_fragment:fse,aomap_fragment:Ise,aomap_pars_fragment:Ase,begin_vertex:Cse,beginnormal_vertex:pse,bsdfs:mse,iridescence_fragment:yse,bumpmap_pars_fragment:vse,clipping_planes_fragment:bse,clipping_planes_pars_fragment:Bse,clipping_planes_pars_vertex:Gse,clipping_planes_vertex:wse,color_fragment:xse,color_pars_fragment:Sse,color_pars_vertex:Rse,color_vertex:Zse,common:Mse,cube_uv_reflection_fragment:Ese,defaultnormal_vertex:Wse,displacementmap_pars_vertex:Fse,displacementmap_vertex:_se,emissivemap_fragment:Vse,emissivemap_pars_fragment:Tse,encodings_fragment:Nse,encodings_pars_fragment:kse,envmap_fragment:Lse,envmap_common_pars_fragment:Hse,envmap_pars_fragment:zse,envmap_pars_vertex:Xse,envmap_physical_pars_fragment:eoe,envmap_vertex:Yse,fog_vertex:Kse,fog_pars_vertex:Dse,fog_fragment:Pse,fog_pars_fragment:Use,gradientmap_pars_fragment:Qse,lightmap_fragment:Ose,lightmap_pars_fragment:Jse,lights_lambert_fragment:jse,lights_lambert_pars_fragment:qse,lights_pars_begin:$se,lights_toon_fragment:toe,lights_toon_pars_fragment:noe,lights_phong_fragment:ioe,lights_phong_pars_fragment:roe,lights_physical_fragment:soe,lights_physical_pars_fragment:ooe,lights_fragment_begin:aoe,lights_fragment_maps:loe,lights_fragment_end:coe,logdepthbuf_fragment:goe,logdepthbuf_pars_fragment:uoe,logdepthbuf_pars_vertex:doe,logdepthbuf_vertex:hoe,map_fragment:foe,map_pars_fragment:Ioe,map_particle_fragment:Aoe,map_particle_pars_fragment:Coe,metalnessmap_fragment:poe,metalnessmap_pars_fragment:moe,morphcolor_vertex:yoe,morphnormal_vertex:voe,morphtarget_pars_vertex:boe,morphtarget_vertex:Boe,normal_fragment_begin:Goe,normal_fragment_maps:woe,normal_pars_fragment:xoe,normal_pars_vertex:Soe,normal_vertex:Roe,normalmap_pars_fragment:Zoe,clearcoat_normal_fragment_begin:Moe,clearcoat_normal_fragment_maps:Eoe,clearcoat_pars_fragment:Woe,iridescence_pars_fragment:Foe,output_fragment:_oe,packing:Voe,premultiplied_alpha_fragment:Toe,project_vertex:Noe,dithering_fragment:koe,dithering_pars_fragment:Loe,roughnessmap_fragment:Hoe,roughnessmap_pars_fragment:zoe,shadowmap_pars_fragment:Xoe,shadowmap_pars_vertex:Yoe,shadowmap_vertex:Koe,shadowmask_pars_fragment:Doe,skinbase_vertex:Poe,skinning_pars_vertex:Uoe,skinning_vertex:Qoe,skinnormal_vertex:Ooe,specularmap_fragment:Joe,specularmap_pars_fragment:joe,tonemapping_fragment:qoe,tonemapping_pars_fragment:$oe,transmission_fragment:eae,transmission_pars_fragment:tae,uv_pars_fragment:nae,uv_pars_vertex:iae,uv_vertex:rae,uv2_pars_fragment:sae,uv2_pars_vertex:oae,uv2_vertex:aae,worldpos_vertex:lae,background_vert:cae,background_frag:gae,backgroundCube_vert:uae,backgroundCube_frag:dae,cube_vert:hae,cube_frag:fae,depth_vert:Iae,depth_frag:Aae,distanceRGBA_vert:Cae,distanceRGBA_frag:pae,equirect_vert:mae,equirect_frag:yae,linedashed_vert:vae,linedashed_frag:bae,meshbasic_vert:Bae,meshbasic_frag:Gae,meshlambert_vert:wae,meshlambert_frag:xae,meshmatcap_vert:Sae,meshmatcap_frag:Rae,meshnormal_vert:Zae,meshnormal_frag:Mae,meshphong_vert:Eae,meshphong_frag:Wae,meshphysical_vert:Fae,meshphysical_frag:_ae,meshtoon_vert:Vae,meshtoon_frag:Tae,points_vert:Nae,points_frag:kae,shadow_vert:Lae,shadow_frag:Hae,sprite_vert:zae,sprite_frag:Xae},tt={common:{diffuse:{value:new Ke(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ir},uv2Transform:{value:new Ir},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new pe(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ke(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ke(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ir}},sprite:{diffuse:{value:new Ke(16777215)},opacity:{value:1},center:{value:new pe(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ir}}},Al={basic:{uniforms:Zs([tt.common,tt.specularmap,tt.envmap,tt.aomap,tt.lightmap,tt.fog]),vertexShader:bt.meshbasic_vert,fragmentShader:bt.meshbasic_frag},lambert:{uniforms:Zs([tt.common,tt.specularmap,tt.envmap,tt.aomap,tt.lightmap,tt.emissivemap,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.fog,tt.lights,{emissive:{value:new Ke(0)}}]),vertexShader:bt.meshlambert_vert,fragmentShader:bt.meshlambert_frag},phong:{uniforms:Zs([tt.common,tt.specularmap,tt.envmap,tt.aomap,tt.lightmap,tt.emissivemap,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.fog,tt.lights,{emissive:{value:new Ke(0)},specular:{value:new Ke(1118481)},shininess:{value:30}}]),vertexShader:bt.meshphong_vert,fragmentShader:bt.meshphong_frag},standard:{uniforms:Zs([tt.common,tt.envmap,tt.aomap,tt.lightmap,tt.emissivemap,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.roughnessmap,tt.metalnessmap,tt.fog,tt.lights,{emissive:{value:new Ke(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:bt.meshphysical_vert,fragmentShader:bt.meshphysical_frag},toon:{uniforms:Zs([tt.common,tt.aomap,tt.lightmap,tt.emissivemap,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.gradientmap,tt.fog,tt.lights,{emissive:{value:new Ke(0)}}]),vertexShader:bt.meshtoon_vert,fragmentShader:bt.meshtoon_frag},matcap:{uniforms:Zs([tt.common,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.fog,{matcap:{value:null}}]),vertexShader:bt.meshmatcap_vert,fragmentShader:bt.meshmatcap_frag},points:{uniforms:Zs([tt.points,tt.fog]),vertexShader:bt.points_vert,fragmentShader:bt.points_frag},dashed:{uniforms:Zs([tt.common,tt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:bt.linedashed_vert,fragmentShader:bt.linedashed_frag},depth:{uniforms:Zs([tt.common,tt.displacementmap]),vertexShader:bt.depth_vert,fragmentShader:bt.depth_frag},normal:{uniforms:Zs([tt.common,tt.bumpmap,tt.normalmap,tt.displacementmap,{opacity:{value:1}}]),vertexShader:bt.meshnormal_vert,fragmentShader:bt.meshnormal_frag},sprite:{uniforms:Zs([tt.sprite,tt.fog]),vertexShader:bt.sprite_vert,fragmentShader:bt.sprite_frag},background:{uniforms:{uvTransform:{value:new Ir},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:bt.background_vert,fragmentShader:bt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:bt.backgroundCube_vert,fragmentShader:bt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:bt.cube_vert,fragmentShader:bt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:bt.equirect_vert,fragmentShader:bt.equirect_frag},distanceRGBA:{uniforms:Zs([tt.common,tt.displacementmap,{referencePosition:{value:new D},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:bt.distanceRGBA_vert,fragmentShader:bt.distanceRGBA_frag},shadow:{uniforms:Zs([tt.lights,tt.fog,{color:{value:new Ke(0)},opacity:{value:1}}]),vertexShader:bt.shadow_vert,fragmentShader:bt.shadow_frag}};Al.physical={uniforms:Zs([Al.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new pe(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Ke(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new pe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Ke(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Ke(1,1,1)},specularColorMap:{value:null}}]),vertexShader:bt.meshphysical_vert,fragmentShader:bt.meshphysical_frag};const fB={r:0,b:0,g:0};function Yae(n,e,t,i,r,s,o){const a=new Ke(0);let l=s===!0?0:1,c,g,u=null,d=0,h=null;function f(A,p){let y=!1,v=p.isScene===!0?p.background:null;v&&v.isTexture&&(v=(p.backgroundBlurriness>0?t:e).get(v));const b=n.xr,w=b.getSession&&b.getSession();w&&w.environmentBlendMode==="additive"&&(v=null),v===null?I(a,l):v&&v.isColor&&(I(v,1),y=!0),(n.autoClear||y)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),v&&(v.isCubeTexture||v.mapping===EC)?(g===void 0&&(g=new Rn(new FC(1,1,1),new Nt({name:"BackgroundCubeMaterial",uniforms:aC(Al.backgroundCube.uniforms),vertexShader:Al.backgroundCube.vertexShader,fragmentShader:Al.backgroundCube.fragmentShader,side:Bi,depthTest:!1,depthWrite:!1,fog:!1})),g.geometry.deleteAttribute("normal"),g.geometry.deleteAttribute("uv"),g.onBeforeRender=function(G,x,B){this.matrixWorld.copyPosition(B.matrixWorld)},Object.defineProperty(g.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(g)),g.material.uniforms.envMap.value=v,g.material.uniforms.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,g.material.uniforms.backgroundBlurriness.value=p.backgroundBlurriness,g.material.uniforms.backgroundIntensity.value=p.backgroundIntensity,g.material.toneMapped=v.encoding!==Xt,(u!==v||d!==v.version||h!==n.toneMapping)&&(g.material.needsUpdate=!0,u=v,d=v.version,h=n.toneMapping),g.layers.enableAll(),A.unshift(g,g.geometry,g.material,0,0,null)):v&&v.isTexture&&(c===void 0&&(c=new Rn(new Fc(2,2),new Nt({name:"BackgroundMaterial",uniforms:aC(Al.background.uniforms),vertexShader:Al.background.vertexShader,fragmentShader:Al.background.fragmentShader,side:wo,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=v,c.material.uniforms.backgroundIntensity.value=p.backgroundIntensity,c.material.toneMapped=v.encoding!==Xt,v.matrixAutoUpdate===!0&&v.updateMatrix(),c.material.uniforms.uvTransform.value.copy(v.matrix),(u!==v||d!==v.version||h!==n.toneMapping)&&(c.material.needsUpdate=!0,u=v,d=v.version,h=n.toneMapping),c.layers.enableAll(),A.unshift(c,c.geometry,c.material,0,0,null))}function I(A,p){A.getRGB(fB,KO(n)),i.buffers.color.setClear(fB.r,fB.g,fB.b,p,o)}return{getClearColor:function(){return a},setClearColor:function(A,p=1){a.set(A),l=p,I(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(A){l=A,I(a,l)},render:f}}function Kae(n,e,t,i){const r=n.getParameter(34921),s=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||s!==null,a={},l=A(null);let c=l,g=!1;function u(V,z,U,J,H){let Y=!1;if(o){const K=I(J,U,z);c!==K&&(c=K,h(c.object)),Y=p(V,J,U,H),Y&&y(V,J,U,H)}else{const K=z.wireframe===!0;(c.geometry!==J.id||c.program!==U.id||c.wireframe!==K)&&(c.geometry=J.id,c.program=U.id,c.wireframe=K,Y=!0)}H!==null&&t.update(H,34963),(Y||g)&&(g=!1,B(V,z,U,J),H!==null&&n.bindBuffer(34963,t.get(H).buffer))}function d(){return i.isWebGL2?n.createVertexArray():s.createVertexArrayOES()}function h(V){return i.isWebGL2?n.bindVertexArray(V):s.bindVertexArrayOES(V)}function f(V){return i.isWebGL2?n.deleteVertexArray(V):s.deleteVertexArrayOES(V)}function I(V,z,U){const J=U.wireframe===!0;let H=a[V.id];H===void 0&&(H={},a[V.id]=H);let Y=H[z.id];Y===void 0&&(Y={},H[z.id]=Y);let K=Y[J];return K===void 0&&(K=A(d()),Y[J]=K),K}function A(V){const z=[],U=[],J=[];for(let H=0;H<r;H++)z[H]=0,U[H]=0,J[H]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:z,enabledAttributes:U,attributeDivisors:J,object:V,attributes:{},index:null}}function p(V,z,U,J){const H=c.attributes,Y=z.attributes;let K=0;const Q=U.getAttributes();for(const P in Q)if(Q[P].location>=0){const oe=H[P];let $=Y[P];if($===void 0&&(P==="instanceMatrix"&&V.instanceMatrix&&($=V.instanceMatrix),P==="instanceColor"&&V.instanceColor&&($=V.instanceColor)),oe===void 0||oe.attribute!==$||$&&oe.data!==$.data)return!0;K++}return c.attributesNum!==K||c.index!==J}function y(V,z,U,J){const H={},Y=z.attributes;let K=0;const Q=U.getAttributes();for(const P in Q)if(Q[P].location>=0){let oe=Y[P];oe===void 0&&(P==="instanceMatrix"&&V.instanceMatrix&&(oe=V.instanceMatrix),P==="instanceColor"&&V.instanceColor&&(oe=V.instanceColor));const $={};$.attribute=oe,oe&&oe.data&&($.data=oe.data),H[P]=$,K++}c.attributes=H,c.attributesNum=K,c.index=J}function v(){const V=c.newAttributes;for(let z=0,U=V.length;z<U;z++)V[z]=0}function b(V){w(V,0)}function w(V,z){const U=c.newAttributes,J=c.enabledAttributes,H=c.attributeDivisors;U[V]=1,J[V]===0&&(n.enableVertexAttribArray(V),J[V]=1),H[V]!==z&&((i.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](V,z),H[V]=z)}function G(){const V=c.newAttributes,z=c.enabledAttributes;for(let U=0,J=z.length;U<J;U++)z[U]!==V[U]&&(n.disableVertexAttribArray(U),z[U]=0)}function x(V,z,U,J,H,Y){i.isWebGL2===!0&&(U===5124||U===5125)?n.vertexAttribIPointer(V,z,U,H,Y):n.vertexAttribPointer(V,z,U,J,H,Y)}function B(V,z,U,J){if(i.isWebGL2===!1&&(V.isInstancedMesh||J.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;v();const H=J.attributes,Y=U.getAttributes(),K=z.defaultAttributeValues;for(const Q in Y){const P=Y[Q];if(P.location>=0){let ne=H[Q];if(ne===void 0&&(Q==="instanceMatrix"&&V.instanceMatrix&&(ne=V.instanceMatrix),Q==="instanceColor"&&V.instanceColor&&(ne=V.instanceColor)),ne!==void 0){const oe=ne.normalized,$=ne.itemSize,de=t.get(ne);if(de===void 0)continue;const ge=de.buffer,se=de.type,k=de.bytesPerElement;if(ne.isInterleavedBufferAttribute){const O=ne.data,q=O.stride,ee=ne.offset;if(O.isInstancedInterleavedBuffer){for(let le=0;le<P.locationSize;le++)w(P.location+le,O.meshPerAttribute);V.isInstancedMesh!==!0&&J._maxInstanceCount===void 0&&(J._maxInstanceCount=O.meshPerAttribute*O.count)}else for(let le=0;le<P.locationSize;le++)b(P.location+le);n.bindBuffer(34962,ge);for(let le=0;le<P.locationSize;le++)x(P.location+le,$/P.locationSize,se,oe,q*k,(ee+$/P.locationSize*le)*k)}else{if(ne.isInstancedBufferAttribute){for(let O=0;O<P.locationSize;O++)w(P.location+O,ne.meshPerAttribute);V.isInstancedMesh!==!0&&J._maxInstanceCount===void 0&&(J._maxInstanceCount=ne.meshPerAttribute*ne.count)}else for(let O=0;O<P.locationSize;O++)b(P.location+O);n.bindBuffer(34962,ge);for(let O=0;O<P.locationSize;O++)x(P.location+O,$/P.locationSize,se,oe,$*k,$/P.locationSize*O*k)}}else if(K!==void 0){const oe=K[Q];if(oe!==void 0)switch(oe.length){case 2:n.vertexAttrib2fv(P.location,oe);break;case 3:n.vertexAttrib3fv(P.location,oe);break;case 4:n.vertexAttrib4fv(P.location,oe);break;default:n.vertexAttrib1fv(P.location,oe)}}}}G()}function R(){F();for(const V in a){const z=a[V];for(const U in z){const J=z[U];for(const H in J)f(J[H].object),delete J[H];delete z[U]}delete a[V]}}function Z(V){if(a[V.id]===void 0)return;const z=a[V.id];for(const U in z){const J=z[U];for(const H in J)f(J[H].object),delete J[H];delete z[U]}delete a[V.id]}function W(V){for(const z in a){const U=a[z];if(U[V.id]===void 0)continue;const J=U[V.id];for(const H in J)f(J[H].object),delete J[H];delete U[V.id]}}function F(){T(),g=!0,c!==l&&(c=l,h(c.object))}function T(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:u,reset:F,resetDefaultState:T,dispose:R,releaseStatesOfGeometry:Z,releaseStatesOfProgram:W,initAttributes:v,enableAttribute:b,disableUnusedAttributes:G}}function Dae(n,e,t,i){const r=i.isWebGL2;let s;function o(c){s=c}function a(c,g){n.drawArrays(s,c,g),t.update(g,s,1)}function l(c,g,u){if(u===0)return;let d,h;if(r)d=n,h="drawArraysInstanced";else if(d=e.get("ANGLE_instanced_arrays"),h="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[h](s,c,g,u),t.update(g,s,u)}this.setMode=o,this.render=a,this.renderInstances=l}function Pae(n,e,t){let i;function r(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const x=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(x.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function s(x){if(x==="highp"){if(n.getShaderPrecisionFormat(35633,36338).precision>0&&n.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";x="mediump"}return x==="mediump"&&n.getShaderPrecisionFormat(35633,36337).precision>0&&n.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext;let a=t.precision!==void 0?t.precision:"highp";const l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),g=t.logarithmicDepthBuffer===!0,u=n.getParameter(34930),d=n.getParameter(35660),h=n.getParameter(3379),f=n.getParameter(34076),I=n.getParameter(34921),A=n.getParameter(36347),p=n.getParameter(36348),y=n.getParameter(36349),v=d>0,b=o||e.has("OES_texture_float"),w=v&&b,G=o?n.getParameter(36183):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:r,getMaxPrecision:s,precision:a,logarithmicDepthBuffer:g,maxTextures:u,maxVertexTextures:d,maxTextureSize:h,maxCubemapSize:f,maxAttributes:I,maxVertexUniforms:A,maxVaryings:p,maxFragmentUniforms:y,vertexTextures:v,floatFragmentTextures:b,floatVertexTextures:w,maxSamples:G}}function Uae(n){const e=this;let t=null,i=0,r=!1,s=!1;const o=new ic,a=new Ir,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(u,d){const h=u.length!==0||d||i!==0||r;return r=d,i=u.length,h},this.beginShadows=function(){s=!0,g(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(u,d){t=g(u,d,0)},this.setState=function(u,d,h){const f=u.clippingPlanes,I=u.clipIntersection,A=u.clipShadows,p=n.get(u);if(!r||f===null||f.length===0||s&&!A)s?g(null):c();else{const y=s?0:i,v=y*4;let b=p.clippingState||null;l.value=b,b=g(f,d,v,h);for(let w=0;w!==v;++w)b[w]=t[w];p.clippingState=b,this.numIntersection=I?this.numPlanes:0,this.numPlanes+=y}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function g(u,d,h,f){const I=u!==null?u.length:0;let A=null;if(I!==0){if(A=l.value,f!==!0||A===null){const p=h+I*4,y=d.matrixWorldInverse;a.getNormalMatrix(y),(A===null||A.length<p)&&(A=new Float32Array(p));for(let v=0,b=h;v!==I;++v,b+=4)o.copy(u[v]).applyMatrix4(y,a),o.normal.toArray(A,b),A[b+3]=o.constant}l.value=A,l.needsUpdate=!0}return e.numPlanes=I,e.numIntersection=0,A}}function Qae(n){let e=new WeakMap;function t(o,a){return a===iC?o.mapping=zg:a===Iy&&(o.mapping=Id),o}function i(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const a=o.mapping;if(a===iC||a===Iy)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new sv(l.height/2);return c.fromEquirectangularTexture(n,o),e.set(o,c),o.addEventListener("dispose",r),t(c.texture,o.mapping)}else return null}}return o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function s(){e=new WeakMap}return{get:i,dispose:s}}class _c extends _C{constructor(e=-1,t=1,i=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,o=i+e,a=r+t,l=r-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,g=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,a-=g*this.view.offsetY,l=a-g*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const fA=4,B9=[.125,.215,.35,.446,.526,.582],xh=20,xR=new _c,G9=new Ke;let SR=null;const yh=(1+Math.sqrt(5))/2,AI=1/yh,w9=[new D(1,1,1),new D(-1,1,1),new D(1,1,-1),new D(-1,1,-1),new D(0,yh,AI),new D(0,yh,-AI),new D(AI,0,yh),new D(-AI,0,yh),new D(yh,AI,0),new D(-yh,AI,0)];class I2{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){SR=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,i,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=R9(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=S9(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(SR),e.scissorTest=!1,IB(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===zg||e.mapping===Id?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),SR=this._renderer.getRenderTarget();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:ut,minFilter:ut,generateMipmaps:!1,type:Pi,format:Yn,encoding:ta,depthBuffer:!1},r=x9(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=x9(e,t,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Oae(s)),this._blurMaterial=Jae(s,e,t)}return r}_compileMaterial(e){const t=new Rn(this._lodPlanes[0],e);this._renderer.compile(t,xR)}_sceneToCubeUV(e,t,i,r){const a=new zn(90,1,t,i),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],g=this._renderer,u=g.autoClear,d=g.toneMapping;g.getClearColor(G9),g.toneMapping=Gl,g.autoClear=!1;const h=new os({name:"PMREM.Background",side:Bi,depthWrite:!1,depthTest:!1}),f=new Rn(new FC,h);let I=!1;const A=e.background;A?A.isColor&&(h.color.copy(A),e.background=null,I=!0):(h.color.copy(G9),I=!0);for(let p=0;p<6;p++){const y=p%3;y===0?(a.up.set(0,l[p],0),a.lookAt(c[p],0,0)):y===1?(a.up.set(0,0,l[p]),a.lookAt(0,c[p],0)):(a.up.set(0,l[p],0),a.lookAt(0,0,c[p]));const v=this._cubeSize;IB(r,y*v,p>2?v:0,v,v),g.setRenderTarget(r),I&&g.render(f,a),g.render(e,a)}f.geometry.dispose(),f.material.dispose(),g.toneMapping=d,g.autoClear=u,e.background=A}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===zg||e.mapping===Id;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=R9()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=S9());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new Rn(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const l=this._cubeSize;IB(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(o,xR)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const s=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),o=w9[(r-1)%w9.length];this._blur(e,r-1,r,s,o)}t.autoClear=i}_blur(e,t,i,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,r,"latitudinal",s),this._halfBlur(o,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const g=3,u=new Rn(this._lodPlanes[r],c),d=c.uniforms,h=this._sizeLods[i]-1,f=isFinite(s)?Math.PI/(2*h):2*Math.PI/(2*xh-1),I=s/f,A=isFinite(s)?1+Math.floor(g*I):xh;A>xh&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${A} samples when the maximum is set to ${xh}`);const p=[];let y=0;for(let x=0;x<xh;++x){const B=x/I,R=Math.exp(-B*B/2);p.push(R),x===0?y+=R:x<A&&(y+=2*R)}for(let x=0;x<p.length;x++)p[x]=p[x]/y;d.envMap.value=e.texture,d.samples.value=A,d.weights.value=p,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a);const{_lodMax:v}=this;d.dTheta.value=f,d.mipInt.value=v-i;const b=this._sizeLods[r],w=3*b*(r>v-fA?r-v+fA:0),G=4*(this._cubeSize-b);IB(t,w,G,3*b,2*b),l.setRenderTarget(t),l.render(u,xR)}}function Oae(n){const e=[],t=[],i=[];let r=n;const s=n-fA+1+B9.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);t.push(a);let l=1/a;o>n-fA?l=B9[o-n+fA-1]:o===0&&(l=0),i.push(l);const c=1/(a-2),g=-c,u=1+c,d=[g,g,u,g,u,u,g,g,u,u,g,u],h=6,f=6,I=3,A=2,p=1,y=new Float32Array(I*f*h),v=new Float32Array(A*f*h),b=new Float32Array(p*f*h);for(let G=0;G<h;G++){const x=G%3*2/3-1,B=G>2?0:-1,R=[x,B,0,x+2/3,B,0,x+2/3,B+1,0,x,B,0,x+2/3,B+1,0,x,B+1,0];y.set(R,I*f*G),v.set(d,A*f*G);const Z=[G,G,G,G,G,G];b.set(Z,p*f*G)}const w=new Et;w.setAttribute("position",new Pt(y,I)),w.setAttribute("uv",new Pt(v,A)),w.setAttribute("faceIndex",new Pt(b,p)),e.push(w),r>fA&&r--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function x9(n,e,t){const i=new Qt(n,e,t);return i.texture.mapping=EC,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function IB(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function Jae(n,e,t){const i=new Float32Array(xh),r=new D(0,1,0);return new Nt({name:"SphericalGaussianBlur",defines:{n:xh,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:X_(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:ei,depthTest:!1,depthWrite:!1})}function S9(){return new Nt({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:X_(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:ei,depthTest:!1,depthWrite:!1})}function R9(){return new Nt({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:X_(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:ei,depthTest:!1,depthWrite:!1})}function X_(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function jae(n){let e=new WeakMap,t=null;function i(a){if(a&&a.isTexture){const l=a.mapping,c=l===iC||l===Iy,g=l===zg||l===Id;if(c||g)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let u=e.get(a);return t===null&&(t=new I2(n)),u=c?t.fromEquirectangular(a,u):t.fromCubemap(a,u),e.set(a,u),u.texture}else{if(e.has(a))return e.get(a).texture;{const u=a.image;if(c&&u&&u.height>0||g&&u&&r(u)){t===null&&(t=new I2(n));const d=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,d),a.addEventListener("dispose",s),d.texture}else return null}}}return a}function r(a){let l=0;const c=6;for(let g=0;g<c;g++)a[g]!==void 0&&l++;return l===c}function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:o}}function qae(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return t(i)!==null},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const r=t(i);return r===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function $ae(n,e,t,i){const r={},s=new WeakMap;function o(u){const d=u.target;d.index!==null&&e.remove(d.index);for(const f in d.attributes)e.remove(d.attributes[f]);d.removeEventListener("dispose",o),delete r[d.id];const h=s.get(d);h&&(e.remove(h),s.delete(d)),i.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,t.memory.geometries--}function a(u,d){return r[d.id]===!0||(d.addEventListener("dispose",o),r[d.id]=!0,t.memory.geometries++),d}function l(u){const d=u.attributes;for(const f in d)e.update(d[f],34962);const h=u.morphAttributes;for(const f in h){const I=h[f];for(let A=0,p=I.length;A<p;A++)e.update(I[A],34962)}}function c(u){const d=[],h=u.index,f=u.attributes.position;let I=0;if(h!==null){const y=h.array;I=h.version;for(let v=0,b=y.length;v<b;v+=3){const w=y[v+0],G=y[v+1],x=y[v+2];d.push(w,G,G,x,x,w)}}else{const y=f.array;I=f.version;for(let v=0,b=y.length/3-1;v<b;v+=3){const w=v+0,G=v+1,x=v+2;d.push(w,G,G,x,x,w)}}const A=new(NO(d)?H_:L_)(d,1);A.version=I;const p=s.get(u);p&&e.remove(p),s.set(u,A)}function g(u){const d=s.get(u);if(d){const h=u.index;h!==null&&d.version<h.version&&c(u)}else c(u);return s.get(u)}return{get:a,update:l,getWireframeAttribute:g}}function ele(n,e,t,i){const r=i.isWebGL2;let s;function o(d){s=d}let a,l;function c(d){a=d.type,l=d.bytesPerElement}function g(d,h){n.drawElements(s,h,a,d*l),t.update(h,s,1)}function u(d,h,f){if(f===0)return;let I,A;if(r)I=n,A="drawElementsInstanced";else if(I=e.get("ANGLE_instanced_arrays"),A="drawElementsInstancedANGLE",I===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}I[A](s,h,a,d*l,f),t.update(h,s,f)}this.setMode=o,this.setIndex=c,this.render=g,this.renderInstances=u}function tle(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,o,a){switch(t.calls++,o){case 4:t.triangles+=a*(s/3);break;case 1:t.lines+=a*(s/2);break;case 3:t.lines+=a*(s-1);break;case 2:t.lines+=a*s;break;case 0:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:i}}function nle(n,e){return n[0]-e[0]}function ile(n,e){return Math.abs(e[1])-Math.abs(n[1])}function rle(n,e,t){const i={},r=new Float32Array(8),s=new WeakMap,o=new Lt,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,g,u){const d=c.morphTargetInfluences;if(e.isWebGL2===!0){const f=g.morphAttributes.position||g.morphAttributes.normal||g.morphAttributes.color,I=f!==void 0?f.length:0;let A=s.get(g);if(A===void 0||A.count!==I){let z=function(){T.dispose(),s.delete(g),g.removeEventListener("dispose",z)};var h=z;A!==void 0&&A.texture.dispose();const v=g.morphAttributes.position!==void 0,b=g.morphAttributes.normal!==void 0,w=g.morphAttributes.color!==void 0,G=g.morphAttributes.position||[],x=g.morphAttributes.normal||[],B=g.morphAttributes.color||[];let R=0;v===!0&&(R=1),b===!0&&(R=2),w===!0&&(R=3);let Z=g.attributes.position.count*R,W=1;Z>e.maxTextureSize&&(W=Math.ceil(Z/e.maxTextureSize),Z=e.maxTextureSize);const F=new Float32Array(Z*W*4*I),T=new Mw(F,Z,W,I);T.type=Hn,T.needsUpdate=!0;const V=R*4;for(let U=0;U<I;U++){const J=G[U],H=x[U],Y=B[U],K=Z*W*4*U;for(let Q=0;Q<J.count;Q++){const P=Q*V;v===!0&&(o.fromBufferAttribute(J,Q),F[K+P+0]=o.x,F[K+P+1]=o.y,F[K+P+2]=o.z,F[K+P+3]=0),b===!0&&(o.fromBufferAttribute(H,Q),F[K+P+4]=o.x,F[K+P+5]=o.y,F[K+P+6]=o.z,F[K+P+7]=0),w===!0&&(o.fromBufferAttribute(Y,Q),F[K+P+8]=o.x,F[K+P+9]=o.y,F[K+P+10]=o.z,F[K+P+11]=Y.itemSize===4?o.w:1)}}A={count:I,texture:T,size:new pe(Z,W)},s.set(g,A),g.addEventListener("dispose",z)}let p=0;for(let v=0;v<d.length;v++)p+=d[v];const y=g.morphTargetsRelative?1:1-p;u.getUniforms().setValue(n,"morphTargetBaseInfluence",y),u.getUniforms().setValue(n,"morphTargetInfluences",d),u.getUniforms().setValue(n,"morphTargetsTexture",A.texture,t),u.getUniforms().setValue(n,"morphTargetsTextureSize",A.size)}else{const f=d===void 0?0:d.length;let I=i[g.id];if(I===void 0||I.length!==f){I=[];for(let b=0;b<f;b++)I[b]=[b,0];i[g.id]=I}for(let b=0;b<f;b++){const w=I[b];w[0]=b,w[1]=d[b]}I.sort(ile);for(let b=0;b<8;b++)b<f&&I[b][1]?(a[b][0]=I[b][0],a[b][1]=I[b][1]):(a[b][0]=Number.MAX_SAFE_INTEGER,a[b][1]=0);a.sort(nle);const A=g.morphAttributes.position,p=g.morphAttributes.normal;let y=0;for(let b=0;b<8;b++){const w=a[b],G=w[0],x=w[1];G!==Number.MAX_SAFE_INTEGER&&x?(A&&g.getAttribute("morphTarget"+b)!==A[G]&&g.setAttribute("morphTarget"+b,A[G]),p&&g.getAttribute("morphNormal"+b)!==p[G]&&g.setAttribute("morphNormal"+b,p[G]),r[b]=x,y+=x):(A&&g.hasAttribute("morphTarget"+b)===!0&&g.deleteAttribute("morphTarget"+b),p&&g.hasAttribute("morphNormal"+b)===!0&&g.deleteAttribute("morphNormal"+b),r[b]=0)}const v=g.morphTargetsRelative?1:1-y;u.getUniforms().setValue(n,"morphTargetBaseInfluence",v),u.getUniforms().setValue(n,"morphTargetInfluences",r)}}return{update:l}}function sle(n,e,t,i){let r=new WeakMap;function s(l){const c=i.render.frame,g=l.geometry,u=e.get(l,g);return r.get(u)!==c&&(e.update(u),r.set(u,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),t.update(l.instanceMatrix,34962),l.instanceColor!==null&&t.update(l.instanceColor,34962)),u}function o(){r=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:s,dispose:o}}const PO=new Pn,UO=new Mw,QO=new Oh,OO=new rv,Z9=[],M9=[],E9=new Float32Array(16),W9=new Float32Array(9),F9=new Float32Array(4);function VC(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let s=Z9[r];if(s===void 0&&(s=new Float32Array(r),Z9[r]=s),e!==0){i.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function nr(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function ir(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function Fw(n,e){let t=M9[e];t===void 0&&(t=new Int32Array(e),M9[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function ole(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function ale(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(nr(t,e))return;n.uniform2fv(this.addr,e),ir(t,e)}}function lle(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(nr(t,e))return;n.uniform3fv(this.addr,e),ir(t,e)}}function cle(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(nr(t,e))return;n.uniform4fv(this.addr,e),ir(t,e)}}function gle(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(nr(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),ir(t,e)}else{if(nr(t,i))return;F9.set(i),n.uniformMatrix2fv(this.addr,!1,F9),ir(t,i)}}function ule(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(nr(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),ir(t,e)}else{if(nr(t,i))return;W9.set(i),n.uniformMatrix3fv(this.addr,!1,W9),ir(t,i)}}function dle(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(nr(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),ir(t,e)}else{if(nr(t,i))return;E9.set(i),n.uniformMatrix4fv(this.addr,!1,E9),ir(t,i)}}function hle(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function fle(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(nr(t,e))return;n.uniform2iv(this.addr,e),ir(t,e)}}function Ile(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(nr(t,e))return;n.uniform3iv(this.addr,e),ir(t,e)}}function Ale(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(nr(t,e))return;n.uniform4iv(this.addr,e),ir(t,e)}}function Cle(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function ple(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(nr(t,e))return;n.uniform2uiv(this.addr,e),ir(t,e)}}function mle(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(nr(t,e))return;n.uniform3uiv(this.addr,e),ir(t,e)}}function yle(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(nr(t,e))return;n.uniform4uiv(this.addr,e),ir(t,e)}}function vle(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2D(e||PO,r)}function ble(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||QO,r)}function Ble(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||OO,r)}function Gle(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||UO,r)}function wle(n){switch(n){case 5126:return ole;case 35664:return ale;case 35665:return lle;case 35666:return cle;case 35674:return gle;case 35675:return ule;case 35676:return dle;case 5124:case 35670:return hle;case 35667:case 35671:return fle;case 35668:case 35672:return Ile;case 35669:case 35673:return Ale;case 5125:return Cle;case 36294:return ple;case 36295:return mle;case 36296:return yle;case 35678:case 36198:case 36298:case 36306:case 35682:return vle;case 35679:case 36299:case 36307:return ble;case 35680:case 36300:case 36308:case 36293:return Ble;case 36289:case 36303:case 36311:case 36292:return Gle}}function xle(n,e){n.uniform1fv(this.addr,e)}function Sle(n,e){const t=VC(e,this.size,2);n.uniform2fv(this.addr,t)}function Rle(n,e){const t=VC(e,this.size,3);n.uniform3fv(this.addr,t)}function Zle(n,e){const t=VC(e,this.size,4);n.uniform4fv(this.addr,t)}function Mle(n,e){const t=VC(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function Ele(n,e){const t=VC(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function Wle(n,e){const t=VC(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function Fle(n,e){n.uniform1iv(this.addr,e)}function _le(n,e){n.uniform2iv(this.addr,e)}function Vle(n,e){n.uniform3iv(this.addr,e)}function Tle(n,e){n.uniform4iv(this.addr,e)}function Nle(n,e){n.uniform1uiv(this.addr,e)}function kle(n,e){n.uniform2uiv(this.addr,e)}function Lle(n,e){n.uniform3uiv(this.addr,e)}function Hle(n,e){n.uniform4uiv(this.addr,e)}function zle(n,e,t){const i=this.cache,r=e.length,s=Fw(t,r);nr(i,s)||(n.uniform1iv(this.addr,s),ir(i,s));for(let o=0;o!==r;++o)t.setTexture2D(e[o]||PO,s[o])}function Xle(n,e,t){const i=this.cache,r=e.length,s=Fw(t,r);nr(i,s)||(n.uniform1iv(this.addr,s),ir(i,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||QO,s[o])}function Yle(n,e,t){const i=this.cache,r=e.length,s=Fw(t,r);nr(i,s)||(n.uniform1iv(this.addr,s),ir(i,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||OO,s[o])}function Kle(n,e,t){const i=this.cache,r=e.length,s=Fw(t,r);nr(i,s)||(n.uniform1iv(this.addr,s),ir(i,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||UO,s[o])}function Dle(n){switch(n){case 5126:return xle;case 35664:return Sle;case 35665:return Rle;case 35666:return Zle;case 35674:return Mle;case 35675:return Ele;case 35676:return Wle;case 5124:case 35670:return Fle;case 35667:case 35671:return _le;case 35668:case 35672:return Vle;case 35669:case 35673:return Tle;case 5125:return Nle;case 36294:return kle;case 36295:return Lle;case 36296:return Hle;case 35678:case 36198:case 36298:case 36306:case 35682:return zle;case 35679:case 36299:case 36307:return Xle;case 35680:case 36300:case 36308:case 36293:return Yle;case 36289:case 36303:case 36311:case 36292:return Kle}}class Ple{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=wle(t.type)}}class Ule{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=Dle(t.type)}}class Qle{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,t[a.id],i)}}}const RR=/(\w+)(\])?(\[|\.)?/g;function _9(n,e){n.seq.push(e),n.map[e.id]=e}function Ole(n,e,t){const i=n.name,r=i.length;for(RR.lastIndex=0;;){const s=RR.exec(i),o=RR.lastIndex;let a=s[1];const l=s[2]==="]",c=s[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===r){_9(t,c===void 0?new Ple(a,n,e):new Ule(a,n,e));break}else{let u=t.map[a];u===void 0&&(u=new Qle(a),_9(t,u)),t=u}}}class f1{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,35718);for(let r=0;r<i;++r){const s=e.getActiveUniform(t,r),o=e.getUniformLocation(t,s.name);Ole(s,o,this)}}setValue(e,t,i,r){const s=this.map[t];s!==void 0&&s.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let s=0,o=t.length;s!==o;++s){const a=t[s],l=i[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&i.push(o)}return i}}function V9(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}let Jle=0;function jle(n,e){const t=n.split(`
`),i=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join(`
`)}function qle(n){switch(n){case ta:return["Linear","( value )"];case Xt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",n),["Linear","( value )"]}}function T9(n,e,t){const i=n.getShaderParameter(e,35713),r=n.getShaderInfoLog(e).trim();if(i&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return t.toUpperCase()+`

`+r+`

`+jle(n.getShaderSource(e),o)}else return r}function $le(n,e){const t=qle(e);return"vec4 "+n+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function ece(n,e){let t;switch(e){case gO:t="Linear";break;case uO:t="Reinhard";break;case dO:t="OptimizedCineon";break;case M_:t="ACESFilmic";break;case hO:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function tce(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||n.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(e0).join(`
`)}function nce(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function ice(n,e){const t={},i=n.getProgramParameter(e,35721);for(let r=0;r<i;r++){const s=n.getActiveAttrib(e,r),o=s.name;let a=1;s.type===35674&&(a=2),s.type===35675&&(a=3),s.type===35676&&(a=4),t[o]={type:s.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}function e0(n){return n!==""}function N9(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function k9(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const rce=/^[ \t]*#include +<([\w\d./]+)>/gm;function C3(n){return n.replace(rce,sce)}function sce(n,e){const t=bt[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return C3(t)}const oce=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function L9(n){return n.replace(oce,ace)}function ace(n,e,t,i){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function H9(n){let e="precision "+n.precision+` float;
precision `+n.precision+" int;";return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function lce(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===Bw?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===G0?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Vh&&(e="SHADOWMAP_TYPE_VSM"),e}function cce(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case zg:case Id:e="ENVMAP_TYPE_CUBE";break;case EC:e="ENVMAP_TYPE_CUBE_UV";break}return e}function gce(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case Id:e="ENVMAP_MODE_REFRACTION";break}return e}function uce(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case iv:e="ENVMAP_BLENDING_MULTIPLY";break;case lO:e="ENVMAP_BLENDING_MIX";break;case cO:e="ENVMAP_BLENDING_ADD";break}return e}function dce(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function hce(n,e,t,i){const r=n.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=lce(t),c=cce(t),g=gce(t),u=uce(t),d=dce(t),h=t.isWebGL2?"":tce(t),f=nce(s),I=r.createProgram();let A,p,y=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(A=[f].filter(e0).join(`
`),A.length>0&&(A+=`
`),p=[h,f].filter(e0).join(`
`),p.length>0&&(p+=`
`)):(A=[H9(t),"#define SHADER_NAME "+t.shaderName,f,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+g:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(e0).join(`
`),p=[h,H9(t),"#define SHADER_NAME "+t.shaderName,f,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+g:"",t.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Gl?"#define TONE_MAPPING":"",t.toneMapping!==Gl?bt.tonemapping_pars_fragment:"",t.toneMapping!==Gl?ece("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",bt.encodings_pars_fragment,$le("linearToOutputTexel",t.outputEncoding),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(e0).join(`
`)),o=C3(o),o=N9(o,t),o=k9(o,t),a=C3(a),a=N9(a,t),a=k9(a,t),o=L9(o),a=L9(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(y=`#version 300 es
`,A=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+A,p=["#define varying in",t.glslVersion===h2?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===h2?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+p);const v=y+A+o,b=y+p+a,w=V9(r,35633,v),G=V9(r,35632,b);if(r.attachShader(I,w),r.attachShader(I,G),t.index0AttributeName!==void 0?r.bindAttribLocation(I,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(I,0,"position"),r.linkProgram(I),n.debug.checkShaderErrors){const R=r.getProgramInfoLog(I).trim(),Z=r.getShaderInfoLog(w).trim(),W=r.getShaderInfoLog(G).trim();let F=!0,T=!0;if(r.getProgramParameter(I,35714)===!1){F=!1;const V=T9(r,w,"vertex"),z=T9(r,G,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(I,35715)+`

Program Info Log: `+R+`
`+V+`
`+z)}else R!==""?console.warn("THREE.WebGLProgram: Program Info Log:",R):(Z===""||W==="")&&(T=!1);T&&(this.diagnostics={runnable:F,programLog:R,vertexShader:{log:Z,prefix:A},fragmentShader:{log:W,prefix:p}})}r.deleteShader(w),r.deleteShader(G);let x;this.getUniforms=function(){return x===void 0&&(x=new f1(r,I)),x};let B;return this.getAttributes=function(){return B===void 0&&(B=ice(r,I)),B},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(I),this.program=void 0},this.name=t.shaderName,this.id=Jle++,this.cacheKey=e,this.usedTimes=1,this.program=I,this.vertexShader=w,this.fragmentShader=G,this}let fce=0;class Ice{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new Ace(e),t.set(e,i)),i}}class Ace{constructor(e){this.id=fce++,this.code=e,this.usedTimes=0}}function Cce(n,e,t,i,r,s,o){const a=new Jh,l=new Ice,c=[],g=r.isWebGL2,u=r.logarithmicDepthBuffer,d=r.vertexTextures;let h=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function I(B,R,Z,W,F){const T=W.fog,V=F.geometry,z=B.isMeshStandardMaterial?W.environment:null,U=(B.isMeshStandardMaterial?t:e).get(B.envMap||z),J=U&&U.mapping===EC?U.image.height:null,H=f[B.type];B.precision!==null&&(h=r.getMaxPrecision(B.precision),h!==B.precision&&console.warn("THREE.WebGLProgram.getParameters:",B.precision,"not supported, using",h,"instead."));const Y=V.morphAttributes.position||V.morphAttributes.normal||V.morphAttributes.color,K=Y!==void 0?Y.length:0;let Q=0;V.morphAttributes.position!==void 0&&(Q=1),V.morphAttributes.normal!==void 0&&(Q=2),V.morphAttributes.color!==void 0&&(Q=3);let P,ne,oe,$;if(H){const q=Al[H];P=q.vertexShader,ne=q.fragmentShader}else P=B.vertexShader,ne=B.fragmentShader,l.update(B),oe=l.getVertexShaderID(B),$=l.getFragmentShaderID(B);const de=n.getRenderTarget(),ge=B.alphaTest>0,se=B.clearcoat>0,k=B.iridescence>0;return{isWebGL2:g,shaderID:H,shaderName:B.type,vertexShader:P,fragmentShader:ne,defines:B.defines,customVertexShaderID:oe,customFragmentShaderID:$,isRawShaderMaterial:B.isRawShaderMaterial===!0,glslVersion:B.glslVersion,precision:h,instancing:F.isInstancedMesh===!0,instancingColor:F.isInstancedMesh===!0&&F.instanceColor!==null,supportsVertexTextures:d,outputEncoding:de===null?n.outputEncoding:de.isXRRenderTarget===!0?de.texture.encoding:ta,map:!!B.map,matcap:!!B.matcap,envMap:!!U,envMapMode:U&&U.mapping,envMapCubeUVHeight:J,lightMap:!!B.lightMap,aoMap:!!B.aoMap,emissiveMap:!!B.emissiveMap,bumpMap:!!B.bumpMap,normalMap:!!B.normalMap,objectSpaceNormalMap:B.normalMapType===MO,tangentSpaceNormalMap:B.normalMapType===Wc,decodeVideoTexture:!!B.map&&B.map.isVideoTexture===!0&&B.map.encoding===Xt,clearcoat:se,clearcoatMap:se&&!!B.clearcoatMap,clearcoatRoughnessMap:se&&!!B.clearcoatRoughnessMap,clearcoatNormalMap:se&&!!B.clearcoatNormalMap,iridescence:k,iridescenceMap:k&&!!B.iridescenceMap,iridescenceThicknessMap:k&&!!B.iridescenceThicknessMap,displacementMap:!!B.displacementMap,roughnessMap:!!B.roughnessMap,metalnessMap:!!B.metalnessMap,specularMap:!!B.specularMap,specularIntensityMap:!!B.specularIntensityMap,specularColorMap:!!B.specularColorMap,opaque:B.transparent===!1&&B.blending===Uh,alphaMap:!!B.alphaMap,alphaTest:ge,gradientMap:!!B.gradientMap,sheen:B.sheen>0,sheenColorMap:!!B.sheenColorMap,sheenRoughnessMap:!!B.sheenRoughnessMap,transmission:B.transmission>0,transmissionMap:!!B.transmissionMap,thicknessMap:!!B.thicknessMap,combine:B.combine,vertexTangents:!!B.normalMap&&!!V.attributes.tangent,vertexColors:B.vertexColors,vertexAlphas:B.vertexColors===!0&&!!V.attributes.color&&V.attributes.color.itemSize===4,vertexUvs:!!B.map||!!B.bumpMap||!!B.normalMap||!!B.specularMap||!!B.alphaMap||!!B.emissiveMap||!!B.roughnessMap||!!B.metalnessMap||!!B.clearcoatMap||!!B.clearcoatRoughnessMap||!!B.clearcoatNormalMap||!!B.iridescenceMap||!!B.iridescenceThicknessMap||!!B.displacementMap||!!B.transmissionMap||!!B.thicknessMap||!!B.specularIntensityMap||!!B.specularColorMap||!!B.sheenColorMap||!!B.sheenRoughnessMap,uvsVertexOnly:!(B.map||B.bumpMap||B.normalMap||B.specularMap||B.alphaMap||B.emissiveMap||B.roughnessMap||B.metalnessMap||B.clearcoatNormalMap||B.iridescenceMap||B.iridescenceThicknessMap||B.transmission>0||B.transmissionMap||B.thicknessMap||B.specularIntensityMap||B.specularColorMap||B.sheen>0||B.sheenColorMap||B.sheenRoughnessMap)&&!!B.displacementMap,fog:!!T,useFog:B.fog===!0,fogExp2:T&&T.isFogExp2,flatShading:!!B.flatShading,sizeAttenuation:B.sizeAttenuation,logarithmicDepthBuffer:u,skinning:F.isSkinnedMesh===!0,morphTargets:V.morphAttributes.position!==void 0,morphNormals:V.morphAttributes.normal!==void 0,morphColors:V.morphAttributes.color!==void 0,morphTargetsCount:K,morphTextureStride:Q,numDirLights:R.directional.length,numPointLights:R.point.length,numSpotLights:R.spot.length,numSpotLightMaps:R.spotLightMap.length,numRectAreaLights:R.rectArea.length,numHemiLights:R.hemi.length,numDirLightShadows:R.directionalShadowMap.length,numPointLightShadows:R.pointShadowMap.length,numSpotLightShadows:R.spotShadowMap.length,numSpotLightShadowsWithMaps:R.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:B.dithering,shadowMapEnabled:n.shadowMap.enabled&&Z.length>0,shadowMapType:n.shadowMap.type,toneMapping:B.toneMapped?n.toneMapping:Gl,useLegacyLights:n.useLegacyLights,premultipliedAlpha:B.premultipliedAlpha,doubleSided:B.side===Di,flipSided:B.side===Bi,useDepthPacking:!!B.depthPacking,depthPacking:B.depthPacking||0,index0AttributeName:B.index0AttributeName,extensionDerivatives:B.extensions&&B.extensions.derivatives,extensionFragDepth:B.extensions&&B.extensions.fragDepth,extensionDrawBuffers:B.extensions&&B.extensions.drawBuffers,extensionShaderTextureLOD:B.extensions&&B.extensions.shaderTextureLOD,rendererExtensionFragDepth:g||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:g||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:g||i.has("EXT_shader_texture_lod"),customProgramCacheKey:B.customProgramCacheKey()}}function A(B){const R=[];if(B.shaderID?R.push(B.shaderID):(R.push(B.customVertexShaderID),R.push(B.customFragmentShaderID)),B.defines!==void 0)for(const Z in B.defines)R.push(Z),R.push(B.defines[Z]);return B.isRawShaderMaterial===!1&&(p(R,B),y(R,B),R.push(n.outputEncoding)),R.push(B.customProgramCacheKey),R.join()}function p(B,R){B.push(R.precision),B.push(R.outputEncoding),B.push(R.envMapMode),B.push(R.envMapCubeUVHeight),B.push(R.combine),B.push(R.vertexUvs),B.push(R.fogExp2),B.push(R.sizeAttenuation),B.push(R.morphTargetsCount),B.push(R.morphAttributeCount),B.push(R.numDirLights),B.push(R.numPointLights),B.push(R.numSpotLights),B.push(R.numSpotLightMaps),B.push(R.numHemiLights),B.push(R.numRectAreaLights),B.push(R.numDirLightShadows),B.push(R.numPointLightShadows),B.push(R.numSpotLightShadows),B.push(R.numSpotLightShadowsWithMaps),B.push(R.shadowMapType),B.push(R.toneMapping),B.push(R.numClippingPlanes),B.push(R.numClipIntersection),B.push(R.depthPacking)}function y(B,R){a.disableAll(),R.isWebGL2&&a.enable(0),R.supportsVertexTextures&&a.enable(1),R.instancing&&a.enable(2),R.instancingColor&&a.enable(3),R.map&&a.enable(4),R.matcap&&a.enable(5),R.envMap&&a.enable(6),R.lightMap&&a.enable(7),R.aoMap&&a.enable(8),R.emissiveMap&&a.enable(9),R.bumpMap&&a.enable(10),R.normalMap&&a.enable(11),R.objectSpaceNormalMap&&a.enable(12),R.tangentSpaceNormalMap&&a.enable(13),R.clearcoat&&a.enable(14),R.clearcoatMap&&a.enable(15),R.clearcoatRoughnessMap&&a.enable(16),R.clearcoatNormalMap&&a.enable(17),R.iridescence&&a.enable(18),R.iridescenceMap&&a.enable(19),R.iridescenceThicknessMap&&a.enable(20),R.displacementMap&&a.enable(21),R.specularMap&&a.enable(22),R.roughnessMap&&a.enable(23),R.metalnessMap&&a.enable(24),R.gradientMap&&a.enable(25),R.alphaMap&&a.enable(26),R.alphaTest&&a.enable(27),R.vertexColors&&a.enable(28),R.vertexAlphas&&a.enable(29),R.vertexUvs&&a.enable(30),R.vertexTangents&&a.enable(31),R.uvsVertexOnly&&a.enable(32),B.push(a.mask),a.disableAll(),R.fog&&a.enable(0),R.useFog&&a.enable(1),R.flatShading&&a.enable(2),R.logarithmicDepthBuffer&&a.enable(3),R.skinning&&a.enable(4),R.morphTargets&&a.enable(5),R.morphNormals&&a.enable(6),R.morphColors&&a.enable(7),R.premultipliedAlpha&&a.enable(8),R.shadowMapEnabled&&a.enable(9),R.useLegacyLights&&a.enable(10),R.doubleSided&&a.enable(11),R.flipSided&&a.enable(12),R.useDepthPacking&&a.enable(13),R.dithering&&a.enable(14),R.specularIntensityMap&&a.enable(15),R.specularColorMap&&a.enable(16),R.transmission&&a.enable(17),R.transmissionMap&&a.enable(18),R.thicknessMap&&a.enable(19),R.sheen&&a.enable(20),R.sheenColorMap&&a.enable(21),R.sheenRoughnessMap&&a.enable(22),R.decodeVideoTexture&&a.enable(23),R.opaque&&a.enable(24),B.push(a.mask)}function v(B){const R=f[B.type];let Z;if(R){const W=Al[R];Z=Ew.clone(W.uniforms)}else Z=B.uniforms;return Z}function b(B,R){let Z;for(let W=0,F=c.length;W<F;W++){const T=c[W];if(T.cacheKey===R){Z=T,++Z.usedTimes;break}}return Z===void 0&&(Z=new hce(n,R,B,s),c.push(Z)),Z}function w(B){if(--B.usedTimes===0){const R=c.indexOf(B);c[R]=c[c.length-1],c.pop(),B.destroy()}}function G(B){l.remove(B)}function x(){l.dispose()}return{getParameters:I,getProgramCacheKey:A,getUniforms:v,acquireProgram:b,releaseProgram:w,releaseShaderCache:G,programs:c,dispose:x}}function pce(){let n=new WeakMap;function e(s){let o=n.get(s);return o===void 0&&(o={},n.set(s,o)),o}function t(s){n.delete(s)}function i(s,o,a){n.get(s)[o]=a}function r(){n=new WeakMap}return{get:e,remove:t,update:i,dispose:r}}function mce(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function z9(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function X9(){const n=[];let e=0;const t=[],i=[],r=[];function s(){e=0,t.length=0,i.length=0,r.length=0}function o(u,d,h,f,I,A){let p=n[e];return p===void 0?(p={id:u.id,object:u,geometry:d,material:h,groupOrder:f,renderOrder:u.renderOrder,z:I,group:A},n[e]=p):(p.id=u.id,p.object=u,p.geometry=d,p.material=h,p.groupOrder=f,p.renderOrder=u.renderOrder,p.z=I,p.group=A),e++,p}function a(u,d,h,f,I,A){const p=o(u,d,h,f,I,A);h.transmission>0?i.push(p):h.transparent===!0?r.push(p):t.push(p)}function l(u,d,h,f,I,A){const p=o(u,d,h,f,I,A);h.transmission>0?i.unshift(p):h.transparent===!0?r.unshift(p):t.unshift(p)}function c(u,d){t.length>1&&t.sort(u||mce),i.length>1&&i.sort(d||z9),r.length>1&&r.sort(d||z9)}function g(){for(let u=e,d=n.length;u<d;u++){const h=n[u];if(h.id===null)break;h.id=null,h.object=null,h.geometry=null,h.material=null,h.group=null}}return{opaque:t,transmissive:i,transparent:r,init:s,push:a,unshift:l,finish:g,sort:c}}function yce(){let n=new WeakMap;function e(i,r){const s=n.get(i);let o;return s===void 0?(o=new X9,n.set(i,[o])):r>=s.length?(o=new X9,s.push(o)):o=s[r],o}function t(){n=new WeakMap}return{get:e,dispose:t}}function vce(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new D,color:new Ke};break;case"SpotLight":t={position:new D,direction:new D,color:new Ke,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new D,color:new Ke,distance:0,decay:0};break;case"HemisphereLight":t={direction:new D,skyColor:new Ke,groundColor:new Ke};break;case"RectAreaLight":t={color:new Ke,position:new D,halfWidth:new D,halfHeight:new D};break}return n[e.id]=t,t}}}function bce(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new pe};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new pe};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new pe,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let Bce=0;function Gce(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function wce(n,e){const t=new vce,i=bce(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let g=0;g<9;g++)r.probe.push(new D);const s=new D,o=new qe,a=new qe;function l(g,u){let d=0,h=0,f=0;for(let W=0;W<9;W++)r.probe[W].set(0,0,0);let I=0,A=0,p=0,y=0,v=0,b=0,w=0,G=0,x=0,B=0;g.sort(Gce);const R=u===!0?Math.PI:1;for(let W=0,F=g.length;W<F;W++){const T=g[W],V=T.color,z=T.intensity,U=T.distance,J=T.shadow&&T.shadow.map?T.shadow.map.texture:null;if(T.isAmbientLight)d+=V.r*z*R,h+=V.g*z*R,f+=V.b*z*R;else if(T.isLightProbe)for(let H=0;H<9;H++)r.probe[H].addScaledVector(T.sh.coefficients[H],z);else if(T.isDirectionalLight){const H=t.get(T);if(H.color.copy(T.color).multiplyScalar(T.intensity*R),T.castShadow){const Y=T.shadow,K=i.get(T);K.shadowBias=Y.bias,K.shadowNormalBias=Y.normalBias,K.shadowRadius=Y.radius,K.shadowMapSize=Y.mapSize,r.directionalShadow[I]=K,r.directionalShadowMap[I]=J,r.directionalShadowMatrix[I]=T.shadow.matrix,b++}r.directional[I]=H,I++}else if(T.isSpotLight){const H=t.get(T);H.position.setFromMatrixPosition(T.matrixWorld),H.color.copy(V).multiplyScalar(z*R),H.distance=U,H.coneCos=Math.cos(T.angle),H.penumbraCos=Math.cos(T.angle*(1-T.penumbra)),H.decay=T.decay,r.spot[p]=H;const Y=T.shadow;if(T.map&&(r.spotLightMap[x]=T.map,x++,Y.updateMatrices(T),T.castShadow&&B++),r.spotLightMatrix[p]=Y.matrix,T.castShadow){const K=i.get(T);K.shadowBias=Y.bias,K.shadowNormalBias=Y.normalBias,K.shadowRadius=Y.radius,K.shadowMapSize=Y.mapSize,r.spotShadow[p]=K,r.spotShadowMap[p]=J,G++}p++}else if(T.isRectAreaLight){const H=t.get(T);H.color.copy(V).multiplyScalar(z),H.halfWidth.set(T.width*.5,0,0),H.halfHeight.set(0,T.height*.5,0),r.rectArea[y]=H,y++}else if(T.isPointLight){const H=t.get(T);if(H.color.copy(T.color).multiplyScalar(T.intensity*R),H.distance=T.distance,H.decay=T.decay,T.castShadow){const Y=T.shadow,K=i.get(T);K.shadowBias=Y.bias,K.shadowNormalBias=Y.normalBias,K.shadowRadius=Y.radius,K.shadowMapSize=Y.mapSize,K.shadowCameraNear=Y.camera.near,K.shadowCameraFar=Y.camera.far,r.pointShadow[A]=K,r.pointShadowMap[A]=J,r.pointShadowMatrix[A]=T.shadow.matrix,w++}r.point[A]=H,A++}else if(T.isHemisphereLight){const H=t.get(T);H.skyColor.copy(T.color).multiplyScalar(z*R),H.groundColor.copy(T.groundColor).multiplyScalar(z*R),r.hemi[v]=H,v++}}y>0&&(e.isWebGL2||n.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=tt.LTC_FLOAT_1,r.rectAreaLTC2=tt.LTC_FLOAT_2):n.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=tt.LTC_HALF_1,r.rectAreaLTC2=tt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=d,r.ambient[1]=h,r.ambient[2]=f;const Z=r.hash;(Z.directionalLength!==I||Z.pointLength!==A||Z.spotLength!==p||Z.rectAreaLength!==y||Z.hemiLength!==v||Z.numDirectionalShadows!==b||Z.numPointShadows!==w||Z.numSpotShadows!==G||Z.numSpotMaps!==x)&&(r.directional.length=I,r.spot.length=p,r.rectArea.length=y,r.point.length=A,r.hemi.length=v,r.directionalShadow.length=b,r.directionalShadowMap.length=b,r.pointShadow.length=w,r.pointShadowMap.length=w,r.spotShadow.length=G,r.spotShadowMap.length=G,r.directionalShadowMatrix.length=b,r.pointShadowMatrix.length=w,r.spotLightMatrix.length=G+x-B,r.spotLightMap.length=x,r.numSpotLightShadowsWithMaps=B,Z.directionalLength=I,Z.pointLength=A,Z.spotLength=p,Z.rectAreaLength=y,Z.hemiLength=v,Z.numDirectionalShadows=b,Z.numPointShadows=w,Z.numSpotShadows=G,Z.numSpotMaps=x,r.version=Bce++)}function c(g,u){let d=0,h=0,f=0,I=0,A=0;const p=u.matrixWorldInverse;for(let y=0,v=g.length;y<v;y++){const b=g[y];if(b.isDirectionalLight){const w=r.directional[d];w.direction.setFromMatrixPosition(b.matrixWorld),s.setFromMatrixPosition(b.target.matrixWorld),w.direction.sub(s),w.direction.transformDirection(p),d++}else if(b.isSpotLight){const w=r.spot[f];w.position.setFromMatrixPosition(b.matrixWorld),w.position.applyMatrix4(p),w.direction.setFromMatrixPosition(b.matrixWorld),s.setFromMatrixPosition(b.target.matrixWorld),w.direction.sub(s),w.direction.transformDirection(p),f++}else if(b.isRectAreaLight){const w=r.rectArea[I];w.position.setFromMatrixPosition(b.matrixWorld),w.position.applyMatrix4(p),a.identity(),o.copy(b.matrixWorld),o.premultiply(p),a.extractRotation(o),w.halfWidth.set(b.width*.5,0,0),w.halfHeight.set(0,b.height*.5,0),w.halfWidth.applyMatrix4(a),w.halfHeight.applyMatrix4(a),I++}else if(b.isPointLight){const w=r.point[h];w.position.setFromMatrixPosition(b.matrixWorld),w.position.applyMatrix4(p),h++}else if(b.isHemisphereLight){const w=r.hemi[A];w.direction.setFromMatrixPosition(b.matrixWorld),w.direction.transformDirection(p),A++}}}return{setup:l,setupView:c,state:r}}function Y9(n,e){const t=new wce(n,e),i=[],r=[];function s(){i.length=0,r.length=0}function o(u){i.push(u)}function a(u){r.push(u)}function l(u){t.setup(i,u)}function c(u){t.setupView(i,u)}return{init:s,state:{lightsArray:i,shadowsArray:r,lights:t},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}function xce(n,e){let t=new WeakMap;function i(s,o=0){const a=t.get(s);let l;return a===void 0?(l=new Y9(n,e),t.set(s,[l])):o>=a.length?(l=new Y9(n,e),a.push(l)):l=a[o],l}function r(){t=new WeakMap}return{get:i,dispose:r}}class ov extends ai{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=pr,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class _w extends ai{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new D,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const Sce=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Rce=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Zce(n,e,t){let i=new Ww;const r=new pe,s=new pe,o=new Lt,a=new ov({depthPacking:Sl}),l=new _w,c={},g=t.maxTextureSize,u={[wo]:Bi,[Bi]:wo,[Di]:Di},d=new Nt({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new pe},radius:{value:4}},vertexShader:Sce,fragmentShader:Rce}),h=d.clone();h.defines.HORIZONTAL_PASS=1;const f=new Et;f.setAttribute("position",new Pt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const I=new Rn(f,d),A=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Bw,this.render=function(b,w,G){if(A.enabled===!1||A.autoUpdate===!1&&A.needsUpdate===!1||b.length===0)return;const x=n.getRenderTarget(),B=n.getActiveCubeFace(),R=n.getActiveMipmapLevel(),Z=n.state;Z.setBlending(ei),Z.buffers.color.setClear(1,1,1,1),Z.buffers.depth.setTest(!0),Z.setScissorTest(!1);for(let W=0,F=b.length;W<F;W++){const T=b[W],V=T.shadow;if(V===void 0){console.warn("THREE.WebGLShadowMap:",T,"has no shadow.");continue}if(V.autoUpdate===!1&&V.needsUpdate===!1)continue;r.copy(V.mapSize);const z=V.getFrameExtents();if(r.multiply(z),s.copy(V.mapSize),(r.x>g||r.y>g)&&(r.x>g&&(s.x=Math.floor(g/z.x),r.x=s.x*z.x,V.mapSize.x=s.x),r.y>g&&(s.y=Math.floor(g/z.y),r.y=s.y*z.y,V.mapSize.y=s.y)),V.map===null){const J=this.type!==Vh?{minFilter:Zt,magFilter:Zt}:{};V.map=new Qt(r.x,r.y,J),V.map.texture.name=T.name+".shadowMap",V.camera.updateProjectionMatrix()}n.setRenderTarget(V.map),n.clear();const U=V.getViewportCount();for(let J=0;J<U;J++){const H=V.getViewport(J);o.set(s.x*H.x,s.y*H.y,s.x*H.z,s.y*H.w),Z.viewport(o),V.updateMatrices(T,J),i=V.getFrustum(),v(w,G,V.camera,T,this.type)}V.isPointLightShadow!==!0&&this.type===Vh&&p(V,G),V.needsUpdate=!1}A.needsUpdate=!1,n.setRenderTarget(x,B,R)};function p(b,w){const G=e.update(I);d.defines.VSM_SAMPLES!==b.blurSamples&&(d.defines.VSM_SAMPLES=b.blurSamples,h.defines.VSM_SAMPLES=b.blurSamples,d.needsUpdate=!0,h.needsUpdate=!0),b.mapPass===null&&(b.mapPass=new Qt(r.x,r.y)),d.uniforms.shadow_pass.value=b.map.texture,d.uniforms.resolution.value=b.mapSize,d.uniforms.radius.value=b.radius,n.setRenderTarget(b.mapPass),n.clear(),n.renderBufferDirect(w,null,G,d,I,null),h.uniforms.shadow_pass.value=b.mapPass.texture,h.uniforms.resolution.value=b.mapSize,h.uniforms.radius.value=b.radius,n.setRenderTarget(b.map),n.clear(),n.renderBufferDirect(w,null,G,h,I,null)}function y(b,w,G,x,B,R){let Z=null;const W=G.isPointLight===!0?b.customDistanceMaterial:b.customDepthMaterial;if(W!==void 0)Z=W;else if(Z=G.isPointLight===!0?l:a,n.localClippingEnabled&&w.clipShadows===!0&&Array.isArray(w.clippingPlanes)&&w.clippingPlanes.length!==0||w.displacementMap&&w.displacementScale!==0||w.alphaMap&&w.alphaTest>0||w.map&&w.alphaTest>0){const F=Z.uuid,T=w.uuid;let V=c[F];V===void 0&&(V={},c[F]=V);let z=V[T];z===void 0&&(z=Z.clone(),V[T]=z),Z=z}return Z.visible=w.visible,Z.wireframe=w.wireframe,R===Vh?Z.side=w.shadowSide!==null?w.shadowSide:w.side:Z.side=w.shadowSide!==null?w.shadowSide:u[w.side],Z.alphaMap=w.alphaMap,Z.alphaTest=w.alphaTest,Z.map=w.map,Z.clipShadows=w.clipShadows,Z.clippingPlanes=w.clippingPlanes,Z.clipIntersection=w.clipIntersection,Z.displacementMap=w.displacementMap,Z.displacementScale=w.displacementScale,Z.displacementBias=w.displacementBias,Z.wireframeLinewidth=w.wireframeLinewidth,Z.linewidth=w.linewidth,G.isPointLight===!0&&Z.isMeshDistanceMaterial===!0&&(Z.referencePosition.setFromMatrixPosition(G.matrixWorld),Z.nearDistance=x,Z.farDistance=B),Z}function v(b,w,G,x,B){if(b.visible===!1)return;if(b.layers.test(w.layers)&&(b.isMesh||b.isLine||b.isPoints)&&(b.castShadow||b.receiveShadow&&B===Vh)&&(!b.frustumCulled||i.intersectsObject(b))){b.modelViewMatrix.multiplyMatrices(G.matrixWorldInverse,b.matrixWorld);const W=e.update(b),F=b.material;if(Array.isArray(F)){const T=W.groups;for(let V=0,z=T.length;V<z;V++){const U=T[V],J=F[U.materialIndex];if(J&&J.visible){const H=y(b,J,x,G.near,G.far,B);n.renderBufferDirect(G,null,W,H,b,U)}}}else if(F.visible){const T=y(b,F,x,G.near,G.far,B);n.renderBufferDirect(G,null,W,T,b,null)}}const Z=b.children;for(let W=0,F=Z.length;W<F;W++)v(Z[W],w,G,x,B)}}function Mce(n,e,t){const i=t.isWebGL2;function r(){let ue=!1;const Me=new Lt;let De=null;const et=new Lt(0,0,0,0);return{setMask:function(st){De!==st&&!ue&&(n.colorMask(st,st,st,st),De=st)},setLocked:function(st){ue=st},setClear:function(st,Ot,on,An,$t){$t===!0&&(st*=An,Ot*=An,on*=An),Me.set(st,Ot,on,An),et.equals(Me)===!1&&(n.clearColor(st,Ot,on,An),et.copy(Me))},reset:function(){ue=!1,De=null,et.set(-1,0,0,0)}}}function s(){let ue=!1,Me=null,De=null,et=null;return{setTest:function(st){st?ge(2929):se(2929)},setMask:function(st){Me!==st&&!ue&&(n.depthMask(st),Me=st)},setFunc:function(st){if(De!==st){switch(st){case x_:n.depthFunc(512);break;case S_:n.depthFunc(519);break;case u2:n.depthFunc(513);break;case hy:n.depthFunc(515);break;case fy:n.depthFunc(514);break;case R_:n.depthFunc(518);break;case Z_:n.depthFunc(516);break;case Gw:n.depthFunc(517);break;default:n.depthFunc(515)}De=st}},setLocked:function(st){ue=st},setClear:function(st){et!==st&&(n.clearDepth(st),et=st)},reset:function(){ue=!1,Me=null,De=null,et=null}}}function o(){let ue=!1,Me=null,De=null,et=null,st=null,Ot=null,on=null,An=null,$t=null;return{setTest:function(bn){ue||(bn?ge(2960):se(2960))},setMask:function(bn){Me!==bn&&!ue&&(n.stencilMask(bn),Me=bn)},setFunc:function(bn,Jt,nn){(De!==bn||et!==Jt||st!==nn)&&(n.stencilFunc(bn,Jt,nn),De=bn,et=Jt,st=nn)},setOp:function(bn,Jt,nn){(Ot!==bn||on!==Jt||An!==nn)&&(n.stencilOp(bn,Jt,nn),Ot=bn,on=Jt,An=nn)},setLocked:function(bn){ue=bn},setClear:function(bn){$t!==bn&&(n.clearStencil(bn),$t=bn)},reset:function(){ue=!1,Me=null,De=null,et=null,st=null,Ot=null,on=null,An=null,$t=null}}}const a=new r,l=new s,c=new o,g=new WeakMap,u=new WeakMap;let d={},h={},f=new WeakMap,I=[],A=null,p=!1,y=null,v=null,b=null,w=null,G=null,x=null,B=null,R=!1,Z=null,W=null,F=null,T=null,V=null;const z=n.getParameter(35661);let U=!1,J=0;const H=n.getParameter(7938);H.indexOf("WebGL")!==-1?(J=parseFloat(/^WebGL (\d)/.exec(H)[1]),U=J>=1):H.indexOf("OpenGL ES")!==-1&&(J=parseFloat(/^OpenGL ES (\d)/.exec(H)[1]),U=J>=2);let Y=null,K={};const Q=n.getParameter(3088),P=n.getParameter(2978),ne=new Lt().fromArray(Q),oe=new Lt().fromArray(P);function $(ue,Me,De){const et=new Uint8Array(4),st=n.createTexture();n.bindTexture(ue,st),n.texParameteri(ue,10241,9728),n.texParameteri(ue,10240,9728);for(let Ot=0;Ot<De;Ot++)n.texImage2D(Me+Ot,0,6408,1,1,0,6408,5121,et);return st}const de={};de[3553]=$(3553,3553,1),de[34067]=$(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),ge(2929),l.setFunc(hy),xe(!1),ze(zE),ge(2884),he(ei);function ge(ue){d[ue]!==!0&&(n.enable(ue),d[ue]=!0)}function se(ue){d[ue]!==!1&&(n.disable(ue),d[ue]=!1)}function k(ue,Me){return h[ue]!==Me?(n.bindFramebuffer(ue,Me),h[ue]=Me,i&&(ue===36009&&(h[36160]=Me),ue===36160&&(h[36009]=Me)),!0):!1}function O(ue,Me){let De=I,et=!1;if(ue)if(De=f.get(Me),De===void 0&&(De=[],f.set(Me,De)),ue.isWebGLMultipleRenderTargets){const st=ue.texture;if(De.length!==st.length||De[0]!==36064){for(let Ot=0,on=st.length;Ot<on;Ot++)De[Ot]=36064+Ot;De.length=st.length,et=!0}}else De[0]!==36064&&(De[0]=36064,et=!0);else De[0]!==1029&&(De[0]=1029,et=!0);et&&(t.isWebGL2?n.drawBuffers(De):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(De))}function q(ue){return A!==ue?(n.useProgram(ue),A=ue,!0):!1}const ee={[wh]:32774,[jQ]:32778,[qQ]:32779};if(i)ee[KE]=32775,ee[DE]=32776;else{const ue=e.get("EXT_blend_minmax");ue!==null&&(ee[KE]=ue.MIN_EXT,ee[DE]=ue.MAX_EXT)}const le={[$Q]:0,[eO]:1,[tO]:768,[G_]:770,[aO]:776,[sO]:774,[iO]:772,[nO]:769,[w_]:771,[oO]:775,[rO]:773};function he(ue,Me,De,et,st,Ot,on,An){if(ue===ei){p===!0&&(se(3042),p=!1);return}if(p===!1&&(ge(3042),p=!0),ue!==JQ){if(ue!==y||An!==R){if((v!==wh||G!==wh)&&(n.blendEquation(32774),v=wh,G=wh),An)switch(ue){case Uh:n.blendFuncSeparate(1,771,1,771);break;case g2:n.blendFunc(1,1);break;case XE:n.blendFuncSeparate(0,769,0,1);break;case YE:n.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",ue);break}else switch(ue){case Uh:n.blendFuncSeparate(770,771,1,771);break;case g2:n.blendFunc(770,1);break;case XE:n.blendFuncSeparate(0,769,0,1);break;case YE:n.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",ue);break}b=null,w=null,x=null,B=null,y=ue,R=An}return}st=st||Me,Ot=Ot||De,on=on||et,(Me!==v||st!==G)&&(n.blendEquationSeparate(ee[Me],ee[st]),v=Me,G=st),(De!==b||et!==w||Ot!==x||on!==B)&&(n.blendFuncSeparate(le[De],le[et],le[Ot],le[on]),b=De,w=et,x=Ot,B=on),y=ue,R=!1}function be(ue,Me){ue.side===Di?se(2884):ge(2884);let De=ue.side===Bi;Me&&(De=!De),xe(De),ue.blending===Uh&&ue.transparent===!1?he(ei):he(ue.blending,ue.blendEquation,ue.blendSrc,ue.blendDst,ue.blendEquationAlpha,ue.blendSrcAlpha,ue.blendDstAlpha,ue.premultipliedAlpha),l.setFunc(ue.depthFunc),l.setTest(ue.depthTest),l.setMask(ue.depthWrite),a.setMask(ue.colorWrite);const et=ue.stencilWrite;c.setTest(et),et&&(c.setMask(ue.stencilWriteMask),c.setFunc(ue.stencilFunc,ue.stencilRef,ue.stencilFuncMask),c.setOp(ue.stencilFail,ue.stencilZFail,ue.stencilZPass)),ke(ue.polygonOffset,ue.polygonOffsetFactor,ue.polygonOffsetUnits),ue.alphaToCoverage===!0?ge(32926):se(32926)}function xe(ue){Z!==ue&&(ue?n.frontFace(2304):n.frontFace(2305),Z=ue)}function ze(ue){ue!==UQ?(ge(2884),ue!==W&&(ue===zE?n.cullFace(1029):ue===QQ?n.cullFace(1028):n.cullFace(1032))):se(2884),W=ue}function Se(ue){ue!==F&&(U&&n.lineWidth(ue),F=ue)}function ke(ue,Me,De){ue?(ge(32823),(T!==Me||V!==De)&&(n.polygonOffset(Me,De),T=Me,V=De)):se(32823)}function He(ue){ue?ge(3089):se(3089)}function Be(ue){ue===void 0&&(ue=33984+z-1),Y!==ue&&(n.activeTexture(ue),Y=ue)}function j(ue,Me,De){De===void 0&&(Y===null?De=33984+z-1:De=Y);let et=K[De];et===void 0&&(et={type:void 0,texture:void 0},K[De]=et),(et.type!==ue||et.texture!==Me)&&(Y!==De&&(n.activeTexture(De),Y=De),n.bindTexture(ue,Me||de[ue]),et.type=ue,et.texture=Me)}function X(){const ue=K[Y];ue!==void 0&&ue.type!==void 0&&(n.bindTexture(ue.type,null),ue.type=void 0,ue.texture=void 0)}function ce(){try{n.compressedTexImage2D.apply(n,arguments)}catch(ue){console.error("THREE.WebGLState:",ue)}}function fe(){try{n.compressedTexImage3D.apply(n,arguments)}catch(ue){console.error("THREE.WebGLState:",ue)}}function Ge(){try{n.texSubImage2D.apply(n,arguments)}catch(ue){console.error("THREE.WebGLState:",ue)}}function me(){try{n.texSubImage3D.apply(n,arguments)}catch(ue){console.error("THREE.WebGLState:",ue)}}function Fe(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(ue){console.error("THREE.WebGLState:",ue)}}function Le(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(ue){console.error("THREE.WebGLState:",ue)}}function Re(){try{n.texStorage2D.apply(n,arguments)}catch(ue){console.error("THREE.WebGLState:",ue)}}function Xe(){try{n.texStorage3D.apply(n,arguments)}catch(ue){console.error("THREE.WebGLState:",ue)}}function we(){try{n.texImage2D.apply(n,arguments)}catch(ue){console.error("THREE.WebGLState:",ue)}}function Ue(){try{n.texImage3D.apply(n,arguments)}catch(ue){console.error("THREE.WebGLState:",ue)}}function Pe(ue){ne.equals(ue)===!1&&(n.scissor(ue.x,ue.y,ue.z,ue.w),ne.copy(ue))}function Ye(ue){oe.equals(ue)===!1&&(n.viewport(ue.x,ue.y,ue.z,ue.w),oe.copy(ue))}function $e(ue,Me){let De=u.get(Me);De===void 0&&(De=new WeakMap,u.set(Me,De));let et=De.get(ue);et===void 0&&(et=n.getUniformBlockIndex(Me,ue.name),De.set(ue,et))}function mt(ue,Me){const et=u.get(Me).get(ue);g.get(Me)!==et&&(n.uniformBlockBinding(Me,et,ue.__bindingPointIndex),g.set(Me,et))}function Wt(){n.disable(3042),n.disable(2884),n.disable(2929),n.disable(32823),n.disable(3089),n.disable(2960),n.disable(32926),n.blendEquation(32774),n.blendFunc(1,0),n.blendFuncSeparate(1,0,1,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(513),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(519,0,4294967295),n.stencilOp(7680,7680,7680),n.clearStencil(0),n.cullFace(1029),n.frontFace(2305),n.polygonOffset(0,0),n.activeTexture(33984),n.bindFramebuffer(36160,null),i===!0&&(n.bindFramebuffer(36009,null),n.bindFramebuffer(36008,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),d={},Y=null,K={},h={},f=new WeakMap,I=[],A=null,p=!1,y=null,v=null,b=null,w=null,G=null,x=null,B=null,R=!1,Z=null,W=null,F=null,T=null,V=null,ne.set(0,0,n.canvas.width,n.canvas.height),oe.set(0,0,n.canvas.width,n.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:ge,disable:se,bindFramebuffer:k,drawBuffers:O,useProgram:q,setBlending:he,setMaterial:be,setFlipSided:xe,setCullFace:ze,setLineWidth:Se,setPolygonOffset:ke,setScissorTest:He,activeTexture:Be,bindTexture:j,unbindTexture:X,compressedTexImage2D:ce,compressedTexImage3D:fe,texImage2D:we,texImage3D:Ue,updateUBOMapping:$e,uniformBlockBinding:mt,texStorage2D:Re,texStorage3D:Xe,texSubImage2D:Ge,texSubImage3D:me,compressedTexSubImage2D:Fe,compressedTexSubImage3D:Le,scissor:Pe,viewport:Ye,reset:Wt}}function Ece(n,e,t,i,r,s,o){const a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,g=r.maxTextureSize,u=r.maxSamples,d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,h=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap;let I;const A=new WeakMap;let p=!1;try{p=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(j,X){return p?new OffscreenCanvas(j,X):yy("canvas")}function v(j,X,ce,fe){let Ge=1;if((j.width>fe||j.height>fe)&&(Ge=fe/Math.max(j.width,j.height)),Ge<1||X===!0)if(typeof HTMLImageElement<"u"&&j instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&j instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&j instanceof ImageBitmap){const me=X?_O:Math.floor,Fe=me(Ge*j.width),Le=me(Ge*j.height);I===void 0&&(I=y(Fe,Le));const Re=ce?y(Fe,Le):I;return Re.width=Fe,Re.height=Le,Re.getContext("2d").drawImage(j,0,0,Fe,Le),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+j.width+"x"+j.height+") to ("+Fe+"x"+Le+")."),Re}else return"data"in j&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+j.width+"x"+j.height+")."),j;return j}function b(j){return I3(j.width)&&I3(j.height)}function w(j){return a?!1:j.wrapS!==Ki||j.wrapT!==Ki||j.minFilter!==Zt&&j.minFilter!==ut}function G(j,X){return j.generateMipmaps&&X&&j.minFilter!==Zt&&j.minFilter!==ut}function x(j){n.generateMipmap(j)}function B(j,X,ce,fe,Ge=!1){if(a===!1)return X;if(j!==null){if(n[j]!==void 0)return n[j];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+j+"'")}let me=X;return X===6403&&(ce===5126&&(me=33326),ce===5131&&(me=33325),ce===5121&&(me=33321)),X===33319&&(ce===5126&&(me=33328),ce===5131&&(me=33327),ce===5121&&(me=33323)),X===6408&&(ce===5126&&(me=34836),ce===5131&&(me=34842),ce===5121&&(me=fe===Xt&&Ge===!1?35907:32856),ce===32819&&(me=32854),ce===32820&&(me=32855)),(me===33325||me===33326||me===33327||me===33328||me===34842||me===34836)&&e.get("EXT_color_buffer_float"),me}function R(j,X,ce){return G(j,ce)===!0||j.isFramebufferTexture&&j.minFilter!==Zt&&j.minFilter!==ut?Math.log2(Math.max(X.width,X.height))+1:j.mipmaps!==void 0&&j.mipmaps.length>0?j.mipmaps.length:j.isCompressedTexture&&Array.isArray(j.image)?X.mipmaps.length:1}function Z(j){return j===Zt||j===Ay||j===VA?9728:9729}function W(j){const X=j.target;X.removeEventListener("dispose",W),T(X),X.isVideoTexture&&f.delete(X)}function F(j){const X=j.target;X.removeEventListener("dispose",F),z(X)}function T(j){const X=i.get(j);if(X.__webglInit===void 0)return;const ce=j.source,fe=A.get(ce);if(fe){const Ge=fe[X.__cacheKey];Ge.usedTimes--,Ge.usedTimes===0&&V(j),Object.keys(fe).length===0&&A.delete(ce)}i.remove(j)}function V(j){const X=i.get(j);n.deleteTexture(X.__webglTexture);const ce=j.source,fe=A.get(ce);delete fe[X.__cacheKey],o.memory.textures--}function z(j){const X=j.texture,ce=i.get(j),fe=i.get(X);if(fe.__webglTexture!==void 0&&(n.deleteTexture(fe.__webglTexture),o.memory.textures--),j.depthTexture&&j.depthTexture.dispose(),j.isWebGLCubeRenderTarget)for(let Ge=0;Ge<6;Ge++)n.deleteFramebuffer(ce.__webglFramebuffer[Ge]),ce.__webglDepthbuffer&&n.deleteRenderbuffer(ce.__webglDepthbuffer[Ge]);else{if(n.deleteFramebuffer(ce.__webglFramebuffer),ce.__webglDepthbuffer&&n.deleteRenderbuffer(ce.__webglDepthbuffer),ce.__webglMultisampledFramebuffer&&n.deleteFramebuffer(ce.__webglMultisampledFramebuffer),ce.__webglColorRenderbuffer)for(let Ge=0;Ge<ce.__webglColorRenderbuffer.length;Ge++)ce.__webglColorRenderbuffer[Ge]&&n.deleteRenderbuffer(ce.__webglColorRenderbuffer[Ge]);ce.__webglDepthRenderbuffer&&n.deleteRenderbuffer(ce.__webglDepthRenderbuffer)}if(j.isWebGLMultipleRenderTargets)for(let Ge=0,me=X.length;Ge<me;Ge++){const Fe=i.get(X[Ge]);Fe.__webglTexture&&(n.deleteTexture(Fe.__webglTexture),o.memory.textures--),i.remove(X[Ge])}i.remove(X),i.remove(j)}let U=0;function J(){U=0}function H(){const j=U;return j>=l&&console.warn("THREE.WebGLTextures: Trying to use "+j+" texture units while this GPU supports only "+l),U+=1,j}function Y(j){const X=[];return X.push(j.wrapS),X.push(j.wrapT),X.push(j.wrapR||0),X.push(j.magFilter),X.push(j.minFilter),X.push(j.anisotropy),X.push(j.internalFormat),X.push(j.format),X.push(j.type),X.push(j.generateMipmaps),X.push(j.premultiplyAlpha),X.push(j.flipY),X.push(j.unpackAlignment),X.push(j.encoding),X.join()}function K(j,X){const ce=i.get(j);if(j.isVideoTexture&&He(j),j.isRenderTargetTexture===!1&&j.version>0&&ce.__version!==j.version){const fe=j.image;if(fe===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(fe.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{se(ce,j,X);return}}t.bindTexture(3553,ce.__webglTexture,33984+X)}function Q(j,X){const ce=i.get(j);if(j.version>0&&ce.__version!==j.version){se(ce,j,X);return}t.bindTexture(35866,ce.__webglTexture,33984+X)}function P(j,X){const ce=i.get(j);if(j.version>0&&ce.__version!==j.version){se(ce,j,X);return}t.bindTexture(32879,ce.__webglTexture,33984+X)}function ne(j,X){const ce=i.get(j);if(j.version>0&&ce.__version!==j.version){k(ce,j,X);return}t.bindTexture(34067,ce.__webglTexture,33984+X)}const oe={[ds]:10497,[Ki]:33071,[rC]:33648},$={[Zt]:9728,[Ay]:9984,[VA]:9986,[ut]:9729,[xw]:9985,[wc]:9987};function de(j,X,ce){if(ce?(n.texParameteri(j,10242,oe[X.wrapS]),n.texParameteri(j,10243,oe[X.wrapT]),(j===32879||j===35866)&&n.texParameteri(j,32882,oe[X.wrapR]),n.texParameteri(j,10240,$[X.magFilter]),n.texParameteri(j,10241,$[X.minFilter])):(n.texParameteri(j,10242,33071),n.texParameteri(j,10243,33071),(j===32879||j===35866)&&n.texParameteri(j,32882,33071),(X.wrapS!==Ki||X.wrapT!==Ki)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(j,10240,Z(X.magFilter)),n.texParameteri(j,10241,Z(X.minFilter)),X.minFilter!==Zt&&X.minFilter!==ut&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const fe=e.get("EXT_texture_filter_anisotropic");if(X.magFilter===Zt||X.minFilter!==VA&&X.minFilter!==wc||X.type===Hn&&e.has("OES_texture_float_linear")===!1||a===!1&&X.type===Pi&&e.has("OES_texture_half_float_linear")===!1)return;(X.anisotropy>1||i.get(X).__currentAnisotropy)&&(n.texParameterf(j,fe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(X.anisotropy,r.getMaxAnisotropy())),i.get(X).__currentAnisotropy=X.anisotropy)}}function ge(j,X){let ce=!1;j.__webglInit===void 0&&(j.__webglInit=!0,X.addEventListener("dispose",W));const fe=X.source;let Ge=A.get(fe);Ge===void 0&&(Ge={},A.set(fe,Ge));const me=Y(X);if(me!==j.__cacheKey){Ge[me]===void 0&&(Ge[me]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,ce=!0),Ge[me].usedTimes++;const Fe=Ge[j.__cacheKey];Fe!==void 0&&(Ge[j.__cacheKey].usedTimes--,Fe.usedTimes===0&&V(X)),j.__cacheKey=me,j.__webglTexture=Ge[me].texture}return ce}function se(j,X,ce){let fe=3553;(X.isDataArrayTexture||X.isCompressedArrayTexture)&&(fe=35866),X.isData3DTexture&&(fe=32879);const Ge=ge(j,X),me=X.source;t.bindTexture(fe,j.__webglTexture,33984+ce);const Fe=i.get(me);if(me.version!==Fe.__version||Ge===!0){t.activeTexture(33984+ce),n.pixelStorei(37440,X.flipY),n.pixelStorei(37441,X.premultiplyAlpha),n.pixelStorei(3317,X.unpackAlignment),n.pixelStorei(37443,0);const Le=w(X)&&b(X.image)===!1;let Re=v(X.image,Le,!1,g);Re=Be(X,Re);const Xe=b(Re)||a,we=s.convert(X.format,X.encoding);let Ue=s.convert(X.type),Pe=B(X.internalFormat,we,Ue,X.encoding,X.isVideoTexture);de(fe,X,Xe);let Ye;const $e=X.mipmaps,mt=a&&X.isVideoTexture!==!0,Wt=Fe.__version===void 0||Ge===!0,ue=R(X,Re,Xe);if(X.isDepthTexture)Pe=6402,a?X.type===Hn?Pe=36012:X.type===Sg?Pe=33190:X.type===sd?Pe=35056:Pe=33189:X.type===Hn&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),X.format===od&&Pe===6402&&X.type!==E_&&X.type!==Sg&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),X.type=Sg,Ue=s.convert(X.type)),X.format===Ad&&Pe===6402&&(Pe=34041,X.type!==sd&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),X.type=sd,Ue=s.convert(X.type))),Wt&&(mt?t.texStorage2D(3553,1,Pe,Re.width,Re.height):t.texImage2D(3553,0,Pe,Re.width,Re.height,0,we,Ue,null));else if(X.isDataTexture)if($e.length>0&&Xe){mt&&Wt&&t.texStorage2D(3553,ue,Pe,$e[0].width,$e[0].height);for(let Me=0,De=$e.length;Me<De;Me++)Ye=$e[Me],mt?t.texSubImage2D(3553,Me,0,0,Ye.width,Ye.height,we,Ue,Ye.data):t.texImage2D(3553,Me,Pe,Ye.width,Ye.height,0,we,Ue,Ye.data);X.generateMipmaps=!1}else mt?(Wt&&t.texStorage2D(3553,ue,Pe,Re.width,Re.height),t.texSubImage2D(3553,0,0,0,Re.width,Re.height,we,Ue,Re.data)):t.texImage2D(3553,0,Pe,Re.width,Re.height,0,we,Ue,Re.data);else if(X.isCompressedTexture)if(X.isCompressedArrayTexture){mt&&Wt&&t.texStorage3D(35866,ue,Pe,$e[0].width,$e[0].height,Re.depth);for(let Me=0,De=$e.length;Me<De;Me++)Ye=$e[Me],X.format!==Yn?we!==null?mt?t.compressedTexSubImage3D(35866,Me,0,0,0,Ye.width,Ye.height,Re.depth,we,Ye.data,0,0):t.compressedTexImage3D(35866,Me,Pe,Ye.width,Ye.height,Re.depth,0,Ye.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):mt?t.texSubImage3D(35866,Me,0,0,0,Ye.width,Ye.height,Re.depth,we,Ue,Ye.data):t.texImage3D(35866,Me,Pe,Ye.width,Ye.height,Re.depth,0,we,Ue,Ye.data)}else{mt&&Wt&&t.texStorage2D(3553,ue,Pe,$e[0].width,$e[0].height);for(let Me=0,De=$e.length;Me<De;Me++)Ye=$e[Me],X.format!==Yn?we!==null?mt?t.compressedTexSubImage2D(3553,Me,0,0,Ye.width,Ye.height,we,Ye.data):t.compressedTexImage2D(3553,Me,Pe,Ye.width,Ye.height,0,Ye.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):mt?t.texSubImage2D(3553,Me,0,0,Ye.width,Ye.height,we,Ue,Ye.data):t.texImage2D(3553,Me,Pe,Ye.width,Ye.height,0,we,Ue,Ye.data)}else if(X.isDataArrayTexture)mt?(Wt&&t.texStorage3D(35866,ue,Pe,Re.width,Re.height,Re.depth),t.texSubImage3D(35866,0,0,0,0,Re.width,Re.height,Re.depth,we,Ue,Re.data)):t.texImage3D(35866,0,Pe,Re.width,Re.height,Re.depth,0,we,Ue,Re.data);else if(X.isData3DTexture)mt?(Wt&&t.texStorage3D(32879,ue,Pe,Re.width,Re.height,Re.depth),t.texSubImage3D(32879,0,0,0,0,Re.width,Re.height,Re.depth,we,Ue,Re.data)):t.texImage3D(32879,0,Pe,Re.width,Re.height,Re.depth,0,we,Ue,Re.data);else if(X.isFramebufferTexture){if(Wt)if(mt)t.texStorage2D(3553,ue,Pe,Re.width,Re.height);else{let Me=Re.width,De=Re.height;for(let et=0;et<ue;et++)t.texImage2D(3553,et,Pe,Me,De,0,we,Ue,null),Me>>=1,De>>=1}}else if($e.length>0&&Xe){mt&&Wt&&t.texStorage2D(3553,ue,Pe,$e[0].width,$e[0].height);for(let Me=0,De=$e.length;Me<De;Me++)Ye=$e[Me],mt?t.texSubImage2D(3553,Me,0,0,we,Ue,Ye):t.texImage2D(3553,Me,Pe,we,Ue,Ye);X.generateMipmaps=!1}else mt?(Wt&&t.texStorage2D(3553,ue,Pe,Re.width,Re.height),t.texSubImage2D(3553,0,0,0,we,Ue,Re)):t.texImage2D(3553,0,Pe,we,Ue,Re);G(X,Xe)&&x(fe),Fe.__version=me.version,X.onUpdate&&X.onUpdate(X)}j.__version=X.version}function k(j,X,ce){if(X.image.length!==6)return;const fe=ge(j,X),Ge=X.source;t.bindTexture(34067,j.__webglTexture,33984+ce);const me=i.get(Ge);if(Ge.version!==me.__version||fe===!0){t.activeTexture(33984+ce),n.pixelStorei(37440,X.flipY),n.pixelStorei(37441,X.premultiplyAlpha),n.pixelStorei(3317,X.unpackAlignment),n.pixelStorei(37443,0);const Fe=X.isCompressedTexture||X.image[0].isCompressedTexture,Le=X.image[0]&&X.image[0].isDataTexture,Re=[];for(let Me=0;Me<6;Me++)!Fe&&!Le?Re[Me]=v(X.image[Me],!1,!0,c):Re[Me]=Le?X.image[Me].image:X.image[Me],Re[Me]=Be(X,Re[Me]);const Xe=Re[0],we=b(Xe)||a,Ue=s.convert(X.format,X.encoding),Pe=s.convert(X.type),Ye=B(X.internalFormat,Ue,Pe,X.encoding),$e=a&&X.isVideoTexture!==!0,mt=me.__version===void 0||fe===!0;let Wt=R(X,Xe,we);de(34067,X,we);let ue;if(Fe){$e&&mt&&t.texStorage2D(34067,Wt,Ye,Xe.width,Xe.height);for(let Me=0;Me<6;Me++){ue=Re[Me].mipmaps;for(let De=0;De<ue.length;De++){const et=ue[De];X.format!==Yn?Ue!==null?$e?t.compressedTexSubImage2D(34069+Me,De,0,0,et.width,et.height,Ue,et.data):t.compressedTexImage2D(34069+Me,De,Ye,et.width,et.height,0,et.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):$e?t.texSubImage2D(34069+Me,De,0,0,et.width,et.height,Ue,Pe,et.data):t.texImage2D(34069+Me,De,Ye,et.width,et.height,0,Ue,Pe,et.data)}}}else{ue=X.mipmaps,$e&&mt&&(ue.length>0&&Wt++,t.texStorage2D(34067,Wt,Ye,Re[0].width,Re[0].height));for(let Me=0;Me<6;Me++)if(Le){$e?t.texSubImage2D(34069+Me,0,0,0,Re[Me].width,Re[Me].height,Ue,Pe,Re[Me].data):t.texImage2D(34069+Me,0,Ye,Re[Me].width,Re[Me].height,0,Ue,Pe,Re[Me].data);for(let De=0;De<ue.length;De++){const st=ue[De].image[Me].image;$e?t.texSubImage2D(34069+Me,De+1,0,0,st.width,st.height,Ue,Pe,st.data):t.texImage2D(34069+Me,De+1,Ye,st.width,st.height,0,Ue,Pe,st.data)}}else{$e?t.texSubImage2D(34069+Me,0,0,0,Ue,Pe,Re[Me]):t.texImage2D(34069+Me,0,Ye,Ue,Pe,Re[Me]);for(let De=0;De<ue.length;De++){const et=ue[De];$e?t.texSubImage2D(34069+Me,De+1,0,0,Ue,Pe,et.image[Me]):t.texImage2D(34069+Me,De+1,Ye,Ue,Pe,et.image[Me])}}}G(X,we)&&x(34067),me.__version=Ge.version,X.onUpdate&&X.onUpdate(X)}j.__version=X.version}function O(j,X,ce,fe,Ge){const me=s.convert(ce.format,ce.encoding),Fe=s.convert(ce.type),Le=B(ce.internalFormat,me,Fe,ce.encoding);i.get(X).__hasExternalTextures||(Ge===32879||Ge===35866?t.texImage3D(Ge,0,Le,X.width,X.height,X.depth,0,me,Fe,null):t.texImage2D(Ge,0,Le,X.width,X.height,0,me,Fe,null)),t.bindFramebuffer(36160,j),ke(X)?d.framebufferTexture2DMultisampleEXT(36160,fe,Ge,i.get(ce).__webglTexture,0,Se(X)):(Ge===3553||Ge>=34069&&Ge<=34074)&&n.framebufferTexture2D(36160,fe,Ge,i.get(ce).__webglTexture,0),t.bindFramebuffer(36160,null)}function q(j,X,ce){if(n.bindRenderbuffer(36161,j),X.depthBuffer&&!X.stencilBuffer){let fe=33189;if(ce||ke(X)){const Ge=X.depthTexture;Ge&&Ge.isDepthTexture&&(Ge.type===Hn?fe=36012:Ge.type===Sg&&(fe=33190));const me=Se(X);ke(X)?d.renderbufferStorageMultisampleEXT(36161,me,fe,X.width,X.height):n.renderbufferStorageMultisample(36161,me,fe,X.width,X.height)}else n.renderbufferStorage(36161,fe,X.width,X.height);n.framebufferRenderbuffer(36160,36096,36161,j)}else if(X.depthBuffer&&X.stencilBuffer){const fe=Se(X);ce&&ke(X)===!1?n.renderbufferStorageMultisample(36161,fe,35056,X.width,X.height):ke(X)?d.renderbufferStorageMultisampleEXT(36161,fe,35056,X.width,X.height):n.renderbufferStorage(36161,34041,X.width,X.height),n.framebufferRenderbuffer(36160,33306,36161,j)}else{const fe=X.isWebGLMultipleRenderTargets===!0?X.texture:[X.texture];for(let Ge=0;Ge<fe.length;Ge++){const me=fe[Ge],Fe=s.convert(me.format,me.encoding),Le=s.convert(me.type),Re=B(me.internalFormat,Fe,Le,me.encoding),Xe=Se(X);ce&&ke(X)===!1?n.renderbufferStorageMultisample(36161,Xe,Re,X.width,X.height):ke(X)?d.renderbufferStorageMultisampleEXT(36161,Xe,Re,X.width,X.height):n.renderbufferStorage(36161,Re,X.width,X.height)}}n.bindRenderbuffer(36161,null)}function ee(j,X){if(X&&X.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,j),!(X.depthTexture&&X.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(X.depthTexture).__webglTexture||X.depthTexture.image.width!==X.width||X.depthTexture.image.height!==X.height)&&(X.depthTexture.image.width=X.width,X.depthTexture.image.height=X.height,X.depthTexture.needsUpdate=!0),K(X.depthTexture,0);const fe=i.get(X.depthTexture).__webglTexture,Ge=Se(X);if(X.depthTexture.format===od)ke(X)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,fe,0,Ge):n.framebufferTexture2D(36160,36096,3553,fe,0);else if(X.depthTexture.format===Ad)ke(X)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,fe,0,Ge):n.framebufferTexture2D(36160,33306,3553,fe,0);else throw new Error("Unknown depthTexture format")}function le(j){const X=i.get(j),ce=j.isWebGLCubeRenderTarget===!0;if(j.depthTexture&&!X.__autoAllocateDepthBuffer){if(ce)throw new Error("target.depthTexture not supported in Cube render targets");ee(X.__webglFramebuffer,j)}else if(ce){X.__webglDepthbuffer=[];for(let fe=0;fe<6;fe++)t.bindFramebuffer(36160,X.__webglFramebuffer[fe]),X.__webglDepthbuffer[fe]=n.createRenderbuffer(),q(X.__webglDepthbuffer[fe],j,!1)}else t.bindFramebuffer(36160,X.__webglFramebuffer),X.__webglDepthbuffer=n.createRenderbuffer(),q(X.__webglDepthbuffer,j,!1);t.bindFramebuffer(36160,null)}function he(j,X,ce){const fe=i.get(j);X!==void 0&&O(fe.__webglFramebuffer,j,j.texture,36064,3553),ce!==void 0&&le(j)}function be(j){const X=j.texture,ce=i.get(j),fe=i.get(X);j.addEventListener("dispose",F),j.isWebGLMultipleRenderTargets!==!0&&(fe.__webglTexture===void 0&&(fe.__webglTexture=n.createTexture()),fe.__version=X.version,o.memory.textures++);const Ge=j.isWebGLCubeRenderTarget===!0,me=j.isWebGLMultipleRenderTargets===!0,Fe=b(j)||a;if(Ge){ce.__webglFramebuffer=[];for(let Le=0;Le<6;Le++)ce.__webglFramebuffer[Le]=n.createFramebuffer()}else{if(ce.__webglFramebuffer=n.createFramebuffer(),me)if(r.drawBuffers){const Le=j.texture;for(let Re=0,Xe=Le.length;Re<Xe;Re++){const we=i.get(Le[Re]);we.__webglTexture===void 0&&(we.__webglTexture=n.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&j.samples>0&&ke(j)===!1){const Le=me?X:[X];ce.__webglMultisampledFramebuffer=n.createFramebuffer(),ce.__webglColorRenderbuffer=[],t.bindFramebuffer(36160,ce.__webglMultisampledFramebuffer);for(let Re=0;Re<Le.length;Re++){const Xe=Le[Re];ce.__webglColorRenderbuffer[Re]=n.createRenderbuffer(),n.bindRenderbuffer(36161,ce.__webglColorRenderbuffer[Re]);const we=s.convert(Xe.format,Xe.encoding),Ue=s.convert(Xe.type),Pe=B(Xe.internalFormat,we,Ue,Xe.encoding,j.isXRRenderTarget===!0),Ye=Se(j);n.renderbufferStorageMultisample(36161,Ye,Pe,j.width,j.height),n.framebufferRenderbuffer(36160,36064+Re,36161,ce.__webglColorRenderbuffer[Re])}n.bindRenderbuffer(36161,null),j.depthBuffer&&(ce.__webglDepthRenderbuffer=n.createRenderbuffer(),q(ce.__webglDepthRenderbuffer,j,!0)),t.bindFramebuffer(36160,null)}}if(Ge){t.bindTexture(34067,fe.__webglTexture),de(34067,X,Fe);for(let Le=0;Le<6;Le++)O(ce.__webglFramebuffer[Le],j,X,36064,34069+Le);G(X,Fe)&&x(34067),t.unbindTexture()}else if(me){const Le=j.texture;for(let Re=0,Xe=Le.length;Re<Xe;Re++){const we=Le[Re],Ue=i.get(we);t.bindTexture(3553,Ue.__webglTexture),de(3553,we,Fe),O(ce.__webglFramebuffer,j,we,36064+Re,3553),G(we,Fe)&&x(3553)}t.unbindTexture()}else{let Le=3553;(j.isWebGL3DRenderTarget||j.isWebGLArrayRenderTarget)&&(a?Le=j.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(Le,fe.__webglTexture),de(Le,X,Fe),O(ce.__webglFramebuffer,j,X,36064,Le),G(X,Fe)&&x(Le),t.unbindTexture()}j.depthBuffer&&le(j)}function xe(j){const X=b(j)||a,ce=j.isWebGLMultipleRenderTargets===!0?j.texture:[j.texture];for(let fe=0,Ge=ce.length;fe<Ge;fe++){const me=ce[fe];if(G(me,X)){const Fe=j.isWebGLCubeRenderTarget?34067:3553,Le=i.get(me).__webglTexture;t.bindTexture(Fe,Le),x(Fe),t.unbindTexture()}}}function ze(j){if(a&&j.samples>0&&ke(j)===!1){const X=j.isWebGLMultipleRenderTargets?j.texture:[j.texture],ce=j.width,fe=j.height;let Ge=16384;const me=[],Fe=j.stencilBuffer?33306:36096,Le=i.get(j),Re=j.isWebGLMultipleRenderTargets===!0;if(Re)for(let Xe=0;Xe<X.length;Xe++)t.bindFramebuffer(36160,Le.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+Xe,36161,null),t.bindFramebuffer(36160,Le.__webglFramebuffer),n.framebufferTexture2D(36009,36064+Xe,3553,null,0);t.bindFramebuffer(36008,Le.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,Le.__webglFramebuffer);for(let Xe=0;Xe<X.length;Xe++){me.push(36064+Xe),j.depthBuffer&&me.push(Fe);const we=Le.__ignoreDepthValues!==void 0?Le.__ignoreDepthValues:!1;if(we===!1&&(j.depthBuffer&&(Ge|=256),j.stencilBuffer&&(Ge|=1024)),Re&&n.framebufferRenderbuffer(36008,36064,36161,Le.__webglColorRenderbuffer[Xe]),we===!0&&(n.invalidateFramebuffer(36008,[Fe]),n.invalidateFramebuffer(36009,[Fe])),Re){const Ue=i.get(X[Xe]).__webglTexture;n.framebufferTexture2D(36009,36064,3553,Ue,0)}n.blitFramebuffer(0,0,ce,fe,0,0,ce,fe,Ge,9728),h&&n.invalidateFramebuffer(36008,me)}if(t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,null),Re)for(let Xe=0;Xe<X.length;Xe++){t.bindFramebuffer(36160,Le.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+Xe,36161,Le.__webglColorRenderbuffer[Xe]);const we=i.get(X[Xe]).__webglTexture;t.bindFramebuffer(36160,Le.__webglFramebuffer),n.framebufferTexture2D(36009,36064+Xe,3553,we,0)}t.bindFramebuffer(36009,Le.__webglMultisampledFramebuffer)}}function Se(j){return Math.min(u,j.samples)}function ke(j){const X=i.get(j);return a&&j.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&X.__useRenderToTexture!==!1}function He(j){const X=o.render.frame;f.get(j)!==X&&(f.set(j,X),j.update())}function Be(j,X){const ce=j.encoding,fe=j.format,Ge=j.type;return j.isCompressedTexture===!0||j.isVideoTexture===!0||j.format===f2||ce!==ta&&(ce===Xt?a===!1?e.has("EXT_sRGB")===!0&&fe===Yn?(j.format=f2,j.minFilter=ut,j.generateMipmaps=!1):X=N_.sRGBToLinear(X):(fe!==Yn||Ge!==Dn)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",ce)),X}this.allocateTextureUnit=H,this.resetTextureUnits=J,this.setTexture2D=K,this.setTexture2DArray=Q,this.setTexture3D=P,this.setTextureCube=ne,this.rebindTextures=he,this.setupRenderTarget=be,this.updateRenderTargetMipmap=xe,this.updateMultisampleRenderTarget=ze,this.setupDepthRenderbuffer=le,this.setupFrameBufferTexture=O,this.useMultisampledRTT=ke}function JO(n,e,t){const i=t.isWebGL2;function r(s,o=null){let a;if(s===Dn)return 5121;if(s===CO)return 32819;if(s===pO)return 32820;if(s===fO)return 5120;if(s===IO)return 5122;if(s===E_)return 5123;if(s===AO)return 5124;if(s===Sg)return 5125;if(s===Hn)return 5126;if(s===Pi)return i?5131:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(s===mO)return 6406;if(s===Yn)return 6408;if(s===Sw)return 6409;if(s===yO)return 6410;if(s===od)return 6402;if(s===Ad)return 34041;if(s===f2)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(s===Rw)return 6403;if(s===vO)return 36244;if(s===W_)return 33319;if(s===bO)return 33320;if(s===BO)return 36249;if(s===s1||s===o1||s===a1||s===l1)if(o===Xt)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(s===s1)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===o1)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===a1)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===l1)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(s===s1)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===o1)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===a1)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===l1)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===PE||s===UE||s===QE||s===OE)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(s===PE)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===UE)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===QE)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===OE)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===GO)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===JE||s===jE)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(s===JE)return o===Xt?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(s===jE)return o===Xt?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===qE||s===$E||s===e3||s===t3||s===n3||s===i3||s===r3||s===s3||s===o3||s===a3||s===l3||s===c3||s===g3||s===u3)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(s===qE)return o===Xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===$E)return o===Xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===e3)return o===Xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===t3)return o===Xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===n3)return o===Xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===i3)return o===Xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===r3)return o===Xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===s3)return o===Xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===o3)return o===Xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===a3)return o===Xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===l3)return o===Xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===c3)return o===Xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===g3)return o===Xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===u3)return o===Xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===c1)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(s===c1)return o===Xt?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(s===wO||s===d3||s===h3||s===f3)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(s===c1)return a.COMPRESSED_RED_RGTC1_EXT;if(s===d3)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===h3)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===f3)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===sd?i?34042:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):n[s]!==void 0?n[s]:null}return{convert:r}}class jO extends zn{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class ho extends In{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Wce={type:"move"};class ZR{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ho,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ho,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new D,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new D),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ho,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new D,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new D),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const I of e.hand.values()){const A=t.getJointPose(I,i),p=this._getHandJoint(c,I);A!==null&&(p.matrix.fromArray(A.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.jointRadius=A.radius),p.visible=A!==null}const g=c.joints["index-finger-tip"],u=c.joints["thumb-tip"],d=g.position.distanceTo(u.position),h=.02,f=.005;c.inputState.pinching&&d>h+f?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&d<=h-f&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&s!==null&&(r=s),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Wce)))}return a!==null&&(a.visible=r!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new ho;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class av extends Pn{constructor(e,t,i,r,s,o,a,l,c,g){if(g=g!==void 0?g:od,g!==od&&g!==Ad)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&g===od&&(i=Sg),i===void 0&&g===Ad&&(i=sd),super(null,r,s,o,a,l,g,i,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:Zt,this.minFilter=l!==void 0?l:Zt,this.flipY=!1,this.generateMipmaps=!1}}class Fce extends aa{constructor(e,t){super();const i=this;let r=null,s=1,o=null,a="local-floor",l=1,c=null,g=null,u=null,d=null,h=null,f=null;const I=t.getContextAttributes();let A=null,p=null;const y=[],v=[],b=new Set,w=new Map,G=new zn;G.layers.enable(1),G.viewport=new Lt;const x=new zn;x.layers.enable(2),x.viewport=new Lt;const B=[G,x],R=new jO;R.layers.enable(1),R.layers.enable(2);let Z=null,W=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(P){let ne=y[P];return ne===void 0&&(ne=new ZR,y[P]=ne),ne.getTargetRaySpace()},this.getControllerGrip=function(P){let ne=y[P];return ne===void 0&&(ne=new ZR,y[P]=ne),ne.getGripSpace()},this.getHand=function(P){let ne=y[P];return ne===void 0&&(ne=new ZR,y[P]=ne),ne.getHandSpace()};function F(P){const ne=v.indexOf(P.inputSource);if(ne===-1)return;const oe=y[ne];oe!==void 0&&oe.dispatchEvent({type:P.type,data:P.inputSource})}function T(){r.removeEventListener("select",F),r.removeEventListener("selectstart",F),r.removeEventListener("selectend",F),r.removeEventListener("squeeze",F),r.removeEventListener("squeezestart",F),r.removeEventListener("squeezeend",F),r.removeEventListener("end",T),r.removeEventListener("inputsourceschange",V);for(let P=0;P<y.length;P++){const ne=v[P];ne!==null&&(v[P]=null,y[P].disconnect(ne))}Z=null,W=null,e.setRenderTarget(A),h=null,d=null,u=null,r=null,p=null,Q.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(P){s=P,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(P){a=P,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(P){c=P},this.getBaseLayer=function(){return d!==null?d:h},this.getBinding=function(){return u},this.getFrame=function(){return f},this.getSession=function(){return r},this.setSession=async function(P){if(r=P,r!==null){if(A=e.getRenderTarget(),r.addEventListener("select",F),r.addEventListener("selectstart",F),r.addEventListener("selectend",F),r.addEventListener("squeeze",F),r.addEventListener("squeezestart",F),r.addEventListener("squeezeend",F),r.addEventListener("end",T),r.addEventListener("inputsourceschange",V),I.xrCompatible!==!0&&await t.makeXRCompatible(),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const ne={antialias:r.renderState.layers===void 0?I.antialias:!0,alpha:I.alpha,depth:I.depth,stencil:I.stencil,framebufferScaleFactor:s};h=new XRWebGLLayer(r,t,ne),r.updateRenderState({baseLayer:h}),p=new Qt(h.framebufferWidth,h.framebufferHeight,{format:Yn,type:Dn,encoding:e.outputEncoding,stencilBuffer:I.stencil})}else{let ne=null,oe=null,$=null;I.depth&&($=I.stencil?35056:33190,ne=I.stencil?Ad:od,oe=I.stencil?sd:Sg);const de={colorFormat:32856,depthFormat:$,scaleFactor:s};u=new XRWebGLBinding(r,t),d=u.createProjectionLayer(de),r.updateRenderState({layers:[d]}),p=new Qt(d.textureWidth,d.textureHeight,{format:Yn,type:Dn,depthTexture:new av(d.textureWidth,d.textureHeight,oe,void 0,void 0,void 0,void 0,void 0,void 0,ne),stencilBuffer:I.stencil,encoding:e.outputEncoding,samples:I.antialias?4:0});const ge=e.properties.get(p);ge.__ignoreDepthValues=d.ignoreDepthValues}p.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await r.requestReferenceSpace(a),Q.setContext(r),Q.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function V(P){for(let ne=0;ne<P.removed.length;ne++){const oe=P.removed[ne],$=v.indexOf(oe);$>=0&&(v[$]=null,y[$].disconnect(oe))}for(let ne=0;ne<P.added.length;ne++){const oe=P.added[ne];let $=v.indexOf(oe);if($===-1){for(let ge=0;ge<y.length;ge++)if(ge>=v.length){v.push(oe),$=ge;break}else if(v[ge]===null){v[ge]=oe,$=ge;break}if($===-1)break}const de=y[$];de&&de.connect(oe)}}const z=new D,U=new D;function J(P,ne,oe){z.setFromMatrixPosition(ne.matrixWorld),U.setFromMatrixPosition(oe.matrixWorld);const $=z.distanceTo(U),de=ne.projectionMatrix.elements,ge=oe.projectionMatrix.elements,se=de[14]/(de[10]-1),k=de[14]/(de[10]+1),O=(de[9]+1)/de[5],q=(de[9]-1)/de[5],ee=(de[8]-1)/de[0],le=(ge[8]+1)/ge[0],he=se*ee,be=se*le,xe=$/(-ee+le),ze=xe*-ee;ne.matrixWorld.decompose(P.position,P.quaternion,P.scale),P.translateX(ze),P.translateZ(xe),P.matrixWorld.compose(P.position,P.quaternion,P.scale),P.matrixWorldInverse.copy(P.matrixWorld).invert();const Se=se+xe,ke=k+xe,He=he-ze,Be=be+($-ze),j=O*k/ke*Se,X=q*k/ke*Se;P.projectionMatrix.makePerspective(He,Be,j,X,Se,ke)}function H(P,ne){ne===null?P.matrixWorld.copy(P.matrix):P.matrixWorld.multiplyMatrices(ne.matrixWorld,P.matrix),P.matrixWorldInverse.copy(P.matrixWorld).invert()}this.updateCamera=function(P){if(r===null)return;R.near=x.near=G.near=P.near,R.far=x.far=G.far=P.far,(Z!==R.near||W!==R.far)&&(r.updateRenderState({depthNear:R.near,depthFar:R.far}),Z=R.near,W=R.far);const ne=P.parent,oe=R.cameras;H(R,ne);for(let de=0;de<oe.length;de++)H(oe[de],ne);R.matrixWorld.decompose(R.position,R.quaternion,R.scale),P.matrix.copy(R.matrix),P.matrix.decompose(P.position,P.quaternion,P.scale);const $=P.children;for(let de=0,ge=$.length;de<ge;de++)$[de].updateMatrixWorld(!0);oe.length===2?J(R,G,x):R.projectionMatrix.copy(G.projectionMatrix)},this.getCamera=function(){return R},this.getFoveation=function(){if(!(d===null&&h===null))return l},this.setFoveation=function(P){l=P,d!==null&&(d.fixedFoveation=P),h!==null&&h.fixedFoveation!==void 0&&(h.fixedFoveation=P)},this.getPlanes=function(){return b};let Y=null;function K(P,ne){if(g=ne.getViewerPose(c||o),f=ne,g!==null){const oe=g.views;h!==null&&(e.setRenderTargetFramebuffer(p,h.framebuffer),e.setRenderTarget(p));let $=!1;oe.length!==R.cameras.length&&(R.cameras.length=0,$=!0);for(let de=0;de<oe.length;de++){const ge=oe[de];let se=null;if(h!==null)se=h.getViewport(ge);else{const O=u.getViewSubImage(d,ge);se=O.viewport,de===0&&(e.setRenderTargetTextures(p,O.colorTexture,d.ignoreDepthValues?void 0:O.depthStencilTexture),e.setRenderTarget(p))}let k=B[de];k===void 0&&(k=new zn,k.layers.enable(de),k.viewport=new Lt,B[de]=k),k.matrix.fromArray(ge.transform.matrix),k.projectionMatrix.fromArray(ge.projectionMatrix),k.viewport.set(se.x,se.y,se.width,se.height),de===0&&R.matrix.copy(k.matrix),$===!0&&R.cameras.push(k)}}for(let oe=0;oe<y.length;oe++){const $=v[oe],de=y[oe];$!==null&&de!==void 0&&de.update($,ne,c||o)}if(Y&&Y(P,ne),ne.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:ne.detectedPlanes});let oe=null;for(const $ of b)ne.detectedPlanes.has($)||(oe===null&&(oe=[]),oe.push($));if(oe!==null)for(const $ of oe)b.delete($),w.delete($),i.dispatchEvent({type:"planeremoved",data:$});for(const $ of ne.detectedPlanes)if(!b.has($))b.add($),w.set($,ne.lastChangedTime),i.dispatchEvent({type:"planeadded",data:$});else{const de=w.get($);$.lastChangedTime>de&&(w.set($,$.lastChangedTime),i.dispatchEvent({type:"planechanged",data:$}))}}f=null}const Q=new DO;Q.setAnimationLoop(K),this.setAnimationLoop=function(P){Y=P},this.dispose=function(){}}}function _ce(n,e){function t(I,A){A.color.getRGB(I.fogColor.value,KO(n)),A.isFog?(I.fogNear.value=A.near,I.fogFar.value=A.far):A.isFogExp2&&(I.fogDensity.value=A.density)}function i(I,A,p,y,v){A.isMeshBasicMaterial||A.isMeshLambertMaterial?r(I,A):A.isMeshToonMaterial?(r(I,A),g(I,A)):A.isMeshPhongMaterial?(r(I,A),c(I,A)):A.isMeshStandardMaterial?(r(I,A),u(I,A),A.isMeshPhysicalMaterial&&d(I,A,v)):A.isMeshMatcapMaterial?(r(I,A),h(I,A)):A.isMeshDepthMaterial?r(I,A):A.isMeshDistanceMaterial?(r(I,A),f(I,A)):A.isMeshNormalMaterial?r(I,A):A.isLineBasicMaterial?(s(I,A),A.isLineDashedMaterial&&o(I,A)):A.isPointsMaterial?a(I,A,p,y):A.isSpriteMaterial?l(I,A):A.isShadowMaterial?(I.color.value.copy(A.color),I.opacity.value=A.opacity):A.isShaderMaterial&&(A.uniformsNeedUpdate=!1)}function r(I,A){I.opacity.value=A.opacity,A.color&&I.diffuse.value.copy(A.color),A.emissive&&I.emissive.value.copy(A.emissive).multiplyScalar(A.emissiveIntensity),A.map&&(I.map.value=A.map),A.alphaMap&&(I.alphaMap.value=A.alphaMap),A.bumpMap&&(I.bumpMap.value=A.bumpMap,I.bumpScale.value=A.bumpScale,A.side===Bi&&(I.bumpScale.value*=-1)),A.displacementMap&&(I.displacementMap.value=A.displacementMap,I.displacementScale.value=A.displacementScale,I.displacementBias.value=A.displacementBias),A.emissiveMap&&(I.emissiveMap.value=A.emissiveMap),A.normalMap&&(I.normalMap.value=A.normalMap,I.normalScale.value.copy(A.normalScale),A.side===Bi&&I.normalScale.value.negate()),A.specularMap&&(I.specularMap.value=A.specularMap),A.alphaTest>0&&(I.alphaTest.value=A.alphaTest);const p=e.get(A).envMap;if(p&&(I.envMap.value=p,I.flipEnvMap.value=p.isCubeTexture&&p.isRenderTargetTexture===!1?-1:1,I.reflectivity.value=A.reflectivity,I.ior.value=A.ior,I.refractionRatio.value=A.refractionRatio),A.lightMap){I.lightMap.value=A.lightMap;const b=n.useLegacyLights===!0?Math.PI:1;I.lightMapIntensity.value=A.lightMapIntensity*b}A.aoMap&&(I.aoMap.value=A.aoMap,I.aoMapIntensity.value=A.aoMapIntensity);let y;A.map?y=A.map:A.specularMap?y=A.specularMap:A.displacementMap?y=A.displacementMap:A.normalMap?y=A.normalMap:A.bumpMap?y=A.bumpMap:A.roughnessMap?y=A.roughnessMap:A.metalnessMap?y=A.metalnessMap:A.alphaMap?y=A.alphaMap:A.emissiveMap?y=A.emissiveMap:A.clearcoatMap?y=A.clearcoatMap:A.clearcoatNormalMap?y=A.clearcoatNormalMap:A.clearcoatRoughnessMap?y=A.clearcoatRoughnessMap:A.iridescenceMap?y=A.iridescenceMap:A.iridescenceThicknessMap?y=A.iridescenceThicknessMap:A.specularIntensityMap?y=A.specularIntensityMap:A.specularColorMap?y=A.specularColorMap:A.transmissionMap?y=A.transmissionMap:A.thicknessMap?y=A.thicknessMap:A.sheenColorMap?y=A.sheenColorMap:A.sheenRoughnessMap&&(y=A.sheenRoughnessMap),y!==void 0&&(y.isWebGLRenderTarget&&(y=y.texture),y.matrixAutoUpdate===!0&&y.updateMatrix(),I.uvTransform.value.copy(y.matrix));let v;A.aoMap?v=A.aoMap:A.lightMap&&(v=A.lightMap),v!==void 0&&(v.isWebGLRenderTarget&&(v=v.texture),v.matrixAutoUpdate===!0&&v.updateMatrix(),I.uv2Transform.value.copy(v.matrix))}function s(I,A){I.diffuse.value.copy(A.color),I.opacity.value=A.opacity}function o(I,A){I.dashSize.value=A.dashSize,I.totalSize.value=A.dashSize+A.gapSize,I.scale.value=A.scale}function a(I,A,p,y){I.diffuse.value.copy(A.color),I.opacity.value=A.opacity,I.size.value=A.size*p,I.scale.value=y*.5,A.map&&(I.map.value=A.map),A.alphaMap&&(I.alphaMap.value=A.alphaMap),A.alphaTest>0&&(I.alphaTest.value=A.alphaTest);let v;A.map?v=A.map:A.alphaMap&&(v=A.alphaMap),v!==void 0&&(v.matrixAutoUpdate===!0&&v.updateMatrix(),I.uvTransform.value.copy(v.matrix))}function l(I,A){I.diffuse.value.copy(A.color),I.opacity.value=A.opacity,I.rotation.value=A.rotation,A.map&&(I.map.value=A.map),A.alphaMap&&(I.alphaMap.value=A.alphaMap),A.alphaTest>0&&(I.alphaTest.value=A.alphaTest);let p;A.map?p=A.map:A.alphaMap&&(p=A.alphaMap),p!==void 0&&(p.matrixAutoUpdate===!0&&p.updateMatrix(),I.uvTransform.value.copy(p.matrix))}function c(I,A){I.specular.value.copy(A.specular),I.shininess.value=Math.max(A.shininess,1e-4)}function g(I,A){A.gradientMap&&(I.gradientMap.value=A.gradientMap)}function u(I,A){I.roughness.value=A.roughness,I.metalness.value=A.metalness,A.roughnessMap&&(I.roughnessMap.value=A.roughnessMap),A.metalnessMap&&(I.metalnessMap.value=A.metalnessMap),e.get(A).envMap&&(I.envMapIntensity.value=A.envMapIntensity)}function d(I,A,p){I.ior.value=A.ior,A.sheen>0&&(I.sheenColor.value.copy(A.sheenColor).multiplyScalar(A.sheen),I.sheenRoughness.value=A.sheenRoughness,A.sheenColorMap&&(I.sheenColorMap.value=A.sheenColorMap),A.sheenRoughnessMap&&(I.sheenRoughnessMap.value=A.sheenRoughnessMap)),A.clearcoat>0&&(I.clearcoat.value=A.clearcoat,I.clearcoatRoughness.value=A.clearcoatRoughness,A.clearcoatMap&&(I.clearcoatMap.value=A.clearcoatMap),A.clearcoatRoughnessMap&&(I.clearcoatRoughnessMap.value=A.clearcoatRoughnessMap),A.clearcoatNormalMap&&(I.clearcoatNormalScale.value.copy(A.clearcoatNormalScale),I.clearcoatNormalMap.value=A.clearcoatNormalMap,A.side===Bi&&I.clearcoatNormalScale.value.negate())),A.iridescence>0&&(I.iridescence.value=A.iridescence,I.iridescenceIOR.value=A.iridescenceIOR,I.iridescenceThicknessMinimum.value=A.iridescenceThicknessRange[0],I.iridescenceThicknessMaximum.value=A.iridescenceThicknessRange[1],A.iridescenceMap&&(I.iridescenceMap.value=A.iridescenceMap),A.iridescenceThicknessMap&&(I.iridescenceThicknessMap.value=A.iridescenceThicknessMap)),A.transmission>0&&(I.transmission.value=A.transmission,I.transmissionSamplerMap.value=p.texture,I.transmissionSamplerSize.value.set(p.width,p.height),A.transmissionMap&&(I.transmissionMap.value=A.transmissionMap),I.thickness.value=A.thickness,A.thicknessMap&&(I.thicknessMap.value=A.thicknessMap),I.attenuationDistance.value=A.attenuationDistance,I.attenuationColor.value.copy(A.attenuationColor)),I.specularIntensity.value=A.specularIntensity,I.specularColor.value.copy(A.specularColor),A.specularIntensityMap&&(I.specularIntensityMap.value=A.specularIntensityMap),A.specularColorMap&&(I.specularColorMap.value=A.specularColorMap)}function h(I,A){A.matcap&&(I.matcap.value=A.matcap)}function f(I,A){I.referencePosition.value.copy(A.referencePosition),I.nearDistance.value=A.nearDistance,I.farDistance.value=A.farDistance}return{refreshFogUniforms:t,refreshMaterialUniforms:i}}function Vce(n,e,t,i){let r={},s={},o=[];const a=t.isWebGL2?n.getParameter(35375):0;function l(y,v){const b=v.program;i.uniformBlockBinding(y,b)}function c(y,v){let b=r[y.id];b===void 0&&(f(y),b=g(y),r[y.id]=b,y.addEventListener("dispose",A));const w=v.program;i.updateUBOMapping(y,w);const G=e.render.frame;s[y.id]!==G&&(d(y),s[y.id]=G)}function g(y){const v=u();y.__bindingPointIndex=v;const b=n.createBuffer(),w=y.__size,G=y.usage;return n.bindBuffer(35345,b),n.bufferData(35345,w,G),n.bindBuffer(35345,null),n.bindBufferBase(35345,v,b),b}function u(){for(let y=0;y<a;y++)if(o.indexOf(y)===-1)return o.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(y){const v=r[y.id],b=y.uniforms,w=y.__cache;n.bindBuffer(35345,v);for(let G=0,x=b.length;G<x;G++){const B=b[G];if(h(B,G,w)===!0){const R=B.__offset,Z=Array.isArray(B.value)?B.value:[B.value];let W=0;for(let F=0;F<Z.length;F++){const T=Z[F],V=I(T);typeof T=="number"?(B.__data[0]=T,n.bufferSubData(35345,R+W,B.__data)):T.isMatrix3?(B.__data[0]=T.elements[0],B.__data[1]=T.elements[1],B.__data[2]=T.elements[2],B.__data[3]=T.elements[0],B.__data[4]=T.elements[3],B.__data[5]=T.elements[4],B.__data[6]=T.elements[5],B.__data[7]=T.elements[0],B.__data[8]=T.elements[6],B.__data[9]=T.elements[7],B.__data[10]=T.elements[8],B.__data[11]=T.elements[0]):(T.toArray(B.__data,W),W+=V.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(35345,R,B.__data)}}n.bindBuffer(35345,null)}function h(y,v,b){const w=y.value;if(b[v]===void 0){if(typeof w=="number")b[v]=w;else{const G=Array.isArray(w)?w:[w],x=[];for(let B=0;B<G.length;B++)x.push(G[B].clone());b[v]=x}return!0}else if(typeof w=="number"){if(b[v]!==w)return b[v]=w,!0}else{const G=Array.isArray(b[v])?b[v]:[b[v]],x=Array.isArray(w)?w:[w];for(let B=0;B<G.length;B++){const R=G[B];if(R.equals(x[B])===!1)return R.copy(x[B]),!0}}return!1}function f(y){const v=y.uniforms;let b=0;const w=16;let G=0;for(let x=0,B=v.length;x<B;x++){const R=v[x],Z={boundary:0,storage:0},W=Array.isArray(R.value)?R.value:[R.value];for(let F=0,T=W.length;F<T;F++){const V=W[F],z=I(V);Z.boundary+=z.boundary,Z.storage+=z.storage}if(R.__data=new Float32Array(Z.storage/Float32Array.BYTES_PER_ELEMENT),R.__offset=b,x>0){G=b%w;const F=w-G;G!==0&&F-Z.boundary<0&&(b+=w-G,R.__offset=b)}b+=Z.storage}return G=b%w,G>0&&(b+=w-G),y.__size=b,y.__cache={},this}function I(y){const v={boundary:0,storage:0};return typeof y=="number"?(v.boundary=4,v.storage=4):y.isVector2?(v.boundary=8,v.storage=8):y.isVector3||y.isColor?(v.boundary=16,v.storage=12):y.isVector4?(v.boundary=16,v.storage=16):y.isMatrix3?(v.boundary=48,v.storage=48):y.isMatrix4?(v.boundary=64,v.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),v}function A(y){const v=y.target;v.removeEventListener("dispose",A);const b=o.indexOf(v.__bindingPointIndex);o.splice(b,1),n.deleteBuffer(r[v.id]),delete r[v.id],delete s[v.id]}function p(){for(const y in r)n.deleteBuffer(r[y]);o=[],r={},s={}}return{bind:l,update:c,dispose:p}}function Tce(){const n=yy("canvas");return n.style.display="block",n}function Vw(n={}){this.isWebGLRenderer=!0;const e=n.canvas!==void 0?n.canvas:Tce(),t=n.context!==void 0?n.context:null,i=n.depth!==void 0?n.depth:!0,r=n.stencil!==void 0?n.stencil:!0,s=n.antialias!==void 0?n.antialias:!1,o=n.premultipliedAlpha!==void 0?n.premultipliedAlpha:!0,a=n.preserveDrawingBuffer!==void 0?n.preserveDrawingBuffer:!1,l=n.powerPreference!==void 0?n.powerPreference:"default",c=n.failIfMajorPerformanceCaveat!==void 0?n.failIfMajorPerformanceCaveat:!1;let g;t!==null?g=t.getContextAttributes().alpha:g=n.alpha!==void 0?n.alpha:!1;let u=null,d=null;const h=[],f=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=ta,this.useLegacyLights=!0,this.toneMapping=Gl,this.toneMappingExposure=1;const I=this;let A=!1,p=0,y=0,v=null,b=-1,w=null;const G=new Lt,x=new Lt;let B=null,R=e.width,Z=e.height,W=1,F=null,T=null;const V=new Lt(0,0,R,Z),z=new Lt(0,0,R,Z);let U=!1;const J=new Ww;let H=!1,Y=!1,K=null;const Q=new qe,P=new D,ne={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function oe(){return v===null?W:1}let $=t;function de(te,ve){for(let Ee=0;Ee<te.length;Ee++){const Ce=te[Ee],Te=e.getContext(Ce,ve);if(Te!==null)return Te}return null}try{const te={alpha:!0,depth:i,stencil:r,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:a,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${wf}`),e.addEventListener("webglcontextlost",Ue,!1),e.addEventListener("webglcontextrestored",Pe,!1),e.addEventListener("webglcontextcreationerror",Ye,!1),$===null){const ve=["webgl2","webgl","experimental-webgl"];if(I.isWebGL1Renderer===!0&&ve.shift(),$=de(ve,te),$===null)throw de(ve)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}$.getShaderPrecisionFormat===void 0&&($.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(te){throw console.error("THREE.WebGLRenderer: "+te.message),te}let ge,se,k,O,q,ee,le,he,be,xe,ze,Se,ke,He,Be,j,X,ce,fe,Ge,me,Fe,Le,Re;function Xe(){ge=new qae($),se=new Pae($,ge,n),ge.init(se),Fe=new JO($,ge,se),k=new Mce($,ge,se),O=new tle,q=new pce,ee=new Ece($,ge,k,q,se,Fe,O),le=new Qae(I),he=new jae(I),be=new gse($,se),Le=new Kae($,ge,be,se),xe=new $ae($,be,O,Le),ze=new sle($,xe,be,O),fe=new rle($,se,ee),j=new Uae(q),Se=new Cce(I,le,he,ge,se,Le,j),ke=new _ce(I,q),He=new yce,Be=new xce(ge,se),ce=new Yae(I,le,he,k,ze,g,o),X=new Zce(I,ze,se),Re=new Vce($,O,se,k),Ge=new Dae($,ge,O,se),me=new ele($,ge,O,se),O.programs=Se.programs,I.capabilities=se,I.extensions=ge,I.properties=q,I.renderLists=He,I.shadowMap=X,I.state=k,I.info=O}Xe();const we=new Fce(I,$);this.xr=we,this.getContext=function(){return $},this.getContextAttributes=function(){return $.getContextAttributes()},this.forceContextLoss=function(){const te=ge.get("WEBGL_lose_context");te&&te.loseContext()},this.forceContextRestore=function(){const te=ge.get("WEBGL_lose_context");te&&te.restoreContext()},this.getPixelRatio=function(){return W},this.setPixelRatio=function(te){te!==void 0&&(W=te,this.setSize(R,Z,!1))},this.getSize=function(te){return te.set(R,Z)},this.setSize=function(te,ve,Ee=!0){if(we.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}R=te,Z=ve,e.width=Math.floor(te*W),e.height=Math.floor(ve*W),Ee===!0&&(e.style.width=te+"px",e.style.height=ve+"px"),this.setViewport(0,0,te,ve)},this.getDrawingBufferSize=function(te){return te.set(R*W,Z*W).floor()},this.setDrawingBufferSize=function(te,ve,Ee){R=te,Z=ve,W=Ee,e.width=Math.floor(te*Ee),e.height=Math.floor(ve*Ee),this.setViewport(0,0,te,ve)},this.getCurrentViewport=function(te){return te.copy(G)},this.getViewport=function(te){return te.copy(V)},this.setViewport=function(te,ve,Ee,Ce){te.isVector4?V.set(te.x,te.y,te.z,te.w):V.set(te,ve,Ee,Ce),k.viewport(G.copy(V).multiplyScalar(W).floor())},this.getScissor=function(te){return te.copy(z)},this.setScissor=function(te,ve,Ee,Ce){te.isVector4?z.set(te.x,te.y,te.z,te.w):z.set(te,ve,Ee,Ce),k.scissor(x.copy(z).multiplyScalar(W).floor())},this.getScissorTest=function(){return U},this.setScissorTest=function(te){k.setScissorTest(U=te)},this.setOpaqueSort=function(te){F=te},this.setTransparentSort=function(te){T=te},this.getClearColor=function(te){return te.copy(ce.getClearColor())},this.setClearColor=function(){ce.setClearColor.apply(ce,arguments)},this.getClearAlpha=function(){return ce.getClearAlpha()},this.setClearAlpha=function(){ce.setClearAlpha.apply(ce,arguments)},this.clear=function(te=!0,ve=!0,Ee=!0){let Ce=0;te&&(Ce|=16384),ve&&(Ce|=256),Ee&&(Ce|=1024),$.clear(Ce)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Ue,!1),e.removeEventListener("webglcontextrestored",Pe,!1),e.removeEventListener("webglcontextcreationerror",Ye,!1),He.dispose(),Be.dispose(),q.dispose(),le.dispose(),he.dispose(),ze.dispose(),Le.dispose(),Re.dispose(),Se.dispose(),we.dispose(),we.removeEventListener("sessionstart",De),we.removeEventListener("sessionend",et),K&&(K.dispose(),K=null),st.stop()};function Ue(te){te.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),A=!0}function Pe(){console.log("THREE.WebGLRenderer: Context Restored."),A=!1;const te=O.autoReset,ve=X.enabled,Ee=X.autoUpdate,Ce=X.needsUpdate,Te=X.type;Xe(),O.autoReset=te,X.enabled=ve,X.autoUpdate=Ee,X.needsUpdate=Ce,X.type=Te}function Ye(te){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",te.statusMessage)}function $e(te){const ve=te.target;ve.removeEventListener("dispose",$e),mt(ve)}function mt(te){Wt(te),q.remove(te)}function Wt(te){const ve=q.get(te).programs;ve!==void 0&&(ve.forEach(function(Ee){Se.releaseProgram(Ee)}),te.isShaderMaterial&&Se.releaseShaderCache(te))}this.renderBufferDirect=function(te,ve,Ee,Ce,Te,dt){ve===null&&(ve=ne);const yt=Te.isMesh&&Te.matrixWorld.determinant()<0,St=ms(te,ve,Ee,Ce,Te);k.setMaterial(Ce,yt);let kt=Ee.index,jt=1;Ce.wireframe===!0&&(kt=xe.getWireframeAttribute(Ee),jt=2);const Tt=Ee.drawRange,Ht=Ee.attributes.position;let ti=Tt.start*jt,sr=(Tt.start+Tt.count)*jt;dt!==null&&(ti=Math.max(ti,dt.start*jt),sr=Math.min(sr,(dt.start+dt.count)*jt)),kt!==null?(ti=Math.max(ti,0),sr=Math.min(sr,kt.count)):Ht!=null&&(ti=Math.max(ti,0),sr=Math.min(sr,Ht.count));const kr=sr-ti;if(kr<0||kr===1/0)return;Le.setup(Te,Ce,St,Ee,kt);let Mo,kn=Ge;if(kt!==null&&(Mo=be.get(kt),kn=me,kn.setIndex(Mo)),Te.isMesh)Ce.wireframe===!0?(k.setLineWidth(Ce.wireframeLinewidth*oe()),kn.setMode(1)):kn.setMode(4);else if(Te.isLine){let Qe=Ce.linewidth;Qe===void 0&&(Qe=1),k.setLineWidth(Qe*oe()),Te.isLineSegments?kn.setMode(1):Te.isLineLoop?kn.setMode(2):kn.setMode(3)}else Te.isPoints?kn.setMode(0):Te.isSprite&&kn.setMode(4);if(Te.isInstancedMesh)kn.renderInstances(ti,kr,Te.count);else if(Ee.isInstancedBufferGeometry){const Qe=Ee._maxInstanceCount!==void 0?Ee._maxInstanceCount:1/0,ys=Math.min(Ee.instanceCount,Qe);kn.renderInstances(ti,kr,ys)}else kn.render(ti,kr)},this.compile=function(te,ve){function Ee(Ce,Te,dt){Ce.transparent===!0&&Ce.side===Di&&Ce.forceSinglePass===!1?(Ce.side=Bi,Ce.needsUpdate=!0,Jt(Ce,Te,dt),Ce.side=wo,Ce.needsUpdate=!0,Jt(Ce,Te,dt),Ce.side=Di):Jt(Ce,Te,dt)}d=Be.get(te),d.init(),f.push(d),te.traverseVisible(function(Ce){Ce.isLight&&Ce.layers.test(ve.layers)&&(d.pushLight(Ce),Ce.castShadow&&d.pushShadow(Ce))}),d.setupLights(I.useLegacyLights),te.traverse(function(Ce){const Te=Ce.material;if(Te)if(Array.isArray(Te))for(let dt=0;dt<Te.length;dt++){const yt=Te[dt];Ee(yt,te,Ce)}else Ee(Te,te,Ce)}),f.pop(),d=null};let ue=null;function Me(te){ue&&ue(te)}function De(){st.stop()}function et(){st.start()}const st=new DO;st.setAnimationLoop(Me),typeof self<"u"&&st.setContext(self),this.setAnimationLoop=function(te){ue=te,we.setAnimationLoop(te),te===null?st.stop():st.start()},we.addEventListener("sessionstart",De),we.addEventListener("sessionend",et),this.render=function(te,ve){if(ve!==void 0&&ve.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(A===!0)return;te.matrixWorldAutoUpdate===!0&&te.updateMatrixWorld(),ve.parent===null&&ve.matrixWorldAutoUpdate===!0&&ve.updateMatrixWorld(),we.enabled===!0&&we.isPresenting===!0&&(we.cameraAutoUpdate===!0&&we.updateCamera(ve),ve=we.getCamera()),te.isScene===!0&&te.onBeforeRender(I,te,ve,v),d=Be.get(te,f.length),d.init(),f.push(d),Q.multiplyMatrices(ve.projectionMatrix,ve.matrixWorldInverse),J.setFromProjectionMatrix(Q),Y=this.localClippingEnabled,H=j.init(this.clippingPlanes,Y),u=He.get(te,h.length),u.init(),h.push(u),Ot(te,ve,0,I.sortObjects),u.finish(),I.sortObjects===!0&&u.sort(F,T),H===!0&&j.beginShadows();const Ee=d.state.shadowsArray;if(X.render(Ee,te,ve),H===!0&&j.endShadows(),this.info.autoReset===!0&&this.info.reset(),ce.render(u,te),d.setupLights(I.useLegacyLights),ve.isArrayCamera){const Ce=ve.cameras;for(let Te=0,dt=Ce.length;Te<dt;Te++){const yt=Ce[Te];on(u,te,yt,yt.viewport)}}else on(u,te,ve);v!==null&&(ee.updateMultisampleRenderTarget(v),ee.updateRenderTargetMipmap(v)),te.isScene===!0&&te.onAfterRender(I,te,ve),Le.resetDefaultState(),b=-1,w=null,f.pop(),f.length>0?d=f[f.length-1]:d=null,h.pop(),h.length>0?u=h[h.length-1]:u=null};function Ot(te,ve,Ee,Ce){if(te.visible===!1)return;if(te.layers.test(ve.layers)){if(te.isGroup)Ee=te.renderOrder;else if(te.isLOD)te.autoUpdate===!0&&te.update(ve);else if(te.isLight)d.pushLight(te),te.castShadow&&d.pushShadow(te);else if(te.isSprite){if(!te.frustumCulled||J.intersectsSprite(te)){Ce&&P.setFromMatrixPosition(te.matrixWorld).applyMatrix4(Q);const yt=ze.update(te),St=te.material;St.visible&&u.push(te,yt,St,Ee,P.z,null)}}else if((te.isMesh||te.isLine||te.isPoints)&&(te.isSkinnedMesh&&te.skeleton.frame!==O.render.frame&&(te.skeleton.update(),te.skeleton.frame=O.render.frame),!te.frustumCulled||J.intersectsObject(te))){Ce&&P.setFromMatrixPosition(te.matrixWorld).applyMatrix4(Q);const yt=ze.update(te),St=te.material;if(Array.isArray(St)){const kt=yt.groups;for(let jt=0,Tt=kt.length;jt<Tt;jt++){const Ht=kt[jt],ti=St[Ht.materialIndex];ti&&ti.visible&&u.push(te,yt,ti,Ee,P.z,Ht)}}else St.visible&&u.push(te,yt,St,Ee,P.z,null)}}const dt=te.children;for(let yt=0,St=dt.length;yt<St;yt++)Ot(dt[yt],ve,Ee,Ce)}function on(te,ve,Ee,Ce){const Te=te.opaque,dt=te.transmissive,yt=te.transparent;d.setupLightsView(Ee),H===!0&&j.setGlobalState(I.clippingPlanes,Ee),dt.length>0&&An(Te,ve,Ee),Ce&&k.viewport(G.copy(Ce)),Te.length>0&&$t(Te,ve,Ee),dt.length>0&&$t(dt,ve,Ee),yt.length>0&&$t(yt,ve,Ee),k.buffers.depth.setTest(!0),k.buffers.depth.setMask(!0),k.buffers.color.setMask(!0),k.setPolygonOffset(!1)}function An(te,ve,Ee){const Ce=se.isWebGL2;K===null&&(K=new Qt(1024,1024,{generateMipmaps:!0,type:ge.has("EXT_color_buffer_half_float")?Pi:Dn,minFilter:wc,samples:Ce&&s===!0?4:0}));const Te=I.getRenderTarget();I.setRenderTarget(K),I.clear();const dt=I.toneMapping;I.toneMapping=Gl,$t(te,ve,Ee),I.toneMapping=dt,ee.updateMultisampleRenderTarget(K),ee.updateRenderTargetMipmap(K),I.setRenderTarget(Te)}function $t(te,ve,Ee){const Ce=ve.isScene===!0?ve.overrideMaterial:null;for(let Te=0,dt=te.length;Te<dt;Te++){const yt=te[Te],St=yt.object,kt=yt.geometry,jt=Ce===null?yt.material:Ce,Tt=yt.group;St.layers.test(Ee.layers)&&bn(St,ve,Ee,kt,jt,Tt)}}function bn(te,ve,Ee,Ce,Te,dt){te.onBeforeRender(I,ve,Ee,Ce,Te,dt),te.modelViewMatrix.multiplyMatrices(Ee.matrixWorldInverse,te.matrixWorld),te.normalMatrix.getNormalMatrix(te.modelViewMatrix),Te.onBeforeRender(I,ve,Ee,Ce,te,dt),Te.transparent===!0&&Te.side===Di&&Te.forceSinglePass===!1?(Te.side=Bi,Te.needsUpdate=!0,I.renderBufferDirect(Ee,ve,Ce,Te,te,dt),Te.side=wo,Te.needsUpdate=!0,I.renderBufferDirect(Ee,ve,Ce,Te,te,dt),Te.side=Di):I.renderBufferDirect(Ee,ve,Ce,Te,te,dt),te.onAfterRender(I,ve,Ee,Ce,Te,dt)}function Jt(te,ve,Ee){ve.isScene!==!0&&(ve=ne);const Ce=q.get(te),Te=d.state.lights,dt=d.state.shadowsArray,yt=Te.state.version,St=Se.getParameters(te,Te.state,dt,ve,Ee),kt=Se.getProgramCacheKey(St);let jt=Ce.programs;Ce.environment=te.isMeshStandardMaterial?ve.environment:null,Ce.fog=ve.fog,Ce.envMap=(te.isMeshStandardMaterial?he:le).get(te.envMap||Ce.environment),jt===void 0&&(te.addEventListener("dispose",$e),jt=new Map,Ce.programs=jt);let Tt=jt.get(kt);if(Tt!==void 0){if(Ce.currentProgram===Tt&&Ce.lightsStateVersion===yt)return nn(te,St),Tt}else St.uniforms=Se.getUniforms(te),te.onBuild(Ee,St,I),te.onBeforeCompile(St,I),Tt=Se.acquireProgram(St,kt),jt.set(kt,Tt),Ce.uniforms=St.uniforms;const Ht=Ce.uniforms;(!te.isShaderMaterial&&!te.isRawShaderMaterial||te.clipping===!0)&&(Ht.clippingPlanes=j.uniform),nn(te,St),Ce.needsLights=un(te),Ce.lightsStateVersion=yt,Ce.needsLights&&(Ht.ambientLightColor.value=Te.state.ambient,Ht.lightProbe.value=Te.state.probe,Ht.directionalLights.value=Te.state.directional,Ht.directionalLightShadows.value=Te.state.directionalShadow,Ht.spotLights.value=Te.state.spot,Ht.spotLightShadows.value=Te.state.spotShadow,Ht.rectAreaLights.value=Te.state.rectArea,Ht.ltc_1.value=Te.state.rectAreaLTC1,Ht.ltc_2.value=Te.state.rectAreaLTC2,Ht.pointLights.value=Te.state.point,Ht.pointLightShadows.value=Te.state.pointShadow,Ht.hemisphereLights.value=Te.state.hemi,Ht.directionalShadowMap.value=Te.state.directionalShadowMap,Ht.directionalShadowMatrix.value=Te.state.directionalShadowMatrix,Ht.spotShadowMap.value=Te.state.spotShadowMap,Ht.spotLightMatrix.value=Te.state.spotLightMatrix,Ht.spotLightMap.value=Te.state.spotLightMap,Ht.pointShadowMap.value=Te.state.pointShadowMap,Ht.pointShadowMatrix.value=Te.state.pointShadowMatrix);const ti=Tt.getUniforms(),sr=f1.seqWithValue(ti.seq,Ht);return Ce.currentProgram=Tt,Ce.uniformsList=sr,Tt}function nn(te,ve){const Ee=q.get(te);Ee.outputEncoding=ve.outputEncoding,Ee.instancing=ve.instancing,Ee.skinning=ve.skinning,Ee.morphTargets=ve.morphTargets,Ee.morphNormals=ve.morphNormals,Ee.morphColors=ve.morphColors,Ee.morphTargetsCount=ve.morphTargetsCount,Ee.numClippingPlanes=ve.numClippingPlanes,Ee.numIntersection=ve.numClipIntersection,Ee.vertexAlphas=ve.vertexAlphas,Ee.vertexTangents=ve.vertexTangents,Ee.toneMapping=ve.toneMapping}function ms(te,ve,Ee,Ce,Te){ve.isScene!==!0&&(ve=ne),ee.resetTextureUnits();const dt=ve.fog,yt=Ce.isMeshStandardMaterial?ve.environment:null,St=v===null?I.outputEncoding:v.isXRRenderTarget===!0?v.texture.encoding:ta,kt=(Ce.isMeshStandardMaterial?he:le).get(Ce.envMap||yt),jt=Ce.vertexColors===!0&&!!Ee.attributes.color&&Ee.attributes.color.itemSize===4,Tt=!!Ce.normalMap&&!!Ee.attributes.tangent,Ht=!!Ee.morphAttributes.position,ti=!!Ee.morphAttributes.normal,sr=!!Ee.morphAttributes.color,kr=Ce.toneMapped?I.toneMapping:Gl,Mo=Ee.morphAttributes.position||Ee.morphAttributes.normal||Ee.morphAttributes.color,kn=Mo!==void 0?Mo.length:0,Qe=q.get(Ce),ys=d.state.lights;if(H===!0&&(Y===!0||te!==w)){const Jn=te===w&&Ce.id===b;j.setState(Ce,te,Jn)}let ni=!1;Ce.version===Qe.__version?(Qe.needsLights&&Qe.lightsStateVersion!==ys.state.version||Qe.outputEncoding!==St||Te.isInstancedMesh&&Qe.instancing===!1||!Te.isInstancedMesh&&Qe.instancing===!0||Te.isSkinnedMesh&&Qe.skinning===!1||!Te.isSkinnedMesh&&Qe.skinning===!0||Qe.envMap!==kt||Ce.fog===!0&&Qe.fog!==dt||Qe.numClippingPlanes!==void 0&&(Qe.numClippingPlanes!==j.numPlanes||Qe.numIntersection!==j.numIntersection)||Qe.vertexAlphas!==jt||Qe.vertexTangents!==Tt||Qe.morphTargets!==Ht||Qe.morphNormals!==ti||Qe.morphColors!==sr||Qe.toneMapping!==kr||se.isWebGL2===!0&&Qe.morphTargetsCount!==kn)&&(ni=!0):(ni=!0,Qe.__version=Ce.version);let Lr=Qe.currentProgram;ni===!0&&(Lr=Jt(Ce,ve,Te));let _d=!1,Eo=!1,vs=!1;const Sn=Lr.getUniforms(),en=Qe.uniforms;if(k.useProgram(Lr.program)&&(_d=!0,Eo=!0,vs=!0),Ce.id!==b&&(b=Ce.id,Eo=!0),_d||w!==te){if(Sn.setValue($,"projectionMatrix",te.projectionMatrix),se.logarithmicDepthBuffer&&Sn.setValue($,"logDepthBufFC",2/(Math.log(te.far+1)/Math.LN2)),w!==te&&(w=te,Eo=!0,vs=!0),Ce.isShaderMaterial||Ce.isMeshPhongMaterial||Ce.isMeshToonMaterial||Ce.isMeshStandardMaterial||Ce.envMap){const Jn=Sn.map.cameraPosition;Jn!==void 0&&Jn.setValue($,P.setFromMatrixPosition(te.matrixWorld))}(Ce.isMeshPhongMaterial||Ce.isMeshToonMaterial||Ce.isMeshLambertMaterial||Ce.isMeshBasicMaterial||Ce.isMeshStandardMaterial||Ce.isShaderMaterial)&&Sn.setValue($,"isOrthographic",te.isOrthographicCamera===!0),(Ce.isMeshPhongMaterial||Ce.isMeshToonMaterial||Ce.isMeshLambertMaterial||Ce.isMeshBasicMaterial||Ce.isMeshStandardMaterial||Ce.isShaderMaterial||Ce.isShadowMaterial||Te.isSkinnedMesh)&&Sn.setValue($,"viewMatrix",te.matrixWorldInverse)}if(Te.isSkinnedMesh){Sn.setOptional($,Te,"bindMatrix"),Sn.setOptional($,Te,"bindMatrixInverse");const Jn=Te.skeleton;Jn&&(se.floatVertexTextures?(Jn.boneTexture===null&&Jn.computeBoneTexture(),Sn.setValue($,"boneTexture",Jn.boneTexture,ee),Sn.setValue($,"boneTextureSize",Jn.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const rn=Ee.morphAttributes;if((rn.position!==void 0||rn.normal!==void 0||rn.color!==void 0&&se.isWebGL2===!0)&&fe.update(Te,Ee,Lr),(Eo||Qe.receiveShadow!==Te.receiveShadow)&&(Qe.receiveShadow=Te.receiveShadow,Sn.setValue($,"receiveShadow",Te.receiveShadow)),Ce.isMeshGouraudMaterial&&Ce.envMap!==null&&(en.envMap.value=kt,en.flipEnvMap.value=kt.isCubeTexture&&kt.isRenderTargetTexture===!1?-1:1),Eo&&(Sn.setValue($,"toneMappingExposure",I.toneMappingExposure),Qe.needsLights&&br(en,vs),dt&&Ce.fog===!0&&ke.refreshFogUniforms(en,dt),ke.refreshMaterialUniforms(en,Ce,W,Z,K),f1.upload($,Qe.uniformsList,en,ee)),Ce.isShaderMaterial&&Ce.uniformsNeedUpdate===!0&&(f1.upload($,Qe.uniformsList,en,ee),Ce.uniformsNeedUpdate=!1),Ce.isSpriteMaterial&&Sn.setValue($,"center",Te.center),Sn.setValue($,"modelViewMatrix",Te.modelViewMatrix),Sn.setValue($,"normalMatrix",Te.normalMatrix),Sn.setValue($,"modelMatrix",Te.matrixWorld),Ce.isShaderMaterial||Ce.isRawShaderMaterial){const Jn=Ce.uniformsGroups;for(let ii=0,Qi=Jn.length;ii<Qi;ii++)if(se.isWebGL2){const Hr=Jn[ii];Re.update(Hr,Lr),Re.bind(Hr,Lr)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Lr}function br(te,ve){te.ambientLightColor.needsUpdate=ve,te.lightProbe.needsUpdate=ve,te.directionalLights.needsUpdate=ve,te.directionalLightShadows.needsUpdate=ve,te.pointLights.needsUpdate=ve,te.pointLightShadows.needsUpdate=ve,te.spotLights.needsUpdate=ve,te.spotLightShadows.needsUpdate=ve,te.rectAreaLights.needsUpdate=ve,te.hemisphereLights.needsUpdate=ve}function un(te){return te.isMeshLambertMaterial||te.isMeshToonMaterial||te.isMeshPhongMaterial||te.isMeshStandardMaterial||te.isShadowMaterial||te.isShaderMaterial&&te.lights===!0}this.getActiveCubeFace=function(){return p},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return v},this.setRenderTargetTextures=function(te,ve,Ee){q.get(te.texture).__webglTexture=ve,q.get(te.depthTexture).__webglTexture=Ee;const Ce=q.get(te);Ce.__hasExternalTextures=!0,Ce.__hasExternalTextures&&(Ce.__autoAllocateDepthBuffer=Ee===void 0,Ce.__autoAllocateDepthBuffer||ge.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ce.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(te,ve){const Ee=q.get(te);Ee.__webglFramebuffer=ve,Ee.__useDefaultFramebuffer=ve===void 0},this.setRenderTarget=function(te,ve=0,Ee=0){v=te,p=ve,y=Ee;let Ce=!0,Te=null,dt=!1,yt=!1;if(te){const kt=q.get(te);kt.__useDefaultFramebuffer!==void 0?(k.bindFramebuffer(36160,null),Ce=!1):kt.__webglFramebuffer===void 0?ee.setupRenderTarget(te):kt.__hasExternalTextures&&ee.rebindTextures(te,q.get(te.texture).__webglTexture,q.get(te.depthTexture).__webglTexture);const jt=te.texture;(jt.isData3DTexture||jt.isDataArrayTexture||jt.isCompressedArrayTexture)&&(yt=!0);const Tt=q.get(te).__webglFramebuffer;te.isWebGLCubeRenderTarget?(Te=Tt[ve],dt=!0):se.isWebGL2&&te.samples>0&&ee.useMultisampledRTT(te)===!1?Te=q.get(te).__webglMultisampledFramebuffer:Te=Tt,G.copy(te.viewport),x.copy(te.scissor),B=te.scissorTest}else G.copy(V).multiplyScalar(W).floor(),x.copy(z).multiplyScalar(W).floor(),B=U;if(k.bindFramebuffer(36160,Te)&&se.drawBuffers&&Ce&&k.drawBuffers(te,Te),k.viewport(G),k.scissor(x),k.setScissorTest(B),dt){const kt=q.get(te.texture);$.framebufferTexture2D(36160,36064,34069+ve,kt.__webglTexture,Ee)}else if(yt){const kt=q.get(te.texture),jt=ve||0;$.framebufferTextureLayer(36160,36064,kt.__webglTexture,Ee||0,jt)}b=-1},this.readRenderTargetPixels=function(te,ve,Ee,Ce,Te,dt,yt){if(!(te&&te.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let St=q.get(te).__webglFramebuffer;if(te.isWebGLCubeRenderTarget&&yt!==void 0&&(St=St[yt]),St){k.bindFramebuffer(36160,St);try{const kt=te.texture,jt=kt.format,Tt=kt.type;if(jt!==Yn&&Fe.convert(jt)!==$.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Ht=Tt===Pi&&(ge.has("EXT_color_buffer_half_float")||se.isWebGL2&&ge.has("EXT_color_buffer_float"));if(Tt!==Dn&&Fe.convert(Tt)!==$.getParameter(35738)&&!(Tt===Hn&&(se.isWebGL2||ge.has("OES_texture_float")||ge.has("WEBGL_color_buffer_float")))&&!Ht){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ve>=0&&ve<=te.width-Ce&&Ee>=0&&Ee<=te.height-Te&&$.readPixels(ve,Ee,Ce,Te,Fe.convert(jt),Fe.convert(Tt),dt)}finally{const kt=v!==null?q.get(v).__webglFramebuffer:null;k.bindFramebuffer(36160,kt)}}},this.copyFramebufferToTexture=function(te,ve,Ee=0){const Ce=Math.pow(2,-Ee),Te=Math.floor(ve.image.width*Ce),dt=Math.floor(ve.image.height*Ce);ee.setTexture2D(ve,0),$.copyTexSubImage2D(3553,Ee,0,0,te.x,te.y,Te,dt),k.unbindTexture()},this.copyTextureToTexture=function(te,ve,Ee,Ce=0){const Te=ve.image.width,dt=ve.image.height,yt=Fe.convert(Ee.format),St=Fe.convert(Ee.type);ee.setTexture2D(Ee,0),$.pixelStorei(37440,Ee.flipY),$.pixelStorei(37441,Ee.premultiplyAlpha),$.pixelStorei(3317,Ee.unpackAlignment),ve.isDataTexture?$.texSubImage2D(3553,Ce,te.x,te.y,Te,dt,yt,St,ve.image.data):ve.isCompressedTexture?$.compressedTexSubImage2D(3553,Ce,te.x,te.y,ve.mipmaps[0].width,ve.mipmaps[0].height,yt,ve.mipmaps[0].data):$.texSubImage2D(3553,Ce,te.x,te.y,yt,St,ve.image),Ce===0&&Ee.generateMipmaps&&$.generateMipmap(3553),k.unbindTexture()},this.copyTextureToTexture3D=function(te,ve,Ee,Ce,Te=0){if(I.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const dt=te.max.x-te.min.x+1,yt=te.max.y-te.min.y+1,St=te.max.z-te.min.z+1,kt=Fe.convert(Ce.format),jt=Fe.convert(Ce.type);let Tt;if(Ce.isData3DTexture)ee.setTexture3D(Ce,0),Tt=32879;else if(Ce.isDataArrayTexture)ee.setTexture2DArray(Ce,0),Tt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}$.pixelStorei(37440,Ce.flipY),$.pixelStorei(37441,Ce.premultiplyAlpha),$.pixelStorei(3317,Ce.unpackAlignment);const Ht=$.getParameter(3314),ti=$.getParameter(32878),sr=$.getParameter(3316),kr=$.getParameter(3315),Mo=$.getParameter(32877),kn=Ee.isCompressedTexture?Ee.mipmaps[0]:Ee.image;$.pixelStorei(3314,kn.width),$.pixelStorei(32878,kn.height),$.pixelStorei(3316,te.min.x),$.pixelStorei(3315,te.min.y),$.pixelStorei(32877,te.min.z),Ee.isDataTexture||Ee.isData3DTexture?$.texSubImage3D(Tt,Te,ve.x,ve.y,ve.z,dt,yt,St,kt,jt,kn.data):Ee.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),$.compressedTexSubImage3D(Tt,Te,ve.x,ve.y,ve.z,dt,yt,St,kt,kn.data)):$.texSubImage3D(Tt,Te,ve.x,ve.y,ve.z,dt,yt,St,kt,jt,kn),$.pixelStorei(3314,Ht),$.pixelStorei(32878,ti),$.pixelStorei(3316,sr),$.pixelStorei(3315,kr),$.pixelStorei(32877,Mo),Te===0&&Ce.generateMipmaps&&$.generateMipmap(Tt),k.unbindTexture()},this.initTexture=function(te){te.isCubeTexture?ee.setTextureCube(te,0):te.isData3DTexture?ee.setTexture3D(te,0):te.isDataArrayTexture||te.isCompressedArrayTexture?ee.setTexture2DArray(te,0):ee.setTexture2D(te,0),k.unbindTexture()},this.resetState=function(){p=0,y=0,v=null,k.reset(),Le.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Object.defineProperties(Vw.prototype,{physicallyCorrectLights:{get:function(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights},set:function(n){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!n}}});class qO extends Vw{}qO.prototype.isWebGL1Renderer=!0;class Tw{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new Ke(e),this.density=t}clone(){return new Tw(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}let $O=class e4{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new Ke(e),this.near=t,this.far=i}clone(){return new e4(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},Cd=class extends In{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}};class lv{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=py,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=jo()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=jo()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=jo()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const xs=new D;class pd{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)xs.fromBufferAttribute(this,t),xs.applyMatrix4(e),this.setXYZ(t,xs.x,xs.y,xs.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)xs.fromBufferAttribute(this,t),xs.applyNormalMatrix(e),this.setXYZ(t,xs.x,xs.y,xs.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)xs.fromBufferAttribute(this,t),xs.transformDirection(e),this.setXYZ(t,xs.x,xs.y,xs.z);return this}setX(e,t){return this.normalized&&(t=Tn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Tn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Tn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Tn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Rg(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Rg(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Rg(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Rg(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Tn(t,this.array),i=Tn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Tn(t,this.array),i=Tn(i,this.array),r=Tn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Tn(t,this.array),i=Tn(i,this.array),r=Tn(r,this.array),s=Tn(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new Pt(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new pd(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Y_ extends ai{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Ke(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let CI;const $p=new D,pI=new D,mI=new D,yI=new pe,em=new pe,t4=new qe,AB=new D,tm=new D,CB=new D,K9=new pe,MR=new pe,D9=new pe;class n4 extends In{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",CI===void 0){CI=new Et;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new lv(t,5);CI.setIndex([0,1,2,0,2,3]),CI.setAttribute("position",new pd(i,3,0,!1)),CI.setAttribute("uv",new pd(i,2,3,!1))}this.geometry=CI,this.material=e!==void 0?e:new Y_,this.center=new pe(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),pI.setFromMatrixScale(this.matrixWorld),t4.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),mI.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&pI.multiplyScalar(-mI.z);const i=this.material.rotation;let r,s;i!==0&&(s=Math.cos(i),r=Math.sin(i));const o=this.center;pB(AB.set(-.5,-.5,0),mI,o,pI,r,s),pB(tm.set(.5,-.5,0),mI,o,pI,r,s),pB(CB.set(.5,.5,0),mI,o,pI,r,s),K9.set(0,0),MR.set(1,0),D9.set(1,1);let a=e.ray.intersectTriangle(AB,tm,CB,!1,$p);if(a===null&&(pB(tm.set(-.5,.5,0),mI,o,pI,r,s),MR.set(0,1),a=e.ray.intersectTriangle(AB,CB,tm,!1,$p),a===null))return;const l=e.ray.origin.distanceTo($p);l<e.near||l>e.far||t.push({distance:l,point:$p.clone(),uv:Fg.getUV($p,AB,tm,CB,K9,MR,D9,new pe),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function pB(n,e,t,i,r,s){yI.subVectors(n,t).addScalar(.5).multiply(i),r!==void 0?(em.x=s*yI.x-r*yI.y,em.y=r*yI.x+s*yI.y):em.copy(yI),n.copy(e),n.x+=em.x,n.y+=em.y,n.applyMatrix4(t4)}const mB=new D,P9=new D;class i4 extends In{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let i=0,r=t.length;i<r;i++){const s=t[i];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,i=0){t=Math.abs(t);const r=this.levels;let s;for(s=0;s<r.length&&!(t<r[s].distance);s++);return r.splice(s,0,{distance:t,hysteresis:i,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,r;for(i=1,r=t.length;i<r;i++){let s=t[i].distance;if(t[i].object.visible&&(s-=s*t[i].hysteresis),e<s)break}return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){mB.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(mB);this.getObjectForDistance(r).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){mB.setFromMatrixPosition(e.matrixWorld),P9.setFromMatrixPosition(this.matrixWorld);const i=mB.distanceTo(P9)/e.zoom;t[0].object.visible=!0;let r,s;for(r=1,s=t.length;r<s;r++){let o=t[r].distance;if(t[r].object.visible&&(o-=o*t[r].hysteresis),i>=o)t[r-1].object.visible=!1,t[r].object.visible=!0;else break}for(this._currentLevel=r-1;r<s;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let r=0,s=i.length;r<s;r++){const o=i[r];t.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return t}}const U9=new D,Q9=new Lt,O9=new Lt,Nce=new D,J9=new qe;class K_ extends Rn{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new qe,this.bindMatrixInverse=new qe}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Lt,t=this.geometry.attributes.skinWeight;for(let i=0,r=t.count;i<r;i++){e.fromBufferAttribute(t,i);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const i=this.skeleton,r=this.geometry;Q9.fromBufferAttribute(r.attributes.skinIndex,e),O9.fromBufferAttribute(r.attributes.skinWeight,e),U9.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const o=O9.getComponent(s);if(o!==0){const a=Q9.getComponent(s);J9.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(Nce.copy(U9).applyMatrix4(J9),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}class Nw extends In{constructor(){super(),this.isBone=!0,this.type="Bone"}}let pc=class extends Pn{constructor(e=null,t=1,i=1,r,s,o,a,l,c=Zt,g=Zt,u,d){super(null,o,a,l,c,g,r,s,u,d),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};const j9=new qe,kce=new qe;class cv{constructor(e=[],t=[]){this.uuid=jo(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new qe)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new qe;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let s=0,o=e.length;s<o;s++){const a=e[s]?e[s].matrixWorld:kce;j9.multiplyMatrices(a,t[s]),j9.toArray(i,s*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new cv(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=FO(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new pc(t,e,e,Yn,Hn);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){const s=e.bones[i];let o=t[s];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),o=new Nw),this.bones.push(o),this.boneInverses.push(new qe().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let r=0,s=t.length;r<s;r++){const o=t[r];e.bones.push(o.uuid);const a=i[r];e.boneInverses.push(a.toArray())}return e}}class ff extends Pt{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const q9=new qe,$9=new qe,yB=[],Lce=new qe,nm=new Rn;class NA extends Rn{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new ff(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let r=0;r<i;r++)this.setMatrixAt(r,Lce)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const i=this.matrixWorld,r=this.count;if(nm.geometry=this.geometry,nm.material=this.material,nm.material!==void 0)for(let s=0;s<r;s++){this.getMatrixAt(s,q9),$9.multiplyMatrices(i,q9),nm.matrixWorld=$9,nm.raycast(e,yB);for(let o=0,a=yB.length;o<a;o++){const l=yB[o];l.instanceId=s,l.object=this,t.push(l)}yB.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new ff(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Cs extends ai{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ke(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const eL=new D,tL=new D,nL=new qe,ER=new WC,vB=new Zl;class Xg extends In{constructor(e=new Et,t=new Cs){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let r=1,s=t.count;r<s;r++)eL.fromBufferAttribute(t,r-1),tL.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=eL.distanceTo(tL);e.setAttribute("lineDistance",new ht(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),vB.copy(i.boundingSphere),vB.applyMatrix4(r),vB.radius+=s,e.ray.intersectsSphere(vB)===!1)return;nL.copy(r).invert(),ER.copy(e.ray).applyMatrix4(nL);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new D,g=new D,u=new D,d=new D,h=this.isLineSegments?2:1,f=i.index,A=i.attributes.position;if(f!==null){const p=Math.max(0,o.start),y=Math.min(f.count,o.start+o.count);for(let v=p,b=y-1;v<b;v+=h){const w=f.getX(v),G=f.getX(v+1);if(c.fromBufferAttribute(A,w),g.fromBufferAttribute(A,G),ER.distanceSqToSegment(c,g,d,u)>l)continue;d.applyMatrix4(this.matrixWorld);const B=e.ray.origin.distanceTo(d);B<e.near||B>e.far||t.push({distance:B,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else{const p=Math.max(0,o.start),y=Math.min(A.count,o.start+o.count);for(let v=p,b=y-1;v<b;v+=h){if(c.fromBufferAttribute(A,v),g.fromBufferAttribute(A,v+1),ER.distanceSqToSegment(c,g,d,u)>l)continue;d.applyMatrix4(this.matrixWorld);const G=e.ray.origin.distanceTo(d);G<e.near||G>e.far||t.push({distance:G,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}const iL=new D,rL=new D;class Ml extends Xg{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let r=0,s=t.count;r<s;r+=2)iL.fromBufferAttribute(t,r),rL.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+iL.distanceTo(rL);e.setAttribute("lineDistance",new ht(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class D_ extends Xg{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class kw extends ai{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ke(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const sL=new qe,p3=new WC,bB=new Zl,BB=new D;class P_ extends In{constructor(e=new Et,t=new kw){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),bB.copy(i.boundingSphere),bB.applyMatrix4(r),bB.radius+=s,e.ray.intersectsSphere(bB)===!1)return;sL.copy(r).invert(),p3.copy(e.ray).applyMatrix4(sL);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,u=i.attributes.position;if(c!==null){const d=Math.max(0,o.start),h=Math.min(c.count,o.start+o.count);for(let f=d,I=h;f<I;f++){const A=c.getX(f);BB.fromBufferAttribute(u,A),oL(BB,A,l,r,e,t,this)}}else{const d=Math.max(0,o.start),h=Math.min(u.count,o.start+o.count);for(let f=d,I=h;f<I;f++)BB.fromBufferAttribute(u,f),oL(BB,f,l,r,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function oL(n,e,t,i,r,s,o){const a=p3.distanceSqToPoint(n);if(a<t){const l=new D;p3.closestPointToPoint(n,l),l.applyMatrix4(i);const c=r.ray.origin.distanceTo(l);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}class r4 extends Pn{constructor(e,t,i,r,s,o,a,l,c){super(e,t,i,r,s,o,a,l,c),this.isVideoTexture=!0,this.minFilter=o!==void 0?o:ut,this.magFilter=s!==void 0?s:ut,this.generateMipmaps=!1;const g=this;function u(){g.needsUpdate=!0,e.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(u)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class m3 extends Pn{constructor(e,t,i){super({width:e,height:t}),this.isFramebufferTexture=!0,this.format=i,this.magFilter=Zt,this.minFilter=Zt,this.generateMipmaps=!1,this.needsUpdate=!0}}let U_=class extends Pn{constructor(e,t,i,r,s,o,a,l,c,g,u,d){super(null,o,a,l,c,g,r,s,u,d),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}},Hce=class extends U_{constructor(e,t,i,r,s,o){super(e,t,i,s,o),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=Ki}},s4=class extends Pn{constructor(e,t,i,r,s,o,a,l,c){super(e,t,i,r,s,o,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}};class El{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,r=this.getPoint(0),s=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),s+=i.distanceTo(r),t.push(s),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let r=0;const s=i.length;let o;t?o=t:o=e*i[s-1];let a=0,l=s-1,c;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),c=i[r]-o,c<0)a=r+1;else if(c>0)l=r-1;else{l=r;break}if(r=l,i[r]===o)return r/(s-1);const g=i[r],d=i[r+1]-g,h=(o-g)/d;return(r+h)/(s-1)}getTangent(e,t){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const o=this.getPoint(r),a=this.getPoint(s),l=t||(o.isVector2?new pe:new D);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new D,r=[],s=[],o=[],a=new D,l=new qe;for(let h=0;h<=e;h++){const f=h/e;r[h]=this.getTangentAt(f,new D)}s[0]=new D,o[0]=new D;let c=Number.MAX_VALUE;const g=Math.abs(r[0].x),u=Math.abs(r[0].y),d=Math.abs(r[0].z);g<=c&&(c=g,i.set(1,0,0)),u<=c&&(c=u,i.set(0,1,0)),d<=c&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),s[0].crossVectors(r[0],a),o[0].crossVectors(r[0],s[0]);for(let h=1;h<=e;h++){if(s[h]=s[h-1].clone(),o[h]=o[h-1].clone(),a.crossVectors(r[h-1],r[h]),a.length()>Number.EPSILON){a.normalize();const f=Math.acos(Wi(r[h-1].dot(r[h]),-1,1));s[h].applyMatrix4(l.makeRotationAxis(a,f))}o[h].crossVectors(r[h],s[h])}if(t===!0){let h=Math.acos(Wi(s[0].dot(s[e]),-1,1));h/=e,r[0].dot(a.crossVectors(s[0],s[e]))>0&&(h=-h);for(let f=1;f<=e;f++)s[f].applyMatrix4(l.makeRotationAxis(r[f],h*f)),o[f].crossVectors(r[f],s[f])}return{tangents:r,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Lw extends El{constructor(e=0,t=0,i=1,r=1,s=0,o=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t){const i=t||new pe,r=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(o?s=0:s=r),this.aClockwise===!0&&!o&&(s===r?s=-r:s=s-r);const a=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const g=Math.cos(this.aRotation),u=Math.sin(this.aRotation),d=l-this.aX,h=c-this.aY;l=d*g-h*u+this.aX,c=d*u+h*g+this.aY}return i.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class o4 extends Lw{constructor(e,t,i,r,s,o){super(e,t,i,i,r,s,o),this.isArcCurve=!0,this.type="ArcCurve"}}function Q_(){let n=0,e=0,t=0,i=0;function r(s,o,a,l){n=s,e=a,t=-3*s+3*o-2*a-l,i=2*s-2*o+a+l}return{initCatmullRom:function(s,o,a,l,c){r(o,a,c*(a-s),c*(l-o))},initNonuniformCatmullRom:function(s,o,a,l,c,g,u){let d=(o-s)/c-(a-s)/(c+g)+(a-o)/g,h=(a-o)/g-(l-o)/(g+u)+(l-a)/u;d*=g,h*=g,r(o,a,d,h)},calc:function(s){const o=s*s,a=o*s;return n+e*s+t*o+i*a}}}const GB=new D,WR=new Q_,FR=new Q_,_R=new Q_;class O_ extends El{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new D){const i=t,r=this.points,s=r.length,o=(s-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:l===0&&a===s-1&&(a=s-2,l=1);let c,g;this.closed||a>0?c=r[(a-1)%s]:(GB.subVectors(r[0],r[1]).add(r[0]),c=GB);const u=r[a%s],d=r[(a+1)%s];if(this.closed||a+2<s?g=r[(a+2)%s]:(GB.subVectors(r[s-1],r[s-2]).add(r[s-1]),g=GB),this.curveType==="centripetal"||this.curveType==="chordal"){const h=this.curveType==="chordal"?.5:.25;let f=Math.pow(c.distanceToSquared(u),h),I=Math.pow(u.distanceToSquared(d),h),A=Math.pow(d.distanceToSquared(g),h);I<1e-4&&(I=1),f<1e-4&&(f=I),A<1e-4&&(A=I),WR.initNonuniformCatmullRom(c.x,u.x,d.x,g.x,f,I,A),FR.initNonuniformCatmullRom(c.y,u.y,d.y,g.y,f,I,A),_R.initNonuniformCatmullRom(c.z,u.z,d.z,g.z,f,I,A)}else this.curveType==="catmullrom"&&(WR.initCatmullRom(c.x,u.x,d.x,g.x,this.tension),FR.initCatmullRom(c.y,u.y,d.y,g.y,this.tension),_R.initCatmullRom(c.z,u.z,d.z,g.z,this.tension));return i.set(WR.calc(l),FR.calc(l),_R.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new D().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function aL(n,e,t,i,r){const s=(i-e)*.5,o=(r-t)*.5,a=n*n,l=n*a;return(2*t-2*i+s+o)*l+(-3*t+3*i-2*s-o)*a+s*n+t}function zce(n,e){const t=1-n;return t*t*e}function Xce(n,e){return 2*(1-n)*n*e}function Yce(n,e){return n*n*e}function x0(n,e,t,i){return zce(n,e)+Xce(n,t)+Yce(n,i)}function Kce(n,e){const t=1-n;return t*t*t*e}function Dce(n,e){const t=1-n;return 3*t*t*n*e}function Pce(n,e){return 3*(1-n)*n*n*e}function Uce(n,e){return n*n*n*e}function S0(n,e,t,i,r){return Kce(n,e)+Dce(n,t)+Pce(n,i)+Uce(n,r)}class J_ extends El{constructor(e=new pe,t=new pe,i=new pe,r=new pe){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new pe){const i=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return i.set(S0(e,r.x,s.x,o.x,a.x),S0(e,r.y,s.y,o.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class a4 extends El{constructor(e=new D,t=new D,i=new D,r=new D){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new D){const i=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return i.set(S0(e,r.x,s.x,o.x,a.x),S0(e,r.y,s.y,o.y,a.y),S0(e,r.z,s.z,o.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Hw extends El{constructor(e=new pe,t=new pe){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new pe){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new pe){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class l4 extends El{constructor(e=new D,t=new D){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new D){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new D){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class j_ extends El{constructor(e=new pe,t=new pe,i=new pe){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new pe){const i=t,r=this.v0,s=this.v1,o=this.v2;return i.set(x0(e,r.x,s.x,o.x),x0(e,r.y,s.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class q_ extends El{constructor(e=new D,t=new D,i=new D){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new D){const i=t,r=this.v0,s=this.v1,o=this.v2;return i.set(x0(e,r.x,s.x,o.x),x0(e,r.y,s.y,o.y),x0(e,r.z,s.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class $_ extends El{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new pe){const i=t,r=this.points,s=(r.length-1)*e,o=Math.floor(s),a=s-o,l=r[o===0?o:o-1],c=r[o],g=r[o>r.length-2?r.length-1:o+1],u=r[o>r.length-3?r.length-1:o+2];return i.set(aL(a,l.x,c.x,g.x,u.x),aL(a,l.y,c.y,g.y,u.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new pe().fromArray(r))}return this}}var eV=Object.freeze({__proto__:null,ArcCurve:o4,CatmullRomCurve3:O_,CubicBezierCurve:J_,CubicBezierCurve3:a4,EllipseCurve:Lw,LineCurve:Hw,LineCurve3:l4,QuadraticBezierCurve:j_,QuadraticBezierCurve3:q_,SplineCurve:$_});class c4 extends El{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Hw(t,e))}getPoint(e,t){const i=e*this.getLength(),r=this.getCurveLengths();let s=0;for(;s<r.length;){if(r[s]>=i){const o=r[s]-i,a=this.curves[s],l=a.getLength(),c=l===0?0:1-o/l;return a.getPointAt(c,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let r=0,s=this.curves;r<s.length;r++){const o=s[r],a=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,l=o.getPoints(a);for(let c=0;c<l.length;c++){const g=l[c];i&&i.equals(g)||(t.push(g),i=g)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const r=e.curves[t];this.curves.push(new eV[r.type]().fromJSON(r))}return this}}class vy extends c4{constructor(e){super(),this.type="Path",this.currentPoint=new pe,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new Hw(this.currentPoint.clone(),new pe(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){const s=new j_(this.currentPoint.clone(),new pe(e,t),new pe(i,r));return this.curves.push(s),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,s,o){const a=new J_(this.currentPoint.clone(),new pe(e,t),new pe(i,r),new pe(s,o));return this.curves.push(a),this.currentPoint.set(s,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new $_(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,s,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,i,r,s,o),this}absarc(e,t,i,r,s,o){return this.absellipse(e,t,i,i,r,s,o),this}ellipse(e,t,i,r,s,o,a,l){const c=this.currentPoint.x,g=this.currentPoint.y;return this.absellipse(e+c,t+g,i,r,s,o,a,l),this}absellipse(e,t,i,r,s,o,a,l){const c=new Lw(e,t,i,r,s,o,a,l);if(this.curves.length>0){const u=c.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(c);const g=c.getPoint(1);return this.currentPoint.copy(g),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class TC extends Et{constructor(e=[new pe(0,-.5),new pe(.5,0),new pe(0,.5)],t=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t),r=Wi(r,0,Math.PI*2);const s=[],o=[],a=[],l=[],c=[],g=1/t,u=new D,d=new pe,h=new D,f=new D,I=new D;let A=0,p=0;for(let y=0;y<=e.length-1;y++)switch(y){case 0:A=e[y+1].x-e[y].x,p=e[y+1].y-e[y].y,h.x=p*1,h.y=-A,h.z=p*0,I.copy(h),h.normalize(),l.push(h.x,h.y,h.z);break;case e.length-1:l.push(I.x,I.y,I.z);break;default:A=e[y+1].x-e[y].x,p=e[y+1].y-e[y].y,h.x=p*1,h.y=-A,h.z=p*0,f.copy(h),h.x+=I.x,h.y+=I.y,h.z+=I.z,h.normalize(),l.push(h.x,h.y,h.z),I.copy(f)}for(let y=0;y<=t;y++){const v=i+y*g*r,b=Math.sin(v),w=Math.cos(v);for(let G=0;G<=e.length-1;G++){u.x=e[G].x*b,u.y=e[G].y,u.z=e[G].x*w,o.push(u.x,u.y,u.z),d.x=y/t,d.y=G/(e.length-1),a.push(d.x,d.y);const x=l[3*G+0]*b,B=l[3*G+1],R=l[3*G+0]*w;c.push(x,B,R)}}for(let y=0;y<t;y++)for(let v=0;v<e.length-1;v++){const b=v+y*e.length,w=b,G=b+e.length,x=b+e.length+1,B=b+1;s.push(w,G,B),s.push(x,B,G)}this.setIndex(s),this.setAttribute("position",new ht(o,3)),this.setAttribute("uv",new ht(a,2)),this.setAttribute("normal",new ht(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new TC(e.points,e.segments,e.phiStart,e.phiLength)}}class gv extends TC{constructor(e=1,t=1,i=4,r=8){const s=new vy;s.absarc(0,-t/2,e,Math.PI*1.5,0),s.absarc(0,t/2,e,0,Math.PI*.5),super(s.getPoints(i),r),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:i,radialSegments:r}}static fromJSON(e){return new gv(e.radius,e.length,e.capSegments,e.radialSegments)}}class uv extends Et{constructor(e=1,t=32,i=0,r=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},t=Math.max(3,t);const s=[],o=[],a=[],l=[],c=new D,g=new pe;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let u=0,d=3;u<=t;u++,d+=3){const h=i+u/t*r;c.x=e*Math.cos(h),c.y=e*Math.sin(h),o.push(c.x,c.y,c.z),a.push(0,0,1),g.x=(o[d]/e+1)/2,g.y=(o[d+1]/e+1)/2,l.push(g.x,g.y)}for(let u=1;u<=t;u++)s.push(u,u+1,0);this.setIndex(s),this.setAttribute("position",new ht(o,3)),this.setAttribute("normal",new ht(a,3)),this.setAttribute("uv",new ht(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new uv(e.radius,e.segments,e.thetaStart,e.thetaLength)}}let dv=class g4 extends Et{constructor(e=1,t=1,i=1,r=32,s=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l};const c=this;r=Math.floor(r),s=Math.floor(s);const g=[],u=[],d=[],h=[];let f=0;const I=[],A=i/2;let p=0;y(),o===!1&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(g),this.setAttribute("position",new ht(u,3)),this.setAttribute("normal",new ht(d,3)),this.setAttribute("uv",new ht(h,2));function y(){const b=new D,w=new D;let G=0;const x=(t-e)/i;for(let B=0;B<=s;B++){const R=[],Z=B/s,W=Z*(t-e)+e;for(let F=0;F<=r;F++){const T=F/r,V=T*l+a,z=Math.sin(V),U=Math.cos(V);w.x=W*z,w.y=-Z*i+A,w.z=W*U,u.push(w.x,w.y,w.z),b.set(z,x,U).normalize(),d.push(b.x,b.y,b.z),h.push(T,1-Z),R.push(f++)}I.push(R)}for(let B=0;B<r;B++)for(let R=0;R<s;R++){const Z=I[R][B],W=I[R+1][B],F=I[R+1][B+1],T=I[R][B+1];g.push(Z,W,T),g.push(W,F,T),G+=6}c.addGroup(p,G,0),p+=G}function v(b){const w=f,G=new pe,x=new D;let B=0;const R=b===!0?e:t,Z=b===!0?1:-1;for(let F=1;F<=r;F++)u.push(0,A*Z,0),d.push(0,Z,0),h.push(.5,.5),f++;const W=f;for(let F=0;F<=r;F++){const V=F/r*l+a,z=Math.cos(V),U=Math.sin(V);x.x=R*U,x.y=A*Z,x.z=R*z,u.push(x.x,x.y,x.z),d.push(0,Z,0),G.x=z*.5+.5,G.y=U*.5*Z+.5,h.push(G.x,G.y),f++}for(let F=0;F<r;F++){const T=w+F,V=W+F;b===!0?g.push(V,V+1,T):g.push(V+1,V,T),B+=3}c.addGroup(p,B,b===!0?1:2),p+=B}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new g4(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}};class hv extends dv{constructor(e=1,t=1,i=32,r=1,s=!1,o=0,a=Math.PI*2){super(0,e,t,i,r,s,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a}}static fromJSON(e){return new hv(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class qg extends Et{constructor(e=[],t=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r};const s=[],o=[];a(r),c(i),g(),this.setAttribute("position",new ht(s,3)),this.setAttribute("normal",new ht(s.slice(),3)),this.setAttribute("uv",new ht(o,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(y){const v=new D,b=new D,w=new D;for(let G=0;G<t.length;G+=3)h(t[G+0],v),h(t[G+1],b),h(t[G+2],w),l(v,b,w,y)}function l(y,v,b,w){const G=w+1,x=[];for(let B=0;B<=G;B++){x[B]=[];const R=y.clone().lerp(b,B/G),Z=v.clone().lerp(b,B/G),W=G-B;for(let F=0;F<=W;F++)F===0&&B===G?x[B][F]=R:x[B][F]=R.clone().lerp(Z,F/W)}for(let B=0;B<G;B++)for(let R=0;R<2*(G-B)-1;R++){const Z=Math.floor(R/2);R%2===0?(d(x[B][Z+1]),d(x[B+1][Z]),d(x[B][Z])):(d(x[B][Z+1]),d(x[B+1][Z+1]),d(x[B+1][Z]))}}function c(y){const v=new D;for(let b=0;b<s.length;b+=3)v.x=s[b+0],v.y=s[b+1],v.z=s[b+2],v.normalize().multiplyScalar(y),s[b+0]=v.x,s[b+1]=v.y,s[b+2]=v.z}function g(){const y=new D;for(let v=0;v<s.length;v+=3){y.x=s[v+0],y.y=s[v+1],y.z=s[v+2];const b=A(y)/2/Math.PI+.5,w=p(y)/Math.PI+.5;o.push(b,1-w)}f(),u()}function u(){for(let y=0;y<o.length;y+=6){const v=o[y+0],b=o[y+2],w=o[y+4],G=Math.max(v,b,w),x=Math.min(v,b,w);G>.9&&x<.1&&(v<.2&&(o[y+0]+=1),b<.2&&(o[y+2]+=1),w<.2&&(o[y+4]+=1))}}function d(y){s.push(y.x,y.y,y.z)}function h(y,v){const b=y*3;v.x=e[b+0],v.y=e[b+1],v.z=e[b+2]}function f(){const y=new D,v=new D,b=new D,w=new D,G=new pe,x=new pe,B=new pe;for(let R=0,Z=0;R<s.length;R+=9,Z+=6){y.set(s[R+0],s[R+1],s[R+2]),v.set(s[R+3],s[R+4],s[R+5]),b.set(s[R+6],s[R+7],s[R+8]),G.set(o[Z+0],o[Z+1]),x.set(o[Z+2],o[Z+3]),B.set(o[Z+4],o[Z+5]),w.copy(y).add(v).add(b).divideScalar(3);const W=A(w);I(G,Z+0,y,W),I(x,Z+2,v,W),I(B,Z+4,b,W)}}function I(y,v,b,w){w<0&&y.x===1&&(o[v]=y.x-1),b.x===0&&b.z===0&&(o[v]=w/2/Math.PI+.5)}function A(y){return Math.atan2(y.z,-y.x)}function p(y){return Math.atan2(-y.y,Math.sqrt(y.x*y.x+y.z*y.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new qg(e.vertices,e.indices,e.radius,e.details)}}class fv extends qg{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,r=1/i,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new fv(e.radius,e.detail)}}const wB=new D,xB=new D,VR=new D,SB=new Fg;class u4 extends Et{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const r=Math.pow(10,4),s=Math.cos(Qh*t),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,c=[0,0,0],g=["a","b","c"],u=new Array(3),d={},h=[];for(let f=0;f<l;f+=3){o?(c[0]=o.getX(f),c[1]=o.getX(f+1),c[2]=o.getX(f+2)):(c[0]=f,c[1]=f+1,c[2]=f+2);const{a:I,b:A,c:p}=SB;if(I.fromBufferAttribute(a,c[0]),A.fromBufferAttribute(a,c[1]),p.fromBufferAttribute(a,c[2]),SB.getNormal(VR),u[0]=`${Math.round(I.x*r)},${Math.round(I.y*r)},${Math.round(I.z*r)}`,u[1]=`${Math.round(A.x*r)},${Math.round(A.y*r)},${Math.round(A.z*r)}`,u[2]=`${Math.round(p.x*r)},${Math.round(p.y*r)},${Math.round(p.z*r)}`,!(u[0]===u[1]||u[1]===u[2]||u[2]===u[0]))for(let y=0;y<3;y++){const v=(y+1)%3,b=u[y],w=u[v],G=SB[g[y]],x=SB[g[v]],B=`${b}_${w}`,R=`${w}_${b}`;R in d&&d[R]?(VR.dot(d[R].normal)<=s&&(h.push(G.x,G.y,G.z),h.push(x.x,x.y,x.z)),d[R]=null):B in d||(d[B]={index0:c[y],index1:c[v],normal:VR.clone()})}}for(const f in d)if(d[f]){const{index0:I,index1:A}=d[f];wB.fromBufferAttribute(a,I),xB.fromBufferAttribute(a,A),h.push(wB.x,wB.y,wB.z),h.push(xB.x,xB.y,xB.z)}this.setAttribute("position",new ht(h,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}let ad=class extends vy{constructor(e){super(e),this.uuid=jo(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const r=e.holes[t];this.holes.push(new vy().fromJSON(r))}return this}};const Qce={triangulate:function(n,e,t=2){const i=e&&e.length,r=i?e[0]*t:n.length;let s=d4(n,0,r,t,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,g,u,d,h;if(i&&(s=$ce(n,e,s,t)),n.length>80*t){a=c=n[0],l=g=n[1];for(let f=t;f<r;f+=t)u=n[f],d=n[f+1],u<a&&(a=u),d<l&&(l=d),u>c&&(c=u),d>g&&(g=d);h=Math.max(c-a,g-l),h=h!==0?32767/h:0}return by(s,o,t,a,l,h,0),o}};function d4(n,e,t,i,r){let s,o;if(r===gge(n,e,t,i)>0)for(s=e;s<t;s+=i)o=lL(s,n[s],n[s+1],o);else for(s=t-i;s>=e;s-=i)o=lL(s,n[s],n[s+1],o);return o&&zw(o,o.next)&&(Gy(o),o=o.next),o}function If(n,e){if(!n)return n;e||(e=n);let t=n,i;do if(i=!1,!t.steiner&&(zw(t,t.next)||hi(t.prev,t,t.next)===0)){if(Gy(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function by(n,e,t,i,r,s,o){if(!n)return;!o&&s&&rge(n,i,r,s);let a=n,l,c;for(;n.prev!==n.next;){if(l=n.prev,c=n.next,s?Jce(n,i,r,s):Oce(n)){e.push(l.i/t|0),e.push(n.i/t|0),e.push(c.i/t|0),Gy(n),n=c.next,a=c.next;continue}if(n=c,n===a){o?o===1?(n=jce(If(n),e,t),by(n,e,t,i,r,s,2)):o===2&&qce(n,e,t,i,r,s):by(If(n),e,t,i,r,s,1);break}}}function Oce(n){const e=n.prev,t=n,i=n.next;if(hi(e,t,i)>=0)return!1;const r=e.x,s=t.x,o=i.x,a=e.y,l=t.y,c=i.y,g=r<s?r<o?r:o:s<o?s:o,u=a<l?a<c?a:c:l<c?l:c,d=r>s?r>o?r:o:s>o?s:o,h=a>l?a>c?a:c:l>c?l:c;let f=i.next;for(;f!==e;){if(f.x>=g&&f.x<=d&&f.y>=u&&f.y<=h&&IA(r,a,s,l,o,c,f.x,f.y)&&hi(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Jce(n,e,t,i){const r=n.prev,s=n,o=n.next;if(hi(r,s,o)>=0)return!1;const a=r.x,l=s.x,c=o.x,g=r.y,u=s.y,d=o.y,h=a<l?a<c?a:c:l<c?l:c,f=g<u?g<d?g:d:u<d?u:d,I=a>l?a>c?a:c:l>c?l:c,A=g>u?g>d?g:d:u>d?u:d,p=y3(h,f,e,t,i),y=y3(I,A,e,t,i);let v=n.prevZ,b=n.nextZ;for(;v&&v.z>=p&&b&&b.z<=y;){if(v.x>=h&&v.x<=I&&v.y>=f&&v.y<=A&&v!==r&&v!==o&&IA(a,g,l,u,c,d,v.x,v.y)&&hi(v.prev,v,v.next)>=0||(v=v.prevZ,b.x>=h&&b.x<=I&&b.y>=f&&b.y<=A&&b!==r&&b!==o&&IA(a,g,l,u,c,d,b.x,b.y)&&hi(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;v&&v.z>=p;){if(v.x>=h&&v.x<=I&&v.y>=f&&v.y<=A&&v!==r&&v!==o&&IA(a,g,l,u,c,d,v.x,v.y)&&hi(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;b&&b.z<=y;){if(b.x>=h&&b.x<=I&&b.y>=f&&b.y<=A&&b!==r&&b!==o&&IA(a,g,l,u,c,d,b.x,b.y)&&hi(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function jce(n,e,t){let i=n;do{const r=i.prev,s=i.next.next;!zw(r,s)&&h4(r,i,i.next,s)&&By(r,s)&&By(s,r)&&(e.push(r.i/t|0),e.push(i.i/t|0),e.push(s.i/t|0),Gy(i),Gy(i.next),i=n=s),i=i.next}while(i!==n);return If(i)}function qce(n,e,t,i,r,s){let o=n;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&age(o,a)){let l=f4(o,a);o=If(o,o.next),l=If(l,l.next),by(o,e,t,i,r,s,0),by(l,e,t,i,r,s,0);return}a=a.next}o=o.next}while(o!==n)}function $ce(n,e,t,i){const r=[];let s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*i,l=s<o-1?e[s+1]*i:n.length,c=d4(n,a,l,i,!1),c===c.next&&(c.steiner=!0),r.push(oge(c));for(r.sort(ege),s=0;s<r.length;s++)t=tge(r[s],t);return t}function ege(n,e){return n.x-e.x}function tge(n,e){const t=nge(n,e);if(!t)return e;const i=f4(t,n);return If(i,i.next),If(t,t.next)}function nge(n,e){let t=e,i=-1/0,r;const s=n.x,o=n.y;do{if(o<=t.y&&o>=t.next.y&&t.next.y!==t.y){const d=t.x+(o-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(d<=s&&d>i&&(i=d,r=t.x<t.next.x?t:t.next,d===s))return r}t=t.next}while(t!==e);if(!r)return null;const a=r,l=r.x,c=r.y;let g=1/0,u;t=r;do s>=t.x&&t.x>=l&&s!==t.x&&IA(o<c?s:i,o,l,c,o<c?i:s,o,t.x,t.y)&&(u=Math.abs(o-t.y)/(s-t.x),By(t,n)&&(u<g||u===g&&(t.x>r.x||t.x===r.x&&ige(r,t)))&&(r=t,g=u)),t=t.next;while(t!==a);return r}function ige(n,e){return hi(n.prev,n,e.prev)<0&&hi(e.next,n,n.next)<0}function rge(n,e,t,i){let r=n;do r.z===0&&(r.z=y3(r.x,r.y,e,t,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==n);r.prevZ.nextZ=null,r.prevZ=null,sge(r)}function sge(n){let e,t,i,r,s,o,a,l,c=1;do{for(t=n,n=null,s=null,o=0;t;){for(o++,i=t,a=0,e=0;e<c&&(a++,i=i.nextZ,!!i);e++);for(l=c;a>0||l>0&&i;)a!==0&&(l===0||!i||t.z<=i.z)?(r=t,t=t.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:n=r,r.prevZ=s,s=r;t=i}s.nextZ=null,c*=2}while(o>1);return n}function y3(n,e,t,i,r){return n=(n-t)*r|0,e=(e-i)*r|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function oge(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function IA(n,e,t,i,r,s,o,a){return(r-o)*(e-a)>=(n-o)*(s-a)&&(n-o)*(i-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(r-o)*(i-a)}function age(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!lge(n,e)&&(By(n,e)&&By(e,n)&&cge(n,e)&&(hi(n.prev,n,e.prev)||hi(n,e.prev,e))||zw(n,e)&&hi(n.prev,n,n.next)>0&&hi(e.prev,e,e.next)>0)}function hi(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function zw(n,e){return n.x===e.x&&n.y===e.y}function h4(n,e,t,i){const r=ZB(hi(n,e,t)),s=ZB(hi(n,e,i)),o=ZB(hi(t,i,n)),a=ZB(hi(t,i,e));return!!(r!==s&&o!==a||r===0&&RB(n,t,e)||s===0&&RB(n,i,e)||o===0&&RB(t,n,i)||a===0&&RB(t,e,i))}function RB(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function ZB(n){return n>0?1:n<0?-1:0}function lge(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&h4(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function By(n,e){return hi(n.prev,n,n.next)<0?hi(n,e,n.next)>=0&&hi(n,n.prev,e)>=0:hi(n,e,n.prev)<0||hi(n,n.next,e)<0}function cge(n,e){let t=n,i=!1;const r=(n.x+e.x)/2,s=(n.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&r<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function f4(n,e){const t=new v3(n.i,n.x,n.y),i=new v3(e.i,e.x,e.y),r=n.next,s=e.prev;return n.next=e,e.prev=n,t.next=r,r.prev=t,i.next=t,t.prev=i,s.next=i,i.prev=s,i}function lL(n,e,t,i){const r=new v3(n,e,t);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Gy(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function v3(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function gge(n,e,t,i){let r=0;for(let s=e,o=t-i;s<t;s+=i)r+=(n[o]-n[s])*(n[s+1]+n[o+1]),o=s;return r}class mc{static area(e){const t=e.length;let i=0;for(let r=t-1,s=0;s<t;r=s++)i+=e[r].x*e[s].y-e[s].x*e[r].y;return i*.5}static isClockWise(e){return mc.area(e)<0}static triangulateShape(e,t){const i=[],r=[],s=[];cL(e),gL(i,e);let o=e.length;t.forEach(cL);for(let l=0;l<t.length;l++)r.push(o),o+=t[l].length,gL(i,t[l]);const a=Qce.triangulate(i,r);for(let l=0;l<a.length;l+=3)s.push(a.slice(l,l+3));return s}}function cL(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function gL(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class Iv extends Et{constructor(e=new ad([new pe(.5,.5),new pe(-.5,.5),new pe(-.5,-.5),new pe(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,r=[],s=[];for(let a=0,l=e.length;a<l;a++){const c=e[a];o(c)}this.setAttribute("position",new ht(r,3)),this.setAttribute("uv",new ht(s,2)),this.computeVertexNormals();function o(a){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,g=t.steps!==void 0?t.steps:1,u=t.depth!==void 0?t.depth:1;let d=t.bevelEnabled!==void 0?t.bevelEnabled:!0,h=t.bevelThickness!==void 0?t.bevelThickness:.2,f=t.bevelSize!==void 0?t.bevelSize:h-.1,I=t.bevelOffset!==void 0?t.bevelOffset:0,A=t.bevelSegments!==void 0?t.bevelSegments:3;const p=t.extrudePath,y=t.UVGenerator!==void 0?t.UVGenerator:uge;let v,b=!1,w,G,x,B;p&&(v=p.getSpacedPoints(g),b=!0,d=!1,w=p.computeFrenetFrames(g,!1),G=new D,x=new D,B=new D),d||(A=0,h=0,f=0,I=0);const R=a.extractPoints(c);let Z=R.shape;const W=R.holes;if(!mc.isClockWise(Z)){Z=Z.reverse();for(let ee=0,le=W.length;ee<le;ee++){const he=W[ee];mc.isClockWise(he)&&(W[ee]=he.reverse())}}const T=mc.triangulateShape(Z,W),V=Z;for(let ee=0,le=W.length;ee<le;ee++){const he=W[ee];Z=Z.concat(he)}function z(ee,le,he){return le||console.error("THREE.ExtrudeGeometry: vec does not exist"),ee.clone().addScaledVector(le,he)}const U=Z.length,J=T.length;function H(ee,le,he){let be,xe,ze;const Se=ee.x-le.x,ke=ee.y-le.y,He=he.x-ee.x,Be=he.y-ee.y,j=Se*Se+ke*ke,X=Se*Be-ke*He;if(Math.abs(X)>Number.EPSILON){const ce=Math.sqrt(j),fe=Math.sqrt(He*He+Be*Be),Ge=le.x-ke/ce,me=le.y+Se/ce,Fe=he.x-Be/fe,Le=he.y+He/fe,Re=((Fe-Ge)*Be-(Le-me)*He)/(Se*Be-ke*He);be=Ge+Se*Re-ee.x,xe=me+ke*Re-ee.y;const Xe=be*be+xe*xe;if(Xe<=2)return new pe(be,xe);ze=Math.sqrt(Xe/2)}else{let ce=!1;Se>Number.EPSILON?He>Number.EPSILON&&(ce=!0):Se<-Number.EPSILON?He<-Number.EPSILON&&(ce=!0):Math.sign(ke)===Math.sign(Be)&&(ce=!0),ce?(be=-ke,xe=Se,ze=Math.sqrt(j)):(be=Se,xe=ke,ze=Math.sqrt(j/2))}return new pe(be/ze,xe/ze)}const Y=[];for(let ee=0,le=V.length,he=le-1,be=ee+1;ee<le;ee++,he++,be++)he===le&&(he=0),be===le&&(be=0),Y[ee]=H(V[ee],V[he],V[be]);const K=[];let Q,P=Y.concat();for(let ee=0,le=W.length;ee<le;ee++){const he=W[ee];Q=[];for(let be=0,xe=he.length,ze=xe-1,Se=be+1;be<xe;be++,ze++,Se++)ze===xe&&(ze=0),Se===xe&&(Se=0),Q[be]=H(he[be],he[ze],he[Se]);K.push(Q),P=P.concat(Q)}for(let ee=0;ee<A;ee++){const le=ee/A,he=h*Math.cos(le*Math.PI/2),be=f*Math.sin(le*Math.PI/2)+I;for(let xe=0,ze=V.length;xe<ze;xe++){const Se=z(V[xe],Y[xe],be);ge(Se.x,Se.y,-he)}for(let xe=0,ze=W.length;xe<ze;xe++){const Se=W[xe];Q=K[xe];for(let ke=0,He=Se.length;ke<He;ke++){const Be=z(Se[ke],Q[ke],be);ge(Be.x,Be.y,-he)}}}const ne=f+I;for(let ee=0;ee<U;ee++){const le=d?z(Z[ee],P[ee],ne):Z[ee];b?(x.copy(w.normals[0]).multiplyScalar(le.x),G.copy(w.binormals[0]).multiplyScalar(le.y),B.copy(v[0]).add(x).add(G),ge(B.x,B.y,B.z)):ge(le.x,le.y,0)}for(let ee=1;ee<=g;ee++)for(let le=0;le<U;le++){const he=d?z(Z[le],P[le],ne):Z[le];b?(x.copy(w.normals[ee]).multiplyScalar(he.x),G.copy(w.binormals[ee]).multiplyScalar(he.y),B.copy(v[ee]).add(x).add(G),ge(B.x,B.y,B.z)):ge(he.x,he.y,u/g*ee)}for(let ee=A-1;ee>=0;ee--){const le=ee/A,he=h*Math.cos(le*Math.PI/2),be=f*Math.sin(le*Math.PI/2)+I;for(let xe=0,ze=V.length;xe<ze;xe++){const Se=z(V[xe],Y[xe],be);ge(Se.x,Se.y,u+he)}for(let xe=0,ze=W.length;xe<ze;xe++){const Se=W[xe];Q=K[xe];for(let ke=0,He=Se.length;ke<He;ke++){const Be=z(Se[ke],Q[ke],be);b?ge(Be.x,Be.y+v[g-1].y,v[g-1].x+he):ge(Be.x,Be.y,u+he)}}}oe(),$();function oe(){const ee=r.length/3;if(d){let le=0,he=U*le;for(let be=0;be<J;be++){const xe=T[be];se(xe[2]+he,xe[1]+he,xe[0]+he)}le=g+A*2,he=U*le;for(let be=0;be<J;be++){const xe=T[be];se(xe[0]+he,xe[1]+he,xe[2]+he)}}else{for(let le=0;le<J;le++){const he=T[le];se(he[2],he[1],he[0])}for(let le=0;le<J;le++){const he=T[le];se(he[0]+U*g,he[1]+U*g,he[2]+U*g)}}i.addGroup(ee,r.length/3-ee,0)}function $(){const ee=r.length/3;let le=0;de(V,le),le+=V.length;for(let he=0,be=W.length;he<be;he++){const xe=W[he];de(xe,le),le+=xe.length}i.addGroup(ee,r.length/3-ee,1)}function de(ee,le){let he=ee.length;for(;--he>=0;){const be=he;let xe=he-1;xe<0&&(xe=ee.length-1);for(let ze=0,Se=g+A*2;ze<Se;ze++){const ke=U*ze,He=U*(ze+1),Be=le+be+ke,j=le+xe+ke,X=le+xe+He,ce=le+be+He;k(Be,j,X,ce)}}}function ge(ee,le,he){l.push(ee),l.push(le),l.push(he)}function se(ee,le,he){O(ee),O(le),O(he);const be=r.length/3,xe=y.generateTopUV(i,r,be-3,be-2,be-1);q(xe[0]),q(xe[1]),q(xe[2])}function k(ee,le,he,be){O(ee),O(le),O(be),O(le),O(he),O(be);const xe=r.length/3,ze=y.generateSideWallUV(i,r,xe-6,xe-3,xe-2,xe-1);q(ze[0]),q(ze[1]),q(ze[3]),q(ze[1]),q(ze[2]),q(ze[3])}function O(ee){r.push(l[ee*3+0]),r.push(l[ee*3+1]),r.push(l[ee*3+2])}function q(ee){s.push(ee.x),s.push(ee.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return dge(t,i,e)}static fromJSON(e,t){const i=[];for(let s=0,o=e.shapes.length;s<o;s++){const a=t[e.shapes[s]];i.push(a)}const r=e.options.extrudePath;return r!==void 0&&(e.options.extrudePath=new eV[r.type]().fromJSON(r)),new Iv(i,e.options)}}const uge={generateTopUV:function(n,e,t,i,r){const s=e[t*3],o=e[t*3+1],a=e[i*3],l=e[i*3+1],c=e[r*3],g=e[r*3+1];return[new pe(s,o),new pe(a,l),new pe(c,g)]},generateSideWallUV:function(n,e,t,i,r,s){const o=e[t*3],a=e[t*3+1],l=e[t*3+2],c=e[i*3],g=e[i*3+1],u=e[i*3+2],d=e[r*3],h=e[r*3+1],f=e[r*3+2],I=e[s*3],A=e[s*3+1],p=e[s*3+2];return Math.abs(a-g)<Math.abs(o-c)?[new pe(o,1-l),new pe(c,1-u),new pe(d,1-f),new pe(I,1-p)]:[new pe(a,1-l),new pe(g,1-u),new pe(h,1-f),new pe(A,1-p)]}};function dge(n,e,t){if(t.shapes=[],Array.isArray(n))for(let i=0,r=n.length;i<r;i++){const s=n[i];t.shapes.push(s.uuid)}else t.shapes.push(n.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class NC extends qg{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new NC(e.radius,e.detail)}}class kC extends qg{constructor(e=1,t=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,r,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new kC(e.radius,e.detail)}}class Av extends Et{constructor(e=.5,t=1,i=32,r=1,s=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:s,thetaLength:o},i=Math.max(3,i),r=Math.max(1,r);const a=[],l=[],c=[],g=[];let u=e;const d=(t-e)/r,h=new D,f=new pe;for(let I=0;I<=r;I++){for(let A=0;A<=i;A++){const p=s+A/i*o;h.x=u*Math.cos(p),h.y=u*Math.sin(p),l.push(h.x,h.y,h.z),c.push(0,0,1),f.x=(h.x/t+1)/2,f.y=(h.y/t+1)/2,g.push(f.x,f.y)}u+=d}for(let I=0;I<r;I++){const A=I*(i+1);for(let p=0;p<i;p++){const y=p+A,v=y,b=y+i+1,w=y+i+2,G=y+1;a.push(v,b,G),a.push(b,w,G)}}this.setIndex(a),this.setAttribute("position",new ht(l,3)),this.setAttribute("normal",new ht(c,3)),this.setAttribute("uv",new ht(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Av(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Cv extends Et{constructor(e=new ad([new pe(0,.5),new pe(-.5,-.5),new pe(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],r=[],s=[],o=[];let a=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let g=0;g<e.length;g++)c(e[g]),this.addGroup(a,l,g),a+=l,l=0;this.setIndex(i),this.setAttribute("position",new ht(r,3)),this.setAttribute("normal",new ht(s,3)),this.setAttribute("uv",new ht(o,2));function c(g){const u=r.length/3,d=g.extractPoints(t);let h=d.shape;const f=d.holes;mc.isClockWise(h)===!1&&(h=h.reverse());for(let A=0,p=f.length;A<p;A++){const y=f[A];mc.isClockWise(y)===!0&&(f[A]=y.reverse())}const I=mc.triangulateShape(h,f);for(let A=0,p=f.length;A<p;A++){const y=f[A];h=h.concat(y)}for(let A=0,p=h.length;A<p;A++){const y=h[A];r.push(y.x,y.y,0),s.push(0,0,1),o.push(y.x,y.y)}for(let A=0,p=I.length;A<p;A++){const y=I[A],v=y[0]+u,b=y[1]+u,w=y[2]+u;i.push(v,b,w),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return hge(t,e)}static fromJSON(e,t){const i=[];for(let r=0,s=e.shapes.length;r<s;r++){const o=t[e.shapes[r]];i.push(o)}return new Cv(i,e.curveSegments)}}function hge(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const r=n[t];e.shapes.push(r.uuid)}else e.shapes.push(n.uuid);return e}class xf extends Et{constructor(e=1,t=32,i=16,r=0,s=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:s,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(o+a,Math.PI);let c=0;const g=[],u=new D,d=new D,h=[],f=[],I=[],A=[];for(let p=0;p<=i;p++){const y=[],v=p/i;let b=0;p==0&&o==0?b=.5/t:p==i&&l==Math.PI&&(b=-.5/t);for(let w=0;w<=t;w++){const G=w/t;u.x=-e*Math.cos(r+G*s)*Math.sin(o+v*a),u.y=e*Math.cos(o+v*a),u.z=e*Math.sin(r+G*s)*Math.sin(o+v*a),f.push(u.x,u.y,u.z),d.copy(u).normalize(),I.push(d.x,d.y,d.z),A.push(G+b,1-v),y.push(c++)}g.push(y)}for(let p=0;p<i;p++)for(let y=0;y<t;y++){const v=g[p][y+1],b=g[p][y],w=g[p+1][y],G=g[p+1][y+1];(p!==0||o>0)&&h.push(v,b,G),(p!==i-1||l<Math.PI)&&h.push(b,w,G)}this.setIndex(h),this.setAttribute("position",new ht(f,3)),this.setAttribute("normal",new ht(I,3)),this.setAttribute("uv",new ht(A,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new xf(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class pv extends qg{constructor(e=1,t=0){const i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];super(i,r,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new pv(e.radius,e.detail)}}class mv extends Et{constructor(e=1,t=.4,i=12,r=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:s},i=Math.floor(i),r=Math.floor(r);const o=[],a=[],l=[],c=[],g=new D,u=new D,d=new D;for(let h=0;h<=i;h++)for(let f=0;f<=r;f++){const I=f/r*s,A=h/i*Math.PI*2;u.x=(e+t*Math.cos(A))*Math.cos(I),u.y=(e+t*Math.cos(A))*Math.sin(I),u.z=t*Math.sin(A),a.push(u.x,u.y,u.z),g.x=e*Math.cos(I),g.y=e*Math.sin(I),d.subVectors(u,g).normalize(),l.push(d.x,d.y,d.z),c.push(f/r),c.push(h/i)}for(let h=1;h<=i;h++)for(let f=1;f<=r;f++){const I=(r+1)*h+f-1,A=(r+1)*(h-1)+f-1,p=(r+1)*(h-1)+f,y=(r+1)*h+f;o.push(I,A,y),o.push(A,p,y)}this.setIndex(o),this.setAttribute("position",new ht(a,3)),this.setAttribute("normal",new ht(l,3)),this.setAttribute("uv",new ht(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new mv(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class yv extends Et{constructor(e=1,t=.4,i=64,r=8,s=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:s,q:o},i=Math.floor(i),r=Math.floor(r);const a=[],l=[],c=[],g=[],u=new D,d=new D,h=new D,f=new D,I=new D,A=new D,p=new D;for(let v=0;v<=i;++v){const b=v/i*s*Math.PI*2;y(b,s,o,e,h),y(b+.01,s,o,e,f),A.subVectors(f,h),p.addVectors(f,h),I.crossVectors(A,p),p.crossVectors(I,A),I.normalize(),p.normalize();for(let w=0;w<=r;++w){const G=w/r*Math.PI*2,x=-t*Math.cos(G),B=t*Math.sin(G);u.x=h.x+(x*p.x+B*I.x),u.y=h.y+(x*p.y+B*I.y),u.z=h.z+(x*p.z+B*I.z),l.push(u.x,u.y,u.z),d.subVectors(u,h).normalize(),c.push(d.x,d.y,d.z),g.push(v/i),g.push(w/r)}}for(let v=1;v<=i;v++)for(let b=1;b<=r;b++){const w=(r+1)*(v-1)+(b-1),G=(r+1)*v+(b-1),x=(r+1)*v+b,B=(r+1)*(v-1)+b;a.push(w,G,B),a.push(G,x,B)}this.setIndex(a),this.setAttribute("position",new ht(l,3)),this.setAttribute("normal",new ht(c,3)),this.setAttribute("uv",new ht(g,2));function y(v,b,w,G,x){const B=Math.cos(v),R=Math.sin(v),Z=w/b*v,W=Math.cos(Z);x.x=G*(2+W)*.5*B,x.y=G*(2+W)*R*.5,x.z=G*Math.sin(Z)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new yv(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class vv extends Et{constructor(e=new q_(new D(-1,-1,0),new D(-1,1,0),new D(1,1,0)),t=64,i=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:s};const o=e.computeFrenetFrames(t,s);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new D,l=new D,c=new pe;let g=new D;const u=[],d=[],h=[],f=[];I(),this.setIndex(f),this.setAttribute("position",new ht(u,3)),this.setAttribute("normal",new ht(d,3)),this.setAttribute("uv",new ht(h,2));function I(){for(let v=0;v<t;v++)A(v);A(s===!1?t:0),y(),p()}function A(v){g=e.getPointAt(v/t,g);const b=o.normals[v],w=o.binormals[v];for(let G=0;G<=r;G++){const x=G/r*Math.PI*2,B=Math.sin(x),R=-Math.cos(x);l.x=R*b.x+B*w.x,l.y=R*b.y+B*w.y,l.z=R*b.z+B*w.z,l.normalize(),d.push(l.x,l.y,l.z),a.x=g.x+i*l.x,a.y=g.y+i*l.y,a.z=g.z+i*l.z,u.push(a.x,a.y,a.z)}}function p(){for(let v=1;v<=t;v++)for(let b=1;b<=r;b++){const w=(r+1)*(v-1)+(b-1),G=(r+1)*v+(b-1),x=(r+1)*v+b,B=(r+1)*(v-1)+b;f.push(w,G,B),f.push(G,x,B)}}function y(){for(let v=0;v<=t;v++)for(let b=0;b<=r;b++)c.x=v/t,c.y=b/r,h.push(c.x,c.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new vv(new eV[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class I4 extends Et{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],i=new Set,r=new D,s=new D;if(e.index!==null){const o=e.attributes.position,a=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:a.count,materialIndex:0}]);for(let c=0,g=l.length;c<g;++c){const u=l[c],d=u.start,h=u.count;for(let f=d,I=d+h;f<I;f+=3)for(let A=0;A<3;A++){const p=a.getX(f+A),y=a.getX(f+(A+1)%3);r.fromBufferAttribute(o,p),s.fromBufferAttribute(o,y),uL(r,s,i)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}}else{const o=e.attributes.position;for(let a=0,l=o.count/3;a<l;a++)for(let c=0;c<3;c++){const g=3*a+c,u=3*a+(c+1)%3;r.fromBufferAttribute(o,g),s.fromBufferAttribute(o,u),uL(r,s,i)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new ht(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function uL(n,e,t){const i=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return t.has(i)===!0||t.has(r)===!0?!1:(t.add(i),t.add(r),!0)}var dL=Object.freeze({__proto__:null,BoxGeometry:FC,CapsuleGeometry:gv,CircleGeometry:uv,ConeGeometry:hv,CylinderGeometry:dv,DodecahedronGeometry:fv,EdgesGeometry:u4,ExtrudeGeometry:Iv,IcosahedronGeometry:NC,LatheGeometry:TC,OctahedronGeometry:kC,PlaneGeometry:Fc,PolyhedronGeometry:qg,RingGeometry:Av,ShapeGeometry:Cv,SphereGeometry:xf,TetrahedronGeometry:pv,TorusGeometry:mv,TorusKnotGeometry:yv,TubeGeometry:vv,WireframeGeometry:I4});class A4 extends ai{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Ke(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class C4 extends Nt{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}let Sf=class extends ai{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ke(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ke(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wc,this.normalScale=new pe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}};class Vc extends Sf{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new pe(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Wi(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Ke(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Ke(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ke(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class tV extends ai{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ke(16777215),this.specular=new Ke(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ke(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wc,this.normalScale=new pe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=iv,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class nV extends ai{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ke(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ke(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wc,this.normalScale=new pe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}let iV=class extends ai{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wc,this.normalScale=new pe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}},rV=class extends ai{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ke(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ke(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wc,this.normalScale=new pe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=iv,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}};class p4 extends ai{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ke(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wc,this.normalScale=new pe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class m4 extends Cs{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function wa(n,e,t){return sV(n)?new n.constructor(n.subarray(e,t!==void 0?t:n.length)):n.slice(e,t)}function Lh(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function sV(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function y4(n){function e(r,s){return n[r]-n[s]}const t=n.length,i=new Array(t);for(let r=0;r!==t;++r)i[r]=r;return i.sort(e),i}function b3(n,e,t){const i=n.length,r=new n.constructor(i);for(let s=0,o=0;o!==i;++s){const a=t[s]*e;for(let l=0;l!==e;++l)r[o++]=n[a+l]}return r}function oV(n,e,t,i){let r=1,s=n[0];for(;s!==void 0&&s[i]===void 0;)s=n[r++];if(s===void 0)return;let o=s[i];if(o!==void 0)if(Array.isArray(o))do o=s[i],o!==void 0&&(e.push(s.time),t.push.apply(t,o)),s=n[r++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[i],o!==void 0&&(e.push(s.time),o.toArray(t,t.length)),s=n[r++];while(s!==void 0);else do o=s[i],o!==void 0&&(e.push(s.time),t.push(o)),s=n[r++];while(s!==void 0)}function fge(n,e,t,i,r=30){const s=n.clone();s.name=e;const o=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],g=c.getValueSize(),u=[],d=[];for(let h=0;h<c.times.length;++h){const f=c.times[h]*r;if(!(f<t||f>=i)){u.push(c.times[h]);for(let I=0;I<g;++I)d.push(c.values[h*g+I])}}u.length!==0&&(c.times=Lh(u,c.times.constructor),c.values=Lh(d,c.values.constructor),o.push(c))}s.tracks=o;let a=1/0;for(let l=0;l<s.tracks.length;++l)a>s.tracks[l].times[0]&&(a=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*a);return s.resetDuration(),s}function Ige(n,e=0,t=n,i=30){i<=0&&(i=30);const r=t.tracks.length,s=e/i;for(let o=0;o<r;++o){const a=t.tracks[o],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const c=n.tracks.find(function(p){return p.name===a.name&&p.ValueTypeName===l});if(c===void 0)continue;let g=0;const u=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(g=u/3);let d=0;const h=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=h/3);const f=a.times.length-1;let I;if(s<=a.times[0]){const p=g,y=u-g;I=wa(a.values,p,y)}else if(s>=a.times[f]){const p=f*u+g,y=p+u-g;I=wa(a.values,p,y)}else{const p=a.createInterpolant(),y=g,v=u-g;p.evaluate(s),I=wa(p.resultBuffer,y,v)}l==="quaternion"&&new xn().fromArray(I).normalize().conjugate().toArray(I);const A=c.times.length;for(let p=0;p<A;++p){const y=p*h+d;if(l==="quaternion")xn.multiplyQuaternionsFlat(c.values,y,I,0,c.values,y);else{const v=h-d*2;for(let b=0;b<v;++b)c.values[y+b]-=I[b]}}}return n.blendMode=F_,n}const Age={arraySlice:wa,convertArray:Lh,isTypedArray:sV,getKeyframeOrder:y4,sortedArray:b3,flattenJSON:oV,subclip:fge,makeClipAdditive:Ige};class LC{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],s=t[i-1];e:{t:{let o;n:{i:if(!(e<r)){for(let a=i+2;;){if(r===void 0){if(e<s)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(s=r,r=t[++i],e<r)break t}o=t.length;break n}if(!(e>=s)){const a=t[1];e<a&&(i=2,s=a);for(let l=i-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(r=s,s=t[--i-1],e>=s)break t}o=i,i=0;break n}break e}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(r=t[i],s=t[i-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)t[o]=i[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class v4 extends LC{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Th,endingEnd:Th}}intervalChanged_(e,t,i){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],l=r[o];if(a===void 0)switch(this.getSettings_().endingStart){case Nh:s=e,a=2*t-i;break;case Cy:s=r.length-2,a=t+r[s]-r[s+1];break;default:s=e,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case Nh:o=e,l=2*i-t;break;case Cy:o=1,l=i+r[1]-r[0];break;default:o=e-1,l=t}const c=(i-t)*.5,g=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-i),this._offsetPrev=s*g,this._offsetNext=o*g}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,g=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,h=this._weightNext,f=(i-t)/(r-t),I=f*f,A=I*f,p=-d*A+2*d*I-d*f,y=(1+d)*A+(-1.5-2*d)*I+(-.5+d)*f+1,v=(-1-h)*A+(1.5+h)*I+.5*f,b=h*A-h*I;for(let w=0;w!==a;++w)s[w]=p*o[g+w]+y*o[c+w]+v*o[l+w]+b*o[u+w];return s}}class aV extends LC{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,g=(i-t)/(r-t),u=1-g;for(let d=0;d!==a;++d)s[d]=o[c+d]*u+o[l+d]*g;return s}}class b4 extends LC{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Wl{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Lh(t,this.TimeBufferType),this.values=Lh(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Lh(e.times,Array),values:Lh(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new b4(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new aV(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new v4(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case sC:t=this.InterpolantFactoryMethodDiscrete;break;case hf:t=this.InterpolantFactoryMethodLinear;break;case g1:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return sC;case this.InterpolantFactoryMethodLinear:return hf;case this.InterpolantFactoryMethodSmooth:return g1}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let s=0,o=r-1;for(;s!==r&&i[s]<e;)++s;for(;o!==-1&&i[o]>t;)--o;if(++o,s!==0||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=wa(i,s,o),this.values=wa(this.values,s*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,s=i.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(r!==void 0&&sV(r))for(let a=0,l=r.length;a!==l;++a){const c=r[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=wa(this.times),t=wa(this.values),i=this.getValueSize(),r=this.getInterpolation()===g1,s=e.length-1;let o=1;for(let a=1;a<s;++a){let l=!1;const c=e[a],g=e[a+1];if(c!==g&&(a!==1||c!==e[0]))if(r)l=!0;else{const u=a*i,d=u-i,h=u+i;for(let f=0;f!==i;++f){const I=t[u+f];if(I!==t[d+f]||I!==t[h+f]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const u=a*i,d=o*i;for(let h=0;h!==i;++h)t[d+h]=t[u+h]}++o}}if(s>0){e[o]=e[s];for(let a=s*i,l=o*i,c=0;c!==i;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=wa(e,0,o),this.values=wa(t,0,o*i)):(this.times=e,this.values=t),this}clone(){const e=wa(this.times,0),t=wa(this.values,0),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}Wl.prototype.TimeBufferType=Float32Array;Wl.prototype.ValueBufferType=Float32Array;Wl.prototype.DefaultInterpolation=hf;class Rf extends Wl{}Rf.prototype.ValueTypeName="bool";Rf.prototype.ValueBufferType=Array;Rf.prototype.DefaultInterpolation=sC;Rf.prototype.InterpolantFactoryMethodLinear=void 0;Rf.prototype.InterpolantFactoryMethodSmooth=void 0;class lV extends Wl{}lV.prototype.ValueTypeName="color";class lC extends Wl{}lC.prototype.ValueTypeName="number";class B4 extends LC{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-t)/(r-t);let c=e*a;for(let g=c+a;c!==g;c+=4)xn.slerpFlat(s,0,o,c-a,o,c,l);return s}}class md extends Wl{InterpolantFactoryMethodLinear(e){return new B4(this.times,this.values,this.getValueSize(),e)}}md.prototype.ValueTypeName="quaternion";md.prototype.DefaultInterpolation=hf;md.prototype.InterpolantFactoryMethodSmooth=void 0;class Zf extends Wl{}Zf.prototype.ValueTypeName="string";Zf.prototype.ValueBufferType=Array;Zf.prototype.DefaultInterpolation=sC;Zf.prototype.InterpolantFactoryMethodLinear=void 0;Zf.prototype.InterpolantFactoryMethodSmooth=void 0;class cC extends Wl{}cC.prototype.ValueTypeName="vector";class gC{constructor(e,t=-1,i,r=Zw){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=jo(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,r=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)t.push(pge(i[o]).scale(r));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,o=i.length;s!==o;++s)t.push(Wl.toJSON(i[s]));return r}static CreateFromMorphTargetSequence(e,t,i,r){const s=t.length,o=[];for(let a=0;a<s;a++){let l=[],c=[];l.push((a+s-1)%s,a,(a+1)%s),c.push(0,1,0);const g=y4(l);l=b3(l,1,g),c=b3(c,1,g),!r&&l[0]===0&&(l.push(s),c.push(c[0])),o.push(new lC(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const r={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],g=c.name.match(s);if(g&&g.length>1){const u=g[1];let d=r[u];d||(r[u]=d=[]),d.push(c)}}const o=[];for(const a in r)o.push(this.CreateFromMorphTargetSequence(a,r[a],t,i));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(u,d,h,f,I){if(h.length!==0){const A=[],p=[];oV(h,A,p,f),A.length!==0&&I.push(new u(d,A,p))}},r=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let u=0;u<c.length;u++){const d=c[u].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const h={};let f;for(f=0;f<d.length;f++)if(d[f].morphTargets)for(let I=0;I<d[f].morphTargets.length;I++)h[d[f].morphTargets[I]]=-1;for(const I in h){const A=[],p=[];for(let y=0;y!==d[f].morphTargets.length;++y){const v=d[f];A.push(v.time),p.push(v.morphTarget===I?1:0)}r.push(new lC(".morphTargetInfluence["+I+"]",A,p))}l=h.length*o}else{const h=".bones["+t[u].name+"]";i(cC,h+".position",d,"pos",r),i(md,h+".quaternion",d,"rot",r),i(cC,h+".scale",d,"scl",r)}}return r.length===0?null:new this(s,l,r,a)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,r=e.length;i!==r;++i){const s=this.tracks[i];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Cge(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return lC;case"vector":case"vector2":case"vector3":case"vector4":return cC;case"color":return lV;case"quaternion":return md;case"bool":case"boolean":return Rf;case"string":return Zf}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function pge(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=Cge(n.type);if(n.times===void 0){const t=[],i=[];oV(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const Af={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};let cV=class{constructor(e,t,i){const r=this;let s=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(g){a++,s===!1&&r.onStart!==void 0&&r.onStart(g,o,a),s=!0},this.itemEnd=function(g){o++,r.onProgress!==void 0&&r.onProgress(g,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(g){r.onError!==void 0&&r.onError(g)},this.resolveURL=function(g){return l?l(g):g},this.setURLModifier=function(g){return l=g,this},this.addHandler=function(g,u){return c.push(g,u),this},this.removeHandler=function(g){const u=c.indexOf(g);return u!==-1&&c.splice(u,2),this},this.getHandler=function(g){for(let u=0,d=c.length;u<d;u+=2){const h=c[u],f=c[u+1];if(h.global&&(h.lastIndex=0),h.test(g))return f}return null}}};const AA=new cV;let Qs=class{constructor(e){this.manager=e!==void 0?e:AA,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,s){i.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}};const $c={};let mge=class extends Error{constructor(e,t){super(e),this.response=t}},na=class extends Qs{constructor(e){super(e)}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Af.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if($c[e]!==void 0){$c[e].push({onLoad:t,onProgress:i,onError:r});return}$c[e]=[],$c[e].push({onLoad:t,onProgress:i,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const g=$c[e],u=c.body.getReader(),d=c.headers.get("Content-Length")||c.headers.get("X-File-Size"),h=d?parseInt(d):0,f=h!==0;let I=0;const A=new ReadableStream({start(p){y();function y(){u.read().then(({done:v,value:b})=>{if(v)p.close();else{I+=b.byteLength;const w=new ProgressEvent("progress",{lengthComputable:f,loaded:I,total:h});for(let G=0,x=g.length;G<x;G++){const B=g[G];B.onProgress&&B.onProgress(w)}p.enqueue(b),y()}})}}});return new Response(A)}else throw new mge(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(g=>new DOMParser().parseFromString(g,a));case"json":return c.json();default:if(a===void 0)return c.text();{const u=/charset="?([^;"\s]*)"?/i.exec(a),d=u&&u[1]?u[1].toLowerCase():void 0,h=new TextDecoder(d);return c.arrayBuffer().then(f=>h.decode(f))}}}).then(c=>{Af.add(e,c);const g=$c[e];delete $c[e];for(let u=0,d=g.length;u<d;u++){const h=g[u];h.onLoad&&h.onLoad(c)}}).catch(c=>{const g=$c[e];if(g===void 0)throw this.manager.itemError(e),c;delete $c[e];for(let u=0,d=g.length;u<d;u++){const h=g[u];h.onError&&h.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}};class yge extends Qs{constructor(e){super(e)}load(e,t,i,r){const s=this,o=new na(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},i,r)}parse(e){const t=[];for(let i=0;i<e.length;i++){const r=gC.parse(e[i]);t.push(r)}return t}}class vge extends Qs{constructor(e){super(e)}load(e,t,i,r){const s=this,o=[],a=new U_,l=new na(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let c=0;function g(u){l.load(e[u],function(d){const h=s.parse(d,!0);o[u]={width:h.width,height:h.height,format:h.format,mipmaps:h.mipmaps},c+=1,c===6&&(h.mipmapCount===1&&(a.minFilter=ut),a.image=o,a.format=h.format,a.needsUpdate=!0,t&&t(a))},i,r)}if(Array.isArray(e))for(let u=0,d=e.length;u<d;++u)g(u);else l.load(e,function(u){const d=s.parse(u,!0);if(d.isCubemap){const h=d.mipmaps.length/d.mipmapCount;for(let f=0;f<h;f++){o[f]={mipmaps:[]};for(let I=0;I<d.mipmapCount;I++)o[f].mipmaps.push(d.mipmaps[f*d.mipmapCount+I]),o[f].format=d.format,o[f].width=d.width,o[f].height=d.height}a.image=o}else a.image.width=d.width,a.image.height=d.height,a.mipmaps=d.mipmaps;d.mipmapCount===1&&(a.minFilter=ut),a.format=d.format,a.needsUpdate=!0,t&&t(a)},i,r);return a}}let wy=class extends Qs{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Af.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=yy("img");function l(){g(),Af.add(e,this),t&&t(this),s.manager.itemEnd(e)}function c(u){g(),r&&r(u),s.manager.itemError(e),s.manager.itemEnd(e)}function g(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}};class G4 extends Qs{constructor(e){super(e)}load(e,t,i,r){const s=new rv,o=new wy(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function l(c){o.load(e[c],function(g){s.images[c]=g,a++,a===6&&(s.needsUpdate=!0,t&&t(s))},void 0,r)}for(let c=0;c<e.length;++c)l(c);return s}}class w4 extends Qs{constructor(e){super(e)}load(e,t,i,r){const s=this,o=new pc,a=new na(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(s.withCredentials),a.load(e,function(l){const c=s.parse(l);c&&(c.image!==void 0?o.image=c.image:c.data!==void 0&&(o.image.width=c.width,o.image.height=c.height,o.image.data=c.data),o.wrapS=c.wrapS!==void 0?c.wrapS:Ki,o.wrapT=c.wrapT!==void 0?c.wrapT:Ki,o.magFilter=c.magFilter!==void 0?c.magFilter:ut,o.minFilter=c.minFilter!==void 0?c.minFilter:ut,o.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.encoding!==void 0&&(o.encoding=c.encoding),c.flipY!==void 0&&(o.flipY=c.flipY),c.format!==void 0&&(o.format=c.format),c.type!==void 0&&(o.type=c.type),c.mipmaps!==void 0&&(o.mipmaps=c.mipmaps,o.minFilter=wc),c.mipmapCount===1&&(o.minFilter=ut),c.generateMipmaps!==void 0&&(o.generateMipmaps=c.generateMipmaps),o.needsUpdate=!0,t&&t(o,c))},i,r),o}}let gV=class extends Qs{constructor(e){super(e)}load(e,t,i,r){const s=new Pn,o=new wy(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,t!==void 0&&t(s)},i,r),s}},Rd=class extends In{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Ke(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}};class x4 extends Rd{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(In.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Ke(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const TR=new qe,hL=new D,fL=new D;class uV{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new pe(512,512),this.map=null,this.mapPass=null,this.matrix=new qe,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ww,this._frameExtents=new pe(1,1),this._viewportCount=1,this._viewports=[new Lt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;hL.setFromMatrixPosition(e.matrixWorld),t.position.copy(hL),fL.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(fL),t.updateMatrixWorld(),TR.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(TR),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(TR)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class bge extends uV{constructor(){super(new zn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=my*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(i!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=i,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class dV extends Rd{constructor(e,t,i=0,r=Math.PI/3,s=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(In.DEFAULT_UP),this.updateMatrix(),this.target=new In,this.distance=i,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new bge}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const IL=new qe,im=new D,NR=new D;class Bge extends uV{constructor(){super(new zn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new pe(4,2),this._viewportCount=6,this._viewports=[new Lt(2,1,1,1),new Lt(0,1,1,1),new Lt(3,1,1,1),new Lt(1,1,1,1),new Lt(3,0,1,1),new Lt(1,0,1,1)],this._cubeDirections=[new D(1,0,0),new D(-1,0,0),new D(0,0,1),new D(0,0,-1),new D(0,1,0),new D(0,-1,0)],this._cubeUps=[new D(0,1,0),new D(0,1,0),new D(0,1,0),new D(0,1,0),new D(0,0,1),new D(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,r=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),im.setFromMatrixPosition(e.matrixWorld),i.position.copy(im),NR.copy(i.position),NR.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(NR),i.updateMatrixWorld(),r.makeTranslation(-im.x,-im.y,-im.z),IL.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(IL)}}class hV extends Rd{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new Bge}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Gge extends uV{constructor(){super(new _c(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class fV extends Rd{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(In.DEFAULT_UP),this.updateMatrix(),this.target=new In,this.shadow=new Gge}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}let S4=class extends Rd{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}};class R4 extends Rd{constructor(e,t,i=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class Z4{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new D)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*s),t.addScaledVector(o[3],.488603*i),t.addScaledVector(o[4],1.092548*(i*r)),t.addScaledVector(o[5],1.092548*(r*s)),t.addScaledVector(o[6],.315392*(3*s*s-1)),t.addScaledVector(o[7],1.092548*(i*s)),t.addScaledVector(o[8],.546274*(i*i-r*r)),t}getIrradianceAt(e,t){const i=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*r),t.addScaledVector(o[2],2*.511664*s),t.addScaledVector(o[3],2*.511664*i),t.addScaledVector(o[4],2*.429043*i*r),t.addScaledVector(o[5],2*.429043*r*s),t.addScaledVector(o[6],.743125*s*s-.247708),t.addScaledVector(o[7],2*.429043*i*s),t.addScaledVector(o[8],.429043*(i*i-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const i=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*i*s,t[8]=.546274*(i*i-r*r)}}class Xw extends Rd{constructor(e=new Z4,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Yw extends Qs{constructor(e){super(e),this.textures={}}load(e,t,i,r){const s=this,o=new na(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},i,r)}parse(e){const t=this.textures;function i(s){return t[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),t[s]}const r=Yw.createMaterialFromType(e.type);if(e.uuid!==void 0&&(r.uuid=e.uuid),e.name!==void 0&&(r.name=e.name),e.color!==void 0&&r.color!==void 0&&r.color.setHex(e.color),e.roughness!==void 0&&(r.roughness=e.roughness),e.metalness!==void 0&&(r.metalness=e.metalness),e.sheen!==void 0&&(r.sheen=e.sheen),e.sheenColor!==void 0&&(r.sheenColor=new Ke().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(r.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&r.emissive!==void 0&&r.emissive.setHex(e.emissive),e.specular!==void 0&&r.specular!==void 0&&r.specular.setHex(e.specular),e.specularIntensity!==void 0&&(r.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&r.specularColor!==void 0&&r.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(r.shininess=e.shininess),e.clearcoat!==void 0&&(r.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(r.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(r.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(r.transmission=e.transmission),e.thickness!==void 0&&(r.thickness=e.thickness),e.attenuationDistance!==void 0&&(r.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&r.attenuationColor!==void 0&&r.attenuationColor.setHex(e.attenuationColor),e.fog!==void 0&&(r.fog=e.fog),e.flatShading!==void 0&&(r.flatShading=e.flatShading),e.blending!==void 0&&(r.blending=e.blending),e.combine!==void 0&&(r.combine=e.combine),e.side!==void 0&&(r.side=e.side),e.shadowSide!==void 0&&(r.shadowSide=e.shadowSide),e.opacity!==void 0&&(r.opacity=e.opacity),e.transparent!==void 0&&(r.transparent=e.transparent),e.alphaTest!==void 0&&(r.alphaTest=e.alphaTest),e.depthTest!==void 0&&(r.depthTest=e.depthTest),e.depthWrite!==void 0&&(r.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(r.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(r.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(r.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(r.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(r.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(r.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(r.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(r.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(r.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(r.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(r.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(r.rotation=e.rotation),e.linewidth!==1&&(r.linewidth=e.linewidth),e.dashSize!==void 0&&(r.dashSize=e.dashSize),e.gapSize!==void 0&&(r.gapSize=e.gapSize),e.scale!==void 0&&(r.scale=e.scale),e.polygonOffset!==void 0&&(r.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(r.dithering=e.dithering),e.alphaToCoverage!==void 0&&(r.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(r.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(r.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(r.visible=e.visible),e.toneMapped!==void 0&&(r.toneMapped=e.toneMapped),e.userData!==void 0&&(r.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const o=e.uniforms[s];switch(r.uniforms[s]={},o.type){case"t":r.uniforms[s].value=i(o.value);break;case"c":r.uniforms[s].value=new Ke().setHex(o.value);break;case"v2":r.uniforms[s].value=new pe().fromArray(o.value);break;case"v3":r.uniforms[s].value=new D().fromArray(o.value);break;case"v4":r.uniforms[s].value=new Lt().fromArray(o.value);break;case"m3":r.uniforms[s].value=new Ir().fromArray(o.value);break;case"m4":r.uniforms[s].value=new qe().fromArray(o.value);break;default:r.uniforms[s].value=o.value}}if(e.defines!==void 0&&(r.defines=e.defines),e.vertexShader!==void 0&&(r.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(r.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(r.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)r.extensions[s]=e.extensions[s];if(e.size!==void 0&&(r.size=e.size),e.sizeAttenuation!==void 0&&(r.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(r.map=i(e.map)),e.matcap!==void 0&&(r.matcap=i(e.matcap)),e.alphaMap!==void 0&&(r.alphaMap=i(e.alphaMap)),e.bumpMap!==void 0&&(r.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(r.bumpScale=e.bumpScale),e.normalMap!==void 0&&(r.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(r.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),r.normalScale=new pe().fromArray(s)}return e.displacementMap!==void 0&&(r.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(r.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(r.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(r.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(r.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(r.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(r.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(r.specularMap=i(e.specularMap)),e.specularIntensityMap!==void 0&&(r.specularIntensityMap=i(e.specularIntensityMap)),e.specularColorMap!==void 0&&(r.specularColorMap=i(e.specularColorMap)),e.envMap!==void 0&&(r.envMap=i(e.envMap)),e.envMapIntensity!==void 0&&(r.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(r.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(r.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(r.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(r.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(r.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(r.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(r.gradientMap=i(e.gradientMap)),e.clearcoatMap!==void 0&&(r.clearcoatMap=i(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(r.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(r.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(r.clearcoatNormalScale=new pe().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(r.iridescenceMap=i(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(r.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(r.transmissionMap=i(e.transmissionMap)),e.thicknessMap!==void 0&&(r.thicknessMap=i(e.thicknessMap)),e.sheenColorMap!==void 0&&(r.sheenColorMap=i(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(r.sheenRoughnessMap=i(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const t={ShadowMaterial:A4,SpriteMaterial:Y_,RawShaderMaterial:C4,ShaderMaterial:Nt,PointsMaterial:kw,MeshPhysicalMaterial:Vc,MeshStandardMaterial:Sf,MeshPhongMaterial:tV,MeshToonMaterial:nV,MeshNormalMaterial:iV,MeshLambertMaterial:rV,MeshDepthMaterial:ov,MeshDistanceMaterial:_w,MeshBasicMaterial:os,MeshMatcapMaterial:p4,LineDashedMaterial:m4,LineBasicMaterial:Cs,Material:ai};return new t[e]}}class yc{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class IV extends Et{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class M4 extends Qs{constructor(e){super(e)}load(e,t,i,r){const s=this,o=new na(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},i,r)}parse(e){const t={},i={};function r(h,f){if(t[f]!==void 0)return t[f];const A=h.interleavedBuffers[f],p=s(h,A.buffer),y=hA(A.type,p),v=new lv(y,A.stride);return v.uuid=A.uuid,t[f]=v,v}function s(h,f){if(i[f]!==void 0)return i[f];const A=h.arrayBuffers[f],p=new Uint32Array(A).buffer;return i[f]=p,p}const o=e.isInstancedBufferGeometry?new IV:new Et,a=e.data.index;if(a!==void 0){const h=hA(a.type,a.array);o.setIndex(new Pt(h,1))}const l=e.data.attributes;for(const h in l){const f=l[h];let I;if(f.isInterleavedBufferAttribute){const A=r(e.data,f.data);I=new pd(A,f.itemSize,f.offset,f.normalized)}else{const A=hA(f.type,f.array),p=f.isInstancedBufferAttribute?ff:Pt;I=new p(A,f.itemSize,f.normalized)}f.name!==void 0&&(I.name=f.name),f.usage!==void 0&&I.setUsage(f.usage),f.updateRange!==void 0&&(I.updateRange.offset=f.updateRange.offset,I.updateRange.count=f.updateRange.count),o.setAttribute(h,I)}const c=e.data.morphAttributes;if(c)for(const h in c){const f=c[h],I=[];for(let A=0,p=f.length;A<p;A++){const y=f[A];let v;if(y.isInterleavedBufferAttribute){const b=r(e.data,y.data);v=new pd(b,y.itemSize,y.offset,y.normalized)}else{const b=hA(y.type,y.array);v=new Pt(b,y.itemSize,y.normalized)}y.name!==void 0&&(v.name=y.name),I.push(v)}o.morphAttributes[h]=I}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const u=e.data.groups||e.data.drawcalls||e.data.offsets;if(u!==void 0)for(let h=0,f=u.length;h!==f;++h){const I=u[h];o.addGroup(I.start,I.count,I.materialIndex)}const d=e.data.boundingSphere;if(d!==void 0){const h=new D;d.center!==void 0&&h.fromArray(d.center),o.boundingSphere=new Zl(h,d.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class wge extends Qs{constructor(e){super(e)}load(e,t,i,r){const s=this,o=this.path===""?yc.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new na(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(u){r!==void 0&&r(u),console.error("THREE:ObjectLoader: Can't parse "+e+".",u.message);return}const g=c.metadata;if(g===void 0||g.type===void 0||g.type.toLowerCase()==="geometry"){r!==void 0&&r(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}s.parse(c,t)},i,r)}async loadAsync(e,t){const i=this,r=this.path===""?yc.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const s=new na(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const o=await s.loadAsync(e,t),a=JSON.parse(o),l=a.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await i.parseAsync(a)}parse(e,t){const i=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,function(){t!==void 0&&t(c)}),a=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,s,l,a,i),g=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,g),t!==void 0){let u=!1;for(const d in o)if(o[d].data instanceof HTMLImageElement){u=!0;break}u===!1&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),s=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,s),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,r,a,o,t),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),l}parseShapes(e){const t={};if(e!==void 0)for(let i=0,r=e.length;i<r;i++){const s=new ad().fromJSON(e[i]);t[s.uuid]=s}return t}parseSkeletons(e,t){const i={},r={};if(t.traverse(function(s){s.isBone&&(r[s.uuid]=s)}),e!==void 0)for(let s=0,o=e.length;s<o;s++){const a=new cv().fromJSON(e[s],r);i[a.uuid]=a}return i}parseGeometries(e,t){const i={};if(e!==void 0){const r=new M4;for(let s=0,o=e.length;s<o;s++){let a;const l=e[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(l);break;default:l.type in dL?a=dL[l.type].fromJSON(l,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}a.uuid=l.uuid,l.name!==void 0&&(a.name=l.name),l.userData!==void 0&&(a.userData=l.userData),i[l.uuid]=a}}return i}parseMaterials(e,t){const i={},r={};if(e!==void 0){const s=new Yw;s.setTextures(t);for(let o=0,a=e.length;o<a;o++){const l=e[o];i[l.uuid]===void 0&&(i[l.uuid]=s.parse(l)),r[l.uuid]=i[l.uuid]}}return r}parseAnimations(e){const t={};if(e!==void 0)for(let i=0;i<e.length;i++){const r=e[i],s=gC.parse(r);t[s.uuid]=s}return t}parseImages(e,t){const i=this,r={};let s;function o(l){return i.manager.itemStart(l),s.load(l,function(){i.manager.itemEnd(l)},void 0,function(){i.manager.itemError(l),i.manager.itemEnd(l)})}function a(l){if(typeof l=="string"){const c=l,g=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:i.resourcePath+c;return o(g)}else return l.data?{data:hA(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new cV(t);s=new wy(l),s.setCrossOrigin(this.crossOrigin);for(let c=0,g=e.length;c<g;c++){const u=e[c],d=u.url;if(Array.isArray(d)){const h=[];for(let f=0,I=d.length;f<I;f++){const A=d[f],p=a(A);p!==null&&(p instanceof HTMLImageElement?h.push(p):h.push(new pc(p.data,p.width,p.height)))}r[u.uuid]=new kh(h)}else{const h=a(u.url);r[u.uuid]=new kh(h)}}}return r}async parseImagesAsync(e){const t=this,i={};let r;async function s(o){if(typeof o=="string"){const a=o,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:t.resourcePath+a;return await r.loadAsync(l)}else return o.data?{data:hA(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){r=new wy(this.manager),r.setCrossOrigin(this.crossOrigin);for(let o=0,a=e.length;o<a;o++){const l=e[o],c=l.url;if(Array.isArray(c)){const g=[];for(let u=0,d=c.length;u<d;u++){const h=c[u],f=await s(h);f!==null&&(f instanceof HTMLImageElement?g.push(f):g.push(new pc(f.data,f.width,f.height)))}i[l.uuid]=new kh(g)}else{const g=await s(l.url);i[l.uuid]=new kh(g)}}}return i}parseTextures(e,t){function i(s,o){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),o[s])}const r={};if(e!==void 0)for(let s=0,o=e.length;s<o;s++){const a=e[s];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),t[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const l=t[a.image],c=l.data;let g;Array.isArray(c)?(g=new rv,c.length===6&&(g.needsUpdate=!0)):(c&&c.data?g=new pc:g=new Pn,c&&(g.needsUpdate=!0)),g.source=l,g.uuid=a.uuid,a.name!==void 0&&(g.name=a.name),a.mapping!==void 0&&(g.mapping=i(a.mapping,xge)),a.offset!==void 0&&g.offset.fromArray(a.offset),a.repeat!==void 0&&g.repeat.fromArray(a.repeat),a.center!==void 0&&g.center.fromArray(a.center),a.rotation!==void 0&&(g.rotation=a.rotation),a.wrap!==void 0&&(g.wrapS=i(a.wrap[0],AL),g.wrapT=i(a.wrap[1],AL)),a.format!==void 0&&(g.format=a.format),a.internalFormat!==void 0&&(g.internalFormat=a.internalFormat),a.type!==void 0&&(g.type=a.type),a.encoding!==void 0&&(g.encoding=a.encoding),a.minFilter!==void 0&&(g.minFilter=i(a.minFilter,CL)),a.magFilter!==void 0&&(g.magFilter=i(a.magFilter,CL)),a.anisotropy!==void 0&&(g.anisotropy=a.anisotropy),a.flipY!==void 0&&(g.flipY=a.flipY),a.generateMipmaps!==void 0&&(g.generateMipmaps=a.generateMipmaps),a.premultiplyAlpha!==void 0&&(g.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(g.unpackAlignment=a.unpackAlignment),a.userData!==void 0&&(g.userData=a.userData),r[a.uuid]=g}return r}parseObject(e,t,i,r,s){let o;function a(d){return t[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",d),t[d]}function l(d){if(d!==void 0){if(Array.isArray(d)){const h=[];for(let f=0,I=d.length;f<I;f++){const A=d[f];i[A]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",A),h.push(i[A])}return h}return i[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",d),i[d]}}function c(d){return r[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",d),r[d]}let g,u;switch(e.type){case"Scene":o=new Cd,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new Ke(e.background):o.background=c(e.background)),e.environment!==void 0&&(o.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new $O(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new Tw(e.fog.color,e.fog.density))),e.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(o.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":o=new zn(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new _c(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new S4(e.color,e.intensity);break;case"DirectionalLight":o=new fV(e.color,e.intensity);break;case"PointLight":o=new hV(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new R4(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new dV(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new x4(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=new Xw().fromJSON(e);break;case"SkinnedMesh":g=a(e.geometry),u=l(e.material),o=new K_(g,u),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":g=a(e.geometry),u=l(e.material),o=new Rn(g,u);break;case"InstancedMesh":g=a(e.geometry),u=l(e.material);const d=e.count,h=e.instanceMatrix,f=e.instanceColor;o=new NA(g,u,d),o.instanceMatrix=new ff(new Float32Array(h.array),16),f!==void 0&&(o.instanceColor=new ff(new Float32Array(f.array),f.itemSize));break;case"LOD":o=new i4;break;case"Line":o=new Xg(a(e.geometry),l(e.material));break;case"LineLoop":o=new D_(a(e.geometry),l(e.material));break;case"LineSegments":o=new Ml(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":o=new P_(a(e.geometry),l(e.material));break;case"Sprite":o=new n4(l(e.material));break;case"Group":o=new ho;break;case"Bone":o=new Nw;break;default:o=new In}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const d=e.children;for(let h=0;h<d.length;h++)o.add(this.parseObject(d[h],t,i,r,s))}if(e.animations!==void 0){const d=e.animations;for(let h=0;h<d.length;h++){const f=d[h];o.animations.push(s[f])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const d=e.levels;for(let h=0;h<d.length;h++){const f=d[h],I=o.getObjectByProperty("uuid",f.object);I!==void 0&&o.addLevel(I,f.distance,f.hysteresis)}}return o}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(i){if(i.isSkinnedMesh===!0&&i.skeleton!==void 0){const r=t[i.skeleton];r===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",i.skeleton):i.bind(r,i.bindMatrix)}})}}const xge={UVMapping:ww,CubeReflectionMapping:zg,CubeRefractionMapping:Id,EquirectangularReflectionMapping:iC,EquirectangularRefractionMapping:Iy,CubeUVReflectionMapping:EC},AL={RepeatWrapping:ds,ClampToEdgeWrapping:Ki,MirroredRepeatWrapping:rC},CL={NearestFilter:Zt,NearestMipmapNearestFilter:Ay,NearestMipmapLinearFilter:VA,LinearFilter:ut,LinearMipmapNearestFilter:xw,LinearMipmapLinearFilter:wc};class E4 extends Qs{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Af.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(l){Af.add(e,l),t&&t(l),s.manager.itemEnd(e)}).catch(function(l){r&&r(l),s.manager.itemError(e),s.manager.itemEnd(e)}),s.manager.itemStart(e)}}let MB,AV=class{static getContext(){return MB===void 0&&(MB=new(window.AudioContext||window.webkitAudioContext)),MB}static setContext(e){MB=e}};class Sge extends Qs{constructor(e){super(e)}load(e,t,i,r){const s=this,o=new na(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{const l=a.slice(0);AV.getContext().decodeAudioData(l,function(g){t(g)})}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},i,r)}}class Rge extends Xw{constructor(e,t,i=1){super(void 0,i),this.isHemisphereLightProbe=!0;const r=new Ke().set(e),s=new Ke().set(t),o=new D(r.r,r.g,r.b),a=new D(s.r,s.g,s.b),l=Math.sqrt(Math.PI),c=l*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(l),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(c)}}class Zge extends Xw{constructor(e,t=1){super(void 0,t),this.isAmbientLightProbe=!0;const i=new Ke().set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const pL=new qe,mL=new qe,qd=new qe;class Mge{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new zn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new zn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,qd.copy(e.projectionMatrix);const r=t.eyeSep/2,s=r*t.near/t.focus,o=t.near*Math.tan(Qh*t.fov*.5)/t.zoom;let a,l;mL.elements[12]=-r,pL.elements[12]=r,a=-o*t.aspect+s,l=o*t.aspect+s,qd.elements[0]=2*t.near/(l-a),qd.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(qd),a=-o*t.aspect-s,l=o*t.aspect-s,qd.elements[0]=2*t.near/(l-a),qd.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(qd)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(mL),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(pL)}}let Kw=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=yL(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=yL();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function yL(){return(typeof performance>"u"?Date:performance).now()}const $d=new D,vL=new xn,Ege=new D,eh=new D;let Wge=class extends In{constructor(){super(),this.type="AudioListener",this.context=AV.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Kw}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose($d,vL,Ege),eh.set(0,0,-1).applyQuaternion(vL),t.positionX){const r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime($d.x,r),t.positionY.linearRampToValueAtTime($d.y,r),t.positionZ.linearRampToValueAtTime($d.z,r),t.forwardX.linearRampToValueAtTime(eh.x,r),t.forwardY.linearRampToValueAtTime(eh.y,r),t.forwardZ.linearRampToValueAtTime(eh.z,r),t.upX.linearRampToValueAtTime(i.x,r),t.upY.linearRampToValueAtTime(i.y,r),t.upZ.linearRampToValueAtTime(i.z,r)}else t.setPosition($d.x,$d.y,$d.z),t.setOrientation(eh.x,eh.y,eh.z,i.x,i.y,i.z)}},W4=class extends In{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}};const th=new D,bL=new xn,Fge=new D,nh=new D;let _ge=class extends W4{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(th,bL,Fge),nh.set(0,0,1).applyQuaternion(bL);const t=this.panner;if(t.positionX){const i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(th.x,i),t.positionY.linearRampToValueAtTime(th.y,i),t.positionZ.linearRampToValueAtTime(th.z,i),t.orientationX.linearRampToValueAtTime(nh.x,i),t.orientationY.linearRampToValueAtTime(nh.y,i),t.orientationZ.linearRampToValueAtTime(nh.z,i)}else t.setPosition(th.x,th.y,th.z),t.setOrientation(nh.x,nh.y,nh.z)}};class Vge{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class F4{constructor(e,t,i){this.binding=e,this.valueSize=i;let r,s,o;switch(t){case"quaternion":r=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,r=this.valueSize,s=e*r+r;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==r;++a)i[s+a]=i[a];o=t}else{o+=t;const a=t/o;this._mixBufferRegion(i,s,0,a,r)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,r=e*t+t,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=t*this._origIndex;this._mixBufferRegion(i,r,l,1-s,t)}o>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(i[l]!==i[l+t]){a.setValue(i,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let s=i,o=r;s!==o;++s)t[s]=t[r+s%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,s){if(r>=.5)for(let o=0;o!==s;++o)e[t+o]=e[i+o]}_slerp(e,t,i,r){xn.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,s){const o=this._workIndex*s;xn.multiplyQuaternionsFlat(e,o,e,t,e,i),xn.slerpFlat(e,t,e,t,e,o,r)}_lerp(e,t,i,r,s){const o=1-r;for(let a=0;a!==s;++a){const l=t+a;e[l]=e[l]*o+e[i+a]*r}}_lerpAdditive(e,t,i,r,s){for(let o=0;o!==s;++o){const a=t+o;e[a]=e[a]+e[i+o]*r}}}const CV="\\[\\]\\.:\\/",Tge=new RegExp("["+CV+"]","g"),pV="[^"+CV+"]",Nge="[^"+CV.replace("\\.","")+"]",kge=/((?:WC+[\/:])*)/.source.replace("WC",pV),Lge=/(WCOD+)?/.source.replace("WCOD",Nge),Hge=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",pV),zge=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",pV),Xge=new RegExp("^"+kge+Lge+Hge+zge+"$"),Yge=["material","materials","bones","map"];class Kge{constructor(e,t,i){const r=i||an.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class an{constructor(e,t,i){this.path=t,this.parsedPath=i||an.parseTrackName(t),this.node=an.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new an.Composite(e,t,i):new an(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Tge,"")}static parseTrackName(e){const t=Xge.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const s=i.nodeName.substring(r+1);Yge.indexOf(s)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=s)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(s){for(let o=0;o<s.length;o++){const a=s[o];if(a.name===t||a.uuid===t)return a;const l=i(a.children);if(l)return l}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,r=t.propertyName;let s=t.propertyIndex;if(e||(e=an.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let c=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let g=0;g<e.length;g++)if(e[g].name===c){c=g;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[r];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}an.Composite=Kge;an.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};an.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};an.prototype.GetterByBindingType=[an.prototype._getValue_direct,an.prototype._getValue_array,an.prototype._getValue_arrayElement,an.prototype._getValue_toArray];an.prototype.SetterByBindingTypeAndVersioning=[[an.prototype._setValue_direct,an.prototype._setValue_direct_setNeedsUpdate,an.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[an.prototype._setValue_array,an.prototype._setValue_array_setNeedsUpdate,an.prototype._setValue_array_setMatrixWorldNeedsUpdate],[an.prototype._setValue_arrayElement,an.prototype._setValue_arrayElement_setNeedsUpdate,an.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[an.prototype._setValue_fromArray,an.prototype._setValue_fromArray_setNeedsUpdate,an.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Dge{constructor(){this.isAnimationObjectGroup=!0,this.uuid=jo(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,r=arguments.length;i!==r;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,r=this._parsedPaths,s=this._bindings,o=s.length;let a,l=e.length,c=this.nCachedObjects_;for(let g=0,u=arguments.length;g!==u;++g){const d=arguments[g],h=d.uuid;let f=t[h];if(f===void 0){f=l++,t[h]=f,e.push(d);for(let I=0,A=o;I!==A;++I)s[I].push(new an(d,i[I],r[I]))}else if(f<c){a=e[f];const I=--c,A=e[I];t[A.uuid]=f,e[f]=A,t[h]=I,e[I]=d;for(let p=0,y=o;p!==y;++p){const v=s[p],b=v[I];let w=v[f];v[f]=b,w===void 0&&(w=new an(d,i[p],r[p])),v[I]=w}}else e[f]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length;let s=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const l=arguments[o],c=l.uuid,g=t[c];if(g!==void 0&&g>=s){const u=s++,d=e[u];t[d.uuid]=g,e[g]=d,t[c]=u,e[u]=l;for(let h=0,f=r;h!==f;++h){const I=i[h],A=I[u],p=I[g];I[g]=A,I[u]=p}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length;let s=this.nCachedObjects_,o=e.length;for(let a=0,l=arguments.length;a!==l;++a){const c=arguments[a],g=c.uuid,u=t[g];if(u!==void 0)if(delete t[g],u<s){const d=--s,h=e[d],f=--o,I=e[f];t[h.uuid]=u,e[u]=h,t[I.uuid]=d,e[d]=I,e.pop();for(let A=0,p=r;A!==p;++A){const y=i[A],v=y[d],b=y[f];y[u]=v,y[d]=b,y.pop()}}else{const d=--o,h=e[d];d>0&&(t[h.uuid]=u),e[u]=h,e.pop();for(let f=0,I=r;f!==I;++f){const A=i[f];A[u]=A[d],A.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const i=this._bindingsIndicesByPath;let r=i[e];const s=this._bindings;if(r!==void 0)return s[r];const o=this._paths,a=this._parsedPaths,l=this._objects,c=l.length,g=this.nCachedObjects_,u=new Array(c);r=s.length,i[e]=r,o.push(e),a.push(t),s.push(u);for(let d=g,h=l.length;d!==h;++d){const f=l[d];u[d]=new an(f,e,t)}return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(i!==void 0){const r=this._paths,s=this._parsedPaths,o=this._bindings,a=o.length-1,l=o[a],c=e[a];t[c]=i,o[i]=l,o.pop(),s[i]=s[a],s.pop(),r[i]=r[a],r.pop()}}}class Pge{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;const s=t.tracks,o=s.length,a=new Array(o),l={endingStart:Th,endingEnd:Th};for(let c=0;c!==o;++c){const g=s[c].createInterpolant(null);a[c]=g,g.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=SO,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const r=this._clip.duration,s=e._clip.duration,o=s/r,a=r/s;e.warp(1,o,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const r=this._mixer,s=r.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=s,l[1]=s+i,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const l=(e-s)*i;l<0||i===0?t=0:(this._startTime=null,t=i*l)}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case F_:for(let g=0,u=l.length;g!==u;++g)l[g].evaluate(o),c[g].accumulateAdditive(a);break;case Zw:default:for(let g=0,u=l.length;g!==u;++g)l[g].evaluate(o),c[g].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let r=this.time+e,s=this._loopCount;const o=i===RO;if(e===0)return s===-1?r:o&&(s&1)===1?t-r:r;if(i===xO){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),r>=t||r<0){const a=Math.floor(r/t);r-=t*a,s+=Math.abs(a);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(o&&(s&1)===1)return t-r}return r}_setEndings(e,t,i){const r=this._interpolantSettings;i?(r.endingStart=Nh,r.endingEnd=Nh):(e?r.endingStart=this.zeroSlopeAtStart?Nh:Th:r.endingStart=Cy,t?r.endingEnd=this.zeroSlopeAtEnd?Nh:Th:r.endingEnd=Cy)}_scheduleFading(e,t,i){const r=this._mixer,s=r.time;let o=this._weightInterpolant;o===null&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=s,l[0]=t,a[1]=s+e,l[1]=i,this}}const Uge=new Float32Array(1);class Qge extends aa{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,r=e._clip.tracks,s=r.length,o=e._propertyBindings,a=e._interpolants,l=i.uuid,c=this._bindingsByRootAndName;let g=c[l];g===void 0&&(g={},c[l]=g);for(let u=0;u!==s;++u){const d=r[u],h=d.name;let f=g[h];if(f!==void 0)++f.referenceCount,o[u]=f;else{if(f=o[u],f!==void 0){f._cacheIndex===null&&(++f.referenceCount,this._addInactiveBinding(f,l,h));continue}const I=t&&t._propertyBindings[u].binding.parsedPath;f=new F4(an.create(i,h,I),d.ValueTypeName,d.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,l,h),o[u]=f}a[u].resultBuffer=f.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,r=e._clip.uuid,s=this._actionsByClip[r];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,r,i)}const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const s=t[i];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const s=t[i];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const r=this._actions,s=this._actionsByClip;let o=s[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,o=this._actionsByClip,a=o[s],l=a.knownActions,c=l[l.length-1],g=e._byClipCacheIndex;c._byClipCacheIndex=g,l[g]=c,l.pop(),e._byClipCacheIndex=null;const u=a.actionByRoot,d=(e._localRoot||this._root).uuid;delete u[d],l.length===0&&delete o[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const s=t[i];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_addInactiveBinding(e,t,i){const r=this._bindingsByRootAndName,s=this._bindings;let o=r[t];o===void 0&&(o={},r[t]=o),o[i]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,r=i.rootNode.uuid,s=i.path,o=this._bindingsByRootAndName,a=o[r],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete a[s],Object.keys(a).length===0&&delete o[r]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new aV(new Float32Array(2),new Float32Array(2),1,Uge),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,s=t[r];e.__cacheIndex=r,t[r]=e,s.__cacheIndex=i,t[i]=s}clipAction(e,t,i){const r=t||this._root,s=r.uuid;let o=typeof e=="string"?gC.findByName(r,e):e;const a=o!==null?o.uuid:e,l=this._actionsByClip[a];let c=null;if(i===void 0&&(o!==null?i=o.blendMode:i=Zw),l!==void 0){const u=l.actionByRoot[s];if(u!==void 0&&u.blendMode===i)return u;c=l.knownActions[0],o===null&&(o=c._clip)}if(o===null)return null;const g=new Pge(this,o,t,i);return this._bindAction(g,c),this._addInactiveAction(g,a,s),g}existingAction(e,t){const i=t||this._root,r=i.uuid,s=typeof e=="string"?gC.findByName(i,e):e,o=s?s.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,r=this.time+=e,s=Math.sign(e),o=this._accuIndex^=1;for(let c=0;c!==i;++c)t[c]._update(r,e,s,o);const a=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)a[c].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,r=this._actionsByClip,s=r[i];if(s!==void 0){const o=s.knownActions;for(let a=0,l=o.length;a!==l;++a){const c=o[a];this._deactivateAction(c);const g=c._cacheIndex,u=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,u._cacheIndex=g,t[g]=u,t.pop(),this._removeInactiveBindingsForAction(c)}delete r[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const o in i){const a=i[o].actionByRoot,l=a[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const r=this._bindingsByRootAndName,s=r[t];if(s!==void 0)for(const o in s){const a=s[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}let ye=class _4{constructor(e){this.value=e}clone(){return new _4(this.value.clone===void 0?this.value:this.value.clone())}},Oge=0;class Jge extends aa{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Oge++}),this.name="",this.usage=py,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let i=0,r=t.length;i<r;i++)this.uniforms.push(t[i].clone());return this}clone(){return new this.constructor().copy(this)}}class jge extends lv{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class qge{constructor(e,t,i,r,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=r,this.count=s,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}let mV=class{constructor(e,t,i=0,r=1/0){this.ray=new WC(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new Jh,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return B3(e,this,i,t),i.sort(BL),i}intersectObjects(e,t=!0,i=[]){for(let r=0,s=e.length;r<s;r++)B3(e[r],this,i,t);return i.sort(BL),i}};function BL(n,e){return n.distance-e.distance}function B3(n,e,t,i){if(n.layers.test(e.layers)&&n.raycast(e,t),i===!0){const r=n.children;for(let s=0,o=r.length;s<o;s++)B3(r[s],e,t,!0)}}class yV{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Wi(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class $ge{constructor(e=1,t=0,i=0){return this.radius=e,this.theta=t,this.y=i,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return new this.constructor().copy(this)}}const GL=new pe;class eue{constructor(e=new pe(1/0,1/0),t=new pe(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=GL.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,GL).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const wL=new D,EB=new D;class vc{constructor(e=new D,t=new D){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){wL.subVectors(e,this.start),EB.subVectors(this.end,this.start);const i=EB.dot(EB);let s=EB.dot(wL)/i;return t&&(s=Wi(s,0,1)),s}closestPointToPoint(e,t,i){const r=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const xL=new D;class tue extends In{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const i=new Et,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const c=o/l*Math.PI*2,g=a/l*Math.PI*2;r.push(Math.cos(c),Math.sin(c),1,Math.cos(g),Math.sin(g),1)}i.setAttribute("position",new ht(r,3));const s=new Cs({fog:!1,toneMapped:!1});this.cone=new Ml(i,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),xL.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(xL),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const bu=new D,WB=new qe,kR=new qe;class nue extends Ml{constructor(e){const t=V4(e),i=new Et,r=[],s=[],o=new Ke(0,0,1),a=new Ke(0,1,0);for(let c=0;c<t.length;c++){const g=t[c];g.parent&&g.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(o.r,o.g,o.b),s.push(a.r,a.g,a.b))}i.setAttribute("position",new ht(r,3)),i.setAttribute("color",new ht(s,3));const l=new Cs({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,r=i.getAttribute("position");kR.copy(this.root.matrixWorld).invert();for(let s=0,o=0;s<t.length;s++){const a=t[s];a.parent&&a.parent.isBone&&(WB.multiplyMatrices(kR,a.matrixWorld),bu.setFromMatrixPosition(WB),r.setXYZ(o,bu.x,bu.y,bu.z),WB.multiplyMatrices(kR,a.parent.matrixWorld),bu.setFromMatrixPosition(WB),r.setXYZ(o+1,bu.x,bu.y,bu.z),o+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function V4(n){const e=[];n.isBone===!0&&e.push(n);for(let t=0;t<n.children.length;t++)e.push.apply(e,V4(n.children[t]));return e}class iue extends Rn{constructor(e,t,i){const r=new xf(t,4,2),s=new os({wireframe:!0,fog:!1,toneMapped:!1});super(r,s),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const rue=new D,SL=new Ke,RL=new Ke;class sue extends In{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const r=new kC(t);r.rotateY(Math.PI*.5),this.material=new os({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=r.getAttribute("position"),o=new Float32Array(s.count*3);r.setAttribute("color",new Pt(o,3)),this.add(new Rn(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");SL.copy(this.light.color),RL.copy(this.light.groundColor);for(let i=0,r=t.count;i<r;i++){const s=i<r/2?SL:RL;t.setXYZ(i,s.r,s.g,s.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(rue.setFromMatrixPosition(this.light.matrixWorld).negate())}}class oue extends Ml{constructor(e=10,t=10,i=4473924,r=8947848){i=new Ke(i),r=new Ke(r);const s=t/2,o=e/t,a=e/2,l=[],c=[];for(let d=0,h=0,f=-a;d<=t;d++,f+=o){l.push(-a,0,f,a,0,f),l.push(f,0,-a,f,0,a);const I=d===s?i:r;I.toArray(c,h),h+=3,I.toArray(c,h),h+=3,I.toArray(c,h),h+=3,I.toArray(c,h),h+=3}const g=new Et;g.setAttribute("position",new ht(l,3)),g.setAttribute("color",new ht(c,3));const u=new Cs({vertexColors:!0,toneMapped:!1});super(g,u),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class aue extends Ml{constructor(e=10,t=16,i=8,r=64,s=4473924,o=8947848){s=new Ke(s),o=new Ke(o);const a=[],l=[];if(t>1)for(let u=0;u<t;u++){const d=u/t*(Math.PI*2),h=Math.sin(d)*e,f=Math.cos(d)*e;a.push(0,0,0),a.push(h,0,f);const I=u&1?s:o;l.push(I.r,I.g,I.b),l.push(I.r,I.g,I.b)}for(let u=0;u<i;u++){const d=u&1?s:o,h=e-e/i*u;for(let f=0;f<r;f++){let I=f/r*(Math.PI*2),A=Math.sin(I)*h,p=Math.cos(I)*h;a.push(A,0,p),l.push(d.r,d.g,d.b),I=(f+1)/r*(Math.PI*2),A=Math.sin(I)*h,p=Math.cos(I)*h,a.push(A,0,p),l.push(d.r,d.g,d.b)}}const c=new Et;c.setAttribute("position",new ht(a,3)),c.setAttribute("color",new ht(l,3));const g=new Cs({vertexColors:!0,toneMapped:!1});super(c,g),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const ZL=new D,FB=new D,ML=new D;class lue extends In{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new Et;r.setAttribute("position",new ht([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new Cs({fog:!1,toneMapped:!1});this.lightPlane=new Xg(r,s),this.add(this.lightPlane),r=new Et,r.setAttribute("position",new ht([0,0,0,0,0,1],3)),this.targetLine=new Xg(r,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),ZL.setFromMatrixPosition(this.light.matrixWorld),FB.setFromMatrixPosition(this.light.target.matrixWorld),ML.subVectors(FB,ZL),this.lightPlane.lookAt(FB),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(FB),this.targetLine.scale.z=ML.length()}}const _B=new D,mi=new _C;class cue extends Ml{constructor(e){const t=new Et,i=new Cs({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(f,I){l(f),l(I)}function l(f){r.push(0,0,0),s.push(0,0,0),o[f]===void 0&&(o[f]=[]),o[f].push(r.length/3-1)}t.setAttribute("position",new ht(r,3)),t.setAttribute("color",new ht(s,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const c=new Ke(16755200),g=new Ke(16711680),u=new Ke(43775),d=new Ke(16777215),h=new Ke(3355443);this.setColors(c,g,u,d,h)}setColors(e,t,i,r,s){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,i.r,i.g,i.b),a.setXYZ(33,i.r,i.g,i.b),a.setXYZ(34,i.r,i.g,i.b),a.setXYZ(35,i.r,i.g,i.b),a.setXYZ(36,i.r,i.g,i.b),a.setXYZ(37,i.r,i.g,i.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,s.r,s.g,s.b),a.setXYZ(41,s.r,s.g,s.b),a.setXYZ(42,s.r,s.g,s.b),a.setXYZ(43,s.r,s.g,s.b),a.setXYZ(44,s.r,s.g,s.b),a.setXYZ(45,s.r,s.g,s.b),a.setXYZ(46,s.r,s.g,s.b),a.setXYZ(47,s.r,s.g,s.b),a.setXYZ(48,s.r,s.g,s.b),a.setXYZ(49,s.r,s.g,s.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,i=1,r=1;mi.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ri("c",t,e,mi,0,0,-1),Ri("t",t,e,mi,0,0,1),Ri("n1",t,e,mi,-i,-r,-1),Ri("n2",t,e,mi,i,-r,-1),Ri("n3",t,e,mi,-i,r,-1),Ri("n4",t,e,mi,i,r,-1),Ri("f1",t,e,mi,-i,-r,1),Ri("f2",t,e,mi,i,-r,1),Ri("f3",t,e,mi,-i,r,1),Ri("f4",t,e,mi,i,r,1),Ri("u1",t,e,mi,i*.7,r*1.1,-1),Ri("u2",t,e,mi,-i*.7,r*1.1,-1),Ri("u3",t,e,mi,0,r*2,-1),Ri("cf1",t,e,mi,-i,0,1),Ri("cf2",t,e,mi,i,0,1),Ri("cf3",t,e,mi,0,-r,1),Ri("cf4",t,e,mi,0,r,1),Ri("cn1",t,e,mi,-i,0,-1),Ri("cn2",t,e,mi,i,0,-1),Ri("cn3",t,e,mi,0,-r,-1),Ri("cn4",t,e,mi,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Ri(n,e,t,i,r,s,o){_B.set(r,s,o).unproject(i);const a=e[n];if(a!==void 0){const l=t.getAttribute("position");for(let c=0,g=a.length;c<g;c++)l.setXYZ(a[c],_B.x,_B.y,_B.z)}}const VB=new Us;class gue extends Ml{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(8*3),s=new Et;s.setIndex(new Pt(i,1)),s.setAttribute("position",new Pt(r,3)),super(s,new Cs({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&VB.setFromObject(this.object),VB.isEmpty())return;const t=VB.min,i=VB.max,r=this.geometry.attributes.position,s=r.array;s[0]=i.x,s[1]=i.y,s[2]=i.z,s[3]=t.x,s[4]=i.y,s[5]=i.z,s[6]=t.x,s[7]=t.y,s[8]=i.z,s[9]=i.x,s[10]=t.y,s[11]=i.z,s[12]=i.x,s[13]=i.y,s[14]=t.z,s[15]=t.x,s[16]=i.y,s[17]=t.z,s[18]=t.x,s[19]=t.y,s[20]=t.z,s[21]=i.x,s[22]=t.y,s[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class uue extends Ml{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new Et;s.setIndex(new Pt(i,1)),s.setAttribute("position",new ht(r,3)),super(s,new Cs({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class due extends Xg{constructor(e,t=1,i=16776960){const r=i,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new Et;o.setAttribute("position",new ht(s,3)),o.computeBoundingSphere(),super(o,new Cs({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new Et;l.setAttribute("position",new ht(a,3)),l.computeBoundingSphere(),this.add(new Rn(l,new os({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const EL=new D;let TB,LR;class hue extends In{constructor(e=new D(0,0,1),t=new D(0,0,0),i=1,r=16776960,s=i*.2,o=s*.2){super(),this.type="ArrowHelper",TB===void 0&&(TB=new Et,TB.setAttribute("position",new ht([0,0,0,0,1,0],3)),LR=new dv(0,.5,1,5,1),LR.translate(0,-.5,0)),this.position.copy(t),this.line=new Xg(TB,new Cs({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Rn(LR,new os({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,s,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{EL.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(EL,t)}}setLength(e,t=e*.2,i=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class fue extends Ml{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Et;r.setAttribute("position",new ht(t,3)),r.setAttribute("color",new ht(i,3));const s=new Cs({vertexColors:!0,toneMapped:!1});super(r,s),this.type="AxesHelper"}setColors(e,t,i){const r=new Ke,s=this.geometry.attributes.color.array;return r.set(e),r.toArray(s,0),r.toArray(s,3),r.set(t),r.toArray(s,6),r.toArray(s,9),r.set(i),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Iue{constructor(){this.type="ShapePath",this.color=new Ke,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new vy,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){return this.currentPath.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,s,o){return this.currentPath.bezierCurveTo(e,t,i,r,s,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(p){const y=[];for(let v=0,b=p.length;v<b;v++){const w=p[v],G=new ad;G.curves=w.curves,y.push(G)}return y}function i(p,y){const v=y.length;let b=!1;for(let w=v-1,G=0;G<v;w=G++){let x=y[w],B=y[G],R=B.x-x.x,Z=B.y-x.y;if(Math.abs(Z)>Number.EPSILON){if(Z<0&&(x=y[G],R=-R,B=y[w],Z=-Z),p.y<x.y||p.y>B.y)continue;if(p.y===x.y){if(p.x===x.x)return!0}else{const W=Z*(p.x-x.x)-R*(p.y-x.y);if(W===0)return!0;if(W<0)continue;b=!b}}else{if(p.y!==x.y)continue;if(B.x<=p.x&&p.x<=x.x||x.x<=p.x&&p.x<=B.x)return!0}}return b}const r=mc.isClockWise,s=this.subPaths;if(s.length===0)return[];let o,a,l;const c=[];if(s.length===1)return a=s[0],l=new ad,l.curves=a.curves,c.push(l),c;let g=!r(s[0].getPoints());g=e?!g:g;const u=[],d=[];let h=[],f=0,I;d[f]=void 0,h[f]=[];for(let p=0,y=s.length;p<y;p++)a=s[p],I=a.getPoints(),o=r(I),o=e?!o:o,o?(!g&&d[f]&&f++,d[f]={s:new ad,p:I},d[f].s.curves=a.curves,g&&f++,h[f]=[]):h[f].push({h:a,p:I[0]});if(!d[0])return t(s);if(d.length>1){let p=!1,y=0;for(let v=0,b=d.length;v<b;v++)u[v]=[];for(let v=0,b=d.length;v<b;v++){const w=h[v];for(let G=0;G<w.length;G++){const x=w[G];let B=!0;for(let R=0;R<d.length;R++)i(x.p,d[R].p)&&(v!==R&&y++,B?(B=!1,u[R].push(x)):p=!0);B&&u[v].push(x)}}y>0&&p===!1&&(h=u)}let A;for(let p=0,y=d.length;p<y;p++){l=d[p].s,c.push(l),A=h[p];for(let v=0,b=A.length;v<b;v++)l.holes.push(A[v].h)}return c}}const bg=Aue();function Aue(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),i=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(i[l]=0,i[l|256]=32768,r[l]=24,r[l|256]=24):c<-14?(i[l]=1024>>-c-14,i[l|256]=1024>>-c-14|32768,r[l]=-c-1,r[l|256]=-c-1):c<=15?(i[l]=c+15<<10,i[l|256]=c+15<<10|32768,r[l]=13,r[l|256]=13):c<128?(i[l]=31744,i[l|256]=64512,r[l]=24,r[l|256]=24):(i[l]=31744,i[l|256]=64512,r[l]=13,r[l|256]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,g=0;for(;!(c&8388608);)c<<=1,g-=8388608;c&=-8388609,g+=947912704,s[l]=c|g}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:a}}function Cue(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=Wi(n,-65504,65504),bg.floatView[0]=n;const e=bg.uint32View[0],t=e>>23&511;return bg.baseTable[t]+((e&8388607)>>bg.shiftTable[t])}function pue(n){const e=n>>10;return bg.uint32View[0]=bg.mantissaTable[bg.offsetTable[e]+(n&1023)]+bg.exponentTable[e],bg.floatView[0]}const t0={toHalfFloat:Cue,fromHalfFloat:pue};class mue extends FC{constructor(e,t,i,r,s,o){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(e,t,i,r,s,o)}}class yue extends gv{constructor(e,t,i,r){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(e,t,i,r)}}class vue extends uv{constructor(e,t,i,r){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(e,t,i,r)}}class bue extends hv{constructor(e,t,i,r,s,o,a){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(e,t,i,r,s,o,a)}}class Bue extends dv{constructor(e,t,i,r,s,o,a,l){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(e,t,i,r,s,o,a,l)}}class Gue extends fv{constructor(e,t){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(e,t)}}class wue extends Iv{constructor(e,t){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(e,t)}}class xue extends NC{constructor(e,t){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(e,t)}}class Sue extends TC{constructor(e,t,i,r){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(e,t,i,r)}}class Rue extends kC{constructor(e,t){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(e,t)}}class Zue extends Fc{constructor(e,t,i,r){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(e,t,i,r)}}class Mue extends qg{constructor(e,t,i,r){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(e,t,i,r)}}class Eue extends Av{constructor(e,t,i,r,s,o){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(e,t,i,r,s,o)}}class Wue extends Cv{constructor(e,t){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(e,t)}}class Fue extends xf{constructor(e,t,i,r,s,o,a){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(e,t,i,r,s,o,a)}}class _ue extends pv{constructor(e,t){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(e,t)}}class Vue extends mv{constructor(e,t,i,r,s){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(e,t,i,r,s)}}class Tue extends yv{constructor(e,t,i,r,s,o){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(e,t,i,r,s,o)}}class Nue extends vv{constructor(e,t,i,r,s){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(e,t,i,r,s)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:wf}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=wf);const T4=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:M_,AddEquation:wh,AddOperation:cO,AdditiveAnimationBlendMode:F_,AdditiveBlending:g2,AlphaFormat:mO,AlwaysDepth:S_,AlwaysStencilFunc:WO,AmbientLight:S4,AmbientLightProbe:Zge,AnimationClip:gC,AnimationLoader:yge,AnimationMixer:Qge,AnimationObjectGroup:Dge,AnimationUtils:Age,ArcCurve:o4,ArrayCamera:jO,ArrowHelper:hue,Audio:W4,AudioAnalyser:Vge,AudioContext:AV,AudioListener:Wge,AudioLoader:Sge,AxesHelper:fue,BackSide:Bi,BasicDepthPacking:pr,BasicShadowMap:OQ,Bone:Nw,BooleanKeyframeTrack:Rf,Box2:eue,Box3:Us,Box3Helper:uue,BoxBufferGeometry:mue,BoxGeometry:FC,BoxHelper:gue,BufferAttribute:Pt,BufferGeometry:Et,BufferGeometryLoader:M4,ByteType:fO,Cache:Af,Camera:_C,CameraHelper:cue,CanvasTexture:s4,CapsuleBufferGeometry:yue,CapsuleGeometry:gv,CatmullRomCurve3:O_,CineonToneMapping:dO,CircleBufferGeometry:vue,CircleGeometry:uv,ClampToEdgeWrapping:Ki,Clock:Kw,Color:Ke,ColorKeyframeTrack:lV,ColorManagement:es,CompressedArrayTexture:Hce,CompressedTexture:U_,CompressedTextureLoader:vge,ConeBufferGeometry:bue,ConeGeometry:hv,CubeCamera:z_,CubeReflectionMapping:zg,CubeRefractionMapping:Id,CubeTexture:rv,CubeTextureLoader:G4,CubeUVReflectionMapping:EC,CubicBezierCurve:J_,CubicBezierCurve3:a4,CubicInterpolant:v4,CullFaceBack:zE,CullFaceFront:QQ,CullFaceFrontBack:Kie,CullFaceNone:UQ,Curve:El,CurvePath:c4,CustomBlending:JQ,CustomToneMapping:hO,CylinderBufferGeometry:Bue,CylinderGeometry:dv,Cylindrical:$ge,Data3DTexture:Oh,DataArrayTexture:Mw,DataTexture:pc,DataTextureLoader:w4,DataUtils:t0,DecrementStencilOp:ere,DecrementWrapStencilOp:nre,DefaultLoadingManager:AA,DepthFormat:od,DepthStencilFormat:Ad,DepthTexture:av,DirectionalLight:fV,DirectionalLightHelper:lue,DiscreteInterpolant:b4,DisplayP3ColorSpace:V_,DodecahedronBufferGeometry:Gue,DodecahedronGeometry:fv,DoubleSide:Di,DstAlphaFactor:iO,DstColorFactor:sO,DynamicCopyUsage:Are,DynamicDrawUsage:d2,DynamicReadUsage:hre,EdgesGeometry:u4,EllipseCurve:Lw,EqualDepth:fy,EqualStencilFunc:ore,EquirectangularReflectionMapping:iC,EquirectangularRefractionMapping:Iy,Euler:Hi,EventDispatcher:aa,ExtrudeBufferGeometry:wue,ExtrudeGeometry:Iv,FileLoader:na,Float16BufferAttribute:tse,Float32BufferAttribute:ht,Float64BufferAttribute:nse,FloatType:Hn,Fog:$O,FogExp2:Tw,FramebufferTexture:m3,FrontSide:wo,Frustum:Ww,GLBufferAttribute:qge,GLSL1:pre,GLSL3:h2,GreaterDepth:Z_,GreaterEqualDepth:R_,GreaterEqualStencilFunc:gre,GreaterStencilFunc:lre,GridHelper:oue,Group:ho,HalfFloatType:Pi,HemisphereLight:x4,HemisphereLightHelper:sue,HemisphereLightProbe:Rge,IcosahedronBufferGeometry:xue,IcosahedronGeometry:NC,ImageBitmapLoader:E4,ImageLoader:wy,ImageUtils:N_,IncrementStencilOp:$ie,IncrementWrapStencilOp:tre,InstancedBufferAttribute:ff,InstancedBufferGeometry:IV,InstancedInterleavedBuffer:jge,InstancedMesh:NA,Int16BufferAttribute:$re,Int32BufferAttribute:ese,Int8BufferAttribute:Jre,IntType:AO,InterleavedBuffer:lv,InterleavedBufferAttribute:pd,Interpolant:LC,InterpolateDiscrete:sC,InterpolateLinear:hf,InterpolateSmooth:g1,InvertStencilOp:ire,KeepStencilOp:u1,KeyframeTrack:Wl,LOD:i4,LatheBufferGeometry:Sue,LatheGeometry:TC,Layers:Jh,LessDepth:u2,LessEqualDepth:hy,LessEqualStencilFunc:are,LessStencilFunc:sre,Light:Rd,LightProbe:Xw,Line:Xg,Line3:vc,LineBasicMaterial:Cs,LineCurve:Hw,LineCurve3:l4,LineDashedMaterial:m4,LineLoop:D_,LineSegments:Ml,LinearEncoding:ta,LinearFilter:ut,LinearInterpolant:aV,LinearMipMapLinearFilter:Oie,LinearMipMapNearestFilter:Qie,LinearMipmapLinearFilter:wc,LinearMipmapNearestFilter:xw,LinearSRGBColorSpace:oC,LinearToneMapping:gO,Loader:Qs,LoaderUtils:yc,LoadingManager:cV,LoopOnce:xO,LoopPingPong:RO,LoopRepeat:SO,LuminanceAlphaFormat:yO,LuminanceFormat:Sw,MOUSE:Xie,Material:ai,MaterialLoader:Yw,MathUtils:ss,Matrix3:Ir,Matrix4:qe,MaxEquation:DE,Mesh:Rn,MeshBasicMaterial:os,MeshDepthMaterial:ov,MeshDistanceMaterial:_w,MeshLambertMaterial:rV,MeshMatcapMaterial:p4,MeshNormalMaterial:iV,MeshPhongMaterial:tV,MeshPhysicalMaterial:Vc,MeshStandardMaterial:Sf,MeshToonMaterial:nV,MinEquation:KE,MirroredRepeatWrapping:rC,MixOperation:lO,MultiplyBlending:YE,MultiplyOperation:iv,NearestFilter:Zt,NearestMipMapLinearFilter:Uie,NearestMipMapNearestFilter:Pie,NearestMipmapLinearFilter:VA,NearestMipmapNearestFilter:Ay,NeverDepth:x_,NeverStencilFunc:rre,NoBlending:ei,NoColorSpace:EO,NoToneMapping:Gl,NormalAnimationBlendMode:Zw,NormalBlending:Uh,NotEqualDepth:Gw,NotEqualStencilFunc:cre,NumberKeyframeTrack:lC,Object3D:In,ObjectLoader:wge,ObjectSpaceNormalMap:MO,OctahedronBufferGeometry:Rue,OctahedronGeometry:kC,OneFactor:eO,OneMinusDstAlphaFactor:rO,OneMinusDstColorFactor:oO,OneMinusSrcAlphaFactor:w_,OneMinusSrcColorFactor:nO,OrthographicCamera:_c,PCFShadowMap:Bw,PCFSoftShadowMap:G0,PMREMGenerator:I2,Path:vy,PerspectiveCamera:zn,Plane:ic,PlaneBufferGeometry:Zue,PlaneGeometry:Fc,PlaneHelper:due,PointLight:hV,PointLightHelper:iue,Points:P_,PointsMaterial:kw,PolarGridHelper:aue,PolyhedronBufferGeometry:Mue,PolyhedronGeometry:qg,PositionalAudio:_ge,PropertyBinding:an,PropertyMixer:F4,QuadraticBezierCurve:j_,QuadraticBezierCurve3:q_,Quaternion:xn,QuaternionKeyframeTrack:md,QuaternionLinearInterpolant:B4,RED_GREEN_RGTC2_Format:h3,RED_RGTC1_Format:wO,REVISION:wf,RGBADepthPacking:Sl,RGBAFormat:Yn,RGBAIntegerFormat:BO,RGBA_ASTC_10x10_Format:c3,RGBA_ASTC_10x5_Format:o3,RGBA_ASTC_10x6_Format:a3,RGBA_ASTC_10x8_Format:l3,RGBA_ASTC_12x10_Format:g3,RGBA_ASTC_12x12_Format:u3,RGBA_ASTC_4x4_Format:qE,RGBA_ASTC_5x4_Format:$E,RGBA_ASTC_5x5_Format:e3,RGBA_ASTC_6x5_Format:t3,RGBA_ASTC_6x6_Format:n3,RGBA_ASTC_8x5_Format:i3,RGBA_ASTC_8x6_Format:r3,RGBA_ASTC_8x8_Format:s3,RGBA_BPTC_Format:c1,RGBA_ETC2_EAC_Format:jE,RGBA_PVRTC_2BPPV1_Format:OE,RGBA_PVRTC_4BPPV1_Format:QE,RGBA_S3TC_DXT1_Format:o1,RGBA_S3TC_DXT3_Format:a1,RGBA_S3TC_DXT5_Format:l1,RGB_ETC1_Format:GO,RGB_ETC2_Format:JE,RGB_PVRTC_2BPPV1_Format:UE,RGB_PVRTC_4BPPV1_Format:PE,RGB_S3TC_DXT1_Format:s1,RGFormat:W_,RGIntegerFormat:bO,RawShaderMaterial:C4,Ray:WC,Raycaster:mV,RectAreaLight:R4,RedFormat:Rw,RedIntegerFormat:vO,ReinhardToneMapping:uO,RepeatWrapping:ds,ReplaceStencilOp:qie,ReverseSubtractEquation:qQ,RingBufferGeometry:Eue,RingGeometry:Av,SIGNED_RED_GREEN_RGTC2_Format:f3,SIGNED_RED_RGTC1_Format:d3,SRGBColorSpace:fl,Scene:Cd,ShaderChunk:bt,ShaderLib:Al,ShaderMaterial:Nt,ShadowMaterial:A4,Shape:ad,ShapeBufferGeometry:Wue,ShapeGeometry:Cv,ShapePath:Iue,ShapeUtils:mc,ShortType:IO,Skeleton:cv,SkeletonHelper:nue,SkinnedMesh:K_,Source:kh,Sphere:Zl,SphereBufferGeometry:Fue,SphereGeometry:xf,Spherical:yV,SphericalHarmonics3:Z4,SplineCurve:$_,SpotLight:dV,SpotLightHelper:tue,Sprite:n4,SpriteMaterial:Y_,SrcAlphaFactor:G_,SrcAlphaSaturateFactor:aO,SrcColorFactor:tO,StaticCopyUsage:Ire,StaticDrawUsage:py,StaticReadUsage:dre,StereoCamera:Mge,StreamCopyUsage:Cre,StreamDrawUsage:ure,StreamReadUsage:fre,StringKeyframeTrack:Zf,SubtractEquation:jQ,SubtractiveBlending:XE,TOUCH:Yie,TangentSpaceNormalMap:Wc,TetrahedronBufferGeometry:_ue,TetrahedronGeometry:pv,Texture:Pn,TextureLoader:gV,TorusBufferGeometry:Vue,TorusGeometry:mv,TorusKnotBufferGeometry:Tue,TorusKnotGeometry:yv,Triangle:Fg,TriangleFanDrawMode:__,TriangleStripDrawMode:ZO,TrianglesDrawMode:Jie,TubeBufferGeometry:Nue,TubeGeometry:vv,TwoPassDoubleSide:Die,UVMapping:ww,Uint16BufferAttribute:L_,Uint32BufferAttribute:H_,Uint8BufferAttribute:jre,Uint8ClampedBufferAttribute:qre,Uniform:ye,UniformsGroup:Jge,UniformsLib:tt,UniformsUtils:Ew,UnsignedByteType:Dn,UnsignedInt248Type:sd,UnsignedIntType:Sg,UnsignedShort4444Type:CO,UnsignedShort5551Type:pO,UnsignedShortType:E_,VSMShadowMap:Vh,Vector2:pe,Vector3:D,Vector4:Lt,VectorKeyframeTrack:cC,VideoTexture:r4,WebGL1Renderer:qO,WebGL3DRenderTarget:zre,WebGLArrayRenderTarget:Hre,WebGLCubeRenderTarget:sv,WebGLMultipleRenderTargets:k_,WebGLRenderTarget:Qt,WebGLRenderer:Vw,WebGLUtils:JO,WireframeGeometry:I4,WrapAroundEnding:Cy,ZeroCurvatureEnding:Th,ZeroFactor:$Q,ZeroSlopeEnding:Nh,ZeroStencilOp:jie,_SRGBAFormat:f2,sRGBEncoding:Xt},Symbol.toStringTag,{value:"Module"}));var N4={exports:{}},Mf={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */Mf.ConcurrentRoot=1;Mf.ContinuousEventPriority=4;Mf.DefaultEventPriority=16;Mf.DiscreteEventPriority=1;Mf.IdleEventPriority=536870912;Mf.LegacyRoot=0;N4.exports=Mf;var CA=N4.exports;function kue(n){let e;const t=new Set,i=(c,g)=>{const u=typeof c=="function"?c(e):c;if(u!==e){const d=e;e=g?u:Object.assign({},e,u),t.forEach(h=>h(e,d))}},r=()=>e,s=(c,g=r,u=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let d=g(e);function h(){const f=g(e);if(!u(d,f)){const I=d;c(d=f,I)}}return t.add(h),()=>t.delete(h)},l={setState:i,getState:r,subscribe:(c,g,u)=>g||u?s(c,g,u):(t.add(c),()=>t.delete(c)),destroy:()=>t.clear()};return e=n(i,r,l),l}const Lue=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),WL=Lue?M.useEffect:M.useLayoutEffect;function HC(n){const e=typeof n=="function"?kue(n):n,t=(i=e.getState,r=Object.is)=>{const[,s]=M.useReducer(A=>A+1,0),o=e.getState(),a=M.useRef(o),l=M.useRef(i),c=M.useRef(r),g=M.useRef(!1),u=M.useRef();u.current===void 0&&(u.current=i(o));let d,h=!1;(a.current!==o||l.current!==i||c.current!==r||g.current)&&(d=i(o),h=!r(u.current,d)),WL(()=>{h&&(u.current=d),a.current=o,l.current=i,c.current=r,g.current=!1});const f=M.useRef(o);WL(()=>{const A=()=>{try{const y=e.getState(),v=l.current(y);c.current(u.current,v)||(a.current=y,u.current=v,s())}catch{g.current=!0,s()}},p=e.subscribe(A);return e.getState()!==f.current&&A(),p},[]);const I=h?d:u.current;return M.useDebugValue(I),I};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const i=[t,e];return{next(){const r=i.length<=0;return{value:i.shift(),done:r}}}},t}var k4={exports:{}},L4={exports:{}},H4={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(H,Y){var K=H.length;H.push(Y);e:for(;0<K;){var Q=K-1>>>1,P=H[Q];if(0<r(P,Y))H[Q]=Y,H[K]=P,K=Q;else break e}}function t(H){return H.length===0?null:H[0]}function i(H){if(H.length===0)return null;var Y=H[0],K=H.pop();if(K!==Y){H[0]=K;e:for(var Q=0,P=H.length,ne=P>>>1;Q<ne;){var oe=2*(Q+1)-1,$=H[oe],de=oe+1,ge=H[de];if(0>r($,K))de<P&&0>r(ge,$)?(H[Q]=ge,H[de]=K,Q=de):(H[Q]=$,H[oe]=K,Q=oe);else if(de<P&&0>r(ge,K))H[Q]=ge,H[de]=K,Q=de;else break e}}return Y}function r(H,Y){var K=H.sortIndex-Y.sortIndex;return K!==0?K:H.id-Y.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],c=[],g=1,u=null,d=3,h=!1,f=!1,I=!1,A=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(H){for(var Y=t(c);Y!==null;){if(Y.callback===null)i(c);else if(Y.startTime<=H)i(c),Y.sortIndex=Y.expirationTime,e(l,Y);else break;Y=t(c)}}function b(H){if(I=!1,v(H),!f)if(t(l)!==null)f=!0,U(w);else{var Y=t(c);Y!==null&&J(b,Y.startTime-H)}}function w(H,Y){f=!1,I&&(I=!1,p(B),B=-1),h=!0;var K=d;try{for(v(Y),u=t(l);u!==null&&(!(u.expirationTime>Y)||H&&!W());){var Q=u.callback;if(typeof Q=="function"){u.callback=null,d=u.priorityLevel;var P=Q(u.expirationTime<=Y);Y=n.unstable_now(),typeof P=="function"?u.callback=P:u===t(l)&&i(l),v(Y)}else i(l);u=t(l)}if(u!==null)var ne=!0;else{var oe=t(c);oe!==null&&J(b,oe.startTime-Y),ne=!1}return ne}finally{u=null,d=K,h=!1}}var G=!1,x=null,B=-1,R=5,Z=-1;function W(){return!(n.unstable_now()-Z<R)}function F(){if(x!==null){var H=n.unstable_now();Z=H;var Y=!0;try{Y=x(!0,H)}finally{Y?T():(G=!1,x=null)}}else G=!1}var T;if(typeof y=="function")T=function(){y(F)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,z=V.port2;V.port1.onmessage=F,T=function(){z.postMessage(null)}}else T=function(){A(F,0)};function U(H){x=H,G||(G=!0,T())}function J(H,Y){B=A(function(){H(n.unstable_now())},Y)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(H){H.callback=null},n.unstable_continueExecution=function(){f||h||(f=!0,U(w))},n.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<H?Math.floor(1e3/H):5},n.unstable_getCurrentPriorityLevel=function(){return d},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(H){switch(d){case 1:case 2:case 3:var Y=3;break;default:Y=d}var K=d;d=Y;try{return H()}finally{d=K}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(H,Y){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var K=d;d=H;try{return Y()}finally{d=K}},n.unstable_scheduleCallback=function(H,Y,K){var Q=n.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?Q+K:Q):K=Q,H){case 1:var P=-1;break;case 2:P=250;break;case 5:P=1073741823;break;case 4:P=1e4;break;default:P=5e3}return P=K+P,H={id:g++,callback:Y,priorityLevel:H,startTime:K,expirationTime:P,sortIndex:-1},K>Q?(H.sortIndex=K,e(c,H),t(l)===null&&H===t(c)&&(I?(p(B),B=-1):I=!0,J(b,K-Q))):(H.sortIndex=P,e(l,H),f||h||(f=!0,U(w))),H},n.unstable_shouldYield=W,n.unstable_wrapCallback=function(H){var Y=d;return function(){var K=d;d=Y;try{return H.apply(this,arguments)}finally{d=K}}}})(H4);L4.exports=H4;var G3=L4.exports;/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hue=function(e){var t={},i=M,r=G3,s=Object.assign;function o(C){for(var m="https://reactjs.org/docs/error-decoder.html?invariant="+C,S=1;S<arguments.length;S++)m+="&args[]="+encodeURIComponent(arguments[S]);return"Minified React error #"+C+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),c=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),u=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),h=Symbol.for("react.provider"),f=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),p=Symbol.for("react.suspense_list"),y=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),b=Symbol.for("react.offscreen"),w=Symbol.iterator;function G(C){return C===null||typeof C!="object"?null:(C=w&&C[w]||C["@@iterator"],typeof C=="function"?C:null)}function x(C){if(C==null)return null;if(typeof C=="function")return C.displayName||C.name||null;if(typeof C=="string")return C;switch(C){case g:return"Fragment";case c:return"Portal";case d:return"Profiler";case u:return"StrictMode";case A:return"Suspense";case p:return"SuspenseList"}if(typeof C=="object")switch(C.$$typeof){case f:return(C.displayName||"Context")+".Consumer";case h:return(C._context.displayName||"Context")+".Provider";case I:var m=C.render;return C=C.displayName,C||(C=m.displayName||m.name||"",C=C!==""?"ForwardRef("+C+")":"ForwardRef"),C;case y:return m=C.displayName||null,m!==null?m:x(C.type)||"Memo";case v:m=C._payload,C=C._init;try{return x(C(m))}catch{}}return null}function B(C){var m=C.type;switch(C.tag){case 24:return"Cache";case 9:return(m.displayName||"Context")+".Consumer";case 10:return(m._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return C=m.render,C=C.displayName||C.name||"",m.displayName||(C!==""?"ForwardRef("+C+")":"ForwardRef");case 7:return"Fragment";case 5:return m;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return x(m);case 8:return m===u?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m}return null}function R(C){var m=C,S=C;if(C.alternate)for(;m.return;)m=m.return;else{C=m;do m=C,m.flags&4098&&(S=m.return),C=m.return;while(C)}return m.tag===3?S:null}function Z(C){if(R(C)!==C)throw Error(o(188))}function W(C){var m=C.alternate;if(!m){if(m=R(C),m===null)throw Error(o(188));return m!==C?null:C}for(var S=C,E=m;;){var _=S.return;if(_===null)break;var N=_.alternate;if(N===null){if(E=_.return,E!==null){S=E;continue}break}if(_.child===N.child){for(N=_.child;N;){if(N===S)return Z(_),C;if(N===E)return Z(_),m;N=N.sibling}throw Error(o(188))}if(S.return!==E.return)S=_,E=N;else{for(var ae=!1,Ie=_.child;Ie;){if(Ie===S){ae=!0,S=_,E=N;break}if(Ie===E){ae=!0,E=_,S=N;break}Ie=Ie.sibling}if(!ae){for(Ie=N.child;Ie;){if(Ie===S){ae=!0,S=N,E=_;break}if(Ie===E){ae=!0,E=N,S=_;break}Ie=Ie.sibling}if(!ae)throw Error(o(189))}}if(S.alternate!==E)throw Error(o(190))}if(S.tag!==3)throw Error(o(188));return S.stateNode.current===S?C:m}function F(C){return C=W(C),C!==null?T(C):null}function T(C){if(C.tag===5||C.tag===6)return C;for(C=C.child;C!==null;){var m=T(C);if(m!==null)return m;C=C.sibling}return null}function V(C){if(C.tag===5||C.tag===6)return C;for(C=C.child;C!==null;){if(C.tag!==4){var m=V(C);if(m!==null)return m}C=C.sibling}return null}var z=Array.isArray,U=e.getPublicInstance,J=e.getRootHostContext,H=e.getChildHostContext,Y=e.prepareForCommit,K=e.resetAfterCommit,Q=e.createInstance,P=e.appendInitialChild,ne=e.finalizeInitialChildren,oe=e.prepareUpdate,$=e.shouldSetTextContent,de=e.createTextInstance,ge=e.scheduleTimeout,se=e.cancelTimeout,k=e.noTimeout,O=e.isPrimaryRenderer,q=e.supportsMutation,ee=e.supportsPersistence,le=e.supportsHydration,he=e.getInstanceFromNode,be=e.preparePortalMount,xe=e.getCurrentEventPriority,ze=e.detachDeletedInstance,Se=e.supportsMicrotasks,ke=e.scheduleMicrotask,He=e.supportsTestSelectors,Be=e.findFiberRoot,j=e.getBoundingRect,X=e.getTextContent,ce=e.isHiddenSubtree,fe=e.matchAccessibilityRole,Ge=e.setFocusIfFocusable,me=e.setupIntersectionObserver,Fe=e.appendChild,Le=e.appendChildToContainer,Re=e.commitTextUpdate,Xe=e.commitMount,we=e.commitUpdate,Ue=e.insertBefore,Pe=e.insertInContainerBefore,Ye=e.removeChild,$e=e.removeChildFromContainer,mt=e.resetTextContent,Wt=e.hideInstance,ue=e.hideTextInstance,Me=e.unhideInstance,De=e.unhideTextInstance,et=e.clearContainer,st=e.cloneInstance,Ot=e.createContainerChildSet,on=e.appendChildToContainerChildSet,An=e.finalizeContainerChildren,$t=e.replaceContainerChildren,bn=e.cloneHiddenInstance,Jt=e.cloneHiddenTextInstance,nn=e.canHydrateInstance,ms=e.canHydrateTextInstance,br=e.canHydrateSuspenseInstance,un=e.isSuspenseInstancePending,te=e.isSuspenseInstanceFallback,ve=e.registerSuspenseInstanceRetry,Ee=e.getNextHydratableSibling,Ce=e.getFirstHydratableChild,Te=e.getFirstHydratableChildWithinContainer,dt=e.getFirstHydratableChildWithinSuspenseInstance,yt=e.hydrateInstance,St=e.hydrateTextInstance,kt=e.hydrateSuspenseInstance,jt=e.getNextHydratableInstanceAfterSuspenseInstance,Tt=e.commitHydratedContainer,Ht=e.commitHydratedSuspenseInstance,ti=e.clearSuspenseBoundary,sr=e.clearSuspenseBoundaryFromContainer,kr=e.shouldDeleteUnhydratedTailInstances,Mo=e.didNotMatchHydratedContainerTextInstance,kn=e.didNotMatchHydratedTextInstance,Qe;function ys(C){if(Qe===void 0)try{throw Error()}catch(S){var m=S.stack.trim().match(/\n( *(at )?)/);Qe=m&&m[1]||""}return`
`+Qe+C}var ni=!1;function Lr(C,m){if(!C||ni)return"";ni=!0;var S=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(m)if(m=function(){throw Error()},Object.defineProperty(m.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(m,[])}catch(je){var E=je}Reflect.construct(C,[],m)}else{try{m.call()}catch(je){E=je}C.call(m.prototype)}else{try{throw Error()}catch(je){E=je}C()}}catch(je){if(je&&E&&typeof je.stack=="string"){for(var _=je.stack.split(`
`),N=E.stack.split(`
`),ae=_.length-1,Ie=N.length-1;1<=ae&&0<=Ie&&_[ae]!==N[Ie];)Ie--;for(;1<=ae&&0<=Ie;ae--,Ie--)if(_[ae]!==N[Ie]){if(ae!==1||Ie!==1)do if(ae--,Ie--,0>Ie||_[ae]!==N[Ie]){var Ne=`
`+_[ae].replace(" at new "," at ");return C.displayName&&Ne.includes("<anonymous>")&&(Ne=Ne.replace("<anonymous>",C.displayName)),Ne}while(1<=ae&&0<=Ie);break}}}finally{ni=!1,Error.prepareStackTrace=S}return(C=C?C.displayName||C.name:"")?ys(C):""}var _d=Object.prototype.hasOwnProperty,Eo=[],vs=-1;function Sn(C){return{current:C}}function en(C){0>vs||(C.current=Eo[vs],Eo[vs]=null,vs--)}function rn(C,m){vs++,Eo[vs]=C.current,C.current=m}var Jn={},ii=Sn(Jn),Qi=Sn(!1),Hr=Jn;function Vl(C,m){var S=C.type.contextTypes;if(!S)return Jn;var E=C.stateNode;if(E&&E.__reactInternalMemoizedUnmaskedChildContext===m)return E.__reactInternalMemoizedMaskedChildContext;var _={},N;for(N in S)_[N]=m[N];return E&&(C=C.stateNode,C.__reactInternalMemoizedUnmaskedChildContext=m,C.__reactInternalMemoizedMaskedChildContext=_),_}function xi(C){return C=C.childContextTypes,C!=null}function su(){en(Qi),en(ii)}function Lf(C,m,S){if(ii.current!==Jn)throw Error(o(168));rn(ii,m),rn(Qi,S)}function Hf(C,m,S){var E=C.stateNode;if(m=m.childContextTypes,typeof E.getChildContext!="function")return S;E=E.getChildContext();for(var _ in E)if(!(_ in m))throw Error(o(108,B(C)||"Unknown",_));return s({},S,E)}function Tl(C){return C=(C=C.stateNode)&&C.__reactInternalMemoizedMergedChildContext||Jn,Hr=ii.current,rn(ii,C),rn(Qi,Qi.current),!0}function Dv(C,m,S){var E=C.stateNode;if(!E)throw Error(o(169));S?(C=Hf(C,m,Hr),E.__reactInternalMemoizedMergedChildContext=C,en(Qi),en(ii),rn(ii,C)):en(Qi),rn(Qi,S)}var zr=Math.clz32?Math.clz32:Pv,zf=Math.log,Vd=Math.LN2;function Pv(C){return C>>>=0,C===0?32:31-(zf(C)/Vd|0)|0}var kc=64,Lc=4194304;function Hc(C){switch(C&-C){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return C&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return C&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return C}}function Td(C,m){var S=C.pendingLanes;if(S===0)return 0;var E=0,_=C.suspendedLanes,N=C.pingedLanes,ae=S&268435455;if(ae!==0){var Ie=ae&~_;Ie!==0?E=Hc(Ie):(N&=ae,N!==0&&(E=Hc(N)))}else ae=S&~_,ae!==0?E=Hc(ae):N!==0&&(E=Hc(N));if(E===0)return 0;if(m!==0&&m!==E&&!(m&_)&&(_=E&-E,N=m&-m,_>=N||_===16&&(N&4194240)!==0))return m;if(E&4&&(E|=S&16),m=C.entangledLanes,m!==0)for(C=C.entanglements,m&=E;0<m;)S=31-zr(m),_=1<<S,E|=C[S],m&=~_;return E}function Uv(C,m){switch(C){case 1:case 2:case 4:return m+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function fp(C,m){for(var S=C.suspendedLanes,E=C.pingedLanes,_=C.expirationTimes,N=C.pendingLanes;0<N;){var ae=31-zr(N),Ie=1<<ae,Ne=_[ae];Ne===-1?(!(Ie&S)||Ie&E)&&(_[ae]=Uv(Ie,m)):Ne<=m&&(C.expiredLanes|=Ie),N&=~Ie}}function zc(C){return C=C.pendingLanes&-1073741825,C!==0?C:C&1073741824?1073741824:0}function Xf(C){for(var m=[],S=0;31>S;S++)m.push(C);return m}function Nl(C,m,S){C.pendingLanes|=m,m!==536870912&&(C.suspendedLanes=0,C.pingedLanes=0),C=C.eventTimes,m=31-zr(m),C[m]=S}function ou(C,m){var S=C.pendingLanes&~m;C.pendingLanes=m,C.suspendedLanes=0,C.pingedLanes=0,C.expiredLanes&=m,C.mutableReadLanes&=m,C.entangledLanes&=m,m=C.entanglements;var E=C.eventTimes;for(C=C.expirationTimes;0<S;){var _=31-zr(S),N=1<<_;m[_]=0,E[_]=-1,C[_]=-1,S&=~N}}function kl(C,m){var S=C.entangledLanes|=m;for(C=C.entanglements;S;){var E=31-zr(S),_=1<<E;_&m|C[E]&m&&(C[E]|=m),S&=~_}}var Ut=0;function Ip(C){return C&=-C,1<C?4<C?C&268435455?16:536870912:4:1}var Xc=r.unstable_scheduleCallback,Yf=r.unstable_cancelCallback,Ap=r.unstable_shouldYield,Qv=r.unstable_requestPaint,ri=r.unstable_now,au=r.unstable_ImmediatePriority,Ov=r.unstable_UserBlockingPriority,bs=r.unstable_NormalPriority,Cp=r.unstable_IdlePriority,lu=null,Wo=null;function pp(C){if(Wo&&typeof Wo.onCommitFiberRoot=="function")try{Wo.onCommitFiberRoot(lu,C,void 0,(C.current.flags&128)===128)}catch{}}function Kf(C,m){return C===m&&(C!==0||1/C===1/m)||C!==C&&m!==m}var Fo=typeof Object.is=="function"?Object.is:Kf,Bs=null,Ll=!1,ga=!1;function mp(C){Bs===null?Bs=[C]:Bs.push(C)}function yp(C){Ll=!0,mp(C)}function Os(){if(!ga&&Bs!==null){ga=!0;var C=0,m=Ut;try{var S=Bs;for(Ut=1;C<S.length;C++){var E=S[C];do E=E(!0);while(E!==null)}Bs=null,Ll=!1}catch(_){throw Bs!==null&&(Bs=Bs.slice(C+1)),Xc(au,Os),_}finally{Ut=m,ga=!1}}return null}var Nd=a.ReactCurrentBatchConfig;function kd(C,m){if(Fo(C,m))return!0;if(typeof C!="object"||C===null||typeof m!="object"||m===null)return!1;var S=Object.keys(C),E=Object.keys(m);if(S.length!==E.length)return!1;for(E=0;E<S.length;E++){var _=S[E];if(!_d.call(m,_)||!Fo(C[_],m[_]))return!1}return!0}function Ld(C){switch(C.tag){case 5:return ys(C.type);case 16:return ys("Lazy");case 13:return ys("Suspense");case 19:return ys("SuspenseList");case 0:case 2:case 15:return C=Lr(C.type,!1),C;case 11:return C=Lr(C.type.render,!1),C;case 1:return C=Lr(C.type,!0),C;default:return""}}function Xr(C,m){if(C&&C.defaultProps){m=s({},m),C=C.defaultProps;for(var S in C)m[S]===void 0&&(m[S]=C[S]);return m}return m}var or=Sn(null),Df=null,Ja=null,cu=null;function Pf(){cu=Ja=Df=null}function Jv(C,m,S){O?(rn(or,m._currentValue),m._currentValue=S):(rn(or,m._currentValue2),m._currentValue2=S)}function Hl(C){var m=or.current;en(or),O?C._currentValue=m:C._currentValue2=m}function Vi(C,m,S){for(;C!==null;){var E=C.alternate;if((C.childLanes&m)!==m?(C.childLanes|=m,E!==null&&(E.childLanes|=m)):E!==null&&(E.childLanes&m)!==m&&(E.childLanes|=m),C===S)break;C=C.return}}function ar(C,m){Df=C,cu=Ja=null,C=C.dependencies,C!==null&&C.firstContext!==null&&(C.lanes&m&&(To=!0),C.firstContext=null)}function Fn(C){var m=O?C._currentValue:C._currentValue2;if(cu!==C)if(C={context:C,memoizedValue:m,next:null},Ja===null){if(Df===null)throw Error(o(308));Ja=C,Df.dependencies={lanes:0,firstContext:C}}else Ja=Ja.next=C;return m}var Oi=null,ja=!1;function Xx(C){C.updateQueue={baseState:C.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Z5(C,m){C=C.updateQueue,m.updateQueue===C&&(m.updateQueue={baseState:C.baseState,firstBaseUpdate:C.firstBaseUpdate,lastBaseUpdate:C.lastBaseUpdate,shared:C.shared,effects:C.effects})}function Yc(C,m){return{eventTime:C,lane:m,tag:0,payload:null,callback:null,next:null}}function gu(C,m){var S=C.updateQueue;S!==null&&(S=S.shared,Ti!==null&&C.mode&1&&!(Kt&2)?(C=S.interleaved,C===null?(m.next=m,Oi===null?Oi=[S]:Oi.push(S)):(m.next=C.next,C.next=m),S.interleaved=m):(C=S.pending,C===null?m.next=m:(m.next=C.next,C.next=m),S.pending=m))}function jv(C,m,S){if(m=m.updateQueue,m!==null&&(m=m.shared,(S&4194240)!==0)){var E=m.lanes;E&=C.pendingLanes,S|=E,m.lanes=S,kl(C,S)}}function M5(C,m){var S=C.updateQueue,E=C.alternate;if(E!==null&&(E=E.updateQueue,S===E)){var _=null,N=null;if(S=S.firstBaseUpdate,S!==null){do{var ae={eventTime:S.eventTime,lane:S.lane,tag:S.tag,payload:S.payload,callback:S.callback,next:null};N===null?_=N=ae:N=N.next=ae,S=S.next}while(S!==null);N===null?_=N=m:N=N.next=m}else _=N=m;S={baseState:E.baseState,firstBaseUpdate:_,lastBaseUpdate:N,shared:E.shared,effects:E.effects},C.updateQueue=S;return}C=S.lastBaseUpdate,C===null?S.firstBaseUpdate=m:C.next=m,S.lastBaseUpdate=m}function qv(C,m,S,E){var _=C.updateQueue;ja=!1;var N=_.firstBaseUpdate,ae=_.lastBaseUpdate,Ie=_.shared.pending;if(Ie!==null){_.shared.pending=null;var Ne=Ie,je=Ne.next;Ne.next=null,ae===null?N=je:ae.next=je,ae=Ne;var lt=C.alternate;lt!==null&&(lt=lt.updateQueue,Ie=lt.lastBaseUpdate,Ie!==ae&&(Ie===null?lt.firstBaseUpdate=je:Ie.next=je,lt.lastBaseUpdate=Ne))}if(N!==null){var Ft=_.baseState;ae=0,lt=je=Ne=null,Ie=N;do{var Gt=Ie.lane,_n=Ie.eventTime;if((E&Gt)===Gt){lt!==null&&(lt=lt.next={eventTime:_n,lane:0,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null});e:{var vt=C,Pr=Ie;switch(Gt=m,_n=S,Pr.tag){case 1:if(vt=Pr.payload,typeof vt=="function"){Ft=vt.call(_n,Ft,Gt);break e}Ft=vt;break e;case 3:vt.flags=vt.flags&-65537|128;case 0:if(vt=Pr.payload,Gt=typeof vt=="function"?vt.call(_n,Ft,Gt):vt,Gt==null)break e;Ft=s({},Ft,Gt);break e;case 2:ja=!0}}Ie.callback!==null&&Ie.lane!==0&&(C.flags|=64,Gt=_.effects,Gt===null?_.effects=[Ie]:Gt.push(Ie))}else _n={eventTime:_n,lane:Gt,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null},lt===null?(je=lt=_n,Ne=Ft):lt=lt.next=_n,ae|=Gt;if(Ie=Ie.next,Ie===null){if(Ie=_.shared.pending,Ie===null)break;Gt=Ie,Ie=Gt.next,Gt.next=null,_.lastBaseUpdate=Gt,_.shared.pending=null}}while(1);if(lt===null&&(Ne=Ft),_.baseState=Ne,_.firstBaseUpdate=je,_.lastBaseUpdate=lt,m=_.shared.interleaved,m!==null){_=m;do ae|=_.lane,_=_.next;while(_!==m)}else N===null&&(_.shared.lanes=0);tI|=ae,C.lanes=ae,C.memoizedState=Ft}}function E5(C,m,S){if(C=m.effects,m.effects=null,C!==null)for(m=0;m<C.length;m++){var E=C[m],_=E.callback;if(_!==null){if(E.callback=null,E=S,typeof _!="function")throw Error(o(191,_));_.call(E)}}}var W5=new i.Component().refs;function Yx(C,m,S,E){m=C.memoizedState,S=S(E,m),S=S==null?m:s({},m,S),C.memoizedState=S,C.lanes===0&&(C.updateQueue.baseState=S)}var $v={isMounted:function(C){return(C=C._reactInternals)?R(C)===C:!1},enqueueSetState:function(C,m,S){C=C._reactInternals;var E=ws(),_=hu(C),N=Yc(E,_);N.payload=m,S!=null&&(N.callback=S),gu(C,N),m=Ia(C,_,E),m!==null&&jv(m,C,_)},enqueueReplaceState:function(C,m,S){C=C._reactInternals;var E=ws(),_=hu(C),N=Yc(E,_);N.tag=1,N.payload=m,S!=null&&(N.callback=S),gu(C,N),m=Ia(C,_,E),m!==null&&jv(m,C,_)},enqueueForceUpdate:function(C,m){C=C._reactInternals;var S=ws(),E=hu(C),_=Yc(S,E);_.tag=2,m!=null&&(_.callback=m),gu(C,_),m=Ia(C,E,S),m!==null&&jv(m,C,E)}};function F5(C,m,S,E,_,N,ae){return C=C.stateNode,typeof C.shouldComponentUpdate=="function"?C.shouldComponentUpdate(E,N,ae):m.prototype&&m.prototype.isPureReactComponent?!kd(S,E)||!kd(_,N):!0}function _5(C,m,S){var E=!1,_=Jn,N=m.contextType;return typeof N=="object"&&N!==null?N=Fn(N):(_=xi(m)?Hr:ii.current,E=m.contextTypes,N=(E=E!=null)?Vl(C,_):Jn),m=new m(S,N),C.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=$v,C.stateNode=m,m._reactInternals=C,E&&(C=C.stateNode,C.__reactInternalMemoizedUnmaskedChildContext=_,C.__reactInternalMemoizedMaskedChildContext=N),m}function V5(C,m,S,E){C=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(S,E),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(S,E),m.state!==C&&$v.enqueueReplaceState(m,m.state,null)}function Kx(C,m,S,E){var _=C.stateNode;_.props=S,_.state=C.memoizedState,_.refs=W5,Xx(C);var N=m.contextType;typeof N=="object"&&N!==null?_.context=Fn(N):(N=xi(m)?Hr:ii.current,_.context=Vl(C,N)),_.state=C.memoizedState,N=m.getDerivedStateFromProps,typeof N=="function"&&(Yx(C,m,N,S),_.state=C.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(m=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),m!==_.state&&$v.enqueueReplaceState(_,_.state,null),qv(C,S,_,E),_.state=C.memoizedState),typeof _.componentDidMount=="function"&&(C.flags|=4194308)}var Uf=[],Qf=0,eb=null,tb=0,ua=[],da=0,Hd=null,Kc=1,Dc="";function zd(C,m){Uf[Qf++]=tb,Uf[Qf++]=eb,eb=C,tb=m}function T5(C,m,S){ua[da++]=Kc,ua[da++]=Dc,ua[da++]=Hd,Hd=C;var E=Kc;C=Dc;var _=32-zr(E)-1;E&=~(1<<_),S+=1;var N=32-zr(m)+_;if(30<N){var ae=_-_%5;N=(E&(1<<ae)-1).toString(32),E>>=ae,_-=ae,Kc=1<<32-zr(m)+_|S<<_|E,Dc=N+C}else Kc=1<<N|S<<_|E,Dc=C}function Dx(C){C.return!==null&&(zd(C,1),T5(C,1,0))}function Px(C){for(;C===eb;)eb=Uf[--Qf],Uf[Qf]=null,tb=Uf[--Qf],Uf[Qf]=null;for(;C===Hd;)Hd=ua[--da],ua[da]=null,Dc=ua[--da],ua[da]=null,Kc=ua[--da],ua[da]=null}var _o=null,Vo=null,si=!1,vp=!1,qa=null;function N5(C,m){var S=Aa(5,null,null,0);S.elementType="DELETED",S.stateNode=m,S.return=C,m=C.deletions,m===null?(C.deletions=[S],C.flags|=16):m.push(S)}function k5(C,m){switch(C.tag){case 5:return m=nn(m,C.type,C.pendingProps),m!==null?(C.stateNode=m,_o=C,Vo=Ce(m),!0):!1;case 6:return m=ms(m,C.pendingProps),m!==null?(C.stateNode=m,_o=C,Vo=null,!0):!1;case 13:if(m=br(m),m!==null){var S=Hd!==null?{id:Kc,overflow:Dc}:null;return C.memoizedState={dehydrated:m,treeContext:S,retryLane:1073741824},S=Aa(18,null,null,0),S.stateNode=m,S.return=C,C.child=S,_o=C,Vo=null,!0}return!1;default:return!1}}function Ux(C){return(C.mode&1)!==0&&(C.flags&128)===0}function Qx(C){if(si){var m=Vo;if(m){var S=m;if(!k5(C,m)){if(Ux(C))throw Error(o(418));m=Ee(S);var E=_o;m&&k5(C,m)?N5(E,S):(C.flags=C.flags&-4097|2,si=!1,_o=C)}}else{if(Ux(C))throw Error(o(418));C.flags=C.flags&-4097|2,si=!1,_o=C}}}function L5(C){for(C=C.return;C!==null&&C.tag!==5&&C.tag!==3&&C.tag!==13;)C=C.return;_o=C}function bp(C){if(!le||C!==_o)return!1;if(!si)return L5(C),si=!0,!1;if(C.tag!==3&&(C.tag!==5||kr(C.type)&&!$(C.type,C.memoizedProps))){var m=Vo;if(m){if(Ux(C)){for(C=Vo;C;)C=Ee(C);throw Error(o(418))}for(;m;)N5(C,m),m=Ee(m)}}if(L5(C),C.tag===13){if(!le)throw Error(o(316));if(C=C.memoizedState,C=C!==null?C.dehydrated:null,!C)throw Error(o(317));Vo=jt(C)}else Vo=_o?Ee(C.stateNode):null;return!0}function Of(){le&&(Vo=_o=null,vp=si=!1)}function Ox(C){qa===null?qa=[C]:qa.push(C)}function Bp(C,m,S){if(C=S.ref,C!==null&&typeof C!="function"&&typeof C!="object"){if(S._owner){if(S=S._owner,S){if(S.tag!==1)throw Error(o(309));var E=S.stateNode}if(!E)throw Error(o(147,C));var _=E,N=""+C;return m!==null&&m.ref!==null&&typeof m.ref=="function"&&m.ref._stringRef===N?m.ref:(m=function(ae){var Ie=_.refs;Ie===W5&&(Ie=_.refs={}),ae===null?delete Ie[N]:Ie[N]=ae},m._stringRef=N,m)}if(typeof C!="string")throw Error(o(284));if(!S._owner)throw Error(o(290,C))}return C}function nb(C,m){throw C=Object.prototype.toString.call(m),Error(o(31,C==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":C))}function H5(C){var m=C._init;return m(C._payload)}function z5(C){function m(Ze,Ae){if(C){var _e=Ze.deletions;_e===null?(Ze.deletions=[Ae],Ze.flags|=16):_e.push(Ae)}}function S(Ze,Ae){if(!C)return null;for(;Ae!==null;)m(Ze,Ae),Ae=Ae.sibling;return null}function E(Ze,Ae){for(Ze=new Map;Ae!==null;)Ae.key!==null?Ze.set(Ae.key,Ae):Ze.set(Ae.index,Ae),Ae=Ae.sibling;return Ze}function _(Ze,Ae){return Ze=Iu(Ze,Ae),Ze.index=0,Ze.sibling=null,Ze}function N(Ze,Ae,_e){return Ze.index=_e,C?(_e=Ze.alternate,_e!==null?(_e=_e.index,_e<Ae?(Ze.flags|=2,Ae):_e):(Ze.flags|=2,Ae)):(Ze.flags|=1048576,Ae)}function ae(Ze){return C&&Ze.alternate===null&&(Ze.flags|=2),Ze}function Ie(Ze,Ae,_e,rt){return Ae===null||Ae.tag!==6?(Ae=WS(_e,Ze.mode,rt),Ae.return=Ze,Ae):(Ae=_(Ae,_e),Ae.return=Ze,Ae)}function Ne(Ze,Ae,_e,rt){var It=_e.type;return It===g?lt(Ze,Ae,_e.props.children,rt,_e.key):Ae!==null&&(Ae.elementType===It||typeof It=="object"&&It!==null&&It.$$typeof===v&&H5(It)===Ae.type)?(rt=_(Ae,_e.props),rt.ref=Bp(Ze,Ae,_e),rt.return=Ze,rt):(rt=Fb(_e.type,_e.key,_e.props,null,Ze.mode,rt),rt.ref=Bp(Ze,Ae,_e),rt.return=Ze,rt)}function je(Ze,Ae,_e,rt){return Ae===null||Ae.tag!==4||Ae.stateNode.containerInfo!==_e.containerInfo||Ae.stateNode.implementation!==_e.implementation?(Ae=FS(_e,Ze.mode,rt),Ae.return=Ze,Ae):(Ae=_(Ae,_e.children||[]),Ae.return=Ze,Ae)}function lt(Ze,Ae,_e,rt,It){return Ae===null||Ae.tag!==7?(Ae=Qd(_e,Ze.mode,rt,It),Ae.return=Ze,Ae):(Ae=_(Ae,_e),Ae.return=Ze,Ae)}function Ft(Ze,Ae,_e){if(typeof Ae=="string"&&Ae!==""||typeof Ae=="number")return Ae=WS(""+Ae,Ze.mode,_e),Ae.return=Ze,Ae;if(typeof Ae=="object"&&Ae!==null){switch(Ae.$$typeof){case l:return _e=Fb(Ae.type,Ae.key,Ae.props,null,Ze.mode,_e),_e.ref=Bp(Ze,null,Ae),_e.return=Ze,_e;case c:return Ae=FS(Ae,Ze.mode,_e),Ae.return=Ze,Ae;case v:var rt=Ae._init;return Ft(Ze,rt(Ae._payload),_e)}if(z(Ae)||G(Ae))return Ae=Qd(Ae,Ze.mode,_e,null),Ae.return=Ze,Ae;nb(Ze,Ae)}return null}function Gt(Ze,Ae,_e,rt){var It=Ae!==null?Ae.key:null;if(typeof _e=="string"&&_e!==""||typeof _e=="number")return It!==null?null:Ie(Ze,Ae,""+_e,rt);if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case l:return _e.key===It?Ne(Ze,Ae,_e,rt):null;case c:return _e.key===It?je(Ze,Ae,_e,rt):null;case v:return It=_e._init,Gt(Ze,Ae,It(_e._payload),rt)}if(z(_e)||G(_e))return It!==null?null:lt(Ze,Ae,_e,rt,null);nb(Ze,_e)}return null}function _n(Ze,Ae,_e,rt,It){if(typeof rt=="string"&&rt!==""||typeof rt=="number")return Ze=Ze.get(_e)||null,Ie(Ae,Ze,""+rt,It);if(typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case l:return Ze=Ze.get(rt.key===null?_e:rt.key)||null,Ne(Ae,Ze,rt,It);case c:return Ze=Ze.get(rt.key===null?_e:rt.key)||null,je(Ae,Ze,rt,It);case v:var zt=rt._init;return _n(Ze,Ae,_e,zt(rt._payload),It)}if(z(rt)||G(rt))return Ze=Ze.get(_e)||null,lt(Ae,Ze,rt,It,null);nb(Ae,rt)}return null}function vt(Ze,Ae,_e,rt){for(var It=null,zt=null,_t=Ae,dn=Ae=0,cr=null;_t!==null&&dn<_e.length;dn++){_t.index>dn?(cr=_t,_t=null):cr=_t.sibling;var hn=Gt(Ze,_t,_e[dn],rt);if(hn===null){_t===null&&(_t=cr);break}C&&_t&&hn.alternate===null&&m(Ze,_t),Ae=N(hn,Ae,dn),zt===null?It=hn:zt.sibling=hn,zt=hn,_t=cr}if(dn===_e.length)return S(Ze,_t),si&&zd(Ze,dn),It;if(_t===null){for(;dn<_e.length;dn++)_t=Ft(Ze,_e[dn],rt),_t!==null&&(Ae=N(_t,Ae,dn),zt===null?It=_t:zt.sibling=_t,zt=_t);return si&&zd(Ze,dn),It}for(_t=E(Ze,_t);dn<_e.length;dn++)cr=_n(_t,Ze,dn,_e[dn],rt),cr!==null&&(C&&cr.alternate!==null&&_t.delete(cr.key===null?dn:cr.key),Ae=N(cr,Ae,dn),zt===null?It=cr:zt.sibling=cr,zt=cr);return C&&_t.forEach(function(Au){return m(Ze,Au)}),si&&zd(Ze,dn),It}function Pr(Ze,Ae,_e,rt){var It=G(_e);if(typeof It!="function")throw Error(o(150));if(_e=It.call(_e),_e==null)throw Error(o(151));for(var zt=It=null,_t=Ae,dn=Ae=0,cr=null,hn=_e.next();_t!==null&&!hn.done;dn++,hn=_e.next()){_t.index>dn?(cr=_t,_t=null):cr=_t.sibling;var Au=Gt(Ze,_t,hn.value,rt);if(Au===null){_t===null&&(_t=cr);break}C&&_t&&Au.alternate===null&&m(Ze,_t),Ae=N(Au,Ae,dn),zt===null?It=Au:zt.sibling=Au,zt=Au,_t=cr}if(hn.done)return S(Ze,_t),si&&zd(Ze,dn),It;if(_t===null){for(;!hn.done;dn++,hn=_e.next())hn=Ft(Ze,hn.value,rt),hn!==null&&(Ae=N(hn,Ae,dn),zt===null?It=hn:zt.sibling=hn,zt=hn);return si&&zd(Ze,dn),It}for(_t=E(Ze,_t);!hn.done;dn++,hn=_e.next())hn=_n(_t,Ze,dn,hn.value,rt),hn!==null&&(C&&hn.alternate!==null&&_t.delete(hn.key===null?dn:hn.key),Ae=N(hn,Ae,dn),zt===null?It=hn:zt.sibling=hn,zt=hn);return C&&_t.forEach(function(Ate){return m(Ze,Ate)}),si&&zd(Ze,dn),It}function Ca(Ze,Ae,_e,rt){if(typeof _e=="object"&&_e!==null&&_e.type===g&&_e.key===null&&(_e=_e.props.children),typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case l:e:{for(var It=_e.key,zt=Ae;zt!==null;){if(zt.key===It){if(It=_e.type,It===g){if(zt.tag===7){S(Ze,zt.sibling),Ae=_(zt,_e.props.children),Ae.return=Ze,Ze=Ae;break e}}else if(zt.elementType===It||typeof It=="object"&&It!==null&&It.$$typeof===v&&H5(It)===zt.type){S(Ze,zt.sibling),Ae=_(zt,_e.props),Ae.ref=Bp(Ze,zt,_e),Ae.return=Ze,Ze=Ae;break e}S(Ze,zt);break}else m(Ze,zt);zt=zt.sibling}_e.type===g?(Ae=Qd(_e.props.children,Ze.mode,rt,_e.key),Ae.return=Ze,Ze=Ae):(rt=Fb(_e.type,_e.key,_e.props,null,Ze.mode,rt),rt.ref=Bp(Ze,Ae,_e),rt.return=Ze,Ze=rt)}return ae(Ze);case c:e:{for(zt=_e.key;Ae!==null;){if(Ae.key===zt)if(Ae.tag===4&&Ae.stateNode.containerInfo===_e.containerInfo&&Ae.stateNode.implementation===_e.implementation){S(Ze,Ae.sibling),Ae=_(Ae,_e.children||[]),Ae.return=Ze,Ze=Ae;break e}else{S(Ze,Ae);break}else m(Ze,Ae);Ae=Ae.sibling}Ae=FS(_e,Ze.mode,rt),Ae.return=Ze,Ze=Ae}return ae(Ze);case v:return zt=_e._init,Ca(Ze,Ae,zt(_e._payload),rt)}if(z(_e))return vt(Ze,Ae,_e,rt);if(G(_e))return Pr(Ze,Ae,_e,rt);nb(Ze,_e)}return typeof _e=="string"&&_e!==""||typeof _e=="number"?(_e=""+_e,Ae!==null&&Ae.tag===6?(S(Ze,Ae.sibling),Ae=_(Ae,_e),Ae.return=Ze,Ze=Ae):(S(Ze,Ae),Ae=WS(_e,Ze.mode,rt),Ae.return=Ze,Ze=Ae),ae(Ze)):S(Ze,Ae)}return Ca}var Jf=z5(!0),X5=z5(!1),Gp={},ha=Sn(Gp),wp=Sn(Gp),jf=Sn(Gp);function zl(C){if(C===Gp)throw Error(o(174));return C}function Jx(C,m){rn(jf,m),rn(wp,C),rn(ha,Gp),C=J(m),en(ha),rn(ha,C)}function qf(){en(ha),en(wp),en(jf)}function Y5(C){var m=zl(jf.current),S=zl(ha.current);m=H(S,C.type,m),S!==m&&(rn(wp,C),rn(ha,m))}function jx(C){wp.current===C&&(en(ha),en(wp))}var li=Sn(0);function ib(C){for(var m=C;m!==null;){if(m.tag===13){var S=m.memoizedState;if(S!==null&&(S=S.dehydrated,S===null||un(S)||te(S)))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if(m.flags&128)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===C)break;for(;m.sibling===null;){if(m.return===null||m.return===C)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var qx=[];function $x(){for(var C=0;C<qx.length;C++){var m=qx[C];O?m._workInProgressVersionPrimary=null:m._workInProgressVersionSecondary=null}qx.length=0}var rb=a.ReactCurrentDispatcher,fa=a.ReactCurrentBatchConfig,$f=0,pi=null,Yr=null,lr=null,sb=!1,xp=!1,Sp=0,zee=0;function Kr(){throw Error(o(321))}function eS(C,m){if(m===null)return!1;for(var S=0;S<m.length&&S<C.length;S++)if(!Fo(C[S],m[S]))return!1;return!0}function tS(C,m,S,E,_,N){if($f=N,pi=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,rb.current=C===null||C.memoizedState===null?Dee:Pee,C=S(E,_),xp){N=0;do{if(xp=!1,Sp=0,25<=N)throw Error(o(301));N+=1,lr=Yr=null,m.updateQueue=null,rb.current=Uee,C=S(E,_)}while(xp)}if(rb.current=gb,m=Yr!==null&&Yr.next!==null,$f=0,lr=Yr=pi=null,sb=!1,m)throw Error(o(300));return C}function nS(){var C=Sp!==0;return Sp=0,C}function Pc(){var C={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return lr===null?pi.memoizedState=lr=C:lr=lr.next=C,lr}function Xl(){if(Yr===null){var C=pi.alternate;C=C!==null?C.memoizedState:null}else C=Yr.next;var m=lr===null?pi.memoizedState:lr.next;if(m!==null)lr=m,Yr=C;else{if(C===null)throw Error(o(310));Yr=C,C={memoizedState:Yr.memoizedState,baseState:Yr.baseState,baseQueue:Yr.baseQueue,queue:Yr.queue,next:null},lr===null?pi.memoizedState=lr=C:lr=lr.next=C}return lr}function Xd(C,m){return typeof m=="function"?m(C):m}function ob(C){var m=Xl(),S=m.queue;if(S===null)throw Error(o(311));S.lastRenderedReducer=C;var E=Yr,_=E.baseQueue,N=S.pending;if(N!==null){if(_!==null){var ae=_.next;_.next=N.next,N.next=ae}E.baseQueue=_=N,S.pending=null}if(_!==null){N=_.next,E=E.baseState;var Ie=ae=null,Ne=null,je=N;do{var lt=je.lane;if(($f&lt)===lt)Ne!==null&&(Ne=Ne.next={lane:0,action:je.action,hasEagerState:je.hasEagerState,eagerState:je.eagerState,next:null}),E=je.hasEagerState?je.eagerState:C(E,je.action);else{var Ft={lane:lt,action:je.action,hasEagerState:je.hasEagerState,eagerState:je.eagerState,next:null};Ne===null?(Ie=Ne=Ft,ae=E):Ne=Ne.next=Ft,pi.lanes|=lt,tI|=lt}je=je.next}while(je!==null&&je!==N);Ne===null?ae=E:Ne.next=Ie,Fo(E,m.memoizedState)||(To=!0),m.memoizedState=E,m.baseState=ae,m.baseQueue=Ne,S.lastRenderedState=E}if(C=S.interleaved,C!==null){_=C;do N=_.lane,pi.lanes|=N,tI|=N,_=_.next;while(_!==C)}else _===null&&(S.lanes=0);return[m.memoizedState,S.dispatch]}function ab(C){var m=Xl(),S=m.queue;if(S===null)throw Error(o(311));S.lastRenderedReducer=C;var E=S.dispatch,_=S.pending,N=m.memoizedState;if(_!==null){S.pending=null;var ae=_=_.next;do N=C(N,ae.action),ae=ae.next;while(ae!==_);Fo(N,m.memoizedState)||(To=!0),m.memoizedState=N,m.baseQueue===null&&(m.baseState=N),S.lastRenderedState=N}return[N,E]}function K5(){}function D5(C,m){var S=pi,E=Xl(),_=m(),N=!Fo(E.memoizedState,_);if(N&&(E.memoizedState=_,To=!0),E=E.queue,Zp(Q5.bind(null,S,E,C),[C]),E.getSnapshot!==m||N||lr!==null&&lr.memoizedState.tag&1){if(S.flags|=2048,Rp(9,U5.bind(null,S,E,_,m),void 0,null),Ti===null)throw Error(o(349));$f&30||P5(S,m,_)}return _}function P5(C,m,S){C.flags|=16384,C={getSnapshot:m,value:S},m=pi.updateQueue,m===null?(m={lastEffect:null,stores:null},pi.updateQueue=m,m.stores=[C]):(S=m.stores,S===null?m.stores=[C]:S.push(C))}function U5(C,m,S,E){m.value=S,m.getSnapshot=E,O5(m)&&Ia(C,1,-1)}function Q5(C,m,S){return S(function(){O5(m)&&Ia(C,1,-1)})}function O5(C){var m=C.getSnapshot;C=C.value;try{var S=m();return!Fo(C,S)}catch{return!0}}function iS(C){var m=Pc();return typeof C=="function"&&(C=C()),m.memoizedState=m.baseState=C,C={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xd,lastRenderedState:C},m.queue=C,C=C.dispatch=Kee.bind(null,pi,C),[m.memoizedState,C]}function Rp(C,m,S,E){return C={tag:C,create:m,destroy:S,deps:E,next:null},m=pi.updateQueue,m===null?(m={lastEffect:null,stores:null},pi.updateQueue=m,m.lastEffect=C.next=C):(S=m.lastEffect,S===null?m.lastEffect=C.next=C:(E=S.next,S.next=C,C.next=E,m.lastEffect=C)),C}function J5(){return Xl().memoizedState}function lb(C,m,S,E){var _=Pc();pi.flags|=C,_.memoizedState=Rp(1|m,S,void 0,E===void 0?null:E)}function cb(C,m,S,E){var _=Xl();E=E===void 0?null:E;var N=void 0;if(Yr!==null){var ae=Yr.memoizedState;if(N=ae.destroy,E!==null&&eS(E,ae.deps)){_.memoizedState=Rp(m,S,N,E);return}}pi.flags|=C,_.memoizedState=Rp(1|m,S,N,E)}function rS(C,m){return lb(8390656,8,C,m)}function Zp(C,m){return cb(2048,8,C,m)}function j5(C,m){return cb(4,2,C,m)}function q5(C,m){return cb(4,4,C,m)}function $5(C,m){if(typeof m=="function")return C=C(),m(C),function(){m(null)};if(m!=null)return C=C(),m.current=C,function(){m.current=null}}function eN(C,m,S){return S=S!=null?S.concat([C]):null,cb(4,4,$5.bind(null,m,C),S)}function sS(){}function tN(C,m){var S=Xl();m=m===void 0?null:m;var E=S.memoizedState;return E!==null&&m!==null&&eS(m,E[1])?E[0]:(S.memoizedState=[C,m],C)}function nN(C,m){var S=Xl();m=m===void 0?null:m;var E=S.memoizedState;return E!==null&&m!==null&&eS(m,E[1])?E[0]:(C=C(),S.memoizedState=[C,m],C)}function Xee(C,m){var S=Ut;Ut=S!==0&&4>S?S:4,C(!0);var E=fa.transition;fa.transition={};try{C(!1),m()}finally{Ut=S,fa.transition=E}}function iN(){return Xl().memoizedState}function Yee(C,m,S){var E=hu(C);S={lane:E,action:S,hasEagerState:!1,eagerState:null,next:null},rN(C)?sN(m,S):(oN(C,m,S),S=ws(),C=Ia(C,E,S),C!==null&&aN(C,m,E))}function Kee(C,m,S){var E=hu(C),_={lane:E,action:S,hasEagerState:!1,eagerState:null,next:null};if(rN(C))sN(m,_);else{oN(C,m,_);var N=C.alternate;if(C.lanes===0&&(N===null||N.lanes===0)&&(N=m.lastRenderedReducer,N!==null))try{var ae=m.lastRenderedState,Ie=N(ae,S);if(_.hasEagerState=!0,_.eagerState=Ie,Fo(Ie,ae))return}catch{}finally{}S=ws(),C=Ia(C,E,S),C!==null&&aN(C,m,E)}}function rN(C){var m=C.alternate;return C===pi||m!==null&&m===pi}function sN(C,m){xp=sb=!0;var S=C.pending;S===null?m.next=m:(m.next=S.next,S.next=m),C.pending=m}function oN(C,m,S){Ti!==null&&C.mode&1&&!(Kt&2)?(C=m.interleaved,C===null?(S.next=S,Oi===null?Oi=[m]:Oi.push(m)):(S.next=C.next,C.next=S),m.interleaved=S):(C=m.pending,C===null?S.next=S:(S.next=C.next,C.next=S),m.pending=S)}function aN(C,m,S){if(S&4194240){var E=m.lanes;E&=C.pendingLanes,S|=E,m.lanes=S,kl(C,S)}}var gb={readContext:Fn,useCallback:Kr,useContext:Kr,useEffect:Kr,useImperativeHandle:Kr,useInsertionEffect:Kr,useLayoutEffect:Kr,useMemo:Kr,useReducer:Kr,useRef:Kr,useState:Kr,useDebugValue:Kr,useDeferredValue:Kr,useTransition:Kr,useMutableSource:Kr,useSyncExternalStore:Kr,useId:Kr,unstable_isNewReconciler:!1},Dee={readContext:Fn,useCallback:function(C,m){return Pc().memoizedState=[C,m===void 0?null:m],C},useContext:Fn,useEffect:rS,useImperativeHandle:function(C,m,S){return S=S!=null?S.concat([C]):null,lb(4194308,4,$5.bind(null,m,C),S)},useLayoutEffect:function(C,m){return lb(4194308,4,C,m)},useInsertionEffect:function(C,m){return lb(4,2,C,m)},useMemo:function(C,m){var S=Pc();return m=m===void 0?null:m,C=C(),S.memoizedState=[C,m],C},useReducer:function(C,m,S){var E=Pc();return m=S!==void 0?S(m):m,E.memoizedState=E.baseState=m,C={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:C,lastRenderedState:m},E.queue=C,C=C.dispatch=Yee.bind(null,pi,C),[E.memoizedState,C]},useRef:function(C){var m=Pc();return C={current:C},m.memoizedState=C},useState:iS,useDebugValue:sS,useDeferredValue:function(C){var m=iS(C),S=m[0],E=m[1];return rS(function(){var _=fa.transition;fa.transition={};try{E(C)}finally{fa.transition=_}},[C]),S},useTransition:function(){var C=iS(!1),m=C[0];return C=Xee.bind(null,C[1]),Pc().memoizedState=C,[m,C]},useMutableSource:function(){},useSyncExternalStore:function(C,m,S){var E=pi,_=Pc();if(si){if(S===void 0)throw Error(o(407));S=S()}else{if(S=m(),Ti===null)throw Error(o(349));$f&30||P5(E,m,S)}_.memoizedState=S;var N={value:S,getSnapshot:m};return _.queue=N,rS(Q5.bind(null,E,N,C),[C]),E.flags|=2048,Rp(9,U5.bind(null,E,N,S,m),void 0,null),S},useId:function(){var C=Pc(),m=Ti.identifierPrefix;if(si){var S=Dc,E=Kc;S=(E&~(1<<32-zr(E)-1)).toString(32)+S,m=":"+m+"R"+S,S=Sp++,0<S&&(m+="H"+S.toString(32)),m+=":"}else S=zee++,m=":"+m+"r"+S.toString(32)+":";return C.memoizedState=m},unstable_isNewReconciler:!1},Pee={readContext:Fn,useCallback:tN,useContext:Fn,useEffect:Zp,useImperativeHandle:eN,useInsertionEffect:j5,useLayoutEffect:q5,useMemo:nN,useReducer:ob,useRef:J5,useState:function(){return ob(Xd)},useDebugValue:sS,useDeferredValue:function(C){var m=ob(Xd),S=m[0],E=m[1];return Zp(function(){var _=fa.transition;fa.transition={};try{E(C)}finally{fa.transition=_}},[C]),S},useTransition:function(){var C=ob(Xd)[0],m=Xl().memoizedState;return[C,m]},useMutableSource:K5,useSyncExternalStore:D5,useId:iN,unstable_isNewReconciler:!1},Uee={readContext:Fn,useCallback:tN,useContext:Fn,useEffect:Zp,useImperativeHandle:eN,useInsertionEffect:j5,useLayoutEffect:q5,useMemo:nN,useReducer:ab,useRef:J5,useState:function(){return ab(Xd)},useDebugValue:sS,useDeferredValue:function(C){var m=ab(Xd),S=m[0],E=m[1];return Zp(function(){var _=fa.transition;fa.transition={};try{E(C)}finally{fa.transition=_}},[C]),S},useTransition:function(){var C=ab(Xd)[0],m=Xl().memoizedState;return[C,m]},useMutableSource:K5,useSyncExternalStore:D5,useId:iN,unstable_isNewReconciler:!1};function oS(C,m){try{var S="",E=m;do S+=Ld(E),E=E.return;while(E);var _=S}catch(N){_=`
Error generating stack: `+N.message+`
`+N.stack}return{value:C,source:m,stack:_}}function aS(C,m){try{console.error(m.value)}catch(S){setTimeout(function(){throw S})}}var Qee=typeof WeakMap=="function"?WeakMap:Map;function lN(C,m,S){S=Yc(-1,S),S.tag=3,S.payload={element:null};var E=m.value;return S.callback=function(){xb||(xb=!0,wS=E),aS(C,m)},S}function cN(C,m,S){S=Yc(-1,S),S.tag=3;var E=C.type.getDerivedStateFromError;if(typeof E=="function"){var _=m.value;S.payload=function(){return E(_)},S.callback=function(){aS(C,m)}}var N=C.stateNode;return N!==null&&typeof N.componentDidCatch=="function"&&(S.callback=function(){aS(C,m),typeof E!="function"&&(uu===null?uu=new Set([this]):uu.add(this));var ae=m.stack;this.componentDidCatch(m.value,{componentStack:ae!==null?ae:""})}),S}function gN(C,m,S){var E=C.pingCache;if(E===null){E=C.pingCache=new Qee;var _=new Set;E.set(m,_)}else _=E.get(m),_===void 0&&(_=new Set,E.set(m,_));_.has(S)||(_.add(S),C=lte.bind(null,C,m,S),m.then(C,C))}function uN(C){do{var m;if((m=C.tag===13)&&(m=C.memoizedState,m=m!==null?m.dehydrated!==null:!0),m)return C;C=C.return}while(C!==null);return null}function dN(C,m,S,E,_){return C.mode&1?(C.flags|=65536,C.lanes=_,C):(C===m?C.flags|=65536:(C.flags|=128,S.flags|=131072,S.flags&=-52805,S.tag===1&&(S.alternate===null?S.tag=17:(m=Yc(-1,1),m.tag=2,gu(S,m))),S.lanes|=1),C)}function Yl(C){C.flags|=4}function hN(C,m){if(C!==null&&C.child===m.child)return!0;if(m.flags&16)return!1;for(C=m.child;C!==null;){if(C.flags&12854||C.subtreeFlags&12854)return!1;C=C.sibling}return!0}var Mp,Ep,ub,db;if(q)Mp=function(C,m){for(var S=m.child;S!==null;){if(S.tag===5||S.tag===6)P(C,S.stateNode);else if(S.tag!==4&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===m)break;for(;S.sibling===null;){if(S.return===null||S.return===m)return;S=S.return}S.sibling.return=S.return,S=S.sibling}},Ep=function(){},ub=function(C,m,S,E,_){if(C=C.memoizedProps,C!==E){var N=m.stateNode,ae=zl(ha.current);S=oe(N,S,C,E,_,ae),(m.updateQueue=S)&&Yl(m)}},db=function(C,m,S,E){S!==E&&Yl(m)};else if(ee){Mp=function(C,m,S,E){for(var _=m.child;_!==null;){if(_.tag===5){var N=_.stateNode;S&&E&&(N=bn(N,_.type,_.memoizedProps,_)),P(C,N)}else if(_.tag===6)N=_.stateNode,S&&E&&(N=Jt(N,_.memoizedProps,_)),P(C,N);else if(_.tag!==4){if(_.tag===22&&_.memoizedState!==null)N=_.child,N!==null&&(N.return=_),Mp(C,_,!0,!0);else if(_.child!==null){_.child.return=_,_=_.child;continue}}if(_===m)break;for(;_.sibling===null;){if(_.return===null||_.return===m)return;_=_.return}_.sibling.return=_.return,_=_.sibling}};var fN=function(C,m,S,E){for(var _=m.child;_!==null;){if(_.tag===5){var N=_.stateNode;S&&E&&(N=bn(N,_.type,_.memoizedProps,_)),on(C,N)}else if(_.tag===6)N=_.stateNode,S&&E&&(N=Jt(N,_.memoizedProps,_)),on(C,N);else if(_.tag!==4){if(_.tag===22&&_.memoizedState!==null)N=_.child,N!==null&&(N.return=_),fN(C,_,!0,!0);else if(_.child!==null){_.child.return=_,_=_.child;continue}}if(_===m)break;for(;_.sibling===null;){if(_.return===null||_.return===m)return;_=_.return}_.sibling.return=_.return,_=_.sibling}};Ep=function(C,m){var S=m.stateNode;if(!hN(C,m)){C=S.containerInfo;var E=Ot(C);fN(E,m,!1,!1),S.pendingChildren=E,Yl(m),An(C,E)}},ub=function(C,m,S,E,_){var N=C.stateNode,ae=C.memoizedProps;if((C=hN(C,m))&&ae===E)m.stateNode=N;else{var Ie=m.stateNode,Ne=zl(ha.current),je=null;ae!==E&&(je=oe(Ie,S,ae,E,_,Ne)),C&&je===null?m.stateNode=N:(N=st(N,je,S,ae,E,m,C,Ie),ne(N,S,E,_,Ne)&&Yl(m),m.stateNode=N,C?Yl(m):Mp(N,m,!1,!1))}},db=function(C,m,S,E){S!==E?(C=zl(jf.current),S=zl(ha.current),m.stateNode=de(E,C,S,m),Yl(m)):m.stateNode=C.stateNode}}else Ep=function(){},ub=function(){},db=function(){};function Wp(C,m){if(!si)switch(C.tailMode){case"hidden":m=C.tail;for(var S=null;m!==null;)m.alternate!==null&&(S=m),m=m.sibling;S===null?C.tail=null:S.sibling=null;break;case"collapsed":S=C.tail;for(var E=null;S!==null;)S.alternate!==null&&(E=S),S=S.sibling;E===null?m||C.tail===null?C.tail=null:C.tail.sibling=null:E.sibling=null}}function Dr(C){var m=C.alternate!==null&&C.alternate.child===C.child,S=0,E=0;if(m)for(var _=C.child;_!==null;)S|=_.lanes|_.childLanes,E|=_.subtreeFlags&14680064,E|=_.flags&14680064,_.return=C,_=_.sibling;else for(_=C.child;_!==null;)S|=_.lanes|_.childLanes,E|=_.subtreeFlags,E|=_.flags,_.return=C,_=_.sibling;return C.subtreeFlags|=E,C.childLanes=S,m}function Oee(C,m,S){var E=m.pendingProps;switch(Px(m),m.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Dr(m),null;case 1:return xi(m.type)&&su(),Dr(m),null;case 3:return E=m.stateNode,qf(),en(Qi),en(ii),$x(),E.pendingContext&&(E.context=E.pendingContext,E.pendingContext=null),(C===null||C.child===null)&&(bp(m)?Yl(m):C===null||C.memoizedState.isDehydrated&&!(m.flags&256)||(m.flags|=1024,qa!==null&&(RS(qa),qa=null))),Ep(C,m),Dr(m),null;case 5:jx(m),S=zl(jf.current);var _=m.type;if(C!==null&&m.stateNode!=null)ub(C,m,_,E,S),C.ref!==m.ref&&(m.flags|=512,m.flags|=2097152);else{if(!E){if(m.stateNode===null)throw Error(o(166));return Dr(m),null}if(C=zl(ha.current),bp(m)){if(!le)throw Error(o(175));C=yt(m.stateNode,m.type,m.memoizedProps,S,C,m,!vp),m.updateQueue=C,C!==null&&Yl(m)}else{var N=Q(_,E,S,C,m);Mp(N,m,!1,!1),m.stateNode=N,ne(N,_,E,S,C)&&Yl(m)}m.ref!==null&&(m.flags|=512,m.flags|=2097152)}return Dr(m),null;case 6:if(C&&m.stateNode!=null)db(C,m,C.memoizedProps,E);else{if(typeof E!="string"&&m.stateNode===null)throw Error(o(166));if(C=zl(jf.current),S=zl(ha.current),bp(m)){if(!le)throw Error(o(176));if(C=m.stateNode,E=m.memoizedProps,(S=St(C,E,m,!vp))&&(_=_o,_!==null))switch(N=(_.mode&1)!==0,_.tag){case 3:Mo(_.stateNode.containerInfo,C,E,N);break;case 5:kn(_.type,_.memoizedProps,_.stateNode,C,E,N)}S&&Yl(m)}else m.stateNode=de(E,C,S,m)}return Dr(m),null;case 13:if(en(li),E=m.memoizedState,si&&Vo!==null&&m.mode&1&&!(m.flags&128)){for(C=Vo;C;)C=Ee(C);return Of(),m.flags|=98560,m}if(E!==null&&E.dehydrated!==null){if(E=bp(m),C===null){if(!E)throw Error(o(318));if(!le)throw Error(o(344));if(C=m.memoizedState,C=C!==null?C.dehydrated:null,!C)throw Error(o(317));kt(C,m)}else Of(),!(m.flags&128)&&(m.memoizedState=null),m.flags|=4;return Dr(m),null}return qa!==null&&(RS(qa),qa=null),m.flags&128?(m.lanes=S,m):(E=E!==null,S=!1,C===null?bp(m):S=C.memoizedState!==null,E&&!S&&(m.child.flags|=8192,m.mode&1&&(C===null||li.current&1?Ji===0&&(Ji=3):MS())),m.updateQueue!==null&&(m.flags|=4),Dr(m),null);case 4:return qf(),Ep(C,m),C===null&&be(m.stateNode.containerInfo),Dr(m),null;case 10:return Hl(m.type._context),Dr(m),null;case 17:return xi(m.type)&&su(),Dr(m),null;case 19:if(en(li),_=m.memoizedState,_===null)return Dr(m),null;if(E=(m.flags&128)!==0,N=_.rendering,N===null)if(E)Wp(_,!1);else{if(Ji!==0||C!==null&&C.flags&128)for(C=m.child;C!==null;){if(N=ib(C),N!==null){for(m.flags|=128,Wp(_,!1),C=N.updateQueue,C!==null&&(m.updateQueue=C,m.flags|=4),m.subtreeFlags=0,C=S,E=m.child;E!==null;)S=E,_=C,S.flags&=14680066,N=S.alternate,N===null?(S.childLanes=0,S.lanes=_,S.child=null,S.subtreeFlags=0,S.memoizedProps=null,S.memoizedState=null,S.updateQueue=null,S.dependencies=null,S.stateNode=null):(S.childLanes=N.childLanes,S.lanes=N.lanes,S.child=N.child,S.subtreeFlags=0,S.deletions=null,S.memoizedProps=N.memoizedProps,S.memoizedState=N.memoizedState,S.updateQueue=N.updateQueue,S.type=N.type,_=N.dependencies,S.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext}),E=E.sibling;return rn(li,li.current&1|2),m.child}C=C.sibling}_.tail!==null&&ri()>GS&&(m.flags|=128,E=!0,Wp(_,!1),m.lanes=4194304)}else{if(!E)if(C=ib(N),C!==null){if(m.flags|=128,E=!0,C=C.updateQueue,C!==null&&(m.updateQueue=C,m.flags|=4),Wp(_,!0),_.tail===null&&_.tailMode==="hidden"&&!N.alternate&&!si)return Dr(m),null}else 2*ri()-_.renderingStartTime>GS&&S!==1073741824&&(m.flags|=128,E=!0,Wp(_,!1),m.lanes=4194304);_.isBackwards?(N.sibling=m.child,m.child=N):(C=_.last,C!==null?C.sibling=N:m.child=N,_.last=N)}return _.tail!==null?(m=_.tail,_.rendering=m,_.tail=m.sibling,_.renderingStartTime=ri(),m.sibling=null,C=li.current,rn(li,E?C&1|2:C&1),m):(Dr(m),null);case 22:case 23:return ZS(),E=m.memoizedState!==null,C!==null&&C.memoizedState!==null!==E&&(m.flags|=8192),E&&m.mode&1?No&1073741824&&(Dr(m),q&&m.subtreeFlags&6&&(m.flags|=8192)):Dr(m),null;case 24:return null;case 25:return null}throw Error(o(156,m.tag))}var Jee=a.ReactCurrentOwner,To=!1;function Gs(C,m,S,E){m.child=C===null?X5(m,null,S,E):Jf(m,C.child,S,E)}function IN(C,m,S,E,_){S=S.render;var N=m.ref;return ar(m,_),E=tS(C,m,S,E,N,_),S=nS(),C!==null&&!To?(m.updateQueue=C.updateQueue,m.flags&=-2053,C.lanes&=~_,Uc(C,m,_)):(si&&S&&Dx(m),m.flags|=1,Gs(C,m,E,_),m.child)}function AN(C,m,S,E,_){if(C===null){var N=S.type;return typeof N=="function"&&!ES(N)&&N.defaultProps===void 0&&S.compare===null&&S.defaultProps===void 0?(m.tag=15,m.type=N,CN(C,m,N,E,_)):(C=Fb(S.type,null,E,m,m.mode,_),C.ref=m.ref,C.return=m,m.child=C)}if(N=C.child,!(C.lanes&_)){var ae=N.memoizedProps;if(S=S.compare,S=S!==null?S:kd,S(ae,E)&&C.ref===m.ref)return Uc(C,m,_)}return m.flags|=1,C=Iu(N,E),C.ref=m.ref,C.return=m,m.child=C}function CN(C,m,S,E,_){if(C!==null&&kd(C.memoizedProps,E)&&C.ref===m.ref)if(To=!1,(C.lanes&_)!==0)C.flags&131072&&(To=!0);else return m.lanes=C.lanes,Uc(C,m,_);return lS(C,m,S,E,_)}function pN(C,m,S){var E=m.pendingProps,_=E.children,N=C!==null?C.memoizedState:null;if(E.mode==="hidden")if(!(m.mode&1))m.memoizedState={baseLanes:0,cachePool:null},rn(eI,No),No|=S;else if(S&1073741824)m.memoizedState={baseLanes:0,cachePool:null},E=N!==null?N.baseLanes:S,rn(eI,No),No|=E;else return C=N!==null?N.baseLanes|S:S,m.lanes=m.childLanes=1073741824,m.memoizedState={baseLanes:C,cachePool:null},m.updateQueue=null,rn(eI,No),No|=C,null;else N!==null?(E=N.baseLanes|S,m.memoizedState=null):E=S,rn(eI,No),No|=E;return Gs(C,m,_,S),m.child}function mN(C,m){var S=m.ref;(C===null&&S!==null||C!==null&&C.ref!==S)&&(m.flags|=512,m.flags|=2097152)}function lS(C,m,S,E,_){var N=xi(S)?Hr:ii.current;return N=Vl(m,N),ar(m,_),S=tS(C,m,S,E,N,_),E=nS(),C!==null&&!To?(m.updateQueue=C.updateQueue,m.flags&=-2053,C.lanes&=~_,Uc(C,m,_)):(si&&E&&Dx(m),m.flags|=1,Gs(C,m,S,_),m.child)}function yN(C,m,S,E,_){if(xi(S)){var N=!0;Tl(m)}else N=!1;if(ar(m,_),m.stateNode===null)C!==null&&(C.alternate=null,m.alternate=null,m.flags|=2),_5(m,S,E),Kx(m,S,E,_),E=!0;else if(C===null){var ae=m.stateNode,Ie=m.memoizedProps;ae.props=Ie;var Ne=ae.context,je=S.contextType;typeof je=="object"&&je!==null?je=Fn(je):(je=xi(S)?Hr:ii.current,je=Vl(m,je));var lt=S.getDerivedStateFromProps,Ft=typeof lt=="function"||typeof ae.getSnapshotBeforeUpdate=="function";Ft||typeof ae.UNSAFE_componentWillReceiveProps!="function"&&typeof ae.componentWillReceiveProps!="function"||(Ie!==E||Ne!==je)&&V5(m,ae,E,je),ja=!1;var Gt=m.memoizedState;ae.state=Gt,qv(m,E,ae,_),Ne=m.memoizedState,Ie!==E||Gt!==Ne||Qi.current||ja?(typeof lt=="function"&&(Yx(m,S,lt,E),Ne=m.memoizedState),(Ie=ja||F5(m,S,Ie,E,Gt,Ne,je))?(Ft||typeof ae.UNSAFE_componentWillMount!="function"&&typeof ae.componentWillMount!="function"||(typeof ae.componentWillMount=="function"&&ae.componentWillMount(),typeof ae.UNSAFE_componentWillMount=="function"&&ae.UNSAFE_componentWillMount()),typeof ae.componentDidMount=="function"&&(m.flags|=4194308)):(typeof ae.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=E,m.memoizedState=Ne),ae.props=E,ae.state=Ne,ae.context=je,E=Ie):(typeof ae.componentDidMount=="function"&&(m.flags|=4194308),E=!1)}else{ae=m.stateNode,Z5(C,m),Ie=m.memoizedProps,je=m.type===m.elementType?Ie:Xr(m.type,Ie),ae.props=je,Ft=m.pendingProps,Gt=ae.context,Ne=S.contextType,typeof Ne=="object"&&Ne!==null?Ne=Fn(Ne):(Ne=xi(S)?Hr:ii.current,Ne=Vl(m,Ne));var _n=S.getDerivedStateFromProps;(lt=typeof _n=="function"||typeof ae.getSnapshotBeforeUpdate=="function")||typeof ae.UNSAFE_componentWillReceiveProps!="function"&&typeof ae.componentWillReceiveProps!="function"||(Ie!==Ft||Gt!==Ne)&&V5(m,ae,E,Ne),ja=!1,Gt=m.memoizedState,ae.state=Gt,qv(m,E,ae,_);var vt=m.memoizedState;Ie!==Ft||Gt!==vt||Qi.current||ja?(typeof _n=="function"&&(Yx(m,S,_n,E),vt=m.memoizedState),(je=ja||F5(m,S,je,E,Gt,vt,Ne)||!1)?(lt||typeof ae.UNSAFE_componentWillUpdate!="function"&&typeof ae.componentWillUpdate!="function"||(typeof ae.componentWillUpdate=="function"&&ae.componentWillUpdate(E,vt,Ne),typeof ae.UNSAFE_componentWillUpdate=="function"&&ae.UNSAFE_componentWillUpdate(E,vt,Ne)),typeof ae.componentDidUpdate=="function"&&(m.flags|=4),typeof ae.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof ae.componentDidUpdate!="function"||Ie===C.memoizedProps&&Gt===C.memoizedState||(m.flags|=4),typeof ae.getSnapshotBeforeUpdate!="function"||Ie===C.memoizedProps&&Gt===C.memoizedState||(m.flags|=1024),m.memoizedProps=E,m.memoizedState=vt),ae.props=E,ae.state=vt,ae.context=Ne,E=je):(typeof ae.componentDidUpdate!="function"||Ie===C.memoizedProps&&Gt===C.memoizedState||(m.flags|=4),typeof ae.getSnapshotBeforeUpdate!="function"||Ie===C.memoizedProps&&Gt===C.memoizedState||(m.flags|=1024),E=!1)}return cS(C,m,S,E,N,_)}function cS(C,m,S,E,_,N){mN(C,m);var ae=(m.flags&128)!==0;if(!E&&!ae)return _&&Dv(m,S,!1),Uc(C,m,N);E=m.stateNode,Jee.current=m;var Ie=ae&&typeof S.getDerivedStateFromError!="function"?null:E.render();return m.flags|=1,C!==null&&ae?(m.child=Jf(m,C.child,null,N),m.child=Jf(m,null,Ie,N)):Gs(C,m,Ie,N),m.memoizedState=E.state,_&&Dv(m,S,!0),m.child}function vN(C){var m=C.stateNode;m.pendingContext?Lf(C,m.pendingContext,m.pendingContext!==m.context):m.context&&Lf(C,m.context,!1),Jx(C,m.containerInfo)}function bN(C,m,S,E,_){return Of(),Ox(_),m.flags|=256,Gs(C,m,S,E),m.child}var hb={dehydrated:null,treeContext:null,retryLane:0};function fb(C){return{baseLanes:C,cachePool:null}}function BN(C,m,S){var E=m.pendingProps,_=li.current,N=!1,ae=(m.flags&128)!==0,Ie;if((Ie=ae)||(Ie=C!==null&&C.memoizedState===null?!1:(_&2)!==0),Ie?(N=!0,m.flags&=-129):(C===null||C.memoizedState!==null)&&(_|=1),rn(li,_&1),C===null)return Qx(m),C=m.memoizedState,C!==null&&(C=C.dehydrated,C!==null)?(m.mode&1?te(C)?m.lanes=8:m.lanes=1073741824:m.lanes=1,null):(_=E.children,C=E.fallback,N?(E=m.mode,N=m.child,_={mode:"hidden",children:_},!(E&1)&&N!==null?(N.childLanes=0,N.pendingProps=_):N=_b(_,E,0,null),C=Qd(C,E,S,null),N.return=m,C.return=m,N.sibling=C,m.child=N,m.child.memoizedState=fb(S),m.memoizedState=hb,C):gS(m,_));if(_=C.memoizedState,_!==null){if(Ie=_.dehydrated,Ie!==null){if(ae)return m.flags&256?(m.flags&=-257,Ib(C,m,S,Error(o(422)))):m.memoizedState!==null?(m.child=C.child,m.flags|=128,null):(N=E.fallback,_=m.mode,E=_b({mode:"visible",children:E.children},_,0,null),N=Qd(N,_,S,null),N.flags|=2,E.return=m,N.return=m,E.sibling=N,m.child=E,m.mode&1&&Jf(m,C.child,null,S),m.child.memoizedState=fb(S),m.memoizedState=hb,N);if(!(m.mode&1))m=Ib(C,m,S,null);else if(te(Ie))m=Ib(C,m,S,Error(o(419)));else if(E=(S&C.childLanes)!==0,To||E){if(E=Ti,E!==null){switch(S&-S){case 4:N=2;break;case 16:N=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:N=32;break;case 536870912:N=268435456;break;default:N=0}E=N&(E.suspendedLanes|S)?0:N,E!==0&&E!==_.retryLane&&(_.retryLane=E,Ia(C,E,-1))}MS(),m=Ib(C,m,S,Error(o(421)))}else un(Ie)?(m.flags|=128,m.child=C.child,m=cte.bind(null,C),ve(Ie,m),m=null):(S=_.treeContext,le&&(Vo=dt(Ie),_o=m,si=!0,qa=null,vp=!1,S!==null&&(ua[da++]=Kc,ua[da++]=Dc,ua[da++]=Hd,Kc=S.id,Dc=S.overflow,Hd=m)),m=gS(m,m.pendingProps.children),m.flags|=4096);return m}return N?(E=wN(C,m,E.children,E.fallback,S),N=m.child,_=C.child.memoizedState,N.memoizedState=_===null?fb(S):{baseLanes:_.baseLanes|S,cachePool:null},N.childLanes=C.childLanes&~S,m.memoizedState=hb,E):(S=GN(C,m,E.children,S),m.memoizedState=null,S)}return N?(E=wN(C,m,E.children,E.fallback,S),N=m.child,_=C.child.memoizedState,N.memoizedState=_===null?fb(S):{baseLanes:_.baseLanes|S,cachePool:null},N.childLanes=C.childLanes&~S,m.memoizedState=hb,E):(S=GN(C,m,E.children,S),m.memoizedState=null,S)}function gS(C,m){return m=_b({mode:"visible",children:m},C.mode,0,null),m.return=C,C.child=m}function GN(C,m,S,E){var _=C.child;return C=_.sibling,S=Iu(_,{mode:"visible",children:S}),!(m.mode&1)&&(S.lanes=E),S.return=m,S.sibling=null,C!==null&&(E=m.deletions,E===null?(m.deletions=[C],m.flags|=16):E.push(C)),m.child=S}function wN(C,m,S,E,_){var N=m.mode;C=C.child;var ae=C.sibling,Ie={mode:"hidden",children:S};return!(N&1)&&m.child!==C?(S=m.child,S.childLanes=0,S.pendingProps=Ie,m.deletions=null):(S=Iu(C,Ie),S.subtreeFlags=C.subtreeFlags&14680064),ae!==null?E=Iu(ae,E):(E=Qd(E,N,_,null),E.flags|=2),E.return=m,S.return=m,S.sibling=E,m.child=S,E}function Ib(C,m,S,E){return E!==null&&Ox(E),Jf(m,C.child,null,S),C=gS(m,m.pendingProps.children),C.flags|=2,m.memoizedState=null,C}function xN(C,m,S){C.lanes|=m;var E=C.alternate;E!==null&&(E.lanes|=m),Vi(C.return,m,S)}function uS(C,m,S,E,_){var N=C.memoizedState;N===null?C.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:E,tail:S,tailMode:_}:(N.isBackwards=m,N.rendering=null,N.renderingStartTime=0,N.last=E,N.tail=S,N.tailMode=_)}function SN(C,m,S){var E=m.pendingProps,_=E.revealOrder,N=E.tail;if(Gs(C,m,E.children,S),E=li.current,E&2)E=E&1|2,m.flags|=128;else{if(C!==null&&C.flags&128)e:for(C=m.child;C!==null;){if(C.tag===13)C.memoizedState!==null&&xN(C,S,m);else if(C.tag===19)xN(C,S,m);else if(C.child!==null){C.child.return=C,C=C.child;continue}if(C===m)break e;for(;C.sibling===null;){if(C.return===null||C.return===m)break e;C=C.return}C.sibling.return=C.return,C=C.sibling}E&=1}if(rn(li,E),!(m.mode&1))m.memoizedState=null;else switch(_){case"forwards":for(S=m.child,_=null;S!==null;)C=S.alternate,C!==null&&ib(C)===null&&(_=S),S=S.sibling;S=_,S===null?(_=m.child,m.child=null):(_=S.sibling,S.sibling=null),uS(m,!1,_,S,N);break;case"backwards":for(S=null,_=m.child,m.child=null;_!==null;){if(C=_.alternate,C!==null&&ib(C)===null){m.child=_;break}C=_.sibling,_.sibling=S,S=_,_=C}uS(m,!0,S,null,N);break;case"together":uS(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function Uc(C,m,S){if(C!==null&&(m.dependencies=C.dependencies),tI|=m.lanes,!(S&m.childLanes))return null;if(C!==null&&m.child!==C.child)throw Error(o(153));if(m.child!==null){for(C=m.child,S=Iu(C,C.pendingProps),m.child=S,S.return=m;C.sibling!==null;)C=C.sibling,S=S.sibling=Iu(C,C.pendingProps),S.return=m;S.sibling=null}return m.child}function jee(C,m,S){switch(m.tag){case 3:vN(m),Of();break;case 5:Y5(m);break;case 1:xi(m.type)&&Tl(m);break;case 4:Jx(m,m.stateNode.containerInfo);break;case 10:Jv(m,m.type._context,m.memoizedProps.value);break;case 13:var E=m.memoizedState;if(E!==null)return E.dehydrated!==null?(rn(li,li.current&1),m.flags|=128,null):S&m.child.childLanes?BN(C,m,S):(rn(li,li.current&1),C=Uc(C,m,S),C!==null?C.sibling:null);rn(li,li.current&1);break;case 19:if(E=(S&m.childLanes)!==0,C.flags&128){if(E)return SN(C,m,S);m.flags|=128}var _=m.memoizedState;if(_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),rn(li,li.current),E)break;return null;case 22:case 23:return m.lanes=0,pN(C,m,S)}return Uc(C,m,S)}function qee(C,m){switch(Px(m),m.tag){case 1:return xi(m.type)&&su(),C=m.flags,C&65536?(m.flags=C&-65537|128,m):null;case 3:return qf(),en(Qi),en(ii),$x(),C=m.flags,C&65536&&!(C&128)?(m.flags=C&-65537|128,m):null;case 5:return jx(m),null;case 13:if(en(li),C=m.memoizedState,C!==null&&C.dehydrated!==null){if(m.alternate===null)throw Error(o(340));Of()}return C=m.flags,C&65536?(m.flags=C&-65537|128,m):null;case 19:return en(li),null;case 4:return qf(),null;case 10:return Hl(m.type._context),null;case 22:case 23:return ZS(),null;case 24:return null;default:return null}}var Ab=!1,Yd=!1,$ee=typeof WeakSet=="function"?WeakSet:Set,it=null;function Cb(C,m){var S=C.ref;if(S!==null)if(typeof S=="function")try{S(null)}catch(E){qs(C,m,E)}else S.current=null}function dS(C,m,S){try{S()}catch(E){qs(C,m,E)}}var RN=!1;function ete(C,m){for(Y(C.containerInfo),it=m;it!==null;)if(C=it,m=C.child,(C.subtreeFlags&1028)!==0&&m!==null)m.return=C,it=m;else for(;it!==null;){C=it;try{var S=C.alternate;if(C.flags&1024)switch(C.tag){case 0:case 11:case 15:break;case 1:if(S!==null){var E=S.memoizedProps,_=S.memoizedState,N=C.stateNode,ae=N.getSnapshotBeforeUpdate(C.elementType===C.type?E:Xr(C.type,E),_);N.__reactInternalSnapshotBeforeUpdate=ae}break;case 3:q&&et(C.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(o(163))}}catch(Ie){qs(C,C.return,Ie)}if(m=C.sibling,m!==null){m.return=C.return,it=m;break}it=C.return}return S=RN,RN=!1,S}function Kd(C,m,S){var E=m.updateQueue;if(E=E!==null?E.lastEffect:null,E!==null){var _=E=E.next;do{if((_.tag&C)===C){var N=_.destroy;_.destroy=void 0,N!==void 0&&dS(m,S,N)}_=_.next}while(_!==E)}}function Fp(C,m){if(m=m.updateQueue,m=m!==null?m.lastEffect:null,m!==null){var S=m=m.next;do{if((S.tag&C)===C){var E=S.create;S.destroy=E()}S=S.next}while(S!==m)}}function hS(C){var m=C.ref;if(m!==null){var S=C.stateNode;switch(C.tag){case 5:C=U(S);break;default:C=S}typeof m=="function"?m(C):m.current=C}}function ZN(C,m,S){if(Wo&&typeof Wo.onCommitFiberUnmount=="function")try{Wo.onCommitFiberUnmount(lu,m)}catch{}switch(m.tag){case 0:case 11:case 14:case 15:if(C=m.updateQueue,C!==null&&(C=C.lastEffect,C!==null)){var E=C=C.next;do{var _=E,N=_.destroy;_=_.tag,N!==void 0&&(_&2||_&4)&&dS(m,S,N),E=E.next}while(E!==C)}break;case 1:if(Cb(m,S),C=m.stateNode,typeof C.componentWillUnmount=="function")try{C.props=m.memoizedProps,C.state=m.memoizedState,C.componentWillUnmount()}catch(ae){qs(m,S,ae)}break;case 5:Cb(m,S);break;case 4:q?VN(C,m,S):ee&&ee&&(m=m.stateNode.containerInfo,S=Ot(m),$t(m,S))}}function MN(C,m,S){for(var E=m;;)if(ZN(C,E,S),E.child===null||q&&E.tag===4){if(E===m)break;for(;E.sibling===null;){if(E.return===null||E.return===m)return;E=E.return}E.sibling.return=E.return,E=E.sibling}else E.child.return=E,E=E.child}function EN(C){var m=C.alternate;m!==null&&(C.alternate=null,EN(m)),C.child=null,C.deletions=null,C.sibling=null,C.tag===5&&(m=C.stateNode,m!==null&&ze(m)),C.stateNode=null,C.return=null,C.dependencies=null,C.memoizedProps=null,C.memoizedState=null,C.pendingProps=null,C.stateNode=null,C.updateQueue=null}function WN(C){return C.tag===5||C.tag===3||C.tag===4}function FN(C){e:for(;;){for(;C.sibling===null;){if(C.return===null||WN(C.return))return null;C=C.return}for(C.sibling.return=C.return,C=C.sibling;C.tag!==5&&C.tag!==6&&C.tag!==18;){if(C.flags&2||C.child===null||C.tag===4)continue e;C.child.return=C,C=C.child}if(!(C.flags&2))return C.stateNode}}function _N(C){if(q){e:{for(var m=C.return;m!==null;){if(WN(m))break e;m=m.return}throw Error(o(160))}var S=m;switch(S.tag){case 5:m=S.stateNode,S.flags&32&&(mt(m),S.flags&=-33),S=FN(C),IS(C,S,m);break;case 3:case 4:m=S.stateNode.containerInfo,S=FN(C),fS(C,S,m);break;default:throw Error(o(161))}}}function fS(C,m,S){var E=C.tag;if(E===5||E===6)C=C.stateNode,m?Pe(S,C,m):Le(S,C);else if(E!==4&&(C=C.child,C!==null))for(fS(C,m,S),C=C.sibling;C!==null;)fS(C,m,S),C=C.sibling}function IS(C,m,S){var E=C.tag;if(E===5||E===6)C=C.stateNode,m?Ue(S,C,m):Fe(S,C);else if(E!==4&&(C=C.child,C!==null))for(IS(C,m,S),C=C.sibling;C!==null;)IS(C,m,S),C=C.sibling}function VN(C,m,S){for(var E=m,_=!1,N,ae;;){if(!_){_=E.return;e:for(;;){if(_===null)throw Error(o(160));switch(N=_.stateNode,_.tag){case 5:ae=!1;break e;case 3:N=N.containerInfo,ae=!0;break e;case 4:N=N.containerInfo,ae=!0;break e}_=_.return}_=!0}if(E.tag===5||E.tag===6)MN(C,E,S),ae?$e(N,E.stateNode):Ye(N,E.stateNode);else if(E.tag===18)ae?sr(N,E.stateNode):ti(N,E.stateNode);else if(E.tag===4){if(E.child!==null){N=E.stateNode.containerInfo,ae=!0,E.child.return=E,E=E.child;continue}}else if(ZN(C,E,S),E.child!==null){E.child.return=E,E=E.child;continue}if(E===m)break;for(;E.sibling===null;){if(E.return===null||E.return===m)return;E=E.return,E.tag===4&&(_=!1)}E.sibling.return=E.return,E=E.sibling}}function AS(C,m){if(q){switch(m.tag){case 0:case 11:case 14:case 15:Kd(3,m,m.return),Fp(3,m),Kd(5,m,m.return);return;case 1:return;case 5:var S=m.stateNode;if(S!=null){var E=m.memoizedProps;C=C!==null?C.memoizedProps:E;var _=m.type,N=m.updateQueue;m.updateQueue=null,N!==null&&we(S,N,_,C,E,m)}return;case 6:if(m.stateNode===null)throw Error(o(162));S=m.memoizedProps,Re(m.stateNode,C!==null?C.memoizedProps:S,S);return;case 3:le&&C!==null&&C.memoizedState.isDehydrated&&Tt(m.stateNode.containerInfo);return;case 12:return;case 13:pb(m);return;case 19:pb(m);return;case 17:return}throw Error(o(163))}switch(m.tag){case 0:case 11:case 14:case 15:Kd(3,m,m.return),Fp(3,m),Kd(5,m,m.return);return;case 12:return;case 13:pb(m);return;case 19:pb(m);return;case 3:le&&C!==null&&C.memoizedState.isDehydrated&&Tt(m.stateNode.containerInfo);break;case 22:case 23:return}e:if(ee){switch(m.tag){case 1:case 5:case 6:break e;case 3:case 4:m=m.stateNode,$t(m.containerInfo,m.pendingChildren);break e}throw Error(o(163))}}function pb(C){var m=C.updateQueue;if(m!==null){C.updateQueue=null;var S=C.stateNode;S===null&&(S=C.stateNode=new $ee),m.forEach(function(E){var _=gte.bind(null,C,E);S.has(E)||(S.add(E),E.then(_,_))})}}function tte(C,m){for(it=m;it!==null;){m=it;var S=m.deletions;if(S!==null)for(var E=0;E<S.length;E++){var _=S[E];try{var N=C;q?VN(N,_,m):MN(N,_,m);var ae=_.alternate;ae!==null&&(ae.return=null),_.return=null}catch(It){qs(_,m,It)}}if(S=m.child,m.subtreeFlags&12854&&S!==null)S.return=m,it=S;else for(;it!==null;){m=it;try{var Ie=m.flags;if(Ie&32&&q&&mt(m.stateNode),Ie&512){var Ne=m.alternate;if(Ne!==null){var je=Ne.ref;je!==null&&(typeof je=="function"?je(null):je.current=null)}}if(Ie&8192)switch(m.tag){case 13:if(m.memoizedState!==null){var lt=m.alternate;(lt===null||lt.memoizedState===null)&&(BS=ri())}break;case 22:var Ft=m.memoizedState!==null,Gt=m.alternate,_n=Gt!==null&&Gt.memoizedState!==null;if(S=m,q){e:if(E=S,_=Ft,N=null,q)for(var vt=E;;){if(vt.tag===5){if(N===null){N=vt;var Pr=vt.stateNode;_?Wt(Pr):Me(vt.stateNode,vt.memoizedProps)}}else if(vt.tag===6){if(N===null){var Ca=vt.stateNode;_?ue(Ca):De(Ca,vt.memoizedProps)}}else if((vt.tag!==22&&vt.tag!==23||vt.memoizedState===null||vt===E)&&vt.child!==null){vt.child.return=vt,vt=vt.child;continue}if(vt===E)break;for(;vt.sibling===null;){if(vt.return===null||vt.return===E)break e;N===vt&&(N=null),vt=vt.return}N===vt&&(N=null),vt.sibling.return=vt.return,vt=vt.sibling}}if(Ft&&!_n&&S.mode&1){it=S;for(var Ze=S.child;Ze!==null;){for(S=it=Ze;it!==null;){E=it;var Ae=E.child;switch(E.tag){case 0:case 11:case 14:case 15:Kd(4,E,E.return);break;case 1:Cb(E,E.return);var _e=E.stateNode;if(typeof _e.componentWillUnmount=="function"){var rt=E.return;try{_e.props=E.memoizedProps,_e.state=E.memoizedState,_e.componentWillUnmount()}catch(It){qs(E,rt,It)}}break;case 5:Cb(E,E.return);break;case 22:if(E.memoizedState!==null){kN(S);continue}}Ae!==null?(Ae.return=E,it=Ae):kN(S)}Ze=Ze.sibling}}}switch(Ie&4102){case 2:_N(m),m.flags&=-3;break;case 6:_N(m),m.flags&=-3,AS(m.alternate,m);break;case 4096:m.flags&=-4097;break;case 4100:m.flags&=-4097,AS(m.alternate,m);break;case 4:AS(m.alternate,m)}}catch(It){qs(m,m.return,It)}if(S=m.sibling,S!==null){S.return=m.return,it=S;break}it=m.return}}}function nte(C,m,S){it=C,TN(C)}function TN(C,m,S){for(var E=(C.mode&1)!==0;it!==null;){var _=it,N=_.child;if(_.tag===22&&E){var ae=_.memoizedState!==null||Ab;if(!ae){var Ie=_.alternate,Ne=Ie!==null&&Ie.memoizedState!==null||Yd;Ie=Ab;var je=Yd;if(Ab=ae,(Yd=Ne)&&!je)for(it=_;it!==null;)ae=it,Ne=ae.child,ae.tag===22&&ae.memoizedState!==null?LN(_):Ne!==null?(Ne.return=ae,it=Ne):LN(_);for(;N!==null;)it=N,TN(N),N=N.sibling;it=_,Ab=Ie,Yd=je}NN(C)}else _.subtreeFlags&8772&&N!==null?(N.return=_,it=N):NN(C)}}function NN(C){for(;it!==null;){var m=it;if(m.flags&8772){var S=m.alternate;try{if(m.flags&8772)switch(m.tag){case 0:case 11:case 15:Yd||Fp(5,m);break;case 1:var E=m.stateNode;if(m.flags&4&&!Yd)if(S===null)E.componentDidMount();else{var _=m.elementType===m.type?S.memoizedProps:Xr(m.type,S.memoizedProps);E.componentDidUpdate(_,S.memoizedState,E.__reactInternalSnapshotBeforeUpdate)}var N=m.updateQueue;N!==null&&E5(m,N,E);break;case 3:var ae=m.updateQueue;if(ae!==null){if(S=null,m.child!==null)switch(m.child.tag){case 5:S=U(m.child.stateNode);break;case 1:S=m.child.stateNode}E5(m,ae,S)}break;case 5:var Ie=m.stateNode;S===null&&m.flags&4&&Xe(Ie,m.type,m.memoizedProps,m);break;case 6:break;case 4:break;case 12:break;case 13:if(le&&m.memoizedState===null){var Ne=m.alternate;if(Ne!==null){var je=Ne.memoizedState;if(je!==null){var lt=je.dehydrated;lt!==null&&Ht(lt)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(o(163))}Yd||m.flags&512&&hS(m)}catch(Ft){qs(m,m.return,Ft)}}if(m===C){it=null;break}if(S=m.sibling,S!==null){S.return=m.return,it=S;break}it=m.return}}function kN(C){for(;it!==null;){var m=it;if(m===C){it=null;break}var S=m.sibling;if(S!==null){S.return=m.return,it=S;break}it=m.return}}function LN(C){for(;it!==null;){var m=it;try{switch(m.tag){case 0:case 11:case 15:var S=m.return;try{Fp(4,m)}catch(Ne){qs(m,S,Ne)}break;case 1:var E=m.stateNode;if(typeof E.componentDidMount=="function"){var _=m.return;try{E.componentDidMount()}catch(Ne){qs(m,_,Ne)}}var N=m.return;try{hS(m)}catch(Ne){qs(m,N,Ne)}break;case 5:var ae=m.return;try{hS(m)}catch(Ne){qs(m,ae,Ne)}}}catch(Ne){qs(m,m.return,Ne)}if(m===C){it=null;break}var Ie=m.sibling;if(Ie!==null){Ie.return=m.return,it=Ie;break}it=m.return}}var mb=0,yb=1,vb=2,bb=3,Bb=4;if(typeof Symbol=="function"&&Symbol.for){var _p=Symbol.for;mb=_p("selector.component"),yb=_p("selector.has_pseudo_class"),vb=_p("selector.role"),bb=_p("selector.test_id"),Bb=_p("selector.text")}function CS(C){var m=he(C);if(m!=null){if(typeof m.memoizedProps["data-testname"]!="string")throw Error(o(364));return m}if(C=Be(C),C===null)throw Error(o(362));return C.stateNode.current}function pS(C,m){switch(m.$$typeof){case mb:if(C.type===m.value)return!0;break;case yb:e:{m=m.value,C=[C,0];for(var S=0;S<C.length;){var E=C[S++],_=C[S++],N=m[_];if(E.tag!==5||!ce(E)){for(;N!=null&&pS(E,N);)_++,N=m[_];if(_===m.length){m=!0;break e}else for(E=E.child;E!==null;)C.push(E,_),E=E.sibling}}m=!1}return m;case vb:if(C.tag===5&&fe(C.stateNode,m.value))return!0;break;case Bb:if((C.tag===5||C.tag===6)&&(C=X(C),C!==null&&0<=C.indexOf(m.value)))return!0;break;case bb:if(C.tag===5&&(C=C.memoizedProps["data-testname"],typeof C=="string"&&C.toLowerCase()===m.value.toLowerCase()))return!0;break;default:throw Error(o(365))}return!1}function mS(C){switch(C.$$typeof){case mb:return"<"+(x(C.value)||"Unknown")+">";case yb:return":has("+(mS(C)||"")+")";case vb:return'[role="'+C.value+'"]';case Bb:return'"'+C.value+'"';case bb:return'[data-testname="'+C.value+'"]';default:throw Error(o(365))}}function HN(C,m){var S=[];C=[C,0];for(var E=0;E<C.length;){var _=C[E++],N=C[E++],ae=m[N];if(_.tag!==5||!ce(_)){for(;ae!=null&&pS(_,ae);)N++,ae=m[N];if(N===m.length)S.push(_);else for(_=_.child;_!==null;)C.push(_,N),_=_.sibling}}return S}function yS(C,m){if(!He)throw Error(o(363));C=CS(C),C=HN(C,m),m=[],C=Array.from(C);for(var S=0;S<C.length;){var E=C[S++];if(E.tag===5)ce(E)||m.push(E.stateNode);else for(E=E.child;E!==null;)C.push(E),E=E.sibling}return m}var ite=Math.ceil,Gb=a.ReactCurrentDispatcher,vS=a.ReactCurrentOwner,Si=a.ReactCurrentBatchConfig,Kt=0,Ti=null,Ni=null,Br=0,No=0,eI=Sn(0),Ji=0,Vp=null,tI=0,wb=0,bS=0,Tp=null,Js=null,BS=0,GS=1/0;function nI(){GS=ri()+500}var xb=!1,wS=null,uu=null,Sb=!1,du=null,Rb=0,Np=0,xS=null,Zb=-1,Mb=0;function ws(){return Kt&6?ri():Zb!==-1?Zb:Zb=ri()}function hu(C){return C.mode&1?Kt&2&&Br!==0?Br&-Br:Nd.transition!==null?(Mb===0&&(C=kc,kc<<=1,!(kc&4194240)&&(kc=64),Mb=C),Mb):(C=Ut,C!==0?C:xe()):1}function Ia(C,m,S){if(50<Np)throw Np=0,xS=null,Error(o(185));var E=Eb(C,m);return E===null?null:(Nl(E,m,S),(!(Kt&2)||E!==Ti)&&(E===Ti&&(!(Kt&2)&&(wb|=m),Ji===4&&fu(E,Br)),js(E,S),m===1&&Kt===0&&!(C.mode&1)&&(nI(),Ll&&Os())),E)}function Eb(C,m){C.lanes|=m;var S=C.alternate;for(S!==null&&(S.lanes|=m),S=C,C=C.return;C!==null;)C.childLanes|=m,S=C.alternate,S!==null&&(S.childLanes|=m),S=C,C=C.return;return S.tag===3?S.stateNode:null}function js(C,m){var S=C.callbackNode;fp(C,m);var E=Td(C,C===Ti?Br:0);if(E===0)S!==null&&Yf(S),C.callbackNode=null,C.callbackPriority=0;else if(m=E&-E,C.callbackPriority!==m){if(S!=null&&Yf(S),m===1)C.tag===0?yp(XN.bind(null,C)):mp(XN.bind(null,C)),Se?ke(function(){Kt===0&&Os()}):Xc(au,Os),S=null;else{switch(Ip(E)){case 1:S=au;break;case 4:S=Ov;break;case 16:S=bs;break;case 536870912:S=Cp;break;default:S=bs}S=jN(S,zN.bind(null,C))}C.callbackPriority=m,C.callbackNode=S}}function zN(C,m){if(Zb=-1,Mb=0,Kt&6)throw Error(o(327));var S=C.callbackNode;if(Ud()&&C.callbackNode!==S)return null;var E=Td(C,C===Ti?Br:0);if(E===0)return null;if(E&30||E&C.expiredLanes||m)m=Wb(C,E);else{m=E;var _=Kt;Kt|=2;var N=DN();(Ti!==C||Br!==m)&&(nI(),Dd(C,m));do try{ote();break}catch(Ie){KN(C,Ie)}while(1);Pf(),Gb.current=N,Kt=_,Ni!==null?m=0:(Ti=null,Br=0,m=Ji)}if(m!==0){if(m===2&&(_=zc(C),_!==0&&(E=_,m=SS(C,_))),m===1)throw S=Vp,Dd(C,0),fu(C,E),js(C,ri()),S;if(m===6)fu(C,E);else{if(_=C.current.alternate,!(E&30)&&!rte(_)&&(m=Wb(C,E),m===2&&(N=zc(C),N!==0&&(E=N,m=SS(C,N))),m===1))throw S=Vp,Dd(C,0),fu(C,E),js(C,ri()),S;switch(C.finishedWork=_,C.finishedLanes=E,m){case 0:case 1:throw Error(o(345));case 2:Pd(C,Js);break;case 3:if(fu(C,E),(E&130023424)===E&&(m=BS+500-ri(),10<m)){if(Td(C,0)!==0)break;if(_=C.suspendedLanes,(_&E)!==E){ws(),C.pingedLanes|=C.suspendedLanes&_;break}C.timeoutHandle=ge(Pd.bind(null,C,Js),m);break}Pd(C,Js);break;case 4:if(fu(C,E),(E&4194240)===E)break;for(m=C.eventTimes,_=-1;0<E;){var ae=31-zr(E);N=1<<ae,ae=m[ae],ae>_&&(_=ae),E&=~N}if(E=_,E=ri()-E,E=(120>E?120:480>E?480:1080>E?1080:1920>E?1920:3e3>E?3e3:4320>E?4320:1960*ite(E/1960))-E,10<E){C.timeoutHandle=ge(Pd.bind(null,C,Js),E);break}Pd(C,Js);break;case 5:Pd(C,Js);break;default:throw Error(o(329))}}}return js(C,ri()),C.callbackNode===S?zN.bind(null,C):null}function SS(C,m){var S=Tp;return C.current.memoizedState.isDehydrated&&(Dd(C,m).flags|=256),C=Wb(C,m),C!==2&&(m=Js,Js=S,m!==null&&RS(m)),C}function RS(C){Js===null?Js=C:Js.push.apply(Js,C)}function rte(C){for(var m=C;;){if(m.flags&16384){var S=m.updateQueue;if(S!==null&&(S=S.stores,S!==null))for(var E=0;E<S.length;E++){var _=S[E],N=_.getSnapshot;_=_.value;try{if(!Fo(N(),_))return!1}catch{return!1}}}if(S=m.child,m.subtreeFlags&16384&&S!==null)S.return=m,m=S;else{if(m===C)break;for(;m.sibling===null;){if(m.return===null||m.return===C)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function fu(C,m){for(m&=~bS,m&=~wb,C.suspendedLanes|=m,C.pingedLanes&=~m,C=C.expirationTimes;0<m;){var S=31-zr(m),E=1<<S;C[S]=-1,m&=~E}}function XN(C){if(Kt&6)throw Error(o(327));Ud();var m=Td(C,0);if(!(m&1))return js(C,ri()),null;var S=Wb(C,m);if(C.tag!==0&&S===2){var E=zc(C);E!==0&&(m=E,S=SS(C,E))}if(S===1)throw S=Vp,Dd(C,0),fu(C,m),js(C,ri()),S;if(S===6)throw Error(o(345));return C.finishedWork=C.current.alternate,C.finishedLanes=m,Pd(C,Js),js(C,ri()),null}function YN(C){du!==null&&du.tag===0&&!(Kt&6)&&Ud();var m=Kt;Kt|=1;var S=Si.transition,E=Ut;try{if(Si.transition=null,Ut=1,C)return C()}finally{Ut=E,Si.transition=S,Kt=m,!(Kt&6)&&Os()}}function ZS(){No=eI.current,en(eI)}function Dd(C,m){C.finishedWork=null,C.finishedLanes=0;var S=C.timeoutHandle;if(S!==k&&(C.timeoutHandle=k,se(S)),Ni!==null)for(S=Ni.return;S!==null;){var E=S;switch(Px(E),E.tag){case 1:E=E.type.childContextTypes,E!=null&&su();break;case 3:qf(),en(Qi),en(ii),$x();break;case 5:jx(E);break;case 4:qf();break;case 13:en(li);break;case 19:en(li);break;case 10:Hl(E.type._context);break;case 22:case 23:ZS()}S=S.return}if(Ti=C,Ni=C=Iu(C.current,null),Br=No=m,Ji=0,Vp=null,bS=wb=tI=0,Js=Tp=null,Oi!==null){for(m=0;m<Oi.length;m++)if(S=Oi[m],E=S.interleaved,E!==null){S.interleaved=null;var _=E.next,N=S.pending;if(N!==null){var ae=N.next;N.next=_,E.next=ae}S.pending=E}Oi=null}return C}function KN(C,m){do{var S=Ni;try{if(Pf(),rb.current=gb,sb){for(var E=pi.memoizedState;E!==null;){var _=E.queue;_!==null&&(_.pending=null),E=E.next}sb=!1}if($f=0,lr=Yr=pi=null,xp=!1,Sp=0,vS.current=null,S===null||S.return===null){Ji=1,Vp=m,Ni=null;break}e:{var N=C,ae=S.return,Ie=S,Ne=m;if(m=Br,Ie.flags|=32768,Ne!==null&&typeof Ne=="object"&&typeof Ne.then=="function"){var je=Ne,lt=Ie,Ft=lt.tag;if(!(lt.mode&1)&&(Ft===0||Ft===11||Ft===15)){var Gt=lt.alternate;Gt?(lt.updateQueue=Gt.updateQueue,lt.memoizedState=Gt.memoizedState,lt.lanes=Gt.lanes):(lt.updateQueue=null,lt.memoizedState=null)}var _n=uN(ae);if(_n!==null){_n.flags&=-257,dN(_n,ae,Ie,N,m),_n.mode&1&&gN(N,je,m),m=_n,Ne=je;var vt=m.updateQueue;if(vt===null){var Pr=new Set;Pr.add(Ne),m.updateQueue=Pr}else vt.add(Ne);break e}else{if(!(m&1)){gN(N,je,m),MS();break e}Ne=Error(o(426))}}else if(si&&Ie.mode&1){var Ca=uN(ae);if(Ca!==null){!(Ca.flags&65536)&&(Ca.flags|=256),dN(Ca,ae,Ie,N,m),Ox(Ne);break e}}N=Ne,Ji!==4&&(Ji=2),Tp===null?Tp=[N]:Tp.push(N),Ne=oS(Ne,Ie),Ie=ae;do{switch(Ie.tag){case 3:Ie.flags|=65536,m&=-m,Ie.lanes|=m;var Ze=lN(Ie,Ne,m);M5(Ie,Ze);break e;case 1:N=Ne;var Ae=Ie.type,_e=Ie.stateNode;if(!(Ie.flags&128)&&(typeof Ae.getDerivedStateFromError=="function"||_e!==null&&typeof _e.componentDidCatch=="function"&&(uu===null||!uu.has(_e)))){Ie.flags|=65536,m&=-m,Ie.lanes|=m;var rt=cN(Ie,N,m);M5(Ie,rt);break e}}Ie=Ie.return}while(Ie!==null)}UN(S)}catch(It){m=It,Ni===S&&S!==null&&(Ni=S=S.return);continue}break}while(1)}function DN(){var C=Gb.current;return Gb.current=gb,C===null?gb:C}function MS(){(Ji===0||Ji===3||Ji===2)&&(Ji=4),Ti===null||!(tI&268435455)&&!(wb&268435455)||fu(Ti,Br)}function Wb(C,m){var S=Kt;Kt|=2;var E=DN();Ti===C&&Br===m||Dd(C,m);do try{ste();break}catch(_){KN(C,_)}while(1);if(Pf(),Kt=S,Gb.current=E,Ni!==null)throw Error(o(261));return Ti=null,Br=0,Ji}function ste(){for(;Ni!==null;)PN(Ni)}function ote(){for(;Ni!==null&&!Ap();)PN(Ni)}function PN(C){var m=JN(C.alternate,C,No);C.memoizedProps=C.pendingProps,m===null?UN(C):Ni=m,vS.current=null}function UN(C){var m=C;do{var S=m.alternate;if(C=m.return,m.flags&32768){if(S=qee(S,m),S!==null){S.flags&=32767,Ni=S;return}if(C!==null)C.flags|=32768,C.subtreeFlags=0,C.deletions=null;else{Ji=6,Ni=null;return}}else if(S=Oee(S,m,No),S!==null){Ni=S;return}if(m=m.sibling,m!==null){Ni=m;return}Ni=m=C}while(m!==null);Ji===0&&(Ji=5)}function Pd(C,m){var S=Ut,E=Si.transition;try{Si.transition=null,Ut=1,ate(C,m,S)}finally{Si.transition=E,Ut=S}return null}function ate(C,m,S){do Ud();while(du!==null);if(Kt&6)throw Error(o(327));var E=C.finishedWork,_=C.finishedLanes;if(E===null)return null;if(C.finishedWork=null,C.finishedLanes=0,E===C.current)throw Error(o(177));C.callbackNode=null,C.callbackPriority=0;var N=E.lanes|E.childLanes;if(ou(C,N),C===Ti&&(Ni=Ti=null,Br=0),!(E.subtreeFlags&2064)&&!(E.flags&2064)||Sb||(Sb=!0,jN(bs,function(){return Ud(),null})),N=(E.flags&15990)!==0,E.subtreeFlags&15990||N){N=Si.transition,Si.transition=null;var ae=Ut;Ut=1;var Ie=Kt;Kt|=4,vS.current=null,ete(C,E),tte(C,E),K(C.containerInfo),C.current=E,nte(E),Qv(),Kt=Ie,Ut=ae,Si.transition=N}else C.current=E;if(Sb&&(Sb=!1,du=C,Rb=_),N=C.pendingLanes,N===0&&(uu=null),pp(E.stateNode),js(C,ri()),m!==null)for(S=C.onRecoverableError,E=0;E<m.length;E++)S(m[E]);if(xb)throw xb=!1,C=wS,wS=null,C;return Rb&1&&C.tag!==0&&Ud(),N=C.pendingLanes,N&1?C===xS?Np++:(Np=0,xS=C):Np=0,Os(),null}function Ud(){if(du!==null){var C=Ip(Rb),m=Si.transition,S=Ut;try{if(Si.transition=null,Ut=16>C?16:C,du===null)var E=!1;else{if(C=du,du=null,Rb=0,Kt&6)throw Error(o(331));var _=Kt;for(Kt|=4,it=C.current;it!==null;){var N=it,ae=N.child;if(it.flags&16){var Ie=N.deletions;if(Ie!==null){for(var Ne=0;Ne<Ie.length;Ne++){var je=Ie[Ne];for(it=je;it!==null;){var lt=it;switch(lt.tag){case 0:case 11:case 15:Kd(8,lt,N)}var Ft=lt.child;if(Ft!==null)Ft.return=lt,it=Ft;else for(;it!==null;){lt=it;var Gt=lt.sibling,_n=lt.return;if(EN(lt),lt===je){it=null;break}if(Gt!==null){Gt.return=_n,it=Gt;break}it=_n}}}var vt=N.alternate;if(vt!==null){var Pr=vt.child;if(Pr!==null){vt.child=null;do{var Ca=Pr.sibling;Pr.sibling=null,Pr=Ca}while(Pr!==null)}}it=N}}if(N.subtreeFlags&2064&&ae!==null)ae.return=N,it=ae;else e:for(;it!==null;){if(N=it,N.flags&2048)switch(N.tag){case 0:case 11:case 15:Kd(9,N,N.return)}var Ze=N.sibling;if(Ze!==null){Ze.return=N.return,it=Ze;break e}it=N.return}}var Ae=C.current;for(it=Ae;it!==null;){ae=it;var _e=ae.child;if(ae.subtreeFlags&2064&&_e!==null)_e.return=ae,it=_e;else e:for(ae=Ae;it!==null;){if(Ie=it,Ie.flags&2048)try{switch(Ie.tag){case 0:case 11:case 15:Fp(9,Ie)}}catch(It){qs(Ie,Ie.return,It)}if(Ie===ae){it=null;break e}var rt=Ie.sibling;if(rt!==null){rt.return=Ie.return,it=rt;break e}it=Ie.return}}if(Kt=_,Os(),Wo&&typeof Wo.onPostCommitFiberRoot=="function")try{Wo.onPostCommitFiberRoot(lu,C)}catch{}E=!0}return E}finally{Ut=S,Si.transition=m}}return!1}function QN(C,m,S){m=oS(S,m),m=lN(C,m,1),gu(C,m),m=ws(),C=Eb(C,1),C!==null&&(Nl(C,1,m),js(C,m))}function qs(C,m,S){if(C.tag===3)QN(C,C,S);else for(;m!==null;){if(m.tag===3){QN(m,C,S);break}else if(m.tag===1){var E=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof E.componentDidCatch=="function"&&(uu===null||!uu.has(E))){C=oS(S,C),C=cN(m,C,1),gu(m,C),C=ws(),m=Eb(m,1),m!==null&&(Nl(m,1,C),js(m,C));break}}m=m.return}}function lte(C,m,S){var E=C.pingCache;E!==null&&E.delete(m),m=ws(),C.pingedLanes|=C.suspendedLanes&S,Ti===C&&(Br&S)===S&&(Ji===4||Ji===3&&(Br&130023424)===Br&&500>ri()-BS?Dd(C,0):bS|=S),js(C,m)}function ON(C,m){m===0&&(C.mode&1?(m=Lc,Lc<<=1,!(Lc&130023424)&&(Lc=4194304)):m=1);var S=ws();C=Eb(C,m),C!==null&&(Nl(C,m,S),js(C,S))}function cte(C){var m=C.memoizedState,S=0;m!==null&&(S=m.retryLane),ON(C,S)}function gte(C,m){var S=0;switch(C.tag){case 13:var E=C.stateNode,_=C.memoizedState;_!==null&&(S=_.retryLane);break;case 19:E=C.stateNode;break;default:throw Error(o(314))}E!==null&&E.delete(m),ON(C,S)}var JN;JN=function(C,m,S){if(C!==null)if(C.memoizedProps!==m.pendingProps||Qi.current)To=!0;else{if(!(C.lanes&S)&&!(m.flags&128))return To=!1,jee(C,m,S);To=!!(C.flags&131072)}else To=!1,si&&m.flags&1048576&&T5(m,tb,m.index);switch(m.lanes=0,m.tag){case 2:var E=m.type;C!==null&&(C.alternate=null,m.alternate=null,m.flags|=2),C=m.pendingProps;var _=Vl(m,ii.current);ar(m,S),_=tS(null,m,E,C,_,S);var N=nS();return m.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(m.tag=1,m.memoizedState=null,m.updateQueue=null,xi(E)?(N=!0,Tl(m)):N=!1,m.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,Xx(m),_.updater=$v,m.stateNode=_,_._reactInternals=m,Kx(m,E,C,S),m=cS(null,m,E,!0,N,S)):(m.tag=0,si&&N&&Dx(m),Gs(null,m,_,S),m=m.child),m;case 16:E=m.elementType;e:{switch(C!==null&&(C.alternate=null,m.alternate=null,m.flags|=2),C=m.pendingProps,_=E._init,E=_(E._payload),m.type=E,_=m.tag=dte(E),C=Xr(E,C),_){case 0:m=lS(null,m,E,C,S);break e;case 1:m=yN(null,m,E,C,S);break e;case 11:m=IN(null,m,E,C,S);break e;case 14:m=AN(null,m,E,Xr(E.type,C),S);break e}throw Error(o(306,E,""))}return m;case 0:return E=m.type,_=m.pendingProps,_=m.elementType===E?_:Xr(E,_),lS(C,m,E,_,S);case 1:return E=m.type,_=m.pendingProps,_=m.elementType===E?_:Xr(E,_),yN(C,m,E,_,S);case 3:e:{if(vN(m),C===null)throw Error(o(387));E=m.pendingProps,N=m.memoizedState,_=N.element,Z5(C,m),qv(m,E,null,S);var ae=m.memoizedState;if(E=ae.element,le&&N.isDehydrated)if(N={element:E,isDehydrated:!1,cache:ae.cache,transitions:ae.transitions},m.updateQueue.baseState=N,m.memoizedState=N,m.flags&256){_=Error(o(423)),m=bN(C,m,E,S,_);break e}else if(E!==_){_=Error(o(424)),m=bN(C,m,E,S,_);break e}else for(le&&(Vo=Te(m.stateNode.containerInfo),_o=m,si=!0,qa=null,vp=!1),S=X5(m,null,E,S),m.child=S;S;)S.flags=S.flags&-3|4096,S=S.sibling;else{if(Of(),E===_){m=Uc(C,m,S);break e}Gs(C,m,E,S)}m=m.child}return m;case 5:return Y5(m),C===null&&Qx(m),E=m.type,_=m.pendingProps,N=C!==null?C.memoizedProps:null,ae=_.children,$(E,_)?ae=null:N!==null&&$(E,N)&&(m.flags|=32),mN(C,m),Gs(C,m,ae,S),m.child;case 6:return C===null&&Qx(m),null;case 13:return BN(C,m,S);case 4:return Jx(m,m.stateNode.containerInfo),E=m.pendingProps,C===null?m.child=Jf(m,null,E,S):Gs(C,m,E,S),m.child;case 11:return E=m.type,_=m.pendingProps,_=m.elementType===E?_:Xr(E,_),IN(C,m,E,_,S);case 7:return Gs(C,m,m.pendingProps,S),m.child;case 8:return Gs(C,m,m.pendingProps.children,S),m.child;case 12:return Gs(C,m,m.pendingProps.children,S),m.child;case 10:e:{if(E=m.type._context,_=m.pendingProps,N=m.memoizedProps,ae=_.value,Jv(m,E,ae),N!==null)if(Fo(N.value,ae)){if(N.children===_.children&&!Qi.current){m=Uc(C,m,S);break e}}else for(N=m.child,N!==null&&(N.return=m);N!==null;){var Ie=N.dependencies;if(Ie!==null){ae=N.child;for(var Ne=Ie.firstContext;Ne!==null;){if(Ne.context===E){if(N.tag===1){Ne=Yc(-1,S&-S),Ne.tag=2;var je=N.updateQueue;if(je!==null){je=je.shared;var lt=je.pending;lt===null?Ne.next=Ne:(Ne.next=lt.next,lt.next=Ne),je.pending=Ne}}N.lanes|=S,Ne=N.alternate,Ne!==null&&(Ne.lanes|=S),Vi(N.return,S,m),Ie.lanes|=S;break}Ne=Ne.next}}else if(N.tag===10)ae=N.type===m.type?null:N.child;else if(N.tag===18){if(ae=N.return,ae===null)throw Error(o(341));ae.lanes|=S,Ie=ae.alternate,Ie!==null&&(Ie.lanes|=S),Vi(ae,S,m),ae=N.sibling}else ae=N.child;if(ae!==null)ae.return=N;else for(ae=N;ae!==null;){if(ae===m){ae=null;break}if(N=ae.sibling,N!==null){N.return=ae.return,ae=N;break}ae=ae.return}N=ae}Gs(C,m,_.children,S),m=m.child}return m;case 9:return _=m.type,E=m.pendingProps.children,ar(m,S),_=Fn(_),E=E(_),m.flags|=1,Gs(C,m,E,S),m.child;case 14:return E=m.type,_=Xr(E,m.pendingProps),_=Xr(E.type,_),AN(C,m,E,_,S);case 15:return CN(C,m,m.type,m.pendingProps,S);case 17:return E=m.type,_=m.pendingProps,_=m.elementType===E?_:Xr(E,_),C!==null&&(C.alternate=null,m.alternate=null,m.flags|=2),m.tag=1,xi(E)?(C=!0,Tl(m)):C=!1,ar(m,S),_5(m,E,_),Kx(m,E,_,S),cS(null,m,E,!0,C,S);case 19:return SN(C,m,S);case 22:return pN(C,m,S)}throw Error(o(156,m.tag))};function jN(C,m){return Xc(C,m)}function ute(C,m,S,E){this.tag=C,this.key=S,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=E,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Aa(C,m,S,E){return new ute(C,m,S,E)}function ES(C){return C=C.prototype,!(!C||!C.isReactComponent)}function dte(C){if(typeof C=="function")return ES(C)?1:0;if(C!=null){if(C=C.$$typeof,C===I)return 11;if(C===y)return 14}return 2}function Iu(C,m){var S=C.alternate;return S===null?(S=Aa(C.tag,m,C.key,C.mode),S.elementType=C.elementType,S.type=C.type,S.stateNode=C.stateNode,S.alternate=C,C.alternate=S):(S.pendingProps=m,S.type=C.type,S.flags=0,S.subtreeFlags=0,S.deletions=null),S.flags=C.flags&14680064,S.childLanes=C.childLanes,S.lanes=C.lanes,S.child=C.child,S.memoizedProps=C.memoizedProps,S.memoizedState=C.memoizedState,S.updateQueue=C.updateQueue,m=C.dependencies,S.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},S.sibling=C.sibling,S.index=C.index,S.ref=C.ref,S}function Fb(C,m,S,E,_,N){var ae=2;if(E=C,typeof C=="function")ES(C)&&(ae=1);else if(typeof C=="string")ae=5;else e:switch(C){case g:return Qd(S.children,_,N,m);case u:ae=8,_|=8;break;case d:return C=Aa(12,S,m,_|2),C.elementType=d,C.lanes=N,C;case A:return C=Aa(13,S,m,_),C.elementType=A,C.lanes=N,C;case p:return C=Aa(19,S,m,_),C.elementType=p,C.lanes=N,C;case b:return _b(S,_,N,m);default:if(typeof C=="object"&&C!==null)switch(C.$$typeof){case h:ae=10;break e;case f:ae=9;break e;case I:ae=11;break e;case y:ae=14;break e;case v:ae=16,E=null;break e}throw Error(o(130,C==null?C:typeof C,""))}return m=Aa(ae,S,m,_),m.elementType=C,m.type=E,m.lanes=N,m}function Qd(C,m,S,E){return C=Aa(7,C,E,m),C.lanes=S,C}function _b(C,m,S,E){return C=Aa(22,C,E,m),C.elementType=b,C.lanes=S,C.stateNode={},C}function WS(C,m,S){return C=Aa(6,C,null,m),C.lanes=S,C}function FS(C,m,S){return m=Aa(4,C.children!==null?C.children:[],C.key,m),m.lanes=S,m.stateNode={containerInfo:C.containerInfo,pendingChildren:null,implementation:C.implementation},m}function hte(C,m,S,E,_){this.tag=m,this.containerInfo=C,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=k,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Xf(0),this.expirationTimes=Xf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Xf(0),this.identifierPrefix=E,this.onRecoverableError=_,le&&(this.mutableSourceEagerHydrationData=null)}function qN(C,m,S,E,_,N,ae,Ie,Ne){return C=new hte(C,m,S,Ie,Ne),m===1?(m=1,N===!0&&(m|=8)):m=0,N=Aa(3,null,null,m),C.current=N,N.stateNode=C,N.memoizedState={element:E,isDehydrated:S,cache:null,transitions:null},Xx(N),C}function $N(C){if(!C)return Jn;C=C._reactInternals;e:{if(R(C)!==C||C.tag!==1)throw Error(o(170));var m=C;do{switch(m.tag){case 3:m=m.stateNode.context;break e;case 1:if(xi(m.type)){m=m.stateNode.__reactInternalMemoizedMergedChildContext;break e}}m=m.return}while(m!==null);throw Error(o(171))}if(C.tag===1){var S=C.type;if(xi(S))return Hf(C,S,m)}return m}function ek(C){var m=C._reactInternals;if(m===void 0)throw typeof C.render=="function"?Error(o(188)):(C=Object.keys(C).join(","),Error(o(268,C)));return C=F(m),C===null?null:C.stateNode}function tk(C,m){if(C=C.memoizedState,C!==null&&C.dehydrated!==null){var S=C.retryLane;C.retryLane=S!==0&&S<m?S:m}}function _S(C,m){tk(C,m),(C=C.alternate)&&tk(C,m)}function fte(C){return C=F(C),C===null?null:C.stateNode}function Ite(){return null}return t.attemptContinuousHydration=function(C){if(C.tag===13){var m=ws();Ia(C,134217728,m),_S(C,134217728)}},t.attemptHydrationAtCurrentPriority=function(C){if(C.tag===13){var m=ws(),S=hu(C);Ia(C,S,m),_S(C,S)}},t.attemptSynchronousHydration=function(C){switch(C.tag){case 3:var m=C.stateNode;if(m.current.memoizedState.isDehydrated){var S=Hc(m.pendingLanes);S!==0&&(kl(m,S|1),js(m,ri()),!(Kt&6)&&(nI(),Os()))}break;case 13:var E=ws();YN(function(){return Ia(C,1,E)}),_S(C,1)}},t.batchedUpdates=function(C,m){var S=Kt;Kt|=1;try{return C(m)}finally{Kt=S,Kt===0&&(nI(),Ll&&Os())}},t.createComponentSelector=function(C){return{$$typeof:mb,value:C}},t.createContainer=function(C,m,S,E,_,N,ae){return qN(C,m,!1,null,S,E,_,N,ae)},t.createHasPseudoClassSelector=function(C){return{$$typeof:yb,value:C}},t.createHydrationContainer=function(C,m,S,E,_,N,ae,Ie,Ne){return C=qN(S,E,!0,C,_,N,ae,Ie,Ne),C.context=$N(null),S=C.current,E=ws(),_=hu(S),N=Yc(E,_),N.callback=m??null,gu(S,N),C.current.lanes=_,Nl(C,_,E),js(C,E),C},t.createPortal=function(C,m,S){var E=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:E==null?null:""+E,children:C,containerInfo:m,implementation:S}},t.createRoleSelector=function(C){return{$$typeof:vb,value:C}},t.createTestNameSelector=function(C){return{$$typeof:bb,value:C}},t.createTextSelector=function(C){return{$$typeof:Bb,value:C}},t.deferredUpdates=function(C){var m=Ut,S=Si.transition;try{return Si.transition=null,Ut=16,C()}finally{Ut=m,Si.transition=S}},t.discreteUpdates=function(C,m,S,E,_){var N=Ut,ae=Si.transition;try{return Si.transition=null,Ut=1,C(m,S,E,_)}finally{Ut=N,Si.transition=ae,Kt===0&&nI()}},t.findAllNodes=yS,t.findBoundingRects=function(C,m){if(!He)throw Error(o(363));m=yS(C,m),C=[];for(var S=0;S<m.length;S++)C.push(j(m[S]));for(m=C.length-1;0<m;m--){S=C[m];for(var E=S.x,_=E+S.width,N=S.y,ae=N+S.height,Ie=m-1;0<=Ie;Ie--)if(m!==Ie){var Ne=C[Ie],je=Ne.x,lt=je+Ne.width,Ft=Ne.y,Gt=Ft+Ne.height;if(E>=je&&N>=Ft&&_<=lt&&ae<=Gt){C.splice(m,1);break}else if(E!==je||S.width!==Ne.width||Gt<N||Ft>ae){if(!(N!==Ft||S.height!==Ne.height||lt<E||je>_)){je>E&&(Ne.width+=je-E,Ne.x=E),lt<_&&(Ne.width=_-je),C.splice(m,1);break}}else{Ft>N&&(Ne.height+=Ft-N,Ne.y=N),Gt<ae&&(Ne.height=ae-Ft),C.splice(m,1);break}}}return C},t.findHostInstance=ek,t.findHostInstanceWithNoPortals=function(C){return C=W(C),C=C!==null?V(C):null,C===null?null:C.stateNode},t.findHostInstanceWithWarning=function(C){return ek(C)},t.flushControlled=function(C){var m=Kt;Kt|=1;var S=Si.transition,E=Ut;try{Si.transition=null,Ut=1,C()}finally{Ut=E,Si.transition=S,Kt=m,Kt===0&&(nI(),Os())}},t.flushPassiveEffects=Ud,t.flushSync=YN,t.focusWithin=function(C,m){if(!He)throw Error(o(363));for(C=CS(C),m=HN(C,m),m=Array.from(m),C=0;C<m.length;){var S=m[C++];if(!ce(S)){if(S.tag===5&&Ge(S.stateNode))return!0;for(S=S.child;S!==null;)m.push(S),S=S.sibling}}return!1},t.getCurrentUpdatePriority=function(){return Ut},t.getFindAllNodesFailureDescription=function(C,m){if(!He)throw Error(o(363));var S=0,E=[];C=[CS(C),0];for(var _=0;_<C.length;){var N=C[_++],ae=C[_++],Ie=m[ae];if((N.tag!==5||!ce(N))&&(pS(N,Ie)&&(E.push(mS(Ie)),ae++,ae>S&&(S=ae)),ae<m.length))for(N=N.child;N!==null;)C.push(N,ae),N=N.sibling}if(S<m.length){for(C=[];S<m.length;S++)C.push(mS(m[S]));return`findAllNodes was able to match part of the selector:
  `+(E.join(" > ")+`

No matching component was found for:
  `)+C.join(" > ")}return null},t.getPublicRootInstance=function(C){if(C=C.current,!C.child)return null;switch(C.child.tag){case 5:return U(C.child.stateNode);default:return C.child.stateNode}},t.injectIntoDevTools=function(C){if(C={bundleType:C.bundleType,version:C.version,rendererPackageName:C.rendererPackageName,rendererConfig:C.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:a.ReactCurrentDispatcher,findHostInstanceByFiber:fte,findFiberByHostInstance:C.findFiberByHostInstance||Ite,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")C=!1;else{var m=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(m.isDisabled||!m.supportsFiber)C=!0;else{try{lu=m.inject(C),Wo=m}catch{}C=!!m.checkDCE}}return C},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(C,m,S,E){if(!He)throw Error(o(363));C=yS(C,m);var _=me(C,S,E).disconnect;return{disconnect:function(){_()}}},t.registerMutableSourceForHydration=function(C,m){var S=m._getVersion;S=S(m._source),C.mutableSourceEagerHydrationData==null?C.mutableSourceEagerHydrationData=[m,S]:C.mutableSourceEagerHydrationData.push(m,S)},t.runWithPriority=function(C,m){var S=Ut;try{return Ut=C,m()}finally{Ut=S}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(C,m,S,E){var _=m.current,N=ws(),ae=hu(_);return S=$N(S),m.context===null?m.context=S:m.pendingContext=S,m=Yc(N,ae),m.payload={element:C},E=E===void 0?null:E,E!==null&&(m.callback=E),gu(_,m),C=Ia(_,ae,N),C!==null&&jv(C,_,ae),ae},t};k4.exports=Hue;var zue=k4.exports;const Xue=Ks(zue);function z4(n,e,t=(i,r)=>i===r){if(n===e)return!0;if(!n||!e)return!1;const i=n.length;if(e.length!==i)return!1;for(let r=0;r<i;r++)if(!t(n[r],e[r]))return!1;return!0}const Bg=[];function X4(n,e,t=!1,i={}){for(const s of Bg)if(z4(e,s.keys,s.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return s.response;if(!t)throw s.promise}const r={keys:e,equal:i.equal,promise:n(...e).then(s=>r.response=s).then(()=>{i.lifespan&&i.lifespan>0&&setTimeout(()=>{const s=Bg.indexOf(r);s!==-1&&Bg.splice(s,1)},i.lifespan)}).catch(s=>r.error=s)};if(Bg.push(r),!t)throw r.promise}const vV=(n,e,t)=>X4(n,e,!1,t),Y4=(n,e,t)=>void X4(n,e,!0,t),K4=n=>{if(n===void 0||n.length===0)Bg.splice(0,Bg.length);else{const e=Bg.find(t=>z4(n,t.keys,t.equal));if(e){const t=Bg.indexOf(e);t!==-1&&Bg.splice(t,1)}}},bV={},Zd=n=>void Object.assign(bV,n);function Yue(n,e){function t(g,{args:u=[],attach:d,...h},f){let I=`${g[0].toUpperCase()}${g.slice(1)}`,A;if(g==="primitive"){if(h.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const p=h.object;A=qI(p,{type:g,root:f,attach:d,primitive:!0})}else{const p=bV[I];if(!p)throw new Error(`R3F: ${I} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(u))throw new Error("R3F: The args prop must be an array!");A=qI(new p(...u),{type:g,root:f,attach:d,memoizedProps:{args:u}})}return A.__r3f.attach===void 0&&(A instanceof Et?A.__r3f.attach="geometry":A instanceof ai&&(A.__r3f.attach="material")),I!=="inject"&&zR(A,h),A}function i(g,u){let d=!1;if(u){var h,f;(h=u.__r3f)!=null&&h.attach?HR(g,u,u.__r3f.attach):u.isObject3D&&g.isObject3D&&(g.add(u),d=!0),d||(f=g.__r3f)==null||f.objects.push(u),u.__r3f||qI(u,{}),u.__r3f.parent=g,x3(u),$I(u)}}function r(g,u,d){let h=!1;if(u){var f,I;if((f=u.__r3f)!=null&&f.attach)HR(g,u,u.__r3f.attach);else if(u.isObject3D&&g.isObject3D){u.parent=g,u.dispatchEvent({type:"added"});const A=g.children.filter(y=>y!==u),p=A.indexOf(d);g.children=[...A.slice(0,p),u,...A.slice(p)],h=!0}h||(I=g.__r3f)==null||I.objects.push(u),u.__r3f||qI(u,{}),u.__r3f.parent=g,x3(u),$I(u)}}function s(g,u,d=!1){g&&[...g].forEach(h=>o(u,h,d))}function o(g,u,d){if(u){var h,f,I;if(u.__r3f&&(u.__r3f.parent=null),(h=g.__r3f)!=null&&h.objects&&(g.__r3f.objects=g.__r3f.objects.filter(b=>b!==u)),(f=u.__r3f)!=null&&f.attach)NL(g,u,u.__r3f.attach);else if(u.isObject3D&&g.isObject3D){var A;g.remove(u),(A=u.__r3f)!=null&&A.root&&Jue(u.__r3f.root,u)}const y=(I=u.__r3f)==null?void 0:I.primitive,v=d===void 0?u.dispose!==null&&!y:d;if(!y){var p;s((p=u.__r3f)==null?void 0:p.objects,u,v),s(u.children,u,v)}u.__r3f&&(delete u.__r3f.root,delete u.__r3f.objects,delete u.__r3f.handlers,delete u.__r3f.memoizedProps,y||delete u.__r3f),v&&u.dispose&&u.type!=="Scene"&&G3.unstable_scheduleCallback(G3.unstable_IdlePriority,()=>{try{u.dispose()}catch{}}),$I(g)}}function a(g,u,d,h){var f;const I=(f=g.__r3f)==null?void 0:f.parent;if(!I)return;const A=t(u,d,g.__r3f.root);if(g.children){for(const p of g.children)p.__r3f&&i(A,p);g.children=g.children.filter(p=>!p.__r3f)}g.__r3f.objects.forEach(p=>i(A,p)),g.__r3f.objects=[],g.__r3f.autoRemovedBeforeAppend||o(I,g),A.parent&&(A.__r3f.autoRemovedBeforeAppend=!0),i(I,A),A.raycast&&A.__r3f.eventCount&&A.__r3f.root.getState().internal.interaction.push(A),[h,h.alternate].forEach(p=>{p!==null&&(p.stateNode=A,p.ref&&(typeof p.ref=="function"?p.ref(A):p.ref.current=A))})}const l=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:Xue({createInstance:t,removeChild:o,appendChild:i,appendInitialChild:i,insertBefore:r,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(g,u)=>{if(!u)return;const d=g.getState().scene;d.__r3f&&(d.__r3f.root=g,i(d,u))},removeChildFromContainer:(g,u)=>{u&&o(g.getState().scene,u)},insertInContainerBefore:(g,u,d)=>{if(!u||!d)return;const h=g.getState().scene;h.__r3f&&r(h,u,d)},getRootHostContext:()=>null,getChildHostContext:g=>g,finalizeInitialChildren(g){var u;return!!((u=g==null?void 0:g.__r3f)!=null?u:{}).handlers},prepareUpdate(g,u,d,h){if(g.__r3f.primitive&&h.object&&h.object!==g)return[!0];{const{args:f=[],children:I,...A}=h,{args:p=[],children:y,...v}=d;if(!Array.isArray(f))throw new Error("R3F: the args prop must be an array!");if(f.some((w,G)=>w!==p[G]))return[!0];const b=j4(g,A,v,!0);return b.changes.length?[!1,b]:null}},commitUpdate(g,[u,d],h,f,I,A){u?a(g,h,I,A):zR(g,d)},commitMount(g,u,d,h){var f;const I=(f=g.__r3f)!=null?f:{};g.raycast&&I.handlers&&I.eventCount&&g.__r3f.root.getState().internal.interaction.push(g)},getPublicInstance:g=>g,prepareForCommit:()=>null,preparePortalMount:g=>qI(g.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(g){var u;const{attach:d,parent:h}=(u=g.__r3f)!=null?u:{};d&&h&&NL(h,g,d),g.isObject3D&&(g.visible=!1),$I(g)},unhideInstance(g,u){var d;const{attach:h,parent:f}=(d=g.__r3f)!=null?d:{};h&&f&&HR(f,g,h),(g.isObject3D&&u.visible==null||u.visible)&&(g.visible=!0),$I(g)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>e?e():CA.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&qn.fun(performance.now)?performance.now:qn.fun(Date.now)?Date.now:()=>0,scheduleTimeout:qn.fun(setTimeout)?setTimeout:void 0,cancelTimeout:qn.fun(clearTimeout)?clearTimeout:void 0}),applyProps:zR}}var FL,_L;const D4=()=>{var n;return(n=bV.ColorManagement)!=null?n:null},P4=n=>n&&n.isOrthographicCamera,Kue=n=>n&&n.hasOwnProperty("current"),zC=typeof window<"u"&&((FL=window.document)!=null&&FL.createElement||((_L=window.navigator)==null?void 0:_L.product)==="ReactNative")?M.useLayoutEffect:M.useEffect;function U4(n){const e=M.useRef(n);return zC(()=>void(e.current=n),[n]),e}function Due({set:n}){return zC(()=>(n(new Promise(()=>null)),()=>n(!1)),[n]),null}class Q4 extends M.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}Q4.getDerivedStateFromError=()=>({error:!0});const O4="__default",VL=new Map,Pue=n=>n&&!!n.memoized&&!!n.changes;function J4(n){const e=typeof window<"u"?window.devicePixelRatio:1;return Array.isArray(n)?Math.min(Math.max(n[0],e),n[1]):n}const rm=n=>{var e;return(e=n.__r3f)==null?void 0:e.root.getState()},qn={obj:n=>n===Object(n)&&!qn.arr(n)&&typeof n!="function",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",boo:n=>typeof n=="boolean",und:n=>n===void 0,arr:n=>Array.isArray(n),equ(n,e,{arrays:t="shallow",objects:i="reference",strict:r=!0}={}){if(typeof n!=typeof e||!!n!=!!e)return!1;if(qn.str(n)||qn.num(n))return n===e;const s=qn.obj(n);if(s&&i==="reference")return n===e;const o=qn.arr(n);if(o&&t==="reference")return n===e;if((o||s)&&n===e)return!0;let a;for(a in n)if(!(a in e))return!1;if(s&&t==="shallow"&&i==="shallow"){for(a in r?e:n)if(!qn.equ(n[a],e[a],{strict:r,objects:"reference"}))return!1}else for(a in r?e:n)if(n[a]!==e[a])return!1;if(qn.und(a)){if(o&&n.length===0&&e.length===0||s&&Object.keys(n).length===0&&Object.keys(e).length===0)return!0;if(n!==e)return!1}return!0}};function Uue(n){const e={nodes:{},materials:{}};return n&&n.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material)}),e}function Que(n){n.dispose&&n.type!=="Scene"&&n.dispose();for(const e in n)e.dispose==null||e.dispose(),delete n[e]}function qI(n,e){const t=n;return(e!=null&&e.primitive||!t.__r3f)&&(t.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e}),n}function w3(n,e){let t=n;if(e.includes("-")){const i=e.split("-"),r=i.pop();return t=i.reduce((s,o)=>s[o],n),{target:t,key:r}}else return{target:t,key:e}}const TL=/-\d+$/;function HR(n,e,t){if(qn.str(t)){if(TL.test(t)){const s=t.replace(TL,""),{target:o,key:a}=w3(n,s);Array.isArray(o[a])||(o[a]=[])}const{target:i,key:r}=w3(n,t);e.__r3f.previousAttach=i[r],i[r]=e}else e.__r3f.previousAttach=t(n,e)}function NL(n,e,t){var i,r;if(qn.str(t)){const{target:s,key:o}=w3(n,t),a=e.__r3f.previousAttach;a===void 0?delete s[o]:s[o]=a}else(i=e.__r3f)==null||i.previousAttach==null||i.previousAttach(n,e);(r=e.__r3f)==null||delete r.previousAttach}function j4(n,{children:e,key:t,ref:i,...r},{children:s,key:o,ref:a,...l}={},c=!1){var g;const u=(g=n==null?void 0:n.__r3f)!=null?g:{},d=Object.entries(r),h=[];if(c){const I=Object.keys(l);for(let A=0;A<I.length;A++)r.hasOwnProperty(I[A])||d.unshift([I[A],O4+"remove"])}d.forEach(([I,A])=>{var p;if((p=n.__r3f)!=null&&p.primitive&&I==="object"||qn.equ(A,l[I]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(I))return h.push([I,A,!0,[]]);let y=[];I.includes("-")&&(y=I.split("-")),h.push([I,A,!1,y]);for(const v in r){const b=r[v];v.startsWith(`${I}-`)&&h.push([v,b,!1,v.split("-")])}});const f={...r};return u.memoizedProps&&u.memoizedProps.args&&(f.args=u.memoizedProps.args),u.memoizedProps&&u.memoizedProps.attach&&(f.attach=u.memoizedProps.attach),{memoized:f,changes:h}}function zR(n,e){var t,i,r;const s=(t=n.__r3f)!=null?t:{},o=s.root,a=(i=o==null||o.getState==null?void 0:o.getState())!=null?i:{},{memoized:l,changes:c}=Pue(e)?e:j4(n,e),g=s.eventCount;n.__r3f&&(n.__r3f.memoizedProps=l);for(let d=0;d<c.length;d++){let[h,f,I,A]=c[d],p=n,y=p[h];if(A.length&&(y=A.reduce((v,b)=>v[b],n),!(y&&y.set))){const[v,...b]=A.reverse();p=b.reverse().reduce((w,G)=>w[G],n),h=v}if(f===O4+"remove")if(p.constructor){let v=VL.get(p.constructor);v||(v=new p.constructor,VL.set(p.constructor,v)),f=v[h]}else f=0;if(I)f?s.handlers[h]=f:delete s.handlers[h],s.eventCount=Object.keys(s.handlers).length;else if(y&&y.set&&(y.copy||y instanceof Jh)){if(Array.isArray(f))y.fromArray?y.fromArray(f):y.set(...f);else if(y.copy&&f&&f.constructor&&y.constructor===f.constructor)y.copy(f);else if(f!==void 0){const v=y instanceof Ke;!v&&y.setScalar?y.setScalar(f):y instanceof Jh&&f instanceof Jh?y.mask=f.mask:y.set(f),!D4()&&!a.linear&&v&&y.convertSRGBToLinear()}}else p[h]=f,!a.linear&&p[h]instanceof Pn&&p[h].format===Yn&&p[h].type===Dn&&(p[h].encoding=Xt);$I(n)}if(s.parent&&a.internal&&n.raycast&&g!==s.eventCount){const d=a.internal.interaction.indexOf(n);d>-1&&a.internal.interaction.splice(d,1),s.eventCount&&a.internal.interaction.push(n)}return!(c.length===1&&c[0][0]==="onUpdate")&&c.length&&(r=n.__r3f)!=null&&r.parent&&x3(n),n}function $I(n){var e,t;const i=(e=n.__r3f)==null||(t=e.root)==null||t.getState==null?void 0:t.getState();i&&i.internal.frames===0&&i.invalidate()}function x3(n){n.onUpdate==null||n.onUpdate(n)}function q4(n,e){n.manual||(P4(n)?(n.left=e.width/-2,n.right=e.width/2,n.top=e.height/2,n.bottom=e.height/-2):n.aspect=e.width/e.height,n.updateProjectionMatrix(),n.updateMatrixWorld())}function NB(n){return(n.eventObject||n.object).uuid+"/"+n.index+n.instanceId}function Oue(){var n;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return CA.DefaultEventPriority;switch((n=e.event)==null?void 0:n.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return CA.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return CA.ContinuousEventPriority;default:return CA.DefaultEventPriority}}function $4(n,e,t,i){const r=t.get(e);r&&(t.delete(e),t.size===0&&(n.delete(i),r.target.releasePointerCapture(i)))}function Jue(n,e){const{internal:t}=n.getState();t.interaction=t.interaction.filter(i=>i!==e),t.initialHits=t.initialHits.filter(i=>i!==e),t.hovered.forEach((i,r)=>{(i.eventObject===e||i.object===e)&&t.hovered.delete(r)}),t.capturedMap.forEach((i,r)=>{$4(t.capturedMap,e,i,r)})}function jue(n){function e(l){const{internal:c}=n.getState(),g=l.offsetX-c.initialClick[0],u=l.offsetY-c.initialClick[1];return Math.round(Math.sqrt(g*g+u*u))}function t(l){return l.filter(c=>["Move","Over","Enter","Out","Leave"].some(g=>{var u;return(u=c.__r3f)==null?void 0:u.handlers["onPointer"+g]}))}function i(l,c){const g=n.getState(),u=new Set,d=[],h=c?c(g.internal.interaction):g.internal.interaction;for(let p=0;p<h.length;p++){const y=rm(h[p]);y&&(y.raycaster.camera=void 0)}g.previousRoot||g.events.compute==null||g.events.compute(l,g);function f(p){const y=rm(p);if(!y||!y.events.enabled||y.raycaster.camera===null)return[];if(y.raycaster.camera===void 0){var v;y.events.compute==null||y.events.compute(l,y,(v=y.previousRoot)==null?void 0:v.getState()),y.raycaster.camera===void 0&&(y.raycaster.camera=null)}return y.raycaster.camera?y.raycaster.intersectObject(p,!0):[]}let I=h.flatMap(f).sort((p,y)=>{const v=rm(p.object),b=rm(y.object);return!v||!b?p.distance-y.distance:b.events.priority-v.events.priority||p.distance-y.distance}).filter(p=>{const y=NB(p);return u.has(y)?!1:(u.add(y),!0)});g.events.filter&&(I=g.events.filter(I,g));for(const p of I){let y=p.object;for(;y;){var A;(A=y.__r3f)!=null&&A.eventCount&&d.push({...p,eventObject:y}),y=y.parent}}if("pointerId"in l&&g.internal.capturedMap.has(l.pointerId))for(let p of g.internal.capturedMap.get(l.pointerId).values())u.has(NB(p.intersection))||d.push(p.intersection);return d}function r(l,c,g,u){const d=n.getState();if(l.length){const h={stopped:!1};for(const f of l){const I=rm(f.object)||d,{raycaster:A,pointer:p,camera:y,internal:v}=I,b=new D(p.x,p.y,0).unproject(y),w=Z=>{var W,F;return(W=(F=v.capturedMap.get(Z))==null?void 0:F.has(f.eventObject))!=null?W:!1},G=Z=>{const W={intersection:f,target:c.target};v.capturedMap.has(Z)?v.capturedMap.get(Z).set(f.eventObject,W):v.capturedMap.set(Z,new Map([[f.eventObject,W]])),c.target.setPointerCapture(Z)},x=Z=>{const W=v.capturedMap.get(Z);W&&$4(v.capturedMap,f.eventObject,W,Z)};let B={};for(let Z in c){let W=c[Z];typeof W!="function"&&(B[Z]=W)}let R={...f,...B,pointer:p,intersections:l,stopped:h.stopped,delta:g,unprojectedPoint:b,ray:A.ray,camera:y,stopPropagation(){const Z="pointerId"in c&&v.capturedMap.get(c.pointerId);if((!Z||Z.has(f.eventObject))&&(R.stopped=h.stopped=!0,v.hovered.size&&Array.from(v.hovered.values()).find(W=>W.eventObject===f.eventObject))){const W=l.slice(0,l.indexOf(f));s([...W,f])}},target:{hasPointerCapture:w,setPointerCapture:G,releasePointerCapture:x},currentTarget:{hasPointerCapture:w,setPointerCapture:G,releasePointerCapture:x},nativeEvent:c};if(u(R),h.stopped===!0)break}}return l}function s(l){const{internal:c}=n.getState();for(const g of c.hovered.values())if(!l.length||!l.find(u=>u.object===g.object&&u.index===g.index&&u.instanceId===g.instanceId)){const d=g.eventObject.__r3f,h=d==null?void 0:d.handlers;if(c.hovered.delete(NB(g)),d!=null&&d.eventCount){const f={...g,intersections:l};h.onPointerOut==null||h.onPointerOut(f),h.onPointerLeave==null||h.onPointerLeave(f)}}}function o(l,c){for(let g=0;g<c.length;g++){const u=c[g].__r3f;u==null||u.handlers.onPointerMissed==null||u.handlers.onPointerMissed(l)}}function a(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return c=>{const{internal:g}=n.getState();"pointerId"in c&&g.capturedMap.has(c.pointerId)&&requestAnimationFrame(()=>{g.capturedMap.has(c.pointerId)&&(g.capturedMap.delete(c.pointerId),s([]))})}}return function(g){const{onPointerMissed:u,internal:d}=n.getState();d.lastEvent.current=g;const h=l==="onPointerMove",f=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",A=i(g,h?t:void 0),p=f?e(g):0;l==="onPointerDown"&&(d.initialClick=[g.offsetX,g.offsetY],d.initialHits=A.map(v=>v.eventObject)),f&&!A.length&&p<=2&&(o(g,d.interaction),u&&u(g)),h&&s(A);function y(v){const b=v.eventObject,w=b.__r3f,G=w==null?void 0:w.handlers;if(w!=null&&w.eventCount)if(h){if(G.onPointerOver||G.onPointerEnter||G.onPointerOut||G.onPointerLeave){const x=NB(v),B=d.hovered.get(x);B?B.stopped&&v.stopPropagation():(d.hovered.set(x,v),G.onPointerOver==null||G.onPointerOver(v),G.onPointerEnter==null||G.onPointerEnter(v))}G.onPointerMove==null||G.onPointerMove(v)}else{const x=G[l];x?(!f||d.initialHits.includes(b))&&(o(g,d.interaction.filter(B=>!d.initialHits.includes(B))),x(v)):f&&d.initialHits.includes(b)&&o(g,d.interaction.filter(B=>!d.initialHits.includes(B)))}}r(A,g,p,y)}}return{handlePointer:a}}const que=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],eJ=n=>!!(n!=null&&n.render),BV=M.createContext(null),$ue=(n,e)=>{const t=HC((a,l)=>{const c=new D,g=new D,u=new D;function d(p=l().camera,y=g,v=l().size){const{width:b,height:w,top:G,left:x}=v,B=b/w;y instanceof D?u.copy(y):u.set(...y);const R=p.getWorldPosition(c).distanceTo(u);if(P4(p))return{width:b/p.zoom,height:w/p.zoom,top:G,left:x,factor:1,distance:R,aspect:B};{const Z=p.fov*Math.PI/180,W=2*Math.tan(Z/2)*R,F=W*(b/w);return{width:F,height:W,top:G,left:x,factor:b/F,distance:R,aspect:B}}}let h;const f=p=>a(y=>({performance:{...y.performance,current:p}})),I=new pe;return{set:a,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(p=1)=>n(l(),p),advance:(p,y)=>e(p,y,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Kw,pointer:I,mouse:I,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const p=l();h&&clearTimeout(h),p.performance.current!==p.performance.min&&f(p.performance.min),h=setTimeout(()=>f(l().performance.max),p.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:d},setEvents:p=>a(y=>({...y,events:{...y.events,...p}})),setSize:(p,y,v,b,w)=>{const G=l().camera,x={width:p,height:y,top:b||0,left:w||0,updateStyle:v};a(B=>({size:x,viewport:{...B.viewport,...d(G,g,x)}}))},setDpr:p=>a(y=>{const v=J4(p);return{viewport:{...y.viewport,dpr:v,initialDpr:y.viewport.initialDpr||v}}}),setFrameloop:(p="always")=>{const y=l().clock;y.stop(),y.elapsedTime=0,p!=="never"&&(y.start(),y.elapsedTime=0),a(()=>({frameloop:p}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:M.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(p,y,v)=>{const b=l().internal;return b.priority=b.priority+(y>0?1:0),b.subscribers.push({ref:p,priority:y,store:v}),b.subscribers=b.subscribers.sort((w,G)=>w.priority-G.priority),()=>{const w=l().internal;w!=null&&w.subscribers&&(w.priority=w.priority-(y>0?1:0),w.subscribers=w.subscribers.filter(G=>G.ref!==p))}}}}}),i=t.getState();let r=i.size,s=i.viewport.dpr,o=i.camera;return t.subscribe(()=>{const{camera:a,size:l,viewport:c,gl:g,set:u}=t.getState();if(l!==r||c.dpr!==s){var d;r=l,s=c.dpr,q4(a,l),g.setPixelRatio(c.dpr);const h=(d=l.updateStyle)!=null?d:typeof HTMLCanvasElement<"u"&&g.domElement instanceof HTMLCanvasElement;g.setSize(l.width,l.height,h)}a!==o&&(o=a,u(h=>({viewport:{...h.viewport,...h.viewport.getCurrentViewport(a)}})))}),t.subscribe(a=>n(a)),t};function ede(n,e){const t={callback:n};return e.add(t),()=>void e.delete(t)}let kB,tJ=new Set,tde=new Set,nde=new Set;const ide=n=>ede(n,tJ);function XR(n,e){if(n.size)for(const{callback:t}of n.values())t(e)}function sm(n,e){switch(n){case"before":return XR(tJ,e);case"after":return XR(tde,e);case"tail":return XR(nde,e)}}let YR,KR;function DR(n,e,t){let i=e.clock.getDelta();for(e.frameloop==="never"&&typeof n=="number"&&(i=n-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=n),YR=e.internal.subscribers,kB=0;kB<YR.length;kB++)KR=YR[kB],KR.ref.current(KR.store.getState(),i,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function rde(n){let e=!1,t,i,r;function s(l){i=requestAnimationFrame(s),e=!0,t=0,sm("before",l);for(const g of n.values()){var c;r=g.store.getState(),r.internal.active&&(r.frameloop==="always"||r.internal.frames>0)&&!((c=r.gl.xr)!=null&&c.isPresenting)&&(t+=DR(l,r))}if(sm("after",l),t===0)return sm("tail",l),e=!1,cancelAnimationFrame(i)}function o(l,c=1){var g;if(!l)return n.forEach(u=>o(u.store.getState()),c);(g=l.gl.xr)!=null&&g.isPresenting||!l.internal.active||l.frameloop==="never"||(l.internal.frames=Math.min(60,l.internal.frames+c),e||(e=!0,requestAnimationFrame(s)))}function a(l,c=!0,g,u){if(c&&sm("before",l),g)DR(l,g,u);else for(const d of n.values())DR(l,d.store.getState());c&&sm("after",l)}return{loop:s,invalidate:o,advance:a}}function sde(n){const e=M.useRef(null);return zC(()=>void(e.current=n.current.__r3f),[n]),e}function GV(){const n=M.useContext(BV);if(!n)throw new Error("R3F: Hooks can only be used within the Canvas component!");return n}function Bt(n=t=>t,e){return GV()(n,e)}function yn(n,e=0){const t=GV(),i=t.getState().internal.subscribe,r=U4(n);return zC(()=>i(r,e,t),[e,i,t]),null}function nJ(n,e){return function(t,...i){const r=new t;return n&&n(r),Promise.all(i.map(s=>new Promise((o,a)=>r.load(s,l=>{l.scene&&Object.assign(l,Uue(l.scene)),o(l)},e,l=>a(new Error(`Could not load ${s}: ${l.message})`))))))}}function Ef(n,e,t,i){const r=Array.isArray(e)?e:[e],s=vV(nJ(t,i),[n,...r],{equal:qn.equ});return Array.isArray(e)?s:s[0]}Ef.preload=function(n,e,t){const i=Array.isArray(e)?e:[e];return Y4(nJ(t),[n,...i])};Ef.clear=function(n,e){const t=Array.isArray(e)?e:[e];return K4([n,...t])};const uC=new Map,{invalidate:kL,advance:LL}=rde(uC),{reconciler:xy,applyProps:Sh}=Yue(uC,Oue),vI={objects:"shallow",strict:!1},ode=(n,e)=>{const t=typeof n=="function"?n(e):n;return eJ(t)?t:new Vw({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...n})};function ade(n,e){if(e)return e;if(typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement&&n.parentElement){const{width:t,height:i,top:r,left:s}=n.parentElement.getBoundingClientRect();return{width:t,height:i,top:r,left:s}}else if(typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function lde(n){const e=uC.get(n),t=e==null?void 0:e.fiber,i=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const r=typeof reportError=="function"?reportError:console.error,s=i||$ue(kL,LL),o=t||xy.createContainer(s,CA.ConcurrentRoot,null,!1,null,"",r,null);e||uC.set(n,{fiber:o,store:s});let a,l=!1,c;return{configure(g={}){let{gl:u,size:d,scene:h,events:f,onCreated:I,shadows:A=!1,linear:p=!1,flat:y=!1,legacy:v=!1,orthographic:b=!1,frameloop:w="always",dpr:G=[1,2],performance:x,raycaster:B,camera:R,onPointerMissed:Z}=g,W=s.getState(),F=W.gl;W.gl||W.set({gl:F=ode(u,n)});let T=W.raycaster;T||W.set({raycaster:T=new mV});const{params:V,...z}=B||{};if(qn.equ(z,T,vI)||Sh(T,{...z}),qn.equ(V,T.params,vI)||Sh(T,{params:{...T.params,...V}}),!W.camera||W.camera===c&&!qn.equ(c,R,vI)){c=R;const Q=R instanceof _C,P=Q?R:b?new _c(0,0,0,0,.1,1e3):new zn(75,0,.1,1e3);Q||(P.position.z=5,R&&Sh(P,R),!W.camera&&!(R!=null&&R.rotation)&&P.lookAt(0,0,0)),W.set({camera:P})}if(!W.scene){let Q;h instanceof Cd?Q=h:(Q=new Cd,h&&Sh(Q,h)),W.set({scene:qI(Q)})}if(!W.xr){const Q=(oe,$)=>{const de=s.getState();de.frameloop!=="never"&&LL(oe,!0,de,$)},P=()=>{const oe=s.getState();oe.gl.xr.enabled=oe.gl.xr.isPresenting,oe.gl.xr.setAnimationLoop(oe.gl.xr.isPresenting?Q:null),oe.gl.xr.isPresenting||kL(oe)},ne={connect(){const oe=s.getState().gl;oe.xr.addEventListener("sessionstart",P),oe.xr.addEventListener("sessionend",P)},disconnect(){const oe=s.getState().gl;oe.xr.removeEventListener("sessionstart",P),oe.xr.removeEventListener("sessionend",P)}};F.xr&&ne.connect(),W.set({xr:ne})}if(F.shadowMap){const Q=F.shadowMap.enabled,P=F.shadowMap.type;if(F.shadowMap.enabled=!!A,qn.boo(A))F.shadowMap.type=G0;else if(qn.str(A)){var U;const ne={basic:OQ,percentage:Bw,soft:G0,variance:Vh};F.shadowMap.type=(U=ne[A])!=null?U:G0}else qn.obj(A)&&Object.assign(F.shadowMap,A);(Q!==F.shadowMap.enabled||P!==F.shadowMap.type)&&(F.shadowMap.needsUpdate=!0)}const J=D4();J&&("enabled"in J?J.enabled=!v:"legacyMode"in J&&(J.legacyMode=v));const H=p?ta:Xt,Y=y?Gl:M_;F.outputEncoding!==H&&(F.outputEncoding=H),F.toneMapping!==Y&&(F.toneMapping=Y),W.legacy!==v&&W.set(()=>({legacy:v})),W.linear!==p&&W.set(()=>({linear:p})),W.flat!==y&&W.set(()=>({flat:y})),u&&!qn.fun(u)&&!eJ(u)&&!qn.equ(u,F,vI)&&Sh(F,u),f&&!W.events.handlers&&W.set({events:f(s)});const K=ade(n,d);return qn.equ(K,W.size,vI)||W.setSize(K.width,K.height,K.updateStyle,K.top,K.left),G&&W.viewport.dpr!==J4(G)&&W.setDpr(G),W.frameloop!==w&&W.setFrameloop(w),W.onPointerMissed||W.set({onPointerMissed:Z}),x&&!qn.equ(x,W.performance,vI)&&W.set(Q=>({performance:{...Q.performance,...x}})),a=I,l=!0,this},render(g){return l||this.configure(),xy.updateContainer(M.createElement(cde,{store:s,children:g,onCreated:a,rootElement:n}),o,null,()=>{}),s},unmount(){iJ(n)}}}function cde({store:n,children:e,onCreated:t,rootElement:i}){return zC(()=>{const r=n.getState();r.set(s=>({internal:{...s.internal,active:!0}})),t&&t(r),n.getState().events.connected||r.events.connect==null||r.events.connect(i)},[]),M.createElement(BV.Provider,{value:n},e)}function iJ(n,e){const t=uC.get(n),i=t==null?void 0:t.fiber;if(i){const r=t==null?void 0:t.store.getState();r&&(r.internal.active=!1),xy.updateContainer(null,i,null,()=>{r&&setTimeout(()=>{try{var s,o,a,l;r.events.disconnect==null||r.events.disconnect(),(s=r.gl)==null||(o=s.renderLists)==null||o.dispose==null||o.dispose(),(a=r.gl)==null||a.forceContextLoss==null||a.forceContextLoss(),(l=r.gl)!=null&&l.xr&&r.xr.disconnect(),Que(r),uC.delete(n),e&&e(n)}catch{}},500)})}}function yd(n,e,t){return M.createElement(gde,{key:e.uuid,children:n,container:e,state:t})}function gde({state:n={},children:e,container:t}){const{events:i,size:r,...s}=n,o=GV(),[a]=M.useState(()=>new mV),[l]=M.useState(()=>new pe),c=M.useCallback((u,d)=>{const h={...u};Object.keys(u).forEach(I=>{(que.includes(I)||u[I]!==d[I]&&d[I])&&delete h[I]});let f;if(d&&r){const I=d.camera;f=u.viewport.getCurrentViewport(I,new D,r),I!==u.camera&&q4(I,r)}return{...h,scene:t,raycaster:a,pointer:l,mouse:l,previousRoot:o,events:{...u.events,...d==null?void 0:d.events,...i},size:{...u.size,...r},viewport:{...u.viewport,...f},...s}},[n]),[g]=M.useState(()=>{const u=o.getState();return HC((h,f)=>({...u,scene:t,raycaster:a,pointer:l,mouse:l,previousRoot:o,events:{...u.events,...i},size:{...u.size,...r},...s,set:h,get:f,setEvents:I=>h(A=>({...A,events:{...A.events,...I}}))}))});return M.useEffect(()=>{const u=o.subscribe(d=>g.setState(h=>c(d,h)));return()=>{u(),g.destroy()}},[]),M.useEffect(()=>{g.setState(u=>c(o.getState(),u))},[c]),M.createElement(M.Fragment,null,xy.createPortal(M.createElement(BV.Provider,{value:g},e),g,null))}xy.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:M.version});function S3(n,e,t){var i,r,s,o,a;e==null&&(e=100);function l(){var g=Date.now()-o;g<e&&g>=0?i=setTimeout(l,e-g):(i=null,t||(a=n.apply(s,r),s=r=null))}var c=function(){s=this,r=arguments,o=Date.now();var g=t&&!i;return i||(i=setTimeout(l,e)),g&&(a=n.apply(s,r),s=r=null),a};return c.clear=function(){i&&(clearTimeout(i),i=null)},c.flush=function(){i&&(a=n.apply(s,r),s=r=null,clearTimeout(i),i=null)},c}S3.debounce=S3;var ude=S3;const HL=Ks(ude);function dde(n){let{debounce:e,scroll:t,polyfill:i,offsetSize:r}=n===void 0?{debounce:0,scroll:!1,offsetSize:!1}:n;const s=i||(typeof window>"u"?class{}:window.ResizeObserver);if(!s)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[o,a]=M.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),l=M.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:o}),c=e?typeof e=="number"?e:e.scroll:null,g=e?typeof e=="number"?e:e.resize:null,u=M.useRef(!1);M.useEffect(()=>(u.current=!0,()=>void(u.current=!1)));const[d,h,f]=M.useMemo(()=>{const y=()=>{if(!l.current.element)return;const{left:v,top:b,width:w,height:G,bottom:x,right:B,x:R,y:Z}=l.current.element.getBoundingClientRect(),W={left:v,top:b,width:w,height:G,bottom:x,right:B,x:R,y:Z};l.current.element instanceof HTMLElement&&r&&(W.height=l.current.element.offsetHeight,W.width=l.current.element.offsetWidth),Object.freeze(W),u.current&&!Ade(l.current.lastBounds,W)&&a(l.current.lastBounds=W)};return[y,g?HL(y,g):y,c?HL(y,c):y]},[a,r,c,g]);function I(){l.current.scrollContainers&&(l.current.scrollContainers.forEach(y=>y.removeEventListener("scroll",f,!0)),l.current.scrollContainers=null),l.current.resizeObserver&&(l.current.resizeObserver.disconnect(),l.current.resizeObserver=null)}function A(){l.current.element&&(l.current.resizeObserver=new s(f),l.current.resizeObserver.observe(l.current.element),t&&l.current.scrollContainers&&l.current.scrollContainers.forEach(y=>y.addEventListener("scroll",f,{capture:!0,passive:!0})))}const p=y=>{!y||y===l.current.element||(I(),l.current.element=y,l.current.scrollContainers=rJ(y),A())};return fde(f,!!t),hde(h),M.useEffect(()=>{I(),A()},[t,f,h]),M.useEffect(()=>I,[]),[p,o,d]}function hde(n){M.useEffect(()=>{const e=n;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[n])}function fde(n,e){M.useEffect(()=>{if(e){const t=n;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[n,e])}function rJ(n){const e=[];if(!n||n===document.body)return e;const{overflow:t,overflowX:i,overflowY:r}=window.getComputedStyle(n);return[t,i,r].some(s=>s==="auto"||s==="scroll")&&e.push(n),[...e,...rJ(n.parentElement)]}const Ide=["x","y","top","bottom","left","right","width","height"],Ade=(n,e)=>Ide.every(t=>n[t]===e[t]);var Cde=Object.defineProperty,pde=Object.defineProperties,mde=Object.getOwnPropertyDescriptors,zL=Object.getOwnPropertySymbols,yde=Object.prototype.hasOwnProperty,vde=Object.prototype.propertyIsEnumerable,XL=(n,e,t)=>e in n?Cde(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,YL=(n,e)=>{for(var t in e||(e={}))yde.call(e,t)&&XL(n,t,e[t]);if(zL)for(var t of zL(e))vde.call(e,t)&&XL(n,t,e[t]);return n},bde=(n,e)=>pde(n,mde(e));function sJ(n,e,t){if(!n)return;if(t(n)===!0)return n;let i=e?n.return:n.child;for(;i;){const r=sJ(i,e,t);if(r)return r;i=e?null:i.sibling}}function oJ(n){try{return Object.defineProperties(n,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return n}}const wV=oJ(M.createContext(null));class aJ extends M.Component{render(){return M.createElement(wV.Provider,{value:this._reactInternals},this.props.children)}}const{ReactCurrentOwner:Bde,ReactCurrentDispatcher:Gde}=M.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function wde(){const n=M.useContext(wV);if(!n)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=M.useId();return M.useMemo(()=>{var i;return(i=Bde.current)!=null?i:sJ(n,!1,r=>{let s=r.memoizedState;for(;s;){if(s.memoizedState===e)return!0;s=s.next}})},[n,e])}function xde(){var n,e;const t=wde(),[i]=M.useState(()=>new Map);i.clear();let r=t;for(;r;){const s=(n=r.type)==null?void 0:n._context;s&&s!==wV&&!i.has(s)&&i.set(s,(e=Gde.current)==null?void 0:e.readContext(oJ(s))),r=r.return}return M.useMemo(()=>Array.from(i.keys()).reduce((s,o)=>a=>M.createElement(s,null,M.createElement(o.Provider,bde(YL({},a),{value:i.get(o)}))),s=>M.createElement(aJ,YL({},s))),[i])}const PR={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Sde(n){const{handlePointer:e}=jue(n);return{priority:1,enabled:!0,compute(t,i,r){i.pointer.set(t.offsetX/i.size.width*2-1,-(t.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(PR).reduce((t,i)=>({...t,[i]:e(i)}),{}),update:()=>{var t;const{events:i,internal:r}=n.getState();(t=r.lastEvent)!=null&&t.current&&i.handlers&&i.handlers.onPointerMove(r.lastEvent.current)},connect:t=>{var i;const{set:r,events:s}=n.getState();s.disconnect==null||s.disconnect(),r(o=>({events:{...o.events,connected:t}})),Object.entries((i=s.handlers)!=null?i:[]).forEach(([o,a])=>{const[l,c]=PR[o];t.addEventListener(l,a,{passive:c})})},disconnect:()=>{const{set:t,events:i}=n.getState();if(i.connected){var r;Object.entries((r=i.handlers)!=null?r:[]).forEach(([s,o])=>{if(i&&i.connected instanceof HTMLElement){const[a]=PR[s];i.connected.removeEventListener(a,o)}}),t(s=>({events:{...s.events,connected:void 0}}))}}}}const Rde=M.forwardRef(function({children:e,fallback:t,resize:i,style:r,gl:s,events:o=Sde,eventSource:a,eventPrefix:l,shadows:c,linear:g,flat:u,legacy:d,orthographic:h,frameloop:f,dpr:I,performance:A,raycaster:p,camera:y,onPointerMissed:v,onCreated:b,...w},G){M.useMemo(()=>Zd(T4),[]);const x=xde(),[B,R]=dde({scroll:!0,debounce:{scroll:50,resize:0},...i}),Z=M.useRef(null),W=M.useRef(null);M.useImperativeHandle(G,()=>Z.current);const F=U4(v),[T,V]=M.useState(!1),[z,U]=M.useState(!1);if(T)throw T;if(z)throw z;const J=M.useRef(null);zC(()=>{const Y=Z.current;R.width>0&&R.height>0&&Y&&(J.current||(J.current=lde(Y)),J.current.configure({gl:s,events:o,shadows:c,linear:g,flat:u,legacy:d,orthographic:h,frameloop:f,dpr:I,performance:A,raycaster:p,camera:y,size:R,onPointerMissed:(...K)=>F.current==null?void 0:F.current(...K),onCreated:K=>{K.events.connect==null||K.events.connect(a?Kue(a)?a.current:a:W.current),l&&K.setEvents({compute:(Q,P)=>{const ne=Q[l+"X"],oe=Q[l+"Y"];P.pointer.set(ne/P.size.width*2-1,-(oe/P.size.height)*2+1),P.raycaster.setFromCamera(P.pointer,P.camera)}}),b==null||b(K)}}),J.current.render(M.createElement(x,null,M.createElement(Q4,{set:U},M.createElement(M.Suspense,{fallback:M.createElement(Due,{set:V})},e)))))}),M.useEffect(()=>{const Y=Z.current;if(Y)return()=>iJ(Y)},[]);const H=a?"none":"auto";return M.createElement("div",pt({ref:W,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:H,...r}},w),M.createElement("div",{ref:B,style:{width:"100%",height:"100%"}},M.createElement("canvas",{ref:Z,style:{display:"block"}},t)))}),lJ=M.forwardRef(function(e,t){return M.createElement(aJ,null,M.createElement(Rde,pt({},e,{ref:t})))}),bv=new D,xV=new D,Zde=new D;function Mde(n,e,t){const i=bv.setFromMatrixPosition(n.matrixWorld);i.project(e);const r=t.width/2,s=t.height/2;return[i.x*r+r,-(i.y*s)+s]}function Ede(n,e){const t=bv.setFromMatrixPosition(n.matrixWorld),i=xV.setFromMatrixPosition(e.matrixWorld),r=t.sub(i),s=e.getWorldDirection(Zde);return r.angleTo(s)>Math.PI/2}function Wde(n,e,t,i){const r=bv.setFromMatrixPosition(n.matrixWorld),s=r.clone();s.project(e),t.setFromCamera(s,e);const o=t.intersectObjects(i,!0);if(o.length){const a=o[0].distance;return r.distanceTo(t.ray.origin)<a}return!0}function Fde(n,e){if(e instanceof _c)return e.zoom;if(e instanceof zn){const t=bv.setFromMatrixPosition(n.matrixWorld),i=xV.setFromMatrixPosition(e.matrixWorld),r=e.fov*Math.PI/180,s=t.distanceTo(i);return 1/(2*Math.tan(r/2)*s)}else return 1}function _de(n,e,t){if(e instanceof zn||e instanceof _c){const i=bv.setFromMatrixPosition(n.matrixWorld),r=xV.setFromMatrixPosition(e.matrixWorld),s=i.distanceTo(r),o=(t[1]-t[0])/(e.far-e.near),a=t[1]-o*e.far;return Math.round(o*s+a)}}const R3=n=>Math.abs(n)<1e-10?0:n;function cJ(n,e,t=""){let i="matrix3d(";for(let r=0;r!==16;r++)i+=R3(e[r]*n.elements[r])+(r!==15?",":")");return t+i}const Vde=(n=>e=>cJ(e,n))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Tde=(n=>(e,t)=>cJ(e,n(t),"translate(-50%,-50%)"))(n=>[1/n,1/n,1/n,1,-1/n,-1/n,-1/n,-1,1/n,1/n,1/n,1,1,1,1,1]);function Nde(n){return n&&typeof n=="object"&&"current"in n}const kde=M.forwardRef(({children:n,eps:e=.001,style:t,className:i,prepend:r,center:s,fullscreen:o,portal:a,distanceFactor:l,sprite:c=!1,transform:g=!1,occlude:u,onOcclude:d,castShadow:h,receiveShadow:f,material:I,geometry:A,zIndexRange:p=[16777271,0],calculatePosition:y=Mde,as:v="div",wrapperClass:b,pointerEvents:w="auto",...G},x)=>{const{gl:B,camera:R,scene:Z,size:W,raycaster:F,events:T,viewport:V}=Bt(),[z]=M.useState(()=>document.createElement(v)),U=M.useRef(),J=M.useRef(null),H=M.useRef(0),Y=M.useRef([0,0]),K=M.useRef(null),Q=M.useRef(null),P=(a==null?void 0:a.current)||T.connected||B.domElement.parentNode,ne=M.useRef(null),oe=M.useRef(!1),$=M.useMemo(()=>u&&u!=="blending"||Array.isArray(u)&&u.length&&Nde(u[0]),[u]);M.useLayoutEffect(()=>{const O=B.domElement;u&&u==="blending"?(O.style.zIndex=`${Math.floor(p[0]/2)}`,O.style.position="absolute",O.style.pointerEvents="none"):(O.style.zIndex=null,O.style.position=null,O.style.pointerEvents=null)},[u]),M.useLayoutEffect(()=>{if(J.current){const O=U.current=PQ(z);if(Z.updateMatrixWorld(),g)z.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const q=y(J.current,R,W);z.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${q[0]}px,${q[1]}px,0);transform-origin:0 0;`}return P&&(r?P.prepend(z):P.appendChild(z)),()=>{P&&P.removeChild(z),O.unmount()}}},[P,g]),M.useLayoutEffect(()=>{b&&(z.className=b)},[b]);const de=M.useMemo(()=>g?{position:"absolute",top:0,left:0,width:W.width,height:W.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...o&&{top:-W.height/2,left:-W.width/2,width:W.width,height:W.height},...t},[t,s,o,W,g]),ge=M.useMemo(()=>({position:"absolute",pointerEvents:w}),[w]);M.useLayoutEffect(()=>{if(oe.current=!1,g){var O;(O=U.current)==null||O.render(M.createElement("div",{ref:K,style:de},M.createElement("div",{ref:Q,style:ge},M.createElement("div",{ref:x,className:i,style:t,children:n}))))}else{var q;(q=U.current)==null||q.render(M.createElement("div",{ref:x,style:de,className:i,children:n}))}});const se=M.useRef(!0);yn(O=>{if(J.current){R.updateMatrixWorld(),J.current.updateWorldMatrix(!0,!1);const q=g?Y.current:y(J.current,R,W);if(g||Math.abs(H.current-R.zoom)>e||Math.abs(Y.current[0]-q[0])>e||Math.abs(Y.current[1]-q[1])>e){const ee=Ede(J.current,R);let le=!1;$&&(u!=="blending"?le=[Z]:Array.isArray(u)&&(le=u.map(ze=>ze.current)));const he=se.current;if(le){const ze=Wde(J.current,R,F,le);se.current=ze&&!ee}else se.current=!ee;he!==se.current&&(d?d(!se.current):z.style.display=se.current?"block":"none");const be=Math.floor(p[0]/2),xe=u?$?[p[0],be]:[be-1,0]:p;if(z.style.zIndex=`${_de(J.current,R,xe)}`,g){const[ze,Se]=[W.width/2,W.height/2],ke=R.projectionMatrix.elements[5]*Se,{isOrthographicCamera:He,top:Be,left:j,bottom:X,right:ce}=R,fe=Vde(R.matrixWorldInverse),Ge=He?`scale(${ke})translate(${R3(-(ce+j)/2)}px,${R3((Be+X)/2)}px)`:`translateZ(${ke}px)`;let me=J.current.matrixWorld;c&&(me=R.matrixWorldInverse.clone().transpose().copyPosition(me).scale(J.current.scale),me.elements[3]=me.elements[7]=me.elements[11]=0,me.elements[15]=1),z.style.width=W.width+"px",z.style.height=W.height+"px",z.style.perspective=He?"":`${ke}px`,K.current&&Q.current&&(K.current.style.transform=`${Ge}${fe}translate(${ze}px,${Se}px)`,Q.current.style.transform=Tde(me,1/((l||10)/400)))}else{const ze=l===void 0?1:Fde(J.current,R)*l;z.style.transform=`translate3d(${q[0]}px,${q[1]}px,0) scale(${ze})`}Y.current=q,H.current=R.zoom}}if(!$&&ne.current&&!oe.current)if(g){if(K.current){const q=K.current.children[0];if(q!=null&&q.clientWidth&&q!=null&&q.clientHeight){const{isOrthographicCamera:ee}=R;if(ee||A)G.scale&&(Array.isArray(G.scale)?G.scale instanceof D?ne.current.scale.copy(G.scale.clone().divideScalar(1)):ne.current.scale.set(1/G.scale[0],1/G.scale[1],1/G.scale[2]):ne.current.scale.setScalar(1/G.scale));else{const le=(l||10)/400,he=q.clientWidth*le,be=q.clientHeight*le;ne.current.scale.set(he,be,1)}oe.current=!0}}}else{const q=z.children[0];if(q!=null&&q.clientWidth&&q!=null&&q.clientHeight){const ee=1/V.factor,le=q.clientWidth*ee,he=q.clientHeight*ee;ne.current.scale.set(le,he,1),oe.current=!0}ne.current.lookAt(O.camera.position)}});const k=M.useMemo(()=>({vertexShader:g?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[g]);return M.createElement("group",pt({},G,{ref:J}),u&&!$&&M.createElement("mesh",{castShadow:h,receiveShadow:f,ref:ne},A||M.createElement("planeGeometry",null),I||M.createElement("shaderMaterial",{side:Di,vertexShader:k.vertexShader,fragmentShader:k.fragmentShader})))});let om=0;const gJ=HC(n=>(AA.onStart=(e,t,i)=>{n({active:!0,item:e,loaded:t,total:i,progress:(t-om)/(i-om)*100})},AA.onLoad=()=>{n({active:!1})},AA.onError=e=>n(t=>({errors:[...t.errors,e]})),AA.onProgress=(e,t,i)=>{t===i&&(om=i),n({active:!0,item:e,loaded:t,total:i,progress:(t-om)/(i-om)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));function Dw(n){return function(e){n.forEach(function(t){typeof t=="function"?t(e):t!=null&&(t.current=e)})}}function R0(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Z3(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=n[t];return i}function Lde(n,e){if(n){if(typeof n=="string")return Z3(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Z3(n,e)}}function Hde(n){if(Array.isArray(n))return Z3(n)}function zde(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function Xde(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Yde(n){return Hde(n)||zde(n)||Lde(n)||Xde()}new pe;new pe;function Kde(n,e,t){return Math.max(e,Math.min(t,n))}function Dde(n,e){return Kde(n-Math.floor(n/e)*e,0,e)}function Pde(n,e){var t=Dde(e-n,Math.PI*2);return t>Math.PI&&(t-=Math.PI*2),t}function uJ(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var ma=function n(e,t,i){var r=this;uJ(this,n),R0(this,"dot2",function(s,o){return r.x*s+r.y*o}),R0(this,"dot3",function(s,o,a){return r.x*s+r.y*o+r.z*a}),this.x=e,this.y=t,this.z=i},Ude=[new ma(1,1,0),new ma(-1,1,0),new ma(1,-1,0),new ma(-1,-1,0),new ma(1,0,1),new ma(-1,0,1),new ma(1,0,-1),new ma(-1,0,-1),new ma(0,1,1),new ma(0,-1,1),new ma(0,1,-1),new ma(0,-1,-1)],KL=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],DL=new Array(512),PL=new Array(512),Qde=function(e){e>0&&e<1&&(e*=65536),e=Math.floor(e),e<256&&(e|=e<<8);for(var t=0;t<256;t++){var i;t&1?i=KL[t]^e&255:i=KL[t]^e>>8&255,DL[t]=DL[t+256]=i,PL[t]=PL[t+256]=Ude[i%12]}};Qde(0);function Ode(n){if(typeof n=="number")n=Math.abs(n);else if(typeof n=="string"){var e=n;n=0;for(var t=0;t<e.length;t++)n=(n+(t+1)*(e.charCodeAt(t)%96))%2147483647}return n===0&&(n=311),n}function UL(n){var e=Ode(n);return function(){var t=e*48271%2147483647;return e=t,t/2147483647}}var Jde=function n(e){var t=this;uJ(this,n),R0(this,"seed",0),R0(this,"init",function(i){t.seed=i,t.value=UL(i)}),R0(this,"value",UL(this.seed)),this.init(e)};new Jde(Math.random());var jde=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.01,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/(2*Math.PI);return i/Math.atan(1/t)*Math.atan(Math.sin(2*Math.PI*e*r)/t)},dJ=function(e){return 1/(1+e+.48*e*e+.235*e*e*e)};function Ar(n,e,t){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:.25,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.01,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:dJ,a=arguments.length>7&&arguments[7]!==void 0?arguments[7]:.001,l="velocity_"+e;if(n.__damp===void 0&&(n.__damp={}),n.__damp[l]===void 0&&(n.__damp[l]=0),Math.abs(n[e]-t)<=a)return n[e]=t,!1;i=Math.max(1e-4,i);var c=2/i,g=o(c*r),u=n[e]-t,d=t,h=s*i;u=Math.min(Math.max(u,-h),h),t=n[e]-u;var f=(n.__damp[l]+c*u)*r;n.__damp[l]=(n.__damp[l]-c*f)*g;var I=t+(u+f)*g;return d-n[e]>0==I>d&&(I=d,n.__damp[l]=(I-d)/r),n[e]=I,!0}function kA(n,e,t,i,r,s,o,a){return Ar(n,e,n[e]+Pde(n[e],t),i,r,s,o,a)}var hs,fs,xo,QL,am=new pe;function qde(n,e,t,i,r,s,o){return typeof e=="number"?am.setScalar(e):Array.isArray(e)?am.set(e[0],e[1]):am.copy(e),hs=Ar(n,"x",am.x,t,i,r,s,o),fs=Ar(n,"y",am.y,t,i,r,s,o),hs||fs}var mg=new D;function M3(n,e,t,i,r,s,o){return typeof e=="number"?mg.setScalar(e):Array.isArray(e)?mg.set(e[0],e[1],e[2]):mg.copy(e),hs=Ar(n,"x",mg.x,t,i,r,s,o),fs=Ar(n,"y",mg.y,t,i,r,s,o),xo=Ar(n,"z",mg.z,t,i,r,s,o),hs||fs||xo}var UR=new Lt;function $de(n,e,t,i,r,s,o){return typeof e=="number"?UR.setScalar(e):Array.isArray(e)?UR.set(e[0],e[1],e[2],e[3]):UR.copy(e),hs=Ar(n,"x",mg.x,t,i,r,s,o),fs=Ar(n,"y",mg.y,t,i,r,s,o),xo=Ar(n,"z",mg.z,t,i,r,s,o),hs||fs||xo}var lm=new Hi;function ehe(n,e,t,i,r,s,o){return Array.isArray(e)?lm.set(e[0],e[1],e[2],e[3]):lm.copy(e),hs=kA(n,"x",lm.x,t,i,r,s,o),fs=kA(n,"y",lm.y,t,i,r,s,o),xo=kA(n,"z",lm.z,t,i,r,s,o),hs||fs||xo}var bI=new Ke;function the(n,e,t,i,r,s,o){return e instanceof Ke?bI.copy(e):Array.isArray(e)?bI.setRGB(e[0],e[1],e[2]):bI.set(e),hs=Ar(n,"r",bI.r,t,i,r,s,o),fs=Ar(n,"g",bI.g,t,i,r,s,o),xo=Ar(n,"b",bI.b,t,i,r,s,o),hs||fs||xo}var il=new xn,eg=new Lt,OL=new Lt,cm=new Lt;function hJ(n,e,t,i,r,s,o){var a=n;Array.isArray(e)?il.set(e[0],e[1],e[2],e[3]):il.copy(e);var l=n.dot(il)>0?1:-1;return il.x*=l,il.y*=l,il.z*=l,il.w*=l,hs=Ar(n,"x",il.x,t,i,r,s,o),fs=Ar(n,"y",il.y,t,i,r,s,o),xo=Ar(n,"z",il.z,t,i,r,s,o),QL=Ar(n,"w",il.w,t,i,r,s,o),eg.set(n.x,n.y,n.z,n.w).normalize(),OL.set(a.__damp.velocity_x,a.__damp.velocity_y,a.__damp.velocity_z,a.__damp.velocity_w),cm.copy(eg).multiplyScalar(OL.dot(eg)/eg.dot(eg)),a.__damp.velocity_x-=cm.x,a.__damp.velocity_y-=cm.y,a.__damp.velocity_z-=cm.z,a.__damp.velocity_w-=cm.w,n.set(eg.x,eg.y,eg.z,eg.w),hs||fs||xo||QL}var gm=new yV;function nhe(n,e,t,i,r,s,o){return Array.isArray(e)?gm.set(e[0],e[1],e[2]):gm.copy(e),hs=Ar(n,"radius",gm.radius,t,i,r,s,o),fs=kA(n,"phi",gm.phi,t,i,r,s,o),xo=kA(n,"theta",gm.theta,t,i,r,s,o),hs||fs||xo}var LB=new qe,JL=new D,jL=new xn,qL=new D;function ihe(n,e,t,i,r,s,o){var a=n;return a.__damp===void 0&&(a.__damp={position:new D,rotation:new xn,scale:new D},n.decompose(a.__damp.position,a.__damp.rotation,a.__damp.scale)),Array.isArray(e)?LB.set.apply(LB,Yde(e)):LB.copy(e),LB.decompose(JL,jL,qL),hs=M3(a.__damp.position,JL,t,i,r,s,o),fs=hJ(a.__damp.rotation,jL,t,i,r,s,o),xo=M3(a.__damp.scale,qL,t,i,r,s,o),n.compose(a.__damp.position,a.__damp.rotation,a.__damp.scale),hs||fs||xo}var $L=Object.freeze({__proto__:null,rsqw:jde,exp:dJ,damp:Ar,dampAngle:kA,damp2:qde,damp3:M3,damp4:$de,dampE:ehe,dampC:the,dampQ:hJ,dampS:nhe,dampM:ihe});const fJ=M.createContext(null);function IJ(){return M.useContext(fJ)}function rhe({eps:n=1e-5,enabled:e=!0,infinite:t,horizontal:i,pages:r=1,distance:s=1,damping:o=.25,maxSpeed:a=1/0,style:l={},children:c}){const{get:g,setEvents:u,gl:d,size:h,invalidate:f,events:I}=Bt(),[A]=M.useState(()=>document.createElement("div")),[p]=M.useState(()=>document.createElement("div")),[y]=M.useState(()=>document.createElement("div")),v=d.domElement.parentNode,b=M.useRef(0),w=M.useMemo(()=>({el:A,eps:n,fill:p,fixed:y,horizontal:i,damping:o,offset:0,delta:0,scroll:b,pages:r,range(B,R,Z=0){const W=B-Z,F=W+R+Z*2;return this.offset<W?0:this.offset>F?1:(this.offset-W)/(F-W)},curve(B,R,Z=0){return Math.sin(this.range(B,R,Z)*Math.PI)},visible(B,R,Z=0){const W=B-Z,F=W+R+Z*2;return this.offset>=W&&this.offset<=F}}),[n,o,i,r]);M.useEffect(()=>{A.style.position="absolute",A.style.width="100%",A.style.height="100%",A.style[i?"overflowX":"overflowY"]="auto",A.style[i?"overflowY":"overflowX"]="hidden",A.style.top="0px",A.style.left="0px";for(const R in l)A.style[R]=l[R];y.style.position="sticky",y.style.top="0px",y.style.left="0px",y.style.width="100%",y.style.height="100%",y.style.overflow="hidden",A.appendChild(y),p.style.height=i?"100%":`${r*s*100}%`,p.style.width=i?`${r*s*100}%`:"100%",p.style.pointerEvents="none",A.appendChild(p),v.appendChild(A),A[i?"scrollLeft":"scrollTop"]=1;const x=I.connected||d.domElement;requestAnimationFrame(()=>I.connect==null?void 0:I.connect(A));const B=g().events.compute;return u({compute(R,Z){const{left:W,top:F}=v.getBoundingClientRect(),T=R.clientX-W,V=R.clientY-F;Z.pointer.set(T/Z.size.width*2-1,-(V/Z.size.height)*2+1),Z.raycaster.setFromCamera(Z.pointer,Z.camera)}}),()=>{v.removeChild(A),u({compute:B}),I.connect==null||I.connect(x)}},[r,s,i,A,p,y,v]),M.useEffect(()=>{if(I.connected===A){const x=h[i?"width":"height"],B=A[i?"scrollWidth":"scrollHeight"],R=B-x;let Z=0,W=!0,F=!0;const T=()=>{if(!(!e||F)&&(f(),Z=A[i?"scrollLeft":"scrollTop"],b.current=Z/R,t)){if(!W){if(Z>=R){const z=1-w.offset;A[i?"scrollLeft":"scrollTop"]=1,b.current=w.offset=-z,W=!0}else if(Z<=0){const z=1+w.offset;A[i?"scrollLeft":"scrollTop"]=B,b.current=w.offset=z,W=!0}}W&&setTimeout(()=>W=!1,40)}};A.addEventListener("scroll",T,{passive:!0}),requestAnimationFrame(()=>F=!1);const V=z=>A.scrollLeft+=z.deltaY/2;return i&&A.addEventListener("wheel",V,{passive:!0}),()=>{A.removeEventListener("scroll",T),i&&A.removeEventListener("wheel",V)}}},[A,I,h,t,w,f,i,e]);let G=0;return yn((x,B)=>{G=w.offset,$L.damp(w,"offset",b.current,o,B,a,void 0,n),$L.damp(w,"delta",Math.abs(G-w.offset),o,B,a,void 0,n),w.delta>n&&f()}),M.createElement(fJ.Provider,{value:w},c)}let SV=Gv();const Mt=n=>Bv(n,SV);let RV=Gv();Mt.write=n=>Bv(n,RV);let Pw=Gv();Mt.onStart=n=>Bv(n,Pw);let ZV=Gv();Mt.onFrame=n=>Bv(n,ZV);let MV=Gv();Mt.onFinish=n=>Bv(n,MV);let LA=[];Mt.setTimeout=(n,e)=>{let t=Mt.now()+e,i=()=>{let s=LA.findIndex(o=>o.cancel==i);~s&&LA.splice(s,1),Pu-=~s?1:0},r={time:t,handler:n,cancel:i};return LA.splice(AJ(t),0,r),Pu+=1,CJ(),r};let AJ=n=>~(~LA.findIndex(e=>e.time>n)||~LA.length);Mt.cancel=n=>{Pw.delete(n),ZV.delete(n),MV.delete(n),SV.delete(n),RV.delete(n)};Mt.sync=n=>{E3=!0,Mt.batchedUpdates(n),E3=!1};Mt.throttle=n=>{let e;function t(){try{n(...e)}finally{e=null}}function i(...r){e=r,Mt.onStart(t)}return i.handler=n,i.cancel=()=>{Pw.delete(t),e=null},i};let EV=typeof window<"u"?window.requestAnimationFrame:()=>{};Mt.use=n=>EV=n;Mt.now=typeof performance<"u"?()=>performance.now():Date.now;Mt.batchedUpdates=n=>n();Mt.catch=console.error;Mt.frameLoop="always";Mt.advance=()=>{Mt.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):mJ()};let Du=-1,Pu=0,E3=!1;function Bv(n,e){E3?(e.delete(n),n(0)):(e.add(n),CJ())}function CJ(){Du<0&&(Du=0,Mt.frameLoop!=="demand"&&EV(pJ))}function she(){Du=-1}function pJ(){~Du&&(EV(pJ),Mt.batchedUpdates(mJ))}function mJ(){let n=Du;Du=Mt.now();let e=AJ(Du);if(e&&(yJ(LA.splice(0,e),t=>t.handler()),Pu-=e),!Pu){she();return}Pw.flush(),SV.flush(n?Math.min(64,Du-n):16.667),ZV.flush(),RV.flush(),MV.flush()}function Gv(){let n=new Set,e=n;return{add(t){Pu+=e==n&&!n.has(t)?1:0,n.add(t)},delete(t){return Pu-=e==n&&n.has(t)?1:0,n.delete(t)},flush(t){e.size&&(n=new Set,Pu-=e.size,yJ(e,i=>i(t)&&n.add(i)),Pu+=n.size,e=n)}}}function yJ(n,e){n.forEach(t=>{try{e(t)}catch(i){Mt.catch(i)}})}function W3(){}const ohe=(n,e,t)=>Object.defineProperty(n,e,{value:t,writable:!0,configurable:!0}),Je={arr:Array.isArray,obj:n=>!!n&&n.constructor.name==="Object",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",und:n=>n===void 0};function fg(n,e){if(Je.arr(n)){if(!Je.arr(e)||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}return n===e}const Yt=(n,e)=>n.forEach(e);function Yg(n,e,t){if(Je.arr(n)){for(let i=0;i<n.length;i++)e.call(t,n[i],`${i}`);return}for(const i in n)n.hasOwnProperty(i)&&e.call(t,n[i],i)}const fo=n=>Je.und(n)?[]:Je.arr(n)?n:[n];function Z0(n,e){if(n.size){const t=Array.from(n);n.clear(),Yt(t,e)}}const n0=(n,...e)=>Z0(n,t=>t(...e)),WV=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent);let FV,vJ,ld=null,bJ=!1,_V=W3;const ahe=n=>{n.to&&(vJ=n.to),n.now&&(Mt.now=n.now),n.colors!==void 0&&(ld=n.colors),n.skipAnimation!=null&&(bJ=n.skipAnimation),n.createStringInterpolator&&(FV=n.createStringInterpolator),n.requestAnimationFrame&&Mt.use(n.requestAnimationFrame),n.batchedUpdates&&(Mt.batchedUpdates=n.batchedUpdates),n.willAdvance&&(_V=n.willAdvance),n.frameLoop&&(Mt.frameLoop=n.frameLoop)};var xc=Object.freeze({__proto__:null,get createStringInterpolator(){return FV},get to(){return vJ},get colors(){return ld},get skipAnimation(){return bJ},get willAdvance(){return _V},assign:ahe});const M0=new Set;let Ea=[],QR=[],A2=0;const Uw={get idle(){return!M0.size&&!Ea.length},start(n){A2>n.priority?(M0.add(n),Mt.onStart(lhe)):(BJ(n),Mt(F3))},advance:F3,sort(n){if(A2)Mt.onFrame(()=>Uw.sort(n));else{const e=Ea.indexOf(n);~e&&(Ea.splice(e,1),GJ(n))}},clear(){Ea=[],M0.clear()}};function lhe(){M0.forEach(BJ),M0.clear(),Mt(F3)}function BJ(n){Ea.includes(n)||GJ(n)}function GJ(n){Ea.splice(che(Ea,e=>e.priority>n.priority),0,n)}function F3(n){const e=QR;for(let t=0;t<Ea.length;t++){const i=Ea[t];A2=i.priority,i.idle||(_V(i),i.advance(n),i.idle||e.push(i))}return A2=0,QR=Ea,QR.length=0,Ea=e,Ea.length>0}function che(n,e){const t=n.findIndex(e);return t<0?n.length:t}const ghe=(n,e,t)=>Math.min(Math.max(t,n),e),uhe={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},vl="[-+]?\\d*\\.?\\d+",C2=vl+"%";function Qw(...n){return"\\(\\s*("+n.join(")\\s*,\\s*(")+")\\s*\\)"}const dhe=new RegExp("rgb"+Qw(vl,vl,vl)),hhe=new RegExp("rgba"+Qw(vl,vl,vl,vl)),fhe=new RegExp("hsl"+Qw(vl,C2,C2)),Ihe=new RegExp("hsla"+Qw(vl,C2,C2,vl)),Ahe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,Che=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,phe=/^#([0-9a-fA-F]{6})$/,mhe=/^#([0-9a-fA-F]{8})$/;function yhe(n){let e;return typeof n=="number"?n>>>0===n&&n>=0&&n<=4294967295?n:null:(e=phe.exec(n))?parseInt(e[1]+"ff",16)>>>0:ld&&ld[n]!==void 0?ld[n]:(e=dhe.exec(n))?(BI(e[1])<<24|BI(e[2])<<16|BI(e[3])<<8|255)>>>0:(e=hhe.exec(n))?(BI(e[1])<<24|BI(e[2])<<16|BI(e[3])<<8|nH(e[4]))>>>0:(e=Ahe.exec(n))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+"ff",16)>>>0:(e=mhe.exec(n))?parseInt(e[1],16)>>>0:(e=Che.exec(n))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+e[4]+e[4],16)>>>0:(e=fhe.exec(n))?(eH(tH(e[1]),HB(e[2]),HB(e[3]))|255)>>>0:(e=Ihe.exec(n))?(eH(tH(e[1]),HB(e[2]),HB(e[3]))|nH(e[4]))>>>0:null}function OR(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function eH(n,e,t){const i=t<.5?t*(1+e):t+e-t*e,r=2*t-i,s=OR(r,i,n+1/3),o=OR(r,i,n),a=OR(r,i,n-1/3);return Math.round(s*255)<<24|Math.round(o*255)<<16|Math.round(a*255)<<8}function BI(n){const e=parseInt(n,10);return e<0?0:e>255?255:e}function tH(n){return(parseFloat(n)%360+360)%360/360}function nH(n){const e=parseFloat(n);return e<0?0:e>1?255:Math.round(e*255)}function HB(n){const e=parseFloat(n);return e<0?0:e>100?1:e/100}function iH(n){let e=yhe(n);if(e===null)return n;e=e||0;let t=(e&4278190080)>>>24,i=(e&16711680)>>>16,r=(e&65280)>>>8,s=(e&255)/255;return`rgba(${t}, ${i}, ${r}, ${s})`}const Sy=(n,e,t)=>{if(Je.fun(n))return n;if(Je.arr(n))return Sy({range:n,output:e,extrapolate:t});if(Je.str(n.output[0]))return FV(n);const i=n,r=i.output,s=i.range||[0,1],o=i.extrapolateLeft||i.extrapolate||"extend",a=i.extrapolateRight||i.extrapolate||"extend",l=i.easing||(c=>c);return c=>{const g=bhe(c,s);return vhe(c,s[g],s[g+1],r[g],r[g+1],l,o,a,i.map)}};function vhe(n,e,t,i,r,s,o,a,l){let c=l?l(n):n;if(c<e){if(o==="identity")return c;o==="clamp"&&(c=e)}if(c>t){if(a==="identity")return c;a==="clamp"&&(c=t)}return i===r?i:e===t?n<=e?i:r:(e===-1/0?c=-c:t===1/0?c=c-e:c=(c-e)/(t-e),c=s(c),i===-1/0?c=-c:r===1/0?c=c+i:c=c*(r-i)+i,c)}function bhe(n,e){for(var t=1;t<e.length-1&&!(e[t]>=n);++t);return t-1}const Bhe=(n,e="end")=>t=>{t=e==="end"?Math.min(t,.999):Math.max(t,.001);const i=t*n,r=e==="end"?Math.floor(i):Math.ceil(i);return ghe(0,1,r/n)},p2=1.70158,zB=p2*1.525,rH=p2+1,sH=2*Math.PI/3,oH=2*Math.PI/4.5,XB=n=>n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375,Ghe={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>1-(1-n)*(1-n),easeInOutQuad:n=>n<.5?2*n*n:1-Math.pow(-2*n+2,2)/2,easeInCubic:n=>n*n*n,easeOutCubic:n=>1-Math.pow(1-n,3),easeInOutCubic:n=>n<.5?4*n*n*n:1-Math.pow(-2*n+2,3)/2,easeInQuart:n=>n*n*n*n,easeOutQuart:n=>1-Math.pow(1-n,4),easeInOutQuart:n=>n<.5?8*n*n*n*n:1-Math.pow(-2*n+2,4)/2,easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>1-Math.pow(1-n,5),easeInOutQuint:n=>n<.5?16*n*n*n*n*n:1-Math.pow(-2*n+2,5)/2,easeInSine:n=>1-Math.cos(n*Math.PI/2),easeOutSine:n=>Math.sin(n*Math.PI/2),easeInOutSine:n=>-(Math.cos(Math.PI*n)-1)/2,easeInExpo:n=>n===0?0:Math.pow(2,10*n-10),easeOutExpo:n=>n===1?1:1-Math.pow(2,-10*n),easeInOutExpo:n=>n===0?0:n===1?1:n<.5?Math.pow(2,20*n-10)/2:(2-Math.pow(2,-20*n+10))/2,easeInCirc:n=>1-Math.sqrt(1-Math.pow(n,2)),easeOutCirc:n=>Math.sqrt(1-Math.pow(n-1,2)),easeInOutCirc:n=>n<.5?(1-Math.sqrt(1-Math.pow(2*n,2)))/2:(Math.sqrt(1-Math.pow(-2*n+2,2))+1)/2,easeInBack:n=>rH*n*n*n-p2*n*n,easeOutBack:n=>1+rH*Math.pow(n-1,3)+p2*Math.pow(n-1,2),easeInOutBack:n=>n<.5?Math.pow(2*n,2)*((zB+1)*2*n-zB)/2:(Math.pow(2*n-2,2)*((zB+1)*(n*2-2)+zB)+2)/2,easeInElastic:n=>n===0?0:n===1?1:-Math.pow(2,10*n-10)*Math.sin((n*10-10.75)*sH),easeOutElastic:n=>n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n*10-.75)*sH)+1,easeInOutElastic:n=>n===0?0:n===1?1:n<.5?-(Math.pow(2,20*n-10)*Math.sin((20*n-11.125)*oH))/2:Math.pow(2,-20*n+10)*Math.sin((20*n-11.125)*oH)/2+1,easeInBounce:n=>1-XB(1-n),easeOutBounce:XB,easeInOutBounce:n=>n<.5?(1-XB(1-2*n))/2:(1+XB(2*n-1))/2,steps:Bhe};function _3(){return _3=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},_3.apply(this,arguments)}const dC=Symbol.for("FluidValue.get"),Cf=Symbol.for("FluidValue.observers"),rc=n=>!!(n&&n[dC]),xa=n=>n&&n[dC]?n[dC]():n,aH=n=>n[Cf]||null;function whe(n,e){n.eventObserved?n.eventObserved(e):n(e)}function m2(n,e){let t=n[Cf];t&&t.forEach(i=>{whe(i,e)})}class xhe{constructor(e){if(this[dC]=void 0,this[Cf]=void 0,!e&&!(e=this.get))throw Error("Unknown getter");She(this,e)}}const She=(n,e)=>wJ(n,dC,e);function wv(n,e){if(n[dC]){let t=n[Cf];t||wJ(n,Cf,t=new Set),t.has(e)||(t.add(e),n.observerAdded&&n.observerAdded(t.size,e))}return e}function y2(n,e){let t=n[Cf];if(t&&t.has(e)){const i=t.size-1;i?t.delete(e):n[Cf]=null,n.observerRemoved&&n.observerRemoved(i,e)}}const wJ=(n,e,t)=>Object.defineProperty(n,e,{value:t,writable:!0,configurable:!0}),I1=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,Rhe=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,lH=new RegExp(`(${I1.source})(%|[a-z]+)`,"i"),Zhe=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,Ow=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,xJ=n=>{const[e,t]=Mhe(n);if(!e||WV())return n;const i=window.getComputedStyle(document.documentElement).getPropertyValue(e);if(i)return i.trim();if(t&&t.startsWith("--")){const r=window.getComputedStyle(document.documentElement).getPropertyValue(t);return r||n}else{if(t&&Ow.test(t))return xJ(t);if(t)return t}return n},Mhe=n=>{const e=Ow.exec(n);if(!e)return[,];const[,t,i]=e;return[t,i]};let JR;const Ehe=(n,e,t,i,r)=>`rgba(${Math.round(e)}, ${Math.round(t)}, ${Math.round(i)}, ${r})`,SJ=n=>{JR||(JR=ld?new RegExp(`(${Object.keys(ld).join("|")})(?!\\w)`,"g"):/^\b$/);const e=n.output.map(s=>xa(s).replace(Ow,xJ).replace(Rhe,iH).replace(JR,iH)),t=e.map(s=>s.match(I1).map(Number)),r=t[0].map((s,o)=>t.map(a=>{if(!(o in a))throw Error('The arity of each "output" value must be equal');return a[o]})).map(s=>Sy(_3({},n,{output:s})));return s=>{var o;const a=!lH.test(e[0])&&((o=e.find(c=>lH.test(c)))==null?void 0:o.replace(I1,""));let l=0;return e[0].replace(I1,()=>`${r[l++](s)}${a||""}`).replace(Zhe,Ehe)}},VV="react-spring: ",RJ=n=>{const e=n;let t=!1;if(typeof e!="function")throw new TypeError(`${VV}once requires a function parameter`);return(...i)=>{t||(e(...i),t=!0)}},Whe=RJ(console.warn);function Fhe(){Whe(`${VV}The "interpolate" function is deprecated in v9 (use "to" instead)`)}const _he=RJ(console.warn);function Vhe(){_he(`${VV}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function Jw(n){return Je.str(n)&&(n[0]=="#"||/\d/.test(n)||!WV()&&Ow.test(n)||n in(ld||{}))}const Hh=WV()?M.useEffect:M.useLayoutEffect,The=()=>{const n=M.useRef(!1);return Hh(()=>(n.current=!0,()=>{n.current=!1}),[]),n};function TV(){const n=M.useState()[1],e=The();return()=>{e.current&&n(Math.random())}}function Nhe(n,e){const[t]=M.useState(()=>({inputs:e,result:n()})),i=M.useRef(),r=i.current;let s=r;return s?e&&s.inputs&&khe(e,s.inputs)||(s={inputs:e,result:n()}):s=t,M.useEffect(()=>{i.current=s,r==t&&(t.inputs=t.result=void 0)},[s]),s.result}function khe(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}const NV=n=>M.useEffect(n,Lhe),Lhe=[];function V3(n){const e=M.useRef();return M.useEffect(()=>{e.current=n}),e.current}const Ry=Symbol.for("Animated:node"),Hhe=n=>!!n&&n[Ry]===n,nc=n=>n&&n[Ry],kV=(n,e)=>ohe(n,Ry,e),jw=n=>n&&n[Ry]&&n[Ry].getPayload();class ZJ{constructor(){this.payload=void 0,kV(this,this)}getPayload(){return this.payload||[]}}class XC extends ZJ{constructor(e){super(),this.done=!0,this.elapsedTime=void 0,this.lastPosition=void 0,this.lastVelocity=void 0,this.v0=void 0,this.durationProgress=0,this._value=e,Je.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new XC(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,t){return Je.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value===e?!1:(this._value=e,!0)}reset(){const{done:e}=this;this.done=!1,Je.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}}class hC extends XC{constructor(e){super(0),this._string=null,this._toString=void 0,this._toString=Sy({output:[e,e]})}static create(e){return new hC(e)}getValue(){let e=this._string;return e??(this._string=this._toString(this._value))}setValue(e){if(Je.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else if(super.setValue(e))this._string=null;else return!1;return!0}reset(e){e&&(this._toString=Sy({output:[this.getValue(),e]})),this._value=0,super.reset()}}const v2={dependencies:null};class LV extends ZJ{constructor(e){super(),this.source=e,this.setValue(e)}getValue(e){const t={};return Yg(this.source,(i,r)=>{Hhe(i)?t[r]=i.getValue(e):rc(i)?t[r]=xa(i):e||(t[r]=i)}),t}setValue(e){this.source=e,this.payload=this._makePayload(e)}reset(){this.payload&&Yt(this.payload,e=>e.reset())}_makePayload(e){if(e){const t=new Set;return Yg(e,this._addToPayload,t),Array.from(t)}}_addToPayload(e){v2.dependencies&&rc(e)&&v2.dependencies.add(e);const t=jw(e);t&&Yt(t,i=>this.add(i))}}class HV extends LV{constructor(e){super(e)}static create(e){return new HV(e)}getValue(){return this.source.map(e=>e.getValue())}setValue(e){const t=this.getPayload();return e.length==t.length?t.map((i,r)=>i.setValue(e[r])).some(Boolean):(super.setValue(e.map(zhe)),!0)}}function zhe(n){return(Jw(n)?hC:XC).create(n)}function T3(n){const e=nc(n);return e?e.constructor:Je.arr(n)?HV:Jw(n)?hC:XC}function b2(){return b2=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},b2.apply(this,arguments)}const cH=(n,e)=>{const t=!Je.fun(n)||n.prototype&&n.prototype.isReactComponent;return M.forwardRef((i,r)=>{const s=M.useRef(null),o=t&&M.useCallback(f=>{s.current=Khe(r,f)},[r]),[a,l]=Yhe(i,e),c=TV(),g=()=>{const f=s.current;if(t&&!f)return;(f?e.applyAnimatedValues(f,a.getValue(!0)):!1)===!1&&c()},u=new Xhe(g,l),d=M.useRef();Hh(()=>(d.current=u,Yt(l,f=>wv(f,u)),()=>{d.current&&(Yt(d.current.deps,f=>y2(f,d.current)),Mt.cancel(d.current.update))})),M.useEffect(g,[]),NV(()=>()=>{const f=d.current;Yt(f.deps,I=>y2(I,f))});const h=e.getComponentProps(a.getValue());return M.createElement(n,b2({},h,{ref:o}))})};class Xhe{constructor(e,t){this.update=e,this.deps=t}eventObserved(e){e.type=="change"&&Mt.write(this.update)}}function Yhe(n,e){const t=new Set;return v2.dependencies=t,n.style&&(n=b2({},n,{style:e.createAnimatedStyle(n.style)})),n=new LV(n),v2.dependencies=null,[n,t]}function Khe(n,e){return n&&(Je.fun(n)?n(e):n.current=e),e}const gH=Symbol.for("AnimatedComponent"),Dhe=(n,{applyAnimatedValues:e=()=>!1,createAnimatedStyle:t=r=>new LV(r),getComponentProps:i=r=>r}={})=>{const r={applyAnimatedValues:e,createAnimatedStyle:t,getComponentProps:i},s=o=>{const a=uH(o)||"Anonymous";return Je.str(o)?o=s[o]||(s[o]=cH(o,r)):o=o[gH]||(o[gH]=cH(o,r)),o.displayName=`Animated(${a})`,o};return Yg(n,(o,a)=>{Je.arr(n)&&(a=uH(o)),s[a]=s(o)}),{animated:s}},uH=n=>Je.str(n)?n:n&&Je.str(n.displayName)?n.displayName:Je.fun(n)&&n.name||null;function Gi(){return Gi=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Gi.apply(this,arguments)}function lo(n,...e){return Je.fun(n)?n(...e):n}const E0=(n,e)=>n===!0||!!(e&&n&&(Je.fun(n)?n(e):fo(n).includes(e))),MJ=(n,e)=>Je.obj(n)?e&&n[e]:n,EJ=(n,e)=>n.default===!0?n[e]:n.default?n.default[e]:void 0,Phe=n=>n,qw=(n,e=Phe)=>{let t=Uhe;n.default&&n.default!==!0&&(n=n.default,t=Object.keys(n));const i={};for(const r of t){const s=e(n[r],r);Je.und(s)||(i[r]=s)}return i},Uhe=["config","onProps","onStart","onChange","onPause","onResume","onRest"],Qhe={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function Ohe(n){const e={};let t=0;if(Yg(n,(i,r)=>{Qhe[r]||(e[r]=i,t++)}),t)return e}function zV(n){const e=Ohe(n);if(e){const t={to:e};return Yg(n,(i,r)=>r in e||(t[r]=i)),t}return Gi({},n)}function Zy(n){return n=xa(n),Je.arr(n)?n.map(Zy):Jw(n)?xc.createStringInterpolator({range:[0,1],output:[n,n]})(1):n}function WJ(n){for(const e in n)return!0;return!1}function N3(n){return Je.fun(n)||Je.arr(n)&&Je.obj(n[0])}function k3(n,e){var t;(t=n.ref)==null||t.delete(n),e==null||e.delete(n)}function FJ(n,e){if(e&&n.ref!==e){var t;(t=n.ref)==null||t.delete(n),e.add(n),n.ref=e}}const xv={default:{tension:170,friction:26},gentle:{tension:120,friction:14},wobbly:{tension:180,friction:12},stiff:{tension:210,friction:20},slow:{tension:280,friction:60},molasses:{tension:280,friction:120}},L3=Gi({},xv.default,{mass:1,damping:1,easing:Ghe.linear,clamp:!1});class Jhe{constructor(){this.tension=void 0,this.friction=void 0,this.frequency=void 0,this.damping=void 0,this.mass=void 0,this.velocity=0,this.restVelocity=void 0,this.precision=void 0,this.progress=void 0,this.duration=void 0,this.easing=void 0,this.clamp=void 0,this.bounce=void 0,this.decay=void 0,this.round=void 0,Object.assign(this,L3)}}function jhe(n,e,t){t&&(t=Gi({},t),dH(t,e),e=Gi({},t,e)),dH(n,e),Object.assign(n,e);for(const o in L3)n[o]==null&&(n[o]=L3[o]);let{mass:i,frequency:r,damping:s}=n;return Je.und(r)||(r<.01&&(r=.01),s<0&&(s=0),n.tension=Math.pow(2*Math.PI/r,2)*i,n.friction=4*Math.PI*s*i/r),n}function dH(n,e){if(!Je.und(e.decay))n.duration=void 0;else{const t=!Je.und(e.tension)||!Je.und(e.friction);(t||!Je.und(e.frequency)||!Je.und(e.damping)||!Je.und(e.mass))&&(n.duration=void 0,n.decay=void 0),t&&(n.frequency=void 0)}}const hH=[];let qhe=class{constructor(){this.changed=!1,this.values=hH,this.toValues=null,this.fromValues=hH,this.to=void 0,this.from=void 0,this.config=new Jhe,this.immediate=!1}};function _J(n,{key:e,props:t,defaultProps:i,state:r,actions:s}){return new Promise((o,a)=>{var l;let c,g,u=E0((l=t.cancel)!=null?l:i==null?void 0:i.cancel,e);if(u)f();else{Je.und(t.pause)||(r.paused=E0(t.pause,e));let I=i==null?void 0:i.pause;I!==!0&&(I=r.paused||E0(I,e)),c=lo(t.delay||0,e),I?(r.resumeQueue.add(h),s.pause()):(s.resume(),h())}function d(){r.resumeQueue.add(h),r.timeouts.delete(g),g.cancel(),c=g.time-Mt.now()}function h(){c>0&&!xc.skipAnimation?(r.delayed=!0,g=Mt.setTimeout(f,c),r.pauseQueue.add(d),r.timeouts.add(g)):f()}function f(){r.delayed&&(r.delayed=!1),r.pauseQueue.delete(d),r.timeouts.delete(g),n<=(r.cancelId||0)&&(u=!0);try{s.start(Gi({},t,{callId:n,cancel:u}),o)}catch(I){a(I)}}})}const XV=(n,e)=>e.length==1?e[0]:e.some(t=>t.cancelled)?HA(n.get()):e.every(t=>t.noop)?VJ(n.get()):Cl(n.get(),e.every(t=>t.finished)),VJ=n=>({value:n,noop:!0,finished:!0,cancelled:!1}),Cl=(n,e,t=!1)=>({value:n,finished:e,cancelled:t}),HA=n=>({value:n,cancelled:!0,finished:!1});function TJ(n,e,t,i){const{callId:r,parentId:s,onRest:o}=e,{asyncTo:a,promise:l}=t;return!s&&n===a&&!e.reset?l:t.promise=(async()=>{t.asyncId=r,t.asyncTo=n;const c=qw(e,(A,p)=>p==="onRest"?void 0:A);let g,u;const d=new Promise((A,p)=>(g=A,u=p)),h=A=>{const p=r<=(t.cancelId||0)&&HA(i)||r!==t.asyncId&&Cl(i,!1);if(p)throw A.result=p,u(A),A},f=(A,p)=>{const y=new fH,v=new IH;return(async()=>{if(xc.skipAnimation)throw My(t),v.result=Cl(i,!1),u(v),v;h(y);const b=Je.obj(A)?Gi({},A):Gi({},p,{to:A});b.parentId=r,Yg(c,(G,x)=>{Je.und(b[x])&&(b[x]=G)});const w=await i.start(b);return h(y),t.paused&&await new Promise(G=>{t.resumeQueue.add(G)}),w})()};let I;if(xc.skipAnimation)return My(t),Cl(i,!1);try{let A;Je.arr(n)?A=(async p=>{for(const y of p)await f(y)})(n):A=Promise.resolve(n(f,i.stop.bind(i))),await Promise.all([A.then(g),d]),I=Cl(i.get(),!0,!1)}catch(A){if(A instanceof fH)I=A.result;else if(A instanceof IH)I=A.result;else throw A}finally{r==t.asyncId&&(t.asyncId=s,t.asyncTo=s?a:void 0,t.promise=s?l:void 0)}return Je.fun(o)&&Mt.batchedUpdates(()=>{o(I,i,i.item)}),I})()}function My(n,e){Z0(n.timeouts,t=>t.cancel()),n.pauseQueue.clear(),n.resumeQueue.clear(),n.asyncId=n.asyncTo=n.promise=void 0,e&&(n.cancelId=e)}class fH extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise."),this.result=void 0}}class IH extends Error{constructor(){super("SkipAnimationSignal"),this.result=void 0}}const H3=n=>n instanceof YV;let $he=1;class YV extends xhe{constructor(...e){super(...e),this.id=$he++,this.key=void 0,this._priority=0}get priority(){return this._priority}set priority(e){this._priority!=e&&(this._priority=e,this._onPriorityChange(e))}get(){const e=nc(this);return e&&e.getValue()}to(...e){return xc.to(this,e)}interpolate(...e){return Fhe(),xc.to(this,e)}toJSON(){return this.get()}observerAdded(e){e==1&&this._attach()}observerRemoved(e){e==0&&this._detach()}_attach(){}_detach(){}_onChange(e,t=!1){m2(this,{type:"change",parent:this,value:e,idle:t})}_onPriorityChange(e){this.idle||Uw.sort(this),m2(this,{type:"priority",parent:this,priority:e})}}const pf=Symbol.for("SpringPhase"),NJ=1,z3=2,X3=4,jR=n=>(n[pf]&NJ)>0,Bu=n=>(n[pf]&z3)>0,um=n=>(n[pf]&X3)>0,AH=(n,e)=>e?n[pf]|=z3|NJ:n[pf]&=~z3,CH=(n,e)=>e?n[pf]|=X3:n[pf]&=~X3;class efe extends YV{constructor(e,t){if(super(),this.key=void 0,this.animation=new qhe,this.queue=void 0,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!Je.und(e)||!Je.und(t)){const i=Je.obj(e)?Gi({},e):Gi({},t,{from:e});Je.und(i.default)&&(i.default=!0),this.start(i)}}get idle(){return!(Bu(this)||this._state.asyncTo)||um(this)}get goal(){return xa(this.animation.to)}get velocity(){const e=nc(this);return e instanceof XC?e.lastVelocity||0:e.getPayload().map(t=>t.lastVelocity||0)}get hasAnimated(){return jR(this)}get isAnimating(){return Bu(this)}get isPaused(){return um(this)}get isDelayed(){return this._state.delayed}advance(e){let t=!0,i=!1;const r=this.animation;let{config:s,toValues:o}=r;const a=jw(r.to);!a&&rc(r.to)&&(o=fo(xa(r.to))),r.values.forEach((g,u)=>{if(g.done)return;const d=g.constructor==hC?1:a?a[u].lastPosition:o[u];let h=r.immediate,f=d;if(!h){if(f=g.lastPosition,s.tension<=0){g.done=!0;return}let I=g.elapsedTime+=e;const A=r.fromValues[u],p=g.v0!=null?g.v0:g.v0=Je.arr(s.velocity)?s.velocity[u]:s.velocity;let y;const v=s.precision||(A==d?.005:Math.min(1,Math.abs(d-A)*.001));if(Je.und(s.duration))if(s.decay){const b=s.decay===!0?.998:s.decay,w=Math.exp(-(1-b)*I);f=A+p/(1-b)*(1-w),h=Math.abs(g.lastPosition-f)<=v,y=p*w}else{y=g.lastVelocity==null?p:g.lastVelocity;const b=s.restVelocity||v/10,w=s.clamp?0:s.bounce,G=!Je.und(w),x=A==d?g.v0>0:A<d;let B,R=!1;const Z=1,W=Math.ceil(e/Z);for(let F=0;F<W&&(B=Math.abs(y)>b,!(!B&&(h=Math.abs(d-f)<=v,h)));++F){G&&(R=f==d||f>d==x,R&&(y=-y*w,f=d));const T=-s.tension*1e-6*(f-d),V=-s.friction*.001*y,z=(T+V)/s.mass;y=y+z*Z,f=f+y*Z}}else{let b=1;s.duration>0&&(this._memoizedDuration!==s.duration&&(this._memoizedDuration=s.duration,g.durationProgress>0&&(g.elapsedTime=s.duration*g.durationProgress,I=g.elapsedTime+=e)),b=(s.progress||0)+I/this._memoizedDuration,b=b>1?1:b<0?0:b,g.durationProgress=b),f=A+s.easing(b)*(d-A),y=(f-g.lastPosition)/e,h=b==1}g.lastVelocity=y,Number.isNaN(f)&&(console.warn("Got NaN while animating:",this),h=!0)}a&&!a[u].done&&(h=!1),h?g.done=!0:t=!1,g.setValue(f,s.round)&&(i=!0)});const l=nc(this),c=l.getValue();if(t){const g=xa(r.to);(c!==g||i)&&!s.decay?(l.setValue(g),this._onChange(g)):i&&s.decay&&this._onChange(c),this._stop()}else i&&this._onChange(c)}set(e){return Mt.batchedUpdates(()=>{this._stop(),this._focus(e),this._set(e)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(Bu(this)){const{to:e,config:t}=this.animation;Mt.batchedUpdates(()=>{this._onStart(),t.decay||this._set(e,!1),this._stop()})}return this}update(e){return(this.queue||(this.queue=[])).push(e),this}start(e,t){let i;return Je.und(e)?(i=this.queue||[],this.queue=[]):i=[Je.obj(e)?e:Gi({},t,{to:e})],Promise.all(i.map(r=>this._update(r))).then(r=>XV(this,r))}stop(e){const{to:t}=this.animation;return this._focus(this.get()),My(this._state,e&&this._lastCallId),Mt.batchedUpdates(()=>this._stop(t,e)),this}reset(){this._update({reset:!0})}eventObserved(e){e.type=="change"?this._start():e.type=="priority"&&(this.priority=e.priority+1)}_prepareNode(e){const t=this.key||"";let{to:i,from:r}=e;i=Je.obj(i)?i[t]:i,(i==null||N3(i))&&(i=void 0),r=Je.obj(r)?r[t]:r,r==null&&(r=void 0);const s={to:i,from:r};return jR(this)||(e.reverse&&([i,r]=[r,i]),r=xa(r),Je.und(r)?nc(this)||this._set(i):this._set(r)),s}_update(e,t){let i=Gi({},e);const{key:r,defaultProps:s}=this;i.default&&Object.assign(s,qw(i,(l,c)=>/^on/.test(c)?MJ(l,r):l)),mH(this,i,"onProps"),hm(this,"onProps",i,this);const o=this._prepareNode(i);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const a=this._state;return _J(++this._lastCallId,{key:r,props:i,defaultProps:s,state:a,actions:{pause:()=>{um(this)||(CH(this,!0),n0(a.pauseQueue),hm(this,"onPause",Cl(this,dm(this,this.animation.to)),this))},resume:()=>{um(this)&&(CH(this,!1),Bu(this)&&this._resume(),n0(a.resumeQueue),hm(this,"onResume",Cl(this,dm(this,this.animation.to)),this))},start:this._merge.bind(this,o)}}).then(l=>{if(i.loop&&l.finished&&!(t&&l.noop)){const c=kJ(i);if(c)return this._update(c,!0)}return l})}_merge(e,t,i){if(t.cancel)return this.stop(!0),i(HA(this));const r=!Je.und(e.to),s=!Je.und(e.from);if(r||s)if(t.callId>this._lastToId)this._lastToId=t.callId;else return i(HA(this));const{key:o,defaultProps:a,animation:l}=this,{to:c,from:g}=l;let{to:u=c,from:d=g}=e;s&&!r&&(!t.default||Je.und(u))&&(u=d),t.reverse&&([u,d]=[d,u]);const h=!fg(d,g);h&&(l.from=d),d=xa(d);const f=!fg(u,c);f&&this._focus(u);const I=N3(t.to),{config:A}=l,{decay:p,velocity:y}=A;(r||s)&&(A.velocity=0),t.config&&!I&&jhe(A,lo(t.config,o),t.config!==a.config?lo(a.config,o):void 0);let v=nc(this);if(!v||Je.und(u))return i(Cl(this,!0));const b=Je.und(t.reset)?s&&!t.default:!Je.und(d)&&E0(t.reset,o),w=b?d:this.get(),G=Zy(u),x=Je.num(G)||Je.arr(G)||Jw(G),B=!I&&(!x||E0(a.immediate||t.immediate,o));if(f){const F=T3(u);if(F!==v.constructor)if(B)v=this._set(G);else throw Error(`Cannot animate between ${v.constructor.name} and ${F.name}, as the "to" prop suggests`)}const R=v.constructor;let Z=rc(u),W=!1;if(!Z){const F=b||!jR(this)&&h;(f||F)&&(W=fg(Zy(w),G),Z=!W),(!fg(l.immediate,B)&&!B||!fg(A.decay,p)||!fg(A.velocity,y))&&(Z=!0)}if(W&&Bu(this)&&(l.changed&&!b?Z=!0:Z||this._stop(c)),!I&&((Z||rc(c))&&(l.values=v.getPayload(),l.toValues=rc(u)?null:R==hC?[1]:fo(G)),l.immediate!=B&&(l.immediate=B,!B&&!b&&this._set(c)),Z)){const{onRest:F}=l;Yt(nfe,V=>mH(this,t,V));const T=Cl(this,dm(this,c));n0(this._pendingCalls,T),this._pendingCalls.add(i),l.changed&&Mt.batchedUpdates(()=>{l.changed=!b,F==null||F(T,this),b?lo(a.onRest,T):l.onStart==null||l.onStart(T,this)})}b&&this._set(w),I?i(TJ(t.to,t,this._state,this)):Z?this._start():Bu(this)&&!f?this._pendingCalls.add(i):i(VJ(w))}_focus(e){const t=this.animation;e!==t.to&&(aH(this)&&this._detach(),t.to=e,aH(this)&&this._attach())}_attach(){let e=0;const{to:t}=this.animation;rc(t)&&(wv(t,this),H3(t)&&(e=t.priority+1)),this.priority=e}_detach(){const{to:e}=this.animation;rc(e)&&y2(e,this)}_set(e,t=!0){const i=xa(e);if(!Je.und(i)){const r=nc(this);if(!r||!fg(i,r.getValue())){const s=T3(i);!r||r.constructor!=s?kV(this,s.create(i)):r.setValue(i),r&&Mt.batchedUpdates(()=>{this._onChange(i,t)})}}return nc(this)}_onStart(){const e=this.animation;e.changed||(e.changed=!0,hm(this,"onStart",Cl(this,dm(this,e.to)),this))}_onChange(e,t){t||(this._onStart(),lo(this.animation.onChange,e,this)),lo(this.defaultProps.onChange,e,this),super._onChange(e,t)}_start(){const e=this.animation;nc(this).reset(xa(e.to)),e.immediate||(e.fromValues=e.values.map(t=>t.lastPosition)),Bu(this)||(AH(this,!0),um(this)||this._resume())}_resume(){xc.skipAnimation?this.finish():Uw.start(this)}_stop(e,t){if(Bu(this)){AH(this,!1);const i=this.animation;Yt(i.values,s=>{s.done=!0}),i.toValues&&(i.onChange=i.onPause=i.onResume=void 0),m2(this,{type:"idle",parent:this});const r=t?HA(this.get()):Cl(this.get(),dm(this,e??i.to));n0(this._pendingCalls,r),i.changed&&(i.changed=!1,hm(this,"onRest",r,this))}}}function dm(n,e){const t=Zy(e),i=Zy(n.get());return fg(i,t)}function kJ(n,e=n.loop,t=n.to){let i=lo(e);if(i){const r=i!==!0&&zV(i),s=(r||n).reverse,o=!r||r.reset;return Ey(Gi({},n,{loop:e,default:!1,pause:void 0,to:!s||N3(t)?t:void 0,from:o?n.from:void 0,reset:o},r))}}function Ey(n){const{to:e,from:t}=n=zV(n),i=new Set;return Je.obj(e)&&pH(e,i),Je.obj(t)&&pH(t,i),n.keys=i.size?Array.from(i):null,n}function tfe(n){const e=Ey(n);return Je.und(e.default)&&(e.default=qw(e)),e}function pH(n,e){Yg(n,(t,i)=>t!=null&&e.add(i))}const nfe=["onStart","onRest","onChange","onPause","onResume"];function mH(n,e,t){n.animation[t]=e[t]!==EJ(e,t)?MJ(e[t],n.key):void 0}function hm(n,e,...t){var i,r,s,o;(i=(r=n.animation)[e])==null||i.call(r,...t),(s=(o=n.defaultProps)[e])==null||s.call(o,...t)}const ife=["onStart","onChange","onRest"];let rfe=1,LJ=class{constructor(e,t){this.id=rfe++,this.springs={},this.queue=[],this.ref=void 0,this._flush=void 0,this._initialProps=void 0,this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._item=void 0,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),t&&(this._flush=t),e&&this.start(Gi({default:!0},e))}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(e=>e.idle&&!e.isDelayed&&!e.isPaused)}get item(){return this._item}set item(e){this._item=e}get(){const e={};return this.each((t,i)=>e[i]=t.get()),e}set(e){for(const t in e){const i=e[t];Je.und(i)||this.springs[t].set(i)}}update(e){return e&&this.queue.push(Ey(e)),this}start(e){let{queue:t}=this;return e?t=fo(e).map(Ey):this.queue=[],this._flush?this._flush(this,t):(KJ(this,t),Y3(this,t))}stop(e,t){if(e!==!!e&&(t=e),t){const i=this.springs;Yt(fo(t),r=>i[r].stop(!!e))}else My(this._state,this._lastAsyncId),this.each(i=>i.stop(!!e));return this}pause(e){if(Je.und(e))this.start({pause:!0});else{const t=this.springs;Yt(fo(e),i=>t[i].pause())}return this}resume(e){if(Je.und(e))this.start({pause:!1});else{const t=this.springs;Yt(fo(e),i=>t[i].resume())}return this}each(e){Yg(this.springs,e)}_onFrame(){const{onStart:e,onChange:t,onRest:i}=this._events,r=this._active.size>0,s=this._changed.size>0;(r&&!this._started||s&&!this._started)&&(this._started=!0,Z0(e,([l,c])=>{c.value=this.get(),l(c,this,this._item)}));const o=!r&&this._started,a=s||o&&i.size?this.get():null;s&&t.size&&Z0(t,([l,c])=>{c.value=a,l(c,this,this._item)}),o&&(this._started=!1,Z0(i,([l,c])=>{c.value=a,l(c,this,this._item)}))}eventObserved(e){if(e.type=="change")this._changed.add(e.parent),e.idle||this._active.add(e.parent);else if(e.type=="idle")this._active.delete(e.parent);else return;Mt.onFrame(this._onFrame)}};function Y3(n,e){return Promise.all(e.map(t=>HJ(n,t))).then(t=>XV(n,t))}async function HJ(n,e,t){const{keys:i,to:r,from:s,loop:o,onRest:a,onResolve:l}=e,c=Je.obj(e.default)&&e.default;o&&(e.loop=!1),r===!1&&(e.to=null),s===!1&&(e.from=null);const g=Je.arr(r)||Je.fun(r)?r:void 0;g?(e.to=void 0,e.onRest=void 0,c&&(c.onRest=void 0)):Yt(ife,I=>{const A=e[I];if(Je.fun(A)){const p=n._events[I];e[I]=({finished:y,cancelled:v})=>{const b=p.get(A);b?(y||(b.finished=!1),v&&(b.cancelled=!0)):p.set(A,{value:null,finished:y||!1,cancelled:v||!1})},c&&(c[I]=e[I])}});const u=n._state;e.pause===!u.paused?(u.paused=e.pause,n0(e.pause?u.pauseQueue:u.resumeQueue)):u.paused&&(e.pause=!0);const d=(i||Object.keys(n.springs)).map(I=>n.springs[I].start(e)),h=e.cancel===!0||EJ(e,"cancel")===!0;(g||h&&u.asyncId)&&d.push(_J(++n._lastAsyncId,{props:e,state:u,actions:{pause:W3,resume:W3,start(I,A){h?(My(u,n._lastAsyncId),A(HA(n))):(I.onRest=a,A(TJ(g,I,u,n)))}}})),u.paused&&await new Promise(I=>{u.resumeQueue.add(I)});const f=XV(n,await Promise.all(d));if(o&&f.finished&&!(t&&f.noop)){const I=kJ(e,o,r);if(I)return KJ(n,[I]),HJ(n,I,!0)}return l&&Mt.batchedUpdates(()=>l(f,n,n.item)),f}function K3(n,e){const t=Gi({},n.springs);return e&&Yt(fo(e),i=>{Je.und(i.keys)&&(i=Ey(i)),Je.obj(i.to)||(i=Gi({},i,{to:void 0})),YJ(t,i,r=>XJ(r))}),zJ(n,t),t}function zJ(n,e){Yg(e,(t,i)=>{n.springs[i]||(n.springs[i]=t,wv(t,n))})}function XJ(n,e){const t=new efe;return t.key=n,e&&wv(t,e),t}function YJ(n,e,t){e.keys&&Yt(e.keys,i=>{(n[i]||(n[i]=t(i)))._prepareNode(e)})}function KJ(n,e){Yt(e,t=>{YJ(n.springs,t,i=>XJ(i,n))})}function sfe(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}const ofe=["children"],Sv=n=>{let{children:e}=n,t=sfe(n,ofe);const i=M.useContext(B2),r=t.pause||!!i.pause,s=t.immediate||!!i.immediate;t=Nhe(()=>({pause:r,immediate:s}),[r,s]);const{Provider:o}=B2;return M.createElement(o,{value:t},e)},B2=afe(Sv,{});Sv.Provider=B2.Provider;Sv.Consumer=B2.Consumer;function afe(n,e){return Object.assign(n,M.createContext(e)),n.Provider._context=n,n.Consumer._context=n,n}const DJ=()=>{const n=[],e=function(r){Vhe();const s=[];return Yt(n,(o,a)=>{if(Je.und(r))s.push(o.start());else{const l=t(r,o,a);l&&s.push(o.start(l))}}),s};e.current=n,e.add=function(i){n.includes(i)||n.push(i)},e.delete=function(i){const r=n.indexOf(i);~r&&n.splice(r,1)},e.pause=function(){return Yt(n,i=>i.pause(...arguments)),this},e.resume=function(){return Yt(n,i=>i.resume(...arguments)),this},e.set=function(i){Yt(n,r=>r.set(i))},e.start=function(i){const r=[];return Yt(n,(s,o)=>{if(Je.und(i))r.push(s.start());else{const a=this._getProps(i,s,o);a&&r.push(s.start(a))}}),r},e.stop=function(){return Yt(n,i=>i.stop(...arguments)),this},e.update=function(i){return Yt(n,(r,s)=>r.update(this._getProps(i,r,s))),this};const t=function(r,s,o){return Je.fun(r)?r(o,s):r};return e._getProps=t,e};function lfe(n,e,t){const i=Je.fun(e)&&e;i&&!t&&(t=[]);const r=M.useMemo(()=>i||arguments.length==3?DJ():void 0,[]),s=M.useRef(0),o=TV(),a=M.useMemo(()=>({ctrls:[],queue:[],flush(p,y){const v=K3(p,y);return s.current>0&&!a.queue.length&&!Object.keys(v).some(w=>!p.springs[w])?Y3(p,y):new Promise(w=>{zJ(p,v),a.queue.push(()=>{w(Y3(p,y))}),o()})}}),[]),l=M.useRef([...a.ctrls]),c=[],g=V3(n)||0;M.useMemo(()=>{Yt(l.current.slice(n,g),p=>{k3(p,r),p.stop(!0)}),l.current.length=n,u(g,n)},[n]),M.useMemo(()=>{u(0,Math.min(g,n))},t);function u(p,y){for(let v=p;v<y;v++){const b=l.current[v]||(l.current[v]=new LJ(null,a.flush)),w=i?i(v,b):e[v];w&&(c[v]=tfe(w))}}const d=l.current.map((p,y)=>K3(p,c[y])),h=M.useContext(Sv),f=V3(h),I=h!==f&&WJ(h);Hh(()=>{s.current++,a.ctrls=l.current;const{queue:p}=a;p.length&&(a.queue=[],Yt(p,y=>y())),Yt(l.current,(y,v)=>{r==null||r.add(y),I&&y.start({default:h});const b=c[v];b&&(FJ(y,b.ref),y.ref?y.queue.push(b):y.start(b))})}),NV(()=>()=>{Yt(a.ctrls,p=>p.stop(!0))});const A=d.map(p=>Gi({},p));return r?[A,r]:A}function Tc(n,e){const t=Je.fun(n),[[i],r]=lfe(1,t?n:[n],t?e||[]:e);return t||arguments.length==2?[i,r]:i}let Ms;(function(n){n.MOUNT="mount",n.ENTER="enter",n.UPDATE="update",n.LEAVE="leave"})(Ms||(Ms={}));function cfe(n,e,t){const i=Je.fun(e)&&e,{reset:r,sort:s,trail:o=0,expires:a=!0,exitBeforeEnter:l=!1,onDestroyed:c,ref:g,config:u}=i?i():e,d=M.useMemo(()=>i||arguments.length==3?DJ():void 0,[]),h=fo(n),f=[],I=M.useRef(null),A=r?null:I.current;Hh(()=>{I.current=f}),NV(()=>(Yt(f,V=>{d==null||d.add(V.ctrl),V.ctrl.ref=d}),()=>{Yt(I.current,V=>{V.expired&&clearTimeout(V.expirationId),k3(V.ctrl,d),V.ctrl.stop(!0)})}));const p=ufe(h,i?i():e,A),y=r&&I.current||[];Hh(()=>Yt(y,({ctrl:V,item:z,key:U})=>{k3(V,d),lo(c,z,U)}));const v=[];if(A&&Yt(A,(V,z)=>{V.expired?(clearTimeout(V.expirationId),y.push(V)):(z=v[z]=p.indexOf(V.key),~z&&(f[z]=V))}),Yt(h,(V,z)=>{f[z]||(f[z]={key:p[z],item:V,phase:Ms.MOUNT,ctrl:new LJ},f[z].ctrl.item=V)}),v.length){let V=-1;const{leave:z}=i?i():e;Yt(v,(U,J)=>{const H=A[J];~U?(V=f.indexOf(H),f[V]=Gi({},H,{item:h[U]})):z&&f.splice(++V,0,H)})}Je.fun(s)&&f.sort((V,z)=>s(V.item,z.item));let b=-o;const w=TV(),G=qw(e),x=new Map,B=M.useRef(new Map),R=M.useRef(!1);Yt(f,(V,z)=>{const U=V.key,J=V.phase,H=i?i():e;let Y,K,Q=lo(H.delay||0,U);if(J==Ms.MOUNT)Y=H.enter,K=Ms.ENTER;else{const $=p.indexOf(U)<0;if(J!=Ms.LEAVE)if($)Y=H.leave,K=Ms.LEAVE;else if(Y=H.update)K=Ms.UPDATE;else return;else if(!$)Y=H.enter,K=Ms.ENTER;else return}if(Y=lo(Y,V.item,z),Y=Je.obj(Y)?zV(Y):{to:Y},!Y.config){const $=u||G.config;Y.config=lo($,V.item,z,K)}b+=o;const P=Gi({},G,{delay:Q+b,ref:g,immediate:H.immediate,reset:!1},Y);if(K==Ms.ENTER&&Je.und(P.from)){const $=i?i():e,de=Je.und($.initial)||A?$.from:$.initial;P.from=lo(de,V.item,z)}const{onResolve:ne}=P;P.onResolve=$=>{lo(ne,$);const de=I.current,ge=de.find(se=>se.key===U);if(ge&&!($.cancelled&&ge.phase!=Ms.UPDATE)&&ge.ctrl.idle){const se=de.every(k=>k.ctrl.idle);if(ge.phase==Ms.LEAVE){const k=lo(a,ge.item);if(k!==!1){const O=k===!0?0:k;if(ge.expired=!0,!se&&O>0){O<=2147483647&&(ge.expirationId=setTimeout(w,O));return}}}se&&de.some(k=>k.expired)&&(B.current.delete(ge),l&&(R.current=!0),w())}};const oe=K3(V.ctrl,P);K===Ms.LEAVE&&l?B.current.set(V,{phase:K,springs:oe,payload:P}):x.set(V,{phase:K,springs:oe,payload:P})});const Z=M.useContext(Sv),W=V3(Z),F=Z!==W&&WJ(Z);Hh(()=>{F&&Yt(f,V=>{V.ctrl.start({default:Z})})},[Z]),Yt(x,(V,z)=>{if(B.current.size){const U=f.findIndex(J=>J.key===z.key);f.splice(U,1)}}),Hh(()=>{Yt(B.current.size?B.current:x,({phase:V,payload:z},U)=>{const{ctrl:J}=U;U.phase=V,d==null||d.add(J),F&&V==Ms.ENTER&&J.start({default:Z}),z&&(FJ(J,z.ref),(J.ref||d)&&!R.current?J.update(z):(J.start(z),R.current&&(R.current=!1)))})},r?void 0:t);const T=V=>M.createElement(M.Fragment,null,f.map((z,U)=>{const{springs:J}=x.get(z)||z.ctrl,H=V(Gi({},J),z.item,z,U);return H&&H.type?M.createElement(H.type,Gi({},H.props,{key:Je.str(z.key)||Je.num(z.key)?z.key:z.ctrl.id,ref:H.ref})):H}));return d?[T,d]:T}let gfe=1;function ufe(n,{key:e,keys:t=e},i){if(t===null){const r=new Set;return n.map(s=>{const o=i&&i.find(a=>a.item===s&&a.phase!==Ms.LEAVE&&!r.has(a));return o?(r.add(o),o.key):gfe++})}return Je.und(t)?n:Je.fun(t)?n.map(t):fo(t)}class dfe extends YV{constructor(e,t){super(),this.key=void 0,this.idle=!0,this.calc=void 0,this._active=new Set,this.source=e,this.calc=Sy(...t);const i=this._get(),r=T3(i);kV(this,r.create(i))}advance(e){const t=this._get(),i=this.get();fg(t,i)||(nc(this).setValue(t),this._onChange(t,this.idle)),!this.idle&&yH(this._active)&&qR(this)}_get(){const e=Je.arr(this.source)?this.source.map(xa):fo(xa(this.source));return this.calc(...e)}_start(){this.idle&&!yH(this._active)&&(this.idle=!1,Yt(jw(this),e=>{e.done=!1}),xc.skipAnimation?(Mt.batchedUpdates(()=>this.advance()),qR(this)):Uw.start(this))}_attach(){let e=1;Yt(fo(this.source),t=>{rc(t)&&wv(t,this),H3(t)&&(t.idle||this._active.add(t),e=Math.max(e,t.priority+1))}),this.priority=e,this._start()}_detach(){Yt(fo(this.source),e=>{rc(e)&&y2(e,this)}),this._active.clear(),qR(this)}eventObserved(e){e.type=="change"?e.idle?this.advance():(this._active.add(e.parent),this._start()):e.type=="idle"?this._active.delete(e.parent):e.type=="priority"&&(this.priority=fo(this.source).reduce((t,i)=>Math.max(t,(H3(i)?i.priority:0)+1),0))}}function hfe(n){return n.idle!==!1}function yH(n){return!n.size||Array.from(n).every(hfe)}function qR(n){n.idle||(n.idle=!0,Yt(jw(n),e=>{e.done=!0}),m2(n,{type:"idle",parent:n}))}xc.assign({createStringInterpolator:SJ,to:(n,e)=>new dfe(n,e)});const ffe=["primitive"].concat(Object.keys(T4).filter(n=>/^[A-Z]/.test(n)).map(n=>n[0].toLowerCase()+n.slice(1)));xc.assign({createStringInterpolator:SJ,colors:uhe,frameLoop:"demand"});ide(()=>{Mt.advance()});const Ife=Dhe(ffe,{applyAnimatedValues:Sh}),_g=Ife.animated;function Afe(n,e,t){return Math.max(e,Math.min(n,t))}const as={toVector(n,e){return n===void 0&&(n=e),Array.isArray(n)?n:[n,n]},add(n,e){return[n[0]+e[0],n[1]+e[1]]},sub(n,e){return[n[0]-e[0],n[1]-e[1]]},addTo(n,e){n[0]+=e[0],n[1]+=e[1]},subTo(n,e){n[0]-=e[0],n[1]-=e[1]}};function vH(n,e,t){return e===0||Math.abs(e)===1/0?Math.pow(n,t*5):n*e*t/(e+t*n)}function bH(n,e,t,i=.15){return i===0?Afe(n,e,t):n<e?-vH(e-n,t-e,i)+e:n>t?+vH(n-t,t-e,i)+t:n}function Cfe(n,[e,t],[i,r]){const[[s,o],[a,l]]=n;return[bH(e,s,o,i),bH(t,a,l,r)]}function pfe(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function mfe(n){var e=pfe(n,"string");return typeof e=="symbol"?e:String(e)}function ro(n,e,t){return e=mfe(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function BH(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function Ii(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?BH(Object(t),!0).forEach(function(i){ro(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):BH(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}const PJ={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function GH(n){return n?n[0].toUpperCase()+n.slice(1):""}const yfe=["enter","leave"];function vfe(n=!1,e){return n&&!yfe.includes(e)}function bfe(n,e="",t=!1){const i=PJ[n],r=i&&i[e]||e;return"on"+GH(n)+GH(r)+(vfe(t,r)?"Capture":"")}const Bfe=["gotpointercapture","lostpointercapture"];function Gfe(n){let e=n.substring(2).toLowerCase();const t=!!~e.indexOf("passive");t&&(e=e.replace("passive",""));const i=Bfe.includes(e)?"capturecapture":"capture",r=!!~e.indexOf(i);return r&&(e=e.replace("capture","")),{device:e,capture:r,passive:t}}function wfe(n,e=""){const t=PJ[n],i=t&&t[e]||e;return n+i}function $w(n){return"touches"in n}function UJ(n){return $w(n)?"touch":"pointerType"in n?n.pointerType:"mouse"}function xfe(n){return Array.from(n.touches).filter(e=>{var t,i;return e.target===n.currentTarget||((t=n.currentTarget)===null||t===void 0||(i=t.contains)===null||i===void 0?void 0:i.call(t,e.target))})}function Sfe(n){return n.type==="touchend"||n.type==="touchcancel"?n.changedTouches:n.targetTouches}function QJ(n){return $w(n)?Sfe(n)[0]:n}function Rfe(n){return xfe(n).map(e=>e.identifier)}function $R(n){const e=QJ(n);return $w(n)?e.identifier:e.pointerId}function wH(n){const e=QJ(n);return[e.clientX,e.clientY]}function Zfe(n){const e={};if("buttons"in n&&(e.buttons=n.buttons),"shiftKey"in n){const{shiftKey:t,altKey:i,metaKey:r,ctrlKey:s}=n;Object.assign(e,{shiftKey:t,altKey:i,metaKey:r,ctrlKey:s})}return e}function G2(n,...e){return typeof n=="function"?n(...e):n}function Mfe(){}function Efe(...n){return n.length===0?Mfe:n.length===1?n[0]:function(){let e;for(const t of n)e=t.apply(this,arguments)||e;return e}}function xH(n,e){return Object.assign({},e,n||{})}const Wfe=32;class Ffe{constructor(e,t,i){this.ctrl=e,this.args=t,this.key=i,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:i,args:r}=this;t[i]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=r,e.axis=void 0,e.memo=void 0,e.elapsedTime=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,i=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=i.from?G2(i.from,t):t.offset,t.offset=t.lastOffset),t.startTime=t.timeStamp=e.timeStamp}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:i,shared:r}=this;t.args=this.args;let s=0;if(e&&(t.event=e,i.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,r.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,r.locked=!!document.pointerLockElement,Object.assign(r,Zfe(e)),r.down=r.pressed=r.buttons%2===1||r.touches>0,s=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const G=t._delta.map(Math.abs);as.addTo(t._distance,G)}this.axisIntent&&this.axisIntent(e);const[o,a]=t._movement,[l,c]=i.threshold,{_step:g,values:u}=t;if(i.hasCustomTransform?(g[0]===!1&&(g[0]=Math.abs(o)>=l&&u[0]),g[1]===!1&&(g[1]=Math.abs(a)>=c&&u[1])):(g[0]===!1&&(g[0]=Math.abs(o)>=l&&Math.sign(o)*l),g[1]===!1&&(g[1]=Math.abs(a)>=c&&Math.sign(a)*c)),t.intentional=g[0]!==!1||g[1]!==!1,!t.intentional)return;const d=[0,0];if(i.hasCustomTransform){const[G,x]=u;d[0]=g[0]!==!1?G-g[0]:0,d[1]=g[1]!==!1?x-g[1]:0}else d[0]=g[0]!==!1?o-g[0]:0,d[1]=g[1]!==!1?a-g[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(d);const h=t.offset,f=t._active&&!t._blocked||t.active;f&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=r[this.ingKey]=t._active,e&&(t.first&&("bounds"in i&&(t._bounds=G2(i.bounds,t)),this.setup&&this.setup()),t.movement=d,this.computeOffset()));const[I,A]=t.offset,[[p,y],[v,b]]=t._bounds;t.overflow=[I<p?-1:I>y?1:0,A<v?-1:A>b?1:0],t._movementBound[0]=t.overflow[0]?t._movementBound[0]===!1?t._movement[0]:t._movementBound[0]:!1,t._movementBound[1]=t.overflow[1]?t._movementBound[1]===!1?t._movement[1]:t._movementBound[1]:!1;const w=t._active?i.rubberband||[0,0]:[0,0];if(t.offset=Cfe(t._bounds,t.offset,w),t.delta=as.sub(t.offset,h),this.computeMovement(),f&&(!t.last||s>Wfe)){t.delta=as.sub(t.offset,h);const G=t.delta.map(Math.abs);as.addTo(t.distance,G),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&s>0&&(t.velocity=[G[0]/s,G[1]/s])}}emit(){const e=this.state,t=this.shared,i=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!i.triggerAllEvents)return;const r=this.handler(Ii(Ii(Ii({},t),e),{},{[this.aliasKey]:e.values}));r!==void 0&&(e.memo=r)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function _fe([n,e],t){const i=Math.abs(n),r=Math.abs(e);if(i>r&&i>t)return"x";if(r>i&&r>t)return"y"}class Vfe extends Ffe{constructor(...e){super(...e),ro(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=as.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=as.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,i=this.config;if(!t.axis&&e){const r=typeof i.axisThreshold=="object"?i.axisThreshold[UJ(e)]:i.axisThreshold;t.axis=_fe(t._movement,r)}t._blocked=(i.lockDirection||!!i.axis)&&!t.axis||!!i.axis&&i.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const Tfe=n=>n,SH=.15,OJ={enabled(n=!0){return n},eventOptions(n,e,t){return Ii(Ii({},t.shared.eventOptions),n)},preventDefault(n=!1){return n},triggerAllEvents(n=!1){return n},rubberband(n=0){switch(n){case!0:return[SH,SH];case!1:return[0,0];default:return as.toVector(n)}},from(n){if(typeof n=="function")return n;if(n!=null)return as.toVector(n)},transform(n,e,t){const i=n||t.shared.transform;return this.hasCustomTransform=!!i,i||Tfe},threshold(n){return as.toVector(n,0)}},Nfe=0,Rv=Ii(Ii({},OJ),{},{axis(n,e,{axis:t}){if(this.lockDirection=t==="lock",!this.lockDirection)return t},axisThreshold(n=Nfe){return n},bounds(n={}){if(typeof n=="function")return s=>Rv.bounds(n(s));if("current"in n)return()=>n.current;if(typeof HTMLElement=="function"&&n instanceof HTMLElement)return n;const{left:e=-1/0,right:t=1/0,top:i=-1/0,bottom:r=1/0}=n;return[[e,t],[i,r]]}}),RH={ArrowRight:(n,e=1)=>[n*e,0],ArrowLeft:(n,e=1)=>[-1*n*e,0],ArrowUp:(n,e=1)=>[0,-1*n*e],ArrowDown:(n,e=1)=>[0,n*e]};class kfe extends Vfe{constructor(...e){super(...e),ro(this,"ingKey","dragging")}reset(){super.reset();const e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){const e=this.state;if(e._bounds instanceof HTMLElement){const t=e._bounds.getBoundingClientRect(),i=e.currentTarget.getBoundingClientRect(),r={left:t.left-i.left+e.offset[0],right:t.right-i.right+e.offset[0],top:t.top-i.top+e.offset[1],bottom:t.bottom-i.bottom+e.offset[1]};e._bounds=Rv.bounds(r)}}cancel(){const e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){const t=this.config,i=this.state;if(e.buttons!=null&&(Array.isArray(t.pointerButtons)?!t.pointerButtons.includes(e.buttons):t.pointerButtons!==-1&&t.pointerButtons!==e.buttons))return;const r=this.ctrl.setEventIds(e);t.pointerCapture&&e.target.setPointerCapture(e.pointerId),!(r&&r.size>1&&i._pointerActive)&&(this.start(e),this.setupPointer(e),i._pointerId=$R(e),i._pointerActive=!0,this.computeValues(wH(e)),this.computeInitial(),t.preventScrollAxis&&UJ(e)!=="mouse"?(i._active=!1,this.setupScrollPrevention(e)):t.delay>0?(this.setupDelayTrigger(e),t.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){const t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}pointerMove(e){const t=this.state,i=this.config;if(!t._pointerActive||t.type===e.type&&e.timeStamp===t.timeStamp)return;const r=$R(e);if(t._pointerId!==void 0&&r!==t._pointerId)return;const s=wH(e);if(document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=as.sub(s,t._values),this.computeValues(s)),as.addTo(t._movement,t._delta),this.compute(e),t._delayed&&t.intentional){this.timeoutStore.remove("dragDelay"),t.active=!1,this.startPointerDrag(e);return}if(i.preventScrollAxis&&!t._preventScroll)if(t.axis)if(t.axis===i.preventScrollAxis||i.preventScrollAxis==="xy"){t._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(e);return}else return;this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch{}const t=this.state,i=this.config;if(!t._active||!t._pointerActive)return;const r=$R(e);if(t._pointerId!==void 0&&r!==t._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);const[s,o]=t._distance;if(t.tap=s<=i.tapsThreshold&&o<=i.tapsThreshold,t.tap&&i.filterTaps)t._force=!0;else{const[a,l]=t.direction,[c,g]=t.velocity,[u,d]=t.movement,[h,f]=i.swipe.velocity,[I,A]=i.swipe.distance,p=i.swipe.duration;t.elapsedTime<p&&(Math.abs(c)>h&&Math.abs(u)>I&&(t.swipe[0]=a),Math.abs(g)>f&&Math.abs(d)>A&&(t.swipe[1]=l))}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){const t=this.config,i=t.device;t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,i,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,i,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,i,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,Lfe(e);const t=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",t),this.eventStore.add(this.sharedConfig.window,"touch","cancel",t),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){const t=RH[e.key];if(t){const i=this.state,r=e.shiftKey?10:e.altKey?.1:1;this.start(e),i._delta=t(this.config.keyboardDisplacement,r),i._keyboardActive=!0,as.addTo(i._movement,i._delta),this.compute(e),this.emit()}}keyUp(e){e.key in RH&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){const t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function Lfe(n){"persist"in n&&typeof n.persist=="function"&&n.persist()}const Zv=typeof window<"u"&&window.document&&window.document.createElement;function Hfe(){return Zv&&"ontouchstart"in window}function ZH(){return Hfe()||Zv&&window.navigator.maxTouchPoints>1}function zfe(){return Zv&&"onpointerdown"in window}function Xfe(){return Zv&&"exitPointerLock"in window.document}function Yfe(){try{return"constructor"in GestureEvent}catch{return!1}}const Za={isBrowser:Zv,gesture:Yfe(),touch:ZH(),touchscreen:ZH(),pointer:zfe(),pointerLock:Xfe()},Kfe=250,Dfe=180,Pfe=.5,Ufe=50,Qfe=250,Ofe=10,MH={mouse:0,touch:0,pen:8},Jfe=Ii(Ii({},Rv),{},{device(n,e,{pointer:{touch:t=!1,lock:i=!1,mouse:r=!1}={}}){return this.pointerLock=i&&Za.pointerLock,Za.touch&&t?"touch":this.pointerLock?"mouse":Za.pointer&&!r?"pointer":Za.touch?"touch":"mouse"},preventScrollAxis(n,e,{preventScroll:t}){if(this.preventScrollDelay=typeof t=="number"?t:t||t===void 0&&n?Kfe:void 0,!(!Za.touchscreen||t===!1))return n||(t!==void 0?"y":void 0)},pointerCapture(n,e,{pointer:{capture:t=!0,buttons:i=1,keys:r=!0}={}}){return this.pointerButtons=i,this.keys=r,!this.pointerLock&&this.device==="pointer"&&t},threshold(n,e,{filterTaps:t=!1,tapsThreshold:i=3,axis:r=void 0}){const s=as.toVector(n,t?i:r?1:0);return this.filterTaps=t,this.tapsThreshold=i,s},swipe({velocity:n=Pfe,distance:e=Ufe,duration:t=Qfe}={}){return{velocity:this.transform(as.toVector(n)),distance:this.transform(as.toVector(e)),duration:t}},delay(n=0){switch(n){case!0:return Dfe;case!1:return 0;default:return n}},axisThreshold(n){return n?Ii(Ii({},MH),n):MH},keyboardDisplacement(n=Ofe){return n}});Ii(Ii({},OJ),{},{device(n,e,{shared:t,pointer:{touch:i=!1}={}}){if(t.target&&!Za.touch&&Za.gesture)return"gesture";if(Za.touch&&i)return"touch";if(Za.touchscreen){if(Za.pointer)return"pointer";if(Za.touch)return"touch"}},bounds(n,e,{scaleBounds:t={},angleBounds:i={}}){const r=o=>{const a=xH(G2(t,o),{min:-1/0,max:1/0});return[a.min,a.max]},s=o=>{const a=xH(G2(i,o),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof t!="function"&&typeof i!="function"?[r(),s()]:o=>[r(o),s(o)]},threshold(n,e,t){return this.lockDirection=t.axis==="lock",as.toVector(n,this.lockDirection?[.1,3]:0)},modifierKey(n){return n===void 0?"ctrlKey":n},pinchOnWheel(n=!0){return n}});Ii(Ii({},Rv),{},{mouseOnly:(n=!0)=>n});Ii(Ii({},Rv),{},{mouseOnly:(n=!0)=>n});const JJ=new Map,D3=new Map;function jfe(n){JJ.set(n.key,n.engine),D3.set(n.key,n.resolver)}const qfe={key:"drag",engine:kfe,resolver:Jfe};function $fe(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}function eIe(n,e){if(n==null)return{};var t=$fe(n,e),i,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(n,i)&&(t[i]=n[i])}return t}const tIe={target(n){if(n)return()=>"current"in n?n.current:n},enabled(n=!0){return n},window(n=Za.isBrowser?window:void 0){return n},eventOptions({passive:n=!0,capture:e=!1}={}){return{passive:n,capture:e}},transform(n){return n}},nIe=["target","eventOptions","window","enabled","transform"];function A1(n={},e){const t={};for(const[i,r]of Object.entries(e))switch(typeof r){case"function":t[i]=r.call(t,n[i],i,n);break;case"object":t[i]=A1(n[i],r);break;case"boolean":r&&(t[i]=n[i]);break}return t}function iIe(n,e,t={}){const i=n,{target:r,eventOptions:s,window:o,enabled:a,transform:l}=i,c=eIe(i,nIe);if(t.shared=A1({target:r,eventOptions:s,window:o,enabled:a,transform:l},tIe),e){const g=D3.get(e);t[e]=A1(Ii({shared:t.shared},c),g)}else for(const g in c){const u=D3.get(g);u&&(t[g]=A1(Ii({shared:t.shared},c[g]),u))}return t}class jJ{constructor(e,t){ro(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,i,r,s){const o=this._listeners,a=wfe(t,i),l=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},c=Ii(Ii({},l),s);e.addEventListener(a,r,c);const g=()=>{e.removeEventListener(a,r,c),o.delete(g)};return o.add(g),g}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class rIe{constructor(){ro(this,"_timeouts",new Map)}add(e,t,i=140,...r){this.remove(e),this._timeouts.set(e,window.setTimeout(t,i,...r))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class sIe{constructor(e){ro(this,"gestures",new Set),ro(this,"_targetEventStore",new jJ(this)),ro(this,"gestureEventStores",{}),ro(this,"gestureTimeoutStores",{}),ro(this,"handlers",{}),ro(this,"config",{}),ro(this,"pointerIds",new Set),ro(this,"touchIds",new Set),ro(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),oIe(this,e)}setEventIds(e){if($w(e))return this.touchIds=new Set(Rfe(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=iIe(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,i={};let r;if(!(t.target&&(r=t.target(),!r))){if(t.enabled){for(const o of this.gestures){const a=this.config[o],l=EH(i,a.eventOptions,!!r);if(a.enabled){const c=JJ.get(o);new c(this,e,o).bind(l)}}const s=EH(i,t.eventOptions,!!r);for(const o in this.nativeHandlers)s(o,"",a=>this.nativeHandlers[o](Ii(Ii({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const s in i)i[s]=Efe(...i[s]);if(!r)return i;for(const s in i){const{device:o,capture:a,passive:l}=Gfe(s);this._targetEventStore.add(r,o,"",i[s],{capture:a,passive:l})}}}}function GI(n,e){n.gestures.add(e),n.gestureEventStores[e]=new jJ(n,e),n.gestureTimeoutStores[e]=new rIe}function oIe(n,e){e.drag&&GI(n,"drag"),e.wheel&&GI(n,"wheel"),e.scroll&&GI(n,"scroll"),e.move&&GI(n,"move"),e.pinch&&GI(n,"pinch"),e.hover&&GI(n,"hover")}const EH=(n,e,t)=>(i,r,s,o={},a=!1)=>{var l,c;const g=(l=o.capture)!==null&&l!==void 0?l:e.capture,u=(c=o.passive)!==null&&c!==void 0?c:e.passive;let d=a?i:bfe(i,r,g);t&&u&&(d+="Passive"),n[d]=n[d]||[],n[d].push(s)};function aIe(n,e={},t,i){const r=L.useMemo(()=>new sIe(n),[]);if(r.applyHandlers(n,i),r.applyConfig(e,t),L.useEffect(r.effect.bind(r)),L.useEffect(()=>r.clean.bind(r),[]),e.target===void 0)return r.bind.bind(r)}function lIe(n,e){return jfe(qfe),aIe({drag:n},e||{},"drag")}const cIe=n=>(e,t,i)=>{const r=i.subscribe;return i.subscribe=(o,a,l)=>{let c=o;if(a){const g=(l==null?void 0:l.equalityFn)||Object.is;let u=o(i.getState());c=d=>{const h=o(d);if(!g(u,h)){const f=u;a(u=h,f)}},l!=null&&l.fireImmediately&&a(u,u)}return r(c)},n(e,t,i)};function Wy(n){"@babel/helpers - typeof";return Wy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wy(n)}function gIe(n,e){if(Wy(n)!=="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e||"default");if(Wy(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function uIe(n){var e=gIe(n,"string");return Wy(e)==="symbol"?e:String(e)}function nt(n,e,t){return e=uIe(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}const dIe=n=>n&&n.isCubeTexture;class hIe extends Rn{constructor(e,t){var i,r;const s=dIe(e),a=((i=s?(r=e.image[0])===null||r===void 0?void 0:r.width:e.image.width)!=null?i:1024)/4,l=Math.floor(Math.log2(a)),c=Math.pow(2,l),g=3*Math.max(c,16*7),u=4*c,d=[s?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/g}`,`#define CUBEUV_TEXEL_HEIGHT ${1/u}`,`#define CUBEUV_MAX_MIP ${l}.0`],h=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,f=d.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <encodings_fragment>
        }
        `,I={map:{value:e},height:{value:(t==null?void 0:t.height)||15},radius:{value:(t==null?void 0:t.radius)||100}},A=new NC(1,16),p=new Nt({uniforms:I,fragmentShader:f,vertexShader:h,side:Di});super(A,p)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}class fIe extends aa{constructor(e){super(),nt(this,"object",void 0),nt(this,"changeEvent",{type:"change"}),nt(this,"EPS",1e-6),nt(this,"enabled",!0),nt(this,"deviceOrientation",{alpha:0,beta:0,gamma:0}),nt(this,"screenOrientation",0),nt(this,"alphaOffset",0),nt(this,"onDeviceOrientationChangeEvent",t=>{this.deviceOrientation=t}),nt(this,"onScreenOrientationChangeEvent",()=>{this.screenOrientation=window.orientation||0}),nt(this,"zee",new D(0,0,1)),nt(this,"euler",new Hi),nt(this,"q0",new xn),nt(this,"q1",new xn(-Math.sqrt(.5),0,0,Math.sqrt(.5))),nt(this,"setObjectQuaternion",(t,i,r,s,o)=>{this.euler.set(r,i,-s,"YXZ"),t.setFromEuler(this.euler),t.multiply(this.q1),t.multiply(this.q0.setFromAxisAngle(this.zee,-o))}),nt(this,"connect",()=>{this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(t=>{t=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(t=>{console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",t)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0}),nt(this,"disconnect",()=>{window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.enabled=!1}),nt(this,"lastQuaternion",new xn),nt(this,"update",()=>{if(this.enabled===!1)return;const t=this.deviceOrientation;if(t){const i=t.alpha?ss.degToRad(t.alpha)+this.alphaOffset:0,r=t.beta?ss.degToRad(t.beta):0,s=t.gamma?ss.degToRad(t.gamma):0,o=this.screenOrientation?ss.degToRad(this.screenOrientation):0;this.setObjectQuaternion(this.object.quaternion,i,r,s,o),8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(this.changeEvent))}}),nt(this,"dispose",()=>this.disconnect()),this.object=e,this.object.rotation.reorder("YXZ"),this.connect()}}let ex=class{constructor(){nt(this,"enabled",!0),nt(this,"needsSwap",!0),nt(this,"clear",!1),nt(this,"renderToScreen",!1)}setSize(e,t){}render(e,t,i,r,s){console.error("THREE.Pass: .render() must be implemented in derived pass.")}};class IIe{constructor(e){nt(this,"camera",new _c(-1,1,1,-1,0,1)),nt(this,"geometry",new Fc(2,2)),nt(this,"mesh",void 0),this.mesh=new Rn(this.geometry,e)}get material(){return this.mesh.material}set material(e){this.mesh.material=e}dispose(){this.mesh.geometry.dispose()}render(e){e.render(this.mesh,this.camera)}}let P3=class extends ex{constructor(e,t="tDiffuse"){super(),nt(this,"textureID",void 0),nt(this,"uniforms",void 0),nt(this,"material",void 0),nt(this,"fsQuad",void 0),this.textureID=t,e instanceof Nt?(this.uniforms=e.uniforms,this.material=e):(this.uniforms=Ew.clone(e.uniforms),this.material=new Nt({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new IIe(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}};const WH={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","	vec4 texel = texture2D( tDiffuse, vUv );","	gl_FragColor = opacity * texel;","}"].join(`
`)};let FH=class extends ex{constructor(e,t){super(),nt(this,"scene",void 0),nt(this,"camera",void 0),nt(this,"inverse",void 0),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const r=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),s.buffers.stencil.setFunc(r.ALWAYS,o,4294967295),s.buffers.stencil.setClear(a),s.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(r.EQUAL,1,4294967295),s.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),s.buffers.stencil.setLocked(!0)}},AIe=class extends ex{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}},CIe=class{constructor(e,t){if(nt(this,"renderer",void 0),nt(this,"_pixelRatio",void 0),nt(this,"_width",void 0),nt(this,"_height",void 0),nt(this,"renderTarget1",void 0),nt(this,"renderTarget2",void 0),nt(this,"writeBuffer",void 0),nt(this,"readBuffer",void 0),nt(this,"renderToScreen",void 0),nt(this,"passes",[]),nt(this,"copyPass",void 0),nt(this,"clock",void 0),this.renderer=e,t===void 0){const i={minFilter:ut,magFilter:ut,format:Yn},r=e.getSize(new pe);this._pixelRatio=e.getPixelRatio(),this._width=r.width,this._height=r.height,t=new Qt(this._width*this._pixelRatio,this._height*this._pixelRatio,i),t.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,WH===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),P3===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new P3(WH),this.clock=new Kw}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;const r=this.passes.length;for(let s=0;s<r;s++){const o=this.passes[s];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),o.needsSwap){if(i){const a=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}FH!==void 0&&(o instanceof FH?i=!0:o instanceof AIe&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new pe);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(i,r),this.renderTarget2.setSize(i,r);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(i,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}},pIe=class extends ex{constructor(e,t,i,r,s=0){super(),nt(this,"scene",void 0),nt(this,"camera",void 0),nt(this,"overrideMaterial",void 0),nt(this,"clearColor",void 0),nt(this,"clearAlpha",void 0),nt(this,"clearDepth",!1),nt(this,"_oldClearColor",new Ke),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=r,this.clearAlpha=s,this.clear=!0,this.needsSwap=!1}render(e,t,i){let r=e.autoClear;e.autoClear=!1;let s,o=null;this.overrideMaterial!==void 0&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),s=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,s),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=o),e.autoClear=r}};class tx extends Qs{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new BIe(t)}),this.register(function(t){return new MIe(t)}),this.register(function(t){return new EIe(t)}),this.register(function(t){return new wIe(t)}),this.register(function(t){return new xIe(t)}),this.register(function(t){return new SIe(t)}),this.register(function(t){return new RIe(t)}),this.register(function(t){return new bIe(t)}),this.register(function(t){return new ZIe(t)}),this.register(function(t){return new GIe(t)}),this.register(function(t){return new yIe(t)}),this.register(function(t){return new WIe(t)})}load(e,t,i,r){const s=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=yc.extractUrlBase(e),this.manager.itemStart(e);const a=function(c){r?r(c):console.error(c),s.manager.itemError(e),s.manager.itemEnd(e)},l=new na(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{s.parse(c,o,function(g){t(g),s.manager.itemEnd(e)},a)}catch(g){a(g)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,r){let s;const o={},a={};if(typeof e=="string")s=e;else if(yc.decodeText(new Uint8Array(e,0,4))===qJ){try{o[qt.KHR_BINARY_GLTF]=new FIe(e)}catch(u){r&&r(u);return}s=o[qt.KHR_BINARY_GLTF].content}else s=yc.decodeText(new Uint8Array(e));const l=JSON.parse(s);if(l.asset===void 0||l.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new PIe(l,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let g=0;g<this.pluginCallbacks.length;g++){const u=this.pluginCallbacks[g](c);a[u.name]=u,o[u.name]=!0}if(l.extensionsUsed)for(let g=0;g<l.extensionsUsed.length;++g){const u=l.extensionsUsed[g],d=l.extensionsRequired||[];switch(u){case qt.KHR_MATERIALS_UNLIT:o[u]=new vIe;break;case qt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[u]=new TIe;break;case qt.KHR_DRACO_MESH_COMPRESSION:o[u]=new _Ie(l,this.dracoLoader);break;case qt.KHR_TEXTURE_TRANSFORM:o[u]=new VIe;break;case qt.KHR_MESH_QUANTIZATION:o[u]=new NIe;break;default:d.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(i,r)}parseAsync(e,t){const i=this;return new Promise(function(r,s){i.parse(e,t,r,s)})}}function mIe(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const qt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class yIe{constructor(e){this.parser=e,this.name=qt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,r=t.length;i<r;i++){const s=t[i];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let r=t.cache.get(i);if(r)return r;const s=t.json,l=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let c;const g=new Ke(16777215);l.color!==void 0&&g.fromArray(l.color);const u=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new fV(g),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new hV(g),c.distance=u;break;case"spot":c=new dV(g),c.distance=u,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),r=Promise.resolve(c),t.cache.add(i,r),r}createNodeAttachment(e){const t=this,i=this.parser,s=i.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return i._getNodeRef(t.cache,a,l)})}}class vIe{constructor(){this.name=qt.KHR_MATERIALS_UNLIT}getMaterialType(){return os}extendParams(e,t,i){const r=[];e.color=new Ke(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}s.baseColorTexture!==void 0&&r.push(i.assignTexture(e,"map",s.baseColorTexture,Xt))}return Promise.all(r)}}class bIe{constructor(e){this.parser=e,this.name=qt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class BIe{constructor(e){this.parser=e,this.name=qt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(s.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new pe(a,a)}return Promise.all(s)}}class GIe{constructor(e){this.parser=e,this.name=qt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&s.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&s.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class wIe{constructor(e){this.parser=e,this.name=qt.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new Ke(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=r.extensions[this.name];return o.sheenColorFactor!==void 0&&t.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&s.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,Xt)),o.sheenRoughnessTexture!==void 0&&s.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class xIe{constructor(e){this.parser=e,this.name=qt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&s.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class SIe{constructor(e){this.parser=e,this.name=qt.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&s.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new Ke(a[0],a[1],a[2]),Promise.all(s)}}class RIe{constructor(e){this.parser=e,this.name=qt.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vc}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class ZIe{constructor(e){this.parser=e,this.name=qt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&s.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new Ke(a[0],a[1],a[2]),o.specularColorTexture!==void 0&&s.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,Xt)),Promise.all(s)}}class MIe{constructor(e){this.parser=e,this.name=qt.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,r=i.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,o)}}class EIe{constructor(e){this.parser=e,this.name=qt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=r.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class WIe{constructor(e){this.name=qt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const r=i.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const l=r.byteOffset||0,c=r.byteLength||0,g=r.count,u=r.byteStride,d=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(g,u,d,r.mode,r.filter).then(function(h){return h.buffer}):o.ready.then(function(){const h=new ArrayBuffer(g*u);return o.decodeGltfBuffer(new Uint8Array(h),g,u,d,r.mode,r.filter),h})})}else return null}}const qJ="glTF",fm=12,_H={JSON:1313821514,BIN:5130562};class FIe{constructor(e){this.name=qt.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,fm);if(this.header={magic:yc.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==qJ)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-fm,r=new DataView(e,fm);let s=0;for(;s<i;){const o=r.getUint32(s,!0);s+=4;const a=r.getUint32(s,!0);if(s+=4,a===_H.JSON){const l=new Uint8Array(e,fm+s,o);this.content=yc.decodeText(l)}else if(a===_H.BIN){const l=fm+s;this.body=e.slice(l,l+o)}s+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class _Ie{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=qt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const g in o){const u=Q3[g]||g.toLowerCase();a[u]=o[g]}for(const g in e.attributes){const u=Q3[g]||g.toLowerCase();if(o[g]!==void 0){const d=i.accessors[e.attributes[g]],h=Fy[d.componentType];c[u]=h.name,l[u]=d.normalized===!0}}return t.getDependency("bufferView",s).then(function(g){return new Promise(function(u){r.decodeDracoFile(g,function(d){for(const h in d.attributes){const f=d.attributes[h],I=l[h];I!==void 0&&(f.normalized=I)}u(d)},a,c)})})}}class VIe{constructor(){this.name=qt.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class U3 extends Sf{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),i=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),a={specular:{value:new Ke().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(l){for(const c in a)l.uniforms[c]=a[c];l.fragmentShader=l.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",i).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(l){a.specular.value=l}},specularMap:{get:function(){return a.specularMap.value},set:function(l){a.specularMap.value=l,l?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(l){a.glossiness.value=l}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(l){a.glossinessMap.value=l,l?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class TIe{constructor(){this.name=qt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return U3}extendParams(e,t,i){const r=t.extensions[this.name];e.color=new Ke(1,1,1),e.opacity=1;const s=[];if(Array.isArray(r.diffuseFactor)){const o=r.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(r.diffuseTexture!==void 0&&s.push(i.assignTexture(e,"map",r.diffuseTexture,Xt)),e.emissive=new Ke(0,0,0),e.glossiness=r.glossinessFactor!==void 0?r.glossinessFactor:1,e.specular=new Ke(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),r.specularGlossinessTexture!==void 0){const o=r.specularGlossinessTexture;s.push(i.assignTexture(e,"glossinessMap",o)),s.push(i.assignTexture(e,"specularMap",o,Xt))}return Promise.all(s)}createMaterial(e){const t=new U3(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=Wc,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}class NIe{constructor(){this.name=qt.KHR_MESH_QUANTIZATION}}class $J extends LC{constructor(e,t,i,r){super(e,t,i,r)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let o=0;o!==r;o++)t[o]=i[s+o];return t}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,g=r-t,u=(i-t)/g,d=u*u,h=d*u,f=e*c,I=f-c,A=-2*h+3*d,p=h-d,y=1-A,v=p-d+u;for(let b=0;b!==a;b++){const w=o[I+b+a],G=o[I+b+l]*g,x=o[f+b+a],B=o[f+b]*g;s[b]=y*w+v*G+A*x+p*B}return s}}const kIe=new xn;class LIe extends $J{interpolate_(e,t,i,r){const s=super.interpolate_(e,t,i,r);return kIe.fromArray(s).normalize().toArray(s),s}}const tg={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Fy={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},VH={9728:Zt,9729:ut,9984:Ay,9985:xw,9986:VA,9987:wc},TH={33071:Ki,33648:rC,10497:ds},NH={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Q3={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Gu={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},HIe={CUBICSPLINE:void 0,LINEAR:hf,STEP:sC},eZ={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function zIe(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new Sf({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:wo})),n.DefaultMaterial}function Im(n,e,t){for(const i in t.extensions)n[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function vh(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function XIe(n,e,t){let i=!1,r=!1,s=!1;for(let c=0,g=e.length;c<g;c++){const u=e[c];if(u.POSITION!==void 0&&(i=!0),u.NORMAL!==void 0&&(r=!0),u.COLOR_0!==void 0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(n);const o=[],a=[],l=[];for(let c=0,g=e.length;c<g;c++){const u=e[c];if(i){const d=u.POSITION!==void 0?t.getDependency("accessor",u.POSITION):n.attributes.position;o.push(d)}if(r){const d=u.NORMAL!==void 0?t.getDependency("accessor",u.NORMAL):n.attributes.normal;a.push(d)}if(s){const d=u.COLOR_0!==void 0?t.getDependency("accessor",u.COLOR_0):n.attributes.color;l.push(d)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const g=c[0],u=c[1],d=c[2];return i&&(n.morphAttributes.position=g),r&&(n.morphAttributes.normal=u),s&&(n.morphAttributes.color=d),n.morphTargetsRelative=!0,n})}function YIe(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let i=0,r=t.length;i<r;i++)n.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function KIe(n){const e=n.extensions&&n.extensions[qt.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+kH(e.attributes):t=n.indices+":"+kH(n.attributes)+":"+n.mode,t}function kH(n){let e="";const t=Object.keys(n).sort();for(let i=0,r=t.length;i<r;i++)e+=t[i]+":"+n[t[i]]+";";return e}function O3(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function DIe(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class PIe{constructor(e={},t={}){var i,r;this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new mIe,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const s=typeof navigator<"u"&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,o=typeof navigator<"u"&&((i=navigator.userAgent)===null||i===void 0?void 0:i.indexOf("Firefox"))>-1,a=typeof navigator<"u"&&o?(r=navigator.userAgent)===null||r===void 0?void 0:r.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap>"u"||s||o&&a<98?this.textureLoader=new gV(this.options.manager):this.textureLoader=new E4(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new na(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,r=this.json,s=this.extensions;this.cache.removeAll(),this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][r.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:r.asset,parser:i,userData:{}};Im(s,a,r),vh(a,r),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let r=0,s=t.length;r<s;r++){const o=t[r].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const o=e[r];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const r=i.clone(),s=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,g]of o.children.entries())s(g,a.children[c])};return s(i,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const r=e(t[i]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let r=0;r<t.length;r++){const s=e(t[r]);s&&i.push(s)}return i}getDependency(e,t){const i=e+":"+t;let r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(i,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(s,o){return i.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[qt.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,o){i.load(yc.resolveURL(t.uri,r.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const r=t.byteLength||0,s=t.byteOffset||0;return i.slice(s,s+r)})}loadAccessor(e){const t=this,i=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0)return Promise.resolve(null);const s=[];return r.bufferView!==void 0?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),r.sparse!==void 0&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(o){const a=o[0],l=NH[r.type],c=Fy[r.componentType],g=c.BYTES_PER_ELEMENT,u=g*l,d=r.byteOffset||0,h=r.bufferView!==void 0?i.bufferViews[r.bufferView].byteStride:void 0,f=r.normalized===!0;let I,A;if(h&&h!==u){const p=Math.floor(d/h),y="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+p+":"+r.count;let v=t.cache.get(y);v||(I=new c(a,p*h,r.count*h/g),v=new lv(I,h/g),t.cache.add(y,v)),A=new pd(v,l,d%h/g,f)}else a===null?I=new c(r.count*l):I=new c(a,d,r.count*l),A=new Pt(I,l,f);if(r.sparse!==void 0){const p=NH.SCALAR,y=Fy[r.sparse.indices.componentType],v=r.sparse.indices.byteOffset||0,b=r.sparse.values.byteOffset||0,w=new y(o[1],v,r.sparse.count*p),G=new c(o[2],b,r.sparse.count*l);a!==null&&(A=new Pt(A.array.slice(),A.itemSize,A.normalized));for(let x=0,B=w.length;x<B;x++){const R=w[x];if(A.setX(R,G[x*l]),l>=2&&A.setY(R,G[x*l+1]),l>=3&&A.setZ(R,G[x*l+2]),l>=4&&A.setW(R,G[x*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return A})}loadTexture(e){const t=this.json,i=this.options,s=t.textures[e].source,o=t.images[s];let a=this.textureLoader;if(o.uri){const l=i.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,t,i){const r=this,s=this.json,o=s.textures[e],a=s.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,i).then(function(g){g.flipY=!1,o.name&&(g.name=o.name);const d=(s.samplers||{})[o.sampler]||{};return g.magFilter=VH[d.magFilter]||ut,g.minFilter=VH[d.minFilter]||wc,g.wrapS=TH[d.wrapS]||ds,g.wrapT=TH[d.wrapT]||ds,r.associations.set(g,{textures:e}),g}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const i=this,r=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const o=r.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=i.getDependency("bufferView",o.bufferView).then(function(u){c=!0;const d=new Blob([u],{type:o.mimeType});return l=a.createObjectURL(d),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const g=Promise.resolve(l).then(function(u){return new Promise(function(d,h){let f=d;t.isImageBitmapLoader===!0&&(f=function(I){const A=new Pn(I);A.needsUpdate=!0,d(A)}),t.load(yc.resolveURL(u,s.path),f,void 0,h)})}).then(function(u){return c===!0&&a.revokeObjectURL(l),u.userData.mimeType=o.mimeType||DIe(o.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),u});return this.sourceCache[e]=g,g}assignTexture(e,t,i,r){const s=this;return this.getDependency("texture",i.index).then(function(o){if(i.texCoord!==void 0&&i.texCoord!=0&&!(t==="aoMap"&&i.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+t+" not yet supported."),s.extensions[qt.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[qt.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=s.associations.get(o);o=s.extensions[qt.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),s.associations.set(o,l)}}return r!==void 0&&(o.encoding=r),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const r=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new kw,ai.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new Cs,ai.prototype.copy.call(l,i),l.color.copy(i.color),this.cache.add(a,l)),i=l}if(r||s||o){let a="ClonedMaterial:"+i.uuid+":";i.isGLTFSpecularGlossinessMaterial&&(a+="specular-glossiness:"),r&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),s&&(l.vertexColors=!0),o&&(l.flatShading=!0),r&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}i.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=i}getMaterialType(){return Sf}loadMaterial(e){const t=this,i=this.json,r=this.extensions,s=i.materials[e];let o;const a={},l=s.extensions||{},c=[];if(l[qt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const u=r[qt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=u.getMaterialType(),c.push(u.extendParams(a,s,t))}else if(l[qt.KHR_MATERIALS_UNLIT]){const u=r[qt.KHR_MATERIALS_UNLIT];o=u.getMaterialType(),c.push(u.extendParams(a,s,t))}else{const u=s.pbrMetallicRoughness||{};if(a.color=new Ke(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const d=u.baseColorFactor;a.color.fromArray(d),a.opacity=d[3]}u.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",u.baseColorTexture,Xt)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),o=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(e,a)})))}s.doubleSided===!0&&(a.side=Di);const g=s.alphaMode||eZ.OPAQUE;if(g===eZ.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,g===eZ.MASK&&(a.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&o!==os&&(c.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new pe(1,1),s.normalTexture.scale!==void 0)){const u=s.normalTexture.scale;a.normalScale.set(u,u)}return s.occlusionTexture!==void 0&&o!==os&&(c.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&o!==os&&(a.emissive=new Ke().fromArray(s.emissiveFactor)),s.emissiveTexture!==void 0&&o!==os&&c.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture,Xt)),Promise.all(c).then(function(){let u;return o===U3?u=r[qt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):u=new o(a),s.name&&(u.name=s.name),vh(u,s),t.associations.set(u,{materials:e}),s.extensions&&Im(r,u,s),u})}createUniqueName(e){const t=an.sanitizeNodeName(e||"");let i=t;for(let r=1;this.nodeNamesUsed[i];++r)i=t+"_"+r;return this.nodeNamesUsed[i]=!0,i}loadGeometries(e){const t=this,i=this.extensions,r=this.primitiveCache;function s(a){return i[qt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return LH(l,a,t)})}const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],g=KIe(c),u=r[g];if(u)o.push(u.promise);else{let d;c.extensions&&c.extensions[qt.KHR_DRACO_MESH_COMPRESSION]?d=s(c):d=LH(new Et,c,t),r[g]={primitive:c,promise:d},o.push(d)}}return Promise.all(o)}loadMesh(e){const t=this,i=this.json,r=this.extensions,s=i.meshes[e],o=s.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const g=o[l].material===void 0?zIe(this.cache):this.getDependency("material",o[l].material);a.push(g)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),g=l[l.length-1],u=[];for(let h=0,f=g.length;h<f;h++){const I=g[h],A=o[h];let p;const y=c[h];if(A.mode===tg.TRIANGLES||A.mode===tg.TRIANGLE_STRIP||A.mode===tg.TRIANGLE_FAN||A.mode===void 0)p=s.isSkinnedMesh===!0?new K_(I,y):new Rn(I,y),p.isSkinnedMesh===!0&&!p.geometry.attributes.skinWeight.normalized&&p.normalizeSkinWeights(),A.mode===tg.TRIANGLE_STRIP?p.geometry=HH(p.geometry,ZO):A.mode===tg.TRIANGLE_FAN&&(p.geometry=HH(p.geometry,__));else if(A.mode===tg.LINES)p=new Ml(I,y);else if(A.mode===tg.LINE_STRIP)p=new Xg(I,y);else if(A.mode===tg.LINE_LOOP)p=new D_(I,y);else if(A.mode===tg.POINTS)p=new P_(I,y);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+A.mode);Object.keys(p.geometry.morphAttributes).length>0&&YIe(p,s),p.name=t.createUniqueName(s.name||"mesh_"+e),vh(p,s),A.extensions&&Im(r,p,A),t.assignFinalMaterial(p),u.push(p)}for(let h=0,f=u.length;h<f;h++)t.associations.set(u[h],{meshes:e,primitives:h});if(u.length===1)return u[0];const d=new ho;t.associations.set(d,{meshes:e});for(let h=0,f=u.length;h<f;h++)d.add(u[h]);return d})}loadCamera(e){let t;const i=this.json.cameras[e],r=i[i.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new zn(ss.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):i.type==="orthographic"&&(t=new _c(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),vh(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then(function(r){return i.inverseBindMatrices=r,i})}loadAnimation(e){const i=this.json.animations[e],r=[],s=[],o=[],a=[],l=[];for(let c=0,g=i.channels.length;c<g;c++){const u=i.channels[c],d=i.samplers[u.sampler],h=u.target,f=h.node,I=i.parameters!==void 0?i.parameters[d.input]:d.input,A=i.parameters!==void 0?i.parameters[d.output]:d.output;r.push(this.getDependency("node",f)),s.push(this.getDependency("accessor",I)),o.push(this.getDependency("accessor",A)),a.push(d),l.push(h)}return Promise.all([Promise.all(r),Promise.all(s),Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const g=c[0],u=c[1],d=c[2],h=c[3],f=c[4],I=[];for(let p=0,y=g.length;p<y;p++){const v=g[p],b=u[p],w=d[p],G=h[p],x=f[p];if(v===void 0)continue;v.updateMatrix();let B;switch(Gu[x.path]){case Gu.weights:B=lC;break;case Gu.rotation:B=md;break;case Gu.position:case Gu.scale:default:B=cC;break}const R=v.name?v.name:v.uuid,Z=G.interpolation!==void 0?HIe[G.interpolation]:hf,W=[];Gu[x.path]===Gu.weights?v.traverse(function(T){T.morphTargetInfluences&&W.push(T.name?T.name:T.uuid)}):W.push(R);let F=w.array;if(w.normalized){const T=O3(F.constructor),V=new Float32Array(F.length);for(let z=0,U=F.length;z<U;z++)V[z]=F[z]*T;F=V}for(let T=0,V=W.length;T<V;T++){const z=new B(W[T]+"."+Gu[x.path],b.array,F,Z);G.interpolation==="CUBICSPLINE"&&(z.createInterpolant=function(J){const H=this instanceof md?LIe:$J;return new H(this.times,this.values,this.getValueSize()/3,J)},z.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),I.push(z)}}const A=i.name?i.name:"animation_"+e;return new gC(A,void 0,I)})}createNodeMesh(e){const t=this.json,i=this,r=t.nodes[e];return r.mesh===void 0?null:i.getDependency("mesh",r.mesh).then(function(s){const o=i._getNodeRef(i.meshCache,r.mesh,s);return r.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=r.weights.length;l<c;l++)a.morphTargetInfluences[l]=r.weights[l]}),o})}loadNode(e){const t=this.json,i=this.extensions,r=this,s=t.nodes[e],o=s.name?r.createUniqueName(s.name):"";return function(){const a=[],l=r._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),s.camera!==void 0&&a.push(r.getDependency("camera",s.camera).then(function(c){return r._getNodeRef(r.cameraCache,s.camera,c)})),r._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),Promise.all(a)}().then(function(a){let l;if(s.isBone===!0?l=new Nw:a.length>1?l=new ho:a.length===1?l=a[0]:l=new In,l!==a[0])for(let c=0,g=a.length;c<g;c++)l.add(a[c]);if(s.name&&(l.userData.name=s.name,l.name=o),vh(l,s),s.extensions&&Im(i,l,s),s.matrix!==void 0){const c=new qe;c.fromArray(s.matrix),l.applyMatrix4(c)}else s.translation!==void 0&&l.position.fromArray(s.translation),s.rotation!==void 0&&l.quaternion.fromArray(s.rotation),s.scale!==void 0&&l.scale.fromArray(s.scale);return r.associations.has(l)||r.associations.set(l,{}),r.associations.get(l).nodes=e,l})}loadScene(e){const t=this.json,i=this.extensions,r=this.json.scenes[e],s=this,o=new ho;r.name&&(o.name=s.createUniqueName(r.name)),vh(o,r),r.extensions&&Im(i,o,r);const a=r.nodes||[],l=[];for(let c=0,g=a.length;c<g;c++)l.push(ej(a[c],o,t,s));return Promise.all(l).then(function(){const c=g=>{const u=new Map;for(const[d,h]of s.associations)(d instanceof ai||d instanceof Pn)&&u.set(d,h);return g.traverse(d=>{const h=s.associations.get(d);h!=null&&u.set(d,h)}),u};return s.associations=c(o),o})}}function ej(n,e,t,i){const r=t.nodes[n];return i.getDependency("node",n).then(function(s){if(r.skin===void 0)return s;let o;return i.getDependency("skin",r.skin).then(function(a){o=a;const l=[];for(let c=0,g=o.joints.length;c<g;c++)l.push(i.getDependency("node",o.joints[c]));return Promise.all(l)}).then(function(a){return s.traverse(function(l){if(!l.isMesh)return;const c=[],g=[];for(let u=0,d=a.length;u<d;u++){const h=a[u];if(h){c.push(h);const f=new qe;o.inverseBindMatrices!==void 0&&f.fromArray(o.inverseBindMatrices.array,u*16),g.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',o.joints[u])}l.bind(new cv(c,g),l.matrixWorld)}),s})}).then(function(s){e.add(s);const o=[];if(r.children){const a=r.children;for(let l=0,c=a.length;l<c;l++){const g=a[l];o.push(ej(g,s,t,i))}}return Promise.all(o)})}function UIe(n,e,t){const i=e.attributes,r=new Us;if(i.POSITION!==void 0){const a=t.json.accessors[i.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(r.set(new D(l[0],l[1],l[2]),new D(c[0],c[1],c[2])),a.normalized){const g=O3(Fy[a.componentType]);r.min.multiplyScalar(g),r.max.multiplyScalar(g)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const a=new D,l=new D;for(let c=0,g=s.length;c<g;c++){const u=s[c];if(u.POSITION!==void 0){const d=t.json.accessors[u.POSITION],h=d.min,f=d.max;if(h!==void 0&&f!==void 0){if(l.setX(Math.max(Math.abs(h[0]),Math.abs(f[0]))),l.setY(Math.max(Math.abs(h[1]),Math.abs(f[1]))),l.setZ(Math.max(Math.abs(h[2]),Math.abs(f[2]))),d.normalized){const I=O3(Fy[d.componentType]);l.multiplyScalar(I)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(a)}n.boundingBox=r;const o=new Zl;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,n.boundingSphere=o}function LH(n,e,t){const i=e.attributes,r=[];function s(o,a){return t.getDependency("accessor",o).then(function(l){n.setAttribute(a,l)})}for(const o in i){const a=Q3[o]||o.toLowerCase();a in n.attributes||r.push(s(i[o],a))}if(e.indices!==void 0&&!n.index){const o=t.getDependency("accessor",e.indices).then(function(a){n.setIndex(a)});r.push(o)}return vh(n,e),UIe(n,e,t),Promise.all(r).then(function(){return e.targets!==void 0?XIe(n,e.targets,t):n})}function HH(n,e){let t=n.getIndex();if(t===null){const o=[],a=n.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);n.setIndex(o),t=n.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const i=t.count-2,r=[];if(e===__)for(let o=1;o<=i;o++)r.push(t.getX(0)),r.push(t.getX(o)),r.push(t.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(r.push(t.getX(o)),r.push(t.getX(o+1)),r.push(t.getX(o+2))):(r.push(t.getX(o+2)),r.push(t.getX(o+1)),r.push(t.getX(o)));r.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=n.clone();return s.setIndex(r),s}const yi={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function tj(n){const e=await fetch(n);if(e.ok)return e.json();throw new Error(e.statusText)}async function QIe(n){if(!n)throw new Error("No basePath supplied");return await tj(`${n}/profilesList.json`)}async function OIe(n,e,t=null,i=!0){if(!n)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const r=await QIe(e);let s;if(n.profiles.some(l=>{const c=r[l];return c&&(s={profileId:l,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}),!!s}),!s){if(!t)throw new Error("No matching profile name found");const l=r[t];if(!l)throw new Error(`No matching profile name found and default profile "${t}" missing.`);s={profileId:t,profilePath:`${e}/${l.path}`,deprecated:!!l.deprecated}}const o=await tj(s.profilePath);let a;if(i){let l;if(n.handedness==="any"?l=o.layouts[Object.keys(o.layouts)[0]]:l=o.layouts[n.handedness],!l)throw new Error(`No matching handedness, ${n.handedness}, in profile ${s.profileId}`);l.assetPath&&(a=s.profilePath.replace("profile.json",l.assetPath))}return{profile:o,assetPath:a}}const JIe={xAxis:0,yAxis:0,button:0,state:yi.ComponentState.DEFAULT};function jIe(n=0,e=0){let t=n,i=e;if(Math.sqrt(n*n+e*e)>1){const o=Math.atan2(e,n);t=Math.cos(o),i=Math.sin(o)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:i*.5+.5}}class qIe{constructor(e){nt(this,"value",void 0),nt(this,"componentProperty",void 0),nt(this,"states",void 0),nt(this,"valueNodeName",void 0),nt(this,"valueNodeProperty",void 0),nt(this,"minNodeName",void 0),nt(this,"maxNodeName",void 0),nt(this,"valueNode",void 0),nt(this,"minNode",void 0),nt(this,"maxNode",void 0),this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===yi.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(JIe)}updateFromComponent({xAxis:e,yAxis:t,button:i,state:r}){const{normalizedXAxis:s,normalizedYAxis:o}=jIe(e,t);switch(this.componentProperty){case yi.ComponentProperty.X_AXIS:this.value=this.states.includes(r)?s:.5;break;case yi.ComponentProperty.Y_AXIS:this.value=this.states.includes(r)?o:.5;break;case yi.ComponentProperty.BUTTON:this.value=this.states.includes(r)&&i?i:0;break;case yi.ComponentProperty.STATE:this.valueNodeProperty===yi.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(r):this.value=this.states.includes(r)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class $Ie{constructor(e,t){if(nt(this,"id",void 0),nt(this,"values",void 0),nt(this,"type",void 0),nt(this,"gamepadIndices",void 0),nt(this,"rootNodeName",void 0),nt(this,"visualResponses",void 0),nt(this,"touchPointNodeName",void 0),nt(this,"touchPointNode",void 0),!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(i=>{const r=new qIe(t.visualResponses[i]);this.visualResponses[i]=r}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:yi.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=yi.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=yi.ComponentState.PRESSED:(t.touched||this.values.button>yi.ButtonTouchThreshold)&&(this.values.state=yi.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===yi.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>yi.AxisTouchThreshold&&(this.values.state=yi.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===yi.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>yi.AxisTouchThreshold&&(this.values.state=yi.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}}class eAe{constructor(e,t,i){if(nt(this,"xrInputSource",void 0),nt(this,"assetUrl",void 0),nt(this,"layoutDescription",void 0),nt(this,"id",void 0),nt(this,"components",void 0),!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");if(!t.layouts[e.handedness])throw new Error("No layout for "+e.handedness+" handedness");this.xrInputSource=e,this.assetUrl=i,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(r=>{const s=this.layoutDescription.components[r];this.components[r]=new $Ie(r,s)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}class tAe extends w4{constructor(e){super(e),this.type=Pi}parse(e){const a=function(v,b){switch(v){case 1:console.error("THREE.RGBELoader Read Error: "+(b||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(b||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(b||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(b||""))}return-1},u=`
`,d=function(v,b,w){b=b||1024;let x=v.pos,B=-1,R=0,Z="",W=String.fromCharCode.apply(null,new Uint16Array(v.subarray(x,x+128)));for(;0>(B=W.indexOf(u))&&R<b&&x<v.byteLength;)Z+=W,R+=W.length,x+=128,W+=String.fromCharCode.apply(null,new Uint16Array(v.subarray(x,x+128)));return-1<B?(w!==!1&&(v.pos+=R+B+1),Z+W.slice(0,B)):!1},h=function(v){const b=/^#\?(\S+)/,w=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,G=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,x=/^\s*FORMAT=(\S+)\s*$/,B=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,R={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let Z,W;if(v.pos>=v.byteLength||!(Z=d(v)))return a(1,"no header found");if(!(W=Z.match(b)))return a(3,"bad initial token");for(R.valid|=1,R.programtype=W[1],R.string+=Z+`
`;Z=d(v),Z!==!1;){if(R.string+=Z+`
`,Z.charAt(0)==="#"){R.comments+=Z+`
`;continue}if((W=Z.match(w))&&(R.gamma=parseFloat(W[1])),(W=Z.match(G))&&(R.exposure=parseFloat(W[1])),(W=Z.match(x))&&(R.valid|=2,R.format=W[1]),(W=Z.match(B))&&(R.valid|=4,R.height=parseInt(W[1],10),R.width=parseInt(W[2],10)),R.valid&2&&R.valid&4)break}return R.valid&2?R.valid&4?R:a(3,"missing image size specifier"):a(3,"missing format specifier")},f=function(v,b,w){const G=b;if(G<8||G>32767||v[0]!==2||v[1]!==2||v[2]&128)return new Uint8Array(v);if(G!==(v[2]<<8|v[3]))return a(3,"wrong scanline width");const x=new Uint8Array(4*b*w);if(!x.length)return a(4,"unable to allocate buffer space");let B=0,R=0;const Z=4*G,W=new Uint8Array(4),F=new Uint8Array(Z);let T=w;for(;T>0&&R<v.byteLength;){if(R+4>v.byteLength)return a(1);if(W[0]=v[R++],W[1]=v[R++],W[2]=v[R++],W[3]=v[R++],W[0]!=2||W[1]!=2||(W[2]<<8|W[3])!=G)return a(3,"bad rgbe scanline format");let V=0,z;for(;V<Z&&R<v.byteLength;){z=v[R++];const J=z>128;if(J&&(z-=128),z===0||V+z>Z)return a(3,"bad scanline data");if(J){const H=v[R++];for(let Y=0;Y<z;Y++)F[V++]=H}else F.set(v.subarray(R,R+z),V),V+=z,R+=z}const U=G;for(let J=0;J<U;J++){let H=0;x[B]=F[J+H],H+=G,x[B+1]=F[J+H],H+=G,x[B+2]=F[J+H],H+=G,x[B+3]=F[J+H],B+=4}T--}return x},I=function(v,b,w,G){const x=v[b+3],B=Math.pow(2,x-128)/255;w[G+0]=v[b+0]*B,w[G+1]=v[b+1]*B,w[G+2]=v[b+2]*B,w[G+3]=1},A=function(v,b,w,G){const x=v[b+3],B=Math.pow(2,x-128)/255;w[G+0]=t0.toHalfFloat(Math.min(v[b+0]*B,65504)),w[G+1]=t0.toHalfFloat(Math.min(v[b+1]*B,65504)),w[G+2]=t0.toHalfFloat(Math.min(v[b+2]*B,65504)),w[G+3]=t0.toHalfFloat(1)},p=new Uint8Array(e);p.pos=0;const y=h(p);if(y!==-1){const v=y.width,b=y.height,w=f(p.subarray(p.pos),v,b);if(w!==-1){let G,x,B;switch(this.type){case Hn:B=w.length/4;const R=new Float32Array(B*4);for(let W=0;W<B;W++)I(w,W*4,R,W*4);G=R,x=Hn;break;case Pi:B=w.length/4;const Z=new Uint16Array(B*4);for(let W=0;W<B;W++)A(w,W*4,Z,W*4);G=Z,x=Pi;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:v,height:b,data:G,header:y.string,gamma:y.gamma,exposure:y.exposure,type:x}}}return null}setDataType(e){return this.type=e,this}load(e,t,i,r){function s(o,a){switch(o.type){case Hn:case Pi:o.encoding=ta,o.minFilter=ut,o.magFilter=ut,o.generateMipmaps=!1,o.flipY=!0;break}t&&t(o,a)}return super.load(e,s,i,r)}}const tZ=new WeakMap;class nAe extends Qs{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,r){const s=new na(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,o=>{const a={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(o,a).then(t).catch(r)},i,r)}decodeDracoFile(e,t,i,r){const s={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i};this.decodeGeometry(e,s).then(t)}decodeGeometry(e,t){for(const l in t.attributeTypes){const c=t.attributeTypes[l];c.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[l]=c.name)}const i=JSON.stringify(t);if(tZ.has(e)){const l=tZ.get(e);if(l.key===i)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const s=this.workerNextTaskID++,o=e.byteLength,a=this._getWorker(s,o).then(l=>(r=l,new Promise((c,g)=>{r._callbacks[s]={resolve:c,reject:g},r.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return a.catch(()=>!0).then(()=>{r&&s&&this._releaseTask(r,s)}),tZ.set(e,{key:i,promise:a}),a}_createGeometry(e){const t=new Et;e.index&&t.setIndex(new Pt(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const r=e.attributes[i],s=r.name,o=r.array,a=r.itemSize;t.setAttribute(s,new Pt(o,a))}return t}_loadLibrary(e,t){const i=new na(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((r,s)=>{i.load(e,r,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{const r=i[0];e||(this.decoderConfig.wasmBinary=i[1]);const s=iAe.toString(),o=["/* draco decoder */",r,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(s){const o=s.data;switch(o.type){case"decode":r._callbacks[o.id].resolve(o);break;case"error":r._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,s){return r._taskLoad>s._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function iAe(){let n,e;onmessage=function(o){const a=o.data;switch(a.type){case"init":n=a.decoderConfig,e=new Promise(function(g){n.onModuleLoaded=function(u){g({draco:u})},DracoDecoderModule(n)});break;case"decode":const l=a.buffer,c=a.taskConfig;e.then(g=>{const u=g.draco,d=new u.Decoder,h=new u.DecoderBuffer;h.Init(new Int8Array(l),l.byteLength);try{const f=t(u,d,h,c),I=f.attributes.map(A=>A.array.buffer);f.index&&I.push(f.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:f},I)}catch(f){console.error(f),self.postMessage({type:"error",id:a.id,error:f.message})}finally{u.destroy(h),u.destroy(d)}});break}};function t(o,a,l,c){const g=c.attributeIDs,u=c.attributeTypes;let d,h;const f=a.GetEncodedGeometryType(l);if(f===o.TRIANGULAR_MESH)d=new o.Mesh,h=a.DecodeBufferToMesh(l,d);else if(f===o.POINT_CLOUD)d=new o.PointCloud,h=a.DecodeBufferToPointCloud(l,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!h.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+h.error_msg());const I={index:null,attributes:[]};for(const A in g){const p=self[u[A]];let y,v;if(c.useUniqueIDs)v=g[A],y=a.GetAttributeByUniqueId(d,v);else{if(v=a.GetAttributeId(d,o[g[A]]),v===-1)continue;y=a.GetAttribute(d,v)}I.attributes.push(r(o,a,d,A,p,y))}return f===o.TRIANGULAR_MESH&&(I.index=i(o,a,d)),o.destroy(d),I}function i(o,a,l){const g=l.num_faces()*3,u=g*4,d=o._malloc(u);a.GetTrianglesUInt32Array(l,u,d);const h=new Uint32Array(o.HEAPF32.buffer,d,g).slice();return o._free(d),{array:h,itemSize:1}}function r(o,a,l,c,g,u){const d=u.num_components(),f=l.num_points()*d,I=f*g.BYTES_PER_ELEMENT,A=s(o,g),p=o._malloc(I);a.GetAttributeDataArrayForAllPoints(l,u,A,I,p);const y=new g(o.HEAPF32.buffer,p,f).slice();return o._free(p),{name:c,array:y,itemSize:d}}function s(o,a){switch(a){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}let YB;const nZ=()=>{if(YB)return YB;const n="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",e="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",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),i=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let r=n;WebAssembly.validate(t)&&(r=e);let s;const o=WebAssembly.instantiate(a(r),{}).then(u=>{s=u.instance,s.exports.__wasm_call_ctors()});function a(u){const d=new Uint8Array(u.length);for(let f=0;f<u.length;++f){const I=u.charCodeAt(f);d[f]=I>96?I-71:I>64?I-65:I>47?I+4:I>46?63:62}let h=0;for(let f=0;f<u.length;++f)d[h++]=d[f]<60?i[d[f]]:(d[f]-60)*64+d[++f];return d.buffer.slice(0,h)}function l(u,d,h,f,I,A){const p=s.exports.sbrk,y=h+3&-4,v=p(y*f),b=p(I.length),w=new Uint8Array(s.exports.memory.buffer);w.set(I,b);const G=u(v,h,f,b,I.length);if(G===0&&A&&A(v,y,f),d.set(w.subarray(v,v+h*f)),p(v-p(0)),G!==0)throw new Error(`Malformed buffer data: ${G}`)}const c={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},g={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return YB={ready:o,supported:!0,decodeVertexBuffer(u,d,h,f,I){l(s.exports.meshopt_decodeVertexBuffer,u,d,h,f,s.exports[c[I]])},decodeIndexBuffer(u,d,h,f){l(s.exports.meshopt_decodeIndexBuffer,u,d,h,f)},decodeIndexSequence(u,d,h,f){l(s.exports.meshopt_decodeIndexSequence,u,d,h,f)},decodeGltfBuffer(u,d,h,f,I,A){l(s.exports[g[I]],u,d,h,f,s.exports[c[A]])}},YB};function nj(n,e){if(Object.is(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;const t=Object.keys(n);if(t.length!==Object.keys(e).length)return!1;for(let i=0;i<t.length;i++)if(!Object.prototype.hasOwnProperty.call(e,t[i])||!Object.is(n[t[i]],e[t[i]]))return!1;return!0}function rAe(){var n=Object.create(null);function e(r,s){var o=r.id,a=r.name,l=r.dependencies;l===void 0&&(l=[]);var c=r.init;c===void 0&&(c=function(){});var g=r.getTransferables;if(g===void 0&&(g=null),!n[o])try{l=l.map(function(d){return d&&d.isWorkerModule&&(e(d,function(h){if(h instanceof Error)throw h}),d=n[d.id].value),d}),c=i("<"+a+">.init",c),g&&(g=i("<"+a+">.getTransferables",g));var u=null;typeof c=="function"?u=c.apply(void 0,l):console.error("worker module init function failed to rehydrate"),n[o]={id:o,value:u,getTransferables:g},s(u)}catch(d){d&&d.noLog||console.error(d),s(d)}}function t(r,s){var o,a=r.id,l=r.args;(!n[a]||typeof n[a].value!="function")&&s(new Error("Worker module "+a+": not found or its 'init' did not return a function"));try{var c=(o=n[a]).value.apply(o,l);c&&typeof c.then=="function"?c.then(g,function(u){return s(u instanceof Error?u:new Error(""+u))}):g(c)}catch(u){s(u)}function g(u){try{var d=n[a].getTransferables&&n[a].getTransferables(u);(!d||!Array.isArray(d)||!d.length)&&(d=void 0),s(u,d)}catch(h){console.error(h),s(h)}}}function i(r,s){var o=void 0;self.troikaDefine=function(l){return o=l};var a=URL.createObjectURL(new Blob(["/** "+r.replace(/\*/g,"")+` **/

troikaDefine(
`+s+`
)`],{type:"application/javascript"}));try{importScripts(a)}catch(l){console.error(l)}return URL.revokeObjectURL(a),delete self.troikaDefine,o}self.addEventListener("message",function(r){var s=r.data,o=s.messageId,a=s.action,l=s.data;try{a==="registerModule"&&e(l,function(c){c instanceof Error?postMessage({messageId:o,success:!1,error:c.message}):postMessage({messageId:o,success:!0,result:{isCallable:typeof c=="function"}})}),a==="callModule"&&t(l,function(c,g){c instanceof Error?postMessage({messageId:o,success:!1,error:c.message}):postMessage({messageId:o,success:!0,result:c},g||void 0)})}catch(c){postMessage({messageId:o,success:!1,error:c.stack})}})}function sAe(n){var e=function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return e._getInitResult().then(function(r){if(typeof r=="function")return r.apply(void 0,t);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var t=n.dependencies,i=n.init;t=Array.isArray(t)?t.map(function(s){return s&&s._getInitResult?s._getInitResult():s}):[];var r=Promise.all(t).then(function(s){return i.apply(null,s)});return e._getInitResult=function(){return r},r},e}var ij=function(){var n=!1;if(typeof window<"u"&&typeof window.document<"u")try{var e=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));e.terminate(),n=!0}catch(t){typeof process<"u",console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+t.message+"]")}return ij=function(){return n},n},oAe=0,aAe=0,iZ=!1,W0=Object.create(null),F0=Object.create(null),J3=Object.create(null);function Mv(n){if((!n||typeof n.init!="function")&&!iZ)throw new Error("requires `options.init` function");var e=n.dependencies,t=n.init,i=n.getTransferables,r=n.workerId;if(!ij())return sAe(n);r==null&&(r="#default");var s="workerModule"+ ++oAe,o=n.name||s,a=null;e=e&&e.map(function(c){return typeof c=="function"&&!c.workerModuleData&&(iZ=!0,c=Mv({workerId:r,name:"<"+o+"> function dependency: "+c.name,init:`function(){return (
`+C1(c)+`
)}`}),iZ=!1),c&&c.workerModuleData&&(c=c.workerModuleData),c});function l(){for(var c=[],g=arguments.length;g--;)c[g]=arguments[g];if(!a){a=zH(r,"registerModule",l.workerModuleData);var u=function(){a=null,F0[r].delete(u)};(F0[r]||(F0[r]=new Set)).add(u)}return a.then(function(d){var h=d.isCallable;if(h)return zH(r,"callModule",{id:s,args:c});throw new Error("Worker module function was called but `init` did not return a callable function")})}return l.workerModuleData={isWorkerModule:!0,id:s,name:o,dependencies:e,init:C1(t),getTransferables:i&&C1(i)},l}function lAe(n){F0[n]&&F0[n].forEach(function(e){e()}),W0[n]&&(W0[n].terminate(),delete W0[n])}function C1(n){var e=n.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function cAe(n){var e=W0[n];if(!e){var t=C1(rAe);e=W0[n]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+n.replace(/\*/g,"")+` **/

;(`+t+")()"],{type:"application/javascript"}))),e.onmessage=function(i){var r=i.data,s=r.messageId,o=J3[s];if(!o)throw new Error("WorkerModule response with empty or unknown messageId");delete J3[s],o(r)}}return e}function zH(n,e,t){return new Promise(function(i,r){var s=++aAe;J3[s]=function(o){o.success?i(o.result):r(new Error("Error in worker "+e+" call: "+o.error))},cAe(n).postMessage({messageId:s,action:e,data:t})})}function rj(){var n=function(e){function t(Y,K,Q,P,ne,oe,$,de){var ge=1-$;de.x=ge*ge*Y+2*ge*$*Q+$*$*ne,de.y=ge*ge*K+2*ge*$*P+$*$*oe}function i(Y,K,Q,P,ne,oe,$,de,ge,se){var k=1-ge;se.x=k*k*k*Y+3*k*k*ge*Q+3*k*ge*ge*ne+ge*ge*ge*$,se.y=k*k*k*K+3*k*k*ge*P+3*k*ge*ge*oe+ge*ge*ge*de}function r(Y,K){for(var Q=/([MLQCZ])([^MLQCZ]*)/g,P,ne,oe,$,de;P=Q.exec(Y);){var ge=P[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(se){return parseFloat(se)});switch(P[1]){case"M":$=ne=ge[0],de=oe=ge[1];break;case"L":(ge[0]!==$||ge[1]!==de)&&K("L",$,de,$=ge[0],de=ge[1]);break;case"Q":{K("Q",$,de,$=ge[2],de=ge[3],ge[0],ge[1]);break}case"C":{K("C",$,de,$=ge[4],de=ge[5],ge[0],ge[1],ge[2],ge[3]);break}case"Z":($!==ne||de!==oe)&&K("L",$,de,ne,oe);break}}}function s(Y,K,Q){Q===void 0&&(Q=16);var P={x:0,y:0};r(Y,function(ne,oe,$,de,ge,se,k,O,q){switch(ne){case"L":K(oe,$,de,ge);break;case"Q":{for(var ee=oe,le=$,he=1;he<Q;he++)t(oe,$,se,k,de,ge,he/(Q-1),P),K(ee,le,P.x,P.y),ee=P.x,le=P.y;break}case"C":{for(var be=oe,xe=$,ze=1;ze<Q;ze++)i(oe,$,se,k,O,q,de,ge,ze/(Q-1),P),K(be,xe,P.x,P.y),be=P.x,xe=P.y;break}}})}var o="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",a="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",l=new WeakMap,c={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function g(Y,K){var Q=Y.getContext?Y.getContext("webgl",c):Y,P=l.get(Q);if(!P){let be=function(Be){var j=oe[Be];if(!j&&(j=oe[Be]=Q.getExtension(Be),!j))throw new Error(Be+" not supported");return j},xe=function(Be,j){var X=Q.createShader(j);return Q.shaderSource(X,Be),Q.compileShader(X),X},ze=function(Be,j,X,ce){if(!$[Be]){var fe={},Ge={},me=Q.createProgram();Q.attachShader(me,xe(j,Q.VERTEX_SHADER)),Q.attachShader(me,xe(X,Q.FRAGMENT_SHADER)),Q.linkProgram(me),$[Be]={program:me,transaction:function(Le){Q.useProgram(me),Le({setUniform:function(Xe,we){for(var Ue=[],Pe=arguments.length-2;Pe-- >0;)Ue[Pe]=arguments[Pe+2];var Ye=Ge[we]||(Ge[we]=Q.getUniformLocation(me,we));Q["uniform"+Xe].apply(Q,[Ye].concat(Ue))},setAttribute:function(Xe,we,Ue,Pe,Ye){var $e=fe[Xe];$e||($e=fe[Xe]={buf:Q.createBuffer(),loc:Q.getAttribLocation(me,Xe),data:null}),Q.bindBuffer(Q.ARRAY_BUFFER,$e.buf),Q.vertexAttribPointer($e.loc,we,Q.FLOAT,!1,0,0),Q.enableVertexAttribArray($e.loc),ne?Q.vertexAttribDivisor($e.loc,Pe):be("ANGLE_instanced_arrays").vertexAttribDivisorANGLE($e.loc,Pe),Ye!==$e.data&&(Q.bufferData(Q.ARRAY_BUFFER,Ye,Ue),$e.data=Ye)}})}}}$[Be].transaction(ce)},Se=function(Be,j){ge++;try{Q.activeTexture(Q.TEXTURE0+ge);var X=de[Be];X||(X=de[Be]=Q.createTexture(),Q.bindTexture(Q.TEXTURE_2D,X),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.NEAREST),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.NEAREST)),Q.bindTexture(Q.TEXTURE_2D,X),j(X,ge)}finally{ge--}},ke=function(Be,j,X){var ce=Q.createFramebuffer();se.push(ce),Q.bindFramebuffer(Q.FRAMEBUFFER,ce),Q.activeTexture(Q.TEXTURE0+j),Q.bindTexture(Q.TEXTURE_2D,Be),Q.framebufferTexture2D(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0,Q.TEXTURE_2D,Be,0);try{X(ce)}finally{Q.deleteFramebuffer(ce),Q.bindFramebuffer(Q.FRAMEBUFFER,se[--se.length-1]||null)}},He=function(){oe={},$={},de={},ge=-1,se.length=0};var k=be,O=xe,q=ze,ee=Se,le=ke,he=He,ne=typeof WebGL2RenderingContext<"u"&&Q instanceof WebGL2RenderingContext,oe={},$={},de={},ge=-1,se=[];Q.canvas.addEventListener("webglcontextlost",function(Be){He(),Be.preventDefault()},!1),l.set(Q,P={gl:Q,isWebGL2:ne,getExtension:be,withProgram:ze,withTexture:Se,withTextureFramebuffer:ke,handleContextLoss:He})}K(P)}function u(Y,K,Q,P,ne,oe,$,de){$===void 0&&($=15),de===void 0&&(de=null),g(Y,function(ge){var se=ge.gl,k=ge.withProgram,O=ge.withTexture;O("copy",function(q,ee){se.texImage2D(se.TEXTURE_2D,0,se.RGBA,ne,oe,0,se.RGBA,se.UNSIGNED_BYTE,K),k("copy",o,a,function(le){var he=le.setUniform,be=le.setAttribute;be("aUV",2,se.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),he("1i","image",ee),se.bindFramebuffer(se.FRAMEBUFFER,de||null),se.disable(se.BLEND),se.colorMask($&8,$&4,$&2,$&1),se.viewport(Q,P,ne,oe),se.scissor(Q,P,ne,oe),se.drawArrays(se.TRIANGLES,0,3)})})})}function d(Y,K,Q){var P=Y.width,ne=Y.height;g(Y,function(oe){var $=oe.gl,de=new Uint8Array(P*ne*4);$.readPixels(0,0,P,ne,$.RGBA,$.UNSIGNED_BYTE,de),Y.width=K,Y.height=Q,u($,de,0,0,P,ne)})}var h=Object.freeze({__proto__:null,withWebGLContext:g,renderImageData:u,resizeWebGLCanvasWithoutClearing:d});function f(Y,K,Q,P,ne,oe){oe===void 0&&(oe=1);var $=new Uint8Array(Y*K),de=P[2]-P[0],ge=P[3]-P[1],se=[];s(Q,function(be,xe,ze,Se){se.push({x1:be,y1:xe,x2:ze,y2:Se,minX:Math.min(be,ze),minY:Math.min(xe,Se),maxX:Math.max(be,ze),maxY:Math.max(xe,Se)})}),se.sort(function(be,xe){return be.maxX-xe.maxX});for(var k=0;k<Y;k++)for(var O=0;O<K;O++){var q=le(P[0]+de*(k+.5)/Y,P[1]+ge*(O+.5)/K),ee=Math.pow(1-Math.abs(q)/ne,oe)/2;q<0&&(ee=1-ee),ee=Math.max(0,Math.min(255,Math.round(ee*255))),$[O*Y+k]=ee}return $;function le(be,xe){for(var ze=1/0,Se=1/0,ke=se.length;ke--;){var He=se[ke];if(He.maxX+Se<=be)break;if(be+Se>He.minX&&xe-Se<He.maxY&&xe+Se>He.minY){var Be=p(be,xe,He.x1,He.y1,He.x2,He.y2);Be<ze&&(ze=Be,Se=Math.sqrt(ze))}}return he(be,xe)&&(Se=-Se),Se}function he(be,xe){for(var ze=0,Se=se.length;Se--;){var ke=se[Se];if(ke.maxX<=be)break;var He=ke.y1>xe!=ke.y2>xe&&be<(ke.x2-ke.x1)*(xe-ke.y1)/(ke.y2-ke.y1)+ke.x1;He&&(ze+=ke.y1<ke.y2?1:-1)}return ze!==0}}function I(Y,K,Q,P,ne,oe,$,de,ge,se){oe===void 0&&(oe=1),de===void 0&&(de=0),ge===void 0&&(ge=0),se===void 0&&(se=0),A(Y,K,Q,P,ne,oe,$,null,de,ge,se)}function A(Y,K,Q,P,ne,oe,$,de,ge,se,k){oe===void 0&&(oe=1),ge===void 0&&(ge=0),se===void 0&&(se=0),k===void 0&&(k=0);for(var O=f(Y,K,Q,P,ne,oe),q=new Uint8Array(O.length*4),ee=0;ee<O.length;ee++)q[ee*4+k]=O[ee];u($,q,ge,se,Y,K,1<<3-k,de)}function p(Y,K,Q,P,ne,oe){var $=ne-Q,de=oe-P,ge=$*$+de*de,se=ge?Math.max(0,Math.min(1,((Y-Q)*$+(K-P)*de)/ge)):0,k=Y-(Q+se*$),O=K-(P+se*de);return k*k+O*O}var y=Object.freeze({__proto__:null,generate:f,generateIntoCanvas:I,generateIntoFramebuffer:A}),v="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",b="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",w="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",G=new Float32Array([0,0,2,0,0,2]),x=null,B=!1,R={},Z=new WeakMap;function W(Y){if(!B&&!z(Y))throw new Error("WebGL generation not supported")}function F(Y,K,Q,P,ne,oe,$){if(oe===void 0&&(oe=1),$===void 0&&($=null),!$&&($=x,!$)){var de=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!de)throw new Error("OffscreenCanvas or DOM canvas not supported");$=x=de.getContext("webgl",{depth:!1})}W($);var ge=new Uint8Array(Y*K*4);g($,function(q){var ee=q.gl,le=q.withTexture,he=q.withTextureFramebuffer;le("readable",function(be,xe){ee.texImage2D(ee.TEXTURE_2D,0,ee.RGBA,Y,K,0,ee.RGBA,ee.UNSIGNED_BYTE,null),he(be,xe,function(ze){V(Y,K,Q,P,ne,oe,ee,ze,0,0,0),ee.readPixels(0,0,Y,K,ee.RGBA,ee.UNSIGNED_BYTE,ge)})})});for(var se=new Uint8Array(Y*K),k=0,O=0;k<ge.length;k+=4)se[O++]=ge[k];return se}function T(Y,K,Q,P,ne,oe,$,de,ge,se){oe===void 0&&(oe=1),de===void 0&&(de=0),ge===void 0&&(ge=0),se===void 0&&(se=0),V(Y,K,Q,P,ne,oe,$,null,de,ge,se)}function V(Y,K,Q,P,ne,oe,$,de,ge,se,k){oe===void 0&&(oe=1),ge===void 0&&(ge=0),se===void 0&&(se=0),k===void 0&&(k=0),W($);var O=[];s(Q,function(q,ee,le,he){O.push(q,ee,le,he)}),O=new Float32Array(O),g($,function(q){var ee=q.gl,le=q.isWebGL2,he=q.getExtension,be=q.withProgram,xe=q.withTexture,ze=q.withTextureFramebuffer,Se=q.handleContextLoss;if(xe("rawDistances",function(ke,He){(Y!==ke._lastWidth||K!==ke._lastHeight)&&ee.texImage2D(ee.TEXTURE_2D,0,ee.RGBA,ke._lastWidth=Y,ke._lastHeight=K,0,ee.RGBA,ee.UNSIGNED_BYTE,null),be("main",v,b,function(Be){var j=Be.setAttribute,X=Be.setUniform,ce=!le&&he("ANGLE_instanced_arrays"),fe=!le&&he("EXT_blend_minmax");j("aUV",2,ee.STATIC_DRAW,0,G),j("aLineSegment",4,ee.DYNAMIC_DRAW,1,O),X.apply(void 0,["4f","uGlyphBounds"].concat(P)),X("1f","uMaxDistance",ne),X("1f","uExponent",oe),ze(ke,He,function(Ge){ee.enable(ee.BLEND),ee.colorMask(!0,!0,!0,!0),ee.viewport(0,0,Y,K),ee.scissor(0,0,Y,K),ee.blendFunc(ee.ONE,ee.ONE),ee.blendEquationSeparate(ee.FUNC_ADD,le?ee.MAX:fe.MAX_EXT),ee.clear(ee.COLOR_BUFFER_BIT),le?ee.drawArraysInstanced(ee.TRIANGLES,0,3,O.length/4):ce.drawArraysInstancedANGLE(ee.TRIANGLES,0,3,O.length/4)})}),be("post",o,w,function(Be){Be.setAttribute("aUV",2,ee.STATIC_DRAW,0,G),Be.setUniform("1i","tex",He),ee.bindFramebuffer(ee.FRAMEBUFFER,de),ee.disable(ee.BLEND),ee.colorMask(k===0,k===1,k===2,k===3),ee.viewport(ge,se,Y,K),ee.scissor(ge,se,Y,K),ee.drawArrays(ee.TRIANGLES,0,3)})}),ee.isContextLost())throw Se(),new Error("webgl context lost")})}function z(Y){var K=!Y||Y===x?R:Y.canvas||Y,Q=Z.get(K);if(Q===void 0){B=!0;var P=null;try{var ne=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],oe=F(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,Y);Q=oe&&ne.length===oe.length&&oe.every(function($,de){return $===ne[de]}),Q||(P="bad trial run results",console.info(ne,oe))}catch($){Q=!1,P=$.message}P&&console.warn("WebGL SDF generation not supported:",P),B=!1,Z.set(K,Q)}return Q}var U=Object.freeze({__proto__:null,generate:F,generateIntoCanvas:T,generateIntoFramebuffer:V,isSupported:z});function J(Y,K,Q,P,ne,oe){ne===void 0&&(ne=Math.max(P[2]-P[0],P[3]-P[1])/2),oe===void 0&&(oe=1);try{return F.apply(U,arguments)}catch($){return console.info("WebGL SDF generation failed, falling back to JS",$),f.apply(y,arguments)}}function H(Y,K,Q,P,ne,oe,$,de,ge,se){ne===void 0&&(ne=Math.max(P[2]-P[0],P[3]-P[1])/2),oe===void 0&&(oe=1),de===void 0&&(de=0),ge===void 0&&(ge=0),se===void 0&&(se=0);try{return T.apply(U,arguments)}catch(k){return console.info("WebGL SDF generation failed, falling back to JS",k),I.apply(y,arguments)}}return e.forEachPathCommand=r,e.generate=J,e.generateIntoCanvas=H,e.javascript=y,e.pathToLineSegments=s,e.webgl=U,e.webglUtils=h,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return n}function gAe(){var n=function(e){var t={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},i={},r={};i.L=1,r[1]="L",Object.keys(t).forEach(function(Se,ke){i[Se]=1<<ke+1,r[i[Se]]=Se}),Object.freeze(i);var s=i.LRI|i.RLI|i.FSI,o=i.L|i.R|i.AL,a=i.B|i.S|i.WS|i.ON|i.FSI|i.LRI|i.RLI|i.PDI,l=i.BN|i.RLE|i.LRE|i.RLO|i.LRO|i.PDF,c=i.S|i.WS|i.B|s|i.PDI|l,g=null;function u(){if(!g){g=new Map;var Se=function(He){if(t.hasOwnProperty(He)){var Be=0;t[He].split(",").forEach(function(j){var X=j.split("+"),ce=X[0],fe=X[1];ce=parseInt(ce,36),fe=fe?parseInt(fe,36):0,g.set(Be+=ce,i[He]);for(var Ge=0;Ge<fe;Ge++)g.set(++Be,i[He])})}};for(var ke in t)Se(ke)}}function d(Se){return u(),g.get(Se.codePointAt(0))||i.L}function h(Se){return r[d(Se)]}var f={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function I(Se,ke){var He=36,Be=0,j=new Map,X=ke&&new Map,ce;return Se.split(",").forEach(function fe(Ge){if(Ge.indexOf("+")!==-1)for(var me=+Ge;me--;)fe(ce);else{ce=Ge;var Fe=Ge.split(">"),Le=Fe[0],Re=Fe[1];Le=String.fromCodePoint(Be+=parseInt(Le,He)),Re=String.fromCodePoint(Be+=parseInt(Re,He)),j.set(Le,Re),ke&&X.set(Re,Le)}}),{map:j,reverseMap:X}}var A,p,y;function v(){if(!A){var Se=I(f.pairs,!0),ke=Se.map,He=Se.reverseMap;A=ke,p=He,y=I(f.canonical,!1).map}}function b(Se){return v(),A.get(Se)||null}function w(Se){return v(),p.get(Se)||null}function G(Se){return v(),y.get(Se)||null}var x=i.L,B=i.R,R=i.EN,Z=i.ES,W=i.ET,F=i.AN,T=i.CS,V=i.B,z=i.S,U=i.ON,J=i.BN,H=i.NSM,Y=i.AL,K=i.LRO,Q=i.RLO,P=i.LRE,ne=i.RLE,oe=i.PDF,$=i.LRI,de=i.RLI,ge=i.FSI,se=i.PDI;function k(Se,ke){for(var He=125,Be=new Uint32Array(Se.length),j=0;j<Se.length;j++)Be[j]=d(Se[j]);var X=new Map;function ce(Vi,ar){var Fn=Be[Vi];Be[Vi]=ar,X.set(Fn,X.get(Fn)-1),Fn&a&&X.set(a,X.get(a)-1),X.set(ar,(X.get(ar)||0)+1),ar&a&&X.set(a,(X.get(a)||0)+1)}for(var fe=new Uint8Array(Se.length),Ge=new Map,me=[],Fe=null,Le=0;Le<Se.length;Le++)Fe||me.push(Fe={start:Le,end:Se.length-1,level:ke==="rtl"?1:ke==="ltr"?0:Pf(Le,!1)}),Be[Le]&V&&(Fe.end=Le,Fe=null);for(var Re=ne|P|Q|K|s|se|oe|V,Xe=function(Vi){return Vi+(Vi&1?1:2)},we=function(Vi){return Vi+(Vi&1?2:1)},Ue=0;Ue<me.length;Ue++){Fe=me[Ue];var Pe=[{_level:Fe.level,_override:0,_isolate:0}],Ye=void 0,$e=0,mt=0,Wt=0;X.clear();for(var ue=Fe.start;ue<=Fe.end;ue++){var Me=Be[ue];if(Ye=Pe[Pe.length-1],X.set(Me,(X.get(Me)||0)+1),Me&a&&X.set(a,(X.get(a)||0)+1),Me&Re)if(Me&(ne|P)){fe[ue]=Ye._level;var De=(Me===ne?we:Xe)(Ye._level);De<=He&&!$e&&!mt?Pe.push({_level:De,_override:0,_isolate:0}):$e||mt++}else if(Me&(Q|K)){fe[ue]=Ye._level;var et=(Me===Q?we:Xe)(Ye._level);et<=He&&!$e&&!mt?Pe.push({_level:et,_override:Me&Q?B:x,_isolate:0}):$e||mt++}else if(Me&s){Me&ge&&(Me=Pf(ue+1,!0)===1?de:$),fe[ue]=Ye._level,Ye._override&&ce(ue,Ye._override);var st=(Me===de?we:Xe)(Ye._level);st<=He&&$e===0&&mt===0?(Wt++,Pe.push({_level:st,_override:0,_isolate:1,_isolInitIndex:ue})):$e++}else if(Me&se){if($e>0)$e--;else if(Wt>0){for(mt=0;!Pe[Pe.length-1]._isolate;)Pe.pop();var Ot=Pe[Pe.length-1]._isolInitIndex;Ot!=null&&(Ge.set(Ot,ue),Ge.set(ue,Ot)),Pe.pop(),Wt--}Ye=Pe[Pe.length-1],fe[ue]=Ye._level,Ye._override&&ce(ue,Ye._override)}else Me&oe?($e===0&&(mt>0?mt--:!Ye._isolate&&Pe.length>1&&(Pe.pop(),Ye=Pe[Pe.length-1])),fe[ue]=Ye._level):Me&V&&(fe[ue]=Fe.level);else fe[ue]=Ye._level,Ye._override&&Me!==J&&ce(ue,Ye._override)}for(var on=[],An=null,$t=Fe.start;$t<=Fe.end;$t++){var bn=Be[$t];if(!(bn&l)){var Jt=fe[$t],nn=bn&s,ms=bn===se;An&&Jt===An._level?(An._end=$t,An._endsWithIsolInit=nn):on.push(An={_start:$t,_end:$t,_level:Jt,_startsWithPDI:ms,_endsWithIsolInit:nn})}}for(var br=[],un=0;un<on.length;un++){var te=on[un];if(!te._startsWithPDI||te._startsWithPDI&&!Ge.has(te._start)){for(var ve=[An=te],Ee=void 0;An&&An._endsWithIsolInit&&(Ee=Ge.get(An._end))!=null;)for(var Ce=un+1;Ce<on.length;Ce++)if(on[Ce]._start===Ee){ve.push(An=on[Ce]);break}for(var Te=[],dt=0;dt<ve.length;dt++)for(var yt=ve[dt],St=yt._start;St<=yt._end;St++)Te.push(St);for(var kt=fe[Te[0]],jt=Fe.level,Tt=Te[0]-1;Tt>=0;Tt--)if(!(Be[Tt]&l)){jt=fe[Tt];break}var Ht=Te[Te.length-1],ti=fe[Ht],sr=Fe.level;if(!(Be[Ht]&s)){for(var kr=Ht+1;kr<=Fe.end;kr++)if(!(Be[kr]&l)){sr=fe[kr];break}}br.push({_seqIndices:Te,_sosType:Math.max(jt,kt)%2?B:x,_eosType:Math.max(sr,ti)%2?B:x})}}for(var Mo=0;Mo<br.length;Mo++){var kn=br[Mo],Qe=kn._seqIndices,ys=kn._sosType,ni=kn._eosType;if(X.get(H))for(var Lr=0;Lr<Qe.length;Lr++){var _d=Qe[Lr];if(Be[_d]&H){for(var Eo=ys,vs=Lr-1;vs>=0;vs--)if(!(Be[Qe[vs]]&l)){Eo=Be[Qe[vs]];break}ce(_d,Eo&(s|se)?U:Eo)}}if(X.get(R))for(var Sn=0;Sn<Qe.length;Sn++){var en=Qe[Sn];if(Be[en]&R)for(var rn=Sn-1;rn>=-1;rn--){var Jn=rn===-1?ys:Be[Qe[rn]];if(Jn&o){Jn===Y&&ce(en,F);break}}}if(X.get(Y))for(var ii=0;ii<Qe.length;ii++){var Qi=Qe[ii];Be[Qi]&Y&&ce(Qi,B)}if(X.get(Z)||X.get(T))for(var Hr=1;Hr<Qe.length-1;Hr++){var Vl=Qe[Hr];if(Be[Vl]&(Z|T)){for(var xi=0,su=0,Lf=Hr-1;Lf>=0&&(xi=Be[Qe[Lf]],!!(xi&l));Lf--);for(var Hf=Hr+1;Hf<Qe.length&&(su=Be[Qe[Hf]],!!(su&l));Hf++);xi===su&&(Be[Vl]===Z?xi===R:xi&(R|F))&&ce(Vl,xi)}}if(X.get(R))for(var Tl=0;Tl<Qe.length;Tl++){var Dv=Qe[Tl];if(Be[Dv]&R){for(var zr=Tl-1;zr>=0&&Be[Qe[zr]]&(W|l);zr--)ce(Qe[zr],R);for(var zf=Tl+1;zf<Qe.length&&Be[Qe[zf]]&(W|l);zf++)ce(Qe[zf],R)}}if(X.get(W)||X.get(Z)||X.get(T))for(var Vd=0;Vd<Qe.length;Vd++){var Pv=Qe[Vd];if(Be[Pv]&(W|Z|T)){ce(Pv,U);for(var kc=Vd-1;kc>=0&&Be[Qe[kc]]&l;kc--)ce(Qe[kc],U);for(var Lc=Vd+1;Lc<Qe.length&&Be[Qe[Lc]]&l;Lc++)ce(Qe[Lc],U)}}if(X.get(R))for(var Hc=0,Td=ys;Hc<Qe.length;Hc++){var Uv=Qe[Hc],fp=Be[Uv];fp&R?Td===x&&ce(Uv,x):fp&o&&(Td=fp)}if(X.get(a)){var zc=B|R|F,Xf=zc|x,Nl=[];{for(var ou=[],kl=0;kl<Qe.length;kl++)if(Be[Qe[kl]]&a){var Ut=Se[Qe[kl]],Ip=void 0;if(b(Ut)!==null)if(ou.length<63)ou.push({char:Ut,seqIndex:kl});else break;else if((Ip=w(Ut))!==null)for(var Xc=ou.length-1;Xc>=0;Xc--){var Yf=ou[Xc].char;if(Yf===Ip||Yf===w(G(Ut))||b(G(Yf))===Ut){Nl.push([ou[Xc].seqIndex,kl]),ou.length=Xc;break}}}Nl.sort(function(Vi,ar){return Vi[0]-ar[0]})}for(var Ap=0;Ap<Nl.length;Ap++){for(var Qv=Nl[Ap],ri=Qv[0],au=Qv[1],Ov=!1,bs=0,Cp=ri+1;Cp<au;Cp++){var lu=Qe[Cp];if(Be[lu]&Xf){Ov=!0;var Wo=Be[lu]&zc?B:x;if(Wo===Hl(lu)){bs=Wo;break}}}if(Ov&&!bs){bs=ys;for(var pp=ri-1;pp>=0;pp--){var Kf=Qe[pp];if(Be[Kf]&Xf){var Fo=Be[Kf]&zc?B:x;Fo!==Hl(Kf)?bs=Fo:bs=Hl(Kf);break}}}if(bs){if(Be[Qe[ri]]=Be[Qe[au]]=bs,bs!==Hl(Qe[ri])){for(var Bs=ri+1;Bs<Qe.length;Bs++)if(!(Be[Qe[Bs]]&l)){d(Se[Qe[Bs]])&H&&(Be[Qe[Bs]]=bs);break}}if(bs!==Hl(Qe[au])){for(var Ll=au+1;Ll<Qe.length;Ll++)if(!(Be[Qe[Ll]]&l)){d(Se[Qe[Ll]])&H&&(Be[Qe[Ll]]=bs);break}}}}for(var ga=0;ga<Qe.length;ga++)if(Be[Qe[ga]]&a){for(var mp=ga,yp=ga,Os=ys,Nd=ga-1;Nd>=0;Nd--)if(Be[Qe[Nd]]&l)mp=Nd;else{Os=Be[Qe[Nd]]&zc?B:x;break}for(var kd=ni,Ld=ga+1;Ld<Qe.length;Ld++)if(Be[Qe[Ld]]&(a|l))yp=Ld;else{kd=Be[Qe[Ld]]&zc?B:x;break}for(var Xr=mp;Xr<=yp;Xr++)Be[Qe[Xr]]=Os===kd?Os:Hl(Qe[Xr]);ga=yp}}}for(var or=Fe.start;or<=Fe.end;or++){var Df=fe[or],Ja=Be[or];if(Df&1?Ja&(x|R|F)&&fe[or]++:Ja&B?fe[or]++:Ja&(F|R)&&(fe[or]+=2),Ja&l&&(fe[or]=or===0?Fe.level:fe[or-1]),or===Fe.end||d(Se[or])&(z|V))for(var cu=or;cu>=0&&d(Se[cu])&c;cu--)fe[cu]=Fe.level}}return{levels:fe,paragraphs:me};function Pf(Vi,ar){for(var Fn=Vi;Fn<Se.length;Fn++){var Oi=Be[Fn];if(Oi&(B|Y))return 1;if(Oi&(V|x)||ar&&Oi===se)return 0;if(Oi&s){var ja=Jv(Fn);Fn=ja===-1?Se.length:ja}}return 0}function Jv(Vi){for(var ar=1,Fn=Vi+1;Fn<Se.length;Fn++){var Oi=Be[Fn];if(Oi&V)break;if(Oi&se){if(--ar===0)return Fn}else Oi&s&&ar++}return-1}function Hl(Vi){return fe[Vi]&1?B:x}}var O="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",q;function ee(){if(!q){var Se=I(O,!0),ke=Se.map,He=Se.reverseMap;He.forEach(function(Be,j){ke.set(j,Be)}),q=ke}}function le(Se){return ee(),q.get(Se)||null}function he(Se,ke,He,Be){var j=Se.length;He=Math.max(0,He==null?0:+He),Be=Math.min(j-1,Be==null?j-1:+Be);for(var X=new Map,ce=He;ce<=Be;ce++)if(ke[ce]&1){var fe=le(Se[ce]);fe!==null&&X.set(ce,fe)}return X}function be(Se,ke,He,Be){var j=Se.length;He=Math.max(0,He==null?0:+He),Be=Math.min(j-1,Be==null?j-1:+Be);var X=[];return ke.paragraphs.forEach(function(ce){var fe=Math.max(He,ce.start),Ge=Math.min(Be,ce.end);if(fe<Ge){for(var me=ke.levels.slice(fe,Ge+1),Fe=Ge;Fe>=fe&&d(Se[Fe])&c;Fe--)me[Fe]=ce.level;for(var Le=ce.level,Re=1/0,Xe=0;Xe<me.length;Xe++){var we=me[Xe];we>Le&&(Le=we),we<Re&&(Re=we|1)}for(var Ue=Le;Ue>=Re;Ue--)for(var Pe=0;Pe<me.length;Pe++)if(me[Pe]>=Ue){for(var Ye=Pe;Pe+1<me.length&&me[Pe+1]>=Ue;)Pe++;Pe>Ye&&X.push([Ye+He,Pe+He])}}}),X}function xe(Se,ke,He,Be){var j=ze(Se,ke,He,Be),X=[].concat(Se);return j.forEach(function(ce,fe){X[fe]=(ke.levels[ce]&1?le(Se[ce]):null)||Se[ce]}),X.join("")}function ze(Se,ke,He,Be){for(var j=be(Se,ke,He,Be),X=[],ce=0;ce<Se.length;ce++)X[ce]=ce;return j.forEach(function(fe){for(var Ge=fe[0],me=fe[1],Fe=X.slice(Ge,me+1),Le=Fe.length;Le--;)X[me-Le]=Fe[Le]}),X}return e.closingToOpeningBracket=w,e.getBidiCharType=d,e.getBidiCharTypeName=h,e.getCanonicalBracket=G,e.getEmbeddingLevels=k,e.getMirroredCharacter=le,e.getMirroredCharactersMap=he,e.getReorderSegments=be,e.getReorderedIndices=ze,e.getReorderedString=xe,e.openingToClosingBracket=b,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return n}const sj=/\bvoid\s+main\s*\(\s*\)\s*{/g;function j3(n){const e=/^[ \t]*#include +<([\w\d./]+)>/gm;function t(i,r){let s=bt[r];return s?j3(s):i}return n.replace(e,t)}const Gr=[];for(let n=0;n<256;n++)Gr[n]=(n<16?"0":"")+n.toString(16);function uAe(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Gr[n&255]+Gr[n>>8&255]+Gr[n>>16&255]+Gr[n>>24&255]+"-"+Gr[e&255]+Gr[e>>8&255]+"-"+Gr[e>>16&15|64]+Gr[e>>24&255]+"-"+Gr[t&63|128]+Gr[t>>8&255]+"-"+Gr[t>>16&255]+Gr[t>>24&255]+Gr[i&255]+Gr[i>>8&255]+Gr[i>>16&255]+Gr[i>>24&255]).toUpperCase()}const ih=Object.assign||function(){let n=arguments[0];for(let e=1,t=arguments.length;e<t;e++){let i=arguments[e];if(i)for(let r in i)i.hasOwnProperty(r)&&(n[r]=i[r])}return n},dAe=Date.now(),XH=new WeakMap,YH=new Map;let hAe=1e10;function q3(n,e){const t=CAe(e);let i=XH.get(n);if(i||XH.set(n,i=Object.create(null)),i[t])return new i[t];const r=`_onBeforeCompile${t}`,s=function(c){n.onBeforeCompile.call(this,c);const g=this.customProgramCacheKey()+"|"+c.vertexShader+"|"+c.fragmentShader;let u=YH[g];if(!u){const d=fAe(c,e,t);u=YH[g]=d}c.vertexShader=u.vertexShader,c.fragmentShader=u.fragmentShader,ih(c.uniforms,this.uniforms),e.timeUniform&&(c.uniforms[e.timeUniform]={get value(){return Date.now()-dAe}}),this[r]&&this[r](c)},o=function(){return a(e.chained?n:n.clone())},a=function(c){const g=Object.create(c,l);return Object.defineProperty(g,"baseMaterial",{value:n}),Object.defineProperty(g,"id",{value:hAe++}),g.uuid=uAe(),g.uniforms=ih({},c.uniforms,e.uniforms),g.defines=ih({},c.defines,e.defines),g.defines[`TROIKA_DERIVED_MATERIAL_${t}`]="",g.extensions=ih({},c.extensions,e.extensions),g._listeners=void 0,g},l={constructor:{value:o},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return n.customProgramCacheKey()+"|"+t}},onBeforeCompile:{get(){return s},set(c){this[r]=c}},copy:{writable:!0,configurable:!0,value:function(c){return n.copy.call(this,c),!n.isShaderMaterial&&!n.isDerivedMaterial&&(ih(this.extensions,c.extensions),ih(this.defines,c.defines),ih(this.uniforms,Ew.clone(c.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const c=new n.constructor;return a(c).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let c=this._depthMaterial;return c||(c=this._depthMaterial=q3(n.isDerivedMaterial?n.getDepthMaterial():new ov({depthPacking:Sl}),e),c.defines.IS_DEPTH_MATERIAL="",c.uniforms=this.uniforms),c}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let c=this._distanceMaterial;return c||(c=this._distanceMaterial=q3(n.isDerivedMaterial?n.getDistanceMaterial():new _w,e),c.defines.IS_DISTANCE_MATERIAL="",c.uniforms=this.uniforms),c}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:c,_distanceMaterial:g}=this;c&&c.dispose(),g&&g.dispose(),n.dispose.call(this)}}};return i[t]=o,new o}function fAe({vertexShader:n,fragmentShader:e},t,i){let{vertexDefs:r,vertexMainIntro:s,vertexMainOutro:o,vertexTransform:a,fragmentDefs:l,fragmentMainIntro:c,fragmentMainOutro:g,fragmentColorTransform:u,customRewriter:d,timeUniform:h}=t;if(r=r||"",s=s||"",o=o||"",l=l||"",c=c||"",g=g||"",(a||d)&&(n=j3(n)),(u||d)&&(e=e.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),e=j3(e)),d){let f=d({vertexShader:n,fragmentShader:e});n=f.vertexShader,e=f.fragmentShader}if(u){let f=[];e=e.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,I=>(f.push(I),"")),g=`${u}
${f.join(`
`)}
${g}`}if(h){const f=`
uniform float ${h};
`;r=f+r,l=f+l}return a&&(n=`vec3 troika_position_${i};
vec3 troika_normal_${i};
vec2 troika_uv_${i};
${n}
`,r=`${r}
void troikaVertexTransform${i}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${a}
}
`,s=`
troika_position_${i} = vec3(position);
troika_normal_${i} = vec3(normal);
troika_uv_${i} = vec2(uv);
troikaVertexTransform${i}(troika_position_${i}, troika_normal_${i}, troika_uv_${i});
${s}
`,n=n.replace(/\b(position|normal|uv)\b/g,(f,I,A,p)=>/\battribute\s+vec[23]\s+$/.test(p.substr(0,A))?I:`troika_${I}_${i}`)),n=KH(n,i,r,s,o),e=KH(e,i,l,c,g),{vertexShader:n,fragmentShader:e}}function KH(n,e,t,i,r){return(i||r||t)&&(n=n.replace(sj,`
${t}
void troikaOrigMain${e}() {`),n+=`
void main() {
  ${i}
  troikaOrigMain${e}();
  ${r}
}`),n}function IAe(n,e){return n==="uniforms"?void 0:typeof e=="function"?e.toString():e}let AAe=0;const DH=new Map;function CAe(n){const e=JSON.stringify(n,IAe);let t=DH.get(e);return t==null&&DH.set(e,t=++AAe),t}function pAe(n,e,t){const{defaultFontURL:i}=t,r=Object.create(null),s=1/0,o=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,a="[^\\S\\u00A0]",l=new RegExp(`${a}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function c(y,v){function b(){const w=G=>{console.error(`Failure loading font ${y}${y===i?"":"; trying fallback"}`,G),y!==i&&(y=i,b())};try{const G=new XMLHttpRequest;G.open("get",y,!0),G.responseType="arraybuffer",G.onload=function(){if(G.status>=400)w(new Error(G.statusText));else if(G.status>0)try{const x=n(G.response);v(x)}catch(x){w(x)}},G.onerror=w,G.send()}catch(G){w(G)}}b()}function g(y,v){y||(y=i);let b=r[y];b?b.pending?b.pending.push(v):v(b):(r[y]={pending:[v]},c(y,w=>{let G=r[y].pending;r[y]=w,G.forEach(x=>x(w))}))}function u({text:y="",font:v=i,sdfGlyphSize:b=64,fontSize:w=1,letterSpacing:G=0,lineHeight:x="normal",maxWidth:B=s,direction:R,textAlign:Z="left",textIndent:W=0,whiteSpace:F="normal",overflowWrap:T="normal",anchorX:V=0,anchorY:z=0,includeCaretPositions:U=!1,chunkedBoundsSize:J=8192,colorRanges:H=null},Y,K=!1){const Q=I(),P={fontLoad:0,typesetting:0};y.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),y=y.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),w=+w,G=+G,B=+B,x=x||"normal",W=+W,g(v,ne=>{const oe=isFinite(B);let $=null,de=null,ge=null,se=null,k=null,O=null,q=null,ee=0,le=0,he=F!=="nowrap";const{ascender:be,descender:xe,unitsPerEm:ze,lineGap:Se,capHeight:ke,xHeight:He}=ne;P.fontLoad=I()-Q;const Be=I(),j=w/ze;x==="normal"&&(x=(be-xe+Se)/ze),x=x*w;const X=(x-(be-xe)*j)/2,ce=-(be*j+X),fe=Math.min(x,(be-xe)*j),Ge=(be+xe)/2*j-fe/2;let me=W,Fe=new A;const Le=[Fe];ne.forEachGlyph(y,w,G,(we,Ue,Pe)=>{const Ye=y.charAt(Pe),$e=we.advanceWidth*j,mt=Fe.count;let Wt;if("isEmpty"in we||(we.isWhitespace=!!Ye&&new RegExp(a).test(Ye),we.canBreakAfter=!!Ye&&l.test(Ye),we.isEmpty=we.xMin===we.xMax||we.yMin===we.yMax||o.test(Ye)),!we.isWhitespace&&!we.isEmpty&&le++,he&&oe&&!we.isWhitespace&&Ue+$e+me>B&&mt){if(Fe.glyphAt(mt-1).glyphObj.canBreakAfter)Wt=new A,me=-Ue;else for(let Me=mt;Me--;)if(Me===0&&T==="break-word"){Wt=new A,me=-Ue;break}else if(Fe.glyphAt(Me).glyphObj.canBreakAfter){Wt=Fe.splitAt(Me+1);const De=Wt.glyphAt(0).x;me-=De;for(let et=Wt.count;et--;)Wt.glyphAt(et).x-=De;break}Wt&&(Fe.isSoftWrapped=!0,Fe=Wt,Le.push(Fe),ee=B)}let ue=Fe.glyphAt(Fe.count);ue.glyphObj=we,ue.x=Ue+me,ue.width=$e,ue.charIndex=Pe,Ye===`
`&&(Fe=new A,Le.push(Fe),me=-(Ue+$e+G*w)+W)}),Le.forEach(we=>{for(let Ue=we.count;Ue--;){let{glyphObj:Pe,x:Ye,width:$e}=we.glyphAt(Ue);if(!Pe.isWhitespace){we.width=Ye+$e,we.width>ee&&(ee=we.width);return}}});let Re=0,Xe=0;if(V&&(typeof V=="number"?Re=-V:typeof V=="string"&&(Re=-ee*(V==="left"?0:V==="center"?.5:V==="right"?1:h(V)))),z){if(typeof z=="number")Xe=-z;else if(typeof z=="string"){let we=Le.length*x;Xe=z==="top"?0:z==="top-baseline"?-ce:z==="top-cap"?-ce-ke*j:z==="top-ex"?-ce-He*j:z==="middle"?we/2:z==="bottom"?we:z==="bottom-baseline"?we-X+xe*j:h(z)*we}}if(!K){const we=e.getEmbeddingLevels(y,R);$=new Uint16Array(le),de=new Float32Array(le*2),ge={},O=[s,s,-s,-s],q=[];let Ue=ce;U&&(k=new Float32Array(y.length*3)),H&&(se=new Uint8Array(le*3));let Pe=0,Ye=-1,$e=-1,mt,Wt;if(Le.forEach((ue,Me)=>{let{count:De,width:et}=ue;if(De>0){let st=0;for(let Jt=De;Jt--&&ue.glyphAt(Jt).glyphObj.isWhitespace;)st++;let Ot=0,on=0;if(Z==="center")Ot=(ee-et)/2;else if(Z==="right")Ot=ee-et;else if(Z==="justify"&&ue.isSoftWrapped){let Jt=0;for(let nn=De-st;nn--;)ue.glyphAt(nn).glyphObj.isWhitespace&&Jt++;on=(ee-et)/Jt}if(on||Ot){let Jt=0;for(let nn=0;nn<De;nn++){let ms=ue.glyphAt(nn);const br=ms.glyphObj;ms.x+=Ot+Jt,on!==0&&br.isWhitespace&&nn<De-st&&(Jt+=on,ms.width+=on)}}const An=e.getReorderSegments(y,we,ue.glyphAt(0).charIndex,ue.glyphAt(ue.count-1).charIndex);for(let Jt=0;Jt<An.length;Jt++){const[nn,ms]=An[Jt];let br=1/0,un=-1/0;for(let te=0;te<De;te++)if(ue.glyphAt(te).charIndex>=nn){let ve=te,Ee=te;for(;Ee<De;Ee++){let Ce=ue.glyphAt(Ee);if(Ce.charIndex>ms)break;Ee<De-st&&(br=Math.min(br,Ce.x),un=Math.max(un,Ce.x+Ce.width))}for(let Ce=ve;Ce<Ee;Ce++){const Te=ue.glyphAt(Ce);Te.x=un-(Te.x+Te.width-br)}break}}let $t;const bn=Jt=>$t=Jt;for(let Jt=0;Jt<De;Jt++){let nn=ue.glyphAt(Jt);$t=nn.glyphObj;const ms=$t.index,br=we.levels[nn.charIndex]&1;if(br){const un=e.getMirroredCharacter(y[nn.charIndex]);un&&ne.forEachGlyph(un,0,0,bn)}if(U){const{charIndex:un}=nn,te=nn.x+Re,ve=nn.x+nn.width+Re;k[un*3]=br?ve:te,k[un*3+1]=br?te:ve,k[un*3+2]=Ue+Ge+Xe;const Ee=un-Ye;Ee>1&&f(k,Ye,Ee),Ye=un}if(H){const{charIndex:un}=nn;for(;un>$e;)$e++,H.hasOwnProperty($e)&&(Wt=H[$e])}if(!$t.isWhitespace&&!$t.isEmpty){const un=Pe++;ge[ms]||(ge[ms]={path:$t.path,pathBounds:[$t.xMin,$t.yMin,$t.xMax,$t.yMax]});const te=nn.x+Re,ve=Ue+Xe;de[un*2]=te,de[un*2+1]=ve;const Ee=te+$t.xMin*j,Ce=ve+$t.yMin*j,Te=te+$t.xMax*j,dt=ve+$t.yMax*j;Ee<O[0]&&(O[0]=Ee),Ce<O[1]&&(O[1]=Ce),Te>O[2]&&(O[2]=Te),dt>O[3]&&(O[3]=dt),un%J===0&&(mt={start:un,end:un,rect:[s,s,-s,-s]},q.push(mt)),mt.end++;const yt=mt.rect;if(Ee<yt[0]&&(yt[0]=Ee),Ce<yt[1]&&(yt[1]=Ce),Te>yt[2]&&(yt[2]=Te),dt>yt[3]&&(yt[3]=dt),$[un]=ms,H){const St=un*3;se[St]=Wt>>16&255,se[St+1]=Wt>>8&255,se[St+2]=Wt&255}}}}Ue-=x}),k){const ue=y.length-Ye;ue>1&&f(k,Ye,ue)}}P.typesetting=I()-Be,Y({glyphIds:$,glyphPositions:de,glyphData:ge,caretPositions:k,caretHeight:fe,glyphColors:se,chunkedBounds:q,fontSize:w,unitsPerEm:ze,ascender:be*j,descender:xe*j,capHeight:ke*j,xHeight:He*j,lineHeight:x,topBaseline:ce,blockBounds:[Re,Xe-Le.length*x,Re+ee,Xe],visibleBounds:O,timings:P})})}function d(y,v){u(y,b=>{const[w,G,x,B]=b.blockBounds;v({width:x-w,height:B-G})},{metricsOnly:!0})}function h(y){let v=y.match(/^([\d.]+)%$/),b=v?parseFloat(v[1]):NaN;return isNaN(b)?0:b/100}function f(y,v,b){const w=y[v*3],G=y[v*3+1],x=y[v*3+2],B=(G-w)/b;for(let R=0;R<b;R++){const Z=(v+R)*3;y[Z]=w+B*R,y[Z+1]=w+B*(R+1),y[Z+2]=x}}function I(){return(self.performance||Date).now()}function A(){this.data=[]}const p=["glyphObj","x","width","charIndex"];return A.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/p.length)},glyphAt(y){let v=A.flyweight;return v.data=this.data,v.index=y,v},splitAt(y){let v=new A;return v.data=this.data.splice(y*p.length),v}},A.flyweight=p.reduce((y,v,b,w)=>(Object.defineProperty(y,v,{get(){return this.data[this.index*p.length+b]},set(G){this.data[this.index*p.length+b]=G}}),y),{data:null,index:0}),{typeset:u,measure:d,loadFont:g}}const jh=()=>(self.performance||Date).now(),nx=rj();let PH;function mAe(n,e,t,i,r,s,o,a,l,c,g=!0){return g?vAe(n,e,t,i,r,s,o,a,l,c).then(null,u=>(PH||(console.warn("WebGL SDF generation failed, falling back to JS",u),PH=!0),QH(n,e,t,i,r,s,o,a,l,c))):QH(n,e,t,i,r,s,o,a,l,c)}const p1=[],yAe=5;let $3=0;function oj(){const n=jh();for(;p1.length&&jh()-n<yAe;)p1.shift()();$3=p1.length?setTimeout(oj,0):0}const vAe=(...n)=>new Promise((e,t)=>{p1.push(()=>{const i=jh();try{nx.webgl.generateIntoCanvas(...n),e({timing:jh()-i})}catch(r){t(r)}}),$3||($3=setTimeout(oj,0))}),bAe=4,BAe=2e3,UH={};let GAe=0;function QH(n,e,t,i,r,s,o,a,l,c){const g="TroikaTextSDFGenerator_JS_"+GAe++%bAe;let u=UH[g];return u||(u=UH[g]={workerModule:Mv({name:g,workerId:g,dependencies:[rj,jh],init(d,h){const f=d().javascript.generate;return function(...I){const A=h();return{textureData:f(...I),timing:h()-A}}},getTransferables(d){return[d.textureData.buffer]}}),requests:0,idleTimer:null}),u.requests++,clearTimeout(u.idleTimer),u.workerModule(n,e,t,i,r,s).then(({textureData:d,timing:h})=>{const f=jh(),I=new Uint8Array(d.length*4);for(let A=0;A<d.length;A++)I[A*4+c]=d[A];return nx.webglUtils.renderImageData(o,I,a,l,n,e,1<<3-c),h+=jh()-f,--u.requests===0&&(u.idleTimer=setTimeout(()=>{lAe(g)},BAe)),{timing:h}})}function wAe(n){n._warm||(nx.webgl.isSupported(n),n._warm=!0)}const xAe=nx.webglUtils.resizeWebGLCanvasWithoutClearing;/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function SAe(){return typeof window>"u"&&(self.window=self),function(n){var e={parse:function(r){var s=e._bin,o=new Uint8Array(r);if(s.readASCII(o,0,4)=="ttcf"){var a=4;s.readUshort(o,a),a+=2,s.readUshort(o,a),a+=2;var l=s.readUint(o,a);a+=4;for(var c=[],g=0;g<l;g++){var u=s.readUint(o,a);a+=4,c.push(e._readFont(o,u))}return c}return[e._readFont(o,0)]},_readFont:function(r,s){var o=e._bin,a=s;o.readFixed(r,s),s+=4;var l=o.readUshort(r,s);s+=2,o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2;for(var c=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GPOS","GSUB","SVG "],g={_data:r,_offset:a},u={},d=0;d<l;d++){var h=o.readASCII(r,s,4);s+=4,o.readUint(r,s),s+=4;var f=o.readUint(r,s);s+=4;var I=o.readUint(r,s);s+=4,u[h]={offset:f,length:I}}for(d=0;d<c.length;d++){var A=c[d];u[A]&&(g[A.trim()]=e[A.trim()].parse(r,u[A].offset,u[A].length,g))}return g},_tabOffset:function(r,s,o){for(var a=e._bin,l=a.readUshort(r,o+4),c=o+12,g=0;g<l;g++){var u=a.readASCII(r,c,4);c+=4,a.readUint(r,c),c+=4;var d=a.readUint(r,c);if(c+=4,a.readUint(r,c),c+=4,u==s)return d}return 0}};e._bin={readFixed:function(r,s){return(r[s]<<8|r[s+1])+(r[s+2]<<8|r[s+3])/65540},readF2dot14:function(r,s){return e._bin.readShort(r,s)/16384},readInt:function(r,s){return e._bin._view(r).getInt32(s)},readInt8:function(r,s){return e._bin._view(r).getInt8(s)},readShort:function(r,s){return e._bin._view(r).getInt16(s)},readUshort:function(r,s){return e._bin._view(r).getUint16(s)},readUshorts:function(r,s,o){for(var a=[],l=0;l<o;l++)a.push(e._bin.readUshort(r,s+2*l));return a},readUint:function(r,s){return e._bin._view(r).getUint32(s)},readUint64:function(r,s){return 4294967296*e._bin.readUint(r,s)+e._bin.readUint(r,s+4)},readASCII:function(r,s,o){for(var a="",l=0;l<o;l++)a+=String.fromCharCode(r[s+l]);return a},readUnicode:function(r,s,o){for(var a="",l=0;l<o;l++){var c=r[s++]<<8|r[s++];a+=String.fromCharCode(c)}return a},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(r,s,o){var a=e._bin._tdec;return a&&s==0&&o==r.length?a.decode(r):e._bin.readASCII(r,s,o)},readBytes:function(r,s,o){for(var a=[],l=0;l<o;l++)a.push(r[s+l]);return a},readASCIIArray:function(r,s,o){for(var a=[],l=0;l<o;l++)a.push(String.fromCharCode(r[s+l]));return a},_view:function(r){return r._dataView||(r._dataView=r.buffer?new DataView(r.buffer,r.byteOffset,r.byteLength):new DataView(new Uint8Array(r).buffer))}},e._lctf={},e._lctf.parse=function(r,s,o,a,l){var c=e._bin,g={},u=s;c.readFixed(r,s),s+=4;var d=c.readUshort(r,s);s+=2;var h=c.readUshort(r,s);s+=2;var f=c.readUshort(r,s);return s+=2,g.scriptList=e._lctf.readScriptList(r,u+d),g.featureList=e._lctf.readFeatureList(r,u+h),g.lookupList=e._lctf.readLookupList(r,u+f,l),g},e._lctf.readLookupList=function(r,s,o){var a=e._bin,l=s,c=[],g=a.readUshort(r,s);s+=2;for(var u=0;u<g;u++){var d=a.readUshort(r,s);s+=2;var h=e._lctf.readLookupTable(r,l+d,o);c.push(h)}return c},e._lctf.readLookupTable=function(r,s,o){var a=e._bin,l=s,c={tabs:[]};c.ltype=a.readUshort(r,s),s+=2,c.flag=a.readUshort(r,s),s+=2;var g=a.readUshort(r,s);s+=2;for(var u=c.ltype,d=0;d<g;d++){var h=a.readUshort(r,s);s+=2;var f=o(r,u,l+h,c);c.tabs.push(f)}return c},e._lctf.numOfOnes=function(r){for(var s=0,o=0;o<32;o++)r>>>o&1&&s++;return s},e._lctf.readClassDef=function(r,s){var o=e._bin,a=[],l=o.readUshort(r,s);if(s+=2,l==1){var c=o.readUshort(r,s);s+=2;var g=o.readUshort(r,s);s+=2;for(var u=0;u<g;u++)a.push(c+u),a.push(c+u),a.push(o.readUshort(r,s)),s+=2}if(l==2){var d=o.readUshort(r,s);for(s+=2,u=0;u<d;u++)a.push(o.readUshort(r,s)),s+=2,a.push(o.readUshort(r,s)),s+=2,a.push(o.readUshort(r,s)),s+=2}return a},e._lctf.getInterval=function(r,s){for(var o=0;o<r.length;o+=3){var a=r[o],l=r[o+1];if(r[o+2],a<=s&&s<=l)return o}return-1},e._lctf.readCoverage=function(r,s){var o=e._bin,a={};a.fmt=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);return s+=2,a.fmt==1&&(a.tab=o.readUshorts(r,s,l)),a.fmt==2&&(a.tab=o.readUshorts(r,s,3*l)),a},e._lctf.coverageIndex=function(r,s){var o=r.tab;if(r.fmt==1)return o.indexOf(s);if(r.fmt==2){var a=e._lctf.getInterval(o,s);if(a!=-1)return o[a+2]+(s-o[a])}return-1},e._lctf.readFeatureList=function(r,s){var o=e._bin,a=s,l=[],c=o.readUshort(r,s);s+=2;for(var g=0;g<c;g++){var u=o.readASCII(r,s,4);s+=4;var d=o.readUshort(r,s);s+=2;var h=e._lctf.readFeatureTable(r,a+d);h.tag=u.trim(),l.push(h)}return l},e._lctf.readFeatureTable=function(r,s){var o=e._bin,a=s,l={},c=o.readUshort(r,s);s+=2,c>0&&(l.featureParams=a+c);var g=o.readUshort(r,s);s+=2,l.tab=[];for(var u=0;u<g;u++)l.tab.push(o.readUshort(r,s+2*u));return l},e._lctf.readScriptList=function(r,s){var o=e._bin,a=s,l={},c=o.readUshort(r,s);s+=2;for(var g=0;g<c;g++){var u=o.readASCII(r,s,4);s+=4;var d=o.readUshort(r,s);s+=2,l[u.trim()]=e._lctf.readScriptTable(r,a+d)}return l},e._lctf.readScriptTable=function(r,s){var o=e._bin,a=s,l={},c=o.readUshort(r,s);s+=2,l.default=e._lctf.readLangSysTable(r,a+c);var g=o.readUshort(r,s);s+=2;for(var u=0;u<g;u++){var d=o.readASCII(r,s,4);s+=4;var h=o.readUshort(r,s);s+=2,l[d.trim()]=e._lctf.readLangSysTable(r,a+h)}return l},e._lctf.readLangSysTable=function(r,s){var o=e._bin,a={};o.readUshort(r,s),s+=2,a.reqFeature=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);return s+=2,a.features=o.readUshorts(r,s,l),a},e.CFF={},e.CFF.parse=function(r,s,o){var a=e._bin;(r=new Uint8Array(r.buffer,s,o))[s=0],r[++s],r[++s],r[++s],s++;var l=[];s=e.CFF.readIndex(r,s,l);for(var c=[],g=0;g<l.length-1;g++)c.push(a.readASCII(r,s+l[g],l[g+1]-l[g]));s+=l[l.length-1];var u=[];s=e.CFF.readIndex(r,s,u);var d=[];for(g=0;g<u.length-1;g++)d.push(e.CFF.readDict(r,s+u[g],s+u[g+1]));s+=u[u.length-1];var h=d[0],f=[];s=e.CFF.readIndex(r,s,f);var I=[];for(g=0;g<f.length-1;g++)I.push(a.readASCII(r,s+f[g],f[g+1]-f[g]));if(s+=f[f.length-1],e.CFF.readSubrs(r,s,h),h.CharStrings){s=h.CharStrings,f=[],s=e.CFF.readIndex(r,s,f);var A=[];for(g=0;g<f.length-1;g++)A.push(a.readBytes(r,s+f[g],f[g+1]-f[g]));h.CharStrings=A}if(h.ROS){s=h.FDArray;var p=[];for(s=e.CFF.readIndex(r,s,p),h.FDArray=[],g=0;g<p.length-1;g++){var y=e.CFF.readDict(r,s+p[g],s+p[g+1]);e.CFF._readFDict(r,y,I),h.FDArray.push(y)}s+=p[p.length-1],s=h.FDSelect,h.FDSelect=[];var v=r[s];if(s++,v!=3)throw v;var b=a.readUshort(r,s);for(s+=2,g=0;g<b+1;g++)h.FDSelect.push(a.readUshort(r,s),r[s+2]),s+=3}return h.Encoding&&(h.Encoding=e.CFF.readEncoding(r,h.Encoding,h.CharStrings.length)),h.charset&&(h.charset=e.CFF.readCharset(r,h.charset,h.CharStrings.length)),e.CFF._readFDict(r,h,I),h},e.CFF._readFDict=function(r,s,o){var a;for(var l in s.Private&&(a=s.Private[1],s.Private=e.CFF.readDict(r,a,a+s.Private[0]),s.Private.Subrs&&e.CFF.readSubrs(r,a+s.Private.Subrs,s.Private)),s)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(l)!=-1&&(s[l]=o[s[l]-426+35])},e.CFF.readSubrs=function(r,s,o){var a=e._bin,l=[];s=e.CFF.readIndex(r,s,l);var c,g=l.length;c=g<1240?107:g<33900?1131:32768,o.Bias=c,o.Subrs=[];for(var u=0;u<l.length-1;u++)o.Subrs.push(a.readBytes(r,s+l[u],l[u+1]-l[u]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(r,s){for(var o=0;o<r.charset.length;o++)if(r.charset[o]==s)return o;return-1},e.CFF.glyphBySE=function(r,s){return s<0||s>255?-1:e.CFF.glyphByUnicode(r,e.CFF.tableSE[s])},e.CFF.readEncoding=function(r,s,o){e._bin;var a=[".notdef"],l=r[s];if(s++,l!=0)throw"error: unknown encoding format: "+l;var c=r[s];s++;for(var g=0;g<c;g++)a.push(r[s+g]);return a},e.CFF.readCharset=function(r,s,o){var a=e._bin,l=[".notdef"],c=r[s];if(s++,c==0)for(var g=0;g<o;g++){var u=a.readUshort(r,s);s+=2,l.push(u)}else{if(c!=1&&c!=2)throw"error: format: "+c;for(;l.length<o;){u=a.readUshort(r,s),s+=2;var d=0;for(c==1?(d=r[s],s++):(d=a.readUshort(r,s),s+=2),g=0;g<=d;g++)l.push(u),u++}}return l},e.CFF.readIndex=function(r,s,o){var a=e._bin,l=a.readUshort(r,s)+1,c=r[s+=2];if(s++,c==1)for(var g=0;g<l;g++)o.push(r[s+g]);else if(c==2)for(g=0;g<l;g++)o.push(a.readUshort(r,s+2*g));else if(c==3)for(g=0;g<l;g++)o.push(16777215&a.readUint(r,s+3*g-1));else if(l!=1)throw"unsupported offset size: "+c+", count: "+l;return(s+=l*c)-1},e.CFF.getCharString=function(r,s,o){var a=e._bin,l=r[s],c=r[s+1];r[s+2],r[s+3],r[s+4];var g=1,u=null,d=null;l<=20&&(u=l,g=1),l==12&&(u=100*l+c,g=2),21<=l&&l<=27&&(u=l,g=1),l==28&&(d=a.readShort(r,s+1),g=3),29<=l&&l<=31&&(u=l,g=1),32<=l&&l<=246&&(d=l-139,g=1),247<=l&&l<=250&&(d=256*(l-247)+c+108,g=2),251<=l&&l<=254&&(d=256*-(l-251)-c-108,g=2),l==255&&(d=a.readInt(r,s+1)/65535,g=5),o.val=d??"o"+u,o.size=g},e.CFF.readCharString=function(r,s,o){for(var a=s+o,l=e._bin,c=[];s<a;){var g=r[s],u=r[s+1];r[s+2],r[s+3],r[s+4];var d=1,h=null,f=null;g<=20&&(h=g,d=1),g==12&&(h=100*g+u,d=2),g!=19&&g!=20||(h=g,d=2),21<=g&&g<=27&&(h=g,d=1),g==28&&(f=l.readShort(r,s+1),d=3),29<=g&&g<=31&&(h=g,d=1),32<=g&&g<=246&&(f=g-139,d=1),247<=g&&g<=250&&(f=256*(g-247)+u+108,d=2),251<=g&&g<=254&&(f=256*-(g-251)-u-108,d=2),g==255&&(f=l.readInt(r,s+1)/65535,d=5),c.push(f??"o"+h),s+=d}return c},e.CFF.readDict=function(r,s,o){for(var a=e._bin,l={},c=[];s<o;){var g=r[s],u=r[s+1];r[s+2],r[s+3],r[s+4];var d=1,h=null,f=null;if(g==28&&(f=a.readShort(r,s+1),d=3),g==29&&(f=a.readInt(r,s+1),d=5),32<=g&&g<=246&&(f=g-139,d=1),247<=g&&g<=250&&(f=256*(g-247)+u+108,d=2),251<=g&&g<=254&&(f=256*-(g-251)-u-108,d=2),g==255)throw f=a.readInt(r,s+1)/65535,d=5,"unknown number";if(g==30){var I=[];for(d=1;;){var A=r[s+d];d++;var p=A>>4,y=15&A;if(p!=15&&I.push(p),y!=15&&I.push(y),y==15)break}for(var v="",b=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],w=0;w<I.length;w++)v+=b[I[w]];f=parseFloat(v)}g<=21&&(h=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][g],d=1,g==12&&(h=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][u],d=2)),h!=null?(l[h]=c.length==1?c[0]:c,c=[]):c.push(f),s+=d}return l},e.cmap={},e.cmap.parse=function(r,s,o){r=new Uint8Array(r.buffer,s,o),s=0;var a=e._bin,l={};a.readUshort(r,s),s+=2;var c=a.readUshort(r,s);s+=2;var g=[];l.tables=[];for(var u=0;u<c;u++){var d=a.readUshort(r,s);s+=2;var h=a.readUshort(r,s);s+=2;var f=a.readUint(r,s);s+=4;var I="p"+d+"e"+h,A=g.indexOf(f);if(A==-1){var p;A=l.tables.length,g.push(f);var y=a.readUshort(r,f);y==0?p=e.cmap.parse0(r,f):y==4?p=e.cmap.parse4(r,f):y==6?p=e.cmap.parse6(r,f):y==12?p=e.cmap.parse12(r,f):console.debug("unknown format: "+y,d,h,f),l.tables.push(p)}if(l[I]!=null)throw"multiple tables for one platform+encoding";l[I]=A}return l},e.cmap.parse0=function(r,s){var o=e._bin,a={};a.format=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);s+=2,o.readUshort(r,s),s+=2,a.map=[];for(var c=0;c<l-6;c++)a.map.push(r[s+c]);return a},e.cmap.parse4=function(r,s){var o=e._bin,a=s,l={};l.format=o.readUshort(r,s),s+=2;var c=o.readUshort(r,s);s+=2,o.readUshort(r,s),s+=2;var g=o.readUshort(r,s);s+=2;var u=g/2;l.searchRange=o.readUshort(r,s),s+=2,l.entrySelector=o.readUshort(r,s),s+=2,l.rangeShift=o.readUshort(r,s),s+=2,l.endCount=o.readUshorts(r,s,u),s+=2*u,s+=2,l.startCount=o.readUshorts(r,s,u),s+=2*u,l.idDelta=[];for(var d=0;d<u;d++)l.idDelta.push(o.readShort(r,s)),s+=2;for(l.idRangeOffset=o.readUshorts(r,s,u),s+=2*u,l.glyphIdArray=[];s<a+c;)l.glyphIdArray.push(o.readUshort(r,s)),s+=2;return l},e.cmap.parse6=function(r,s){var o=e._bin,a={};a.format=o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2,a.firstCode=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);s+=2,a.glyphIdArray=[];for(var c=0;c<l;c++)a.glyphIdArray.push(o.readUshort(r,s)),s+=2;return a},e.cmap.parse12=function(r,s){var o=e._bin,a={};a.format=o.readUshort(r,s),s+=2,s+=2,o.readUint(r,s),s+=4,o.readUint(r,s),s+=4;var l=o.readUint(r,s);s+=4,a.groups=[];for(var c=0;c<l;c++){var g=s+12*c,u=o.readUint(r,g+0),d=o.readUint(r,g+4),h=o.readUint(r,g+8);a.groups.push([u,d,h])}return a},e.glyf={},e.glyf.parse=function(r,s,o,a){for(var l=[],c=0;c<a.maxp.numGlyphs;c++)l.push(null);return l},e.glyf._parseGlyf=function(r,s){var o=e._bin,a=r._data,l=e._tabOffset(a,"glyf",r._offset)+r.loca[s];if(r.loca[s]==r.loca[s+1])return null;var c={};if(c.noc=o.readShort(a,l),l+=2,c.xMin=o.readShort(a,l),l+=2,c.yMin=o.readShort(a,l),l+=2,c.xMax=o.readShort(a,l),l+=2,c.yMax=o.readShort(a,l),l+=2,c.xMin>=c.xMax||c.yMin>=c.yMax)return null;if(c.noc>0){c.endPts=[];for(var g=0;g<c.noc;g++)c.endPts.push(o.readUshort(a,l)),l+=2;var u=o.readUshort(a,l);if(l+=2,a.length-l<u)return null;c.instructions=o.readBytes(a,l,u),l+=u;var d=c.endPts[c.noc-1]+1;for(c.flags=[],g=0;g<d;g++){var h=a[l];if(l++,c.flags.push(h),(8&h)!=0){var f=a[l];l++;for(var I=0;I<f;I++)c.flags.push(h),g++}}for(c.xs=[],g=0;g<d;g++){var A=(2&c.flags[g])!=0,p=(16&c.flags[g])!=0;A?(c.xs.push(p?a[l]:-a[l]),l++):p?c.xs.push(0):(c.xs.push(o.readShort(a,l)),l+=2)}for(c.ys=[],g=0;g<d;g++)A=(4&c.flags[g])!=0,p=(32&c.flags[g])!=0,A?(c.ys.push(p?a[l]:-a[l]),l++):p?c.ys.push(0):(c.ys.push(o.readShort(a,l)),l+=2);var y=0,v=0;for(g=0;g<d;g++)y+=c.xs[g],v+=c.ys[g],c.xs[g]=y,c.ys[g]=v}else{var b;c.parts=[];do{b=o.readUshort(a,l),l+=2;var w={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(c.parts.push(w),w.glyphIndex=o.readUshort(a,l),l+=2,1&b){var G=o.readShort(a,l);l+=2;var x=o.readShort(a,l);l+=2}else G=o.readInt8(a,l),l++,x=o.readInt8(a,l),l++;2&b?(w.m.tx=G,w.m.ty=x):(w.p1=G,w.p2=x),8&b?(w.m.a=w.m.d=o.readF2dot14(a,l),l+=2):64&b?(w.m.a=o.readF2dot14(a,l),l+=2,w.m.d=o.readF2dot14(a,l),l+=2):128&b&&(w.m.a=o.readF2dot14(a,l),l+=2,w.m.b=o.readF2dot14(a,l),l+=2,w.m.c=o.readF2dot14(a,l),l+=2,w.m.d=o.readF2dot14(a,l),l+=2)}while(32&b);if(256&b){var B=o.readUshort(a,l);for(l+=2,c.instr=[],g=0;g<B;g++)c.instr.push(a[l]),l++}}return c},e.GPOS={},e.GPOS.parse=function(r,s,o,a){return e._lctf.parse(r,s,o,a,e.GPOS.subt)},e.GPOS.subt=function(r,s,o,a){var l=e._bin,c=o,g={};if(g.fmt=l.readUshort(r,o),o+=2,s==1||s==2||s==3||s==7||s==8&&g.fmt<=2){var u=l.readUshort(r,o);o+=2,g.coverage=e._lctf.readCoverage(r,u+c)}if(s==1&&g.fmt==1){var d=l.readUshort(r,o);o+=2;var h=e._lctf.numOfOnes(d);d!=0&&(g.pos=e.GPOS.readValueRecord(r,o,d))}else if(s==2&&g.fmt>=1&&g.fmt<=2){d=l.readUshort(r,o),o+=2;var f=l.readUshort(r,o);o+=2,h=e._lctf.numOfOnes(d);var I=e._lctf.numOfOnes(f);if(g.fmt==1){g.pairsets=[];var A=l.readUshort(r,o);o+=2;for(var p=0;p<A;p++){var y=c+l.readUshort(r,o);o+=2;var v=l.readUshort(r,y);y+=2;for(var b=[],w=0;w<v;w++){var G=l.readUshort(r,y);y+=2,d!=0&&(F=e.GPOS.readValueRecord(r,y,d),y+=2*h),f!=0&&(T=e.GPOS.readValueRecord(r,y,f),y+=2*I),b.push({gid2:G,val1:F,val2:T})}g.pairsets.push(b)}}if(g.fmt==2){var x=l.readUshort(r,o);o+=2;var B=l.readUshort(r,o);o+=2;var R=l.readUshort(r,o);o+=2;var Z=l.readUshort(r,o);for(o+=2,g.classDef1=e._lctf.readClassDef(r,c+x),g.classDef2=e._lctf.readClassDef(r,c+B),g.matrix=[],p=0;p<R;p++){var W=[];for(w=0;w<Z;w++){var F=null,T=null;d!=0&&(F=e.GPOS.readValueRecord(r,o,d),o+=2*h),f!=0&&(T=e.GPOS.readValueRecord(r,o,f),o+=2*I),W.push({val1:F,val2:T})}g.matrix.push(W)}}}else{if(s==9&&g.fmt==1){var V=l.readUshort(r,o);o+=2;var z=l.readUint(r,o);if(o+=4,a.ltype==9)a.ltype=V;else if(a.ltype!=V)throw"invalid extension substitution";return e.GPOS.subt(r,a.ltype,c+z)}console.debug("unsupported GPOS table LookupType",s,"format",g.fmt)}return g},e.GPOS.readValueRecord=function(r,s,o){var a=e._bin,l=[];return l.push(1&o?a.readShort(r,s):0),s+=1&o?2:0,l.push(2&o?a.readShort(r,s):0),s+=2&o?2:0,l.push(4&o?a.readShort(r,s):0),s+=4&o?2:0,l.push(8&o?a.readShort(r,s):0),s+=8&o?2:0,l},e.GSUB={},e.GSUB.parse=function(r,s,o,a){return e._lctf.parse(r,s,o,a,e.GSUB.subt)},e.GSUB.subt=function(r,s,o,a){var l=e._bin,c=o,g={};if(g.fmt=l.readUshort(r,o),o+=2,s!=1&&s!=4&&s!=5&&s!=6)return null;if(s==1||s==4||s==5&&g.fmt<=2||s==6&&g.fmt<=2){var u=l.readUshort(r,o);o+=2,g.coverage=e._lctf.readCoverage(r,c+u)}if(s==1&&g.fmt>=1&&g.fmt<=2){if(g.fmt==1)g.delta=l.readShort(r,o),o+=2;else if(g.fmt==2){var d=l.readUshort(r,o);o+=2,g.newg=l.readUshorts(r,o,d),o+=2*g.newg.length}}else if(s==4){g.vals=[],d=l.readUshort(r,o),o+=2;for(var h=0;h<d;h++){var f=l.readUshort(r,o);o+=2,g.vals.push(e.GSUB.readLigatureSet(r,c+f))}}else if(s==5&&g.fmt==2){if(g.fmt==2){var I=l.readUshort(r,o);o+=2,g.cDef=e._lctf.readClassDef(r,c+I),g.scset=[];var A=l.readUshort(r,o);for(o+=2,h=0;h<A;h++){var p=l.readUshort(r,o);o+=2,g.scset.push(p==0?null:e.GSUB.readSubClassSet(r,c+p))}}}else if(s==6&&g.fmt==3){if(g.fmt==3){for(h=0;h<3;h++){d=l.readUshort(r,o),o+=2;for(var y=[],v=0;v<d;v++)y.push(e._lctf.readCoverage(r,c+l.readUshort(r,o+2*v)));o+=2*d,h==0&&(g.backCvg=y),h==1&&(g.inptCvg=y),h==2&&(g.ahedCvg=y)}d=l.readUshort(r,o),o+=2,g.lookupRec=e.GSUB.readSubstLookupRecords(r,o,d)}}else{if(s==7&&g.fmt==1){var b=l.readUshort(r,o);o+=2;var w=l.readUint(r,o);if(o+=4,a.ltype==9)a.ltype=b;else if(a.ltype!=b)throw"invalid extension substitution";return e.GSUB.subt(r,a.ltype,c+w)}console.debug("unsupported GSUB table LookupType",s,"format",g.fmt)}return g},e.GSUB.readSubClassSet=function(r,s){var o=e._bin.readUshort,a=s,l=[],c=o(r,s);s+=2;for(var g=0;g<c;g++){var u=o(r,s);s+=2,l.push(e.GSUB.readSubClassRule(r,a+u))}return l},e.GSUB.readSubClassRule=function(r,s){var o=e._bin.readUshort,a={},l=o(r,s),c=o(r,s+=2);s+=2,a.input=[];for(var g=0;g<l-1;g++)a.input.push(o(r,s)),s+=2;return a.substLookupRecords=e.GSUB.readSubstLookupRecords(r,s,c),a},e.GSUB.readSubstLookupRecords=function(r,s,o){for(var a=e._bin.readUshort,l=[],c=0;c<o;c++)l.push(a(r,s),a(r,s+2)),s+=4;return l},e.GSUB.readChainSubClassSet=function(r,s){var o=e._bin,a=s,l=[],c=o.readUshort(r,s);s+=2;for(var g=0;g<c;g++){var u=o.readUshort(r,s);s+=2,l.push(e.GSUB.readChainSubClassRule(r,a+u))}return l},e.GSUB.readChainSubClassRule=function(r,s){for(var o=e._bin,a={},l=["backtrack","input","lookahead"],c=0;c<l.length;c++){var g=o.readUshort(r,s);s+=2,c==1&&g--,a[l[c]]=o.readUshorts(r,s,g),s+=2*a[l[c]].length}return g=o.readUshort(r,s),s+=2,a.subst=o.readUshorts(r,s,2*g),s+=2*a.subst.length,a},e.GSUB.readLigatureSet=function(r,s){var o=e._bin,a=s,l=[],c=o.readUshort(r,s);s+=2;for(var g=0;g<c;g++){var u=o.readUshort(r,s);s+=2,l.push(e.GSUB.readLigature(r,a+u))}return l},e.GSUB.readLigature=function(r,s){var o=e._bin,a={chain:[]};a.nglyph=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);s+=2;for(var c=0;c<l-1;c++)a.chain.push(o.readUshort(r,s)),s+=2;return a},e.head={},e.head.parse=function(r,s,o){var a=e._bin,l={};return a.readFixed(r,s),s+=4,l.fontRevision=a.readFixed(r,s),s+=4,a.readUint(r,s),s+=4,a.readUint(r,s),s+=4,l.flags=a.readUshort(r,s),s+=2,l.unitsPerEm=a.readUshort(r,s),s+=2,l.created=a.readUint64(r,s),s+=8,l.modified=a.readUint64(r,s),s+=8,l.xMin=a.readShort(r,s),s+=2,l.yMin=a.readShort(r,s),s+=2,l.xMax=a.readShort(r,s),s+=2,l.yMax=a.readShort(r,s),s+=2,l.macStyle=a.readUshort(r,s),s+=2,l.lowestRecPPEM=a.readUshort(r,s),s+=2,l.fontDirectionHint=a.readShort(r,s),s+=2,l.indexToLocFormat=a.readShort(r,s),s+=2,l.glyphDataFormat=a.readShort(r,s),s+=2,l},e.hhea={},e.hhea.parse=function(r,s,o){var a=e._bin,l={};return a.readFixed(r,s),s+=4,l.ascender=a.readShort(r,s),s+=2,l.descender=a.readShort(r,s),s+=2,l.lineGap=a.readShort(r,s),s+=2,l.advanceWidthMax=a.readUshort(r,s),s+=2,l.minLeftSideBearing=a.readShort(r,s),s+=2,l.minRightSideBearing=a.readShort(r,s),s+=2,l.xMaxExtent=a.readShort(r,s),s+=2,l.caretSlopeRise=a.readShort(r,s),s+=2,l.caretSlopeRun=a.readShort(r,s),s+=2,l.caretOffset=a.readShort(r,s),s+=2,s+=8,l.metricDataFormat=a.readShort(r,s),s+=2,l.numberOfHMetrics=a.readUshort(r,s),s+=2,l},e.hmtx={},e.hmtx.parse=function(r,s,o,a){for(var l=e._bin,c={aWidth:[],lsBearing:[]},g=0,u=0,d=0;d<a.maxp.numGlyphs;d++)d<a.hhea.numberOfHMetrics&&(g=l.readUshort(r,s),s+=2,u=l.readShort(r,s),s+=2),c.aWidth.push(g),c.lsBearing.push(u);return c},e.kern={},e.kern.parse=function(r,s,o,a){var l=e._bin,c=l.readUshort(r,s);if(s+=2,c==1)return e.kern.parseV1(r,s-2,o,a);var g=l.readUshort(r,s);s+=2;for(var u={glyph1:[],rval:[]},d=0;d<g;d++){s+=2,o=l.readUshort(r,s),s+=2;var h=l.readUshort(r,s);s+=2;var f=h>>>8;if((f&=15)!=0)throw"unknown kern table format: "+f;s=e.kern.readFormat0(r,s,u)}return u},e.kern.parseV1=function(r,s,o,a){var l=e._bin;l.readFixed(r,s),s+=4;var c=l.readUint(r,s);s+=4;for(var g={glyph1:[],rval:[]},u=0;u<c;u++){l.readUint(r,s),s+=4;var d=l.readUshort(r,s);s+=2,l.readUshort(r,s),s+=2;var h=d>>>8;if((h&=15)!=0)throw"unknown kern table format: "+h;s=e.kern.readFormat0(r,s,g)}return g},e.kern.readFormat0=function(r,s,o){var a=e._bin,l=-1,c=a.readUshort(r,s);s+=2,a.readUshort(r,s),s+=2,a.readUshort(r,s),s+=2,a.readUshort(r,s),s+=2;for(var g=0;g<c;g++){var u=a.readUshort(r,s);s+=2;var d=a.readUshort(r,s);s+=2;var h=a.readShort(r,s);s+=2,u!=l&&(o.glyph1.push(u),o.rval.push({glyph2:[],vals:[]}));var f=o.rval[o.rval.length-1];f.glyph2.push(d),f.vals.push(h),l=u}return s},e.loca={},e.loca.parse=function(r,s,o,a){var l=e._bin,c=[],g=a.head.indexToLocFormat,u=a.maxp.numGlyphs+1;if(g==0)for(var d=0;d<u;d++)c.push(l.readUshort(r,s+(d<<1))<<1);if(g==1)for(d=0;d<u;d++)c.push(l.readUint(r,s+(d<<2)));return c},e.maxp={},e.maxp.parse=function(r,s,o){var a=e._bin,l={},c=a.readUint(r,s);return s+=4,l.numGlyphs=a.readUshort(r,s),s+=2,c==65536&&(l.maxPoints=a.readUshort(r,s),s+=2,l.maxContours=a.readUshort(r,s),s+=2,l.maxCompositePoints=a.readUshort(r,s),s+=2,l.maxCompositeContours=a.readUshort(r,s),s+=2,l.maxZones=a.readUshort(r,s),s+=2,l.maxTwilightPoints=a.readUshort(r,s),s+=2,l.maxStorage=a.readUshort(r,s),s+=2,l.maxFunctionDefs=a.readUshort(r,s),s+=2,l.maxInstructionDefs=a.readUshort(r,s),s+=2,l.maxStackElements=a.readUshort(r,s),s+=2,l.maxSizeOfInstructions=a.readUshort(r,s),s+=2,l.maxComponentElements=a.readUshort(r,s),s+=2,l.maxComponentDepth=a.readUshort(r,s),s+=2),l},e.name={},e.name.parse=function(r,s,o){var a=e._bin,l={};a.readUshort(r,s),s+=2;var c=a.readUshort(r,s);s+=2,a.readUshort(r,s);for(var g,u=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],d=s+=2,h=0;h<c;h++){var f=a.readUshort(r,s);s+=2;var I=a.readUshort(r,s);s+=2;var A=a.readUshort(r,s);s+=2;var p=a.readUshort(r,s);s+=2;var y=a.readUshort(r,s);s+=2;var v=a.readUshort(r,s);s+=2;var b,w=u[p],G=d+12*c+v;if(f==0)b=a.readUnicode(r,G,y/2);else if(f==3&&I==0)b=a.readUnicode(r,G,y/2);else if(I==0)b=a.readASCII(r,G,y);else if(I==1)b=a.readUnicode(r,G,y/2);else if(I==3)b=a.readUnicode(r,G,y/2);else{if(f!=1)throw"unknown encoding "+I+", platformID: "+f;b=a.readASCII(r,G,y),console.debug("reading unknown MAC encoding "+I+" as ASCII")}var x="p"+f+","+A.toString(16);l[x]==null&&(l[x]={}),l[x][w!==void 0?w:p]=b,l[x]._lang=A}for(var B in l)if(l[B].postScriptName!=null&&l[B]._lang==1033)return l[B];for(var B in l)if(l[B].postScriptName!=null&&l[B]._lang==0)return l[B];for(var B in l)if(l[B].postScriptName!=null&&l[B]._lang==3084)return l[B];for(var B in l)if(l[B].postScriptName!=null)return l[B];for(var B in l){g=B;break}return console.debug("returning name table with languageID "+l[g]._lang),l[g]},e["OS/2"]={},e["OS/2"].parse=function(r,s,o){var a=e._bin.readUshort(r,s);s+=2;var l={};if(a==0)e["OS/2"].version0(r,s,l);else if(a==1)e["OS/2"].version1(r,s,l);else if(a==2||a==3||a==4)e["OS/2"].version2(r,s,l);else{if(a!=5)throw"unknown OS/2 table version: "+a;e["OS/2"].version5(r,s,l)}return l},e["OS/2"].version0=function(r,s,o){var a=e._bin;return o.xAvgCharWidth=a.readShort(r,s),s+=2,o.usWeightClass=a.readUshort(r,s),s+=2,o.usWidthClass=a.readUshort(r,s),s+=2,o.fsType=a.readUshort(r,s),s+=2,o.ySubscriptXSize=a.readShort(r,s),s+=2,o.ySubscriptYSize=a.readShort(r,s),s+=2,o.ySubscriptXOffset=a.readShort(r,s),s+=2,o.ySubscriptYOffset=a.readShort(r,s),s+=2,o.ySuperscriptXSize=a.readShort(r,s),s+=2,o.ySuperscriptYSize=a.readShort(r,s),s+=2,o.ySuperscriptXOffset=a.readShort(r,s),s+=2,o.ySuperscriptYOffset=a.readShort(r,s),s+=2,o.yStrikeoutSize=a.readShort(r,s),s+=2,o.yStrikeoutPosition=a.readShort(r,s),s+=2,o.sFamilyClass=a.readShort(r,s),s+=2,o.panose=a.readBytes(r,s,10),s+=10,o.ulUnicodeRange1=a.readUint(r,s),s+=4,o.ulUnicodeRange2=a.readUint(r,s),s+=4,o.ulUnicodeRange3=a.readUint(r,s),s+=4,o.ulUnicodeRange4=a.readUint(r,s),s+=4,o.achVendID=[a.readInt8(r,s),a.readInt8(r,s+1),a.readInt8(r,s+2),a.readInt8(r,s+3)],s+=4,o.fsSelection=a.readUshort(r,s),s+=2,o.usFirstCharIndex=a.readUshort(r,s),s+=2,o.usLastCharIndex=a.readUshort(r,s),s+=2,o.sTypoAscender=a.readShort(r,s),s+=2,o.sTypoDescender=a.readShort(r,s),s+=2,o.sTypoLineGap=a.readShort(r,s),s+=2,o.usWinAscent=a.readUshort(r,s),s+=2,o.usWinDescent=a.readUshort(r,s),s+=2},e["OS/2"].version1=function(r,s,o){var a=e._bin;return s=e["OS/2"].version0(r,s,o),o.ulCodePageRange1=a.readUint(r,s),s+=4,o.ulCodePageRange2=a.readUint(r,s),s+=4},e["OS/2"].version2=function(r,s,o){var a=e._bin;return s=e["OS/2"].version1(r,s,o),o.sxHeight=a.readShort(r,s),s+=2,o.sCapHeight=a.readShort(r,s),s+=2,o.usDefault=a.readUshort(r,s),s+=2,o.usBreak=a.readUshort(r,s),s+=2,o.usMaxContext=a.readUshort(r,s),s+=2},e["OS/2"].version5=function(r,s,o){var a=e._bin;return s=e["OS/2"].version2(r,s,o),o.usLowerOpticalPointSize=a.readUshort(r,s),s+=2,o.usUpperOpticalPointSize=a.readUshort(r,s),s+=2},e.post={},e.post.parse=function(r,s,o){var a=e._bin,l={};return l.version=a.readFixed(r,s),s+=4,l.italicAngle=a.readFixed(r,s),s+=4,l.underlinePosition=a.readShort(r,s),s+=2,l.underlineThickness=a.readShort(r,s),s+=2,l},e==null&&(e={}),e.U==null&&(e.U={}),e.U.codeToGlyph=function(r,s){var o=r.cmap,a=-1;if(o.p0e4!=null?a=o.p0e4:o.p3e1!=null?a=o.p3e1:o.p1e0!=null?a=o.p1e0:o.p0e3!=null&&(a=o.p0e3),a==-1)throw"no familiar platform and encoding!";var l=o.tables[a];if(l.format==0)return s>=l.map.length?0:l.map[s];if(l.format==4){for(var c=-1,g=0;g<l.endCount.length;g++)if(s<=l.endCount[g]){c=g;break}return c==-1||l.startCount[c]>s?0:65535&(l.idRangeOffset[c]!=0?l.glyphIdArray[s-l.startCount[c]+(l.idRangeOffset[c]>>1)-(l.idRangeOffset.length-c)]:s+l.idDelta[c])}if(l.format==12){if(s>l.groups[l.groups.length-1][1])return 0;for(g=0;g<l.groups.length;g++){var u=l.groups[g];if(u[0]<=s&&s<=u[1])return u[2]+(s-u[0])}return 0}throw"unknown cmap table format "+l.format},e.U.glyphToPath=function(r,s){var o={cmds:[],crds:[]};if(r.SVG&&r.SVG.entries[s]){var a=r.SVG.entries[s];return a==null?o:(typeof a=="string"&&(a=e.SVG.toPath(a),r.SVG.entries[s]=a),a)}if(r.CFF){var l={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:r.CFF.Private?r.CFF.Private.defaultWidthX:0,open:!1},c=r.CFF,g=r.CFF.Private;if(c.ROS){for(var u=0;c.FDSelect[u+2]<=s;)u+=2;g=c.FDArray[c.FDSelect[u+1]].Private}e.U._drawCFF(r.CFF.CharStrings[s],l,c,g,o)}else r.glyf&&e.U._drawGlyf(s,r,o);return o},e.U._drawGlyf=function(r,s,o){var a=s.glyf[r];a==null&&(a=s.glyf[r]=e.glyf._parseGlyf(s,r)),a!=null&&(a.noc>-1?e.U._simpleGlyph(a,o):e.U._compoGlyph(a,s,o))},e.U._simpleGlyph=function(r,s){for(var o=0;o<r.noc;o++){for(var a=o==0?0:r.endPts[o-1]+1,l=r.endPts[o],c=a;c<=l;c++){var g=c==a?l:c-1,u=c==l?a:c+1,d=1&r.flags[c],h=1&r.flags[g],f=1&r.flags[u],I=r.xs[c],A=r.ys[c];if(c==a)if(d){if(!h){e.U.P.moveTo(s,I,A);continue}e.U.P.moveTo(s,r.xs[g],r.ys[g])}else h?e.U.P.moveTo(s,r.xs[g],r.ys[g]):e.U.P.moveTo(s,(r.xs[g]+I)/2,(r.ys[g]+A)/2);d?h&&e.U.P.lineTo(s,I,A):f?e.U.P.qcurveTo(s,I,A,r.xs[u],r.ys[u]):e.U.P.qcurveTo(s,I,A,(I+r.xs[u])/2,(A+r.ys[u])/2)}e.U.P.closePath(s)}},e.U._compoGlyph=function(r,s,o){for(var a=0;a<r.parts.length;a++){var l={cmds:[],crds:[]},c=r.parts[a];e.U._drawGlyf(c.glyphIndex,s,l);for(var g=c.m,u=0;u<l.crds.length;u+=2){var d=l.crds[u],h=l.crds[u+1];o.crds.push(d*g.a+h*g.b+g.tx),o.crds.push(d*g.c+h*g.d+g.ty)}for(u=0;u<l.cmds.length;u++)o.cmds.push(l.cmds[u])}},e.U._getGlyphClass=function(r,s){var o=e._lctf.getInterval(s,r);return o==-1?0:s[o+2]},e.U.getPairAdjustment=function(r,s,o){var a=!1;if(r.GPOS)for(var l=r.GPOS,c=l.lookupList,g=l.featureList,u=[],d=0;d<g.length;d++){var h=g[d];if(h.tag=="kern"){a=!0;for(var f=0;f<h.tab.length;f++)if(!u[h.tab[f]]){u[h.tab[f]]=!0;for(var I=c[h.tab[f]],A=0;A<I.tabs.length;A++)if(I.tabs[A]!=null){var p,y=I.tabs[A];if((!y.coverage||(p=e._lctf.coverageIndex(y.coverage,s))!=-1)&&I.ltype!=1){if(I.ltype==2){var v=null;if(y.fmt==1){var b=y.pairsets[p];for(d=0;d<b.length;d++)b[d].gid2==o&&(v=b[d])}else if(y.fmt==2){var w=e.U._getGlyphClass(s,y.classDef1),G=e.U._getGlyphClass(o,y.classDef2);v=y.matrix[w][G]}if(v){var x=0;return v.val1&&v.val1[2]&&(x+=v.val1[2]),v.val2&&v.val2[0]&&(x+=v.val2[0]),x}}}}}}}if(r.kern&&!a){var B=r.kern.glyph1.indexOf(s);if(B!=-1){var R=r.kern.rval[B].glyph2.indexOf(o);if(R!=-1)return r.kern.rval[B].vals[R]}}return 0},e.U._applySubs=function(r,s,o,a){for(var l=r.length-s-1,c=0;c<o.tabs.length;c++)if(o.tabs[c]!=null){var g,u=o.tabs[c];if(!u.coverage||(g=e._lctf.coverageIndex(u.coverage,r[s]))!=-1){if(o.ltype==1)r[s],u.fmt==1?r[s]=r[s]+u.delta:r[s]=u.newg[g];else if(o.ltype==4)for(var d=u.vals[g],h=0;h<d.length;h++){var f=d[h],I=f.chain.length;if(!(I>l)){for(var A=!0,p=0,y=0;y<I;y++){for(;r[s+p+(1+y)]==-1;)p++;f.chain[y]!=r[s+p+(1+y)]&&(A=!1)}if(A){for(r[s]=f.nglyph,y=0;y<I+p;y++)r[s+y+1]=-1;break}}}else if(o.ltype==5&&u.fmt==2)for(var v=e._lctf.getInterval(u.cDef,r[s]),b=u.cDef[v+2],w=u.scset[b],G=0;G<w.length;G++){var x=w[G],B=x.input;if(!(B.length>l)){for(A=!0,y=0;y<B.length;y++){var R=e._lctf.getInterval(u.cDef,r[s+1+y]);if(v==-1&&u.cDef[R+2]!=B[y]){A=!1;break}}if(A){var Z=x.substLookupRecords;for(h=0;h<Z.length;h+=2)Z[h],Z[h+1]}}}else if(o.ltype==6&&u.fmt==3){if(!e.U._glsCovered(r,u.backCvg,s-u.backCvg.length)||!e.U._glsCovered(r,u.inptCvg,s)||!e.U._glsCovered(r,u.ahedCvg,s+u.inptCvg.length))continue;var W=u.lookupRec;for(G=0;G<W.length;G+=2){v=W[G];var F=a[W[G+1]];e.U._applySubs(r,s+v,F,a)}}}}},e.U._glsCovered=function(r,s,o){for(var a=0;a<s.length;a++)if(e._lctf.coverageIndex(s[a],r[o+a])==-1)return!1;return!0},e.U.glyphsToPath=function(r,s,o){for(var a={cmds:[],crds:[]},l=0,c=0;c<s.length;c++){var g=s[c];if(g!=-1){for(var u=c<s.length-1&&s[c+1]!=-1?s[c+1]:0,d=e.U.glyphToPath(r,g),h=0;h<d.crds.length;h+=2)a.crds.push(d.crds[h]+l),a.crds.push(d.crds[h+1]);for(o&&a.cmds.push(o),h=0;h<d.cmds.length;h++)a.cmds.push(d.cmds[h]);o&&a.cmds.push("X"),l+=r.hmtx.aWidth[g],c<s.length-1&&(l+=e.U.getPairAdjustment(r,g,u))}}return a},e.U.P={},e.U.P.moveTo=function(r,s,o){r.cmds.push("M"),r.crds.push(s,o)},e.U.P.lineTo=function(r,s,o){r.cmds.push("L"),r.crds.push(s,o)},e.U.P.curveTo=function(r,s,o,a,l,c,g){r.cmds.push("C"),r.crds.push(s,o,a,l,c,g)},e.U.P.qcurveTo=function(r,s,o,a,l){r.cmds.push("Q"),r.crds.push(s,o,a,l)},e.U.P.closePath=function(r){r.cmds.push("Z")},e.U._drawCFF=function(r,s,o,a,l){for(var c=s.stack,g=s.nStems,u=s.haveWidth,d=s.width,h=s.open,f=0,I=s.x,A=s.y,p=0,y=0,v=0,b=0,w=0,G=0,x=0,B=0,R=0,Z=0,W={val:0,size:0};f<r.length;){e.CFF.getCharString(r,f,W);var F=W.val;if(f+=W.size,F=="o1"||F=="o18")c.length%2!=0&&!u&&(d=c.shift()+a.nominalWidthX),g+=c.length>>1,c.length=0,u=!0;else if(F=="o3"||F=="o23")c.length%2!=0&&!u&&(d=c.shift()+a.nominalWidthX),g+=c.length>>1,c.length=0,u=!0;else if(F=="o4")c.length>1&&!u&&(d=c.shift()+a.nominalWidthX,u=!0),h&&e.U.P.closePath(l),A+=c.pop(),e.U.P.moveTo(l,I,A),h=!0;else if(F=="o5")for(;c.length>0;)I+=c.shift(),A+=c.shift(),e.U.P.lineTo(l,I,A);else if(F=="o6"||F=="o7")for(var T=c.length,V=F=="o6",z=0;z<T;z++){var U=c.shift();V?I+=U:A+=U,V=!V,e.U.P.lineTo(l,I,A)}else if(F=="o8"||F=="o24"){T=c.length;for(var J=0;J+6<=T;)p=I+c.shift(),y=A+c.shift(),v=p+c.shift(),b=y+c.shift(),I=v+c.shift(),A=b+c.shift(),e.U.P.curveTo(l,p,y,v,b,I,A),J+=6;F=="o24"&&(I+=c.shift(),A+=c.shift(),e.U.P.lineTo(l,I,A))}else{if(F=="o11")break;if(F=="o1234"||F=="o1235"||F=="o1236"||F=="o1237")F=="o1234"&&(y=A,v=(p=I+c.shift())+c.shift(),Z=b=y+c.shift(),G=b,B=A,I=(x=(w=(R=v+c.shift())+c.shift())+c.shift())+c.shift(),e.U.P.curveTo(l,p,y,v,b,R,Z),e.U.P.curveTo(l,w,G,x,B,I,A)),F=="o1235"&&(p=I+c.shift(),y=A+c.shift(),v=p+c.shift(),b=y+c.shift(),R=v+c.shift(),Z=b+c.shift(),w=R+c.shift(),G=Z+c.shift(),x=w+c.shift(),B=G+c.shift(),I=x+c.shift(),A=B+c.shift(),c.shift(),e.U.P.curveTo(l,p,y,v,b,R,Z),e.U.P.curveTo(l,w,G,x,B,I,A)),F=="o1236"&&(p=I+c.shift(),y=A+c.shift(),v=p+c.shift(),Z=b=y+c.shift(),G=b,x=(w=(R=v+c.shift())+c.shift())+c.shift(),B=G+c.shift(),I=x+c.shift(),e.U.P.curveTo(l,p,y,v,b,R,Z),e.U.P.curveTo(l,w,G,x,B,I,A)),F=="o1237"&&(p=I+c.shift(),y=A+c.shift(),v=p+c.shift(),b=y+c.shift(),R=v+c.shift(),Z=b+c.shift(),w=R+c.shift(),G=Z+c.shift(),x=w+c.shift(),B=G+c.shift(),Math.abs(x-I)>Math.abs(B-A)?I=x+c.shift():A=B+c.shift(),e.U.P.curveTo(l,p,y,v,b,R,Z),e.U.P.curveTo(l,w,G,x,B,I,A));else if(F=="o14"){if(c.length>0&&!u&&(d=c.shift()+o.nominalWidthX,u=!0),c.length==4){var H=c.shift(),Y=c.shift(),K=c.shift(),Q=c.shift(),P=e.CFF.glyphBySE(o,K),ne=e.CFF.glyphBySE(o,Q);e.U._drawCFF(o.CharStrings[P],s,o,a,l),s.x=H,s.y=Y,e.U._drawCFF(o.CharStrings[ne],s,o,a,l)}h&&(e.U.P.closePath(l),h=!1)}else if(F=="o19"||F=="o20")c.length%2!=0&&!u&&(d=c.shift()+a.nominalWidthX),g+=c.length>>1,c.length=0,u=!0,f+=g+7>>3;else if(F=="o21")c.length>2&&!u&&(d=c.shift()+a.nominalWidthX,u=!0),A+=c.pop(),I+=c.pop(),h&&e.U.P.closePath(l),e.U.P.moveTo(l,I,A),h=!0;else if(F=="o22")c.length>1&&!u&&(d=c.shift()+a.nominalWidthX,u=!0),I+=c.pop(),h&&e.U.P.closePath(l),e.U.P.moveTo(l,I,A),h=!0;else if(F=="o25"){for(;c.length>6;)I+=c.shift(),A+=c.shift(),e.U.P.lineTo(l,I,A);p=I+c.shift(),y=A+c.shift(),v=p+c.shift(),b=y+c.shift(),I=v+c.shift(),A=b+c.shift(),e.U.P.curveTo(l,p,y,v,b,I,A)}else if(F=="o26")for(c.length%2&&(I+=c.shift());c.length>0;)p=I,y=A+c.shift(),I=v=p+c.shift(),A=(b=y+c.shift())+c.shift(),e.U.P.curveTo(l,p,y,v,b,I,A);else if(F=="o27")for(c.length%2&&(A+=c.shift());c.length>0;)y=A,v=(p=I+c.shift())+c.shift(),b=y+c.shift(),I=v+c.shift(),A=b,e.U.P.curveTo(l,p,y,v,b,I,A);else if(F=="o10"||F=="o29"){var oe=F=="o10"?a:o;if(c.length==0)console.debug("error: empty stack");else{var $=c.pop(),de=oe.Subrs[$+oe.Bias];s.x=I,s.y=A,s.nStems=g,s.haveWidth=u,s.width=d,s.open=h,e.U._drawCFF(de,s,o,a,l),I=s.x,A=s.y,g=s.nStems,u=s.haveWidth,d=s.width,h=s.open}}else if(F=="o30"||F=="o31"){var ge=c.length,se=(J=0,F=="o31");for(J+=ge-(T=-3&ge);J<T;)se?(y=A,v=(p=I+c.shift())+c.shift(),A=(b=y+c.shift())+c.shift(),T-J==5?(I=v+c.shift(),J++):I=v,se=!1):(p=I,y=A+c.shift(),v=p+c.shift(),b=y+c.shift(),I=v+c.shift(),T-J==5?(A=b+c.shift(),J++):A=b,se=!0),e.U.P.curveTo(l,p,y,v,b,I,A),J+=4}else{if((F+"").charAt(0)=="o")throw console.debug("Unknown operation: "+F,r),F;c.push(F)}}}s.x=I,s.y=A,s.nStems=g,s.haveWidth=u,s.width=d,s.open=h};var t=e,i={Typr:t};return n.Typr=t,n.default=i,Object.defineProperty(n,"__esModule",{value:!0}),n}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function RAe(){return function(n){var e=Uint8Array,t=Uint16Array,i=Uint32Array,r=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a=function(F,T){for(var V=new t(31),z=0;z<31;++z)V[z]=T+=1<<F[z-1];var U=new i(V[30]);for(z=1;z<30;++z)for(var J=V[z];J<V[z+1];++J)U[J]=J-V[z]<<5|z;return[V,U]},l=a(r,2),c=l[0],g=l[1];c[28]=258,g[258]=28;for(var u=a(s,0)[0],d=new t(32768),h=0;h<32768;++h){var f=(43690&h)>>>1|(21845&h)<<1;f=(61680&(f=(52428&f)>>>2|(13107&f)<<2))>>>4|(3855&f)<<4,d[h]=((65280&f)>>>8|(255&f)<<8)>>>1}var I=function(F,T,V){for(var z=F.length,U=0,J=new t(T);U<z;++U)++J[F[U]-1];var H,Y=new t(T);for(U=0;U<T;++U)Y[U]=Y[U-1]+J[U-1]<<1;if(V){H=new t(1<<T);var K=15-T;for(U=0;U<z;++U)if(F[U])for(var Q=U<<4|F[U],P=T-F[U],ne=Y[F[U]-1]++<<P,oe=ne|(1<<P)-1;ne<=oe;++ne)H[d[ne]>>>K]=Q}else for(H=new t(z),U=0;U<z;++U)F[U]&&(H[U]=d[Y[F[U]-1]++]>>>15-F[U]);return H},A=new e(288);for(h=0;h<144;++h)A[h]=8;for(h=144;h<256;++h)A[h]=9;for(h=256;h<280;++h)A[h]=7;for(h=280;h<288;++h)A[h]=8;var p=new e(32);for(h=0;h<32;++h)p[h]=5;var y=I(A,9,1),v=I(p,5,1),b=function(F){for(var T=F[0],V=1;V<F.length;++V)F[V]>T&&(T=F[V]);return T},w=function(F,T,V){var z=T/8|0;return(F[z]|F[z+1]<<8)>>(7&T)&V},G=function(F,T){var V=T/8|0;return(F[V]|F[V+1]<<8|F[V+2]<<16)>>(7&T)},x=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],B=function(F,T,V){var z=new Error(T||x[F]);if(z.code=F,Error.captureStackTrace&&Error.captureStackTrace(z,B),!V)throw z;return z},R=function(F,T,V){var z=F.length;if(!z||V&&!V.l&&z<5)return T||new e(0);var U=!T||V,J=!V||V.i;V||(V={}),T||(T=new e(3*z));var H,Y=function(Ye){var $e=T.length;if(Ye>$e){var mt=new e(Math.max(2*$e,Ye));mt.set(T),T=mt}},K=V.f||0,Q=V.p||0,P=V.b||0,ne=V.l,oe=V.d,$=V.m,de=V.n,ge=8*z;do{if(!ne){V.f=K=w(F,Q,1);var se=w(F,Q+1,3);if(Q+=3,!se){var k=F[(He=((H=Q)/8|0)+(7&H&&1)+4)-4]|F[He-3]<<8,O=He+k;if(O>z){J&&B(0);break}U&&Y(P+k),T.set(F.subarray(He,O),P),V.b=P+=k,V.p=Q=8*O;continue}if(se==1)ne=y,oe=v,$=9,de=5;else if(se==2){var q=w(F,Q,31)+257,ee=w(F,Q+10,15)+4,le=q+w(F,Q+5,31)+1;Q+=14;for(var he=new e(le),be=new e(19),xe=0;xe<ee;++xe)be[o[xe]]=w(F,Q+3*xe,7);Q+=3*ee;var ze=b(be),Se=(1<<ze)-1,ke=I(be,ze,1);for(xe=0;xe<le;){var He,Be=ke[w(F,Q,Se)];if(Q+=15&Be,(He=Be>>>4)<16)he[xe++]=He;else{var j=0,X=0;for(He==16?(X=3+w(F,Q,3),Q+=2,j=he[xe-1]):He==17?(X=3+w(F,Q,7),Q+=3):He==18&&(X=11+w(F,Q,127),Q+=7);X--;)he[xe++]=j}}var ce=he.subarray(0,q),fe=he.subarray(q);$=b(ce),de=b(fe),ne=I(ce,$,1),oe=I(fe,de,1)}else B(1);if(Q>ge){J&&B(0);break}}U&&Y(P+131072);for(var Ge=(1<<$)-1,me=(1<<de)-1,Fe=Q;;Fe=Q){var Le=(j=ne[G(F,Q)&Ge])>>>4;if((Q+=15&j)>ge){J&&B(0);break}if(j||B(2),Le<256)T[P++]=Le;else{if(Le==256){Fe=Q,ne=null;break}var Re=Le-254;if(Le>264){var Xe=r[xe=Le-257];Re=w(F,Q,(1<<Xe)-1)+c[xe],Q+=Xe}var we=oe[G(F,Q)&me],Ue=we>>>4;if(we||B(3),Q+=15&we,fe=u[Ue],Ue>3&&(Xe=s[Ue],fe+=G(F,Q)&(1<<Xe)-1,Q+=Xe),Q>ge){J&&B(0);break}U&&Y(P+131072);for(var Pe=P+Re;P<Pe;P+=4)T[P]=T[P-fe],T[P+1]=T[P+1-fe],T[P+2]=T[P+2-fe],T[P+3]=T[P+3-fe];P=Pe}}V.l=ne,V.p=Fe,V.b=P,ne&&(K=1,V.m=$,V.d=oe,V.n=de)}while(!K);return P==T.length?T:function(Ye,$e,mt){($e==null||$e<0)&&($e=0),(mt==null||mt>Ye.length)&&(mt=Ye.length);var Wt=new(Ye instanceof t?t:Ye instanceof i?i:e)(mt-$e);return Wt.set(Ye.subarray($e,mt)),Wt}(T,0,P)},Z=new e(0),W=typeof TextDecoder<"u"&&new TextDecoder;try{W.decode(Z,{stream:!0})}catch{}return n.convert_streams=function(F){var T=new DataView(F),V=0;function z(){var q=T.getUint16(V);return V+=2,q}function U(){var q=T.getUint32(V);return V+=4,q}function J(q){k.setUint16(O,q),O+=2}function H(q){k.setUint32(O,q),O+=4}for(var Y={signature:U(),flavor:U(),length:U(),numTables:z(),reserved:z(),totalSfntSize:U(),majorVersion:z(),minorVersion:z(),metaOffset:U(),metaLength:U(),metaOrigLength:U(),privOffset:U(),privLength:U()},K=0;Math.pow(2,K)<=Y.numTables;)K++;K--;for(var Q=16*Math.pow(2,K),P=16*Y.numTables-Q,ne=12,oe=[],$=0;$<Y.numTables;$++)oe.push({tag:U(),offset:U(),compLength:U(),origLength:U(),origChecksum:U()}),ne+=16;var de,ge=new Uint8Array(12+16*oe.length+oe.reduce(function(q,ee){return q+ee.origLength+4},0)),se=ge.buffer,k=new DataView(se),O=0;return H(Y.flavor),J(Y.numTables),J(Q),J(K),J(P),oe.forEach(function(q){H(q.tag),H(q.origChecksum),H(ne),H(q.origLength),q.outOffset=ne,(ne+=q.origLength)%4!=0&&(ne+=4-ne%4)}),oe.forEach(function(q){var ee,le=F.slice(q.offset,q.offset+q.compLength);if(q.compLength!=q.origLength){var he=new Uint8Array(q.origLength);ee=new Uint8Array(le,2),R(ee,he)}else he=new Uint8Array(le);ge.set(he,q.outOffset);var be=0;(ne=q.outOffset+q.origLength)%4!=0&&(be=4-ne%4),ge.set(new Uint8Array(be).buffer,q.outOffset+q.origLength),de=ne+be}),se.slice(0,de)},Object.defineProperty(n,"__esModule",{value:!0}),n}({}).convert_streams}function ZAe(n,e){const t={M:2,L:2,Q:4,C:6,Z:0},i={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},r=1,s=2,o=4,a=8,l=16,c=32;let g;function u(w){if(!g){const G={R:s,L:r,D:o,C:l,U:c,T:a};g=new Map;for(let x in i){let B=0;i[x].split(",").forEach(R=>{let[Z,W]=R.split("+");Z=parseInt(Z,36),W=W?parseInt(W,36):0,g.set(B+=Z,G[x]);for(let F=W;F--;)g.set(++B,G[x])})}}return g.get(w)||c}const d=1,h=2,f=3,I=4,A=[null,"isol","init","fina","medi"];function p(w){const G=new Uint8Array(w.length);let x=c,B=d,R=-1;for(let Z=0;Z<w.length;Z++){const W=w.codePointAt(Z);let F=u(W)|0,T=d;F&a||(x&(r|o|l)?F&(s|o|l)?(T=f,(B===d||B===f)&&G[R]++):F&(r|c)&&(B===h||B===I)&&G[R]--:x&(s|c)&&(B===h||B===I)&&G[R]--,B=G[Z]=T,x=F,R=Z,W>65535&&Z++)}return G}function y(w,G){const x=[];for(let R=0;R<G.length;R++){const Z=G.codePointAt(R);Z>65535&&R++,x.push(n.U.codeToGlyph(w,Z))}const B=w.GSUB;if(B){const{lookupList:R,featureList:Z}=B;let W;const F=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws)$/,T=[];Z.forEach(V=>{if(F.test(V.tag))for(let z=0;z<V.tab.length;z++){if(T[V.tab[z]])continue;T[V.tab[z]]=!0;const U=R[V.tab[z]],J=/^(isol|init|fina|medi)$/.test(V.tag);J&&!W&&(W=p(G));for(let H=0;H<x.length;H++)(!W||!J||A[W[H]]===V.tag)&&n.U._applySubs(x,H,U,R)}})}return x}function v(...w){for(let G=0;G<w.length;G++)if(typeof w[G]=="number")return w[G]}function b(w){const G=Object.create(null),x=w["OS/2"],B=w.hhea,R=w.head.unitsPerEm,Z=v(x&&x.sTypoAscender,B&&B.ascender,R),W={unitsPerEm:R,ascender:Z,descender:v(x&&x.sTypoDescender,B&&B.descender,0),capHeight:v(x&&x.sCapHeight,Z),xHeight:v(x&&x.sxHeight,Z),lineGap:v(x&&x.sTypoLineGap,B&&B.lineGap),forEachGlyph(F,T,V,z){let U=0;const J=1/W.unitsPerEm*T,H=y(w,F);let Y=0,K=-1;return H.forEach((Q,P)=>{if(Q!==-1){let ne=G[Q];if(!ne){const{cmds:oe,crds:$}=n.U.glyphToPath(w,Q);let de="",ge=0;for(let ee=0,le=oe.length;ee<le;ee++){const he=t[oe[ee]];de+=oe[ee];for(let be=1;be<=he;be++)de+=(be>1?",":"")+$[ge++]}let se,k,O,q;if($.length){se=k=1/0,O=q=-1/0;for(let ee=0,le=$.length;ee<le;ee+=2){let he=$[ee],be=$[ee+1];he<se&&(se=he),be<k&&(k=be),he>O&&(O=he),be>q&&(q=be)}}else se=O=k=q=0;ne=G[Q]={index:Q,advanceWidth:w.hmtx.aWidth[Q],xMin:se,yMin:k,xMax:O,yMax:q,path:de,pathCommandCount:oe.length}}K!==-1&&(U+=n.U.getPairAdjustment(w,K,Q)*J),z.call(null,ne,U,Y),ne.advanceWidth&&(U+=ne.advanceWidth*J),V&&(U+=V*T),K=Q}Y+=F.codePointAt(Y)>65535?2:1}),U}};return W}return function(G){const x=new Uint8Array(G,0,4),B=n._bin.readASCII(x,0,4);if(B==="wOFF")G=e(G);else if(B==="wOF2")throw new Error("woff2 fonts not supported");return b(n.parse(G)[0])}}const MAe=Mv({name:"Typr Font Parser",dependencies:[SAe,RAe,ZAe],init(n,e,t){const i=n(),r=e();return t(i,r)}}),pA={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},EAe=new Ke;function wI(){return(self.performance||Date).now()}const OH=Object.create(null);function aj(n,e){n=_Ae({},n);const t=wI();if(n.font=VAe(n.font||pA.defaultFontURL),n.text=""+n.text,n.sdfGlyphSize=n.sdfGlyphSize||pA.sdfGlyphSize,n.colorRanges!=null){let u={};for(let d in n.colorRanges)if(n.colorRanges.hasOwnProperty(d)){let h=n.colorRanges[d];typeof h!="number"&&(h=EAe.set(h).getHex()),u[d]=h}n.colorRanges=u}Object.freeze(n);const{textureWidth:i,sdfExponent:r}=pA,{sdfGlyphSize:s}=n,o=i/s*4;let a=OH[s];if(!a){const u=document.createElement("canvas");u.width=i,u.height=s*256/o,a=OH[s]={glyphCount:0,sdfGlyphSize:s,sdfCanvas:u,sdfTexture:new Pn(u,void 0,void 0,void 0,ut,ut),contextLost:!1,glyphsByFont:new Map},a.sdfTexture.generateMipmaps=!1,WAe(a)}const{sdfTexture:l,sdfCanvas:c}=a;let g=a.glyphsByFont.get(n.font);g||a.glyphsByFont.set(n.font,g=new Map),NAe(n).then(u=>{const{glyphIds:d,glyphPositions:h,fontSize:f,unitsPerEm:I,timings:A}=u,p=[],y=new Float32Array(d.length*4),v=f/I;let b=0,w=0;const G=wI();d.forEach((W,F)=>{let T=g.get(W);if(!T){const{path:J,pathBounds:H}=u.glyphData[W],Y=Math.max(H[2]-H[0],H[3]-H[1])/s*(pA.sdfMargin*s+.5),K=a.glyphCount++,Q=[H[0]-Y,H[1]-Y,H[2]+Y,H[3]+Y];g.set(W,T={path:J,atlasIndex:K,sdfViewBox:Q}),p.push(T)}const{sdfViewBox:V}=T,z=h[w++],U=h[w++];y[b++]=z+V[0]*v,y[b++]=U+V[1]*v,y[b++]=z+V[2]*v,y[b++]=U+V[3]*v,d[F]=T.atlasIndex}),A.quads=(A.quads||0)+(wI()-G);const x=wI();A.sdf={};const B=c.height,R=Math.ceil(a.glyphCount/o),Z=Math.pow(2,Math.ceil(Math.log2(R*s)));Z>B&&(console.info(`Increasing SDF texture size ${B}->${Z}`),xAe(c,i,Z),l.dispose()),Promise.all(p.map(W=>lj(W,a,n.gpuAccelerateSDF).then(({timing:F})=>{A.sdf[W.atlasIndex]=F}))).then(()=>{p.length&&!a.contextLost&&(cj(a),l.needsUpdate=!0),A.sdfTotal=wI()-x,A.total=wI()-t,e(Object.freeze({parameters:n,sdfTexture:l,sdfGlyphSize:s,sdfExponent:r,glyphBounds:y,glyphAtlasIndices:d,glyphColors:u.glyphColors,caretPositions:u.caretPositions,caretHeight:u.caretHeight,chunkedBounds:u.chunkedBounds,ascender:u.ascender,descender:u.descender,lineHeight:u.lineHeight,capHeight:u.capHeight,xHeight:u.xHeight,topBaseline:u.topBaseline,blockBounds:u.blockBounds,visibleBounds:u.visibleBounds,timings:u.timings}))})}),Promise.resolve().then(()=>{a.contextLost||wAe(c)})}function lj({path:n,atlasIndex:e,sdfViewBox:t},{sdfGlyphSize:i,sdfCanvas:r,contextLost:s},o){if(s)return Promise.resolve({timing:-1});const{textureWidth:a,sdfExponent:l}=pA,c=Math.max(t[2]-t[0],t[3]-t[1]),g=Math.floor(e/4),u=g%(a/i)*i,d=Math.floor(g/(a/i))*i,h=e%4;return mAe(i,i,n,t,c,l,r,u,d,h,o)}function WAe(n){const e=n.sdfCanvas;e.addEventListener("webglcontextlost",t=>{console.log("Context Lost",t),t.preventDefault(),n.contextLost=!0}),e.addEventListener("webglcontextrestored",t=>{console.log("Context Restored",t),n.contextLost=!1;const i=[];n.glyphsByFont.forEach(r=>{r.forEach(s=>{i.push(lj(s,n,!0))})}),Promise.all(i).then(()=>{cj(n),n.sdfTexture.needsUpdate=!0})})}function FAe({font:n,characters:e,sdfGlyphSize:t},i){let r=Array.isArray(e)?e.join(`
`):""+e;aj({font:n,sdfGlyphSize:t,text:r},i)}function _Ae(n,e){for(let t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}let KB;function VAe(n){return KB||(KB=typeof document>"u"?{}:document.createElement("a")),KB.href=n,KB.href}function cj(n){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:e,sdfTexture:t}=n,{width:i,height:r}=e,s=n.sdfCanvas.getContext("webgl");let o=t.image.data;(!o||o.length!==i*r*4)&&(o=new Uint8Array(i*r*4),t.image={width:i,height:r,data:o},t.flipY=!1,t.isDataTexture=!0),s.readPixels(0,0,i,r,s.RGBA,s.UNSIGNED_BYTE,o)}}const TAe=Mv({name:"Typesetter",dependencies:[pA,MAe,pAe,gAe],init(n,e,t,i){const{defaultFontURL:r}=n;return t(e,i(),{defaultFontURL:r})}}),NAe=Mv({name:"Typesetter",dependencies:[TAe],init(n){return function(e){return new Promise(t=>{n.typeset(e,t)})}},getTransferables(n){const e=[n.glyphPositions.buffer,n.glyphIds.buffer];return n.caretPositions&&e.push(n.caretPositions.buffer),n.glyphColors&&e.push(n.glyphColors.buffer),e}}),JH={};function kAe(n){let e=JH[n];if(!e){const t=new Fc(1,1,n,n),i=t.clone(),r=t.attributes,s=i.attributes,o=new Et,a=r.uv.count;for(let l=0;l<a;l++)s.position.array[l*3]*=-1,s.normal.array[l*3+2]*=-1;["position","normal","uv"].forEach(l=>{o.setAttribute(l,new ht([...r[l].array,...s[l].array],r[l].itemSize))}),o.setIndex([...t.index.array,...i.index.array.map(l=>l+a)]),o.translate(.5,.5,0),e=JH[n]=o}return e}const LAe="aTroikaGlyphBounds",jH="aTroikaGlyphIndex",HAe="aTroikaGlyphColor";class zAe extends IV{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Zl,this.boundingBox=new Us}computeBoundingSphere(){}computeBoundingBox(){}setSide(e){const t=this.getIndex().count;this.setDrawRange(e===Bi?t/2:0,e===Di?t:t/2)}set detail(e){if(e!==this._detail){this._detail=e,(typeof e!="number"||e<1)&&(e=1);let t=kAe(e);["position","normal","uv"].forEach(i=>{this.attributes[i]=t.attributes[i].clone()}),this.setIndex(t.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,t,i,r,s){rZ(this,LAe,e,4),rZ(this,jH,t,1),rZ(this,HAe,s,3),this._blockBounds=i,this._chunkedBounds=r,this.instanceCount=t.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:t,boundingBox:i}=this;if(t){const{PI:r,floor:s,min:o,max:a,sin:l,cos:c}=Math,g=r/2,u=r*2,d=Math.abs(t),h=e[0]/d,f=e[2]/d,I=s((h+g)/u)!==s((f+g)/u)?-d:o(l(h)*d,l(f)*d),A=s((h-g)/u)!==s((f-g)/u)?d:a(l(h)*d,l(f)*d),p=s((h+r)/u)!==s((f+r)/u)?d*2:a(d-c(h)*d,d-c(f)*d);i.min.set(I,e[1],t<0?-p:0),i.max.set(A,e[3],t<0?0:p)}else i.min.set(e[0],e[1],0),i.max.set(e[2],e[3],0);i.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let t=this.getAttribute(jH).count,i=this._chunkedBounds;if(i)for(let r=i.length;r--;){t=i[r].end;let s=i[r].rect;if(s[1]<e.w&&s[3]>e.y&&s[0]<e.z&&s[2]>e.x)break}this.instanceCount=t}}function rZ(n,e,t,i){const r=n.getAttribute(e);t?r&&r.array.length===t.length?(r.array.set(t),r.needsUpdate=!0):(n.setAttribute(e,new ff(t,i)),delete n._maxInstanceCount,n.dispose()):r&&n.deleteAttribute(e)}const XAe=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaDistanceOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,YAe=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,KAe=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaDistanceOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaOutlineOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,DAe=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function PAe(n){const e=q3(n,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new pe},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Lt(0,0,0,0)},uTroikaClipRect:{value:new Lt(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new pe},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Ke},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Ir},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:XAe,vertexTransform:YAe,fragmentDefs:KAe,fragmentColorTransform:DAe,customRewriter({vertexShader:t,fragmentShader:i}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(i)&&(i=i.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(t)||(t=t.replace(sj,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:t,fragmentShader:i}}});return e.transparent=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}const KV=new os({color:16777215,side:Di,transparent:!0}),qH=8421504,$H=new qe,DB=new D,sZ=new D,Am=[],UAe=new D,oZ="+x+y";function ez(n){return Array.isArray(n)?n[0]:n}let gj=()=>{const n=new Rn(new Fc(1,1),KV);return gj=()=>n,n},uj=()=>{const n=new Rn(new Fc(1,1,32,1),KV);return uj=()=>n,n};const QAe={type:"syncstart"},OAe={type:"synccomplete"},dj=["font","fontSize","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],JAe=dj.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let hj=class extends Rn{constructor(){const e=new zAe;super(e,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.fontSize=.1,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=qH,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=oZ,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(QAe),aj({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF},t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);const i=this._queuedSyncs;i&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{i.forEach(r=>r&&r())})),this.dispatchEvent(OAe),e&&e()})))}onBeforeRender(e,t,i,r,s,o){this.sync(),s.isTroikaTextMaterial&&this._prepareForRender(s),s._hadOwnSide=s.hasOwnProperty("side"),this.geometry.setSide(s._actualSide=s.side),s.side=wo}onAfterRender(e,t,i,r,s,o){s._hadOwnSide?s.side=s._actualSide:delete s.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let e=this._derivedMaterial;const t=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=KV.clone());if((!e||e.baseMaterial!==t)&&(e=this._derivedMaterial=PAe(t),t.addEventListener("dispose",function i(){t.removeEventListener("dispose",i),e.dispose()})),this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let i=e._outlineMtl;return i||(i=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),i.isTextOutlineMaterial=!0,i.depthWrite=!1,i.map=null,e.addEventListener("dispose",function r(){e.removeEventListener("dispose",r),i.dispose()})),[i,e]}else return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return ez(this.material).getDepthMaterial()}get customDistanceMaterial(){return ez(this.material).getDistanceMaterial()}_prepareForRender(e){const t=e.isTextOutlineMaterial,i=e.uniforms,r=this.textRenderInfo;if(r){const{sdfTexture:a,blockBounds:l}=r;i.uTroikaSDFTexture.value=a,i.uTroikaSDFTextureSize.value.set(a.image.width,a.image.height),i.uTroikaSDFGlyphSize.value=r.sdfGlyphSize,i.uTroikaSDFExponent.value=r.sdfExponent,i.uTroikaTotalBounds.value.fromArray(l),i.uTroikaUseGlyphColors.value=!t&&!!r.glyphColors;let c=0,g=0,u=0,d,h,f,I=0,A=0;if(t){let{outlineWidth:y,outlineOffsetX:v,outlineOffsetY:b,outlineBlur:w,outlineOpacity:G}=this;c=this._parsePercent(y)||0,g=Math.max(0,this._parsePercent(w)||0),d=G,I=this._parsePercent(v)||0,A=this._parsePercent(b)||0}else u=Math.max(0,this._parsePercent(this.strokeWidth)||0),u&&(f=this.strokeColor,i.uTroikaStrokeColor.value.set(f??qH),h=this.strokeOpacity,h==null&&(h=1)),d=this.fillOpacity;i.uTroikaDistanceOffset.value=c,i.uTroikaPositionOffset.value.set(I,A),i.uTroikaBlurRadius.value=g,i.uTroikaStrokeWidth.value=u,i.uTroikaStrokeOpacity.value=h,i.uTroikaFillOpacity.value=d??1,i.uTroikaCurveRadius.value=this.curveRadius||0;let p=this.clipRect;if(p&&Array.isArray(p)&&p.length===4)i.uTroikaClipRect.value.fromArray(p);else{const y=(this.fontSize||.1)*100;i.uTroikaClipRect.value.set(l[0]-y,l[1]-y,l[2]+y,l[3]+y)}this.geometry.applyClipRect(i.uTroikaClipRect.value)}i.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const s=t?this.outlineColor||0:this.color;if(s==null)delete e.color;else{const a=e.hasOwnProperty("color")?e.color:e.color=new Ke;(s!==a._input||typeof s=="object")&&a.set(a._input=s)}let o=this.orientation||oZ;if(o!==e._orientation){let a=i.uTroikaOrient.value;o=o.replace(/[^-+xyz]/g,"");let l=o!==oZ&&o.match(/^([-+])([xyz])([-+])([xyz])$/);if(l){let[,c,g,u,d]=l;DB.set(0,0,0)[g]=c==="-"?1:-1,sZ.set(0,0,0)[d]=u==="-"?-1:1,$H.lookAt(UAe,DB.cross(sZ),sZ),a.setFromMatrix4($H)}else a.identity();e._orientation=o}}_parsePercent(e){if(typeof e=="string"){let t=e.match(/^(-?[\d.]+)%$/),i=t?parseFloat(t[1]):NaN;e=(isNaN(i)?0:i/100)*this.fontSize}return e}localPositionToTextCoords(e,t=new pe){t.copy(e);const i=this.curveRadius;return i&&(t.x=Math.atan2(e.x,Math.abs(i)-Math.abs(e.z))*Math.abs(i)),t}worldPositionToTextCoords(e,t=new pe){return DB.copy(e),this.localPositionToTextCoords(this.worldToLocal(DB),t)}raycast(e,t){const{textRenderInfo:i,curveRadius:r}=this;if(i){const s=i.blockBounds,o=r?uj():gj(),a=o.geometry,{position:l,uv:c}=a.attributes;for(let g=0;g<c.count;g++){let u=s[0]+c.getX(g)*(s[2]-s[0]);const d=s[1]+c.getY(g)*(s[3]-s[1]);let h=0;r&&(h=r-Math.cos(u/r)*r,u=Math.sin(u/r)*r),l.setXYZ(g,u,d,h)}a.boundingSphere=this.geometry.boundingSphere,a.boundingBox=this.geometry.boundingBox,o.matrixWorld=this.matrixWorld,o.material.side=this.material.side,Am.length=0,o.raycast(e,Am);for(let g=0;g<Am.length;g++)Am[g].object=this,t.push(Am[g])}}copy(e){const t=this.geometry;return super.copy(e),this.geometry=t,JAe.forEach(i=>{this[i]=e[i]}),this}clone(){return new this.constructor().copy(this)}};dj.forEach(n=>{const e="_private_"+n;Object.defineProperty(hj.prototype,n,{get(){return this[e]},set(t){t!==this[e]&&(this[e]=t,this._needsSync=!0)}})});const mf=M.forwardRef(({sdfGlyphSize:n=64,anchorX:e="center",anchorY:t="middle",font:i,fontSize:r=1,children:s,characters:o,onSync:a,...l},c)=>{const g=Bt(({invalidate:f})=>f),[u]=M.useState(()=>new hj),[d,h]=M.useMemo(()=>{const f=[];let I="";return M.Children.forEach(s,A=>{typeof A=="string"||typeof A=="number"?I+=A:f.push(A)}),[f,I]},[s]);return vV(()=>new Promise(f=>FAe({font:i,characters:o},f)),["troika-text",i,o]),M.useLayoutEffect(()=>void u.sync(()=>{g(),a&&a(u)})),M.useEffect(()=>()=>u.dispose(),[u]),M.createElement("primitive",pt({object:u,ref:c,font:i,text:h,anchorX:e,anchorY:t,fontSize:r,sdfGlyphSize:n},l),d)});let PB=null;function fj(n,e,t){return i=>{t&&t(i),n&&(PB||(PB=new nAe),PB.setDecoderPath(typeof n=="string"?n:"https://www.gstatic.com/draco/versioned/decoders/1.5.5/"),i.setDRACOLoader(PB)),e&&i.setMeshoptDecoder(typeof nZ=="function"?nZ():nZ)}}function YC(n,e=!0,t=!0,i){return Ef(tx,n,fj(e,t,i))}YC.preload=(n,e=!0,t=!0,i)=>Ef.preload(tx,n,fj(e,t,i));YC.clear=n=>Ef.clear(tx,n);function jAe(n,e,t){const{gl:i,size:r,viewport:s}=Bt(),o=typeof n=="number"?n:r.width*s.dpr,a=typeof e=="number"?e:r.height*s.dpr,l=(typeof n=="number"?t:n)||{},{samples:c=0,depth:g,...u}=l,d=M.useMemo(()=>{let h;return h=new Qt(o,a,{minFilter:ut,magFilter:ut,encoding:i.outputEncoding,type:Pi,...u}),g&&(h.depthTexture=new av(o,a,Hn)),h.samples=c,h},[]);return M.useLayoutEffect(()=>{d.setSize(o,a),c&&(d.samples=c)},[c,d,o,a]),M.useEffect(()=>()=>d.dispose(),[]),d}const qAe=n=>typeof n=="function",$Ae=M.forwardRef(({envMap:n,resolution:e=256,frames:t=1/0,makeDefault:i,children:r,...s},o)=>{const a=Bt(({set:A})=>A),l=Bt(({camera:A})=>A),c=Bt(({size:A})=>A),g=M.useRef(null),u=M.useRef(null),d=jAe(e);M.useLayoutEffect(()=>{s.manual||(g.current.aspect=c.width/c.height)},[c,s]),M.useLayoutEffect(()=>{g.current.updateProjectionMatrix()});let h=0,f=null;const I=qAe(r);return yn(A=>{I&&(t===1/0||h<t)&&(u.current.visible=!1,A.gl.setRenderTarget(d),f=A.scene.background,n&&(A.scene.background=n),A.gl.render(A.scene,g.current),A.scene.background=f,A.gl.setRenderTarget(null),u.current.visible=!0,h++)}),M.useLayoutEffect(()=>{if(i){const A=l;return a(()=>({camera:g.current})),()=>a(()=>({camera:A}))}},[g,i,a]),M.createElement(M.Fragment,null,M.createElement("perspectiveCamera",pt({ref:Dw([g,o])},s),!I&&r),M.createElement("group",{ref:u},I&&r(d.texture)))}),Ij=0,eCe=1,tCe=2,tz=2,aZ=1.25,nz=1,m1=6*4+4+4,eW=65535,nCe=Math.pow(2,-24);class UB{constructor(){}}function uc(n,e,t){return t.min.x=e[n],t.min.y=e[n+1],t.min.z=e[n+2],t.max.x=e[n+3],t.max.y=e[n+4],t.max.z=e[n+5],t}function iz(n){let e=-1,t=-1/0;for(let i=0;i<3;i++){const r=n[i+3]-n[i];r>t&&(t=r,e=i)}return e}function rz(n,e){e.set(n)}function sz(n,e,t){let i,r;for(let s=0;s<3;s++){const o=s+3;i=n[s],r=e[s],t[s]=i<r?i:r,i=n[o],r=e[o],t[o]=i>r?i:r}}function QB(n,e,t){for(let i=0;i<3;i++){const r=e[n+2*i],s=e[n+2*i+1],o=r-s,a=r+s;o<t[i]&&(t[i]=o),a>t[i+3]&&(t[i+3]=a)}}function Cm(n){const e=n[3]-n[0],t=n[4]-n[1],i=n[5]-n[2];return 2*(e*t+t*i+i*e)}function iCe(n,e){if(!n.index){const t=n.attributes.position.count,i=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let r;t>65535?r=new Uint32Array(new i(4*t)):r=new Uint16Array(new i(2*t)),n.setIndex(new Pt(r,1));for(let s=0;s<t;s++)r[s]=s}}function rCe(n){if(!n.groups||!n.groups.length)return[{offset:0,count:n.index.count/3}];const e=[],t=new Set;for(const r of n.groups)t.add(r.start),t.add(r.start+r.count);const i=Array.from(t.values()).sort((r,s)=>r-s);for(let r=0;r<i.length-1;r++){const s=i[r],o=i[r+1];e.push({offset:s/3,count:(o-s)/3})}return e}function lZ(n,e,t,i,r=null){let s=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,g=-1/0,u=1/0,d=1/0,h=1/0,f=-1/0,I=-1/0,A=-1/0;const p=r!==null;for(let y=e*6,v=(e+t)*6;y<v;y+=6){const b=n[y+0],w=n[y+1],G=b-w,x=b+w;G<s&&(s=G),x>l&&(l=x),p&&b<u&&(u=b),p&&b>f&&(f=b);const B=n[y+2],R=n[y+3],Z=B-R,W=B+R;Z<o&&(o=Z),W>c&&(c=W),p&&B<d&&(d=B),p&&B>I&&(I=B);const F=n[y+4],T=n[y+5],V=F-T,z=F+T;V<a&&(a=V),z>g&&(g=z),p&&F<h&&(h=F),p&&F>A&&(A=F)}i[0]=s,i[1]=o,i[2]=a,i[3]=l,i[4]=c,i[5]=g,p&&(r[0]=u,r[1]=d,r[2]=h,r[3]=f,r[4]=I,r[5]=A)}function sCe(n,e,t,i){let r=1/0,s=1/0,o=1/0,a=-1/0,l=-1/0,c=-1/0;for(let g=e*6,u=(e+t)*6;g<u;g+=6){const d=n[g+0];d<r&&(r=d),d>a&&(a=d);const h=n[g+2];h<s&&(s=h),h>l&&(l=h);const f=n[g+4];f<o&&(o=f),f>c&&(c=f)}i[0]=r,i[1]=s,i[2]=o,i[3]=a,i[4]=l,i[5]=c}function oCe(n,e,t,i,r){let s=t,o=t+i-1;const a=r.pos,l=r.axis*2;for(;;){for(;s<=o&&e[s*6+l]<a;)s++;for(;s<=o&&e[o*6+l]>=a;)o--;if(s<o){for(let c=0;c<3;c++){let g=n[s*3+c];n[s*3+c]=n[o*3+c],n[o*3+c]=g;let u=e[s*6+c*2+0];e[s*6+c*2+0]=e[o*6+c*2+0],e[o*6+c*2+0]=u;let d=e[s*6+c*2+1];e[s*6+c*2+1]=e[o*6+c*2+1],e[o*6+c*2+1]=d}s++,o--}else return s}}const ug=32,aCe=(n,e)=>n.candidate-e.candidate,wu=new Array(ug).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),OB=new Float32Array(6);function lCe(n,e,t,i,r,s){let o=-1,a=0;if(s===Ij)o=iz(e),o!==-1&&(a=(e[o]+e[o+3])/2);else if(s===eCe)o=iz(n),o!==-1&&(a=cCe(t,i,r,o));else if(s===tCe){const l=Cm(n);let c=aZ*r;const g=i*6,u=(i+r)*6;for(let d=0;d<3;d++){const h=e[d],A=(e[d+3]-h)/ug;if(r<ug/4){const p=[...wu];p.length=r;let y=0;for(let b=g;b<u;b+=6,y++){const w=p[y];w.candidate=t[b+2*d],w.count=0;const{bounds:G,leftCacheBounds:x,rightCacheBounds:B}=w;for(let R=0;R<3;R++)B[R]=1/0,B[R+3]=-1/0,x[R]=1/0,x[R+3]=-1/0,G[R]=1/0,G[R+3]=-1/0;QB(b,t,G)}p.sort(aCe);let v=r;for(let b=0;b<v;b++){const w=p[b];for(;b+1<v&&p[b+1].candidate===w.candidate;)p.splice(b+1,1),v--}for(let b=g;b<u;b+=6){const w=t[b+2*d];for(let G=0;G<v;G++){const x=p[G];w>=x.candidate?QB(b,t,x.rightCacheBounds):(QB(b,t,x.leftCacheBounds),x.count++)}}for(let b=0;b<v;b++){const w=p[b],G=w.count,x=r-w.count,B=w.leftCacheBounds,R=w.rightCacheBounds;let Z=0;G!==0&&(Z=Cm(B)/l);let W=0;x!==0&&(W=Cm(R)/l);const F=nz+aZ*(Z*G+W*x);F<c&&(o=d,c=F,a=w.candidate)}}else{for(let v=0;v<ug;v++){const b=wu[v];b.count=0,b.candidate=h+A+v*A;const w=b.bounds;for(let G=0;G<3;G++)w[G]=1/0,w[G+3]=-1/0}for(let v=g;v<u;v+=6){let G=~~((t[v+2*d]-h)/A);G>=ug&&(G=ug-1);const x=wu[G];x.count++,QB(v,t,x.bounds)}const p=wu[ug-1];rz(p.bounds,p.rightCacheBounds);for(let v=ug-2;v>=0;v--){const b=wu[v],w=wu[v+1];sz(b.bounds,w.rightCacheBounds,b.rightCacheBounds)}let y=0;for(let v=0;v<ug-1;v++){const b=wu[v],w=b.count,G=b.bounds,B=wu[v+1].rightCacheBounds;w!==0&&(y===0?rz(G,OB):sz(G,OB,OB)),y+=w;let R=0,Z=0;y!==0&&(R=Cm(OB)/l);const W=r-y;W!==0&&(Z=Cm(B)/l);const F=nz+aZ*(R*y+Z*W);F<c&&(o=d,c=F,a=b.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:o,pos:a}}function cCe(n,e,t,i){let r=0;for(let s=e,o=e+t;s<o;s++)r+=n[s*6+i*2];return r/t}function gCe(n,e){const t=n.attributes.position,i=n.index.array,r=i.length/3,s=new Float32Array(r*6),o=t.normalized,a=t.array,l=t.offset||0;let c=3;t.isInterleavedBufferAttribute&&(c=t.data.stride);const g=["getX","getY","getZ"];for(let u=0;u<r;u++){const d=u*3,h=u*6;let f,I,A;o?(f=i[d+0],I=i[d+1],A=i[d+2]):(f=i[d+0]*c+l,I=i[d+1]*c+l,A=i[d+2]*c+l);for(let p=0;p<3;p++){let y,v,b;o?(y=t[g[p]](f),v=t[g[p]](I),b=t[g[p]](A)):(y=a[f+p],v=a[I+p],b=a[A+p]);let w=y;v<w&&(w=v),b<w&&(w=b);let G=y;v>G&&(G=v),b>G&&(G=b);const x=(G-w)/2,B=p*2;s[h+B+0]=w+x,s[h+B+1]=x+(Math.abs(w)+x)*nCe,w<e[p]&&(e[p]=w),G>e[p+3]&&(e[p+3]=G)}}return s}function uCe(n,e){function t(p){d&&d(p/h)}function i(p,y,v,b=null,w=0){if(!f&&w>=l&&(f=!0,c&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(n))),v<=g||w>=l)return t(y+v),p.offset=y,p.count=v,p;const G=lCe(p.boundingData,b,o,y,v,u);if(G.axis===-1)return t(y+v),p.offset=y,p.count=v,p;const x=oCe(a,o,y,v,G);if(x===y||x===y+v)t(y+v),p.offset=y,p.count=v;else{p.splitAxis=G.axis;const B=new UB,R=y,Z=x-y;p.left=B,B.boundingData=new Float32Array(6),lZ(o,R,Z,B.boundingData,s),i(B,R,Z,s,w+1);const W=new UB,F=x,T=v-Z;p.right=W,W.boundingData=new Float32Array(6),lZ(o,F,T,W.boundingData,s),i(W,F,T,s,w+1)}return p}iCe(n,e);const r=new Float32Array(6),s=new Float32Array(6),o=gCe(n,r),a=n.index.array,l=e.maxDepth,c=e.verbose,g=e.maxLeafTris,u=e.strategy,d=e.onProgress,h=n.index.count/3;let f=!1;const I=[],A=rCe(n);if(A.length===1){const p=A[0],y=new UB;y.boundingData=r,sCe(o,p.offset,p.count,s),i(y,p.offset,p.count,s),I.push(y)}else for(let p of A){const y=new UB;y.boundingData=new Float32Array(6),lZ(o,p.offset,p.count,y.boundingData,s),i(y,p.offset,p.count,s),I.push(y)}return I}function dCe(n,e){const t=uCe(n,e);let i,r,s;const o=[],a=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let g=0;g<t.length;g++){const u=t[g];let d=l(u);const h=new a(m1*d);i=new Float32Array(h),r=new Uint32Array(h),s=new Uint16Array(h),c(0,u),o.push(h)}return o;function l(g){return g.count?1:1+l(g.left)+l(g.right)}function c(g,u){const d=g/4,h=g/2,f=!!u.count,I=u.boundingData;for(let A=0;A<6;A++)i[d+A]=I[A];if(f){const A=u.offset,p=u.count;return r[d+6]=A,s[h+14]=p,s[h+15]=eW,g+m1}else{const A=u.left,p=u.right,y=u.splitAxis;let v;if(v=c(g+m1,A),v/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return r[d+6]=v/4,v=c(v,p),r[d+7]=y,v}}}class Kg{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,r=-1/0;for(let s=0,o=e.length;s<o;s++){const l=e[s][t];i=l<i?l:i,r=l>r?l:r}this.min=i,this.max=r}setFromPoints(e,t){let i=1/0,r=-1/0;for(let s=0,o=t.length;s<o;s++){const a=t[s],l=e.dot(a);i=l<i?l:i,r=l>r?l:r}this.min=i,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}}Kg.prototype.setFromBox=function(){const n=new D;return function(t,i){const r=i.min,s=i.max;let o=1/0,a=-1/0;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let g=0;g<=1;g++){n.x=r.x*l+s.x*(1-l),n.y=r.y*c+s.y*(1-c),n.z=r.z*g+s.z*(1-g);const u=t.dot(n);o=Math.min(u,o),a=Math.max(u,a)}this.min=o,this.max=a}}();const hCe=function(){const n=new D,e=new D,t=new D;return function(r,s,o){const a=r.start,l=n,c=s.start,g=e;t.subVectors(a,c),n.subVectors(r.end,r.start),e.subVectors(s.end,s.start);const u=t.dot(g),d=g.dot(l),h=g.dot(g),f=t.dot(l),A=l.dot(l)*h-d*d;let p,y;A!==0?p=(u*d-f*h)/A:p=0,y=(u+p*d)/h,o.x=p,o.y=y}}(),DV=function(){const n=new pe,e=new D,t=new D;return function(r,s,o,a){hCe(r,s,n);let l=n.x,c=n.y;if(l>=0&&l<=1&&c>=0&&c<=1){r.at(l,o),s.at(c,a);return}else if(l>=0&&l<=1){c<0?s.at(0,a):s.at(1,a),r.closestPointToPoint(a,!0,o);return}else if(c>=0&&c<=1){l<0?r.at(0,o):r.at(1,o),s.closestPointToPoint(o,!0,a);return}else{let g;l<0?g=r.start:g=r.end;let u;c<0?u=s.start:u=s.end;const d=e,h=t;if(r.closestPointToPoint(u,!0,e),s.closestPointToPoint(g,!0,t),d.distanceToSquared(u)<=h.distanceToSquared(g)){o.copy(d),a.copy(u);return}else{o.copy(g),a.copy(h);return}}}}(),fCe=function(){const n=new D,e=new D,t=new ic,i=new vc;return function(s,o){const{radius:a,center:l}=s,{a:c,b:g,c:u}=o;if(i.start=c,i.end=g,i.closestPointToPoint(l,!0,n).distanceTo(l)<=a||(i.start=c,i.end=u,i.closestPointToPoint(l,!0,n).distanceTo(l)<=a)||(i.start=g,i.end=u,i.closestPointToPoint(l,!0,n).distanceTo(l)<=a))return!0;const I=o.getPlane(t);if(Math.abs(I.distanceToPoint(l))<=a){const p=I.projectPoint(l,e);if(o.containsPoint(p))return!0}return!1}}(),ICe=1e-15;function xI(n){return Math.abs(n)<ICe}class Dg extends Fg{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new D),this.satBounds=new Array(4).fill().map(()=>new Kg),this.points=[this.a,this.b,this.c],this.sphere=new Zl,this.plane=new ic,this.needsUpdate=!0}intersectsSphere(e){return fCe(e,this)}update(){const e=this.a,t=this.b,i=this.c,r=this.points,s=this.satAxes,o=this.satBounds,a=s[0],l=o[0];this.getNormal(a),l.setFromPoints(a,r);const c=s[1],g=o[1];c.subVectors(e,t),g.setFromPoints(c,r);const u=s[2],d=o[2];u.subVectors(t,i),d.setFromPoints(u,r);const h=s[3],f=o[3];h.subVectors(i,e),f.setFromPoints(h,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}}Dg.prototype.closestPointToSegment=function(){const n=new D,e=new D,t=new vc;return function(r,s=null,o=null){const{start:a,end:l}=r,c=this.points;let g,u=1/0;for(let d=0;d<3;d++){const h=(d+1)%3;t.start.copy(c[d]),t.end.copy(c[h]),DV(t,r,n,e),g=n.distanceToSquared(e),g<u&&(u=g,s&&s.copy(n),o&&o.copy(e))}return this.closestPointToPoint(a,n),g=a.distanceToSquared(n),g<u&&(u=g,s&&s.copy(n),o&&o.copy(a)),this.closestPointToPoint(l,n),g=l.distanceToSquared(n),g<u&&(u=g,s&&s.copy(n),o&&o.copy(l)),Math.sqrt(u)}}();Dg.prototype.intersectsTriangle=function(){const n=new Dg,e=new Array(3),t=new Array(3),i=new Kg,r=new Kg,s=new D,o=new D,a=new D,l=new D,c=new vc,g=new vc,u=new vc;return function(h,f=null,I=!1){this.needsUpdate&&this.update(),h.isExtendedTriangle?h.needsUpdate&&h.update():(n.copy(h),n.update(),h=n);const A=this.plane,p=h.plane;if(Math.abs(A.normal.dot(p.normal))>1-1e-10){const y=this.satBounds,v=this.satAxes;t[0]=h.a,t[1]=h.b,t[2]=h.c;for(let G=0;G<4;G++){const x=y[G],B=v[G];if(i.setFromPoints(B,t),x.isSeparated(i))return!1}const b=h.satBounds,w=h.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let G=0;G<4;G++){const x=b[G],B=w[G];if(i.setFromPoints(B,e),x.isSeparated(i))return!1}for(let G=0;G<4;G++){const x=v[G];for(let B=0;B<4;B++){const R=w[B];if(s.crossVectors(x,R),i.setFromPoints(s,e),r.setFromPoints(s,t),i.isSeparated(r))return!1}}return f&&(I||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),f.start.set(0,0,0),f.end.set(0,0,0)),!0}else{const y=this.points;let v=!1,b=0;for(let V=0;V<3;V++){const z=y[V],U=y[(V+1)%3];c.start.copy(z),c.end.copy(U),c.delta(o);const J=v?g.start:g.end,H=xI(p.distanceToPoint(z));if(xI(p.normal.dot(o))&&H){g.copy(c),b=2;break}if((p.intersectLine(c,J)||H)&&!xI(J.distanceTo(U))){if(b++,v)break;v=!0}}if(b===1&&h.containsPoint(g.end))return f&&(f.start.copy(g.end),f.end.copy(g.end)),!0;if(b!==2)return!1;const w=h.points;let G=!1,x=0;for(let V=0;V<3;V++){const z=w[V],U=w[(V+1)%3];c.start.copy(z),c.end.copy(U),c.delta(a);const J=G?u.start:u.end,H=xI(A.distanceToPoint(z));if(xI(A.normal.dot(a))&&H){u.copy(c),x=2;break}if((A.intersectLine(c,J)||H)&&!xI(J.distanceTo(U))){if(x++,G)break;G=!0}}if(x===1&&this.containsPoint(u.end))return f&&(f.start.copy(u.end),f.end.copy(u.end)),!0;if(x!==2)return!1;if(g.delta(o),u.delta(a),o.dot(a)<0){let V=u.start;u.start=u.end,u.end=V}const B=g.start.dot(o),R=g.end.dot(o),Z=u.start.dot(o),W=u.end.dot(o),F=R<Z,T=B<W;return B!==W&&Z!==R&&F===T?!1:(f&&(l.subVectors(g.start,u.start),l.dot(o)>0?f.start.copy(g.start):f.start.copy(u.start),l.subVectors(g.end,u.end),l.dot(o)<0?f.end.copy(g.end):f.end.copy(u.end)),!0)}}}();Dg.prototype.distanceToPoint=function(){const n=new D;return function(t){return this.closestPointToPoint(t,n),t.distanceTo(n)}}();Dg.prototype.distanceToTriangle=function(){const n=new D,e=new D,t=["a","b","c"],i=new vc,r=new vc;return function(o,a=null,l=null){const c=a||l?i:null;if(this.intersectsTriangle(o,c))return(a||l)&&(a&&c.getCenter(a),l&&c.getCenter(l)),0;let g=1/0;for(let u=0;u<3;u++){let d;const h=t[u],f=o[h];this.closestPointToPoint(f,n),d=f.distanceToSquared(n),d<g&&(g=d,a&&a.copy(n),l&&l.copy(f));const I=this[h];o.closestPointToPoint(I,n),d=I.distanceToSquared(n),d<g&&(g=d,a&&a.copy(I),l&&l.copy(n))}for(let u=0;u<3;u++){const d=t[u],h=t[(u+1)%3];i.set(this[d],this[h]);for(let f=0;f<3;f++){const I=t[f],A=t[(f+1)%3];r.set(o[I],o[A]),DV(i,r,n,e);const p=n.distanceToSquared(e);p<g&&(g=p,a&&a.copy(n),l&&l.copy(e))}}return Math.sqrt(g)}}();class Sc{constructor(e,t,i){this.isOrientedBox=!0,this.min=new D,this.max=new D,this.matrix=new qe,this.invMatrix=new qe,this.points=new Array(8).fill().map(()=>new D),this.satAxes=new Array(3).fill().map(()=>new D),this.satBounds=new Array(3).fill().map(()=>new Kg),this.alignedSatBounds=new Array(3).fill().map(()=>new Kg),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}Sc.prototype.update=function(){return function(){const e=this.matrix,t=this.min,i=this.max,r=this.points;for(let c=0;c<=1;c++)for(let g=0;g<=1;g++)for(let u=0;u<=1;u++){const d=1*c|2*g|4*u,h=r[d];h.x=c?i.x:t.x,h.y=g?i.y:t.y,h.z=u?i.z:t.z,h.applyMatrix4(e)}const s=this.satBounds,o=this.satAxes,a=r[0];for(let c=0;c<3;c++){const g=o[c],u=s[c],d=1<<c,h=r[d];g.subVectors(a,h),u.setFromPoints(g,r)}const l=this.alignedSatBounds;l[0].setFromPointsField(r,"x"),l[1].setFromPointsField(r,"y"),l[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Sc.prototype.intersectsBox=function(){const n=new Kg;return function(t){this.needsUpdate&&this.update();const i=t.min,r=t.max,s=this.satBounds,o=this.satAxes,a=this.alignedSatBounds;if(n.min=i.x,n.max=r.x,a[0].isSeparated(n)||(n.min=i.y,n.max=r.y,a[1].isSeparated(n))||(n.min=i.z,n.max=r.z,a[2].isSeparated(n)))return!1;for(let l=0;l<3;l++){const c=o[l],g=s[l];if(n.setFromBox(c,t),g.isSeparated(n))return!1}return!0}}();Sc.prototype.intersectsTriangle=function(){const n=new Dg,e=new Array(3),t=new Kg,i=new Kg,r=new D;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(n.copy(o),n.update(),o=n);const a=this.satBounds,l=this.satAxes;e[0]=o.a,e[1]=o.b,e[2]=o.c;for(let d=0;d<3;d++){const h=a[d],f=l[d];if(t.setFromPoints(f,e),h.isSeparated(t))return!1}const c=o.satBounds,g=o.satAxes,u=this.points;for(let d=0;d<3;d++){const h=c[d],f=g[d];if(t.setFromPoints(f,u),h.isSeparated(t))return!1}for(let d=0;d<3;d++){const h=l[d];for(let f=0;f<4;f++){const I=g[f];if(r.crossVectors(h,I),t.setFromPoints(r,e),i.setFromPoints(r,u),t.isSeparated(i))return!1}}return!0}}();Sc.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();Sc.prototype.distanceToPoint=function(){const n=new D;return function(t){return this.closestPointToPoint(t,n),t.distanceTo(n)}}();Sc.prototype.distanceToBox=function(){const n=["x","y","z"],e=new Array(12).fill().map(()=>new vc),t=new Array(12).fill().map(()=>new vc),i=new D,r=new D;return function(o,a=0,l=null,c=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(l||c)&&(o.getCenter(r),this.closestPointToPoint(r,i),o.closestPointToPoint(i,r),l&&l.copy(i),c&&c.copy(r)),0;const g=a*a,u=o.min,d=o.max,h=this.points;let f=1/0;for(let A=0;A<8;A++){const p=h[A];r.copy(p).clamp(u,d);const y=p.distanceToSquared(r);if(y<f&&(f=y,l&&l.copy(p),c&&c.copy(r),y<g))return Math.sqrt(y)}let I=0;for(let A=0;A<3;A++)for(let p=0;p<=1;p++)for(let y=0;y<=1;y++){const v=(A+1)%3,b=(A+2)%3,w=p<<v|y<<b,G=1<<A|p<<v|y<<b,x=h[w],B=h[G];e[I].set(x,B);const Z=n[A],W=n[v],F=n[b],T=t[I],V=T.start,z=T.end;V[Z]=u[Z],V[W]=p?u[W]:d[W],V[F]=y?u[F]:d[W],z[Z]=d[Z],z[W]=p?u[W]:d[W],z[F]=y?u[F]:d[W],I++}for(let A=0;A<=1;A++)for(let p=0;p<=1;p++)for(let y=0;y<=1;y++){r.x=A?d.x:u.x,r.y=p?d.y:u.y,r.z=y?d.z:u.z,this.closestPointToPoint(r,i);const v=r.distanceToSquared(i);if(v<f&&(f=v,l&&l.copy(i),c&&c.copy(r),v<g))return Math.sqrt(v)}for(let A=0;A<12;A++){const p=e[A];for(let y=0;y<12;y++){const v=t[y];DV(p,v,i,r);const b=i.distanceToSquared(r);if(b<f&&(f=b,l&&l.copy(i),c&&c.copy(r),b<g))return Math.sqrt(b)}}return Math.sqrt(f)}}();const JB=new D,jB=new D,qB=new D,oz=new pe,az=new pe,lz=new pe,cz=new D;function ACe(n,e,t,i,r,s){let o;return s===Bi?o=n.intersectTriangle(i,t,e,!0,r):o=n.intersectTriangle(e,t,i,s!==Di,r),o===null?null:{distance:n.origin.distanceTo(r),point:r.clone()}}function CCe(n,e,t,i,r,s,o){JB.fromBufferAttribute(e,i),jB.fromBufferAttribute(e,r),qB.fromBufferAttribute(e,s);const a=ACe(n,JB,jB,qB,cz,o);if(a){t&&(oz.fromBufferAttribute(t,i),az.fromBufferAttribute(t,r),lz.fromBufferAttribute(t,s),a.uv=Fg.getUV(cz,JB,jB,qB,oz,az,lz,new pe));const l={a:i,b:r,c:s,normal:new D,materialIndex:0};Fg.getNormal(JB,jB,qB,l.normal),a.face=l,a.faceIndex=i}return a}function Aj(n,e,t,i,r){const s=i*3,o=n.index.getX(s),a=n.index.getX(s+1),l=n.index.getX(s+2),c=CCe(t,n.attributes.position,n.attributes.uv,o,a,l,e);return c?(c.faceIndex=i,r&&r.push(c),c):null}function pCe(n,e,t,i,r,s){for(let o=i,a=i+r;o<a;o++)Aj(n,e,t,o,s)}function mCe(n,e,t,i,r){let s=1/0,o=null;for(let a=i,l=i+r;a<l;a++){const c=Aj(n,e,t,a);c&&c.distance<s&&(o=c,s=c.distance)}return o}function gz(n,e,t){return n===null||(n.point.applyMatrix4(e.matrixWorld),n.distance=n.point.distanceTo(t.ray.origin),n.object=e,n.distance<t.near||n.distance>t.far)?null:n}function sc(n,e,t,i){const r=n.a,s=n.b,o=n.c;let a=e,l=e+1,c=e+2;t&&(a=t.getX(e),l=t.getX(e+1),c=t.getX(e+2)),r.x=i.getX(a),r.y=i.getY(a),r.z=i.getZ(a),s.x=i.getX(l),s.y=i.getY(l),s.z=i.getZ(l),o.x=i.getX(c),o.y=i.getY(c),o.z=i.getZ(c)}function uz(n,e,t,i,r,s,o){const a=t.index,l=t.attributes.position;for(let c=n,g=e+n;c<g;c++)if(sc(o,c*3,a,l),o.needsUpdate=!0,i(o,c,r,s))return!0;return!1}class Cj{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function Lu(n,e){return e[n+15]===65535}function zA(n,e){return e[n+6]}function _y(n,e){return e[n+14]}function Vy(n){return n+8}function Ty(n,e){return e[n+6]}function yCe(n,e){return e[n+7]}const mA=new Us,w2=new D,vCe=["x","y","z"];function tW(n,e,t,i,r){let s=n*2,o=KC,a=cd,l=gd;if(Lu(s,a)){const g=zA(n,l),u=_y(s,a);pCe(e,t,i,g,u,r)}else{const g=Vy(n);x2(g,o,i,w2)&&tW(g,e,t,i,r);const u=Ty(n,l);x2(u,o,i,w2)&&tW(u,e,t,i,r)}}function nW(n,e,t,i){let r=n*2,s=KC,o=cd,a=gd;if(Lu(r,o)){const c=zA(n,a),g=_y(r,o);return mCe(e,t,i,c,g)}else{const c=yCe(n,a),g=vCe[c],d=i.direction[g]>=0;let h,f;d?(h=Vy(n),f=Ty(n,a)):(h=Ty(n,a),f=Vy(n));const A=x2(h,s,i,w2)?nW(h,e,t,i):null;if(A){const v=A.point[g];if(d?v<=s[f+c]:v>=s[f+c+3])return A}const y=x2(f,s,i,w2)?nW(f,e,t,i):null;return A&&y?A.distance<=y.distance?A:y:A||y||null}}const bCe=function(){let n,e;const t=[],i=new Cj(()=>new Us);return function(...o){n=i.getPrimitive(),e=i.getPrimitive(),t.push(n,e);const a=r(...o);i.releasePrimitive(n),i.releasePrimitive(e),t.pop(),t.pop();const l=t.length;return l>0&&(e=t[l-1],n=t[l-2]),a};function r(s,o,a,l,c=null,g=0,u=0){function d(v){let b=v*2,w=cd,G=gd;for(;!Lu(b,w);)v=Vy(v),b=v*2;return zA(v,G)}function h(v){let b=v*2,w=cd,G=gd;for(;!Lu(b,w);)v=Ty(v,G),b=v*2;return zA(v,G)+_y(b,w)}let f=s*2,I=KC,A=cd,p=gd;if(Lu(f,A)){const v=zA(s,p),b=_y(f,A);return uc(s,I,n),l(v,b,!1,u,g+s,n)}else{const v=Vy(s),b=Ty(s,p);let w=v,G=b,x,B,R,Z;if(c&&(R=n,Z=e,uc(w,I,R),uc(G,I,Z),x=c(R),B=c(Z),B<x)){w=b,G=v;const J=x;x=B,B=J,R=Z}R||(R=n,uc(w,I,R));const W=Lu(w*2,A),F=a(R,W,x,u+1,g+w);let T;if(F===tz){const J=d(w),Y=h(w)-J;T=l(J,Y,!0,u+1,g+w,R)}else T=F&&r(w,o,a,l,c,g,u+1);if(T)return!0;Z=e,uc(G,I,Z);const V=Lu(G*2,A),z=a(Z,V,B,u+1,g+G);let U;if(z===tz){const J=d(G),Y=h(G)-J;U=l(J,Y,!0,u+1,g+G,Z)}else U=z&&r(G,o,a,l,c,g,u+1);return!!U}}}(),BCe=function(){const n=new Dg,e=new Dg,t=new qe,i=new Sc,r=new Sc;return function s(o,a,l,c,g=null){let u=o*2,d=KC,h=cd,f=gd;if(g===null&&(l.boundingBox||l.computeBoundingBox(),i.set(l.boundingBox.min,l.boundingBox.max,c),g=i),Lu(u,h)){const A=a,p=A.index,y=A.attributes.position,v=l.index,b=l.attributes.position,w=zA(o,f),G=_y(u,h);if(t.copy(c).invert(),l.boundsTree)return uc(o,d,r),r.matrix.copy(t),r.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:B=>r.intersectsBox(B),intersectsTriangle:B=>{B.a.applyMatrix4(c),B.b.applyMatrix4(c),B.c.applyMatrix4(c),B.needsUpdate=!0;for(let R=w*3,Z=(G+w)*3;R<Z;R+=3)if(sc(e,R,p,y),e.needsUpdate=!0,B.intersectsTriangle(e))return!0;return!1}});for(let x=w*3,B=G+w*3;x<B;x+=3){sc(n,x,p,y),n.a.applyMatrix4(t),n.b.applyMatrix4(t),n.c.applyMatrix4(t),n.needsUpdate=!0;for(let R=0,Z=v.count;R<Z;R+=3)if(sc(e,R,v,b),e.needsUpdate=!0,n.intersectsTriangle(e))return!0}}else{const A=o+8,p=f[o+6];return uc(A,d,mA),!!(g.intersectsBox(mA)&&s(A,a,l,c,g)||(uc(p,d,mA),g.intersectsBox(mA)&&s(p,a,l,c,g)))}}}();function x2(n,e,t,i){return uc(n,e,mA),t.intersectBox(mA,i)}const iW=[];let y1,KC,cd,gd;function i0(n){y1&&iW.push(y1),y1=n,KC=new Float32Array(n),cd=new Uint16Array(n),gd=new Uint32Array(n)}function $B(){y1=null,KC=null,cd=null,gd=null,iW.length&&i0(iW.pop())}const cZ=Symbol("skip tree generation"),gZ=new Us,uZ=new Us,SI=new qe,rh=new Sc,pm=new Sc,mm=new D,eG=new D,GCe=new D,wCe=new D,xCe=new D,dz=new Us,Pl=new Cj(()=>new Dg);class _0{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),_0.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});t={cloneBuffers:!0,...t};const i=e.geometry,r=e._roots,s=i.getIndex();let o;return t.cloneBuffers?o={roots:r.map(a=>a.slice()),index:s.array.slice()}:o={roots:r,index:s.array},o}static deserialize(e,t,i={}){if(typeof i=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),_0.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});i={setIndex:!0,...i};const{index:r,roots:s}=e,o=new _0(t,{...i,[cZ]:!0});if(o._roots=s,i.setIndex){const a=t.getIndex();if(a===null){const l=new Pt(e.index,1,!1);t.setIndex(l)}else a.array!==r&&(a.array.set(r),a.needsUpdate=!0)}return o}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:Ij,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[cZ]:!1},t),t.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[cZ]||(this._roots=dCe(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Us))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=this.geometry,i=t.index.array,r=t.attributes.position;let s,o,a,l,c=0;const g=this._roots;for(let d=0,h=g.length;d<h;d++)s=g[d],o=new Uint32Array(s),a=new Uint16Array(s),l=new Float32Array(s),u(0,c),c+=s.byteLength;function u(d,h,f=!1){const I=d*2;if(a[I+15]===eW){const p=o[d+6],y=a[I+14];let v=1/0,b=1/0,w=1/0,G=-1/0,x=-1/0,B=-1/0;for(let R=3*p,Z=3*(p+y);R<Z;R++){const W=i[R],F=r.getX(W),T=r.getY(W),V=r.getZ(W);F<v&&(v=F),F>G&&(G=F),T<b&&(b=T),T>x&&(x=T),V<w&&(w=V),V>B&&(B=V)}return l[d+0]!==v||l[d+1]!==b||l[d+2]!==w||l[d+3]!==G||l[d+4]!==x||l[d+5]!==B?(l[d+0]=v,l[d+1]=b,l[d+2]=w,l[d+3]=G,l[d+4]=x,l[d+5]=B,!0):!1}else{const p=d+8,y=o[d+6],v=p+h,b=y+h;let w=f,G=!1,x=!1;e?w||(G=e.has(v),x=e.has(b),w=!G&&!x):(G=!0,x=!0);const B=w||G,R=w||x;let Z=!1;B&&(Z=u(p,h,w));let W=!1;R&&(W=u(y,h,w));const F=Z||W;if(F)for(let T=0;T<3;T++){const V=p+T,z=y+T,U=l[V],J=l[V+3],H=l[z],Y=l[z+3];l[d+T]=U<H?U:H,l[d+T+3]=J>Y?J:Y}return F}}}traverse(e,t=0){const i=this._roots[t],r=new Uint32Array(i),s=new Uint16Array(i);o(0);function o(a,l=0){const c=a*2,g=s[c+15]===eW;if(g){const u=r[a+6],d=s[c+14];e(l,g,new Float32Array(i,a*4,6),u,d)}else{const u=a+m1/4,d=r[a+6],h=r[a+7];e(l,g,new Float32Array(i,a*4,6),h)||(o(u,l+1),o(d,l+1))}}}raycast(e,t=wo){const i=this._roots,r=this.geometry,s=[],o=t.isMaterial,a=Array.isArray(t),l=r.groups,c=o?t.side:t;for(let g=0,u=i.length;g<u;g++){const d=a?t[l[g].materialIndex].side:c,h=s.length;if(i0(i[g]),tW(0,r,d,e,s),$B(),a){const f=l[g].materialIndex;for(let I=h,A=s.length;I<A;I++)s[I].face.materialIndex=f}}return s}raycastFirst(e,t=wo){const i=this._roots,r=this.geometry,s=t.isMaterial,o=Array.isArray(t);let a=null;const l=r.groups,c=s?t.side:t;for(let g=0,u=i.length;g<u;g++){const d=o?t[l[g].materialIndex].side:c;i0(i[g]);const h=nW(0,r,d,e);$B(),h!=null&&(a==null||h.distance<a.distance)&&(a=h,o&&(h.face.materialIndex=l[g].materialIndex))}return a}intersectsGeometry(e,t){const i=this.geometry;let r=!1;for(const s of this._roots)if(i0(s),r=BCe(0,i,e,t),$B(),r)break;return r}shapecast(e,t,i){const r=this.geometry;if(e instanceof Function){if(t){const d=t;t=(h,f,I,A)=>{const p=f*3;return d(h,p,p+1,p+2,I,A)}}e={boundsTraverseOrder:i,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const s=Pl.getPrimitive();let{boundsTraverseOrder:o,intersectsBounds:a,intersectsRange:l,intersectsTriangle:c}=e;if(l&&c){const d=l;l=(h,f,I,A,p)=>d(h,f,I,A,p)?!0:uz(h,f,r,c,I,A,s)}else l||(c?l=(d,h,f,I)=>uz(d,h,r,c,f,I,s):l=(d,h,f)=>f);let g=!1,u=0;for(const d of this._roots){if(i0(d),g=bCe(0,r,a,l,o,u),$B(),g)break;u+=d.byteLength}return Pl.releasePrimitive(s),g}bvhcast(e,t,i){let{intersectsRanges:r,intersectsTriangles:s}=i;const o=this.geometry.index,a=this.geometry.attributes.position,l=e.geometry.index,c=e.geometry.attributes.position;SI.copy(t).invert();const g=Pl.getPrimitive(),u=Pl.getPrimitive();if(s){let f=function(I,A,p,y,v,b,w,G){for(let x=p,B=p+y;x<B;x++){sc(u,x*3,l,c),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let R=I,Z=I+A;R<Z;R++)if(sc(g,R*3,o,a),g.needsUpdate=!0,s(g,u,R,x,v,b,w,G))return!0}return!1};var h=f;if(r){const I=r;r=function(A,p,y,v,b,w,G,x){return I(A,p,y,v,b,w,G,x)?!0:f(A,p,y,v,b,w,G,x)}}else r=f}e.getBoundingBox(uZ),uZ.applyMatrix4(t);const d=this.shapecast({intersectsBounds:f=>uZ.intersectsBox(f),intersectsRange:(f,I,A,p,y,v)=>(gZ.copy(v),gZ.applyMatrix4(SI),e.shapecast({intersectsBounds:b=>gZ.intersectsBox(b),intersectsRange:(b,w,G,x,B)=>r(f,I,b,w,p,y,x,B)}))});return Pl.releasePrimitive(g),Pl.releasePrimitive(u),d}intersectsBox(e,t){return rh.set(e.min,e.max,t),rh.needsUpdate=!0,this.shapecast({intersectsBounds:i=>rh.intersectsBox(i),intersectsTriangle:i=>rh.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},r={},s=0,o=1/0){e.boundingBox||e.computeBoundingBox(),rh.set(e.boundingBox.min,e.boundingBox.max,t),rh.needsUpdate=!0;const a=this.geometry,l=a.attributes.position,c=a.index,g=e.attributes.position,u=e.index,d=Pl.getPrimitive(),h=Pl.getPrimitive();let f=eG,I=GCe,A=null,p=null;r&&(A=wCe,p=xCe);let y=1/0,v=null,b=null;return SI.copy(t).invert(),pm.matrix.copy(SI),this.shapecast({boundsTraverseOrder:w=>rh.distanceToBox(w),intersectsBounds:(w,G,x)=>x<y&&x<o?(G&&(pm.min.copy(w.min),pm.max.copy(w.max),pm.needsUpdate=!0),!0):!1,intersectsRange:(w,G)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:x=>pm.distanceToBox(x),intersectsBounds:(x,B,R)=>R<y&&R<o,intersectsRange:(x,B)=>{for(let R=x*3,Z=(x+B)*3;R<Z;R+=3){sc(h,R,u,g),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let W=w*3,F=(w+G)*3;W<F;W+=3){sc(d,W,c,l),d.needsUpdate=!0;const T=d.distanceToTriangle(h,f,A);if(T<y&&(I.copy(f),p&&p.copy(A),y=T,v=W/3,b=R/3),T<s)return!0}}}});{const x=u?u.count:g.count;for(let B=0,R=x;B<R;B+=3){sc(h,B,u,g),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let Z=w*3,W=(w+G)*3;Z<W;Z+=3){sc(d,Z,c,l),d.needsUpdate=!0;const F=d.distanceToTriangle(h,f,A);if(F<y&&(I.copy(f),p&&p.copy(A),y=F,v=Z/3,b=B/3),F<s)return!0}}}}}),Pl.releasePrimitive(d),Pl.releasePrimitive(h),y===1/0?null:(i.point?i.point.copy(I):i.point=I.clone(),i.distance=y,i.faceIndex=v,r&&(r.point?r.point.copy(p):r.point=p.clone(),r.point.applyMatrix4(SI),I.applyMatrix4(SI),r.distance=I.sub(r.point).length(),r.faceIndex=b),i)}closestPointToPoint(e,t={},i=0,r=1/0){const s=i*i,o=r*r;let a=1/0,l=null;if(this.shapecast({boundsTraverseOrder:g=>(mm.copy(e).clamp(g.min,g.max),mm.distanceToSquared(e)),intersectsBounds:(g,u,d)=>d<a&&d<o,intersectsTriangle:(g,u)=>{g.closestPointToPoint(e,mm);const d=e.distanceToSquared(mm);return d<a&&(eG.copy(mm),a=d,l=u),d<s}}),a===1/0)return null;const c=Math.sqrt(a);return t.point?t.point.copy(eG):t.point=eG.clone(),t.distance=c,t.faceIndex=l,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(i=>{uc(0,new Float32Array(i),dz),e.union(dz)}),e}}const dZ=new WC,hz=new qe,SCe=Rn.prototype.raycast;function RCe(n,e){if(this.geometry.boundsTree){if(this.material===void 0)return;hz.copy(this.matrixWorld).invert(),dZ.copy(n.ray).applyMatrix4(hz);const t=this.geometry.boundsTree;if(n.firstHitOnly===!0){const i=gz(t.raycastFirst(dZ,this.material),this,n);i&&e.push(i)}else{const i=t.raycast(dZ,this.material);for(let r=0,s=i.length;r<s;r++){const o=gz(i[r],this,n);o&&e.push(o)}}}else SCe.call(this,n,e)}function ZCe(n){return this.boundsTree=new _0(this,n),this.boundsTree}function MCe(){this.boundsTree=null}function ECe(n,e){const t=n+"Geometry";return M.forwardRef(({args:i,children:r,...s},o)=>{const a=M.useRef(null);return M.useImperativeHandle(o,()=>a.current),M.useLayoutEffect(()=>void(e==null?void 0:e(a.current))),M.createElement("mesh",pt({ref:a},s),M.createElement(t,{attach:"geometry",args:i}),r)})}const fz=ECe("sphere"),WCe=M.forwardRef(({children:n,enabled:e=!0,speed:t=1,rotationIntensity:i=1,floatIntensity:r=1,floatingRange:s=[-.1,.1],...o},a)=>{const l=M.useRef(null),c=M.useRef(Math.random()*1e4);return yn(g=>{var u,d;if(!e||t===0)return;const h=c.current+g.clock.getElapsedTime();l.current.rotation.x=Math.cos(h/4*t)/8*i,l.current.rotation.y=Math.sin(h/4*t)/8*i,l.current.rotation.z=Math.sin(h/4*t)/20*i;let f=Math.sin(h/4*t)/10;f=ss.mapLinear(f,-.1,.1,(u=s==null?void 0:s[0])!==null&&u!==void 0?u:-.1,(d=s==null?void 0:s[1])!==null&&d!==void 0?d:.1),l.current.position.y=f*r,l.current.updateMatrix()}),M.createElement("group",o,M.createElement("group",{ref:Dw([l,a]),matrixAutoUpdate:!1},n))}),hZ={sunset:"venice/venice_sunset_1k.hdr",dawn:"kiara/kiara_1_dawn_1k.hdr",night:"dikhololo/dikhololo_night_1k.hdr",warehouse:"empty-wharehouse/empty_warehouse_01_1k.hdr",forest:"forrest-slope/forest_slope_1k.hdr",apartment:"lebombo/lebombo_1k.hdr",studio:"studio-small-3/studio_small_03_1k.hdr",city:"potsdamer-platz/potsdamer_platz_1k.hdr",park:"rooitou/rooitou_park_1k.hdr",lobby:"st-fagans/st_fagans_interior_1k.hdr"},FCe="https://market-assets.fra1.cdn.digitaloceanspaces.com/market-assets/hdris/";function pj({files:n=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:e="",preset:t=void 0,encoding:i=void 0,extensions:r}={}){if(t){if(!(t in hZ))throw new Error("Preset must be one of: "+Object.keys(hZ).join(", "));n=hZ[t],e=FCe}const s=Array.isArray(n),a=Ef(s?G4:tAe,s?[n]:n,c=>{c.setPath(e),r&&r(c)}),l=s?a[0]:a;return l.mapping=s?zg:iC,l.encoding=i??s?Xt:ta,l}const _Ce=n=>n.current&&n.current.isScene,VCe=n=>_Ce(n)?n.current:n;function PV(n,e,t,i,r=0){const s=VCe(e||t),o=s.background,a=s.environment,l=s.backgroundBlurriness||0;return n!=="only"&&(s.environment=i),n&&(s.background=i),n&&s.backgroundBlurriness!==void 0&&(s.backgroundBlurriness=r),()=>{n!=="only"&&(s.environment=a),n&&(s.background=o),n&&s.backgroundBlurriness!==void 0&&(s.backgroundBlurriness=l)}}function UV({scene:n,background:e=!1,blur:t,map:i}){const r=Bt(s=>s.scene);return M.useLayoutEffect(()=>{if(i)return PV(e,n,r,i,t)},[r,n,i,e,t]),null}function mj({background:n=!1,scene:e,blur:t,...i}){const r=pj(i),s=Bt(o=>o.scene);return M.useLayoutEffect(()=>PV(n,e,s,r,t),[r,n,e,s,t]),null}function TCe({children:n,near:e=1,far:t=1e3,resolution:i=256,frames:r=1,map:s,background:o=!1,blur:a,scene:l,files:c,path:g,preset:u=void 0,extensions:d}){const h=Bt(v=>v.gl),f=Bt(v=>v.scene),I=M.useRef(null),[A]=M.useState(()=>new Cd),p=M.useMemo(()=>{const v=new sv(i);return v.texture.type=Pi,v},[i]);M.useLayoutEffect(()=>(r===1&&I.current.update(h,A),PV(o,l,f,p.texture,a)),[n,A,p.texture,l,f,o,r,h]);let y=1;return yn(()=>{(r===1/0||y<r)&&(I.current.update(h,A),y++)}),M.createElement(M.Fragment,null,yd(M.createElement(M.Fragment,null,n,M.createElement("cubeCamera",{ref:I,args:[e,t,p]}),c||u?M.createElement(mj,{background:!0,files:c,preset:u,path:g,extensions:d}):s?M.createElement(UV,{background:!0,map:s,extensions:d}):null),A))}function NCe(n){var e,t,i,r;const s=pj(n),o=n.map||s;M.useMemo(()=>Zd({GroundProjectedEnvImpl:hIe}),[]);const a=M.useMemo(()=>[o],[o]),l=(e=n.ground)==null?void 0:e.height,c=(t=n.ground)==null?void 0:t.radius,g=(i=(r=n.ground)==null?void 0:r.scale)!==null&&i!==void 0?i:1e3;return M.createElement(M.Fragment,null,M.createElement(UV,pt({},n,{map:o})),M.createElement("groundProjectedEnvImpl",{args:a,scale:g,height:l,radius:c}))}function kCe(n){return n.ground?M.createElement(NCe,n):n.map?M.createElement(UV,n):n.children?M.createElement(TCe,n):M.createElement(mj,n)}var yj={exports:{}},LCe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",HCe=LCe,zCe=HCe;function vj(){}function bj(){}bj.resetWarningCache=vj;var XCe=function(){function n(i,r,s,o,a,l){if(l!==zCe){var c=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}n.isRequired=n;function e(){return n}var t={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:e,element:n,elementType:n,instanceOf:e,node:n,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:bj,resetWarningCache:vj};return t.PropTypes=t,t};yj.exports=XCe();var YCe=yj.exports;const ln=Ks(YCe);ln.func.isRequired,ln.arrayOf(ln.oneOfType([ln.element,ln.func])).isRequired;const Iz=new qe,Az=new qe,tG=[],ym=new Rn;class KCe extends ho{constructor(){super(),this.color=new Ke("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return(e=this.instance.current)==null?void 0:e.geometry}raycast(e,t){const i=this.instance.current;if(!i||!i.geometry||!i.material)return;ym.geometry=i.geometry;const r=i.matrixWorld,s=i.userData.instances.indexOf(this.instanceKey);if(!(s===-1||s>i.count)){i.getMatrixAt(s,Iz),Az.multiplyMatrices(r,Iz),ym.matrixWorld=Az,i.material instanceof ai?ym.material.side=i.material.side:ym.material.side=i.material[0].side,ym.raycast(e,tG);for(let o=0,a=tG.length;o<a;o++){const l=tG[o];l.instanceId=s,l.object=this,t.push(l)}tG.length=0}}}const Bj=M.createContext(null),Cz=new qe,pz=new qe,DCe=new qe,mz=new D,yz=new xn,vz=new D,Gj=M.forwardRef(({context:n,children:e,...t},i)=>{M.useMemo(()=>Zd({PositionMesh:KCe}),[]);const r=M.useRef(),{subscribe:s,getParent:o}=M.useContext(n||Bj);return M.useLayoutEffect(()=>s(r),[]),M.createElement("positionMesh",pt({instance:o(),instanceKey:r,ref:Dw([i,r])},t),e)}),PCe=M.forwardRef(({children:n,range:e,limit:t=1e3,frames:i=1/0,...r},s)=>{const[{context:o,instance:a}]=M.useState(()=>{const A=M.createContext(null);return{context:A,instance:M.forwardRef((p,y)=>M.createElement(Gj,pt({context:A},p,{ref:y})))}}),l=M.useRef(null),[c,g]=M.useState([]),[[u,d]]=M.useState(()=>{const A=new Float32Array(t*16);for(let p=0;p<t;p++)DCe.identity().toArray(A,p*16);return[A,new Float32Array([...new Array(t*3)].map(()=>1))]});M.useEffect(()=>{l.current.instanceMatrix.needsUpdate=!0});let h=0,f=0;yn(()=>{if(i===1/0||h<i){l.current.updateMatrix(),l.current.updateMatrixWorld(),Cz.copy(l.current.matrixWorld).invert(),f=Math.min(t,e!==void 0?e:t,c.length),l.current.count=f,l.current.instanceMatrix.updateRange.count=f*16,l.current.instanceColor.updateRange.count=f*3;for(let A=0;A<c.length;A++){const p=c[A].current;p.matrixWorld.decompose(mz,yz,vz),pz.compose(mz,yz,vz).premultiply(Cz),pz.toArray(u,A*16),l.current.instanceMatrix.needsUpdate=!0,p.color.toArray(d,A*3),l.current.instanceColor.needsUpdate=!0}h++}});const I=M.useMemo(()=>({getParent:()=>l,subscribe:A=>(g(p=>[...p,A]),()=>g(p=>p.filter(y=>y.current!==A.current)))}),[]);return M.createElement("instancedMesh",pt({userData:{instances:c},matrixAutoUpdate:!1,ref:Dw([s,l]),args:[null,null,0],raycast:()=>null},r),M.createElement("instancedBufferAttribute",{attach:"instanceMatrix",count:u.length/16,array:u,itemSize:16,usage:d2}),M.createElement("instancedBufferAttribute",{attach:"instanceColor",count:d.length/3,array:d,itemSize:3,usage:d2}),typeof n=="function"?M.createElement(o.Provider,{value:I},n(a)):M.createElement(Bj.Provider,{value:I},n))});/**
 * postprocessing v6.31.0 build Sun May 07 2023
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2023 Raoul van Rüschen
 * @license Zlib
 */var Wf="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",UCe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;
#else
float CoC=texture2D(cocBuffer,vUv).g*scale;
#endif
if(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(CoC,CoCNearFar.g*scale);
#else
vec2 step=texelSize*CoC;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,nG=class extends Nt{constructor(n=!1,e=!1){super({name:"BokehMaterial",defines:{PASS:n?"2":"1"},uniforms:{inputBuffer:new ye(null),cocBuffer:new ye(null),texelSize:new ye(new pe),kernel64:new ye(null),kernel16:new ye(null),scale:new ye(1)},blending:ei,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:UCe,vertexShader:Wf}),e&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}set cocBuffer(n){this.uniforms.cocBuffer.value=n}setCoCBuffer(n){this.uniforms.cocBuffer.value=n}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(n){return this.scale}setScale(n){this.scale=n}generateKernel(){const n=2.39996323,e=new Float64Array(128),t=new Float64Array(32);let i=0,r=0;for(let s=0,o=Math.sqrt(80);s<80;++s){const a=s*n,l=Math.sqrt(s)/o,c=l*Math.cos(a),g=l*Math.sin(a);s%5===0?(t[r++]=c,t[r++]=g):(e[i++]=c,e[i++]=g)}this.uniforms.kernel64.value=e,this.uniforms.kernel16.value=t}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},wj="",Gn="srgb",fC="srgb-linear",QCe=Number(wf.replace(/\D+/g,"")),QV=QCe>=152,xj=new Map([[ta,fC],[Xt,Gn]]),OCe=new Map([[fC,ta],[Gn,Xt]]);function Pg(n){return n===null?null:QV?n.outputColorSpace:xj.get(n.outputEncoding)}function er(n,e){n!==null&&(QV?n.colorSpace=e:n.encoding=OCe.get(e))}function fZ(n,e){n===null||e===null||(QV?e.colorSpace=n.colorSpace:e.encoding=n.encoding)}function yA(n,e,t){return n*(e-t)-e}function zh(n,e,t){return Math.min(Math.max((n+e)/(e-t),0),1)}var JCe=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,jCe=class extends Nt{constructor(n){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new ye(null),focusDistance:new ye(0),focusRange:new ye(0),cameraNear:new ye(.3),cameraFar:new ye(1e3)},blending:ei,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:JCe,vertexShader:Wf}),this.uniforms.focalLength=this.uniforms.focusRange,this.copyCameraSettings(n)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=pr){this.depthBuffer=n,this.depthPacking=e}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(n){this.uniforms.focusDistance.value=n}get worldFocusDistance(){return-yA(this.focusDistance,this.near,this.far)}set worldFocusDistance(n){this.focusDistance=zh(-n,this.near,this.far)}getFocusDistance(n){this.uniforms.focusDistance.value=n}setFocusDistance(n){this.uniforms.focusDistance.value=n}get focalLength(){return this.focusRange}set focalLength(n){this.focusRange=n}get focusRange(){return this.uniforms.focusRange.value}set focusRange(n){this.uniforms.focusRange.value=n}get worldFocusRange(){return-yA(this.focusRange,this.near,this.far)}set worldFocusRange(n){this.focusRange=zh(-n,this.near,this.far)}getFocalLength(n){return this.focusRange}setFocalLength(n){this.focusRange=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof zn?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},Rt={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},vA={RED:0,GREEN:1,BLUE:2,ALPHA:3},r0={FULL:0,SINGLE:1},V0={DEFAULT:0,KEEP_MAX_DEPTH:1,DISCARD_MAX_DEPTH:2},ka={NONE:0,DEPTH:1,CONVOLUTION:2},fn={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Rh={DISABLED:0,SPORADIC:1,CONSTANT_MILD:2,CONSTANT_WILD:3},DC={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},qCe={SCALE_UP:"lut.scaleup"},T0={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2},$Ce=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <encodings_fragment>
}`,epe="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",tpe=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],npe=class extends Nt{constructor(n=new Lt){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new ye(null),texelSize:new ye(new Lt),scale:new ye(1),kernel:new ye(0)},blending:ei,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:$Ce,vertexShader:epe}),this.setTexelSize(n.x,n.y),this.kernelSize=DC.MEDIUM}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.inputBuffer=n}get kernelSequence(){return tpe[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(){return this.uniforms.scale.value}setScale(n){this.uniforms.scale.value=n}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(n){this.uniforms.kernel.value=n}setKernel(n){this.kernel=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e,n*.5,e*.5)}setSize(n,e){const t=1/n,i=1/e;this.uniforms.texelSize.value.set(t,i,t*.5,i*.5)}},ipe=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <encodings_fragment>
#include <dithering_fragment>
}`,Sj=class extends Nt{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new ye(null),opacity:new ye(1)},blending:ei,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ipe,vertexShader:Wf})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}getOpacity(n){return this.uniforms.opacity.value}setOpacity(n){this.uniforms.opacity.value=n}},rpe=`#include <packing>
#include <clipping_planes_pars_fragment>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float cameraNear;uniform float cameraFar;varying float vViewZ;varying vec4 vProjTexCoord;void main(){
#include <clipping_planes_fragment>
vec2 projTexCoord=(vProjTexCoord.xy/vProjTexCoord.w)*0.5+0.5;projTexCoord=clamp(projTexCoord,0.002,0.998);
#if DEPTH_PACKING == 3201
float fragCoordZ=unpackRGBAToDepth(texture2D(depthBuffer,projTexCoord));
#else
float fragCoordZ=texture2D(depthBuffer,projTexCoord).r;
#endif
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(fragCoordZ,cameraNear,cameraFar);
#else
float viewZ=orthographicDepthToViewZ(fragCoordZ,cameraNear,cameraFar);
#endif
float depthTest=(-vViewZ>-viewZ)?1.0:0.0;gl_FragColor.rg=vec2(0.0,depthTest);}`,spe=`#include <common>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
varying float vViewZ;varying vec4 vProjTexCoord;void main(){
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <project_vertex>
vViewZ=mvPosition.z;vProjTexCoord=gl_Position;
#include <clipping_planes_vertex>
}`,ope=class extends Nt{constructor(n=null,e){super({name:"DepthComparisonMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new ye(null),cameraNear:new ye(.3),cameraFar:new ye(1e3)},blending:ei,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:rpe,vertexShader:spe}),this.depthBuffer=n,this.depthPacking=Sl,this.copyCameraSettings(e)}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Sl){this.depthBuffer=n,this.depthPacking=e}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof zn?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},ape=`#include <packing>
varying vec2 vUv;
#ifdef NORMAL_DEPTH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
float readDepth(const in vec2 uv){return texture2D(normalDepthBuffer,uv).a;}
#else
#if INPUT_DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if INPUT_DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
void main(){
#if INPUT_DEPTH_PACKING == OUTPUT_DEPTH_PACKING
gl_FragColor=texture2D(depthBuffer,vUv);
#else
float depth=readDepth(vUv);
#if OUTPUT_DEPTH_PACKING == 3201
gl_FragColor=(depth==1.0)?vec4(1.0):packDepthToRGBA(depth);
#else
gl_FragColor=vec4(vec3(depth),1.0);
#endif
#endif
}`,lpe=`varying vec2 vUv;
#if DEPTH_COPY_MODE == 1
uniform vec2 texelPosition;
#endif
void main(){
#if DEPTH_COPY_MODE == 1
vUv=texelPosition;
#else
vUv=position.xy*0.5+0.5;
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,cpe=class extends Nt{constructor(){super({name:"DepthCopyMaterial",defines:{INPUT_DEPTH_PACKING:"0",OUTPUT_DEPTH_PACKING:"0",DEPTH_COPY_MODE:"0"},uniforms:{depthBuffer:new ye(null),texelPosition:new ye(new pe)},blending:ei,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ape,vertexShader:lpe}),this.depthCopyMode=r0.FULL}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set inputDepthPacking(n){this.defines.INPUT_DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}get outputDepthPacking(){return Number(this.defines.OUTPUT_DEPTH_PACKING)}set outputDepthPacking(n){this.defines.OUTPUT_DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=pr){this.depthBuffer=n,this.inputDepthPacking=e}getInputDepthPacking(){return Number(this.defines.INPUT_DEPTH_PACKING)}setInputDepthPacking(n){this.defines.INPUT_DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}getOutputDepthPacking(){return Number(this.defines.OUTPUT_DEPTH_PACKING)}setOutputDepthPacking(n){this.defines.OUTPUT_DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}get texelPosition(){return this.uniforms.texelPosition.value}getTexelPosition(){return this.uniforms.texelPosition.value}setTexelPosition(n){this.uniforms.texelPosition.value=n}get mode(){return this.depthCopyMode}set mode(n){this.depthCopyMode=n,this.defines.DEPTH_COPY_MODE=n.toFixed(0),this.needsUpdate=!0}getMode(){return this.mode}setMode(n){this.mode=n}},gpe=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[]=float[4](abs(c-samples[0]),abs(c-samples[1]),abs(c-samples[2]),abs(c-samples[3]));float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[]=float[4](readDepth(vUv0),readDepth(vUv1),readDepth(vUv2),readDepth(vUv3));int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[]=vec3[4](texture2D(normalBuffer,vUv0).rgb,texture2D(normalBuffer,vUv1).rgb,texture2D(normalBuffer,vUv2).rgb,texture2D(normalBuffer,vUv3).rgb);
#else
vec3 n[]=vec3[4](vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
#endif
gl_FragColor=vec4(n[index],d[index]);}`,upe="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",dpe=class extends Nt{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new ye(null),normalBuffer:new ye(null),texelSize:new ye(new pe)},blending:ei,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:gpe,vertexShader:upe})}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=pr){this.depthBuffer=n,this.depthPacking=e}set normalBuffer(n){this.uniforms.normalBuffer.value=n,n!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(n){this.normalBuffer=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},hpe=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer0;uniform highp sampler2D depthBuffer1;
#else
uniform mediump sampler2D depthBuffer0;uniform mediump sampler2D depthBuffer1;
#endif
uniform sampler2D inputBuffer;uniform vec2 cameraNearFar;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}varying vec2 vUv;void main(){vec2 depth;
#if DEPTH_PACKING_0 == 3201
depth.x=unpackRGBAToDepth(texture2D(depthBuffer0,vUv));
#else
depth.x=texture2D(depthBuffer0,vUv).r;
#endif
#if DEPTH_PACKING_1 == 3201
depth.y=unpackRGBAToDepth(texture2D(depthBuffer1,vUv));
#else
depth.y=texture2D(depthBuffer1,vUv).r;
#endif
bool isMaxDepth=(depth.x==1.0);
#ifdef PERSPECTIVE_CAMERA
depth.x=viewZToOrthographicDepth(getViewZ(depth.x),cameraNearFar.x,cameraNearFar.y);depth.y=viewZToOrthographicDepth(getViewZ(depth.y),cameraNearFar.x,cameraNearFar.y);
#endif
#if DEPTH_TEST_STRATEGY == 0
bool keep=depthTest(depth.x,depth.y);
#elif DEPTH_TEST_STRATEGY == 1
bool keep=isMaxDepth||depthTest(depth.x,depth.y);
#else
bool keep=!isMaxDepth&&depthTest(depth.x,depth.y);
#endif
if(keep){gl_FragColor=texture2D(inputBuffer,vUv);}else{discard;}}`,Rj=class extends Nt{constructor(){super({name:"DepthMaskMaterial",defines:{DEPTH_EPSILON:"0.0001",DEPTH_PACKING_0:"0",DEPTH_PACKING_1:"0",DEPTH_TEST_STRATEGY:V0.KEEP_MAX_DEPTH},uniforms:{inputBuffer:new ye(null),depthBuffer0:new ye(null),depthBuffer1:new ye(null),cameraNearFar:new ye(new pe(1,1))},blending:ei,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:hpe,vertexShader:Wf}),this.depthMode=u2}set depthBuffer0(n){this.uniforms.depthBuffer0.value=n}set depthPacking0(n){this.defines.DEPTH_PACKING_0=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer0(n,e=pr){this.depthBuffer0=n,this.depthPacking0=e}set depthBuffer1(n){this.uniforms.depthBuffer1.value=n}set depthPacking1(n){this.defines.DEPTH_PACKING_1=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer1(n,e=pr){this.depthBuffer1=n,this.depthPacking1=e}get maxDepthStrategy(){return Number(this.defines.DEPTH_TEST_STRATEGY)}set maxDepthStrategy(n){this.defines.DEPTH_TEST_STRATEGY=n.toFixed(0),this.needsUpdate=!0}get keepFar(){return this.maxDepthStrategy}set keepFar(n){this.maxDepthStrategy=n?V0.KEEP_MAX_DEPTH:V0.DISCARD_MAX_DEPTH}getMaxDepthStrategy(){return this.maxDepthStrategy}setMaxDepthStrategy(n){this.maxDepthStrategy=n}get epsilon(){return Number(this.defines.DEPTH_EPSILON)}set epsilon(n){this.defines.DEPTH_EPSILON=n.toFixed(16),this.needsUpdate=!0}getEpsilon(){return this.epsilon}setEpsilon(n){this.epsilon=n}get depthMode(){return Number(this.defines.DEPTH_MODE)}set depthMode(n){let e;switch(n){case x_:e="false";break;case S_:e="true";break;case fy:e="abs(d1 - d0) <= DEPTH_EPSILON";break;case Gw:e="abs(d1 - d0) > DEPTH_EPSILON";break;case u2:e="d0 > d1";break;case hy:e="d0 >= d1";break;case R_:e="d0 <= d1";break;case Z_:default:e="d0 < d1";break}this.defines.DEPTH_MODE=n.toFixed(0),this.defines["depthTest(d0, d1)"]=e,this.needsUpdate=!0}getDepthMode(){return this.depthMode}setDepthMode(n){this.depthMode=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNearFar.value.set(n.near,n.far),n instanceof zn?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},fpe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <encodings_fragment>
}`,Ipe="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",Ape=class extends Nt{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new ye(null),texelSize:new ye(new pe)},blending:ei,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:fpe,vertexShader:Ipe})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},Cpe=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <encodings_fragment>
#endif
#include <dithering_fragment>
}`,ppe="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",mpe=class extends Nt{constructor(n,e,t,i,r=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:wf.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new ye(null),depthBuffer:new ye(null),resolution:new ye(new pe),texelSize:new ye(new pe),cameraNear:new ye(.3),cameraFar:new ye(1e3),aspect:new ye(1),time:new ye(0)},blending:ei,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:r}),n&&this.setShaderParts(n),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(i)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=pr){this.depthBuffer=n,this.depthPacking=e}setShaderData(n){this.setShaderParts(n.shaderParts),this.setDefines(n.defines),this.setUniforms(n.uniforms),this.setExtensions(n.extensions)}setShaderParts(n){return this.fragmentShader=Cpe.replace(fn.FRAGMENT_HEAD,n.get(fn.FRAGMENT_HEAD)||"").replace(fn.FRAGMENT_MAIN_UV,n.get(fn.FRAGMENT_MAIN_UV)||"").replace(fn.FRAGMENT_MAIN_IMAGE,n.get(fn.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=ppe.replace(fn.VERTEX_HEAD,n.get(fn.VERTEX_HEAD)||"").replace(fn.VERTEX_MAIN_SUPPORT,n.get(fn.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(n){for(const e of n.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(n){for(const e of n.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(n){this.extensions={};for(const e of n)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(n){this.encodeOutput!==n&&(n?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(n){return this.encodeOutput}setOutputEncodingEnabled(n){this.encodeOutput=n}get time(){return this.uniforms.time.value}set time(n){this.uniforms.time.value=n}setDeltaTime(n){this.uniforms.time.value+=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof zn?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const t=this.uniforms;t.resolution.value.set(n,e),t.texelSize.value.set(1/n,1/e),t.aspect.value=n/e}static get Section(){return fn}},ype=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform vec2 lightPosition;uniform float exposure;uniform float decay;uniform float density;uniform float weight;uniform float clampMax;varying vec2 vUv;void main(){vec2 coord=vUv;vec2 delta=lightPosition-coord;delta*=1.0/SAMPLES_FLOAT*density;float illuminationDecay=1.0;vec4 color=vec4(0.0);for(int i=0;i<SAMPLES_INT;++i){coord+=delta;vec4 texel=texture2D(inputBuffer,coord);texel*=illuminationDecay*weight;color+=texel;illuminationDecay*=decay;}gl_FragColor=clamp(color*exposure,0.0,clampMax);
#include <dithering_fragment>
}`,vpe=class extends Nt{constructor(n){super({name:"GodRaysMaterial",defines:{SAMPLES_INT:"60",SAMPLES_FLOAT:"60.0"},uniforms:{inputBuffer:new ye(null),lightPosition:new ye(n),density:new ye(1),decay:new ye(1),weight:new ye(1),exposure:new ye(1),clampMax:new ye(1)},blending:ei,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ype,vertexShader:Wf})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get lightPosition(){return this.uniforms.lightPosition.value}getLightPosition(){return this.uniforms.lightPosition.value}setLightPosition(n){this.uniforms.lightPosition.value=n}get density(){return this.uniforms.density.value}set density(n){this.uniforms.density.value=n}getDensity(){return this.uniforms.density.value}setDensity(n){this.uniforms.density.value=n}get decay(){return this.uniforms.decay.value}set decay(n){this.uniforms.decay.value=n}getDecay(){return this.uniforms.decay.value}setDecay(n){this.uniforms.decay.value=n}get weight(){return this.uniforms.weight.value}set weight(n){this.uniforms.weight.value=n}getWeight(){return this.uniforms.weight.value}setWeight(n){this.uniforms.weight.value=n}get exposure(){return this.uniforms.exposure.value}set exposure(n){this.uniforms.exposure.value=n}getExposure(){return this.uniforms.exposure.value}setExposure(n){this.uniforms.exposure.value=n}get maxIntensity(){return this.uniforms.clampMax.value}set maxIntensity(n){this.uniforms.clampMax.value=n}getMaxIntensity(){return this.uniforms.clampMax.value}setMaxIntensity(n){this.uniforms.clampMax.value=n}get samples(){return Number(this.defines.SAMPLES_INT)}set samples(n){const e=Math.floor(n);this.defines.SAMPLES_INT=e.toFixed(0),this.defines.SAMPLES_FLOAT=e.toFixed(1),this.needsUpdate=!0}getSamples(){return this.samples}setSamples(n){this.samples=n}},bpe=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,Bpe=class extends Nt{constructor(n=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:wf.replace(/\D+/g,"")},uniforms:{inputBuffer:new ye(null),threshold:new ye(0),smoothing:new ye(1),range:new ye(null)},blending:ei,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:bpe,vertexShader:Wf}),this.colorOutput=n,this.luminanceRange=e}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get threshold(){return this.uniforms.threshold.value}set threshold(n){this.smoothing>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=n}getThreshold(){return this.threshold}setThreshold(n){this.threshold=n}get smoothing(){return this.uniforms.smoothing.value}set smoothing(n){this.threshold>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=n}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(n){this.smoothing=n}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(n){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(n){n?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(n){return this.colorOutput}setColorOutputEnabled(n){this.colorOutput=n}get useRange(){return this.luminanceRange!==null}set useRange(n){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(n){n!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=n,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(n){this.luminanceRange=n}},Gpe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,wpe=class extends Nt{constructor(n=null){super({name:"MaskMaterial",uniforms:{maskTexture:new ye(n),inputBuffer:new ye(null),strength:new ye(1)},blending:ei,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Gpe,vertexShader:Wf}),this.colorChannel=vA.RED,this.maskFunction=T0.DISCARD}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}set maskTexture(n){this.uniforms.maskTexture.value=n,delete this.defines.MASK_PRECISION_HIGH,n.type!==Dn&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(n){this.maskTexture=n}set colorChannel(n){this.defines.COLOR_CHANNEL=n.toFixed(0),this.needsUpdate=!0}setColorChannel(n){this.colorChannel=n}set maskFunction(n){this.defines.MASK_FUNCTION=n.toFixed(0),this.needsUpdate=!0}setMaskFunction(n){this.maskFunction=n}get inverted(){return this.defines.INVERTED!==void 0}set inverted(n){this.inverted&&!n?delete this.defines.INVERTED:n&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(n){this.inverted=n}get strength(){return this.uniforms.strength.value}set strength(n){this.uniforms.strength.value=n}getStrength(){return this.strength}setStrength(n){this.strength=n}},xpe="uniform lowp sampler2D inputBuffer;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 c0=texture2D(inputBuffer,vUv0).rg;vec2 c1=texture2D(inputBuffer,vUv1).rg;vec2 c2=texture2D(inputBuffer,vUv2).rg;vec2 c3=texture2D(inputBuffer,vUv3).rg;float d0=(c0.x-c1.x)*0.5;float d1=(c2.x-c3.x)*0.5;float d=length(vec2(d0,d1));float a0=min(c0.y,c1.y);float a1=min(c2.y,c3.y);float visibilityFactor=min(a0,a1);gl_FragColor.rg=(1.0-visibilityFactor>0.001)?vec2(d,0.0):vec2(0.0,d);}",Spe="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=vec2(uv.x+texelSize.x,uv.y);vUv1=vec2(uv.x-texelSize.x,uv.y);vUv2=vec2(uv.x,uv.y+texelSize.y);vUv3=vec2(uv.x,uv.y-texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}",Rpe=class extends Nt{constructor(n=new pe){super({name:"OutlineMaterial",uniforms:{inputBuffer:new ye(null),texelSize:new ye(new pe)},blending:ei,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:xpe,vertexShader:Spe}),this.uniforms.texelSize.value.set(n.x,n.y),this.uniforms.maskTexture=this.uniforms.inputBuffer}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},Zpe=`#include <common>
#include <packing>
#ifdef NORMAL_DEPTH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
float readDepth(const in vec2 uv){return texture2D(normalDepthBuffer,uv).a;}
#else
uniform lowp sampler2D normalBuffer;
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
uniform lowp sampler2D noiseTexture;uniform mat4 inverseProjectionMatrix;uniform mat4 projectionMatrix;uniform vec2 texelSize;uniform vec2 cameraNearFar;uniform float intensity;uniform float minRadiusScale;uniform float fade;uniform float bias;uniform vec2 distanceCutoff;uniform vec2 proximityCutoff;varying vec2 vUv;varying vec2 vUv2;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 getViewPosition(const in vec2 screenPosition,const in float depth,const in float viewZ){vec4 clipPosition=vec4(vec3(screenPosition,depth)*2.0-1.0,1.0);float clipW=projectionMatrix[2][3]*viewZ+projectionMatrix[3][3];clipPosition*=clipW;return(inverseProjectionMatrix*clipPosition).xyz;}float getAmbientOcclusion(const in vec3 p,const in vec3 n,const in float depth,const in vec2 uv){float radiusScale=1.0-smoothstep(0.0,distanceCutoff.y,depth);radiusScale=radiusScale*(1.0-minRadiusScale)+minRadiusScale;float radius=RADIUS*radiusScale;float noise=texture2D(noiseTexture,vUv2).r;float baseAngle=noise*PI2;float rings=SPIRAL_TURNS*PI2;float occlusion=0.0;int taps=0;for(int i=0;i<SAMPLES_INT;++i){float alpha=(float(i)+0.5)*INV_SAMPLES_FLOAT;float angle=alpha*rings+baseAngle;vec2 rotation=vec2(cos(angle),sin(angle));vec2 coords=alpha*radius*rotation*texelSize+uv;if(coords.s<0.0||coords.s>1.0||coords.t<0.0||coords.t>1.0){continue;}float sampleDepth=readDepth(coords);float viewZ=getViewZ(sampleDepth);
#ifdef PERSPECTIVE_CAMERA
float linearSampleDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearSampleDepth=sampleDepth;
#endif
float proximity=abs(depth-linearSampleDepth);if(proximity<proximityCutoff.y){float falloff=1.0-smoothstep(proximityCutoff.x,proximityCutoff.y,proximity);vec3 Q=getViewPosition(coords,sampleDepth,viewZ);vec3 v=Q-p;float vv=dot(v,v);float vn=dot(v,n)-bias;float f=max(RADIUS_SQ-vv,0.0)/RADIUS_SQ;occlusion+=(f*f*f*max(vn/(fade+vv),0.0))*falloff;}++taps;}return occlusion/(4.0*max(float(taps),1.0));}void main(){
#ifdef NORMAL_DEPTH
vec4 normalDepth=texture2D(normalDepthBuffer,vUv);
#else
vec4 normalDepth=vec4(texture2D(normalBuffer,vUv).xyz,readDepth(vUv));
#endif
float ao=0.0;float depth=normalDepth.a;float viewZ=getViewZ(depth);
#ifdef PERSPECTIVE_CAMERA
float linearDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearDepth=depth;
#endif
if(linearDepth<distanceCutoff.y){vec3 viewPosition=getViewPosition(vUv,depth,viewZ);vec3 viewNormal=unpackRGBToNormal(normalDepth.rgb);ao+=getAmbientOcclusion(viewPosition,viewNormal,linearDepth,vUv);float d=smoothstep(distanceCutoff.x,distanceCutoff.y,linearDepth);ao=mix(ao,0.0,d);
#ifdef LEGACY_INTENSITY
ao=clamp(1.0-pow(1.0-ao,abs(intensity)),0.0,1.0);
#endif
}gl_FragColor.r=ao;}`,Mpe="uniform vec2 noiseScale;varying vec2 vUv;varying vec2 vUv2;void main(){vUv=position.xy*0.5+0.5;vUv2=vUv*noiseScale;gl_Position=vec4(position.xy,1.0,1.0);}",Epe=class extends Nt{constructor(n){super({name:"SSAOMaterial",defines:{SAMPLES_INT:"0",INV_SAMPLES_FLOAT:"0.0",SPIRAL_TURNS:"0.0",RADIUS:"1.0",RADIUS_SQ:"1.0",DISTANCE_SCALING:"1",DEPTH_PACKING:"0"},uniforms:{depthBuffer:new ye(null),normalBuffer:new ye(null),normalDepthBuffer:new ye(null),noiseTexture:new ye(null),inverseProjectionMatrix:new ye(new qe),projectionMatrix:new ye(new qe),texelSize:new ye(new pe),cameraNearFar:new ye(new pe),distanceCutoff:new ye(new pe),proximityCutoff:new ye(new pe),noiseScale:new ye(new pe),minRadiusScale:new ye(.33),intensity:new ye(1),fade:new ye(.01),bias:new ye(0)},blending:ei,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Zpe,vertexShader:Mpe}),this.copyCameraSettings(n),this.resolution=new pe,this.r=1}get near(){return this.uniforms.cameraNearFar.value.x}get far(){return this.uniforms.cameraNearFar.value.y}set normalDepthBuffer(n){this.uniforms.normalDepthBuffer.value=n,n!==null?this.defines.NORMAL_DEPTH="1":delete this.defines.NORMAL_DEPTH,this.needsUpdate=!0}setNormalDepthBuffer(n){this.normalDepthBuffer=n}set normalBuffer(n){this.uniforms.normalBuffer.value=n}setNormalBuffer(n){this.uniforms.normalBuffer.value=n}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=pr){this.depthBuffer=n,this.depthPacking=e}set noiseTexture(n){this.uniforms.noiseTexture.value=n}setNoiseTexture(n){this.uniforms.noiseTexture.value=n}get samples(){return Number(this.defines.SAMPLES_INT)}set samples(n){this.defines.SAMPLES_INT=n.toFixed(0),this.defines.INV_SAMPLES_FLOAT=(1/n).toFixed(9),this.needsUpdate=!0}getSamples(){return this.samples}setSamples(n){this.samples=n}get rings(){return Number(this.defines.SPIRAL_TURNS)}set rings(n){this.defines.SPIRAL_TURNS=n.toFixed(1),this.needsUpdate=!0}getRings(){return this.rings}setRings(n){this.rings=n}get intensity(){return this.uniforms.intensity.value}set intensity(n){this.uniforms.intensity.value=n,this.defines.LEGACY_INTENSITY===void 0&&(this.defines.LEGACY_INTENSITY="1",this.needsUpdate=!0)}getIntensity(){return this.uniforms.intensity.value}setIntensity(n){this.uniforms.intensity.value=n}get fade(){return this.uniforms.fade.value}set fade(n){this.uniforms.fade.value=n}getFade(){return this.uniforms.fade.value}setFade(n){this.uniforms.fade.value=n}get bias(){return this.uniforms.bias.value}set bias(n){this.uniforms.bias.value=n}getBias(){return this.uniforms.bias.value}setBias(n){this.uniforms.bias.value=n}get minRadiusScale(){return this.uniforms.minRadiusScale.value}set minRadiusScale(n){this.uniforms.minRadiusScale.value=n}getMinRadiusScale(){return this.uniforms.minRadiusScale.value}setMinRadiusScale(n){this.uniforms.minRadiusScale.value=n}updateRadius(){const n=this.r*this.resolution.height;this.defines.RADIUS=n.toFixed(11),this.defines.RADIUS_SQ=(n*n).toFixed(11),this.needsUpdate=!0}get radius(){return this.r}set radius(n){this.r=Math.min(Math.max(n,1e-6),1),this.updateRadius()}getRadius(){return this.radius}setRadius(n){this.radius=n}get distanceScaling(){return!0}set distanceScaling(n){}isDistanceScalingEnabled(){return this.distanceScaling}setDistanceScalingEnabled(n){this.distanceScaling=n}get distanceThreshold(){return this.uniforms.distanceCutoff.value.x}set distanceThreshold(n){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+this.distanceFalloff,0),1))}get worldDistanceThreshold(){return-yA(this.distanceThreshold,this.near,this.far)}set worldDistanceThreshold(n){this.distanceThreshold=zh(-n,this.near,this.far)}get distanceFalloff(){return this.uniforms.distanceCutoff.value.y-this.distanceThreshold}set distanceFalloff(n){this.uniforms.distanceCutoff.value.y=Math.min(Math.max(this.distanceThreshold+n,0),1)}get worldDistanceFalloff(){return-yA(this.distanceFalloff,this.near,this.far)}set worldDistanceFalloff(n){this.distanceFalloff=zh(-n,this.near,this.far)}setDistanceCutoff(n,e){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+e,0),1))}get proximityThreshold(){return this.uniforms.proximityCutoff.value.x}set proximityThreshold(n){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+this.proximityFalloff,0),1))}get worldProximityThreshold(){return-yA(this.proximityThreshold,this.near,this.far)}set worldProximityThreshold(n){this.proximityThreshold=zh(-n,this.near,this.far)}get proximityFalloff(){return this.uniforms.proximityCutoff.value.y-this.proximityThreshold}set proximityFalloff(n){this.uniforms.proximityCutoff.value.y=Math.min(Math.max(this.proximityThreshold+n,0),1)}get worldProximityFalloff(){return-yA(this.proximityFalloff,this.near,this.far)}set worldProximityFalloff(n){this.proximityFalloff=zh(-n,this.near,this.far)}setProximityCutoff(n,e){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+e,0),1))}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNearFar.value.set(n.near,n.far),this.uniforms.projectionMatrix.value.copy(n.projectionMatrix),this.uniforms.inverseProjectionMatrix.value.copy(n.projectionMatrix).invert(),n instanceof zn?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const t=this.uniforms,i=t.noiseTexture.value;i!==null&&t.noiseScale.value.set(n/i.image.width,e/i.image.height),t.texelSize.value.set(1/n,1/e),this.resolution.set(n,e),this.updateRadius()}},Wpe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <encodings_fragment>
}`,Fpe="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",_pe=class extends Nt{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new ye(null),supportBuffer:new ye(null),texelSize:new ye(new pe),radius:new ye(.85)},blending:ei,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Wpe,vertexShader:Fpe})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}set supportBuffer(n){this.uniforms.supportBuffer.value=n}get radius(){return this.uniforms.radius.value}set radius(n){this.uniforms.radius.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},Vpe=new _C,xu=null;function Tpe(){if(xu===null){const n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]);xu=new Et,xu.setAttribute!==void 0?(xu.setAttribute("position",new Pt(n,3)),xu.setAttribute("uv",new Pt(e,2))):(xu.addAttribute("position",new Pt(n,3)),xu.addAttribute("uv",new Pt(e,2)))}return xu}var _i=class{constructor(n="Pass",e=new Cd,t=Vpe){this.name=n,this.renderer=null,this.scene=e,this.camera=t,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(n){if(this.rtt===n){const e=this.fullscreenMaterial;e!==null&&(e.needsUpdate=!0),this.rtt=!n}}set mainScene(n){}set mainCamera(n){}setRenderer(n){this.renderer=n}isEnabled(){return this.enabled}setEnabled(n){this.enabled=n}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(n){let e=this.screen;e!==null?e.material=n:(e=new Rn(Tpe(),n),e.frustumCulled=!1,this.scene===null&&(this.scene=new Cd),this.scene.add(e),this.screen=e)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(n){this.fullscreenMaterial=n}getDepthTexture(){return null}setDepthTexture(n,e=pr){}render(n,e,t,i,r){throw new Error("Render method not implemented!")}setSize(n,e){}initialize(n,e,t){}dispose(){for(const n of Object.keys(this)){const e=this[n];(e instanceof Qt||e instanceof ai||e instanceof Pn||e instanceof _i)&&this[n].dispose()}}},Zj=class extends _i{constructor(n,e=!0){super("CopyPass"),this.fullscreenMaterial=new Sj,this.needsSwap=!1,this.renderTarget=n,n===void 0&&(this.renderTarget=new Qt(1,1,{minFilter:ut,magFilter:ut,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(n){this.autoResize=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(n){this.autoResize=n}render(n,e,t,i,r){this.fullscreenMaterial.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){this.autoResize&&this.renderTarget.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==Dn?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":Pg(n)===Gn&&er(this.renderTarget.texture,Gn))}},Npe=class extends _i{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(n,e,t,i,r){const s=n.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},bz=new Ke,Ev=class extends _i{constructor(n=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=n,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(n,e,t){this.color=n,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(n){this.overrideClearColor=n}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(n){this.overrideClearAlpha=n}render(n,e,t,i,r){const s=this.overrideClearColor,o=this.overrideClearAlpha,a=n.getClearAlpha(),l=s!==null,c=o>=0;l?(n.getClearColor(bz),n.setClearColor(s,c?o:a)):c&&n.setClearAlpha(o),n.setRenderTarget(this.renderToScreen?null:e),n.clear(this.color,this.depth,this.stencil),l?n.setClearColor(bz,a):c&&n.setClearAlpha(a)}},Su=-1,wn=class extends aa{constructor(n,e=Su,t=Su,i=1){super(),this.resizable=n,this.baseSize=new pe(1,1),this.preferredSize=new pe(e,t),this.target=this.preferredSize,this.s=i,this.effectiveSize=new pe,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const n=this.baseSize,e=this.preferredSize,t=this.effectiveSize,i=this.scale;e.width!==Su?t.width=e.width:e.height!==Su?t.width=Math.round(e.height*(n.width/Math.max(n.height,1))):t.width=Math.round(n.width*i),e.height!==Su?t.height=e.height:e.width!==Su?t.height=Math.round(e.width/Math.max(n.width/Math.max(n.height,1),1)):t.height=Math.round(n.height*i)}get width(){return this.effectiveSize.width}set width(n){this.preferredWidth=n}get height(){return this.effectiveSize.height}set height(n){this.preferredHeight=n}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(n){this.s!==n&&(this.s=n,this.preferredSize.setScalar(Su),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(n){this.scale=n}get baseWidth(){return this.baseSize.width}set baseWidth(n){this.baseSize.width!==n&&(this.baseSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(n){this.baseWidth=n}get baseHeight(){return this.baseSize.height}set baseHeight(n){this.baseSize.height!==n&&(this.baseSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(n){this.baseHeight=n}setBaseSize(n,e){(this.baseSize.width!==n||this.baseSize.height!==e)&&(this.baseSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(n){this.preferredSize.width!==n&&(this.preferredSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(n){this.preferredWidth=n}get preferredHeight(){return this.preferredSize.height}set preferredHeight(n){this.preferredSize.height!==n&&(this.preferredSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(n){this.preferredHeight=n}setPreferredSize(n,e){(this.preferredSize.width!==n||this.preferredSize.height!==e)&&(this.preferredSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(n){this.s=n.scale,this.baseSize.set(n.baseWidth,n.baseHeight),this.preferredSize.set(n.preferredWidth,n.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return Su}},IZ=!1,Bz=class{constructor(n=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case Di:t=this.materialsFlatShadedDoubleSide;break;case Bi:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case Di:t=this.materialsDoubleSide;break;case Bi:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(n){if(!(n instanceof Nt))return n.clone();const e=n.uniforms,t=new Map;for(const r in e){const s=e[r].value;s.isRenderTargetTexture&&(e[r].value=null,t.set(r,s))}const i=n.clone();for(const r of t)e[r[0]].value=r[1],i.uniforms[r[0]].value=r[1];return i}setMaterial(n){if(this.disposeMaterials(),this.material=n,n!==null){const e=this.materials=[this.cloneMaterial(n),this.cloneMaterial(n),this.cloneMaterial(n)];for(const t of e)t.uniforms=Object.assign({},n.uniforms),t.side=wo;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},n.uniforms),i.side=Bi,i}),this.materialsDoubleSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},n.uniforms),i.side=Di,i}),this.materialsFlatShaded=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},n.uniforms),i.flatShading=!0,i}),this.materialsFlatShadedBackSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},n.uniforms),i.flatShading=!0,i.side=Bi,i}),this.materialsFlatShadedDoubleSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},n.uniforms),i.flatShading=!0,i.side=Di,i})}}render(n,e,t){const i=n.shadowMap.enabled;if(n.shadowMap.enabled=!1,IZ){const r=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),n.render(e,t);for(const s of r)s[0].material=s[1];this.meshCount!==r.size&&r.clear()}else{const r=e.overrideMaterial;e.overrideMaterial=this.material,n.render(e,t),e.overrideMaterial=r}n.shadowMap.enabled=i}disposeMaterials(){if(this.material!==null){const n=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of n)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return IZ}static set workaroundEnabled(n){IZ=n}},PC=class extends _i{constructor(n,e,t=null){super("RenderPass",n,e),this.needsSwap=!1,this.clearPass=new Ev,this.overrideMaterialManager=t===null?null:new Bz(t),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get renderToScreen(){return super.renderToScreen}set renderToScreen(n){super.renderToScreen=n,this.clearPass.renderToScreen=n}get overrideMaterial(){const n=this.overrideMaterialManager;return n!==null?n.material:null}set overrideMaterial(n){const e=this.overrideMaterialManager;n!==null?e!==null?e.setMaterial(n):this.overrideMaterialManager=new Bz(n):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(n){this.overrideMaterial=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getSelection(){return this.selection}setSelection(n){this.selection=n}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(n){this.skipShadowMapUpdate=n}getClearPass(){return this.clearPass}render(n,e,t,i,r){const s=this.scene,o=this.camera,a=this.selection,l=o.layers.mask,c=s.background,g=n.shadowMap.autoUpdate,u=this.renderToScreen?null:e;a!==null&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(n.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(n,e),n.setRenderTarget(u),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(n,s,o):n.render(s,o),o.layers.mask=l,s.background=c,n.shadowMap.autoUpdate=g}},OV=class extends _i{constructor(n,e,{renderTarget:t,resolutionScale:i=1,width:r=wn.AUTO_SIZE,height:s=wn.AUTO_SIZE,resolutionX:o=r,resolutionY:a=s}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new PC(n,e,new ov({depthPacking:Sl}));const l=this.renderPass;l.skipShadowMapUpdate=!0,l.ignoreBackground=!0;const c=l.getClearPass();c.overrideClearColor=new Ke(16777215),c.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new Qt(1,1,{minFilter:Zt,magFilter:Zt}),this.renderTarget.texture.name="DepthPass.Target");const g=this.resolution=new wn(this,o,a,i);g.addEventListener("change",u=>this.setSize(g.baseWidth,g.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,i,r){const s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,s)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}},Mj=class extends _i{constructor({normalBuffer:n=null,resolutionScale:e=.5,width:t=wn.AUTO_SIZE,height:i=wn.AUTO_SIZE,resolutionX:r=t,resolutionY:s=i}={}){super("DepthDownsamplingPass");const o=new dpe;o.normalBuffer=n,this.fullscreenMaterial=o,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new Qt(1,1,{minFilter:Zt,magFilter:Zt,depthBuffer:!1,type:Hn}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const a=this.resolution=new wn(this,r,s,e);a.addEventListener("change",l=>this.setSize(a.baseWidth,a.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(n,e=pr){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e}render(n,e,t,i,r){n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height),this.fullscreenMaterial.setSize(n,e)}initialize(n,e,t){const i=n.getContext();if(!(i.getExtension("EXT_color_buffer_float")||i.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},kpe=class extends _i{constructor({depthPacking:n=Sl}={}){super("DepthCopyPass");const e=new cpe;e.outputDepthPacking=n,this.fullscreenMaterial=e,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new Qt(1,1,{type:n===Sl?Dn:Hn,minFilter:Zt,magFilter:Zt,depthBuffer:!1}),this.renderTarget.texture.name="DepthCopyPass.Target"}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get depthPacking(){return this.fullscreenMaterial.outputDepthPacking}getDepthPacking(){return this.fullscreenMaterial.outputDepthPacking}setDepthTexture(n,e=pr){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.inputDepthPacking=e}render(n,e,t,i,r){n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){this.renderTarget.setSize(n,e)}},iG=new Float32Array([255/256/256**3,255/256/256**2,255/256/256,255/256]);function Lpe(n){return(n[0]*iG[0]+n[1]*iG[1]+n[2]*iG[2]+n[3]*iG[3])/255}var Hpe=class extends kpe{constructor({depthPacking:n=Sl,mode:e=r0.SINGLE}={}){super({depthPacking:n}),this.name="DepthPickingPass",this.fullscreenMaterial.mode=e,this.pixelBuffer=n===Sl?new Uint8Array(4):new Float32Array(4),this.callback=null}readDepth(n){return this.fullscreenMaterial.texelPosition.set(n.x*.5+.5,n.y*.5+.5),new Promise(e=>{this.callback=e})}render(n,e,t,i,r){const s=this.fullscreenMaterial,o=s.mode;if(o===r0.FULL&&super.render(n),this.callback!==null){const a=this.renderTarget,l=this.pixelBuffer,c=a.texture.type!==Hn;let g=0,u=0;if(o===r0.SINGLE)super.render(n);else{const d=s.texelPosition;g=Math.round(d.x*a.width),u=Math.round(d.y*a.height)}n.readRenderTargetPixels(a,g,u,1,1,l),this.callback(c?Lpe(l):l[0]),this.callback=null}}setSize(n,e){this.fullscreenMaterial.mode===r0.FULL&&super.setSize(n,e)}};function Gz(n,e,t){for(const i of e){const r="$1"+n+i.charAt(0).toUpperCase()+i.slice(1),s=new RegExp("([^\\.])(\\b"+i+"\\b)","g");for(const o of t.entries())o[1]!==null&&t.set(o[0],o[1].replace(s,r))}}function zpe(n,e,t){let i=e.getFragmentShader(),r=e.getVertexShader();const s=i!==void 0&&/mainImage/.test(i),o=i!==void 0&&/mainUv/.test(i);if(t.attributes|=e.getAttributes(),i===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(o&&t.attributes&ka.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!s&&!o)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,l=t.shaderParts;let c=l.get(fn.FRAGMENT_HEAD)||"",g=l.get(fn.FRAGMENT_MAIN_UV)||"",u=l.get(fn.FRAGMENT_MAIN_IMAGE)||"",d=l.get(fn.VERTEX_HEAD)||"",h=l.get(fn.VERTEX_MAIN_SUPPORT)||"";const f=new Set,I=new Set;if(o&&(g+=`	${n}MainUv(UV);
`,t.uvTransformation=!0),r!==null&&/mainSupport/.test(r)){const y=/mainSupport *\([\w\s]*?uv\s*?\)/.test(r);h+=`	${n}MainSupport(`,h+=y?`vUv);
`:`);
`;for(const v of r.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const b of v[1].split(/\s*,\s*/))t.varyings.add(b),f.add(b),I.add(b);for(const v of r.matchAll(a))I.add(v[1])}for(const y of i.matchAll(a))I.add(y[1]);for(const y of e.defines.keys())I.add(y.replace(/\([\w\s,]*\)/g,""));for(const y of e.uniforms.keys())I.add(y);I.delete("while"),I.delete("for"),I.delete("if"),e.uniforms.forEach((y,v)=>t.uniforms.set(n+v.charAt(0).toUpperCase()+v.slice(1),y)),e.defines.forEach((y,v)=>t.defines.set(n+v.charAt(0).toUpperCase()+v.slice(1),y));const A=new Map([["fragment",i],["vertex",r]]);Gz(n,I,t.defines),Gz(n,I,A),i=A.get("fragment"),r=A.get("vertex");const p=e.blendMode;if(t.blendModes.set(p.blendFunction,p),s){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(u+=e.inputColorSpace===Gn?`color0 = LinearTosRGB(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==wj?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const y=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;u+=`${n}MainImage(color0, UV, `,t.attributes&ka.DEPTH&&y.test(i)&&(u+="depth, ",t.readDepth=!0),u+=`color1);
	`;const v=n+"BlendOpacity";t.uniforms.set(v,p.opacity),u+=`color0 = blend${p.blendFunction}(color0, color1, ${v});

	`,c+=`uniform float ${v};

`}if(c+=i+`
`,r!==null&&(d+=r+`
`),l.set(fn.FRAGMENT_HEAD,c),l.set(fn.FRAGMENT_MAIN_UV,g),l.set(fn.FRAGMENT_MAIN_IMAGE,u),l.set(fn.VERTEX_HEAD,d),l.set(fn.VERTEX_MAIN_SUPPORT,h),e.extensions!==null)for(const y of e.extensions)t.extensions.add(y)}}var Xpe=class extends _i{constructor(n,...e){super("EffectPass"),this.fullscreenMaterial=new mpe(null,null,null,n),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(n){for(const e of this.effects)e.mainScene=n}set mainCamera(n){this.fullscreenMaterial.copyCameraSettings(n);for(const e of this.effects)e.mainCamera=n}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(n){this.fullscreenMaterial.encodeOutput=n}get dithering(){return this.fullscreenMaterial.dithering}set dithering(n){const e=this.fullscreenMaterial;e.dithering=n,e.needsUpdate=!0}setEffects(n){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=n.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const n=new Jpe;let e=0;for(const o of this.effects)if(o.blendMode.blendFunction===Rt.DST)n.attributes|=o.getAttributes()&ka.DEPTH;else{if(n.attributes&o.getAttributes()&ka.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${o.name})`);zpe("e"+e++,o,n)}let t=n.shaderParts.get(fn.FRAGMENT_HEAD),i=n.shaderParts.get(fn.FRAGMENT_MAIN_IMAGE),r=n.shaderParts.get(fn.FRAGMENT_MAIN_UV);const s=/\bblend\b/g;for(const o of n.blendModes.values())t+=o.getShaderCode().replace(s,`blend${o.blendFunction}`)+`
`;n.attributes&ka.DEPTH?(n.readDepth&&(i=`float depth = readDepth(UV);

	`+i),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,n.colorSpace===Gn&&(i+=`color0 = sRGBToLinear(color0);
	`),n.uvTransformation?(r=`vec2 transformedUv = vUv;
`+r,n.defines.set("UV","transformedUv")):n.defines.set("UV","vUv"),n.shaderParts.set(fn.FRAGMENT_HEAD,t),n.shaderParts.set(fn.FRAGMENT_MAIN_IMAGE,i),n.shaderParts.set(fn.FRAGMENT_MAIN_UV,r);for(const[o,a]of n.shaderParts)a!==null&&n.shaderParts.set(o,a.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(n)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(n,e=pr){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(n,e)}render(n,e,t,i,r){for(const s of this.effects)s.update(n,e,i);if(!this.skipRendering||this.renderToScreen){const s=this.fullscreenMaterial;s.inputBuffer=e.texture,s.time+=i*this.timeScale,n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}}setSize(n,e){this.fullscreenMaterial.setSize(n,e);for(const t of this.effects)t.setSize(n,e)}initialize(n,e,t){this.renderer=n;for(const i of this.effects)i.initialize(n,e,t);this.updateMaterial(),t!==void 0&&t!==Dn&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const n of this.effects)n.removeEventListener("change",this.listener),n.dispose()}handleEvent(n){switch(n.type){case"change":this.recompile();break}}},ix=class extends _i{constructor({kernelSize:n=DC.MEDIUM,resolutionScale:e=.5,width:t=wn.AUTO_SIZE,height:i=wn.AUTO_SIZE,resolutionX:r=t,resolutionY:s=i}={}){super("KawaseBlurPass"),this.renderTargetA=new Qt(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const o=this.resolution=new wn(this,r,s,e);o.addEventListener("change",a=>this.setSize(o.baseWidth,o.baseHeight)),this._blurMaterial=new npe,this._blurMaterial.kernelSize=n,this.copyMaterial=new Sj}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(n){this._blurMaterial=n}get dithering(){return this.copyMaterial.dithering}set dithering(n){this.copyMaterial.dithering=n}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(n){this.blurMaterial.kernelSize=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get scale(){return this.blurMaterial.scale}set scale(n){this.blurMaterial.scale=n}getScale(){return this.blurMaterial.scale}setScale(n){this.blurMaterial.scale=n}getKernelSize(){return this.kernelSize}setKernelSize(n){this.kernelSize=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,i,r){const s=this.scene,o=this.camera,a=this.renderTargetA,l=this.renderTargetB,c=this.blurMaterial,g=c.kernelSequence;let u=e;this.fullscreenMaterial=c;for(let d=0,h=g.length;d<h;++d){const f=d&1?l:a;c.kernel=g[d],c.inputBuffer=u.texture,n.setRenderTarget(f),n.render(s,o),u=f}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=u.texture,n.setRenderTarget(this.renderToScreen?null:t),n.render(s,o)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e);const i=t.width,r=t.height;this.renderTargetA.setSize(i,r),this.renderTargetB.setSize(i,r),this.blurMaterial.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTargetA.texture.type=t,this.renderTargetB.texture.type=t,t!==Dn?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):Pg(n)===Gn&&(er(this.renderTargetA.texture,Gn),er(this.renderTargetB.texture,Gn)))}static get AUTO_SIZE(){return wn.AUTO_SIZE}},Ype=class extends _i{constructor({renderTarget:n,luminanceRange:e,colorOutput:t,resolutionScale:i=1,width:r=wn.AUTO_SIZE,height:s=wn.AUTO_SIZE,resolutionX:o=r,resolutionY:a=s}={}){super("LuminancePass"),this.fullscreenMaterial=new Bpe(t,e),this.needsSwap=!1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new Qt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const l=this.resolution=new wn(this,o,a,i);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(n,e,t,i,r){const s=this.fullscreenMaterial;s.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}initialize(n,e,t){t!==void 0&&t!==Dn&&(this.renderTarget.texture.type=t,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Kpe=class extends _i{constructor(n,e){super("MaskPass",n,e),this.needsSwap=!1,this.clearPass=new Ev(!1,!1,!0),this.inverse=!1}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get inverted(){return this.inverse}set inverted(n){this.inverse=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(n){this.inverted=n}render(n,e,t,i,r){const s=n.getContext(),o=n.state.buffers,a=this.scene,l=this.camera,c=this.clearPass,g=this.inverted?0:1,u=1-g;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),o.stencil.setFunc(s.ALWAYS,g,4294967295),o.stencil.setClear(u),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(n,null):(c.render(n,e),c.render(n,t))),this.renderToScreen?(n.setRenderTarget(null),n.render(a,l)):(n.setRenderTarget(e),n.render(a,l),n.setRenderTarget(t),n.render(a,l)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(s.EQUAL,1,4294967295),o.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),o.stencil.setLocked(!0)}},Dpe=class extends _i{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new Qt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new Ape,this.upsamplingMaterial=new _pe,this.resolution=new pe}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(n){if(this.levels!==n){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let t=0;t<n;++t){const i=e.clone();i.texture.name="Downsampling.Mipmap"+t,this.downsamplingMipmaps.push(i)}this.upsamplingMipmaps.push(e);for(let t=1,i=n-1;t<i;++t){const r=e.clone();r.texture.name="Upsampling.Mipmap"+t,this.upsamplingMipmaps.push(r)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(n){this.upsamplingMaterial.radius=n}render(n,e,t,i,r){const{scene:s,camera:o}=this,{downsamplingMaterial:a,upsamplingMaterial:l}=this,{downsamplingMipmaps:c,upsamplingMipmaps:g}=this;let u=e;this.fullscreenMaterial=a;for(let d=0,h=c.length;d<h;++d){const f=c[d];a.setSize(u.width,u.height),a.inputBuffer=u.texture,n.setRenderTarget(f),n.render(s,o),u=f}this.fullscreenMaterial=l;for(let d=g.length-1;d>=0;--d){const h=g[d];l.setSize(u.width,u.height),l.inputBuffer=u.texture,l.supportBuffer=c[d].texture,n.setRenderTarget(h),n.render(s,o),u=h}}setSize(n,e){const t=this.resolution;t.set(n,e);let i=t.width,r=t.height;for(let s=0,o=this.downsamplingMipmaps.length;s<o;++s)i=Math.round(i*.5),r=Math.round(r*.5),this.downsamplingMipmaps[s].setSize(i,r),s<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[s].setSize(i,r)}initialize(n,e,t){if(t!==void 0){const i=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const r of i)r.texture.type=t;if(t!==Dn)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(Pg(n)===Gn)for(const r of i)er(r.texture,Gn)}}dispose(){super.dispose();for(const n of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))n.dispose()}},Ppe=class extends _i{constructor(n,e,{renderTarget:t,resolutionScale:i=1,width:r=wn.AUTO_SIZE,height:s=wn.AUTO_SIZE,resolutionX:o=r,resolutionY:a=s}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new PC(n,e,new iV);const l=this.renderPass;l.ignoreBackground=!0,l.skipShadowMapUpdate=!0;const c=l.getClearPass();c.overrideClearColor=new Ke(7829503),c.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new Qt(1,1,{minFilter:Zt,magFilter:Zt}),this.renderTarget.texture.name="NormalPass.Target");const g=this.resolution=new wn(this,o,a,i);g.addEventListener("change",u=>this.setSize(g.baseWidth,g.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,i,r){const s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,s,s)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}},pl=class extends _i{constructor(n,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=n,this.input=e}setInput(n){this.input=n}render(n,e,t,i,r){const s=this.fullscreenMaterial.uniforms;e!==null&&s!==void 0&&s[this.input]!==void 0&&(s[this.input].value=e.texture),n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}initialize(n,e,t){t!==void 0&&t!==Dn&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},AZ=1/1e3,Upe=1e3,Qpe=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(n){typeof document<"u"&&document.hidden!==void 0&&(n?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=n)}get delta(){return this._delta*AZ}get fixedDelta(){return this._fixedDelta*AZ}set fixedDelta(n){this._fixedDelta=n*Upe}get elapsed(){return this._elapsed*AZ}update(n){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(n!==void 0?n:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}handleEvent(n){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},Ope=class{constructor(e=null,{depthBuffer:t=!0,stencilBuffer:i=!1,multisampling:r=0,frameBufferType:s}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,i,s,r),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new Zj,this.depthTexture=null,this.passes=[],this.timer=new Qpe,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const t=this.inputBuffer,i=this.multisampling;i>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,e!==null){const t=e.getSize(new pe),i=e.getContext().getContextAttributes().alpha,r=this.inputBuffer.texture.type;r===Dn&&Pg(e)===Gn&&(er(this.inputBuffer.texture,Gn),er(this.outputBuffer.texture,Gn),this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(t.width,t.height);for(const s of this.passes)s.initialize(e,i,r)}}replaceRenderer(e,t=!0){const i=this.renderer,r=i.domElement.parentNode;return this.setRenderer(e),t&&r!==null&&(r.removeChild(i.domElement),r.appendChild(e.domElement)),i}createDepthTexture(){const e=this.depthTexture=new av;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=Ad,e.type=sd):e.type=Sg,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,i,r){const s=this.renderer,o=s===null?new pe:s.getDrawingBufferSize(new pe),a={minFilter:ut,magFilter:ut,stencilBuffer:t,depthBuffer:e,type:i},l=new Qt(o.width,o.height,a);return r>0&&(l.ignoreDepthForMultisampleCopy=!1,l.samples=r),i===Dn&&Pg(s)===Gn&&er(l.texture,Gn),l.texture.name="EffectComposer.Buffer",l.texture.generateMipmaps=!1,l}setMainScene(e){for(const t of this.passes)t.mainScene=e}setMainCamera(e){for(const t of this.passes)t.mainCamera=e}addPass(e,t){const i=this.passes,r=this.renderer,s=r.getDrawingBufferSize(new pe),o=r.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(e.setRenderer(r),e.setSize(s.width,s.height),e.initialize(r,o,a),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?i.splice(t,0,e):i.push(e),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const l=this.createDepthTexture();for(e of i)e.setDepthTexture(l)}else e.setDepthTexture(this.depthTexture)}removePass(e){const t=this.passes,i=t.indexOf(e);if(i!==-1&&t.splice(i,1).length>0){if(this.depthTexture!==null){const o=(l,c)=>l||c.needsDepthTexture;t.reduce(o,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&i===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const t=this.renderer,i=this.copyPass;let r=this.inputBuffer,s=this.outputBuffer,o=!1,a,l,c;e===void 0&&(this.timer.update(),e=this.timer.delta);for(const g of this.passes)g.enabled&&(g.render(t,r,s,e,o),g.needsSwap&&(o&&(i.renderToScreen=g.renderToScreen,a=t.getContext(),l=t.state.buffers.stencil,l.setFunc(a.NOTEQUAL,1,4294967295),i.render(t,r,s,e,o),l.setFunc(a.EQUAL,1,4294967295)),c=r,r=s,s=c),g instanceof Kpe?o=!0:g instanceof Npe&&(o=!1))}setSize(e,t,i){const r=this.renderer,s=r.getSize(new pe);(e===void 0||t===void 0)&&(e=s.width,t=s.height),(s.width!==e||s.height!==t)&&r.setSize(e,t,i);const o=r.getDrawingBufferSize(new pe);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const a of this.passes)a.setSize(o.width,o.height)}reset(){const e=this.timer.autoReset;this.dispose(),this.autoRenderToScreen=!0,this.timer.autoReset=e}dispose(){for(const e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},Jpe=class{constructor(){this.shaderParts=new Map([[fn.FRAGMENT_HEAD,null],[fn.FRAGMENT_MAIN_UV,null],[fn.FRAGMENT_MAIN_IMAGE,null],[fn.VERTEX_HEAD,null],[fn.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=ka.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=fC}},JV=class extends Set{constructor(n,e=10){super(),this.l=e,this.exclusive=!1,n!==void 0&&this.set(n)}get layer(){return this.l}set layer(n){const e=this.l;for(const t of this)t.layers.disable(e),t.layers.enable(n);this.l=n}getLayer(){return this.layer}setLayer(n){this.layer=n}isExclusive(){return this.exclusive}setExclusive(n){this.exclusive=n}clear(){const n=this.layer;for(const e of this)e.layers.disable(n);return super.clear()}set(n){this.clear();for(const e of n)this.add(e);return this}indexOf(n){return this.has(n)?0:-1}add(n){return this.exclusive?n.layers.set(this.layer):n.layers.enable(this.layer),super.add(n)}delete(n){return this.has(n)&&n.layers.disable(this.layer),super.delete(n)}toggle(n){let e;return this.has(n)?(this.delete(n),e=!1):(this.add(n),e=!0),e}setVisible(n){for(const e of this)n?e.layers.enable(0):e.layers.disable(0);return this}},jpe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",qpe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",$pe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",eme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",tme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",nme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",ime="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",rme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",sme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",ome="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",ame="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",lme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",cme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",gme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",ume="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",dme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",hme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",fme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",Ime="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",Ame="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Cme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",pme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",mme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",yme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",vme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",bme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",Bme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Gme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",wme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",xme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",Sme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",Rme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",Zme=new Map([[Rt.ADD,jpe],[Rt.ALPHA,qpe],[Rt.AVERAGE,$pe],[Rt.COLOR,eme],[Rt.COLOR_BURN,tme],[Rt.COLOR_DODGE,nme],[Rt.DARKEN,ime],[Rt.DIFFERENCE,rme],[Rt.DIVIDE,sme],[Rt.DST,null],[Rt.EXCLUSION,ome],[Rt.HARD_LIGHT,ame],[Rt.HARD_MIX,lme],[Rt.HUE,cme],[Rt.INVERT,gme],[Rt.INVERT_RGB,ume],[Rt.LIGHTEN,dme],[Rt.LINEAR_BURN,hme],[Rt.LINEAR_DODGE,fme],[Rt.LINEAR_LIGHT,Ime],[Rt.LUMINOSITY,Ame],[Rt.MULTIPLY,Cme],[Rt.NEGATION,pme],[Rt.NORMAL,mme],[Rt.OVERLAY,yme],[Rt.PIN_LIGHT,vme],[Rt.REFLECT,bme],[Rt.SATURATION,Bme],[Rt.SCREEN,Gme],[Rt.SOFT_LIGHT,wme],[Rt.SRC,xme],[Rt.SUBTRACT,Sme],[Rt.VIVID_LIGHT,Rme]]),Mme=class extends aa{constructor(n,e=1){super(),this._blendFunction=n,this.opacity=new ye(e)}getOpacity(){return this.opacity.value}setOpacity(n){this.opacity.value=n}get blendFunction(){return this._blendFunction}set blendFunction(n){this._blendFunction=n,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(n){this.blendFunction=n}getShaderCode(){return Zme.get(this.blendFunction)}},Wr=class extends aa{constructor(n,e,{attributes:t=ka.NONE,blendFunction:i=Rt.NORMAL,defines:r=new Map,uniforms:s=new Map,extensions:o=null,vertexShader:a=null}={}){super(),this.name=n,this.renderer=null,this.attributes=t,this.fragmentShader=e,this.vertexShader=a,this.defines=r,this.uniforms=s,this.extensions=o,this.blendMode=new Mme(i),this.blendMode.addEventListener("change",l=>this.setChanged()),this._inputColorSpace=fC,this._outputColorSpace=wj}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(n){this._inputColorSpace=n,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(n){this._outputColorSpace=n,this.setChanged()}set mainScene(n){}set mainCamera(n){}getName(){return this.name}setRenderer(n){this.renderer=n}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(n){this.attributes=n,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(n){this.fragmentShader=n,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(n){this.vertexShader=n,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(n,e=pr){}update(n,e,t){}setSize(n,e){}initialize(n,e,t){}dispose(){for(const n of Object.keys(this)){const e=this[n];(e instanceof Qt||e instanceof ai||e instanceof Pn||e instanceof _i)&&this[n].dispose()}}},Eme=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=texture2D(map,uv)*intensity;}`,Wme=class extends Wr{constructor({blendFunction:n=Rt.SCREEN,luminanceThreshold:e=.9,luminanceSmoothing:t=.025,mipmapBlur:i=!1,intensity:r=1,radius:s=.85,levels:o=8,kernelSize:a=DC.LARGE,resolutionScale:l=.5,width:c=wn.AUTO_SIZE,height:g=wn.AUTO_SIZE,resolutionX:u=c,resolutionY:d=g}={}){super("BloomEffect",Eme,{blendFunction:n,uniforms:new Map([["map",new ye(null)],["intensity",new ye(r)]])}),this.renderTarget=new Qt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new ix({kernelSize:a}),this.luminancePass=new Ype({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=t,this.mipmapBlurPass=new Dpe,this.mipmapBlurPass.enabled=i,this.mipmapBlurPass.radius=s,this.mipmapBlurPass.levels=o,this.uniforms.get("map").value=i?this.mipmapBlurPass.texture:this.renderTarget.texture;const h=this.resolution=new wn(this,u,d,l);h.addEventListener("change",f=>this.setSize(h.baseWidth,h.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(n){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getIntensity(){return this.intensity}setIntensity(n){this.intensity=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}update(n,e,t){const i=this.renderTarget,r=this.luminancePass;r.enabled?(r.render(n,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,r.renderTarget):this.blurPass.render(n,r.renderTarget,i)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,e):this.blurPass.render(n,e,i)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height),this.blurPass.resolution.copy(t),this.luminancePass.setSize(n,e),this.mipmapBlurPass.setSize(n,e)}initialize(n,e,t){this.blurPass.initialize(n,e,t),this.luminancePass.initialize(n,e,t),this.mipmapBlurPass.initialize(n,e,t),t!==void 0&&(this.renderTarget.texture.type=t,Pg(n)===Gn&&er(this.renderTarget.texture,Gn))}},Fme="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",_me=class extends Wr{constructor(n){super("ColorAverageEffect",Fme,{blendFunction:n})}},Vme=`#ifdef RADIAL_MODULATION
uniform float modulationOffset;
#endif
varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=inputColor.ra;vec2 ba=inputColor.ba;
#ifdef RADIAL_MODULATION
const vec2 center=vec2(0.5);float d=distance(uv,center)*2.0;d=max(d-modulationOffset,0.0);if(vActive>0.0&&d>0.0){ra=texture2D(inputBuffer,mix(uv,vUvR,d)).ra;ba=texture2D(inputBuffer,mix(uv,vUvB,d)).ba;}
#else
if(vActive>0.0){ra=texture2D(inputBuffer,vUvR).ra;ba=texture2D(inputBuffer,vUvB).ba;}
#endif
outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}`,Tme="uniform vec2 offset;varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vActive=(shift.x!=0.0||shift.y!=0.0)?1.0:0.0;vUvR=uv+shift;vUvB=uv-shift;}",Nme=class extends Wr{constructor({offset:n=new pe(.001,5e-4),radialModulation:e=!1,modulationOffset:t=.15}={}){super("ChromaticAberrationEffect",Vme,{vertexShader:Tme,attributes:ka.CONVOLUTION,uniforms:new Map([["offset",new ye(n)],["modulationOffset",new ye(t)]])}),this.radialModulation=e}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}get radialModulation(){return this.defines.has("RADIAL_MODULATION")}set radialModulation(n){n?this.defines.set("RADIAL_MODULATION","1"):this.defines.delete("RADIAL_MODULATION"),this.setChanged()}get modulationOffset(){return this.uniforms.get("modulationOffset").value}set modulationOffset(n){this.uniforms.get("modulationOffset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}},kme=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float cocNear=texture2D(nearCoCBuffer,uv).r;cocNear=min(cocNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,cocNear);outputColor=result;}`,Lme=class extends Wr{constructor(n,{blendFunction:e,worldFocusDistance:t,worldFocusRange:i,focusDistance:r=0,focalLength:s=.1,focusRange:o=s,bokehScale:a=1,resolutionScale:l=1,width:c=wn.AUTO_SIZE,height:g=wn.AUTO_SIZE,resolutionX:u=c,resolutionY:d=g}={}){super("DepthOfFieldEffect",kme,{blendFunction:e,attributes:ka.DEPTH,uniforms:new Map([["nearColorBuffer",new ye(null)],["farColorBuffer",new ye(null)],["nearCoCBuffer",new ye(null)],["scale",new ye(1)]])}),this.camera=n,this.renderTarget=new Qt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new pl(new jCe(n));const h=this.cocMaterial;h.focusDistance=r,h.focusRange=o,t!==void 0&&(h.worldFocusDistance=t),i!==void 0&&(h.worldFocusRange=i),this.blurPass=new ix({resolutionScale:l,resolutionX:u,resolutionY:d,kernelSize:DC.MEDIUM}),this.maskPass=new pl(new wpe(this.renderTargetCoC.texture));const f=this.maskPass.fullscreenMaterial;f.maskFunction=T0.MULTIPLY,f.colorChannel=vA.GREEN,this.bokehNearBasePass=new pl(new nG(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new pl(new nG(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new pl(new nG(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new pl(new nG(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null;const I=this.resolution=new wn(this,u,d,l);I.addEventListener("change",A=>this.setSize(I.baseWidth,I.baseHeight)),this.bokehScale=a}set mainCamera(n){this.camera=n,this.cocMaterial.copyCameraSettings(n)}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}getResolution(){return this.resolution}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(n){this.bokehNearBasePass.fullscreenMaterial.scale=n,this.bokehNearFillPass.fullscreenMaterial.scale=n,this.bokehFarBasePass.fullscreenMaterial.scale=n,this.bokehFarFillPass.fullscreenMaterial.scale=n,this.maskPass.fullscreenMaterial.strength=n,this.uniforms.get("scale").value=n}getBokehScale(){return this.bokehScale}setBokehScale(n){this.bokehScale=n}getTarget(){return this.target}setTarget(n){this.target=n}calculateFocusDistance(n){const e=this.camera,t=e.position.distanceTo(n);return zh(-t,e.near,e.far)}setDepthTexture(n,e=pr){this.circleOfConfusionMaterial.depthBuffer=n,this.circleOfConfusionMaterial.depthPacking=e}update(n,e,t){const i=this.renderTarget,r=this.renderTargetCoC,s=this.renderTargetCoCBlurred,o=this.renderTargetMasked;if(this.target!==null){const a=this.calculateFocusDistance(this.target);this.cocMaterial.focusDistance=a}this.cocPass.render(n,null,r),this.blurPass.render(n,r,s),this.maskPass.render(n,e,o),this.bokehFarBasePass.render(n,o,i),this.bokehFarFillPass.render(n,i,this.renderTargetFar),this.bokehNearBasePass.render(n,e,i),this.bokehNearFillPass.render(n,i,this.renderTargetNear)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e);const i=t.width,r=t.height;this.cocPass.setSize(n,e),this.blurPass.setSize(n,e),this.maskPass.setSize(n,e),this.renderTargetCoC.setSize(n,e),this.renderTargetMasked.setSize(n,e),this.renderTarget.setSize(i,r),this.renderTargetNear.setSize(i,r),this.renderTargetFar.setSize(i,r),this.renderTargetCoCBlurred.setSize(i,r),this.bokehNearBasePass.fullscreenMaterial.setSize(n,e),this.bokehNearFillPass.fullscreenMaterial.setSize(n,e),this.bokehFarBasePass.fullscreenMaterial.setSize(n,e),this.bokehFarFillPass.fullscreenMaterial.setSize(n,e)}initialize(n,e,t){this.cocPass.initialize(n,e,t),this.maskPass.initialize(n,e,t),this.bokehNearBasePass.initialize(n,e,t),this.bokehNearFillPass.initialize(n,e,t),this.bokehFarBasePass.initialize(n,e,t),this.bokehFarFillPass.initialize(n,e,t),this.blurPass.initialize(n,e,Dn);const i=this.maskPass.fullscreenMaterial;i.maskFunction=e?T0.MULTIPLY:T0.MULTIPLY_RGB_SET_ALPHA,t!==void 0&&(this.renderTarget.texture.type=t,this.renderTargetNear.texture.type=t,this.renderTargetFar.texture.type=t,this.renderTargetMasked.texture.type=t,Pg(n)===Gn&&(er(this.renderTarget.texture,Gn),er(this.renderTargetNear.texture,Gn),er(this.renderTargetFar.texture,Gn),er(this.renderTargetMasked.texture,Gn)))}};function Hme(n,e,t){const i=new Map([[Sw,1],[Rw,1],[W_,2],[Yn,4]]);let r;if(i.has(e)||console.error("Invalid noise texture format"),t===Dn){r=new Uint8Array(n*i.get(e));for(let s=0,o=r.length;s<o;++s)r[s]=Math.random()*255+.5}else{r=new Float32Array(n*i.get(e));for(let s=0,o=r.length;s<o;++s)r[s]=Math.random()}return r}var rW=class extends pc{constructor(n,e,t=Sw,i=Dn){super(Hme(n*e,t,i),n,e,t,i),this.needsUpdate=!0}},zme="uniform lowp sampler2D perturbationMap;uniform bool active;uniform float columns;uniform float random;uniform vec2 seeds;uniform vec2 distortion;void mainUv(inout vec2 uv){if(active){if(uv.y<distortion.x+columns&&uv.y>distortion.x-columns*random){float sx=clamp(ceil(seeds.x),0.0,1.0);uv.y=sx*(1.0-(uv.y+distortion.y))+(1.0-sx)*distortion.y;}if(uv.x<distortion.y+columns&&uv.x>distortion.y-columns*random){float sy=clamp(ceil(seeds.y),0.0,1.0);uv.x=sy*distortion.x+(1.0-sy)*(1.0-(uv.x+distortion.x));}vec2 normal=texture2D(perturbationMap,uv*random*random).rg;uv+=normal*seeds*(random*0.2);}}",rG="Glitch.Generated";function $s(n,e){return n+Math.random()*(e-n)}var Xme=class extends Wr{constructor({chromaticAberrationOffset:n=null,delay:e=new pe(1.5,3.5),duration:t=new pe(.6,1),strength:i=new pe(.3,1),columns:r=.05,ratio:s=.85,perturbationMap:o=null,dtSize:a=64}={}){if(super("GlitchEffect",zme,{uniforms:new Map([["perturbationMap",new ye(null)],["columns",new ye(r)],["active",new ye(!1)],["random",new ye(1)],["seeds",new ye(new pe)],["distortion",new ye(new pe)]])}),o===null){const l=new rW(a,a,Yn);l.name=rG,this.perturbationMap=l}else this.perturbationMap=o;this.time=0,this.distortion=this.uniforms.get("distortion").value,this.delay=e,this.duration=t,this.breakPoint=new pe($s(this.delay.x,this.delay.y),$s(this.duration.x,this.duration.y)),this.strength=i,this.mode=Rh.SPORADIC,this.ratio=s,this.chromaticAberrationOffset=n}get seeds(){return this.uniforms.get("seeds").value}get active(){return this.uniforms.get("active").value}isActive(){return this.active}get minDelay(){return this.delay.x}set minDelay(n){this.delay.x=n}getMinDelay(){return this.delay.x}setMinDelay(n){this.delay.x=n}get maxDelay(){return this.delay.y}set maxDelay(n){this.delay.y=n}getMaxDelay(){return this.delay.y}setMaxDelay(n){this.delay.y=n}get minDuration(){return this.duration.x}set minDuration(n){this.duration.x=n}getMinDuration(){return this.duration.x}setMinDuration(n){this.duration.x=n}get maxDuration(){return this.duration.y}set maxDuration(n){this.duration.y=n}getMaxDuration(){return this.duration.y}setMaxDuration(n){this.duration.y=n}get minStrength(){return this.strength.x}set minStrength(n){this.strength.x=n}getMinStrength(){return this.strength.x}setMinStrength(n){this.strength.x=n}get maxStrength(){return this.strength.y}set maxStrength(n){this.strength.y=n}getMaxStrength(){return this.strength.y}setMaxStrength(n){this.strength.y=n}getMode(){return this.mode}setMode(n){this.mode=n}getGlitchRatio(){return 1-this.ratio}setGlitchRatio(n){this.ratio=Math.min(Math.max(1-n,0),1)}get columns(){return this.uniforms.get("columns").value}set columns(n){this.uniforms.get("columns").value=n}getGlitchColumns(){return this.columns}setGlitchColumns(n){this.columns=n}getChromaticAberrationOffset(){return this.chromaticAberrationOffset}setChromaticAberrationOffset(n){this.chromaticAberrationOffset=n}get perturbationMap(){return this.uniforms.get("perturbationMap").value}set perturbationMap(n){const e=this.perturbationMap;e!==null&&e.name===rG&&e.dispose(),n.minFilter=n.magFilter=Zt,n.wrapS=n.wrapT=ds,n.generateMipmaps=!1,this.uniforms.get("perturbationMap").value=n}getPerturbationMap(){return this.perturbationMap}setPerturbationMap(n){this.perturbationMap=n}generatePerturbationMap(n=64){const e=new rW(n,n,Yn);return e.name=rG,e}update(n,e,t){const i=this.mode,r=this.breakPoint,s=this.chromaticAberrationOffset,o=this.strength;let a=this.time,l=!1,c=0,g=0,u;i!==Rh.DISABLED&&(i===Rh.SPORADIC&&(a+=t,u=a>r.x,a>=r.x+r.y&&(r.set($s(this.delay.x,this.delay.y),$s(this.duration.x,this.duration.y)),a=0)),c=Math.random(),this.uniforms.get("random").value=c,u&&c>this.ratio||i===Rh.CONSTANT_WILD?(l=!0,c*=o.y*.03,g=$s(-Math.PI,Math.PI),this.seeds.set($s(-o.y,o.y),$s(-o.y,o.y)),this.distortion.set($s(0,1),$s(0,1))):(u||i===Rh.CONSTANT_MILD)&&(l=!0,c*=o.x*.03,g=$s(-Math.PI,Math.PI),this.seeds.set($s(-o.x,o.x),$s(-o.x,o.x)),this.distortion.set($s(0,1),$s(0,1))),this.time=a),s!==null&&(l?s.set(Math.cos(g),Math.sin(g)).multiplyScalar(c):s.set(0,0)),this.uniforms.get("active").value=l}dispose(){const n=this.perturbationMap;n!==null&&n.name===rG&&n.dispose()}},Yme=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=texture2D(map,uv);}`,CZ=new D,wz=new qe,Kme=class extends Wr{constructor(n,e,{blendFunction:t=Rt.SCREEN,samples:i=60,density:r=.96,decay:s=.9,weight:o=.4,exposure:a=.6,clampMax:l=1,blur:c=!0,kernelSize:g=DC.SMALL,resolutionScale:u=.5,width:d=wn.AUTO_SIZE,height:h=wn.AUTO_SIZE,resolutionX:f=d,resolutionY:I=h}={}){super("GodRaysEffect",Yme,{blendFunction:t,attributes:ka.DEPTH,uniforms:new Map([["map",new ye(null)]])}),this.camera=n,this._lightSource=e,this.lightSource=e,this.lightScene=new Cd,this.screenPosition=new pe,this.renderTargetA=new Qt(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="GodRays.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="GodRays.Target.B",this.uniforms.get("map").value=this.renderTargetB.texture,this.renderTargetLight=new Qt(1,1),this.renderTargetLight.texture.name="GodRays.Light",this.renderTargetLight.depthTexture=new av,this.renderPassLight=new PC(this.lightScene,n),this.renderPassLight.clearPass.overrideClearColor=new Ke(0),this.clearPass=new Ev(!0,!1,!1),this.clearPass.overrideClearColor=new Ke(0),this.blurPass=new ix({kernelSize:g}),this.blurPass.enabled=c,this.depthMaskPass=new pl(new Rj);const A=this.depthMaskMaterial;A.depthBuffer1=this.renderTargetLight.depthTexture,A.copyCameraSettings(n),this.godRaysPass=new pl(new vpe(this.screenPosition));const p=this.godRaysMaterial;p.density=r,p.decay=s,p.weight=o,p.exposure=a,p.maxIntensity=l,p.samples=i;const y=this.resolution=new wn(this,f,I,u);y.addEventListener("change",v=>this.setSize(y.baseWidth,y.baseHeight))}set mainCamera(n){this.camera=n,this.renderPassLight.mainCamera=n,this.depthMaskMaterial.copyCameraSettings(n)}get lightSource(){return this._lightSource}set lightSource(n){this._lightSource=n,n!==null&&(n.material.depthWrite=!1,n.material.transparent=!0)}getBlurPass(){return this.blurPass}get texture(){return this.renderTargetB.texture}getTexture(){return this.texture}get depthMaskMaterial(){return this.depthMaskPass.fullscreenMaterial}get godRaysMaterial(){return this.godRaysPass.fullscreenMaterial}getGodRaysMaterial(){return this.godRaysMaterial}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get dithering(){return this.godRaysMaterial.dithering}set dithering(n){const e=this.godRaysMaterial;e.dithering=n,e.needsUpdate=!0}get blur(){return this.blurPass.enabled}set blur(n){this.blurPass.enabled=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}get samples(){return this.godRaysMaterial.samples}set samples(n){this.godRaysMaterial.samples=n}setDepthTexture(n,e=pr){this.depthMaskPass.fullscreenMaterial.depthBuffer0=n,this.depthMaskPass.fullscreenMaterial.depthPacking0=e}update(n,e,t){const i=this.lightSource,r=i.parent,s=i.matrixAutoUpdate,o=this.renderTargetA,a=this.renderTargetLight;i.material.depthWrite=!0,i.matrixAutoUpdate=!1,i.updateWorldMatrix(!0,!1),r!==null&&(s||wz.copy(i.matrix),i.matrix.copy(i.matrixWorld)),this.lightScene.add(i),this.renderPassLight.render(n,a),this.clearPass.render(n,o),this.depthMaskPass.render(n,a,o),i.material.depthWrite=!1,i.matrixAutoUpdate=s,r!==null&&(s||i.matrix.copy(wz),r.add(i)),CZ.setFromMatrixPosition(i.matrixWorld).project(this.camera),this.screenPosition.set(Math.min(Math.max((CZ.x+1)*.5,-1),2),Math.min(Math.max((CZ.y+1)*.5,-1),2)),this.blurPass.enabled&&this.blurPass.render(n,o,o),this.godRaysPass.render(n,o,this.renderTargetB)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e);const i=t.width,r=t.height;this.renderTargetA.setSize(i,r),this.renderTargetB.setSize(i,r),this.renderTargetLight.setSize(i,r),this.blurPass.resolution.copy(t)}initialize(n,e,t){this.blurPass.initialize(n,e,t),this.renderPassLight.initialize(n,e,t),this.depthMaskPass.initialize(n,e,t),this.godRaysPass.initialize(n,e,t),t!==void 0&&(this.renderTargetA.texture.type=t,this.renderTargetB.texture.type=t,this.renderTargetLight.texture.type=t,Pg(n)===Gn&&(er(this.renderTargetA.texture,Gn),er(this.renderTargetB.texture,Gn),er(this.renderTargetLight.texture,Gn)))}},Dme="uniform vec2 scale;uniform float lineWidth;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){float grid=0.5-max(abs(mod(uv.x*scale.x,1.0)-0.5),abs(mod(uv.y*scale.y,1.0)-0.5));outputColor=vec4(vec3(smoothstep(0.0,lineWidth,grid)),inputColor.a);}",Pme=class extends Wr{constructor({blendFunction:n=Rt.OVERLAY,scale:e=1,lineWidth:t=0}={}){super("GridEffect",Dme,{blendFunction:n,uniforms:new Map([["scale",new ye(new pe)],["lineWidth",new ye(t)]])}),this.resolution=new pe,this.s=0,this.scale=e,this.l=0,this.lineWidth=t}get scale(){return this.s}set scale(n){this.s=Math.max(n,1e-6),this.setSize(this.resolution.width,this.resolution.height)}getScale(){return this.scale}setScale(n){this.scale=n}get lineWidth(){return this.l}set lineWidth(n){this.l=n,this.setSize(this.resolution.width,this.resolution.height)}getLineWidth(){return this.lineWidth}setLineWidth(n){this.lineWidth=n}setSize(n,e){this.resolution.set(n,e);const t=n/e,i=this.scale*(e*.125);this.uniforms.get("scale").value.set(t*i,i),this.uniforms.get("lineWidth").value=i/e+this.lineWidth}};function xz(n,e,t){const i=document.createElement("canvas"),r=i.getContext("2d");if(i.width=n,i.height=e,t instanceof Image)r.drawImage(t,0,0);else{const s=r.createImageData(n,e);s.data.set(t),r.putImageData(s,0,0)}return i}var Ej=class{constructor(n=0,e=0,t=null){this.width=n,this.height=e,this.data=t}toCanvas(){return typeof document>"u"?null:xz(this.width,this.height,this.data)}static from(n){const{width:e,height:t}=n;let i;if(n instanceof Image){const r=xz(e,t,n);r!==null&&(i=r.getContext("2d").getImageData(0,0,e,t).data)}else i=n.data;return new Ej(e,t,i)}},Ume=`"use strict";(()=>{var O=Math.pow;var _={SCALE_UP:"lut.scaleup"};var k=[new Float32Array(3),new Float32Array(3)],n=[new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3)],Z=[[new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1])],[new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,0,1]),new Float32Array([1,1,1])],[new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([1,0,1]),new Float32Array([1,1,1])],[new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1])],[new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([0,1,1]),new Float32Array([1,1,1])],[new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([0,1,1]),new Float32Array([1,1,1])]];function d(a,t,r,m){let i=r[0]-t[0],e=r[1]-t[1],y=r[2]-t[2],h=a[0]-t[0],A=a[1]-t[1],w=a[2]-t[2],c=e*w-y*A,l=y*h-i*w,x=i*A-e*h,u=Math.sqrt(c*c+l*l+x*x),b=u*.5,s=c/u,F=l/u,f=x/u,p=-(a[0]*s+a[1]*F+a[2]*f),M=m[0]*s+m[1]*F+m[2]*f;return Math.abs(M+p)*b/3}function V(a,t,r,m,i,e){let y=(r+m*t+i*t*t)*4;e[0]=a[y+0],e[1]=a[y+1],e[2]=a[y+2]}function j(a,t,r,m,i,e){let y=r*(t-1),h=m*(t-1),A=i*(t-1),w=Math.floor(y),c=Math.floor(h),l=Math.floor(A),x=Math.ceil(y),u=Math.ceil(h),b=Math.ceil(A),s=y-w,F=h-c,f=A-l;if(w===y&&c===h&&l===A)V(a,t,y,h,A,e);else{let p;s>=F&&F>=f?p=Z[0]:s>=f&&f>=F?p=Z[1]:f>=s&&s>=F?p=Z[2]:F>=s&&s>=f?p=Z[3]:F>=f&&f>=s?p=Z[4]:f>=F&&F>=s&&(p=Z[5]);let[M,g,X,Y]=p,P=k[0];P[0]=s,P[1]=F,P[2]=f;let o=k[1],L=x-w,S=u-c,U=b-l;o[0]=L*M[0]+w,o[1]=S*M[1]+c,o[2]=U*M[2]+l,V(a,t,o[0],o[1],o[2],n[0]),o[0]=L*g[0]+w,o[1]=S*g[1]+c,o[2]=U*g[2]+l,V(a,t,o[0],o[1],o[2],n[1]),o[0]=L*X[0]+w,o[1]=S*X[1]+c,o[2]=U*X[2]+l,V(a,t,o[0],o[1],o[2],n[2]),o[0]=L*Y[0]+w,o[1]=S*Y[1]+c,o[2]=U*Y[2]+l,V(a,t,o[0],o[1],o[2],n[3]);let T=d(g,X,Y,P)*6,q=d(M,X,Y,P)*6,C=d(M,g,Y,P)*6,E=d(M,g,X,P)*6;n[0][0]*=T,n[0][1]*=T,n[0][2]*=T,n[1][0]*=q,n[1][1]*=q,n[1][2]*=q,n[2][0]*=C,n[2][1]*=C,n[2][2]*=C,n[3][0]*=E,n[3][1]*=E,n[3][2]*=E,e[0]=n[0][0]+n[1][0]+n[2][0]+n[3][0],e[1]=n[0][1]+n[1][1]+n[2][1]+n[3][1],e[2]=n[0][2]+n[1][2]+n[2][2]+n[3][2]}}var v=class{static expand(t,r){let m=Math.cbrt(t.length/4),i=new Float32Array(3),e=new t.constructor(O(r,3)*4),y=t instanceof Uint8Array?255:1,h=O(r,2),A=1/(r-1);for(let w=0;w<r;++w)for(let c=0;c<r;++c)for(let l=0;l<r;++l){let x=l*A,u=c*A,b=w*A,s=Math.round(l+c*r+w*h)*4;j(t,m,x,u,b,i),e[s+0]=i[0],e[s+1]=i[1],e[s+2]=i[2],e[s+3]=y}return e}};self.addEventListener("message",a=>{let t=a.data,r=t.data;switch(t.operation){case _.SCALE_UP:r=v.expand(r,t.size);break}postMessage(r,[r.buffer]),close()});})();
`,Sz=new Ke,v1=class extends Oh{constructor(n,e){super(n,e,e,e),this.type=Hn,this.format=Yn,this.minFilter=ut,this.magFilter=ut,this.wrapS=Ki,this.wrapT=Ki,this.wrapR=Ki,this.unpackAlignment=1,this.needsUpdate=!0,er(this,fC),this.domainMin=new D(0,0,0),this.domainMax=new D(1,1,1)}get isLookupTexture3D(){return!0}scaleUp(n,e=!0){const t=this.image;let i;return n<=t.width?i=Promise.reject(new Error("The target size must be greater than the current size")):i=new Promise((r,s)=>{const o=URL.createObjectURL(new Blob([Ume],{type:"text/javascript"})),a=new Worker(o);a.addEventListener("error",c=>s(c.error)),a.addEventListener("message",c=>{const g=new v1(c.data,n);fZ(this,g),g.type=this.type,g.name=this.name,URL.revokeObjectURL(o),r(g)});const l=e?[t.data.buffer]:[];a.postMessage({operation:qCe.SCALE_UP,data:t.data,size:n},l)}),i}applyLUT(n){const e=this.image,t=n.image,i=Math.min(e.width,e.height,e.depth),r=Math.min(t.width,t.height,t.depth);if(i!==r)console.error("Size mismatch");else if(n.type!==Hn||this.type!==Hn)console.error("Both LUTs must be FloatType textures");else if(n.format!==Yn||this.format!==Yn)console.error("Both LUTs must be RGBA textures");else{const s=e.data,o=t.data,a=i,l=a**2,c=a-1;for(let g=0,u=a**3;g<u;++g){const d=g*4,h=s[d+0]*c,f=s[d+1]*c,I=s[d+2]*c,A=Math.round(h+f*a+I*l)*4;s[d+0]=o[A+0],s[d+1]=o[A+1],s[d+2]=o[A+2]}this.needsUpdate=!0}return this}convertToUint8(){if(this.type===Hn){const n=this.image.data,e=new Uint8Array(n.length);for(let t=0,i=n.length;t<i;++t)e[t]=n[t]*255+.5;this.image.data=e,this.type=Dn,this.needsUpdate=!0}return this}convertToFloat(){if(this.type===Dn){const n=this.image.data,e=new Float32Array(n.length);for(let t=0,i=n.length;t<i;++t)e[t]=n[t]/255;this.image.data=e,this.type=Hn,this.needsUpdate=!0}return this}convertToRGBA(){return console.warn("LookupTexture","convertToRGBA() is deprecated, LUTs are now RGBA by default"),this}convertLinearToSRGB(){const n=this.image.data;if(this.type===Hn){for(let e=0,t=n.length;e<t;e+=4)Sz.fromArray(n,e).convertLinearToSRGB().toArray(n,e);er(this,Gn),this.needsUpdate=!0}else console.error("Color space conversion requires FloatType data");return this}convertSRGBToLinear(){const n=this.image.data;if(this.type===Hn){for(let e=0,t=n.length;e<t;e+=4)Sz.fromArray(n,e).convertSRGBToLinear().toArray(n,e);er(this,fC),this.needsUpdate=!0}else console.error("Color space conversion requires FloatType data");return this}toDataTexture(){const n=this.image.width,e=this.image.height*this.image.depth,t=new pc(this.image.data,n,e);return t.name=this.name,t.type=this.type,t.format=this.format,t.minFilter=ut,t.magFilter=ut,t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.generateMipmaps=!1,t.needsUpdate=!0,fZ(this,t),t}static from(n){const e=n.image,{width:t,height:i}=e,r=Math.min(t,i);let s;if(e instanceof Image){const l=Ej.from(e).data;if(t>i){s=new Uint8Array(l.length);for(let c=0;c<r;++c)for(let g=0;g<r;++g)for(let u=0;u<r;++u){const d=(u+c*r+g*r*r)*4,h=(u+g*r+c*r*r)*4;s[h+0]=l[d+0],s[h+1]=l[d+1],s[h+2]=l[d+2],s[h+3]=l[d+3]}}else s=new Uint8Array(l.buffer)}else s=e.data.slice();const o=new v1(s,r);return o.type=n.type,o.name=n.name,fZ(n,o),o}static createNeutral(n){const e=new Float32Array(n**3*4),t=n**2,i=1/(n-1);for(let s=0;s<n;++s)for(let o=0;o<n;++o)for(let a=0;a<n;++a){const l=(s+o*n+a*t)*4;e[l+0]=s*i,e[l+1]=o*i,e[l+2]=a*i,e[l+3]=1}const r=new v1(e,n);return r.name="neutral",r}},Qme=`uniform vec3 scale;uniform vec3 offset;
#ifdef CUSTOM_INPUT_DOMAIN
uniform vec3 domainMin;uniform vec3 domainMax;
#endif
#ifdef LUT_3D
#ifdef LUT_PRECISION_HIGH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler3D lut;
#else
uniform mediump sampler3D lut;
#endif
#else
uniform lowp sampler3D lut;
#endif
vec4 applyLUT(const in vec3 rgb){
#ifdef TETRAHEDRAL_INTERPOLATION
vec3 p=floor(rgb);vec3 f=rgb-p;vec3 v1=(p+0.5)*LUT_TEXEL_WIDTH;vec3 v4=(p+1.5)*LUT_TEXEL_WIDTH;vec3 v2,v3;vec3 frac;if(f.r>=f.g){if(f.g>f.b){frac=f.rgb;v2=vec3(v4.x,v1.y,v1.z);v3=vec3(v4.x,v4.y,v1.z);}else if(f.r>=f.b){frac=f.rbg;v2=vec3(v4.x,v1.y,v1.z);v3=vec3(v4.x,v1.y,v4.z);}else{frac=f.brg;v2=vec3(v1.x,v1.y,v4.z);v3=vec3(v4.x,v1.y,v4.z);}}else{if(f.b>f.g){frac=f.bgr;v2=vec3(v1.x,v1.y,v4.z);v3=vec3(v1.x,v4.y,v4.z);}else if(f.r>=f.b){frac=f.grb;v2=vec3(v1.x,v4.y,v1.z);v3=vec3(v4.x,v4.y,v1.z);}else{frac=f.gbr;v2=vec3(v1.x,v4.y,v1.z);v3=vec3(v1.x,v4.y,v4.z);}}vec4 n1=texture(lut,v1);vec4 n2=texture(lut,v2);vec4 n3=texture(lut,v3);vec4 n4=texture(lut,v4);vec4 weights=vec4(1.0-frac.x,frac.x-frac.y,frac.y-frac.z,frac.z);vec4 result=weights*mat4(vec4(n1.r,n2.r,n3.r,n4.r),vec4(n1.g,n2.g,n3.g,n4.g),vec4(n1.b,n2.b,n3.b,n4.b),vec4(1.0));return vec4(result.rgb,1.0);
#else
return texture(lut,rgb);
#endif
}
#else
#ifdef LUT_PRECISION_HIGH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D lut;
#else
uniform mediump sampler2D lut;
#endif
#else
uniform lowp sampler2D lut;
#endif
vec4 applyLUT(const in vec3 rgb){float slice=rgb.b*LUT_SIZE;float slice0=floor(slice);float interp=slice-slice0;float centeredInterp=interp-0.5;float slice1=slice0+sign(centeredInterp);
#ifdef LUT_STRIP_HORIZONTAL
float xOffset=clamp(rgb.r*LUT_TEXEL_HEIGHT,LUT_TEXEL_WIDTH*0.5,LUT_TEXEL_HEIGHT-LUT_TEXEL_WIDTH*0.5);vec2 uv0=vec2(slice0*LUT_TEXEL_HEIGHT+xOffset,rgb.g);vec2 uv1=vec2(slice1*LUT_TEXEL_HEIGHT+xOffset,rgb.g);
#else
float yOffset=clamp(rgb.g*LUT_TEXEL_WIDTH,LUT_TEXEL_HEIGHT*0.5,LUT_TEXEL_WIDTH-LUT_TEXEL_HEIGHT*0.5);vec2 uv0=vec2(rgb.r,slice0*LUT_TEXEL_WIDTH+yOffset);vec2 uv1=vec2(rgb.r,slice1*LUT_TEXEL_WIDTH+yOffset);
#endif
vec4 sample0=texture2D(lut,uv0);vec4 sample1=texture2D(lut,uv1);return mix(sample0,sample1,abs(centeredInterp));}
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 c=inputColor.rgb;
#ifdef CUSTOM_INPUT_DOMAIN
if(c.r>=domainMin.r&&c.g>=domainMin.g&&c.b>=domainMin.b&&c.r<=domainMax.r&&c.g<=domainMax.g&&c.b<=domainMax.b){c=applyLUT(scale*c+offset).rgb;}else{c=inputColor.rgb;}
#else
#if !defined(LUT_3D) || defined(TETRAHEDRAL_INTERPOLATION)
c=clamp(c,0.0,1.0);
#endif
c=applyLUT(scale*c+offset).rgb;
#endif
outputColor=vec4(c,inputColor.a);}`,Ome=class extends Wr{constructor(n,{blendFunction:e=Rt.SRC,tetrahedralInterpolation:t=!1,inputEncoding:i=Xt,inputColorSpace:r}={}){super("LUT3DEffect",Qme,{blendFunction:e,uniforms:new Map([["lut",new ye(null)],["scale",new ye(new D)],["offset",new ye(new D)],["domainMin",new ye(null)],["domainMax",new ye(null)]])}),this.tetrahedralInterpolation=t,this.inputColorSpace=r||xj.get(i),this.lut=n}get inputEncoding(){return this.inputColorSpace}set inputEncoding(n){this.inputColorSpace=n}getInputEncoding(){return this.inputColorSpace}setInputEncoding(n){this.inputColorSpace=n}getOutputEncoding(){return this.outputColorSpace}get lut(){return this.uniforms.get("lut").value}set lut(n){const e=this.defines,t=this.uniforms;if(this.lut!==n&&(t.get("lut").value=n,n!==null)){const i=n.image,r=this.tetrahedralInterpolation;if(e.clear(),e.set("LUT_SIZE",Math.min(i.width,i.height).toFixed(16)),e.set("LUT_TEXEL_WIDTH",(1/i.width).toFixed(16)),e.set("LUT_TEXEL_HEIGHT",(1/i.height).toFixed(16)),t.get("domainMin").value=null,t.get("domainMax").value=null,(n.type===Hn||n.type===Pi)&&e.set("LUT_PRECISION_HIGH","1"),i.width>i.height?e.set("LUT_STRIP_HORIZONTAL","1"):n instanceof Oh&&e.set("LUT_3D","1"),n instanceof v1){const s=n.domainMin,o=n.domainMax;(s.x!==0||s.y!==0||s.z!==0||o.x!==1||o.y!==1||o.z!==1)&&(e.set("CUSTOM_INPUT_DOMAIN","1"),t.get("domainMin").value=s.clone(),t.get("domainMax").value=o.clone())}this.tetrahedralInterpolation=r}}getLUT(){return this.lut}setLUT(n){this.lut=n}updateScaleOffset(){const n=this.lut;if(n!==null){const e=Math.min(n.image.width,n.image.height),t=this.uniforms.get("scale").value,i=this.uniforms.get("offset").value;if(this.tetrahedralInterpolation&&n instanceof Oh)if(this.defines.has("CUSTOM_INPUT_DOMAIN")){const r=n.domainMax.clone().sub(n.domainMin);t.setScalar(e-1).divide(r),i.copy(n.domainMin).negate().multiply(t)}else t.setScalar(e-1),i.setScalar(0);else if(this.defines.has("CUSTOM_INPUT_DOMAIN")){const r=n.domainMax.clone().sub(n.domainMin).multiplyScalar(e);t.setScalar(e-1).divide(r),i.copy(n.domainMin).negate().multiply(t).addScalar(1/(2*e))}else t.setScalar((e-1)/e),i.setScalar(1/(2*e))}}configureTetrahedralInterpolation(){const n=this.lut;n!==null&&(n.minFilter=ut,n.magFilter=ut,this.tetrahedralInterpolation&&(n instanceof Oh?(n.minFilter=Zt,n.magFilter=Zt):console.warn("Tetrahedral interpolation requires a 3D texture")),n.source===void 0&&(n.needsUpdate=!0))}get tetrahedralInterpolation(){return this.defines.has("TETRAHEDRAL_INTERPOLATION")}set tetrahedralInterpolation(n){n?this.defines.set("TETRAHEDRAL_INTERPOLATION","1"):this.defines.delete("TETRAHEDRAL_INTERPOLATION"),this.configureTetrahedralInterpolation(),this.updateScaleOffset(),this.setChanged()}setTetrahedralInterpolationEnabled(n){this.tetrahedralInterpolation=n}},Jme=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,jme=class extends Wr{constructor({blendFunction:n=Rt.SCREEN,premultiply:e=!1}={}){super("NoiseEffect",Jme,{blendFunction:n}),this.premultiply=e}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(n){this.premultiply!==n&&(n?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(n){this.premultiply=n}},qme=`uniform lowp sampler2D edgeTexture;uniform lowp sampler2D maskTexture;uniform vec3 visibleEdgeColor;uniform vec3 hiddenEdgeColor;uniform float pulse;uniform float edgeStrength;
#ifdef USE_PATTERN
uniform lowp sampler2D patternTexture;varying vec2 vUvPattern;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 edge=texture2D(edgeTexture,uv).rg;vec2 mask=texture2D(maskTexture,uv).rg;
#ifndef X_RAY
edge.y=0.0;
#endif
edge*=(edgeStrength*mask.x*pulse);vec3 color=edge.x*visibleEdgeColor+edge.y*hiddenEdgeColor;float visibilityFactor=0.0;
#ifdef USE_PATTERN
vec4 patternColor=texture2D(patternTexture,vUvPattern);
#ifdef X_RAY
float hiddenFactor=0.5;
#else
float hiddenFactor=0.0;
#endif
visibilityFactor=(1.0-mask.y>0.0)?1.0:hiddenFactor;visibilityFactor*=(1.0-mask.x)*patternColor.a;color+=visibilityFactor*patternColor.rgb;
#endif
float alpha=max(max(edge.x,edge.y),visibilityFactor);
#ifdef ALPHA
outputColor=vec4(color,alpha);
#else
outputColor=vec4(color,max(alpha,inputColor.a));
#endif
}`,$me="uniform float patternScale;varying vec2 vUvPattern;void mainSupport(const in vec2 uv){vUvPattern=uv*vec2(aspect,1.0)*patternScale;}",e0e=class extends Wr{constructor(n,e,{blendFunction:t=Rt.SCREEN,patternTexture:i=null,patternScale:r=1,edgeStrength:s=1,pulseSpeed:o=0,visibleEdgeColor:a=16777215,hiddenEdgeColor:l=2230538,kernelSize:c=DC.VERY_SMALL,blur:g=!1,xRay:u=!0,multisampling:d=0,resolutionScale:h=.5,width:f=wn.AUTO_SIZE,height:I=wn.AUTO_SIZE,resolutionX:A=f,resolutionY:p=I}={}){super("OutlineEffect",qme,{uniforms:new Map([["maskTexture",new ye(null)],["edgeTexture",new ye(null)],["edgeStrength",new ye(s)],["visibleEdgeColor",new ye(new Ke(a))],["hiddenEdgeColor",new ye(new Ke(l))],["pulse",new ye(1)],["patternScale",new ye(r)],["patternTexture",new ye(null)]])}),this.blendMode.addEventListener("change",w=>{this.blendMode.blendFunction===Rt.ALPHA?this.defines.set("ALPHA","1"):this.defines.delete("ALPHA"),this.setChanged()}),this.blendMode.blendFunction=t,this.patternTexture=i,this.xRay=u,this.scene=n,this.camera=e,this.renderTargetMask=new Qt(1,1),this.renderTargetMask.samples=d,this.renderTargetMask.texture.name="Outline.Mask",this.uniforms.get("maskTexture").value=this.renderTargetMask.texture,this.renderTargetOutline=new Qt(1,1,{depthBuffer:!1}),this.renderTargetOutline.texture.name="Outline.Edges",this.uniforms.get("edgeTexture").value=this.renderTargetOutline.texture,this.clearPass=new Ev,this.clearPass.overrideClearColor=new Ke(0),this.clearPass.overrideClearAlpha=1,this.depthPass=new OV(n,e),this.maskPass=new PC(n,e,new ope(this.depthPass.texture,e));const y=this.maskPass.clearPass;y.overrideClearColor=new Ke(16777215),y.overrideClearAlpha=1,this.blurPass=new ix({resolutionScale:h,resolutionX:A,resolutionY:p,kernelSize:c}),this.blurPass.enabled=g;const v=this.blurPass.resolution;v.addEventListener("change",w=>this.setSize(v.baseWidth,v.baseHeight)),this.outlinePass=new pl(new Rpe);const b=this.outlinePass.fullscreenMaterial;b.inputBuffer=this.renderTargetMask.texture,this.time=0,this.active=!1,this.selection=new JV,this.selection.layer=10,this.pulseSpeed=o}set mainScene(n){this.scene=n,this.depthPass.mainScene=n,this.maskPass.mainScene=n}set mainCamera(n){this.camera=n,this.depthPass.mainCamera=n,this.maskPass.mainCamera=n,this.maskPass.overrideMaterial.copyCameraSettings(n)}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.getResolution()}get multisampling(){return this.renderTargetMask.samples}set multisampling(n){this.renderTargetMask.samples=n,this.renderTargetMask.dispose()}get patternScale(){return this.uniforms.get("patternScale").value}set patternScale(n){this.uniforms.get("patternScale").value=n}get edgeStrength(){return this.uniforms.get("edgeStrength").value}set edgeStrength(n){this.uniforms.get("edgeStrength").value=n}get visibleEdgeColor(){return this.uniforms.get("visibleEdgeColor").value}set visibleEdgeColor(n){this.uniforms.get("visibleEdgeColor").value=n}get hiddenEdgeColor(){return this.uniforms.get("hiddenEdgeColor").value}set hiddenEdgeColor(n){this.uniforms.get("hiddenEdgeColor").value=n}getBlurPass(){return this.blurPass}getSelection(){return this.selection}getPulseSpeed(){return this.pulseSpeed}setPulseSpeed(n){this.pulseSpeed=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get selectionLayer(){return this.selection.layer}set selectionLayer(n){this.selection.layer=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get blur(){return this.blurPass.enabled}set blur(n){this.blurPass.enabled=n}get xRay(){return this.defines.has("X_RAY")}set xRay(n){this.xRay!==n&&(n?this.defines.set("X_RAY","1"):this.defines.delete("X_RAY"),this.setChanged())}isXRayEnabled(){return this.xRay}setXRayEnabled(n){this.xRay=n}get patternTexture(){return this.uniforms.get("patternTexture").value}set patternTexture(n){n!==null?(n.wrapS=n.wrapT=ds,this.defines.set("USE_PATTERN","1"),this.setVertexShader($me)):(this.defines.delete("USE_PATTERN"),this.setVertexShader(null)),this.uniforms.get("patternTexture").value=n,this.setChanged()}setPatternTexture(n){this.patternTexture=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}setSelection(n){return this.selection.set(n),this}clearSelection(){return this.selection.clear(),this}selectObject(n){return this.selection.add(n),this}deselectObject(n){return this.selection.delete(n),this}update(n,e,t){const i=this.scene,r=this.camera,s=this.selection,a=this.uniforms.get("pulse"),l=i.background,c=r.layers.mask;s.size>0?(i.background=null,a.value=1,this.pulseSpeed>0&&(a.value=Math.cos(this.time*this.pulseSpeed*10)*.375+.625),this.active=!0,this.time+=t,s.setVisible(!1),this.depthPass.render(n),s.setVisible(!0),r.layers.set(s.layer),this.maskPass.render(n,this.renderTargetMask),r.layers.mask=c,i.background=l,this.outlinePass.render(n,null,this.renderTargetOutline),this.blurPass.enabled&&this.blurPass.render(n,this.renderTargetOutline,this.renderTargetOutline)):this.active&&(this.clearPass.render(n,this.renderTargetOutline),this.active=!1)}setSize(n,e){this.blurPass.setSize(n,e),this.renderTargetMask.setSize(n,e);const t=this.resolution;t.setBaseSize(n,e);const i=t.width,r=t.height;this.depthPass.setSize(i,r),this.renderTargetOutline.setSize(i,r),this.outlinePass.fullscreenMaterial.setSize(i,r)}initialize(n,e,t){this.blurPass.initialize(n,e,Dn),t!==void 0&&(this.depthPass.initialize(n,e,t),this.maskPass.initialize(n,e,t),this.outlinePass.initialize(n,e,t))}},t0e="uniform bool active;uniform vec4 d;void mainUv(inout vec2 uv){if(active){uv=d.xy*(floor(uv*d.zw)+0.5);}}",n0e=class extends Wr{constructor(n=30){super("PixelationEffect",t0e,{uniforms:new Map([["active",new ye(!1)],["d",new ye(new Lt)]])}),this.resolution=new pe,this._granularity=0,this.granularity=n}get granularity(){return this._granularity}set granularity(n){let e=Math.floor(n);e%2>0&&(e+=1),this._granularity=e,this.uniforms.get("active").value=e>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(n){this.granularity=n}setSize(n,e){const t=this.resolution;t.set(n,e);const i=this.granularity,r=i/t.x,s=i/t.y;this.uniforms.get("d").value.set(r,s,1/r,1/s)}};new D;new D;var i0e=class extends Wme{constructor(n,e,t){super(t),this.setAttributes(this.getAttributes()|ka.DEPTH),this.camera=e,this.depthPass=new OV(n,e),this.clearPass=new Ev(!0,!1,!1),this.clearPass.overrideClearColor=new Ke(0),this.depthMaskPass=new pl(new Rj);const i=this.depthMaskMaterial;i.copyCameraSettings(e),i.depthBuffer1=this.depthPass.texture,i.depthPacking1=Sl,i.depthMode=fy,this.renderTargetMasked=new Qt(1,1,{depthBuffer:!1}),this.renderTargetMasked.texture.name="Bloom.Masked",this.selection=new JV,this.selection.layer=11,this._inverted=!1,this._ignoreBackground=!1}set mainScene(n){this.depthPass.mainScene=n}set mainCamera(n){this.camera=n,this.depthPass.mainCamera=n,this.depthMaskMaterial.copyCameraSettings(n)}getSelection(){return this.selection}get depthMaskMaterial(){return this.depthMaskPass.fullscreenMaterial}get inverted(){return this._inverted}set inverted(n){this._inverted=n,this.depthMaskMaterial.depthMode=n?Gw:fy}isInverted(){return this.inverted}setInverted(n){this.inverted=n}get ignoreBackground(){return this._ignoreBackground}set ignoreBackground(n){this._ignoreBackground=n,this.depthMaskMaterial.maxDepthStrategy=n?V0.DISCARD_MAX_DEPTH:V0.KEEP_MAX_DEPTH}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}setDepthTexture(n,e=pr){this.depthMaskMaterial.depthBuffer0=n,this.depthMaskMaterial.depthPacking0=e}update(n,e,t){const i=this.camera,r=this.selection,s=this.inverted;let o=e;if(this.ignoreBackground||!s||r.size>0){const a=i.layers.mask;i.layers.set(r.layer),this.depthPass.render(n),i.layers.mask=a,o=this.renderTargetMasked,this.clearPass.render(n,o),this.depthMaskPass.render(n,e,o)}super.update(n,o,t)}setSize(n,e){super.setSize(n,e),this.renderTargetMasked.setSize(n,e),this.depthPass.setSize(n,e)}initialize(n,e,t){super.initialize(n,e,t),this.clearPass.initialize(n,e,t),this.depthPass.initialize(n,e,t),this.depthMaskPass.initialize(n,e,t),t!==void 0&&(this.renderTargetMasked.texture.type=t,Pg(n)===Gn&&er(this.renderTargetMasked.texture,Gn))}},r0e=`uniform lowp sampler2D aoBuffer;uniform float luminanceInfluence;uniform float intensity;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH)
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
#endif
#ifdef COLORIZE
uniform vec3 color;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){float aoLinear=texture2D(aoBuffer,uv).r;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH) && __VERSION__ == 300
vec4 normalDepth[4];normalDepth[0]=textureOffset(normalDepthBuffer,uv,ivec2(0,0));normalDepth[1]=textureOffset(normalDepthBuffer,uv,ivec2(0,1));normalDepth[2]=textureOffset(normalDepthBuffer,uv,ivec2(1,0));normalDepth[3]=textureOffset(normalDepthBuffer,uv,ivec2(1,1));float dot01=dot(normalDepth[0].rgb,normalDepth[1].rgb);float dot02=dot(normalDepth[0].rgb,normalDepth[2].rgb);float dot03=dot(normalDepth[0].rgb,normalDepth[3].rgb);float minDot=min(dot01,min(dot02,dot03));float s=step(THRESHOLD,minDot);float smallestDistance=1.0;int index;for(int i=0;i<4;++i){float distance=abs(depth-normalDepth[i].a);if(distance<smallestDistance){smallestDistance=distance;index=i;}}ivec2 offsets[4];offsets[0]=ivec2(0,0);offsets[1]=ivec2(0,1);offsets[2]=ivec2(1,0);offsets[3]=ivec2(1,1);ivec2 coord=ivec2(uv*vec2(textureSize(aoBuffer,0)))+offsets[index];float aoNearest=texelFetch(aoBuffer,coord,0).r;float ao=mix(aoNearest,aoLinear,s);
#else
float ao=aoLinear;
#endif
float l=luminance(inputColor.rgb);ao=mix(ao,0.0,l*luminanceInfluence);ao=clamp(ao*intensity,0.0,1.0);
#ifdef COLORIZE
outputColor=vec4(1.0-ao*(1.0-color),inputColor.a);
#else
outputColor=vec4(vec3(1.0-ao),inputColor.a);
#endif
}`,Rz=64,s0e=class extends Wr{constructor(n,e,{blendFunction:t=Rt.MULTIPLY,samples:i=9,rings:r=7,normalDepthBuffer:s=null,depthAwareUpsampling:o=!0,worldDistanceThreshold:a,worldDistanceFalloff:l,worldProximityThreshold:c,worldProximityFalloff:g,distanceThreshold:u=.97,distanceFalloff:d=.03,rangeThreshold:h=5e-4,rangeFalloff:f=.001,minRadiusScale:I=.1,luminanceInfluence:A=.7,radius:p=.1825,intensity:y=1,bias:v=.025,fade:b=.01,color:w=null,resolutionScale:G=1,width:x=wn.AUTO_SIZE,height:B=wn.AUTO_SIZE,resolutionX:R=x,resolutionY:Z=B}={}){super("SSAOEffect",r0e,{blendFunction:t,attributes:ka.DEPTH,defines:new Map([["THRESHOLD","0.997"]]),uniforms:new Map([["aoBuffer",new ye(null)],["normalDepthBuffer",new ye(s)],["luminanceInfluence",new ye(A)],["color",new ye(null)],["intensity",new ye(y)],["scale",new ye(0)]])}),this.renderTarget=new Qt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="AO.Target",this.uniforms.get("aoBuffer").value=this.renderTarget.texture;const W=this.resolution=new wn(this,R,Z,G);W.addEventListener("change",V=>this.setSize(W.baseWidth,W.baseHeight)),this.camera=n,this.depthDownsamplingPass=new Mj({normalBuffer:e,resolutionScale:G}),this.depthDownsamplingPass.enabled=s===null,this.ssaoPass=new pl(new Epe(n));const F=new rW(Rz,Rz,Yn);F.wrapS=F.wrapT=ds;const T=this.ssaoMaterial;T.normalBuffer=e,T.noiseTexture=F,T.minRadiusScale=I,T.samples=i,T.radius=p,T.rings=r,T.fade=b,T.bias=v,T.distanceThreshold=u,T.distanceFalloff=d,T.proximityThreshold=h,T.proximityFalloff=f,a!==void 0&&(T.worldDistanceThreshold=a),l!==void 0&&(T.worldDistanceFalloff=l),c!==void 0&&(T.worldProximityThreshold=c),g!==void 0&&(T.worldProximityFalloff=g),s!==null&&(this.ssaoMaterial.normalDepthBuffer=s,this.defines.set("NORMAL_DEPTH","1")),this.depthAwareUpsampling=o,this.color=w}set mainCamera(n){this.camera=n,this.ssaoMaterial.copyCameraSettings(n)}get normalBuffer(){return this.ssaoMaterial.normalBuffer}set normalBuffer(n){this.ssaoMaterial.normalBuffer=n,this.depthDownsamplingPass.fullscreenMaterial.normalBuffer=n}getResolution(){return this.resolution}get ssaoMaterial(){return this.ssaoPass.fullscreenMaterial}getSSAOMaterial(){return this.ssaoMaterial}get samples(){return this.ssaoMaterial.samples}set samples(n){this.ssaoMaterial.samples=n}get rings(){return this.ssaoMaterial.rings}set rings(n){this.ssaoMaterial.rings=n}get radius(){return this.ssaoMaterial.radius}set radius(n){this.ssaoMaterial.radius=n}get depthAwareUpsampling(){return this.defines.has("DEPTH_AWARE_UPSAMPLING")}set depthAwareUpsampling(n){this.depthAwareUpsampling!==n&&(n?this.defines.set("DEPTH_AWARE_UPSAMPLING","1"):this.defines.delete("DEPTH_AWARE_UPSAMPLING"),this.setChanged())}isDepthAwareUpsamplingEnabled(){return this.depthAwareUpsampling}setDepthAwareUpsamplingEnabled(n){this.depthAwareUpsampling=n}get distanceScaling(){return!0}set distanceScaling(n){}get color(){return this.uniforms.get("color").value}set color(n){const e=this.uniforms,t=this.defines;n!==null?t.has("COLORIZE")?e.get("color").value.set(n):(t.set("COLORIZE","1"),e.get("color").value=new Ke(n),this.setChanged()):t.has("COLORIZE")&&(t.delete("COLORIZE"),e.get("color").value=null,this.setChanged())}get luminanceInfluence(){return this.uniforms.get("luminanceInfluence").value}set luminanceInfluence(n){this.uniforms.get("luminanceInfluence").value=n}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getColor(){return this.color}setColor(n){this.color=n}setDistanceCutoff(n,e){this.ssaoMaterial.distanceThreshold=n,this.ssaoMaterial.distanceFalloff=e}setProximityCutoff(n,e){this.ssaoMaterial.proximityThreshold=n,this.ssaoMaterial.proximityFalloff=e}setDepthTexture(n,e=pr){this.depthDownsamplingPass.setDepthTexture(n,e),this.ssaoMaterial.depthBuffer=n,this.ssaoMaterial.depthPacking=e}update(n,e,t){const i=this.renderTarget;this.depthDownsamplingPass.enabled&&this.depthDownsamplingPass.render(n),this.ssaoPass.render(n,null,i)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e);const i=t.width,r=t.height;this.ssaoMaterial.copyCameraSettings(this.camera),this.ssaoMaterial.setSize(i,r),this.renderTarget.setSize(i,r),this.depthDownsamplingPass.resolution.scale=t.scale,this.depthDownsamplingPass.setSize(n,e)}initialize(n,e,t){try{let i=this.uniforms.get("normalDepthBuffer").value;i===null&&(this.depthDownsamplingPass.initialize(n,e,t),i=this.depthDownsamplingPass.texture,this.uniforms.get("normalDepthBuffer").value=i,this.ssaoMaterial.normalDepthBuffer=i,this.defines.set("NORMAL_DEPTH","1"))}catch{this.depthDownsamplingPass.enabled=!1}}},o0e=`#ifdef TEXTURE_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
varying vec2 vUv2;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){
#ifdef UV_TRANSFORM
vec4 texel=texture2D(map,vUv2);
#else
vec4 texel=texture2D(map,uv);
#endif
outputColor=TEXEL;}`,a0e=`#ifdef ASPECT_CORRECTION
uniform float scale;
#else
uniform mat3 uvTransform;
#endif
varying vec2 vUv2;void mainSupport(const in vec2 uv){
#ifdef ASPECT_CORRECTION
vUv2=uv*vec2(aspect,1.0)*scale;
#else
vUv2=(uvTransform*vec3(uv,1.0)).xy;
#endif
}`,l0e=class extends Wr{constructor({blendFunction:n,texture:e=null,aspectCorrection:t=!1}={}){super("TextureEffect",o0e,{blendFunction:n,defines:new Map([["TEXEL","texel"]]),uniforms:new Map([["map",new ye(null)],["scale",new ye(1)],["uvTransform",new ye(null)]])}),this.texture=e,this.aspectCorrection=t}get texture(){return this.uniforms.get("map").value}set texture(n){const e=this.texture,t=this.uniforms,i=this.defines;e!==n&&(t.get("map").value=n,t.get("uvTransform").value=n.matrix,i.delete("TEXTURE_PRECISION_HIGH"),n!==null&&(n.matrixAutoUpdate?(i.set("UV_TRANSFORM","1"),this.setVertexShader(a0e)):(i.delete("UV_TRANSFORM"),this.setVertexShader(null)),n.type!==Dn&&i.set("TEXTURE_PRECISION_HIGH","1"),(e===null||e.type!==n.type||e.encoding!==n.encoding)&&this.setChanged()))}getTexture(){return this.texture}setTexture(n){this.texture=n}get aspectCorrection(){return this.defines.has("ASPECT_CORRECTION")}set aspectCorrection(n){this.aspectCorrection!==n&&(n?this.defines.set("ASPECT_CORRECTION","1"):this.defines.delete("ASPECT_CORRECTION"),this.setChanged())}get uvTransform(){const n=this.texture;return n!==null&&n.matrixAutoUpdate}set uvTransform(n){const e=this.texture;e!==null&&(e.matrixAutoUpdate=n)}setTextureSwizzleRGBA(n,e=n,t=n,i=n){const r="rgba";let s="";(n!==vA.RED||e!==vA.GREEN||t!==vA.BLUE||i!==vA.ALPHA)&&(s=[".",r[n],r[e],r[t],r[i]].join("")),this.defines.set("TEXEL","texel"+s),this.setChanged()}update(n,e,t){this.texture.matrixAutoUpdate&&this.texture.updateMatrix()}};let vm;function c0e(){var n;if(vm!==void 0)return vm;try{let e;const t=document.createElement("canvas");return vm=!!(window.WebGL2RenderingContext&&(e=t.getContext("webgl2"))),e&&((n=e.getExtension("WEBGL_lose_context"))==null||n.loseContext()),vm}catch{return vm=!1}}function N0(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function sW(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=n[t];return i}function g0e(n,e){if(n){if(typeof n=="string")return sW(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return sW(n,e)}}function u0e(n){if(Array.isArray(n))return sW(n)}function d0e(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function h0e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function f0e(n){return u0e(n)||d0e(n)||g0e(n)||h0e()}new pe;new pe;function I0e(n,e,t){return Math.max(e,Math.min(t,n))}function A0e(n,e){return I0e(n-Math.floor(n/e)*e,0,e)}function C0e(n,e){var t=A0e(e-n,Math.PI*2);return t>Math.PI&&(t-=Math.PI*2),t}function Wj(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var ya=function n(e,t,i){var r=this;Wj(this,n),N0(this,"dot2",function(s,o){return r.x*s+r.y*o}),N0(this,"dot3",function(s,o,a){return r.x*s+r.y*o+r.z*a}),this.x=e,this.y=t,this.z=i},p0e=[new ya(1,1,0),new ya(-1,1,0),new ya(1,-1,0),new ya(-1,-1,0),new ya(1,0,1),new ya(-1,0,1),new ya(1,0,-1),new ya(-1,0,-1),new ya(0,1,1),new ya(0,-1,1),new ya(0,1,-1),new ya(0,-1,-1)],Zz=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],Mz=new Array(512),Ez=new Array(512),m0e=function(e){e>0&&e<1&&(e*=65536),e=Math.floor(e),e<256&&(e|=e<<8);for(var t=0;t<256;t++){var i;t&1?i=Zz[t]^e&255:i=Zz[t]^e>>8&255,Mz[t]=Mz[t+256]=i,Ez[t]=Ez[t+256]=p0e[i%12]}};m0e(0);function y0e(n){if(typeof n=="number")n=Math.abs(n);else if(typeof n=="string"){var e=n;n=0;for(var t=0;t<e.length;t++)n=(n+(t+1)*(e.charCodeAt(t)%96))%2147483647}return n===0&&(n=311),n}function Wz(n){var e=y0e(n);return function(){var t=e*48271%2147483647;return e=t,t/2147483647}}var v0e=function n(e){var t=this;Wj(this,n),N0(this,"seed",0),N0(this,"init",function(i){t.seed=i,t.value=Wz(i)}),N0(this,"value",Wz(this.seed)),this.init(e)};new v0e(Math.random());var b0e=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.01,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/(2*Math.PI);return i/Math.atan(1/t)*Math.atan(Math.sin(2*Math.PI*e*r)/t)},Fj=function(e){return 1/(1+e+.48*e*e+.235*e*e*e)};function tr(n,e,t){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:.25,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.01,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Fj,a=arguments.length>7&&arguments[7]!==void 0?arguments[7]:.001,l="velocity_"+e;if(n.__damp===void 0&&(n.__damp={}),n.__damp[l]===void 0&&(n.__damp[l]=0),Math.abs(n[e]-t)<=a)return n[e]=t,!1;i=Math.max(1e-4,i);var c=2/i,g=o(c*r),u=n[e]-t,d=t,h=s*i;u=Math.min(Math.max(u,-h),h),t=n[e]-u;var f=(n.__damp[l]+c*u)*r;n.__damp[l]=(n.__damp[l]-c*f)*g;var I=t+(u+f)*g;return d-n[e]>0==I>d&&(I=d,n.__damp[l]=(I-d)/r),n[e]=I,!0}function XA(n,e,t,i,r,s,o,a){return tr(n,e,n[e]+C0e(n[e],t),i,r,s,o,a)}var bm=new pe,Fz,_z;function B0e(n,e,t,i,r,s,o){return typeof e=="number"?bm.setScalar(e):Array.isArray(e)?bm.set(e[0],e[1]):bm.copy(e),Fz=tr(n,"x",bm.x,t,i,r,s,o),_z=tr(n,"y",bm.y,t,i,r,s,o),Fz||_z}var RI=new D,Vz,Tz,Nz;function oW(n,e,t,i,r,s,o){return typeof e=="number"?RI.setScalar(e):Array.isArray(e)?RI.set(e[0],e[1],e[2]):RI.copy(e),Vz=tr(n,"x",RI.x,t,i,r,s,o),Tz=tr(n,"y",RI.y,t,i,r,s,o),Nz=tr(n,"z",RI.z,t,i,r,s,o),Vz||Tz||Nz}var sh=new Lt,kz,Lz,Hz,zz;function G0e(n,e,t,i,r,s,o){return typeof e=="number"?sh.setScalar(e):Array.isArray(e)?sh.set(e[0],e[1],e[2],e[3]):sh.copy(e),kz=tr(n,"x",sh.x,t,i,r,s,o),Lz=tr(n,"y",sh.y,t,i,r,s,o),Hz=tr(n,"z",sh.z,t,i,r,s,o),zz=tr(n,"w",sh.w,t,i,r,s,o),kz||Lz||Hz||zz}var Bm=new Hi,Xz,Yz,Kz;function w0e(n,e,t,i,r,s,o){return Array.isArray(e)?Bm.set(e[0],e[1],e[2],e[3]):Bm.copy(e),Xz=XA(n,"x",Bm.x,t,i,r,s,o),Yz=XA(n,"y",Bm.y,t,i,r,s,o),Kz=XA(n,"z",Bm.z,t,i,r,s,o),Xz||Yz||Kz}var ZI=new Ke,Dz,Pz,Uz;function x0e(n,e,t,i,r,s,o){return e instanceof Ke?ZI.copy(e):Array.isArray(e)?ZI.setRGB(e[0],e[1],e[2]):ZI.set(e),Dz=tr(n,"r",ZI.r,t,i,r,s,o),Pz=tr(n,"g",ZI.g,t,i,r,s,o),Uz=tr(n,"b",ZI.b,t,i,r,s,o),Dz||Pz||Uz}var rl=new xn,ng=new Lt,Qz=new Lt,Gm=new Lt,Oz,Jz,jz,qz;function _j(n,e,t,i,r,s,o){var a=n;Array.isArray(e)?rl.set(e[0],e[1],e[2],e[3]):rl.copy(e);var l=n.dot(rl)>0?1:-1;return rl.x*=l,rl.y*=l,rl.z*=l,rl.w*=l,Oz=tr(n,"x",rl.x,t,i,r,s,o),Jz=tr(n,"y",rl.y,t,i,r,s,o),jz=tr(n,"z",rl.z,t,i,r,s,o),qz=tr(n,"w",rl.w,t,i,r,s,o),ng.set(n.x,n.y,n.z,n.w).normalize(),Qz.set(a.__damp.velocity_x,a.__damp.velocity_y,a.__damp.velocity_z,a.__damp.velocity_w),Gm.copy(ng).multiplyScalar(Qz.dot(ng)/ng.dot(ng)),a.__damp.velocity_x-=Gm.x,a.__damp.velocity_y-=Gm.y,a.__damp.velocity_z-=Gm.z,a.__damp.velocity_w-=Gm.w,n.set(ng.x,ng.y,ng.z,ng.w),Oz||Jz||jz||qz}var wm=new yV,$z,eX,tX;function S0e(n,e,t,i,r,s,o){return Array.isArray(e)?wm.set(e[0],e[1],e[2]):wm.copy(e),$z=tr(n,"radius",wm.radius,t,i,r,s,o),eX=XA(n,"phi",wm.phi,t,i,r,s,o),tX=XA(n,"theta",wm.theta,t,i,r,s,o),$z||eX||tX}var sG=new qe,nX=new D,iX=new xn,rX=new D,sX,oX,aX;function R0e(n,e,t,i,r,s,o){var a=n;return a.__damp===void 0&&(a.__damp={position:new D,rotation:new xn,scale:new D},n.decompose(a.__damp.position,a.__damp.rotation,a.__damp.scale)),Array.isArray(e)?sG.set.apply(sG,f0e(e)):sG.copy(e),sG.decompose(nX,iX,rX),sX=oW(a.__damp.position,nX,t,i,r,s,o),oX=_j(a.__damp.rotation,iX,t,i,r,s,o),aX=oW(a.__damp.scale,rX,t,i,r,s,o),n.compose(a.__damp.position,a.__damp.rotation,a.__damp.scale),sX||oX||aX}var Z0e=Object.freeze({__proto__:null,rsqw:b0e,exp:Fj,damp:tr,dampAngle:XA,damp2:B0e,damp3:oW,damp4:G0e,dampE:w0e,dampC:x0e,dampQ:_j,dampS:S0e,dampM:R0e});function aW(){return aW=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},aW.apply(this,arguments)}var M0e=`#define GLSLIFY 1
uniform float blur;uniform float blurSharpness;uniform int blurKernel;vec3 denoise(vec3 center,sampler2D tex,vec2 uv,vec2 invTexSize,float blur,float blurSharpness,int blurKernel){vec3 color;float total;vec3 col;float weight;for(int x=-blurKernel;x<=blurKernel;x++){for(int y=-blurKernel;y<=blurKernel;y++){col=textureLod(tex,uv+vec2(x,y)*invTexSize,0.).rgb;weight=1.0-abs(dot(col-center,vec3(0.25)));weight=pow(weight,blurSharpness);color+=col*weight;total+=weight;}}return color/total;}`,E0e=`#define GLSLIFY 1
#define MODE_DEFAULT 0
#define MODE_REFLECTIONS 1
#define MODE_RAW_REFLECTION 2
#define MODE_BLURRED_REFLECTIONS 3
#define MODE_INPUT 4
#define MODE_BLUR_MIX 5
#define FLOAT_EPSILON 0.00001
uniform sampler2D inputTexture;uniform sampler2D reflectionsTexture;uniform float samples;
#include <boxBlur>
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 reflectionsTexel=texture2D(reflectionsTexture,vUv);ivec2 size=textureSize(reflectionsTexture,0);vec2 invTexSize=1./vec2(size.x,size.y);vec3 reflectionClr=reflectionsTexel.xyz;if(blur>FLOAT_EPSILON){vec3 blurredReflectionsColor=denoise(reflectionsTexel.rgb,reflectionsTexture,vUv,invTexSize,blur,blurSharpness,blurKernel);reflectionClr=mix(reflectionClr,blurredReflectionsColor.rgb,blur);}
#if RENDER_MODE == MODE_DEFAULT
outputColor=vec4(inputColor.rgb+reflectionClr,1.0);
#endif
#if RENDER_MODE == MODE_REFLECTIONS
outputColor=vec4(reflectionClr,1.0);
#endif
#if RENDER_MODE == MODE_RAW_REFLECTION
outputColor=vec4(reflectionsTexel.xyz,1.0);
#endif
#if RENDER_MODE == MODE_BLURRED_REFLECTIONS
outputColor=vec4(blurredReflectionsTexel.xyz,1.0);
#endif
#if RENDER_MODE == MODE_INPUT
outputColor=vec4(inputColor.xyz,1.0);
#endif
#if RENDER_MODE == MODE_BLUR_MIX
outputColor=vec4(vec3(blur),1.0);
#endif
}`,Vj=`#define GLSLIFY 1
vec3 getViewPosition(const float depth){float clipW=_projectionMatrix[2][3]*depth+_projectionMatrix[3][3];vec4 clipPosition=vec4((vec3(vUv,depth)-0.5)*2.0,1.0);clipPosition*=clipW;return(_inverseProjectionMatrix*clipPosition).xyz;}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 screenSpaceToWorldSpace(const vec2 uv,const float depth){vec4 ndc=vec4((uv.x-0.5)*2.0,(uv.y-0.5)*2.0,(depth-0.5)*2.0,1.0);vec4 clip=_inverseProjectionMatrix*ndc;vec4 view=cameraMatrixWorld*(clip/clip.w);return view.xyz;}
#define Scale (vec3(0.8, 0.8, 0.8))
#define K (19.19)
vec3 hash(vec3 a){a=fract(a*Scale);a+=dot(a,a.yxz+K);return fract((a.xxy+a.yxx)*a.zyx);}float fresnel_dielectric_cos(float cosi,float eta){float c=abs(cosi);float g=eta*eta-1.0+c*c;float result;if(g>0.0){g=sqrt(g);float A=(g-c)/(g+c);float B=(c*(g+c)-1.0)/(c*(g-c)+1.0);result=0.5*A*A*(1.0+B*B);}else{result=1.0;}return result;}float fresnel_dielectric(vec3 Incoming,vec3 Normal,float eta){float cosine=dot(Incoming,Normal);return min(1.0,5.0*fresnel_dielectric_cos(cosine,eta));}`,W0e=`#define GLSLIFY 1
#define INV_EULER 0.36787944117144233
alpha=velocityDisocclusion<FLOAT_EPSILON ?(alpha+0.0075): 0.0;alpha=clamp(alpha,0.0,1.0);bool needsBlur=!didReproject||velocityDisocclusion>0.5;
#ifdef boxBlur
if(needsBlur)inputColor=boxBlurredColor;
#endif
if(alpha==1.0){outputColor=accumulatedColor;}else{float m=mix(alpha,1.0,blend);if(needsBlur)m=0.0;outputColor=accumulatedColor*m+inputColor*(1.0-m);}`;class F0e extends Nt{constructor(){super({type:"MRTMaterial",defines:{USE_UV:"",TEMPORAL_RESOLVE:""},uniforms:{opacity:new ye(1),normalMap:new ye(null),normalScale:new ye(new pe(1,1)),uvTransform:new ye(new Ir),roughness:new ye(1),roughnessMap:new ye(null)},vertexShader:`
                #ifdef USE_MRT
                 varying vec2 vHighPrecisionZW;
                #endif
                #define NORMAL
                #if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
                    varying vec3 vViewPosition;
                #endif
                #include <common>
                #include <uv_pars_vertex>
                #include <displacementmap_pars_vertex>
                #include <normal_pars_vertex>
                #include <morphtarget_pars_vertex>
                #include <skinning_pars_vertex>
                #include <logdepthbuf_pars_vertex>
                #include <clipping_planes_pars_vertex>
                void main() {
                    #include <uv_vertex>
                    #include <beginnormal_vertex>
                    #include <morphnormal_vertex>
                    #include <skinbase_vertex>
                    #include <skinnormal_vertex>
                    #include <defaultnormal_vertex>
                    #include <normal_vertex>
                    #include <begin_vertex>
                    #include <morphtarget_vertex>
                    #include <skinning_vertex>
                    #include <displacementmap_vertex>
                    #include <project_vertex>
                    #include <logdepthbuf_vertex>
                    #include <clipping_planes_vertex>
                    #if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
                        vViewPosition = - mvPosition.xyz;
                    #endif
                    #ifdef USE_MRT
                        vHighPrecisionZW = gl_Position.zw;
                    #endif 
                    #ifdef USE_UV
                        vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
                    #endif
                }
            `,fragmentShader:`
                 #define NORMAL
                #if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
                    varying vec3 vViewPosition;
                #endif
                #include <packing>
                #include <uv_pars_fragment>
                #include <normal_pars_fragment>
                #include <bumpmap_pars_fragment>
                #include <normalmap_pars_fragment>
                #include <logdepthbuf_pars_fragment>
                #include <clipping_planes_pars_fragment>
                #include <roughnessmap_pars_fragment>
                
                #ifdef USE_MRT
                layout(location = 0) out vec4 gNormal;
                layout(location = 1) out vec4 gDepth;
                
                varying vec2 vHighPrecisionZW;
                #endif
                uniform float roughness;
                void main() {
                    #include <clipping_planes_fragment>
                    #include <logdepthbuf_fragment>
                    #include <normal_fragment_begin>
                    #include <normal_fragment_maps>

                    float roughnessFactor = roughness;
                    
                    if(roughness > 10.0e9){
                        roughnessFactor = 1.;
                    }else{
                        #ifdef useRoughnessMap
                            vec4 texelRoughness = texture2D( roughnessMap, vUv );
                            // reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture
                            roughnessFactor *= texelRoughness.g;
                        #endif
                    }

                    vec3 normalColor = packNormalToRGB( normal );
                    #ifdef USE_MRT
                        float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
                        vec4 depthColor = packDepthToRGBA( fragCoordZ );
                        gNormal = vec4( normalColor, roughnessFactor );
                        gDepth = depthColor;
                    #else
                        gl_FragColor = vec4(normalColor, roughnessFactor);
                    #endif
                }
            `,toneMapped:!1}),this.normalMapType=Wc,this.normalScale=new pe(1,1),Object.defineProperty(this,"glslVersion",{get(){return"USE_MRT"in this.defines?h2:null},set(e){}})}}var _0e=`#define GLSLIFY 1
varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}`,V0e=`#define GLSLIFY 1
varying vec2 vUv;uniform sampler2D inputTexture;uniform sampler2D accumulatedTexture;uniform sampler2D normalTexture;uniform sampler2D depthTexture;uniform sampler2D envMap;uniform mat4 _projectionMatrix;uniform mat4 _inverseProjectionMatrix;uniform mat4 cameraMatrixWorld;uniform float cameraNear;uniform float cameraFar;uniform float rayDistance;uniform float intensity;uniform float maxDepthDifference;uniform float roughnessFade;uniform float maxRoughness;uniform float fade;uniform float thickness;uniform float ior;uniform float samples;uniform float jitter;uniform float jitterRoughness;
#define INVALID_RAY_COORDS vec2(-1.0);
#define EARLY_OUT_COLOR vec4(0.0, 0.0, 0.0, 1.0)
#define FLOAT_EPSILON 0.00001
float nearMinusFar;float nearMulFar;float farMinusNear;
#include <packing>
#include <helperFunctions>
vec2 RayMarch(vec3 dir,inout vec3 hitPos,inout float rayHitDepthDifference);vec2 BinarySearch(in vec3 dir,inout vec3 hitPos,inout float rayHitDepthDifference);float fastGetViewZ(const in float depth);vec3 getIBLRadiance(const in vec3 viewDir,const in vec3 normal,const in float roughness);void main(){vec4 depthTexel=textureLod(depthTexture,vUv,0.0);if(dot(depthTexel.rgb,depthTexel.rgb)<FLOAT_EPSILON){gl_FragColor=EARLY_OUT_COLOR;return;}float unpackedDepth=unpackRGBAToDepth(depthTexel);vec4 normalTexel=textureLod(normalTexture,vUv,0.0);float roughness=normalTexel.a;float specular=1.0-roughness;nearMinusFar=cameraNear-cameraFar;nearMulFar=cameraNear*cameraFar;farMinusNear=cameraFar-cameraNear;normalTexel.rgb=unpackRGBToNormal(normalTexel.rgb);float depth=fastGetViewZ(unpackedDepth);vec3 viewPos=getViewPosition(depth);vec3 viewDir=normalize(viewPos);vec3 viewNormal=normalTexel.xyz;vec3 worldPos=screenSpaceToWorldSpace(vUv,unpackedDepth);vec3 jitt=vec3(0.0);if(jitterRoughness!=0.0||jitter!=0.0){vec3 randomJitter=hash(50.0*samples*worldPos)-0.5;float spread=((2.0-specular)+roughness*jitterRoughness);float jitterMix=jitter*0.25+jitterRoughness*roughness;if(jitterMix>1.0)jitterMix=1.0;jitt=mix(vec3(0.0),randomJitter*spread,jitterMix);}viewNormal+=jitt;float fresnelFactor=fresnel_dielectric(viewDir,viewNormal,ior);vec3 iblRadiance=getIBLRadiance(-viewDir,viewNormal,0.)*fresnelFactor;float lastFrameAlpha=textureLod(accumulatedTexture,vUv,0.0).a;if(roughness>maxRoughness||(roughness>1.0-FLOAT_EPSILON&&roughnessFade>1.0-FLOAT_EPSILON)){gl_FragColor=vec4(iblRadiance,lastFrameAlpha);return;}vec3 reflected=reflect(viewDir,viewNormal);vec3 rayDir=reflected*-viewPos.z;vec3 hitPos=viewPos;float rayHitDepthDifference;vec2 coords=RayMarch(rayDir,hitPos,rayHitDepthDifference);if(coords.x==-1.0){gl_FragColor=vec4(iblRadiance,lastFrameAlpha);return;}vec4 SSRTexel=textureLod(inputTexture,coords.xy,0.0);vec4 SSRTexelReflected=textureLod(accumulatedTexture,coords.xy,0.0);vec3 SSR=SSRTexel.rgb+SSRTexelReflected.rgb;float roughnessFactor=mix(specular,1.0,max(0.0,1.0-roughnessFade));vec2 coordsNDC=(coords.xy*2.0-1.0);float screenFade=0.1;float maxDimension=min(1.0,max(abs(coordsNDC.x),abs(coordsNDC.y)));float reflectionIntensity=1.0-(max(0.0,maxDimension-screenFade)/(1.0-screenFade));reflectionIntensity=max(0.,reflectionIntensity);vec3 finalSSR=mix(iblRadiance,SSR,reflectionIntensity)*roughnessFactor;if(fade!=0.0){vec3 hitWorldPos=screenSpaceToWorldSpace(coords,rayHitDepthDifference);float reflectionDistance=distance(hitWorldPos,worldPos)+1.0;float opacity=1.0/(reflectionDistance*fade*0.1);if(opacity>1.0)opacity=1.0;finalSSR*=opacity;}finalSSR*=fresnelFactor*intensity;finalSSR=min(vec3(1.0),finalSSR);float alpha=hitPos.z==1.0 ? 1.0 : SSRTexelReflected.a;alpha=min(lastFrameAlpha,alpha);gl_FragColor=vec4(finalSSR,alpha);}vec2 RayMarch(vec3 dir,inout vec3 hitPos,inout float rayHitDepthDifference){dir=normalize(dir);dir*=rayDistance/float(steps);float depth;vec4 projectedCoord;vec4 lastProjectedCoord;float unpackedDepth;vec4 depthTexel;for(int i=0;i<steps;i++){hitPos+=dir;projectedCoord=_projectionMatrix*vec4(hitPos,1.0);projectedCoord.xy/=projectedCoord.w;projectedCoord.xy=projectedCoord.xy*0.5+0.5;
#ifndef missedRays
if(projectedCoord.x<0.0||projectedCoord.x>1.0||projectedCoord.y<0.0||projectedCoord.y>1.0){return INVALID_RAY_COORDS;}
#endif
depthTexel=textureLod(depthTexture,projectedCoord.xy,0.0);unpackedDepth=unpackRGBAToDepth(depthTexel);depth=fastGetViewZ(unpackedDepth);rayHitDepthDifference=depth-hitPos.z;if(rayHitDepthDifference>=0.0&&rayHitDepthDifference<thickness){
#if refineSteps == 0
if(dot(depthTexel.rgb,depthTexel.rgb)<FLOAT_EPSILON)return INVALID_RAY_COORDS;
#else
return BinarySearch(dir,hitPos,rayHitDepthDifference);
#endif
}
#ifndef missedRays
if(hitPos.z>0.0){return INVALID_RAY_COORDS;}
#endif
lastProjectedCoord=projectedCoord;}hitPos.z=1.0;
#ifndef missedRays
return INVALID_RAY_COORDS;
#endif
rayHitDepthDifference=unpackedDepth;return projectedCoord.xy;}vec2 BinarySearch(in vec3 dir,inout vec3 hitPos,inout float rayHitDepthDifference){float depth;vec4 projectedCoord;vec2 lastMinProjectedCoordXY;float unpackedDepth;vec4 depthTexel;for(int i=0;i<refineSteps;i++){projectedCoord=_projectionMatrix*vec4(hitPos,1.0);projectedCoord.xy/=projectedCoord.w;projectedCoord.xy=projectedCoord.xy*0.5+0.5;depthTexel=textureLod(depthTexture,projectedCoord.xy,0.0);unpackedDepth=unpackRGBAToDepth(depthTexel);depth=fastGetViewZ(unpackedDepth);rayHitDepthDifference=depth-hitPos.z;dir*=0.5;if(rayHitDepthDifference>0.0){hitPos-=dir;}else{hitPos+=dir;}}if(dot(depthTexel.rgb,depthTexel.rgb)<FLOAT_EPSILON)return INVALID_RAY_COORDS;if(abs(rayHitDepthDifference)>maxDepthDifference)return INVALID_RAY_COORDS;projectedCoord=_projectionMatrix*vec4(hitPos,1.0);projectedCoord.xy/=projectedCoord.w;projectedCoord.xy=projectedCoord.xy*0.5+0.5;rayHitDepthDifference=unpackedDepth;return projectedCoord.xy;}float fastGetViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return nearMulFar/(farMinusNear*depth-cameraFar);
#else
return depth*nearMinusFar-cameraNear;
#endif
}
#include <common>
#include <cube_uv_reflection_fragment>
vec3 getIBLRadiance(const in vec3 viewDir,const in vec3 normal,const in float roughness){
#if defined(ENVMAP_TYPE_CUBE_UV)
vec3 reflectVec=reflect(-viewDir,normal);reflectVec=normalize(mix(reflectVec,normal,roughness*roughness));reflectVec=inverseTransformDirection(reflectVec,viewMatrix);vec4 envMapColor=textureCubeUV(envMap,reflectVec,roughness);return envMapColor.rgb*intensity;
#else
return vec3(0.0);
#endif
}`;class T0e extends Nt{constructor(){super({type:"ReflectionsMaterial",uniforms:{inputTexture:new ye(null),accumulatedTexture:new ye(null),normalTexture:new ye(null),depthTexture:new ye(null),_projectionMatrix:new ye(new qe),_inverseProjectionMatrix:new ye(new qe),cameraMatrixWorld:new ye(new qe),cameraNear:new ye(0),cameraFar:new ye(0),rayDistance:new ye(0),intensity:new ye(0),roughnessFade:new ye(0),fade:new ye(0),thickness:new ye(0),ior:new ye(0),maxDepthDifference:new ye(0),jitter:new ye(0),jitterRoughness:new ye(0),maxRoughness:new ye(0),samples:new ye(0),envMap:new ye(null),envMapPosition:new ye(new D),envMapSize:new ye(new D),viewMatrix:new ye(new qe)},defines:{steps:20,refineSteps:5,CUBEUV_TEXEL_WIDTH:0,CUBEUV_TEXEL_HEIGHT:0,CUBEUV_MAX_MIP:0,vWorldPosition:"worldPos"},fragmentShader:V0e.replace("#include <helperFunctions>",Vj),vertexShader:_0e,toneMapped:!1,depthWrite:!1,depthTest:!1})}}const Tj=n=>{const e=[n],t=[];for(;e.length!==0;){const i=e.shift();i.material&&t.push(i);for(const r of i.children)r.visible&&e.push(r)}return t},N0e=n=>{const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}},lX=(n,e,t)=>{n.uniforms.envMap.value=e;const i=N0e({envMapCubeUVHeight:t});n.defines.ENVMAP_TYPE_CUBE_UV="",n.defines.CUBEUV_TEXEL_WIDTH=i.texelWidth,n.defines.CUBEUV_TEXEL_HEIGHT=i.texelHeight,n.defines.CUBEUV_MAX_MIP=i.maxMip+".0",n.needsUpdate=!0},k0e=()=>{try{const n=document.createElement("canvas");return!!(window.WebGL2RenderingContext&&n.getContext("webgl2"))}catch{return!1}};class L0e extends _i{constructor(e,t={}){super("ReflectionsPass"),this.ssrEffect=void 0,this.cachedMaterials=new WeakMap,this.USE_MRT=!1,this.webgl1DepthPass=null,this.visibleMeshes=[],this.ssrEffect=e,this._scene=e._scene,this._camera=e._camera,this.fullscreenMaterial=new T0e,e._camera.isPerspectiveCamera&&(this.fullscreenMaterial.defines.PERSPECTIVE_CAMERA="");const i=t.width||typeof window<"u"?window.innerWidth:2e3,r=t.height||typeof window<"u"?window.innerHeight:1e3;this.renderTarget=new Qt(i,r,{minFilter:ut,magFilter:ut,type:Pi,depthBuffer:!1}),this.renderPass=new PC(this._scene,this._camera),this.USE_MRT=k0e(),this.USE_MRT?(this.gBuffersRenderTarget=new k_(i,r,2,{minFilter:ut,magFilter:ut}),this.normalTexture=this.gBuffersRenderTarget.texture[0],this.depthTexture=this.gBuffersRenderTarget.texture[1]):(this.webgl1DepthPass=new OV(this._scene,this._camera),this.webgl1DepthPass.renderTarget.minFilter=ut,this.webgl1DepthPass.renderTarget.magFilter=ut,this.webgl1DepthPass.renderTarget.texture.minFilter=ut,this.webgl1DepthPass.renderTarget.texture.magFilter=ut,this.webgl1DepthPass.setSize(typeof window<"u"?window.innerWidth:2e3,typeof window<"u"?window.innerHeight:1e3),this.gBuffersRenderTarget=new Qt(i,r,{minFilter:ut,magFilter:ut}),this.normalTexture=this.gBuffersRenderTarget.texture,this.depthTexture=this.webgl1DepthPass.texture),this.fullscreenMaterial.uniforms.normalTexture.value=this.normalTexture,this.fullscreenMaterial.uniforms.depthTexture.value=this.depthTexture,this.fullscreenMaterial.uniforms.accumulatedTexture.value=this.ssrEffect.temporalResolvePass.accumulatedTexture,this.fullscreenMaterial.uniforms.cameraMatrixWorld.value=this._camera.matrixWorld,this.fullscreenMaterial.uniforms._projectionMatrix.value=this._camera.projectionMatrix,this.fullscreenMaterial.uniforms._inverseProjectionMatrix.value=this._camera.projectionMatrixInverse}setSize(e,t){this.renderTarget.setSize(e*this.ssrEffect.resolutionScale,t*this.ssrEffect.resolutionScale),this.gBuffersRenderTarget.setSize(e*this.ssrEffect.resolutionScale,t*this.ssrEffect.resolutionScale),this.fullscreenMaterial.uniforms.accumulatedTexture.value=this.ssrEffect.temporalResolvePass.accumulatedTexture,this.fullscreenMaterial.needsUpdate=!0}dispose(){this.renderTarget.dispose(),this.gBuffersRenderTarget.dispose(),this.renderPass.dispose(),this.USE_MRT||this.webgl1DepthPass.dispose(),this.fullscreenMaterial.dispose(),this.normalTexture=null,this.depthTexture=null,this.velocityTexture=null}keepMaterialMapUpdated(e,t,i,r){this.ssrEffect[r]?t[i]!==e[i]&&(e[i]=t[i],e.uniforms[i].value=t[i],t[i]?e.defines[r]="":delete e.defines[r],e.needsUpdate=!0):e[i]!==void 0&&(e[i]=void 0,e.uniforms[i].value=void 0,delete e.defines[r],e.needsUpdate=!0)}setMRTMaterialInScene(){this.visibleMeshes=Tj(this._scene);for(const e of this.visibleMeshes)if(e.material){const t=e.material;let[i,r]=this.cachedMaterials.get(e)||[];if(t!==i){r&&r.dispose(),r=new F0e,this.USE_MRT&&(r.defines.USE_MRT=""),r.normalScale=t.normalScale,r.uniforms.normalScale.value=t.normalScale;const s=t.map||t.normalMap||t.roughnessMap||t.metalnessMap;s&&(r.uniforms.uvTransform.value=s.matrix),this.cachedMaterials.set(e,[t,r])}this.keepMaterialMapUpdated(r,t,"normalMap","useNormalMap"),this.keepMaterialMapUpdated(r,t,"roughnessMap","useRoughnessMap"),r.uniforms.roughness.value=this.ssrEffect.selection.size===0||this.ssrEffect.selection.has(e)?t.roughness||0:1e11,e.material=r}}unsetMRTMaterialInScene(){for(const t of this.visibleMeshes){var e;if(((e=t.material)==null?void 0:e.type)==="MRTMaterial"){t.visible=!0;const[i]=this.cachedMaterials.get(t);t.material=i}}}render(e,t){this.setMRTMaterialInScene(),e.setRenderTarget(this.gBuffersRenderTarget),this.renderPass.render(e,this.gBuffersRenderTarget),this.unsetMRTMaterialInScene(),this.USE_MRT||this.webgl1DepthPass.renderPass.render(e,this.webgl1DepthPass.renderTarget),this.fullscreenMaterial.uniforms.inputTexture.value=t.texture,this.fullscreenMaterial.uniforms.samples.value=this.ssrEffect.temporalResolvePass.samples,this.fullscreenMaterial.uniforms.cameraNear.value=this._camera.near,this.fullscreenMaterial.uniforms.cameraFar.value=this._camera.far,this.fullscreenMaterial.uniforms.viewMatrix.value.copy(this._camera.matrixWorldInverse),e.setRenderTarget(this.renderTarget),e.render(this.scene,this.camera)}}const cX={intensity:1,exponent:1,distance:10,fade:0,roughnessFade:1,thickness:10,ior:1.45,maxRoughness:1,maxDepthDifference:10,blend:.9,correction:1,correctionRadius:1,blur:.5,blurKernel:1,blurSharpness:10,jitter:0,jitterRoughness:0,steps:20,refineSteps:5,missedRays:!0,useNormalMap:!0,useRoughnessMap:!0,resolutionScale:1,velocityResolutionScale:1};var H0e=`#define GLSLIFY 1
varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}`,z0e=`#define GLSLIFY 1
uniform sampler2D inputTexture;uniform sampler2D accumulatedTexture;uniform sampler2D velocityTexture;uniform sampler2D lastVelocityTexture;uniform float blend;uniform float correction;uniform float exponent;uniform float samples;uniform vec2 invTexSize;uniform mat4 curInverseProjectionMatrix;uniform mat4 curCameraMatrixWorld;uniform mat4 prevInverseProjectionMatrix;uniform mat4 prevCameraMatrixWorld;varying vec2 vUv;
#define MAX_NEIGHBOR_DEPTH_DIFFERENCE 0.001
#define FLOAT_EPSILON 0.00001
#define FLOAT_ONE_MINUS_EPSILON 0.99999
vec3 transformexponent;vec3 undoColorTransformExponent;vec3 transformColor(vec3 color){if(exponent==1.0)return color;return pow(abs(color),transformexponent);}vec3 undoColorTransform(vec3 color){if(exponent==1.0)return color;return max(pow(abs(color),undoColorTransformExponent),vec3(0.0));}void main(){if(exponent!=1.0){transformexponent=vec3(1.0/exponent);undoColorTransformExponent=vec3(exponent);}vec4 inputTexel=textureLod(inputTexture,vUv,0.0);vec4 accumulatedTexel;vec3 inputColor=transformColor(inputTexel.rgb);vec3 accumulatedColor;float alpha=inputTexel.a;float velocityDisocclusion;bool didReproject=false;
#ifdef boxBlur
vec3 boxBlurredColor=inputTexel.rgb;
#endif
vec4 velocity=textureLod(velocityTexture,vUv,0.0);bool isMoving=alpha<1.0||dot(velocity.xy,velocity.xy)>0.0;if(isMoving){vec3 minNeighborColor=inputColor;vec3 maxNeighborColor=inputColor;vec3 col;vec2 neighborUv;vec2 reprojectedUv=vUv-velocity.xy;vec4 lastVelocity=textureLod(lastVelocityTexture,reprojectedUv,0.0);float depth=velocity.b;float closestDepth=depth;float lastClosestDepth=lastVelocity.b;float neighborDepth;float lastNeighborDepth;for(int x=-correctionRadius;x<=correctionRadius;x++){for(int y=-correctionRadius;y<=correctionRadius;y++){if(x!=0||y!=0){neighborUv=vUv+vec2(x,y)*invTexSize;vec4 neigborVelocity=textureLod(velocityTexture,neighborUv,0.0);neighborDepth=neigborVelocity.b;col=textureLod(inputTexture,neighborUv,0.0).xyz;int absX=abs(x);int absY=abs(y);
#ifdef dilation
if(absX==1&&absY==1){if(neighborDepth>closestDepth){velocity=neigborVelocity;closestDepth=neighborDepth;}vec4 lastNeighborVelocity=textureLod(velocityTexture,vUv+vec2(x,y)*invTexSize,0.0);lastNeighborDepth=lastNeighborVelocity.b;if(neighborDepth>closestDepth){lastVelocity=lastNeighborVelocity;lastClosestDepth=lastNeighborDepth;}}
#endif
if(abs(depth-neighborDepth)<MAX_NEIGHBOR_DEPTH_DIFFERENCE){
#ifdef boxBlur
if(absX<=2&&absY<=2)boxBlurredColor+=col;
#endif
col=transformColor(col);minNeighborColor=min(col,minNeighborColor);maxNeighborColor=max(col,maxNeighborColor);}}}}float velocityLength=length(lastVelocity.xy-velocity.xy);velocityDisocclusion=(velocityLength-0.000005)*10.0;velocityDisocclusion*=velocityDisocclusion;reprojectedUv=vUv-velocity.xy;
#ifdef boxBlur
float pxRadius=correctionRadius>5 ? 121.0 : pow(float(correctionRadius*2+1),2.0);boxBlurredColor/=pxRadius;boxBlurredColor=transformColor(boxBlurredColor);
#endif
if(reprojectedUv.x>=0.0&&reprojectedUv.x<=1.0&&reprojectedUv.y>=0.0&&reprojectedUv.y<=1.0){accumulatedTexel=textureLod(accumulatedTexture,reprojectedUv,0.0);accumulatedColor=transformColor(accumulatedTexel.rgb);vec3 clampedColor=clamp(accumulatedColor,minNeighborColor,maxNeighborColor);accumulatedColor=mix(accumulatedColor,clampedColor,correction);didReproject=true;}else{
#ifdef boxBlur
accumulatedColor=boxBlurredColor;
#else
accumulatedColor=inputColor;
#endif
}if(velocity.r>FLOAT_ONE_MINUS_EPSILON&&velocity.g>FLOAT_ONE_MINUS_EPSILON){alpha=0.0;velocityDisocclusion=1.0;}}else{accumulatedColor=transformColor(textureLod(accumulatedTexture,vUv,0.0).rgb);}vec3 outputColor=inputColor;
#include <custom_compose_shader>
gl_FragColor=vec4(undoColorTransform(outputColor),alpha);}`;class X0e extends Nt{constructor(e){const t=z0e.replace("#include <custom_compose_shader>",e);super({type:"TemporalResolveMaterial",uniforms:{inputTexture:new ye(null),accumulatedTexture:new ye(null),velocityTexture:new ye(null),lastVelocityTexture:new ye(null),samples:new ye(1),blend:new ye(.5),correction:new ye(1),exponent:new ye(1),invTexSize:new ye(new pe)},defines:{correctionRadius:1},vertexShader:H0e,fragmentShader:t})}}const Y0e=`
		#ifdef USE_SKINNING
		#ifdef BONE_TEXTURE
			uniform sampler2D prevBoneTexture;
			mat4 getPrevBoneMatrix( const in float i ) {
				float j = i * 4.0;
				float x = mod( j, float( boneTextureSize ) );
				float y = floor( j / float( boneTextureSize ) );
				float dx = 1.0 / float( boneTextureSize );
				float dy = 1.0 / float( boneTextureSize );
				y = dy * ( y + 0.5 );
				vec4 v1 = texture2D( prevBoneTexture, vec2( dx * ( x + 0.5 ), y ) );
				vec4 v2 = texture2D( prevBoneTexture, vec2( dx * ( x + 1.5 ), y ) );
				vec4 v3 = texture2D( prevBoneTexture, vec2( dx * ( x + 2.5 ), y ) );
				vec4 v4 = texture2D( prevBoneTexture, vec2( dx * ( x + 3.5 ), y ) );
				mat4 bone = mat4( v1, v2, v3, v4 );
				return bone;
			}
		#else
			uniform mat4 prevBoneMatrices[ MAX_BONES ];
			mat4 getPrevBoneMatrix( const in float i ) {
				mat4 bone = prevBoneMatrices[ int(i) ];
				return bone;
			}
		#endif
		#endif
`,K0e=`
		vec3 transformed;

		// Get the normal
		${bt.skinbase_vertex}
		${bt.beginnormal_vertex}
		${bt.skinnormal_vertex}
		${bt.defaultnormal_vertex}

		// Get the current vertex position
		transformed = vec3( position );
		${bt.skinning_vertex}
		newPosition = velocityMatrix * vec4( transformed, 1.0 );

		// Get the previous vertex position
		transformed = vec3( position );
		${bt.skinbase_vertex.replace(/mat4 /g,"").replace(/getBoneMatrix/g,"getPrevBoneMatrix")}
		${bt.skinning_vertex.replace(/vec4 /g,"")}
		prevPosition = prevVelocityMatrix * vec4( transformed, 1.0 );

		gl_Position = newPosition;
`;class D0e extends Nt{constructor(){super({uniforms:{prevVelocityMatrix:{value:new qe},velocityMatrix:{value:new qe},prevBoneTexture:{value:null},interpolateGeometry:{value:0},intensity:{value:1},boneTexture:{value:null},alphaTest:{value:0},map:{value:null},alphaMap:{value:null},opacity:{value:1}},vertexShader:`
                    #define MAX_BONES 1024
                    
                    ${bt.skinning_pars_vertex}
                    ${Y0e}
        
                    uniform mat4 velocityMatrix;
                    uniform mat4 prevVelocityMatrix;
                    uniform float interpolateGeometry;
                    varying vec4 prevPosition;
                    varying vec4 newPosition;
					varying vec2 vHighPrecisionZW;
        
                    void main() {
        
                        ${K0e}

						vHighPrecisionZW = gl_Position.zw;
        
                    }`,fragmentShader:`
                    uniform float intensity;
                    varying vec4 prevPosition;
                    varying vec4 newPosition;
					varying vec2 vHighPrecisionZW;
        
                    void main() {
						#ifdef FULL_MOVEMENT
						gl_FragColor = vec4( 1., 1., 1. - gl_FragCoord.z, 0. );
						return;
						#endif

                        vec2 pos0 = (prevPosition.xy / prevPosition.w) * 0.5 + 0.5;
                        vec2 pos1 = (newPosition.xy / newPosition.w) * 0.5 + 0.5;
        
                        vec2 vel = pos1 - pos0;

						float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
                        
                        gl_FragColor = vec4( vel, 1. - fragCoordZ, 0. );
        
                    }`}),this.isVelocityMaterial=!0}}const P0e=new Ke(0),U0e=["visible","wireframe","side"];class Q0e extends _i{constructor(e,t){var i,r;super("VelocityPass"),this.cachedMaterials=new WeakMap,this.lastCameraTransform={position:new D,quaternion:new xn},this.visibleMeshes=[],this.renderedMeshesThisFrame=0,this.renderedMeshesLastFrame=0,this._scene=e,this._camera=t,this.renderTarget=new Qt(((i=window)==null?void 0:i.innerWidth)||1e3,((r=window)==null?void 0:r.innerHeight)||1e3,{type:Pi})}setVelocityMaterialInScene(){this.renderedMeshesThisFrame=0,this.visibleMeshes=Tj(this._scene);for(const i of this.visibleMeshes){var e;const r=i.material;let[s,o]=this.cachedMaterials.get(i)||[];if(r!==s){var t;o=new D0e,o.lastMatrixWorld=new qe,i.material=o,(t=i.skeleton)!=null&&t.boneTexture&&this.saveBoneTexture(i),this.cachedMaterials.set(i,[r,o])}if(o.uniforms.velocityMatrix.value.multiplyMatrices(this._camera.projectionMatrix,i.modelViewMatrix),i.userData.needsUpdatedReflections||r.map instanceof r4?("FULL_MOVEMENT"in o.defines||(o.needsUpdate=!0),o.defines.FULL_MOVEMENT=""):"FULL_MOVEMENT"in o.defines&&(delete o.defines.FULL_MOVEMENT,o.needsUpdate=!0),i.visible=this.cameraMovedThisFrame||!i.matrixWorld.equals(o.lastMatrixWorld)||i.skeleton||"FULL_MOVEMENT"in o.defines,i.material=o,!!i.visible){this.renderedMeshesThisFrame++;for(const a of U0e)o[a]=r[a];(e=i.skeleton)!=null&&e.boneTexture&&(o.defines.USE_SKINNING="",o.defines.BONE_TEXTURE="",o.uniforms.boneTexture.value=i.skeleton.boneTexture)}}}saveBoneTexture(e){let t=e.material.uniforms.prevBoneTexture.value;if(t&&t.image.width===e.skeleton.boneTexture.width)t=e.material.uniforms.prevBoneTexture.value,t.image.data.set(e.skeleton.boneTexture.image.data);else{var i;(i=t)==null||i.dispose();const r=e.skeleton.boneTexture.image.data.slice(),s=e.skeleton.boneTexture.image.width;t=new pc(r,s,s,Yn,Hn),e.material.uniforms.prevBoneTexture.value=t,t.needsUpdate=!0}}unsetVelocityMaterialInScene(){for(const t of this.visibleMeshes)if(t.material.isVelocityMaterial){var e;t.visible=!0,t.material.lastMatrixWorld.copy(t.matrixWorld),t.material.uniforms.prevVelocityMatrix.value.multiplyMatrices(this._camera.projectionMatrix,t.modelViewMatrix),(e=t.skeleton)!=null&&e.boneTexture&&this.saveBoneTexture(t),t.material=this.cachedMaterials.get(t)[0]}}setSize(e,t){this.renderTarget.setSize(e,t)}renderVelocity(e){if(e.setRenderTarget(this.renderTarget),this.renderedMeshesThisFrame>0){const{background:t}=this._scene;this._scene.background=P0e,e.render(this._scene,this._camera),this._scene.background=t}else e.clearColor()}checkCameraMoved(){const e=this.lastCameraTransform.position.distanceToSquared(this._camera.position),t=8*(1-this.lastCameraTransform.quaternion.dot(this._camera.quaternion));return e>1e-6||t>1e-6?(this.lastCameraTransform.position.copy(this._camera.position),this.lastCameraTransform.quaternion.copy(this._camera.quaternion),!0):!1}render(e){this.cameraMovedThisFrame=this.checkCameraMoved(),this.setVelocityMaterialInScene(),(this.renderedMeshesThisFrame>0||this.renderedMeshesLastFrame>0)&&this.renderVelocity(e),this.unsetVelocityMaterialInScene(),this.renderedMeshesLastFrame=this.renderedMeshesThisFrame}}const gX=new pe;class O0e extends _i{constructor(e,t,i,r={}){super("TemporalResolvePass"),this.velocityPass=null,this.velocityResolutionScale=1,this.samples=1,this.lastCameraTransform={position:new D,quaternion:new xn},this._scene=e,this._camera=t,this.renderTarget=new Qt(1,1,{minFilter:ut,magFilter:ut,type:Pi,depthBuffer:!1}),this.velocityPass=new Q0e(e,t),this.fullscreenMaterial=new X0e(i),this.fullscreenMaterial.defines.correctionRadius=r.correctionRadius||1,r.dilation&&(this.fullscreenMaterial.defines.dilation=""),r.boxBlur&&(this.fullscreenMaterial.defines.boxBlur=""),this.setupFramebuffers(1,1),this.checkCanUseSharedVelocityTexture()}dispose(){this._scene.userData.velocityTexture===this.velocityPass.renderTarget.texture&&(delete this._scene.userData.velocityTexture,delete this._scene.userData.lastVelocityTexture),this.renderTarget.dispose(),this.accumulatedTexture.dispose(),this.fullscreenMaterial.dispose(),this.velocityPass.dispose()}setSize(e,t){this.renderTarget.setSize(e,t),this.velocityPass.setSize(e*this.velocityResolutionScale,t*this.velocityResolutionScale),this.velocityPass.renderTarget.texture.minFilter=this.velocityResolutionScale===1?Zt:ut,this.velocityPass.renderTarget.texture.magFilter=this.velocityResolutionScale===1?Zt:ut,this.velocityPass.renderTarget.texture.needsUpdate=!0,this.fullscreenMaterial.uniforms.invTexSize.value.set(1/e,1/t),this.setupFramebuffers(e,t)}setupFramebuffers(e,t){this.accumulatedTexture&&this.accumulatedTexture.dispose(),this.lastVelocityTexture&&this.lastVelocityTexture.dispose(),this.accumulatedTexture=new m3(e,t,Yn),this.accumulatedTexture.minFilter=ut,this.accumulatedTexture.magFilter=ut,this.accumulatedTexture.type=Pi,this.lastVelocityTexture=new m3(e*this.velocityResolutionScale,t*this.velocityResolutionScale,Yn),this.lastVelocityTexture.minFilter=this.velocityResolutionScale===1?Zt:ut,this.lastVelocityTexture.magFilter=this.velocityResolutionScale===1?Zt:ut,this.lastVelocityTexture.type=Pi,this.fullscreenMaterial.uniforms.accumulatedTexture.value=this.accumulatedTexture,this.fullscreenMaterial.uniforms.lastVelocityTexture.value=this.lastVelocityTexture,this.fullscreenMaterial.needsUpdate=!0}checkCanUseSharedVelocityTexture(){return this._scene.userData.velocityTexture&&this.velocityPass.renderTarget.texture!==this._scene.userData.velocityTexture?this.velocityPass.renderTarget.texture===this.fullscreenMaterial.uniforms.velocityTexture.value&&(this.fullscreenMaterial.uniforms.lastVelocityTexture.value=this._scene.userData.lastVelocityTexture,this.fullscreenMaterial.uniforms.velocityTexture.value=this._scene.userData.velocityTexture,this.fullscreenMaterial.needsUpdate=!0):this.velocityPass.renderTarget.texture!==this.fullscreenMaterial.uniforms.velocityTexture.value&&(this.fullscreenMaterial.uniforms.velocityTexture.value=this.velocityPass.renderTarget.texture,this.fullscreenMaterial.uniforms.lastVelocityTexture.value=this.lastVelocityTexture,this.fullscreenMaterial.needsUpdate=!0,this._scene.userData.velocityTexture||(this._scene.userData.velocityTexture=this.velocityPass.renderTarget.texture,this._scene.userData.lastVelocityTexture=this.lastVelocityTexture)),this.velocityPass.renderTarget.texture!==this.fullscreenMaterial.uniforms.velocityTexture.value}checkNeedsResample(){const e=this.lastCameraTransform.position.distanceToSquared(this._camera.position),t=8*(1-this.lastCameraTransform.quaternion.dot(this._camera.quaternion));(e>1e-6||t>1e-6)&&(this.samples=1,this.lastCameraTransform.position.copy(this._camera.position),this.lastCameraTransform.quaternion.copy(this._camera.quaternion))}render(e){this.samples++,this.checkNeedsResample(),this.fullscreenMaterial.uniforms.samples.value=this.samples,e.setRenderTarget(this.renderTarget),e.render(this.scene,this.camera),e.copyFramebufferToTexture(gX,this.accumulatedTexture),e.setRenderTarget(this.velocityPass.renderTarget),e.copyFramebufferToTexture(gX,this.lastVelocityTexture)}}const uX=function(e,t){let i=1,r=0;for(;e>0;)i/=t,r+=i*(e%t),e=~~(e/t);return r},J0e=n=>{const e=[];let t=1;const i=t+n;for(;t<i;t++)e.push([uX(t,2)-.5,uX(t,3)-.5]);return e};function dX(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const j0e=`
#if defined( USE_ENVMAP ) || defined(  ) || defined ( USE_SHADOWMAP )
    vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );

    #ifdef BOX_PROJECTED_ENV_MAP
        vWorldPosition = worldPosition.xyz;
    #endif
#endif
`,q0e=`
#ifdef BOX_PROJECTED_ENV_MAP
    uniform vec3 envMapSize;
    uniform vec3 envMapPosition;
    varying vec3 vWorldPosition;
    
    vec3 parallaxCorrectNormal( vec3 v, vec3 cubeSize, vec3 cubePos ) {
        vec3 nDir = normalize( v );

        vec3 rbmax = ( .5 * cubeSize + cubePos - vWorldPosition ) / nDir;
        vec3 rbmin = ( -.5 * cubeSize + cubePos - vWorldPosition ) / nDir;

        vec3 rbminmax;

        rbminmax.x = ( nDir.x > 0. ) ? rbmax.x : rbmin.x;
        rbminmax.y = ( nDir.y > 0. ) ? rbmax.y : rbmin.y;
        rbminmax.z = ( nDir.z > 0. ) ? rbmax.z : rbmin.z;

        float correction = min( min( rbminmax.x, rbminmax.y ), rbminmax.z );
        vec3 boxIntersection = vWorldPosition + nDir * correction;
        
        return boxIntersection - cubePos;
    }
#endif
`,$0e=`
#ifdef BOX_PROJECTED_ENV_MAP
    worldNormal = parallaxCorrectNormal( worldNormal, envMapSize, envMapPosition );
#endif
`,eye=`
#ifdef BOX_PROJECTED_ENV_MAP
    reflectVec = parallaxCorrectNormal( reflectVec, envMapSize, envMapPosition );
#endif
`;function tye(n,e,t){n.defines.BOX_PROJECTED_ENV_MAP="",n.uniforms.envMapPosition={value:e},n.uniforms.envMapSize={value:t};const i=new RegExp(dX("vec3 worldNormal = inverseTransformDirection ( normal , viewMatrix ) ;").replaceAll(" ","\\s*"),"g"),r=new RegExp(dX("reflectVec = inverseTransformDirection ( reflectVec , viewMatrix ) ;").replaceAll(" ","\\s*"),"g");n.vertexShader=`varying vec3 vWorldPosition;
`+n.vertexShader.replace("#include <worldpos_vertex>",j0e),n.fragmentShader=q0e+`
`+n.fragmentShader.replace("#include <envmap_physical_pars_fragment>",bt.envmap_physical_pars_fragment).replace(i,`vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
                ${$0e}`).replace(r,`reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
                ${eye}`)}const nye=E0e.replace("#include <helperFunctions>",Vj).replace("#include <boxBlur>",M0e),iye=["blur","blurSharpness","blurKernel"],rye=new sv(1);let oG;class sye extends Wr{constructor(e,t,i=cX){super("SSREffect",nye,{type:"FinalSSRMaterial",uniforms:new Map([["reflectionsTexture",new ye(null)],["blur",new ye(0)],["blurSharpness",new ye(0)],["blurKernel",new ye(0)]]),defines:new Map([["RENDER_MODE","0"]])}),this.haltonSequence=J0e(1024),this.haltonIndex=0,this.selection=new JV,this.lastSize=void 0,this.cubeCamera=new z_(.001,1e3,rye),this.usingBoxProjectedEnvMap=!1,this._scene=e,this._camera=t,i=aW({},cX,i,{boxBlur:!0,dilation:!0}),this.temporalResolvePass=new O0e(e,t,W0e,i),this.uniforms.get("reflectionsTexture").value=this.temporalResolvePass.renderTarget.texture,this.reflectionsPass=new L0e(this,i),this.temporalResolvePass.fullscreenMaterial.uniforms.inputTexture.value=this.reflectionsPass.renderTarget.texture,this.lastSize={width:i.width,height:i.height,resolutionScale:i.resolutionScale,velocityResolutionScale:i.velocityResolutionScale},this.setSize(i.width,i.height),this.makeOptionsReactive(i)}makeOptionsReactive(e){let t=!1;const i=this.reflectionsPass.fullscreenMaterial.uniforms,r=Object.keys(i);for(const s of Object.keys(e))Object.defineProperty(this,s,{get(){return e[s]},set(o){if(!(e[s]===o&&t))switch(e[s]=o,iye.includes(s)||this.setSize(this.lastSize.width,this.lastSize.height,!0),s){case"resolutionScale":this.setSize(this.lastSize.width,this.lastSize.height);break;case"velocityResolutionScale":this.temporalResolvePass.velocityResolutionScale=o,this.setSize(this.lastSize.width,this.lastSize.height,!0);break;case"blur":this.uniforms.get("blur").value=o;break;case"blurSharpness":this.uniforms.get("blurSharpness").value=o;break;case"blurKernel":this.uniforms.get("blurKernel").value=o;break;case"steps":this.reflectionsPass.fullscreenMaterial.defines.steps=parseInt(o),this.reflectionsPass.fullscreenMaterial.needsUpdate=t;break;case"refineSteps":this.reflectionsPass.fullscreenMaterial.defines.refineSteps=parseInt(o),this.reflectionsPass.fullscreenMaterial.needsUpdate=t;break;case"missedRays":o?this.reflectionsPass.fullscreenMaterial.defines.missedRays="":delete this.reflectionsPass.fullscreenMaterial.defines.missedRays,this.reflectionsPass.fullscreenMaterial.needsUpdate=t;break;case"correctionRadius":this.temporalResolvePass.fullscreenMaterial.defines.correctionRadius=Math.round(o),this.temporalResolvePass.fullscreenMaterial.needsUpdate=t;break;case"blend":this.temporalResolvePass.fullscreenMaterial.uniforms.blend.value=o;break;case"correction":this.temporalResolvePass.fullscreenMaterial.uniforms.correction.value=o;break;case"exponent":this.temporalResolvePass.fullscreenMaterial.uniforms.exponent.value=o;break;case"distance":i.rayDistance.value=o;default:r.includes(s)&&(i[s].value=o)}}}),this[s]=e[s];t=!0}setSize(e,t,i=!1){!i&&e===this.lastSize.width&&t===this.lastSize.height&&this.resolutionScale===this.lastSize.resolutionScale&&this.velocityResolutionScale===this.lastSize.velocityResolutionScale||(this.temporalResolvePass.setSize(e,t),this.reflectionsPass.setSize(e,t),this.lastSize={width:e,height:t,resolutionScale:this.resolutionScale,velocityResolutionScale:this.velocityResolutionScale})}generateBoxProjectedEnvMapFallback(e,t=new D,i=new D,r=512){this.cubeCamera.renderTarget.dispose(),this.cubeCamera.renderTarget=new sv(r),this.cubeCamera.position.copy(t),this.cubeCamera.updateMatrixWorld(),this.cubeCamera.update(e,this._scene),oG||(oG=new I2(e),oG.compileCubemapShader());const s=oG.fromCubemap(this.cubeCamera.renderTarget.texture).texture;s.minFilter=ut,s.magFilter=ut;const o=this.reflectionsPass.fullscreenMaterial;return tye(o,t,i),o.fragmentShader=o.fragmentShader.replace("vec3 worldPos","worldPos").replace("varying vec3 vWorldPosition;","vec3 worldPos;"),o.uniforms.envMapPosition.value.copy(t),o.uniforms.envMapSize.value.copy(i),lX(o,s,r),this.usingBoxProjectedEnvMap=!0,s}setIBLRadiance(e,t){this._scene.traverse(i=>{if(i.material){var r;const s=(r=t.properties.get(i.material))==null?void 0:r.uniforms;s&&"disableIBLRadiance"in s&&(s.disableIBLRadiance.value=e)}})}deleteBoxProjectedEnvMapFallback(){const e=this.reflectionsPass.fullscreenMaterial;e.uniforms.envMap.value=null,e.fragmentShader=e.fragmentShader.replace("worldPos = ","vec3 worldPos = "),delete e.defines.BOX_PROJECTED_ENV_MAP,e.needsUpdate=!0,this.usingBoxProjectedEnvMap=!1}dispose(){super.dispose(),this.reflectionsPass.dispose(),this.temporalResolvePass.dispose()}update(e,t){if(!this.usingBoxProjectedEnvMap&&this._scene.environment){const a=this.reflectionsPass.fullscreenMaterial;let l=null;if(this._scene.traverse(c=>{if(!l&&c.material&&!c.material.envMap){const g=e.properties.get(c.material);"envMap"in g&&g.envMap instanceof Pn&&(l=g.envMap)}}),l){const c=this._scene.environment.image.height;lX(a,l,c)}}this.haltonIndex=(this.haltonIndex+1)%this.haltonSequence.length;const[i,r]=this.haltonSequence[this.haltonIndex],{width:s,height:o}=this.lastSize;this.temporalResolvePass.velocityPass.render(e),this._camera.setViewOffset&&this._camera.setViewOffset(s,o,i,r,s,o),this.reflectionsPass.render(e,t),this.temporalResolvePass.render(e),this._camera.clearViewOffset()}static patchDirectEnvIntensity(e=0){e===0?bt.envmap_physical_pars_fragment=bt.envmap_physical_pars_fragment.replace("vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {","vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) { return vec3(0.0);"):bt.envmap_physical_pars_fragment=bt.envmap_physical_pars_fragment.replace("vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );","vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness ) * "+e.toFixed(5)+";")}}const jV=M.createContext(null),Md=M.createContext(null),oye=L.memo(M.forwardRef(({children:n,camera:e,scene:t,resolutionScale:i,enabled:r=!0,renderPriority:s=1,autoClear:o=!0,depthBuffer:a,disableNormalPass:l,stencilBuffer:c,multisampling:g=8,frameBufferType:u=Pi},d)=>{const{gl:h,scene:f,camera:I,size:A}=Bt(),p=t||f,y=e||I,[v,b,w]=M.useMemo(()=>{const R=c0e(),Z=new Ope(h,{depthBuffer:a,stencilBuffer:c,multisampling:g>0&&R?g:0,frameBufferType:u});Z.addPass(new PC(p,y));let W=null,F=null;return l||(F=new Ppe(p,y),F.enabled=!1,Z.addPass(F),i!==void 0&&R&&(W=new Mj({normalBuffer:F.texture,resolutionScale:i}),W.enabled=!1,Z.addPass(W))),[Z,F,W]},[y,h,a,c,g,u,p,l,i]);M.useEffect(()=>v==null?void 0:v.setSize(A.width,A.height),[v,A]),yn((R,Z)=>{if(r){const W=h.autoClear;h.autoClear=o,c&&!o&&h.clearStencil(),v.render(Z),h.autoClear=W}},r?s:0);const G=M.useRef(null),x=sde(G);M.useLayoutEffect(()=>{const R=[];if(G.current&&x.current&&v){const Z=x.current.objects;for(let W=0;W<Z.length;W++){const F=Z[W];if(F instanceof Wr){const T=[];for(;Z[W]instanceof Wr;)T.push(Z[W++]);W--;const V=new Xpe(y,...T);R.push(V)}else F instanceof _i&&R.push(F)}for(const W of R)v==null||v.addPass(W);b&&(b.enabled=!0),w&&(w.enabled=!0)}return()=>{for(const Z of R)v==null||v.removePass(Z);b&&(b.enabled=!1),w&&(w.enabled=!1)}},[v,n,y,b,w,x]);const B=M.useMemo(()=>({composer:v,normalPass:b,downSamplingPass:w,resolutionScale:i,camera:y,scene:p}),[v,b,w,i,y,p]);return M.useImperativeHandle(d,()=>v,[v]),We(Md.Provider,{value:B,children:We("group",{ref:G,children:n})})})),Uu=n=>typeof n=="object"&&n!=null&&"current"in n?n.current:n;let aye=0;const hX=new WeakMap,lye=(n,e)=>L.forwardRef(function({blendFunction:i=e==null?void 0:e.blendFunction,opacity:r=e==null?void 0:e.opacity,...s},o){let a=hX.get(n);if(!a){const g=`@react-three/postprocessing/${n.name}-${aye++}`;Zd({[g]:n}),hX.set(n,a=g)}const l=Bt(g=>g.camera),c=L.useMemo(()=>{var g,u;return[...(g=e==null?void 0:e.args)!=null?g:[],...(u=s.args)!=null?u:[{...e,...s}]]},[JSON.stringify(s)]);return We(a,{camera:l,"blendMode-blendFunction":i,"blendMode-opacity-value":r,...s,ref:o,args:c})}),s0=(n,e)=>{const t=n[e];return L.useMemo(()=>typeof t=="number"?new pe(t,t):t?new pe(...t):new pe,[t])},cye=M.forwardRef(function({target:e,depthTexture:t,...i},r){const s=Bt(l=>l.invalidate),{camera:o}=M.useContext(Md),a=M.useMemo(()=>{const l=new Lme(o,i),c=l.maskPass.getFullscreenMaterial();return c.maskFunction=T0.MULTIPLY_RGB_SET_ALPHA,l},[o,i]);return M.useLayoutEffect(()=>{if(e&&typeof e!="number"){const l=e instanceof D?new D().set(e.x,e.y,e.z):new D().set(e[0],e[1],e[2]);a.target=l}t&&a.setDepthTexture(t.texture,t.packing),s()},[e,t,a]),We("primitive",{ref:r,object:a,dispose:null})});M.forwardRef(({target:n=void 0,mouse:e=!1,debug:t=void 0,manual:i=!1,smoothTime:r=.25,...s},o)=>{const a=M.useRef(null),l=M.useRef(null),c=M.useRef(null),g=Bt(({scene:w})=>w),u=Bt(({pointer:w})=>w),{composer:d,camera:h}=M.useContext(Md),[f]=M.useState(()=>new Hpe),[I]=M.useState(()=>new Zj);M.useEffect(()=>(d.addPass(f),d.addPass(I),()=>{d.removePass(f),d.removePass(I)}),[d,f,I]),M.useEffect(()=>()=>{f.dispose(),I.dispose()},[f,I]);const[A]=M.useState(()=>new D(0,0,0)),[p]=M.useState(()=>new D(0,0,0)),y=M.useCallback(async(w,G)=>(p.x=w,p.y=G,p.z=await f.readDepth(p),p.z=p.z*2-1,1-p.z>1e-7?p.unproject(h):!1),[p,f,h]),v=M.useCallback(async(w,G=!0)=>{var x;if(n)A.set(...n);else{const{x:B,y:R}=e?u:{x:0,y:0},Z=await y(B,R);Z&&A.copy(Z)}G&&((x=a.current)!=null&&x.target)&&(r>0&&w>0?Z0e.damp3(a.current.target,A,r,w):a.current.target.copy(A))},[n,A,e,y,r,u]);yn(async(w,G)=>{var x;i||v(G),l.current&&l.current.position.copy(A),c.current&&((x=a.current)!=null&&x.target)&&c.current.position.copy(a.current.target)});const b=M.useMemo(()=>({dofRef:a,hitpoint:A,update:v}),[A,v]);return M.useImperativeHandle(o,()=>b,[b]),cn(O0,{children:[t?yd(cn(O0,{children:[cn("mesh",{ref:l,children:[We("sphereGeometry",{args:[t,16,16]}),We("meshBasicMaterial",{color:"#00ff00",opacity:1,transparent:!0,depthWrite:!1})]}),cn("mesh",{ref:c,children:[We("sphereGeometry",{args:[t/2,16,16]}),We("meshBasicMaterial",{color:"#00ff00",opacity:.5,transparent:!0,depthWrite:!1})]})]}),g):null,We(cye,{ref:a,...s,target:A})]})});M.forwardRef(function(e,t){const i=s0(e,"offset"),r=M.useMemo(()=>new Nme({...e,offset:i}),[i,e]);return We("primitive",{ref:t,object:r,dispose:null})});M.forwardRef(function({blendFunction:e=Rt.NORMAL},t){const i=M.useMemo(()=>new _me(e),[e]);return We("primitive",{ref:t,object:i,dispose:null})});M.forwardRef(function({active:e=!0,...t},i){const r=Bt(g=>g.invalidate),s=s0(t,"delay"),o=s0(t,"duration"),a=s0(t,"strength"),l=s0(t,"chromaticAberrationOffset"),c=M.useMemo(()=>new Xme({...t,delay:s,duration:o,strength:a,chromaticAberrationOffset:l}),[s,o,t,a,l]);return M.useLayoutEffect(()=>{c.mode=e?t.mode||Rh.SPORADIC:Rh.DISABLED,r()},[e,c,r,t.mode]),M.useEffect(()=>()=>{c.dispose()},[c]),We("primitive",{ref:i,object:c,dispose:null})});M.forwardRef(function(e,t){const{camera:i}=M.useContext(Md),r=M.useMemo(()=>new Kme(i,Uu(e.sun),e),[i,e]);return M.useLayoutEffect(()=>void(r.lightSource=Uu(e.sun)),[r,e.sun]),We("primitive",{ref:t,object:r,dispose:null})});M.forwardRef(function({size:e,...t},i){const r=Bt(o=>o.invalidate),s=M.useMemo(()=>new Pme(t),[t]);return M.useLayoutEffect(()=>{e&&s.setSize(e.width,e.height),r()},[s,e]),We("primitive",{ref:i,object:s,dispose:null})});const gye=lye(jme,{blendFunction:Rt.COLOR_DODGE});M.forwardRef(function({selection:e=[],selectionLayer:t=10,blendFunction:i,patternTexture:r,edgeStrength:s,pulseSpeed:o,visibleEdgeColor:a,hiddenEdgeColor:l,width:c,height:g,kernelSize:u,blur:d,xRay:h,...f},I){const A=Bt(w=>w.invalidate),{scene:p,camera:y}=M.useContext(Md),v=M.useMemo(()=>new e0e(p,y,{blendFunction:i,patternTexture:r,edgeStrength:s,pulseSpeed:o,visibleEdgeColor:a,hiddenEdgeColor:l,width:c,height:g,kernelSize:u,blur:d,xRay:h,...f}),[i,d,y,s,g,l,u,r,o,p,a,c,h]),b=M.useContext(jV);return M.useEffect(()=>{if(!b&&e)return v.selection.set(Array.isArray(e)?e.map(Uu):[Uu(e)]),A(),()=>{v.selection.clear(),A()}},[v,e,b,A]),M.useEffect(()=>{v.selectionLayer=t,A()},[v,A,t]),M.useRef(),M.useEffect(()=>{var w;if(b&&b.enabled&&(w=b.selected)!=null&&w.length)return v.selection.set(b.selected),A(),()=>{v.selection.clear(),A()}},[b,v.selection,A]),We("primitive",{ref:I,object:v})});M.forwardRef(function({granularity:e=5},t){const i=M.useMemo(()=>new n0e(e),[e]);return We("primitive",{ref:t,object:i,dispose:null})});const uye=(n,e)=>n.layers.enable(e.selection.layer),dye=(n,e)=>n.layers.disable(e.selection.layer);M.forwardRef(function({selection:e=[],selectionLayer:t=10,lights:i=[],luminanceThreshold:r,luminanceSmoothing:s,intensity:o,width:a,height:l,kernelSize:c,mipmapBlur:g,...u},d){i.length===0&&console.warn("SelectiveBloom requires lights to work.");const h=Bt(y=>y.invalidate),{scene:f,camera:I}=M.useContext(Md),A=M.useMemo(()=>new i0e(f,I,{blendFunction:Rt.ADD,luminanceThreshold:r,luminanceSmoothing:s,intensity:o,width:a,height:l,kernelSize:c,mipmapBlur:g,...u}),[f,I,r,s,o,a,l,c,g,u]),p=M.useContext(jV);return M.useEffect(()=>{if(!p&&e)return A.selection.set(Array.isArray(e)?e.map(Uu):[Uu(e)]),h(),()=>{A.selection.clear(),h()}},[A,e,p,h]),M.useEffect(()=>{A.selection.layer=t,h()},[A,h,t]),M.useEffect(()=>{if(i&&i.length>0)return i.forEach(y=>uye(Uu(y),A)),h(),()=>{i.forEach(y=>dye(Uu(y),A)),h()}},[A,h,i,t]),M.useEffect(()=>{var y;if(p&&p.enabled&&(y=p.selected)!=null&&y.length)return A.selection.set(p.selected),h(),()=>{A.selection.clear(),h()}},[p,A.selection,h]),We("primitive",{ref:d,object:A,dispose:null})});M.forwardRef(function(e,t){const{camera:i,normalPass:r,downSamplingPass:s,resolutionScale:o}=M.useContext(Md),a=M.useMemo(()=>r===null&&s===null?(console.error("Please enable the NormalPass in the EffectComposer in order to use SSAO."),{}):new s0e(i,r&&!s?r.texture:null,{blendFunction:Rt.MULTIPLY,samples:30,rings:4,distanceThreshold:1,distanceFalloff:0,rangeThreshold:.5,rangeFalloff:.1,luminanceInfluence:.9,radius:20,bias:.5,intensity:1,color:void 0,normalDepthBuffer:s?s.texture:null,resolutionScale:o??1,depthAwareUpsampling:!0,...e}),[i,r,e]);return We("primitive",{ref:t,object:a,dispose:null})});M.forwardRef(function({textureSrc:e,texture:t,...i},r){const s=Ef(gV,e);M.useLayoutEffect(()=>{s.encoding=Xt,s.wrapS=s.wrapT=ds},[s]);const o=M.useMemo(()=>new l0e({...i,texture:s||t}),[i,s,t]);return We("primitive",{ref:r,object:o,dispose:null})});M.forwardRef(function({lut:e,tetrahedralInterpolation:t,...i},r){const s=M.useMemo(()=>new Ome(e,i),[e,i]),o=Bt(a=>a.invalidate);return M.useLayoutEffect(()=>{t&&(s.tetrahedralInterpolation=t),e&&(s.lut=e),o()},[s,o,e,t]),We("primitive",{ref:r,object:s,dispose:null})});const hye=`
uniform sampler2D uCharacters;
uniform float uCharactersCount;
uniform float uCellSize;
uniform bool uInvert;
uniform vec3 uColor;

const vec2 SIZE = vec2(16.);

vec3 greyscale(vec3 color, float strength) {
    float g = dot(color, vec3(0.299, 0.587, 0.114));
    return mix(color, vec3(g), strength);
}

vec3 greyscale(vec3 color) {
    return greyscale(color, 1.0);
}

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
    vec2 cell = resolution / uCellSize;
    vec2 grid = 1.0 / cell;
    vec2 pixelizedUV = grid * (0.5 + floor(uv / grid));
    vec4 pixelized = texture2D(inputBuffer, pixelizedUV);
    float greyscaled = greyscale(pixelized.rgb).r;

    if (uInvert) {
        greyscaled = 1.0 - greyscaled;
    }

    float characterIndex = floor((uCharactersCount - 1.0) * greyscaled);
    vec2 characterPosition = vec2(mod(characterIndex, SIZE.x), floor(characterIndex / SIZE.y));
    vec2 offset = vec2(characterPosition.x, -characterPosition.y) / SIZE;
    vec2 charUV = mod(uv * (cell / SIZE), 1.0 / SIZE) - vec2(0., 1.0 / SIZE) + offset;
    vec4 asciiCharacter = texture2D(uCharacters, charUV);

    asciiCharacter.rgb = uColor * asciiCharacter.r;
    asciiCharacter.a = pixelized.a;
    outputColor = asciiCharacter;
}
`;class fye extends Wr{constructor({characters:e=" .:,'-^=*+?!|0#X%WM@",fontSize:t=54,cellSize:i=16,color:r="#ffffff",invert:s=!1}={}){const o=new Map([["uCharacters",new ye(new Pn)],["uCellSize",new ye(i)],["uCharactersCount",new ye(e.length)],["uColor",new ye(new Ke(r))],["uInvert",new ye(s)]]);super("ASCIIEffect",hye,{uniforms:o});const a=this.uniforms.get("uCharacters");a&&(a.value=this.createCharactersTexture(e,t))}createCharactersTexture(e,t){const i=document.createElement("canvas"),r=1024,s=16,o=r/s;i.width=i.height=r;const a=new s4(i,void 0,ds,ds,Zt,Zt),l=i.getContext("2d");if(!l)throw new Error("Context not available");l.clearRect(0,0,r,r),l.font=`${t}px arial`,l.textAlign="center",l.textBaseline="middle",l.fillStyle="#fff";for(let c=0;c<e.length;c++){const g=e[c],u=c%s,d=Math.floor(c/s);l.fillText(g,u*o+o/2,d*o+o/2)}return a.needsUpdate=!0,a}}M.forwardRef(({characters:n=" .:,'-^=*+?!|0#X%WM@",fontSize:e=54,cellSize:t=16,color:i="#ffffff",invert:r=!1},s)=>{const o=M.useMemo(()=>new fye({characters:n,fontSize:e,cellSize:t,color:i,invert:r}),[n,e,t,i,r]);return We("primitive",{ref:s,object:o})});M.forwardRef(function({ENABLE_BLUR:e=!0,USE_MRT:t=!0,...i},r){const{invalidate:s}=Bt(),{scene:o,camera:a}=M.useContext(Md),l=M.useMemo(()=>new sye(o,a,{ENABLE_BLUR:e,USE_MRT:t,...i}),[o,a,e,t,i]),c=M.useContext(jV);return M.useEffect(()=>{var g;if(c&&c.enabled&&(g=c.selected)!=null&&g.length)return l.selection.set(c.selected),s(),()=>{l.selection.clear(),s()}},[c]),We("primitive",{ref:r,object:l,...i})});const Wv=new Et;Wv.setAttribute("position",new Pt(new Float32Array([-1,-1,3,-1,-1,3]),2));Wv.setAttribute("uv",new Pt(new Float32Array([0,0,2,0,0,2]),2));Wv.boundingSphere=new Zl;Wv.computeBoundingSphere=function(){};const Iye=new _c;class xm{constructor(e){this._mesh=new Rn(Wv,e),this._mesh.frustumCulled=!1}render(e){e.render(this._mesh,Iye)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}dispose(){this._mesh.material.dispose(),this._mesh.geometry.dispose()}}const Aye={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},sceneNormal:{value:null},projMat:{value:new qe},viewMat:{value:new qe},projViewMat:{value:new qe},projectionMatrixInv:{value:new qe},viewMatrixInv:{value:new qe},cameraPos:{value:new D},resolution:{value:new pe},time:{value:0},samples:{value:[]},samplesR:{value:[]},bluenoise:{value:null},distanceFalloff:{value:1},radius:{value:5},near:{value:.1},far:{value:1e3},logDepth:{value:!1},ortho:{value:!1},screenSpaceRadius:{value:!1}},vertexShader:`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = vec4(position, 1);
}`,fragmentShader:`
    #define SAMPLES 16
    #define FSAMPLES 16.0
uniform sampler2D sceneDiffuse;
uniform sampler2D sceneNormal;
uniform highp sampler2D sceneDepth;
uniform mat4 projectionMatrixInv;
uniform mat4 viewMatrixInv;
uniform mat4 projMat;
uniform mat4 viewMat;
uniform mat4 projViewMat;
uniform vec3 cameraPos;
uniform vec2 resolution;
uniform float time;
uniform vec3[SAMPLES] samples;
uniform float[SAMPLES] samplesR;
uniform float radius;
uniform float distanceFalloff;
uniform float near;
uniform float far;
uniform bool logDepth;
uniform bool ortho;
uniform bool screenSpaceRadius;
uniform sampler2D bluenoise;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }

    vec3 getWorldPosLog(vec3 posS) {
      vec2 uv = posS.xy;
      float z = posS.z;
      float nearZ =near;
      float farZ = far;
      float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
      vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
      return wpos.xyz / wpos.w;
    }
    vec3 getWorldPos(float depth, vec2 coord) {
      #ifdef LOGDEPTH
        return getWorldPosLog(vec3(coord, depth));
      #endif
      float z = depth * 2.0 - 1.0;
      vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
      vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
      // Perspective division
     vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
     worldSpacePosition.xyz /= worldSpacePosition.w;
      return worldSpacePosition.xyz;
  }

  vec3 computeNormal(vec3 worldPos, vec2 vUv) {
    ivec2 p = ivec2(vUv * resolution);
    float c0 = texelFetch(sceneDepth, p, 0).x;
    float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
    float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
    float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
    float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
    float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
    float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
    float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
    float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;

    float dl = abs((2.0 * l1 - l2) - c0);
    float dr = abs((2.0 * r1 - r2) - c0);
    float db = abs((2.0 * b1 - b2) - c0);
    float dt = abs((2.0 * t1 - t2) - c0);

    vec3 ce = getWorldPos(c0, vUv).xyz;

    vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                          : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
    vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                          : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;

    return normalize(cross(dpdx, dpdy));
}

void main() {
      vec4 diffuse = texture2D(sceneDiffuse, vUv);
      float depth = texture2D(sceneDepth, vUv).x;
      if (depth == 1.0) {
        gl_FragColor = vec4(vec3(1.0), 1.0);
        return;
      }
      vec3 worldPos = getWorldPos(depth, vUv);
    //  vec3 normal = texture2D(sceneNormal, vUv).rgb;//computeNormal(worldPos, vUv);
      #ifdef HALFRES
        vec3 normal = texture2D(sceneNormal, vUv).rgb;
      #else
        vec3 normal = computeNormal(worldPos, vUv);
      #endif
      vec4 noise = texture2D(bluenoise, gl_FragCoord.xy / 128.0);
      vec3 randomVec = normalize(noise.rgb * 2.0 - 1.0);
      vec3 tangent = normalize(randomVec - normal * dot(randomVec, normal));
      vec3 bitangent = cross(normal, tangent);
      mat3 tbn = mat3(tangent, bitangent, normal);
      float occluded = 0.0;
      float totalWeight = 0.0;
     /* float radiusScreen = distance(
        worldPos,
        getWorldPos(depth, vUv + 
          vec2(48.0, 0.0) / resolution)
      );/*vUv.x < 0.5 ? radius : min(distance(
        worldPos,
        getWorldPos(depth, vUv + 
          vec2(100.0, 0.0) / resolution)
      ), radius);
      float distanceFalloffScreen = radiusScreen * 0.2;*/
      float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
      float bias = (0.1 / near) * fwidth(distance(worldPos, cameraPos)) / radiusToUse;
      for(float i = 0.0; i < FSAMPLES; i++) {
        vec3 sampleDirection = 
        tbn * 
        samples[int(i)];
        ;
        float moveAmt = samplesR[int(mod(i + noise.a * FSAMPLES, FSAMPLES))];
        vec3 samplePos = worldPos + radiusToUse * moveAmt * sampleDirection;
        vec4 offset = projViewMat * vec4(samplePos, 1.0);
        offset.xyz /= offset.w;
        offset.xyz = offset.xyz * 0.5 + 0.5;
        float sampleDepth = textureLod(sceneDepth, offset.xy, 0.0).x;
        /*float distSample = logDepth ? linearize_depth_log(sampleDepth, near, far) 
         (ortho ?  linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far));*/
        #ifdef LOGDEPTH
        float distSample = linearize_depth_log(sampleDepth, near, far);
        #else
        float distSample = ortho ? linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far);
        #endif
        float distWorld = ortho ? linearize_depth_ortho(offset.z, near, far) : linearize_depth(offset.z, near, far);
        float rangeCheck = smoothstep(0.0, 1.0, distanceFalloffToUse / (abs(distSample - distWorld)));
        vec2 diff = gl_FragCoord.xy - ( offset.xy * resolution);
        float weight = dot(sampleDirection, normal);
          occluded += rangeCheck * weight * 
            (distSample + bias
               < distWorld ? 1.0 : 0.0) * (
          (dot(
            diff,
            diff
             
            ) < 1.0 || (sampleDepth == depth) || (
              offset.x < 0.0 || offset.x > 1.0 || offset.y < 0.0 || offset.y > 1.0
            ) ? 0.0 : 1.0)
          );
          totalWeight += weight;
      }
      float occ = clamp(1.0 - occluded / totalWeight, 0.0, 1.0);
      gl_FragColor = vec4(0.5 + 0.5 * normal, occ);
}`},Cye={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new qe},viewMat:{value:new qe},projectionMatrixInv:{value:new qe},viewMatrixInv:{value:new qe},cameraPos:{value:new D},resolution:{value:new pe},color:{value:new D(0,0,0)},blueNoise:{value:null},downsampledDepth:{value:null},time:{value:0},intensity:{value:10},renderMode:{value:0},gammaCorrection:{value:!1},logDepth:{value:!1},ortho:{value:!1},near:{value:.1},far:{value:1e3},screenSpaceRadius:{value:!1},radius:{value:0},distanceFalloff:{value:1}},vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform sampler2D sceneDepth;
    uniform sampler2D downsampledDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform vec2 resolution;
    uniform vec3 color;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform float intensity;
    uniform float renderMode;
    uniform float near;
    uniform float far;
    uniform bool gammaCorrection;
    uniform bool logDepth;
    uniform bool ortho;
    uniform bool screenSpaceRadius;
    uniform float radius;
    uniform float distanceFalloff;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
       // if (logDepth) {
        #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
        #endif
      //  }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }

    #include <common>
    #include <dithering_pars_fragment>
    void main() {
        //vec4 texel = texture2D(tDiffuse, vUv);//vec3(0.0);
        vec4 sceneTexel = texture2D(sceneDiffuse, vUv);

        #ifdef HALFRES 
        float depth = texture2D(
            sceneDepth,
            vUv
        ).x;
        vec4 texel;
        if (depth == 1.0) {
            texel = vec4(0.0, 0.0, 0.0, 1.0);
        } else {
        vec3 worldPos = getWorldPos(depth, vUv);
        vec3 normal = computeNormal(getWorldPos(depth, vUv), vUv);
       // vec4 texel = texture2D(tDiffuse, vUv);
       // Find closest depth;
       float totalWeight = 0.0;
       float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
        for(float x = -1.0; x <= 1.0; x++) {
            for(float y = -1.0; y <= 1.0; y++) {
                vec2 offset = vec2(x, y);
                ivec2 p = ivec2(
                    (vUv * resolution * 0.5) + offset
                );
                vec2 pUv = vec2(p) / (resolution * 0.5);
                float sampleDepth = texelFetch(downsampledDepth,p, 0).x;
                vec4 sampleInfo = texelFetch(tDiffuse, p, 0);
                vec3 normalSample = sampleInfo.xyz * 2.0 - 1.0;
                vec3 worldPosSample = getWorldPos(sampleDepth, pUv);
                float tangentPlaneDist = abs(dot(worldPos - worldPosSample, normal));
                float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0);
                float weight = rangeCheck;
                totalWeight += weight;
                texel += sampleInfo * weight;
            }
        }
        if (totalWeight == 0.0) {
            texel = texture2D(tDiffuse, vUv);
        } else {
            texel /= totalWeight;
        }
    }
        #else
        vec4 texel = texture2D(tDiffuse, vUv);
        #endif

     
        float finalAo = pow(texel.a, intensity);
        if (renderMode == 0.0) {
            gl_FragColor = vec4( mix(sceneTexel.rgb, color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 1.0) {
            gl_FragColor = vec4( mix(vec3(1.0), color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 2.0) {
            gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
        } else if (renderMode == 3.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(sceneTexel.rgb, color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
            }
        } else if (renderMode == 4.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(vec3(1.0), color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
            }
        }
        #include <dithering_fragment>
        if (gammaCorrection) {
            gl_FragColor = LinearTosRGB(gl_FragColor);
        }
    }
    `},pye={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new qe},viewMat:{value:new qe},projectionMatrixInv:{value:new qe},viewMatrixInv:{value:new qe},cameraPos:{value:new D},resolution:{value:new pe},time:{value:0},r:{value:5},blueNoise:{value:null},radius:{value:12},worldRadius:{value:5},index:{value:0},poissonDisk:{value:[]},distanceFalloff:{value:1},near:{value:.1},far:{value:1e3},logDepth:{value:!1},screenSpaceRadius:{value:!1}},vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1.0);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform vec2 resolution;
    uniform float r;
    uniform float radius;
     uniform float worldRadius;
    uniform float index;
     uniform float near;
     uniform float far;
     uniform float distanceFalloff;
     uniform bool logDepth;
     uniform bool screenSpaceRadius;
    varying vec2 vUv;

    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        highp float z_n = 2.0 * d - 1.0;
        return 2.0 * zNear * zFar / (zFar + zNear - z_n * (zFar - zNear));
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
     float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     return linearize_depth(linDepth, nearZ, farZ);
   }
   highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
     return nearZ + (farZ - nearZ) * d;
   }
   vec3 getWorldPosLog(vec3 posS) {
     vec2 uv = posS.xy;
     float z = posS.z;
     float nearZ =near;
     float farZ = far;
     float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
     vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
     return wpos.xyz / wpos.w;
   }
    vec3 getWorldPos(float depth, vec2 coord) {
     #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
     #endif
        
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
    #include <common>
    #define NUM_SAMPLES 16
    uniform vec2 poissonDisk[NUM_SAMPLES];
    void main() {
        const float pi = 3.14159;
        vec2 texelSize = vec2(1.0 / resolution.x, 1.0 / resolution.y);
        vec2 uv = vUv;
        vec4 data = texture2D(tDiffuse, vUv);
        float occlusion = data.a;
        float baseOcc = data.a;
        vec3 normal = data.rgb * 2.0 - 1.0;
        float count = 1.0;
        float d = texture2D(sceneDepth, vUv).x;
        vec3 worldPos = getWorldPos(d, vUv);
        float size = radius;
        float angle;
        if (index == 0.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).x * PI2;
        } else if (index == 1.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).y * PI2;
        } else if (index == 2.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).z * PI2;
        } else {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).w * PI2;
        }

        mat2 rotationMatrix = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
        float radiusToUse = screenSpaceRadius ? distance(
          worldPos,
          getWorldPos(d, vUv +
            vec2(worldRadius, 0.0) / resolution)
        ) : worldRadius;
        float distanceFalloffToUse =screenSpaceRadius ?
            radiusToUse * distanceFalloff
        : distanceFalloff;


        for(int i = 0; i < NUM_SAMPLES; i++) {
            vec2 offset = (rotationMatrix * poissonDisk[i]) * texelSize * size;
            vec4 dataSample = texture2D(tDiffuse, uv + offset);
            float occSample = dataSample.a;
            vec3 normalSample = dataSample.rgb * 2.0 - 1.0;
            float dSample = texture2D(sceneDepth, uv + offset).x;
            vec3 worldPosSample = getWorldPos(dSample, uv + offset);
            float tangentPlaneDist = abs(dot(worldPos - worldPosSample, normal));
            float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0) * (1.0 - abs(occSample - baseOcc));
            occlusion += occSample * rangeCheck;
            count += rangeCheck;
        }
        occlusion /= count;
        gl_FragColor = vec4(0.5 + 0.5 * normal, occlusion);
    }
    `},mye={uniforms:{sceneDepth:{value:null},resolution:{value:new pe},near:{value:.1},far:{value:1e3},viewMatrixInv:{value:new qe},projectionMatrixInv:{value:new qe},logDepth:{value:!1}},vertexShader:`
    varying vec2 vUv;
    void main() {
        vUv = uv;
        gl_Position = vec4(position, 1);
    }`,fragmentShader:`
    uniform sampler2D sceneDepth;
    uniform vec2 resolution;
    uniform float near;
    uniform float far;
    uniform bool logDepth;
    uniform mat4 viewMatrixInv;
    uniform mat4 projectionMatrixInv;
    varying vec2 vUv;
    layout(location = 1) out vec4 gNormal;
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
        if (logDepth) {
          return getWorldPosLog(vec3(coord, depth));
        }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }
    void main() {
        vec2 uv = vUv - vec2(0.5) / resolution;
        vec2 pixelSize = vec2(1.0) / resolution;
        vec2[] uvSamples = vec2[4](
            uv,
            uv + vec2(pixelSize.x, 0.0),
            uv + vec2(0.0, pixelSize.y),
            uv + pixelSize
        );
        float depth00 = texture2D(sceneDepth, uvSamples[0]).r;
        float depth10 = texture2D(sceneDepth, uvSamples[1]).r;
        float depth01 = texture2D(sceneDepth, uvSamples[2]).r;
        float depth11 = texture2D(sceneDepth, uvSamples[3]).r;
        float minDepth = min(min(depth00, depth10), min(depth01, depth11));
        float maxDepth = max(max(depth00, depth10), max(depth01, depth11));
        float targetDepth = minDepth;
        // Checkerboard pattern to avoid artifacts
        if (mod(gl_FragCoord.x + gl_FragCoord.y, 2.0) > 0.5) { 
            targetDepth = maxDepth;
        }
        int chosenIndex = 0;
        float[] samples = float[4](depth00, depth10, depth01, depth11);
        for(int i = 0; i < 4; ++i) {
            if (samples[i] == targetDepth) {
                chosenIndex = i;
                break;
            }
        }
        gl_FragColor = vec4(samples[chosenIndex], 0.0, 0.0, 1.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[chosenIndex], uvSamples[chosenIndex]), uvSamples[chosenIndex]
        ), 0.0);
       /* float[] samples = float[4](depth00, depth10, depth01, depth11);
        float c = 0.25 * (depth00 + depth10 + depth01 + depth11);
        float[] distances = float[4](depth00, depth10, depth01, depth11);
        float maxDistance = max(max(distances[0], distances[1]), max(distances[2], distances[3]));

        int remaining[3];
        int rejected[3];
        int i, j, k;

        for(i = 0, j = 0, k = 0; i < 4; ++i) {
            if (distances[i] < maxDistance) {
                remaining[j++] = i;
            } else {
                rejected[k++] = i;
            }
        }
        for(;j < 3;++j) {
            remaining[j] = rejected[--k];
        }
        vec3 s = vec3(
            samples[remaining[0]],
            samples[remaining[1]],
            samples[remaining[2]]
        );
        c = (s.x + s.y + s.z) / 3.0;

        distances[0] = abs(c - s.x);
        distances[1] = abs(c - s.y);
        distances[2] = abs(c - s.z);

        float minDistance = min(min(distances[0], distances[1]), distances[2]);

        for(i = 0; i < 3; ++i) {
            if (distances[i] == minDistance) {
                break;
            }
        }*/
      /*  gl_FragColor = vec4(samples[remaining[i]], 0.0, 0.0, 0.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[remaining[i]], uvSamples[remaining[i]]), uvSamples[remaining[i]]
        ), 0.0);*/
    }`};var Nj="5L7pP4UXrOIr/VZ1G3f6p89FIWU7lqc7J3DPxKjJUXODJoHQzf/aNVM+ABlvhXeBGN7iC0WkmTjEaAqOItBfBdaK5KSGV1ET5SOKl3x9JOX5w2sAl6+6KjDhVUHgbqq7DZ5EeYzbdSNxtrQLW/KkPJoOTG4u5CBUZkCKHniY9l7DUgjuz708zG1HIC8qfohi1vPjPH9Lq47ksjRrjwXD4MlVCjdAqYFGodQ8tRmHkOfq4wVRIAHvoavPHvN1lpk3X4Y1yzAPGe8S9KBs3crc4GwlU1dEOXiWol/mgQqxkNqB1xd04+0Bmpwj0GcCc4NUi+c731FUxjvaexCkCJ0qhrJJ++htWqetNC4NewClu8aFRSwrqiJEGe+qtTg4CYCHaF1wJI0sy/ZBQAI0qAMyBvVjWZlv2pdkCaro9eWDLK5I4mbb8E4d7hZr9dDJiTJm6Bmb5S+2F7yal/JPdeLUfwq7jmVLaQfhv4tWMJAt7V4sG9LuAv2oPJgSj1nnlBvPibfHM2TrlWHwGCLGxW/5Jm2TotaDL+pHDM5pn1r0UuTZ24N8S5k68bLHW9tfD+2k4zGev23ExJb4YTRKWrj82N5LjJ26lj1BkGZ0CsXLGGELoPaYQomjTqPxYqhfwOwDliNGVqux9ffuybqOKgsbB51B1GbZfG8vHDBE2JQGib1mnCmWOWAMJcHN0cKeDHYTflbDTVXajtr68mwfRje6WueQ/6yWqmZMLWNH7P27zGFhMFqaqfg11Q88g/9UA/FROe9yfq0yOO0pnNAxvepFy2BpEbcgG+mCyjCC01JWlOZlIPdf1TtlyOt7L94ToYGCukoFt4OqwOrofamjECpSgKLLmrRM+sNRAw12eaqk8KtdFk7pn2IcDQiPXCh16t1a+psi+w9towHTKPyQM0StKr61b2BnN1HU+aezFNBLfHTiXwhGTbdxLLmrsAGIVSiNAeCGE8GlB0iOv2v78kP0CTmAPUEqnHYRSDlP+L6m/rYjEK6Q85GRDJi2W20/7NLPpSOaMR++IFvpkcwRuc59j8hh9tYlc1xjdt2jmp9KJczB7U9P43inuxLOv11P5/HYH5d6gLB0CsbGC8APjh+EcCP0zFWqlaACZweLhVfv3yiyd8R3bdVg8sRKsxPvhDaPpiFp9+MN+0Ua0bsPr+lhxfZhMhlevkLbR4ZvcSRP6ApQLy3+eMh9ehCB3z5DVAaN3P6J8pi5Qa88ZQsOuCTWyH6q8yMfBw8y8nm6jaOxJhPH6Hf0I4jmALUBsWKH4gWBnyijHh7z3/1HhQzFLRDRrIQwUtu11yk7U0gDw/FatOIZOJaBx3UqbUxSZ6dboFPm5pAyyXC2wYdSWlpZx/D2C6hDO2sJM4HT9IKWWmDkZIO2si/6BKHruXIEDpfAtz3xDlIdKnnlqnkfCyy6vNOPyuoWsSWBeiN0mcfIrnOtp2j7bxjOkr25skfS/lwOC692cEp7TKSlymbsyzoWg/0AN66SvQYo6BqpNwPpTaUu25zMWlwVUdfu1EEdc0O06TI0JmHk4f6GZQbfOs//OdgtGPO6uLoadJycR8Z80rkd88QoNmimZd8vcpQKScCFkxH1RMTkPlN3K7CL/NSMOiXEvxrn9VyUPFee63uRflgaPMSsafvqMgzTt3T1RaHNLLFatQbD0Vha4YXZ/6Ake7onM65nC9cyLkteYkDfHoJtef7wCrWXTK0+vH38VUBcFJP0+uUXpkiK0gDXNA39HL/qdVcaOA16kd2gzq8aHpNSaKtgMLJC6fdLLS/I/4lUWV2+djY9Rc3QuJOUrlHFQERtXN4xJaAHZERCUQZ9ND2pEtZg8dsnilcnqmqYn3c1sRyK0ziKpHNytEyi2gmzxEFchvT1uBWxZUikkAlWuyqvvhteSG9kFhTLNM97s3X1iS2UbE6cvApgbmeJ/KqtP0NNT3bZiG9TURInCZtVsNZzYus6On0wcdMlVfqo8XLhT5ojaOk4DtCyeoQkBt1mf5luFNaLFjI/1cnPefyCQwcq5ia/4pN4NB+xE/3SEPsliJypS964SI6o5fDVa0IERR8DoeQ+1iyRLU1qGYexB61ph4pkG1rf3c2YD6By1pFCmww9B0r2VjFeaubkIdgWx4RKLQRPLENdGo8ezI5mkNtdCws19aP1uHhenD+HKa8GDeLulb2fiMRhU2xJzzz9e4yOMPvEnGEfbCiQ17nUDpcFDWthr68mhZ4WiHUkRpaVWJNExuULcGkuyVLsQj59pf6OHFR7tofhy9FMrWPCEvX1d5sCVJt8yBFiB6NoOuwMy4wlso9I2G4E5/5B2c6vIZUUY9fFujT3hpkdTuVhbhBwLCtnlIjBpN4cq+waZ0wXSrmebcl+dcrb7sPh9jKxFINkScDTBgjSUfLkC3huJJs/M4M8AOFxbbSIVpBUarYFmLpGsv+V6TJnWNTwI41tubwo7QSI1VOdRKT/Pp8U3oK2ciDbeuWnAGAANvQjGfcewdAdo6H83XzqlK/4yudtFHJSv9Y+qJskwnVToH1I0+tJ3vsLBXtlvMzLIxUj/8LcqZnrNHfVRgabFNXW0qpUvDgxnP3f54KooR3NI+2Q/VHAYFigMkQE5dLH6C6fGs/TKeE6E2jOhZQcP9/rrJjJKcLYdn5cw6XLCUe9F7quk5Yhac+nYL5HOXvp6Q/5qbiQHkuebanX77YSNx34YaWYpcEHuY1u/lEVTCQ7taPaw3oNcn/qJhMzGPZUs3XAq48wj/hCIO2d5aFdfXnS0yg57/jxzDJBwkdOgeVnyyh19Iz1UqiysT4J1eeKwUuWEYln23ydtP7g3R1BnvnxqFPAnOMgOIop2dkXPfUh/9ZKV3ZQbZNactPD4ql5Qg9CxSBnIwzlj/tseQKWRstwNbf17neGwDFFWdm/8f+nDWt/WlKV3MUiAm3ci6xXMDSL5ubPXBg/gKEE7TsZVGUcrIbdXILcMngvGs7unvlPJh6oadeBDqiAviIZ/iyiUMdQZAuf/YBAY0VP1hcgInuWoKbx31AOjyTN2OOHrlthB3ny9JKHOAc8BMvqopikPldcwIQoFxTccKKIeI815GcwaKDLsMbCsxegrzXl8E0bpic/xffU9y1DCgeKZoF2PIY77RIn6kSRdBiGd8NtNwT74dyeFBMkYraPkudN26x9NPuBt4iCOAnBFaNSKVgKiZQruw22kM1fgBKG7cPYAxdHJ8M4V/jzBn2jEJg+jk/jjV4oMmMNOpKB5oVpVh7tK529Z+5vKZ0NSY2A4YdcT0x4BdkoNEDrpsTmekSTjvx9ZBiTHrm9M/n/hGmgpjz4WEjttRfAEy5DYH5vCK/9GuVPa4hoApFaNlrFD/n2PpKOw24iKujKhVIz41p1E0HwsCd/c17OA0H0RjZi1V/rjJLexUzpmXTMIMuzaOBbU4dxvQMgyvxJvR6DyF3BaHkaqT4P3FRYlm+zh8EEGgmkNqD1WRUubDW62VqLoH8UEelIpL7C8CguWWGGCAIDPma9bnh+7IJSt0Cn6ACER2mYk8dLsrN70RUVLiE0ig+08yPY9IOtuqHf/KYsT84BwhMcVq7t8q1WVjpJGNyXdtIPIjhAzabtrX03Itn29QO3TCixE9WpkHIOdAoGvqCrw1D3x9g9Px8u0yZZuulZuGy0veSY34KDSlhsO1zx2ZMrpDBzCHPB4niwApk6NevIvmBxU3+4yaewDvgEQDJ6Of5iRxjAIpp9UO8EzNY4blj4qh8SCSZTqbe/lShE6tNU9Y5IoWHeJxPcHF9KwYQD7lFcIpcscHrcfkHJfL2lL1zczKywEF7BwkjXEirgBcvNWayatqdTVT5oLbzTmED3EOYBSXFyb2VIYk3t0dOZWJdG1nP+W7Qfyeb8MSIyUGKEA57ptPxrPHKYGZPHsuBqQuVSrn0i8KJX+rlzAqo8AawchsJ26FckxTf5+joTcw+2y8c8bushpRYEbgrdr64ltEYPV2AbVgKXV3XACoD1gbs01CExbJALkuItjfYN3+6I8kbiTYmdzBLaNC+xu9z/eXcRQV1Lo8cJoSsKyWJPuTncu5vcmfMUAWmuwhjymK1rhYR8pQMXNQg9X+5ha5fEnap+LhUL1d5SURZz9rGdOWLhrMcMKSaU3LhOQ/6a6qSCwgzQxCW2gFs53fpvfWxhH+xDHdKRV6w29nQ6rNqd9by+zm1OpzYyJwvFyOkrVXQUwt4HaapnweCa7Tj2Mp/tT4YcY3Q/tk1czgkzlV5mpDrdp1spOYB8ionAwxujjdhj5y9qEHu0uc36PAKAYsKLaEoiwPnob0pdluPWdv4sNSlG8GWViI+x/Z4DkW/kSs2iE3ADFjg4TCvgCbX3v0Hz0KZkerrpzEIukAusidDs2g/w0zgmLnZXvVr5kkpwQTLZ0L6uaTHl0LVikIuNIVPmL3fOQJqIdfzymUN0zucIrDintBn6ICl/inj5zteISv5hEMGMqtHc2ghcFJvmH3ZhIZi34vqqTFCb9pltTYz582Y3dwYaHb9khdfve1YryzEwEKbI8qm62qv+NyllC+WxLLAJjz0ZaEF2aTn35qeFmkbP6LDYcbwqWxA0WKsteB7vy8bRHE4r8LhubWDc0pbe90XckSDDAkRej0TQlmWsWwaz18Tx2phykVvwuIRzf4kt9srT8N7gsMjMs0NLAAldabFf2tiMoaaxHcZSX51WPc1BrwApMxih227qTZkcgtkdK1h314XvZKUKh/XysWYnk1ST4kiBI1B9OlfTjB3WHzTAReFLofsGtikwpIXzQBc/gOjz2Thlj36WN0sxyf4RmAFtrYt64fwm+ThjbhlmUTZzebLl4yAkAqzJSfjPBZS2H/IvkkTUdVh0qdB6EuiHEjEil5lk9BTPzxmoW4Jx543hiyy4ASdYA2DNoprsR9iwGFwFG3F2vIROy4L5CZrl230+k733JwboSNBKngsaFPtqo+q3mFFSjC1k0kIAFmKihaYSwaSF7konmYHZWmchuaq15TpneA2ADSRvA07I7US0lTOOfKrgxhzRl0uJihcEZhhYWxObjvNTJ/5sR4Aa5wOQhGClGLb746cJhQ2E6Jie1hbGgWxUH7YSKETptrTeR/xfcMNk2WM12S0XElC9klR8O7jLYekEOZdscP0ypSdoCVZAoK+2ju2PHE869Q9rxCs9DVQco4BriiPbCjN/8tBjsah4IuboR5QbmbyDpcdXVxGMxvWKIjocBuKbjb+B4HvkunbG0wX0IFCjQKoNMFIKcJSJXtkP3EO+J16uh4img0LQlBAOYwBLupu5r1NALMo0g3xkd9b4f7KoCBWHeyk24FmYUCy/PGLv0xErOTyORp8TJ5nnc2k1dOVBTJok7iHye9dwxwRVP3c7eAS8pMmJYHGpzIHz6ii2WJm8HMTPAZdA4q+ugj3PNCL/N45kyglqvQV4f/+ryDDG5RPy5HVoV9FVuJcq2dxF9Y0heVoipV6q1LyfAeuMzbsUV+rsSBmCSV+1CdKlxy0T0Y6Om0X6701URm2Ml6DIQgJ/3KO6kwcMYRrmKsY7TfxWhSXZll+1PfyRXe9HS0t1IKTQMZL7ZqQ8D/o+en57Y9XAQ9C+kZYykNr0xOMxEwu2+Cppm69mQyTm3H7QX6kHvXF201r+KVAf354qypJC5OHSeBU47bM1bTaVmdVEWQ+9CcvvHdu8Ue5UndHM+EeukmR82voQpetZ7WJjyXs+tPS60nk09gymuORoHNtbm0VuvyigiEvOsyHiRBW7V6FyTCppLPEHvesan91SlEh1/QEunq+qgREFXByDwNKcAH5s8/RFg8hP4wcPmFqX0xXGSKY087bqRLsBZe52jThx0XLkhKQUWPvI18WQQS3g2Ra1pzQ1oNFKdfJJjyaH5tJH6w0/upJobwB8KZ5cIs9LnVGxfBaHXBfvLkNpab7dpU6TdcbBIc+A4bqXE/Xt8/xsGQOdoXra4Us5nDAM6v2BNBQaGMmgMfQQV+ikTteSHvyl8wUxULiYRIEKaiDxpBJnyf9OoqQdZVJ8ahqOvuwqq5mnDUAUzUr/Lvs1wLu2F+r4eZMfJPL4gV5mKLkITmozRnTvA7VABaxZmFRtkhvU5iH9RQ1z26ku7aABokvptx7RKZBVL6dveLKOzg0NC7HAxcg5kE1wuyJiEQLOpO0ma3AtWD2Q2Wmn2oPZeDYAwVyEpxuwDy7ivmdUDSL95ol3h2JByTMovOCgxZ1q4E5nwwa7+4WtDAse6bDdr27XgAi5Px3IWbyZ/vRiECKwOMeJSuIl8A4Ds0emI3SgKVVWVO5uyiEUET+ucEq0casA+DQyhzRc8j+Plo0pxKynB/t0uXod1FVV4fX1sC4kDfwFaUDGQ4p9HYgaMqIWX3OF/S8+vcR0JS0bDapWKJwAIIQiRUzvh5YwtzkjccbbrT9Ky/qt5X7MAGA0lzh43mDF9EB6lCGuO/aFCMhdOqNryvd73KdJNy3mxtT8AqgmG4xq7eE1jKu6rV0g8UGyMatzyIMjiOCf4lIJFzAfwDbIfC72TJ/TK+cGsLR8blpjlEILjD8Mxr7IffhbFhgo12CzXRQ2O8JqBJ70+t12385tSmFC8Or+U8svOaoGoojT1/EmjRMT7x2iTUZ7Ny02VGeMZTtGy029tGN1/9k7x3mFu63lYnaWjfJT1m1zpWO3HSXpGkFqVd/m3kDMv4X9rmLOpwEeu8r6TI6C2zUG+MT6v90OU3y5hKqLhpyFLGtkZhDmUg/W1JGSmA8N1TapR4Kny+P6+DuMadZ9+xBbv06nfOjMwkoTsjG0zFmNbvlxEjw+Pl5QYK+V8Qyb+nknZ0Nb/Ofi9+V0eoNtTrtD1/0wzUGGG5u2D/J1ouO/PjXFJVx6LurVnPOyFVbZx7s3ZSjSq+7YN3wzTbFbUvP8GBh7cKieJt56SIowQ2I577+UEXrxUKMFO+XaLLCALuiJWB2vUdpsT+kQ+adoeTfwOulXhd/KZ7ygjj6PhvGT1xzfT7hTwd6dzSB4xV70CesHC0dsg2VyujlMGBKjg5snbrHHX/LNj3SsoLGSX+bZNTDDCNTXh+dCVPlj4K8+hJ/kVddrbtZw26Hx5qYiv3oNNg5blHRSPtmojhZmBQAz8sLC9nAuWNSz1dIofFtlryEKklbdkhBCcx5dhj7pinXDNlCeatCeTCEjYCpZ3HRf5QzUcRR1Tdb3gwtYtpPdgMxmWfJGoZSu1EsCJbIhS16Ed97+8br4Ar1mB1GcnZVx/HPtJl4CgbHXrrDPwlE4od8deRQYLt9IlsvCqgesMmLAVxB+igH7WGTcY/e3lLHJ4rkBgh2p1QpUBRb/cSQsJCbosFDkalbJigimldVK7TIHKSq2w8mezku9hgw8fXJxGdXoL1ggma52kXzjP78l0d0zMwtTVlt0FqnRyGLPGEjmICzgSp7XPFlUr7AeMclQ4opqwBFInziM5F8oJJ8qeuckGOnAcZZOLl1+ZhGF17pfIuujipwFJL7ChIIB2vlo0IQZGTJPNa2YjNcGUw+a/gWYLkCp+bOGIYhWr08UIE709ZEHlUoEbumzgpJv1D0+hWYNEpj+laoZIK5weO2DFwLL6UBYNrXTm9YvvxeN9U9oKsB3zKBwzFFwDgid5ESMhy68xBnVa55sCZd+l5AnzT8etYjIwF/BGwEx1jjzFv32bk6EeJulESARh8RZ48o7rKw67UZpudPa15SDnL8AL8xMV2SC0D1P53p190zhCFkMmEiir2olwxcJppl/kLm6/0QSUQLNaxi1AC3Pg1CTosX2YQr73PjEIxIlg4mJ62vP7ZyoHE55B0SX9YrrrCPtNsrJEwtn6KOSt7nLT3n3DLJTPbLulcqQ1kETP6Huts29oP+JLEqRGWgnrqMD+mhCl1XCZifjgQ39AeudE8pyu2DqnYU3PyPbJhStq1HbP+VxgseWL+hQ+4w1okADlA9WqoaRuoS7IY77Cm40cJiE6FLomUMltT+xO3Upcv5dzSh9F57hodSBnMHukcH1kd9tqlpprBQ/Ij9E+wMQXrZG5PlzwYJ6jmRdnQtRj64wC/7vsDaaMFteBOUDR4ebRrNZJHhwlNEK9Bz3k7jqOV5KJpL74p2sQnd7vLE374Jz+G7H3RUbX17SobYOe9wKkL/Ja/zeiKExOBmPo0X29bURQMxJkN4ddbrHnOkn6+M1zTZHo0efsB23WSSsByfmye2ZuTEZ12J3Y8ffT6Fcv8XVfA/k+p+xJGreKHJRVUIBqfEIlRt987/QXkssXuvLkECSpVEBs+gE1meB6Xn1RWISG6sV3+KOVjiE9wGdRHS8rmTERRnk0mDNU/+kOQYN/6jdeq0IHeh9c6xlSNICo9OcX1MmAiEuvGay43xCZgxHeZqD7etZMigoJI5V2q7xDcXcPort7AEjLwWlEf4ouzy2iPa3lxpcJWdIcHjhLZf1zg/Kv3/yN1voOmCLrI1Fe0MuFbB0TFSUt+t4Wqe2Mj1o2KS0TFQPGRlFm26IvVP9OXKIQkjfueRtMPoqLfVgDhplKvWWJA673+52FgEEgm+HwEgzOjaTuBz639XtCTwaQL/DrCeRdXun0VU3HDmNmTkc6YrNR6tTVWnbqHwykSBswchFLnvouR0KRhDhZiTYYYNWdvXzY+61Jz5IBcTJavGXr9BcHdk/3tqaLbwCbfpwjxCFSUs1xfFcRzRfMAl+QYuCpsYGz9H01poc1LyzhXwmODmUSg/xFq/RosgYikz4Om/ni9QCcr28ZPISaKrY7O+CspM/s+sHtnA9o9WgFWhcBX2LDN2/AL5uB6UxL/RaBp7EI+JHGz6MeLfvSNJnBgI9THFdUwmg1AXb9pvd7ccLqRdmcHLRT1I2VuEAghBduBm7pHNrZIjb2UVrijpZPlGL68hr+SDlC31mdis0BjP4aZFEOcw+uB17y5u7WOnho60Vcy7gRr7BZ9z5zY1uIwo+tW1YKpuQpdR0Vi7AxKmaIa4jXTjUh7MRlNM0W/Ut/CSD7atFd4soMsX7QbcrUZZaWuN0KOVCL9E09UcJlX+esWK56mre/s6UO9ks0owQ+foaVopkuKG+HZYbE1L1e0VwY2J53aCpwC77HqtpyNtoIlBVzOPtFvzBpDV9TjiP3CcTTGqLKh+m7urHvtHSB/+cGuRk4SsTma9sPCVJ19UPvaAv5WB8u57lNeUewwKpXmmKm5XZV91+FqCCT6nVrrrOgXfYmGFlVjqsSn3/yufkGIdtmdD0yVBcYFR3hDx43e3E4iuiEtP3Me9gcsBqveQdKojKR//qD2nEDY0IktMgFvH+SqVWi9mAorym92NEGbY8MeDjp553MiTXCRSASPt+Ga5q7pB9vwFQCTpaoevx0yEfrq9rMs3eU6wclBMJ9Ve8m6QuLYZ58J41YG3jW/khW92h6M/vbFIUPuopZ6VVtpciesU74Ef7ic8iSymDohGeUn4ubT0vRsXmbsjaJaYhL8f+8I5EiD5l680MJbxX/4GYrOg4iPQqpKp0qddSu/HKtznHeVyxgTwhfEORMCwnaqetVSzvidaWN9P+fXtGXfEP9cTdwx2gKVfDdICq7hecgRhIs0qlCt6+5pGlCc6kWoplHa/KjP+FJdXBU/IDoKMxRjFhSYkggIkhvRKiN/b2ud8URPF+lB87AGAwyMjr/Wju2Uj5IrppXZWjI3d14BdKE2fhALyQPmHqqA+AXd2LwvRHcBq4mhOQ4oNRWH7wpzc6Pggfcbv9kqhLxrJKEaJqA6Rxi+TDNOJstd5DoRVCDjmVspCVyHJsFEWPg9+NA8l1e4X2PDvOd5MPZAGw6LRhWqeZoSQcPf9/dGJYAyzCmttlRnx0BfrKQ/G9i5DVJft9fuJwMi3OD/0Dv1bRoxcXAyZ0wMJ6rwk9RjRTF4ZK8JviCCNuVt/BqQYiphOzWCpnbwOZt6qXuiAabQWrS4mNXQ7cEErXR/yJcbdFp5nWE1bPBjD0fmG3ovMxmOq5blpcOs0DtNQpci1t+9DKERWAO53IVV/S4yhMklvIp0j0FIQgwjdUptqmoMYGVWSI5YkTKLHZdXRDv9zs+HdFZt1QVcdlGOgATro3fg6ticCrDQKUJC7bYX50wdvetilEwVenHhlr85HMLRLTD6nDXWId4ORLwwe5IXiOhpuZTVTv+xdkTxJofqeCRM/jcZqQlU0gFVTlYlfwMi6HKR2YG4fQ8TOtgR+yV+BMZb6L5OwDc/28/xdfD7GXFaVA2ZSObiIxBwT2Zev637EuvpM6rxcogdM4FJFa0ZhF7nrqtNsqWg5M7hZMORpjd4szf/wS+Ahs1shY54Ct5J1dOBO4sdEtSnRc0P9PhgyOCt6aQW98R22DpAcNTDe72AHK40vutKTPfpokghRPuGvz0dulBPKfC3O4KVDCyWrJGO7Ikdu06A0keKlVfi0tGcpO0NhzXEh75NHyMysAMV19fq7//sPC0For1k2uFEvq8lwrMAfmP7afR69U2RqaILHe7glpc8HmVf87Qb2ohsw+Di9U+ePdHLecS66MhB/0OwdcXR5WBcWTZLGq/kiAaT+bzkjR8GIpWdv6pfIgQ+Q0xdiKvo+gNB7/Nf9knNJGxnh7LeZEFtMn517tNc74PPS0M4K3I6HHZqNPA+VZcBc/g5a2ARyqKrJ4Z3krsuA+VOJJz2KJpBMgCCWFln3u7k6/q3DETAubKG/pt3ObaNT0NI0Qug90L2ip5dHnZJUjPTvK5E96aX/4mRU2u8n8kh6MKbY7ANBro3huF06U+JvfyELQP25oIaj+n0ITQ4KT9rXZD4EtBIOj95fYNldDN3io/VMIvWNj9P/b95WEMq8UAVfG2XG0N6fSYdnBEC7sUEbatbDICH9qA8TTuW9kEt9DlFOZFP7bdfYLa/khSY8W5K/AkIIAPXtMvyVKyESjKx9nfragssxC0jFMVY94d8lOAwRocdS/l/P43cBGa3IqDa0ihGPcmwS8O8Vj16Uy55rOrnN0shhRJZdW8I7F0Q0KeHc35GFo4aJOFc25gNafBu1V/VO0qS4Qkb6wjRrnlepUWjtYyaDABZceValuOMtoDdeIITWKOJiwGPpB12lQgwkmXh9M86podb0D117mNQ8ElluFvbaS8RTKQ6lyj88dUwoJU/ofOeubhoXWBF8eNumkVJu+As3ED/AvLlrV91UowIWI2m8HBG+a3k247ZKAGYsOcWe7fTWqL8eqwM5ZFuoXbeugPKuMOAtOsN+4dSwkhrSAlfGNTzFwEmCNWtzpa9CgPbYNcmoHtO8pj8qMvlGET6nrkJoQ2lp5MEUV1E2A4ZH70JUlCLXvqTIpZlzyxdr5p/GZiD1/BuFOGbyfFzhuxaC/l3lC2jjt6GNRBa06AqqPlYtdA7kiidYa5Qi0/XpXiMDyMXNOj3kmJEaXufW0GO8+DF8OoMULX1vvjCePKNis4AmxQKLCF+cjf/wyilCJvuiyLVPSdsuRTPZ0AhpdDF/1uFmDwG7iP3qYwNsKzqd3sYdnMolCOuQOIHWy1eQpWhuV+jmSeAC5zCc0/KsOIXkZPdiw8vtB33jEBpezpGDBP4JLY2wH1J7Fzp8y8RICqVd25mDT2tDb/L1mh4fv9TOfDH5dTeATqu+diOZi+/sIt18hiTovPsVQVaqXLPRx/4R/uH/86tBMcF+WBkThKLfblcVCIECc8DgNRVX97KdrsCeIK+CvJZMfwrftcDZDZyp7G8HeKl7bPYnTKX88dXAwAyz66O2chkPDHy/2K2XcT/61XnlAKgPwtI8yP9Vu45yh55KHhJu93mL4nfo8szp/IyDjmFHtSMqqoWsj8WaVhbjXgzZxcqZcyOe7pUK6aXF/Y32LnBOt0WN28UmHRiOpL525C63I2JQPX8vvOU0fz2ij74OeJ1Apgu3JRObfdo9xGDpp7cv3TdULEfNS6Gu3EJu7drBsBsogUqUc6wAUW3ux0/1hLVI/JEKJrAGm8g72C2aJSsGAsKFW4CBvBXVlNIKa5r7HvT1BeGYBfxTR1vhNlFFNN8WQYwr39yT/13XzRGiF2IsfE8HcN0+lN1zN/OnzekVBKkFY11GgrK5CLxrE/2HCEMwQb9yOuP2rTXiZzTEETp/ismFGcTWmbM9G1Sn2D/x3G74uWYZY4rgKB2Zo2bTKS6QnM5x1Yee66Y1L7K44AyiY5K2MH5wrTwxMFh+S8LzNQ25z6sunWZyiRwFIIvSnioltUXNiOr+XMZ6O9h9HcHxZJkfF0tUm6QkU7iJ2ozXARitiL86aqVsMOpmvdIBROhUoanPtCjgft8up3hAaKpw9Qs9MzYtBA2ijHXotzarkV3zKEK0dFFQUwT74NgCmGGuSCEDmFCezXPC9BhyGhmzNa6rQeQQz+r9CmGUZjIQEPsHwe86oCOQhWaHERsv5ia9rZvJ//7UXO7B329YUkLLAiqpLRsVV5XpcfdawlJqi/BVcCqO6dr9YJTFFRMVGhfUbB9YWNvYPY6RyaydAFYq1YIBQxuNAGfYWLMAHtt2XRHoOKCLz+qf5HCVBDOPOktQ3SdJBfxUkaiD585bmTzMwU3oeXUHZ55EC99Kz9kk4ZXMIENwVVpqW2JmGIcUiutIMj2KkpjE2QD+dIZUCxcX57kH7hiuUPnKCTdaw4KN95XPeFRvMcvo5L8LexWqvaJPECzwXCs/4XPAlSMpWUzBBjK3pEnkbueMkMJQrYcnXf7PjbAoJra1VLX4YuscQLpaeYWbT+h24hCFrfcHjxxx6WTSe4AGY/KHRZCQKqTuFWt0D8RmGWmvXSdg1ptIefYPshuIVZT7CV4Ny67fvjJugy0TNYHqoCO45CB88kxrvIsih19DqjD0UqiJsTFPcGW3P/ULOG3nb8CjpgVTIoa5nO9ZYEX4uEHu8hLXrJPjV1lTQ5xTdZVagg+Wj8V0EE4yPsTc345KM6lVXqLiHtm+G6edC4GVEiPgd98g+twSYm18gCsPnjqlLcFm9e72CLJbYD+ocIZOxuVjrX6IKh9fh7WqdIZ66x9PWkDGOVVGkx7jM76Ywe16DX9ng205kg5eq+R2q2MguTJxYv/wWHliD9mOYpzZKNXYC3Wr4iBGkm54hBwkPzFhiX/VBHdVH/KJ1ZIMOHxIN6arKdxrm6EBsgwDt0mPe0MX1HRUMq8ctcmysU6xX0bzM1J07kAvq33jw1q0Pq2cyMWme8F7aVkfhzZEFdyi8fVBQav0YZqvAjZ83WKH726rBx5Bn7GHFthR6H4lFsltu+jWmsAibJ3kpWMG/QbncU7n9skIBL0MuXXtj9sJg+4Dl0XhKJ1LcrMydaIgyrgZgScP4k8YQvcsBmD26X1iYXKLzMYfZn2IfRjznsrJ1e5cnl/3a5xiNoI6n1x1U36FWckJbyx+hiSZg0QqAqeeSvzFYMlZ2REnO/a6yoQhu7PdHMYEPFIvfyGeyCU8e7rpju4DrlOhszj9rOIpNsvCkuD+TLyf5J7D/wsPkBpscFVI1q7oUSU9bN30vH5AqnO7bsf+9rGhtVjOJQ32H9hHSAzR2ape4L0Cz4WxaySm4jvuGXwkFp5NMMLrgZ8LdA+5uLuyxO5SMOmJNDBcbbLefv7z6LyxBwltnfQLd7qqpG1MmNcoLUcx73BkNF/xpdS0cKd6G646ntChXSeTZJJTFYGw39T7fqXDPKoG2cF7/ZcTvME42gXLVjTqzAER1Rt5m7GYsh0X0+XgOeW9MJqE5j/rpGzY6vUu6ACcCTzDMdZHiWELpDnvgE1hmztLcSYz0MtNyUBLqvylUJJnJu79Sku9NMHCTkgqozTnhMFfduV2NLCSYvAI5HUvQp1h/M02vKFD6eosIkGTg6mujUo1W8hy5Knf/erkBQC9LzNqPAYCgR+hczgevta88NNqSlBZryq9QNeUK7RpbvHjoNhUKAAeNYH55LeTW36KyFaXdAkBvyNP9xmRuBokPi2OhqDby6IZ61mwfzG+GmACkS+G80A4WGON5izgJWeeDK91jzusfOi0RmEsVJXwbVUr8u/J2LCQaMnHhi+wJTEPN9tS2b6W4GRGCNmtjAMgPsP357nOeD3H2tcDAPu5xQBKMHf/j4ZhXlkvvy3YmBJsjsd4pSOlfPZCnw5JvzxEXM5JIc+E2mU4CgB0mdJnH4NEsCHYNeVRDXFNuyZUE4nuvaJf1h+11AWLdAZ72D9XNRcxfb2+XHZN/SN48U7yl+sNZhg5gn/PD8wkBtnRj1zBUPIWnoMP6yGUEEzuT+VaX3x2jEIZAZsr3rs9wCfY1Ss0EdIFFzBbyruUup4EPanbSYew5tf16/ZWVup5iykttuqL4xoC/jdZWsAZeSfDSd3fP9kbyAFYXkf0Q2lmxaTkKRZrCo9XCoiUG4yP1URJ5G7+HSOhhJp0Anz0N07QZtyFUye6rcgiOFbtyoO1lkuV0iQ602MTyFK9xLqNHtNy4cJaTO6hjtiwNynVc34ZA6H7k8ai6S6eF6jIG0xJx+JfP97lzuCZr8vU5SIzImaNpiQhyvDbz23//PJcOk7hD4iIvJzfIgOGIR6ZPEJpWHZQoacbF+omeHw8aWHaNOfaIyGeG4lEryMfhtNmWh4RAIpn8dLs7ZE2eTVDwK++xDoSUgh47WDmKlZ/k6OosEUoQjk7Q+Kp7OxwgMFShAv6z4pTW8loVj2+qXLQ0T3hmIue8qHy1o/HXjm089m71t6mrrUyDftqMYtmfvQXKDlZ+K1HR/FkqPSqcjGlcPPIwbMw3wIFKBdVMJ4pFLt+oOIkWZMw8pkoYZ3byw4LmAF+7BdicGXFcb5PWtDw5XNNVc6eB9dv0rAEpgr5J+bLr010bpfGw+IkRoxDbkDFmQdEQUSElP5bViLo1ur/23KN0jEwl+rGC6AUMKxHcv+T9F1Ktpn8jSSrKxJnVkK8UD/tH5DN6nXB8mjUdFU539e9ywLtLYCwmHYVEVqnFmdubduaSd1ivIo4pTsX+mJcOAkrR1D60RIoocCBIdwJhCBM1rOE2XSlPo0U+khALvw+zfxYzwzd4roWlLJkZheFRR8QB8v4USwmAcDswUZ2P/7v7Xa51Fs7orYebYyww4YW5869Y/c6Kq2eTR9HLSjYuChTkXaDygoo8nz/yJ0KzfX8oowaNAwz8HvQdlLU9V9hjqYMURyYvPzZ60G0itmUdZwB+sY6rUkMAZZtWStbDFmnk/dQorhwr3121XQWffrK3as0g29ASwxbsZ3dZAq/96b7/XWckbjmo8+jwdE680DzoEUUivnBgowMuBQxHXoGyp+w/cSGY88rWtmwoyNNIvChs/QsZRnbdV7y8x7t2RkliJV/j8e6qfctrTsMV22zoqgQuTSNFh7U7p/Q49L0kygXNnEYXCBDgi5BeNWxu7VjULcUHI+lGj+OTCEATzWrDmaynq3wT9IAejtvh3esCu6sEu9JOsXxMDpqxm4Tzl+pt2Wa5Bq3TM5TKH4N7KLir8FGIPA569+uJ1VEL3fW8Jyigz/nEUjAVYrdCWq2MnS4hQVgcvXq9aF7Xke/k++rAtIQqckPNwjKrV2t7HCOrA1ps88Y5Rw1Zp+9itnB71j8tNiQc7mV1kUCQXkoi5fOsq1uC6hUPUL7Z69NAM6lg0c/aeiifHoi35v+pVBh7CDM1XfvYpiK5JIbIQFHafmnhHfRTnMagKcjdE7zzgtxkTPKVrObTySTT51g9bB5ro/dzn/sB24fNM2LGJuRQsmC49PLi1jTRfZaLpo8Txxxczij5Pl2vur+S1wQW3W5qyVcIUySZHtFDQHv+EYDoZG1T1J7D91vEIV8dHzUBzW1UyuxRbP+M/CM/vsas6RzmS5traXnQ0Jzv9hYXxKHcs15TQCP744XsLjzFjILYURXFnhM+nnV0iO6nwls9TR4tlz1J9/NvE8FGg5mgpZA4htS05AK0NnU2gxuqf2vjCyWlm3ypKvaX4vxh8Um1MHGB2NTeAFhbDyGm+5w2zqJAWxVlj6dVePb5yR+aMhuz05YubCQJ0BOtoYQ6PoDoW5fCwCtXj5SHvCgL/3B5z2mcXWaRTf8/GsFAfX/ntdWZWFc2xg8MJeenwZ4dZUToce43If4zVb1ex3BMAWGhgkPwR5EgktZhW3Yi+nsnZTUr9FYI160YhAraB0zMV+ouHz6hYm25/ETDM0MTmcypoGgZISSkfwYAQaHGY45yZ91K4A4Mm4fnbMk8GTc4orypT3NLBqAxYdcY/qCH82PpIkmVOEHi1NoYaUymuImLLcib5pmd2MHTB3JR+4rLdRc3gtQ9zeFdciciRiWviu3HkqaLSxJeI2rgc7OKQslItumACQow89elXmi4P3gTZeCauvMH5nF4VrBcLjjwGD+KlKqe/RWIEgT2wGqAgSuL6b+RTTPnQZzxZ5y5HQJkEEKJp5NfoB8hJBM8qn6xbOFtyzBjVBrwSS1zCJR3lEc9ODQ5Wu/xct9/2Q6qLHnmNx6XwZus/i8rEd6UsVxGtoDrm+Br0L5oUojlwdcqyVV4PIMsR60JhZwJtgX7izQWj+GOeF9DA8Wexdmv6DWjgR8LEBp9YuPAM8tJDu3uCumNqHnF2ATYX/tuVO55OgQuiUhmDmJbF9jJyifBRtxOVI9DCNLUY71IXZYTuiYcnILQ/XHuVJ8aHDStL0N+3eYNvXwHi2vEiTPnBqzsC4TsPnFVnYY042j5i7C11AVdBZ1pGSa52jM9dIL119rry0mgGxFzI8xPs+7bmMfYKh37A4HtA081olG1m9S4Zch2hoNCGVvVhd6UL7C2d5hKIBHoB+Uxarq/4aQXhh7IWjSj+ca7Vhqb4+ZwY3nHXh2S9JH4XZxQojbe/eINxYlozTYtT2rpU/xbj+W2hXjFQ+z+dQ8wh9751MP0UpjutQdxz3/FJYAEG5BF400JXWCBs7KrCRf/l+F+d9EuwVk6thOPDB+HNS9iWlLmDgXvY6K0vgiyoeA3An+jWufdAG1suUMBuJT+/w0FNJZbObUT8c5q5WtQxASQF6E+/u8UwVBs1eo8jTamCrcdhZJlADJbqn3crcDHQlBQNGq7btcGKiJXW6q0cn3F0xzf+k1JJS2testB3rx15ZPTDXm8QV5XE2qxBOdM2n6t5YbxyNOmEdsHx+hMp+y9pWkcgw1NikeXuafJvzcjaNwE1Ad6gG79S68aO7jWpKgBETYLmV4ONHhBk7Be8tjf2WVvWMDQvQdOnk448yeMv1tQKU1xev0L171e/qxkMZbmkfKnd29XRCK2hgNNJhwt1qiYWZGKz7Di6K3fGDT7DO2YQ7WU33svE/WKGbWQEvzUV2w+VNYDocI4yxQ6i3i4zU2TjmjCwu5Pk+Ja9HSwLpEoUswq3tFJ1jimthgMXd7KjSl6Qd0K+vxWT8G4/+xITHsWDGSfQTSdFQth5uVVfa8wrkDZHTGVgpJys2ik+3I0dSf6TNo6A/sVptyY/kx1hdAWKPI6t/xj6s+fPMU3hg1vkEB0RRHq/tCy3KUUhzU/d0JKxTyjvUms5iy1GbOFco0NA4t83SK9sBmtLWm4kOLLflyxqgQYP08iyXwYXzKnlQ6VTipuaspSJ9g5H5Lu3eLMnPKbhcwuEg0VZ80ppJWjUnhS3rL35erzysp+fJhxsUs86m28/UwW+IgrS5Y0zWaxlFJ8xML5wk8sg1ragF+eNajyI0Y4mwStxt1RZH2BjaAhvu+SnNNIK88thEgZEsoHv+ii+OMmXJL7dnAiINVDz3tCnqDgpQX9OguNGgZj3axcjq1UgxDw785yNIpqNiLgv57399jVmJ0/RStNswaFIs6FtnkilFZldxj6m562jL4p5g3Y9XCiXRJX6nq2PGJFifFR7EyPG4jDMnBM4t+O8ZpEp3th7TCxEw+ZG4afHl4sNFaqxyLh6+979tt0Aq9BrqI+CS2U7HJoKiGmyVU1lFa3/0O5mNC1bzRgNMy+GXyifLwJP7FwUSUmxmVRpn+gnXWoIuswPutsiciurvN6lsMG7yqEc2Y5ZI3jrPgPq0xEKPZpF7teJa0TQn8BQL4Th+hjv2ByfwKookyXEmj0d1KMcsmfKaeKK3cZZubiYqmSCrnGpYTwgPk5itKucVtjViuswQsDR6TuyGSIHYvlz7wkLg1Rr0K9kV1o8RgABlhbLrN74cVWJW6TnfXN0q12JFMpUbEa8t1+j440FA+17o8qa8PQ9igkctVROVIfB3jU5vtGm5pYYHYSDvU2TEc15pIz19ka1q6c/7WXfF8+POkApdOw7nn7Kqz6V4tru7NXgnA/u0g6+fPRT3hp/QrDQwMsjwNCZxdWrR6pgCBDJNc7/KAlwC0UZ4yWQs0KsuwbbOgcTxQPK54wiXr7s+221hzZ8RVxfoRUKM3e4lpxHC83JllxlrV760tl06f7/65qhE1jhMfivAUXIXfRMe3uY/G2TpWYzDrw5Cm5cS062Bx9lhHq9gtJp8xZwAtSdSuW/Kd7+orEAiswA76N8ezmVGYgNaYlQ/xk930LAWAtKVBC4U6R08L45IohB1kFia7XJs0TcaT2zBZoLFuOGu4iJaoAnfjL3uS6gnRH7G7A+aT6ETlmkYUfgrBuaSLLDJfhPJe01PfN0oqBTeQURasl3N8BZiQSgdr0aDv3hPTiog4NSyfAUyy98WP7dnTDWQTY+Qwzgk1uxwRqHl5MpC/84Cuw1TXfRlgJrwPop10kCHjmffnFdxCe2J3R3J5j+3H/sZn3IUu3Suy+I+dAOMWvzwExNR3RRPVelZAhtarKlXPWNjPRIVP4JsAFSRXs3o/fSYAPaV/zP8q6DltH47/rYhCLdy/LrpOsbaLf09eACcClJosNefetNElkSFSuCgeY7oTAAl+8Y2zOXJb/bgEDpoDXfQqc6lnlBr/WsmVznkBS1M7ufiqpxvKXjwvR4WxLbh5NbMNy8LsnX4UiuAi8XonbSUcVZKQOWBYUecSOMj6jMG8gHu7WNreBHY90lV7FocDprSrSbexkAtMW9KlXcnrOyLnZdodGYdxz8aw71HztIqLhRdCOB6NyzHPoS2hDy6wLk0I5Jr2t+U0A+A7EsgSn/Ih03A5CspHnVF4MOic+Lck3m61Um+GHDEe4DrHBhmgtDlRQl1XJ/V/VumCHtUDDcZCkgjVMBOmVOGYW0Rcdi1ahdjhBcFlfjA+5cRjBop1aNDvdrf7CxkLVgxiCxhRctW8wczM8+kVmIrGtkaHGlr8y2D098HXE23r7fnJFUU68zyeyM265igNOGPzFG0dIgUDWN6S3ZcfMERJdWVvpGhVEHXNLeWqHiTcF3wOt0FbJY4XHEpmkoG9MQPJJ4ueQ01+MB+SR0rCSGzlE8zod19q75LlLWgzogpnJoD4gPxUYcX+Gpc5Ly4nk+Zm8LDXcNR7SNVxLh6NAcx8ekjb/AC7ADlRnfuHaHJaBodZr7RBX9FLTvocY6kY8bavdAkQicE9bbwGLkZu6whTCJ56lOvM39ijehpTOFqR3V53nQx4hfOvwRPU2y2w7UU8yiRbcyaX6jGJ9CRvl9ybV1tebTp5MMuMnwLcx/lven0w9T0atJuiUE2WtYGiVMaP3EchABl5AsyaCpu/BKAWDFvU2vaCL2/fJBKCKLjxG6xzT4Mh4wHhH3/EqsGSoQAHu2wbHmXHj2LvoW19GXDa2oyeKRwGG1PU+S7mE/S+UmjHiDF1oqJ0R5QsdjAZYN1MzpNX5YDqWYfhfdjAXyFQaVyGKkp1oEGTR8MK6jaGfRDFd41u2Ex8ac8jKPYu3pXsk8gu+m9tr1RVzTTuDsACW4S1h32yFHX7qpXSmA0QVEcR8W9j2Juu0pcYqTmdis88VgT3gq7iYue5Hx/3K6hFQa9rZrNSDcjaSQlNn4LSqs20bypnKqpzvnnxjMdz5StbzvoAJKgVZa4DLCVoJW765/KyTF4s4YztmAT1c0pTmKJHTpa106FegDo8p2zD6uOnwpYi0vJlRMDe9wPT6964UfAf6lq3qWypUOx9q6BbKEYt7K3gWMXDNN6wAm1fNnSOnZ4JkbPq7jLQrl0wL1V7QwO/sXneKGfTgUL28I5iPVG9dA2gS7Ki005JUR7Vmw4gX4TJvy1WS74cIXD08LCF5obqcZwamuoZ+FPMJEck0TLHjyH1baPr55/Cy0ptDfRJ7d89pbP48tLMHG5dO11Z8xSSpPGQSgXDWmpsNsmm+MvxJjMCi7OFDHxxpmTtjgnOCq+c7Fi1DybfhAntviKccz+sj+OPKPYOKeYYPLvq6MpUx/chSvBccg9dfbeqetQNCs3eiCFZTU1mrDido/mib64STMgsa+IKLk9PyxGGbVSQB9GsHto6f5prAFIbRDSItDedz3t5+Nn69FFS0nEfmkF7hKBmNVce5xv65USKGBoHYxJyutSGnRIq7vMDsAMvirOEJOzNi5Kt7fypuSU2c2Npo6UH5jMOkePH0TwgpammO3Fb2FX6f11309z/mqRmQ949HHRj/wMzKNx95M9pwKf+UQkMEwisL3YVotvHhCv4y00Ui0Ql8dR7tGqFcSdYtmoAOuAodkBNs4PZSjAAF7S/szwLddFMdCyB/dWPgFUiUE+WmUUCjYrKfJLQfNNpQ4NKaF57w7Kp/isZVwQPUJyjJavN3fQNKU+F74jVBJYQEcEdw0Niinyea0l9PJ1/AcTm/LI91RZjDvLI81pnat7RKU2P4/TnIAa3hIEfeg4iGQ+wTDlURK6YjNpN5s5VkQW9w7sDYKU4XmjyZsCQLxztqd4SDQvLyuPDhURAJXKfR1c7tq3mRu4usFHPqz7HgS0X7kNxiWWR3fb3uVwbgKpmgLYkwKrXKt09COw4MjhxeZlDXKy7nNLHXAIKPtferWQnZLboonQXK81x+BB3oUidBehK1swSXxVbscj/LsfONu/xYEXYPM3aMqIYd+2hAnFvDHbdrJLhGEd3sG5PyxqhzejhQJo9wauFK3xmPYqxB99J8zYU9/yzrEZNzzbvPoR9vUlE3Ha4zspVDzHHffPZMJ1VLZkKqGCf8ZqupqMt6T+NRPfmPm2xeDgvzMrRJEL4/zzlu7Z35smvzbgeC25VP2CUrZkRxEi15A0769ojdO1d7C9OG+swj1ROMM3NgKdeBADoRMeJkRZcZ1FbQu6C0BS9NNSaoxtFzYT4lX7+PQ7BKa84yrN+ujVVef+SgnEie1G0N+eOtbZF/UU+wkeerWjloYqFiqo0vBnmxh+TwNMo9I/8lfU2XTCT0K4OoWE08ipyNHjxHvfhY6qa3x4HzdQ8+jkiO5+j91YkihS5memfpFREHP/2veN5XcRue2zCVuAub8V6vDlOvyP+PBm+owyRhMmng5wwGGIXsOkQekXrXpE/6dFjkHwwoFoj5bIFiqp+4wHpSWRbv2xGrRpd2c87FzMP6Hfj/3LWIBqFiNOAxBw+AAP1XqUBszdZhzOSQrQS4Ein4fyV7MaGsB0VsMF4bPb4lx/foTGQRJv45LpoxDd84xCawHaX7jpXUrOdkFxx2oUvY2xqpgIvcVufwd+zAnaaVTnEyDXD7S/o/xrrk4mgTjXhcjj5Rzrbr23NmuZQvpdNzny5MCR9bwvIRIqzOZZLsstZSCDYa56JTvzxgBs20dYTtTUbe21uljlWqGfSh2bYAzOpf6UguK30ZxNXgLHs6Y6urtxFA5iLYvlue5mDONW0MOtQjhqr8fRbCkYneiDkvzHkQVT4F9v9vxh2SIGPBH8bZb8ugo/BSgXojeSdNXbBAIDsB6DUNSXnwlu/bFLaCqSbvu4+YLplwO1JbtrMf9ZUfsxerAZjB7E/zl3qwgK27FswemUmSM4i37YAVhQSocuV8AcDI/CSeCDNPavESshDQ8A/lVIrAJAMdP/rHXouiNU8RL/TIvfQiuZEb6dkIKMGGOW5kT8vO8pivWnT4v7qmwuJo52AS1r/RyQ2g/7c9ZJgmMIzf0GvJJRfMNu1utRNuLWHOm9JIMcJK3qiDtVpGCDP45W1oTTMUnMC91kYhP0GHjhCW8V38xhjHgFFBfuWMsmSQ9MvNqKXiqtUhDAkIy0PW7YSKaKUv6zctAiIk+Jt17kG6LpNVOeMvJnlVBaJSkKe0HTJJUMvf8R2zna35/yh2wNlWLzIP3BJR5aRNxkV94ICOlycI1/JYRZtzvWMNoIpQrdNvyBuBydhSwhRwPo079Xk/XQZpbhzN/KK4NbdJQV0JIMP+Y5UBIM3TTYlFGYVjcvA5yVozkimco91Fx/eo+ydgAx1gMezTh+bYxCtXPYkMoPdtaElRusxlmdSV9zgF4Np+iylun3LVxCycAFxGCFsmARf6y4I6zXY0tx81aQyalr3/ih+ZjxGNWdhItgNLdEZ/BOIJpPoAveh2bKbEFxU/M0+4xqDo3Ox8MnNn8Lmv15NJigSvJV+y2W/ZogEXNiv0/nuFzZGr0pKujOShzcdkEVlMw8mNZXZCbtM9V+mfawtLxCTvo+enFWhJcFv8LVTFycDjPGBXRQKNN+z68HJtYdpH++g5WdhQpCO+DE7Qdu6TmZgtetrpU2ZlgpslOx+4hb3aXaqbdc92LCh51er8vm1GQ9uWD9+fAPRV50ixhgc5zi2Jsg1xQVxzlaELRWJ5biyF+eCwNV0oFnTbBHr3Glm9qlGVOpoOsQC8hlNG88fxeAekkCGnHFn6i5WzyO7ShDYbZ2KM4eqndyy01v+6TFhmkxgc0dndt7EzRCcEfBxSaWZwcev6MDZcuvSZQ9CNSd4Tx25TY6UAbrhikuP1vNFfPdZhCG1pe6vx4D6Ez3zIb0zDa42FPpxWvIpEeXb7YTcfZOahSpSYaWLH/vq0F3U1KO7ZxliZpoMBBYJs91IE0bOkrPNQ/USYY0qKCO3CU+AFbOYxzKWBkIglrX34377BZ18MKQCv1KWfIHEeguSpvrNH5RQOD4LeiH2gdx1MOAKphlL41F4RpxaU4dy8xERFgqoyICQq9XmQ8WJSokwqvhQM0fLtsvyCO2PAkJ3BZg5IqoR5q/GdTLgOWPFR53Nqw9Ma5vBzZcQ4+iZgetmKg5ZIn+/7Jbi+VlViXuD9CaAUtdEmnwWTS7wZWuskVvc/SDaaKV+Jz6HrZTHo3UrAu0IZDBkXWmL+mTTjdTb1A+MdhKkY/hvFNwXj1FzUngsN58u/kTdJ3Xi0hy7efR6faAOi4SKGaiOty8lxDFkiD9wq2GW1EZEsoWGw/WzxXhWDzYY8CC7WuLFHc+x19jhH+FiLXwDIARRtnkJPF2BUPZ9+grZ3tjqAWhhN3h74w5pooRQUNATy05A9HDLnILGSCtfESoSilqtqAIQ/TV2t3KhOc+teDf5t+DqZDdB8Ob9YXyklrSO73pR0QAxPvQj57c6FIR5dOciqeHZ2LRABMROo8Jk8V6JFewCL8TCd/A5MSbXLky1cW7mXobqgeEXdFDoEydKo5oCuyn+2JYI/7pIGFAzErlHZ5hOaiT17HC3zp2HpJwsIAb4/oIoZ8x8ak43Yp83Ermq55Dg8HxKGHXbXs47sh0PzQELTGFsf5eO3lYAuJjMneoYWk8W/3tW2WLntEKBZEW4hOFgo8K58Rj0vk5KLyezu1d8SO/JcuxpOJqFUM2sxBmbQ/9qqwb90R0WulpR/Ju84bQ5/fTh7po/pbBb7AQaYNdK3fatD3K4TLHAaa66MQzp/+ZGyCjzo5OXRzJ8UHyg/YpNHvvlOpwQIOjakpLHwGV4WsLDPjEIqG23ily3LL0dlkYQxj3Xx0ApCo35zYGoGOtIclYS83MnI5TwVdQ+Hg453WFQN694DaqhGaL/dm0KncXYqXLi5polgT4DOrzD4oSVhrkh8GW2PaXjOFDCLPcn4RQj8dRGIJuV81LxMPZ0UL6zpkaebhbFBxcRJe38UiTbUPDjFWk2jBqzrBvXcKmgdDcmRyJhIpuq+3DQY464AlY42z2EM0yIK0I6b+VgpanMfpdWo7OxKY8RM5tSJv340/qD8SxrYsybMuUkF8fHj7HcvxEPC5YYrH4LW1YKg6QaeFZLvPbrHZHvi4OXLKkN8cGQO8019OKqcv6QnBlj01e7qS5evoGm53rv+VmDxxCXDiOrDg+IaPeMPrn8TJ1oReXYI3yb+4HQbikxP5TQXHk4YXPUv95+KmkxGsRgTwP71YiMpqNXp0loHZeXRp9i3euKrVtxMM0e6XAoACwNtcc6sOuhZVb1htBLudzahrDFt5GkdlwHjZl5y0LbvSHwII+qYeDwRKTTzyXaInHIM+8rc5TrjUlPRVwB5LKFpQnV8e7vLv7T7V/iJTW9h9TnRtNCSGcofBWYm5P7wZcAq3AFamEW/GMbo27ldz0plt5HI53ddWkn9IuCZY+Iy0MATUh3YenRTbVgdLYtu893SuN6EL4e9V4NhlzUjI8nOS6B99ecyC1Ot8sDahQpWHbmt2YvWGyL3S9tEVLKYs+LnghBmmSl2uPWfqPobPwBHNLW21LUjfZb7jfLMTsMp3icGO1npK/rCsUgdBVKVg0Ys+/WKuTmVJoC8Oe5h3PK1TQhbpZ2ytP9nlutQPtLAEt+CVT90DfVkn7lHLOX8AfS6HLzfHeAhu1alnl19RHKV1LI0G7RPzYgVaSpX7th9f06uo2WpxjL86i/2uzK2qj/ClHbGDyQr3F9/axmq4kJ7zZFVXVVwfiFr5bhUGVZeQJHKFAcsnqPKsb8vHyB9SpFpT9U1U7D4aS9vYgqajxhC+hOkolJV2dKAxysCkWBo3SPiPUrSQYZxOWwWCoQzbV0oeaDEcgUtqI3nq9TSmpQ688/+wb26P2CHLY1H7q5lypXSrnwnnztq/jN1o9lyvLmLyGguV0VJnDCREkiUNrZqGG06MsyA+Phd9CuFoM5M1Pyk7S6TJaHdTw0ni3n5ysAup0kyxr65lFc81NcH8xSmpp+iOEtQZrH/y01k1rGMRJAGFhi+nDecpUlnrh+qBOCMZCcSCovOPJrxjZnZJDMLdpMVu+tBSVS1nKxsYjY9Dtq1/++riVfLUVhzofIcIgQQPOqHioELxU3EpCcZMoL9laa5YlOZAMEp5apx7CphrkL+fyKbBAf8ctwVd93FTo7F5Oc/alNsCgK6lHruPROtN2RybiLqx8P5LTUZXU+Aoyz08zYHasR3U8hPDKj+6arWXR9yWdJoMn45prCSURKKy3+JHgvs2Ot6v6GbEtdCumgCttv2VNoU3KOqUwqNIWHqYm4eMijTM9VWB7umEyp7UPOI8fduHJY0W9xSCZdvc2xMjo3Zdu2o/WZKDMOSh9UmLvo45IBppD2dG++HJu8kbfFdlwuIxk2KHhgHQeNKcHhFkYGRzL2VJVMOAb0Co64wvds5CaYl9ZmBm4zuGDeaO2eI1XM4+rD/HmZyRF62SabgAe8TF43VuMutigJJMfbW2UK0azGLFbOfujnHD+GGBYmSmOQbUCOY99HYvswBQA6r9hrc2jtsUUxLVjxnZ4JnIrTwIVdWCTPtpJpvlA7m01/4tbUMyz9mv1jdN1jkiHQCJXXKg8bJ+aqW6rbwbn5yDSHBTcFXIegrhHGAjJOZI1pyP83Z3vMYTAJoo8V9IwyS+U6OVg78+IhSYHDYjRs8FrF8smHQ9h4qAYxp49rRP2d5uxLAuP72GvZaYvfeLOkMrcg0PkPuq7NsXhMFmiZa6PKBH1l+oKHI5DBLdZCvCwTPdXqmnz8gLzVRb/ixLTSdit2nrzt0x+5rDeZT+ac31NKNskQs6noKlQccyD3UxzfVZFmcbpmrfPsZD0Ve34xpKWk/E9Khn4A5yVPVq+dwnv0EyYecPqXGU7R8suTW0A6NJWweLI3iSGDlQXzMYsSWkSMhFTfyA2vTDt/3wXk+mVU6bRNkZvNnyVHYiA4tmnNwdh/RVsk/EgSerfTIf5VBmuAc2IKSeL5Nbrg3acgFj80mI8SWsc3dNAGCBLLMP89gH5UnLTKq78d9SxQH/g7DVnBh/qnBdw5CDrw/uMzcdXSxWqGIFcnQZt/1aOHxUg88MN2w+FPx/V75gy2wzEVe6G51PQIR2tZsxbv62HhgjwtlzrVREw/yzlaAiuXC26cnpvQzWXp2mOgihyPCWqq38nEadX2T7f1Y5zGxEGBaT//IcL/BsquAJX5EDbX8X1p8nLWR2yyjFRvqC/jssoCJBCDJOsZvoBfXqQSEKhNARH1YfueeKBslAwLi24/wAO1BHptlf1kQFNsOPlDvlYednrEp3a4SAz/G7LIVEsZBu0EKWZu/euB/XKdkGonP6t6lgEcCOw8mceuzvEVzyoPnMyzrqoNQXJb9C8ZCXSiedKiCgNwfNkpVlHbUgE2Rb9WFScOeEad+T+jT8XlSc8rcvkIuhAv/gxRu2eb2GonLTyokjcGF1EBpCJbhy2H3lhL0rdZIw1okA5pBg2oRfQceXTPzhuNKorTEF7t1UIgDqIo7/loxyTgbtKu29o9K9KujvCqUGyPY7upcfiZLNBVKh5uXAAZjQjhlhBp0ukmO4Avxu4xAVhCtnsOIA/tAm94U3HEuSr3wq+ZLo8pyoC9EB/q3pOzQRyCTkozmJwo1Ln/2xEbtNnS2S0NUIS3yz3/mBIdxONHxqP9FW+uoGI1F415lI1nZwK0SoPA0+flaokBGEoXgZnO4GOExU7VOjdPns59ekmDxqNhEHeAF5i5N/3W2NC1XGFjTpqLrnCECiwVkOTrLtp2ehUIaejOG6+1336YQSKMSsL4zhUjw6SQKryVRz5Ldn3R5/r8AOi02RJkQXPdvPsl/FMg96E/cJmIFLmEDzr1Gkh9G3zisG4pqM/MV6XIz+CtDUh6hmJB97VzN8jaPSS90vgDjvnaNlKky2/zIhE9ObugwrftI+Oi2a4VVaB/Mwn3VmaWjsU9NOf2usbcN/GLQMjvfeU/YvyEERPKw1leXZWWk1HXzY3P9MUq6MZq1hkEgFzds51mv8mnp1i4pQprPwY0TId1szXwe5TG+R5mMD76nGPQr7/EhQWksjsgGs7Zy5QYvMcGV5tcXJR+6hlHFIAc/M6XjkKYtwm673Bi+K1tNO9i1YBePTur4I+gMsOK7f7980mcJXhgdWdhNzUN2JvFsvXq3zZRG2V30sJtJYxj0aUv1u4/ppVHi1iHnTY3gDHsrQS8YwMX5XwZ2gcFYYe2wd7ZO9swr0gb8zf/fXx8QWKPXcK1UdJk3760B/TMlpWLCbhkqVoSTsOqzgkmFmFteCCTGhNyvFhw1RrTIWzRxq8Tj5FirvKvtkp2GAVhnZ7vnr71pyI0rKwQbVxKZuqM7GAvn2mRBj5p8djlHUsh/r/eBECptpbbjP5nFyuN4mvQLZCaxeTkDUzd/kNGLIzBFv1CElQO+xmf7Dzt1f7GM1Bh+wLDCJZlhcVDXbtPuGssdEie3lZNiWcXMTjZtWAT5MCmpq6JCRuFSHZYGKcSFZ9kOYJfEqLIcWdzpTA+Hmu+ktgSUwXVSwkaa/aHdZXh7IOyrudCBalCZpgXGRNbhN2XpEY60DXXO1Ci5ayZSoxtG0WRCC50+XtgWz7qgX5MRA5S+jzXCYy7O7Nn0ljVxiBxQNCZKZMTqi6mPfy2LZx76uyRUXHjnpJJEimflHDUxyX7fFg7iJvSrsZMH6Uv2xbfQNx5eCbx3oKycUrBY22KPmgfg/w07CDVsw6tb5VxPg5/X38cQtXI47U7MAGGjO28II12T+PjaXHlstPtkUQNn0DKkCYis+kVAkA1wyAJgYKLGnKD3nlVCarYqCkNIZbiVwO2Ydjl7N6iOtvvbAfuq7VKZLo0jEdw1YdsRaHcuJQulgb51JyELzYBkP1hd03IDcZfPg5XmNvYQSOINsCSn3BuLtkCPZRalK7+S97zxvJHiJCZJM9XP785NZ8B8fqDe/Ot0BS3PH1ptErwxBtpgfOj4d/41nrSjJQf9bV1kfdBHJxYbHILxOsWkZvoP/Z4Sl0Yx3bDjTF96xf96+6uIoQ351Ce6DeTwTnkPr20YwATlnhskWIddUohklNITCq/07zkiEc3B58uiBG6d9YAc4h/7s44FN2RG1UuZWeojrOZIhElvDP4KqHcOYbqqS95o7ilQH5ONJfy+aYiB+sPpn35HfHG3duLpNvBjXc+Klf4IKrFHjeVty02xPTNnbdL4gtkqPqMLhSgR/fDXzxJbSScqewiF1wdVoJ/fGL/nGWZfVlDHOQKD+/i/mqwXqvNqxtZeRHwoe/bodk66B9soOnZp36gdzVMRRQsQiBFf+HXjRcrRf9FsGghw3+qoN0JeeMvDJrkSBPsESDai/uVOzn2Ohge+UVdi050fdWpsjP0D/QuTdYs6QyI9xnhU8WT2+KBKzoZ7Bq8fOdKPeLulUhJjT34/EOnUloqus8+pzqNh/UdUOhgTlrbkuTfsaIYDm87u/GNIl3N53uaU8bgaBjpz0jdu1f59K4KFDtwUUeEUoeYx6DEkWKHdi7dtHhQF44lbysk7PqERrsuAQu2D5tDMl7kFoGdI8r/s8rMytJzYBU40wqeFvTl0ZVLdOB6Ya9E/f8VPbGx5MdpYqYMLMyB0QxVdnoJ+tgAQVWfH+jtOHD3PsjuT8dOTSrupuvHWRHQoGI1Qj1Hc6k+Mg84FAZ/gzl3SEzuGWZKFwuo2D3EiG95D2Z1szTqAuFRmT1nEh20tkC4ysmXx6JtN0taK1iRR62s2uNW5rSAvMEJ8yotr3UhJe22brlQn8Gvcq1I0aODaHJucQKVe6SXyfcDWODMw8xf+2C7Zx5a4Qlh7pJs550DictL4OxcDXKvVmLgVWRwb3moxv4kcxzm89EERJXCl7X/BziBkGQWOHPGF+6K5NFJYOFVv4+NyFq+OPMaSWZKoydplufY+CYyL63T8MCMmwqLTmAE8h0prhi174wnx7DHZWYuRJSYZ63uz97AGOzyI3aebclnud77znbZetbWUripe+AadLQeZPtWsF+FNiaXCy/98km137lWewyc7Gamai1Hd3Ls+KMMVh0R3NKTQ08TIClDfMKwUGKy/7YZlJHU3uW60X0r74Afh02v5MJgVOYkjmors6GAaDU7yKHydfkXYd6nEjYc76xws1LDLWCNNKBtUHNyLseOyNDgmHiJ41lXvq638RzDGis8WIniOb/pbTs+HsQVGPi6mxG+CU+oflMR6/qx3pVP+GPgqa0U0lo8MVmI1cBgSnPGgrh+J+m9TVg8nivua0EQP7xai44ruC5gsAVOp9bLsDXfHQujo6IpBmpfbbU8PDavZpTuJtmflVQuOImnRQ5kKoQz2NBFjdiHH3cF9QLgDP5vz/W5trCy22Uk+TCjXjdbCCHB3rJhKYTwiyQUf8xu6yTKtIwrbw4tzFgXDODmWYEnnpDupk3b4AP3qz4AZ2En5wi6aZV287AgCF4vH8TlWLni1E5Hd93vLxSYLBWSuj3eXGFtWyWpBkIeKu+YsBh19VeakA8OePM0ILu6dYYl9DNIK3kU1ybH+A5xYhFI/EqSX3vtNs6V5eQgxYLvu0hYFjiG+n8JzqLQVROiVa8XNQDYJtDAetPFSuEtGI3B8rnbbrNo9TJn/z3lRYq0ecBIe7a03vLESwhKOm1bGTk2kPMv/Sh9wyCOmIore7JhSFT9HIjonBfi+gcdDLfFt7dpShJmW1gkcXmitWwm1cC480CraHm/or2MHphB9Q1bmt/SBXFqXJdcv5GTt3IS2fRgqThhInCjRkh7Dk1iS2vMBLSGtRPppb4FEu762JehUMQxxLQre365CKoJGvJwVde91XQ+bDp5ZsMu/QHmLgITmwGXSpQFQlQBajqquxlwIOe2cyfezaSHIoRNLcwjW+epnmAtmmWA9KU29v/cA2iuWbj9ZV7HR4anhHkjbxnzKPHnIZ7Mm5wAf2o/3xUhnfH++quS20TdhalHgNhusidPKWyKWV8ZjFLgb1fX2r7ifLyUtxuKHHIfCWXQJ/DKeU61vxmPT34MTi2Q9r7/sK1CYuHVqMBsgtfenn31bUzCoyPN89KiO5wHveqnk3uyHnJSUBVTQQ3NyRPmeRKTQvWEBZ4QWcSgMyZF0RQgvUXRcp6KflF056fwahSioP622TdcTVYi4cAwSZLWDvfjoKFLMowPQpzn6ogXHc93fFA5NZmnwslSuesOyNI1EE3RM8kzat6thkmpOiGmm69Yn8yNuxz1YuuPWekoybkee106T9WTPXo44ea9E5QH2Ig6FZn716DBa2FyXHG1B+YfnmhbEpANlOi61BoGO4+G3WMJDokJXj9GhNsFqdaLjA1pkhLP+/mGCZoYsxNI+A+sMvWyoj+PMWeR8koRz+r9pNVEWT70WhiAkNTrojdr0sBLwxIM7D4zT+cVy96ZE+ABi9CqkM9VK7iOfkJVp7AqCqQ9EZ9emn8rB8zfoQZUBrVd6YS2AqiTFt0nJ8HfPGmnBWf3Xi5CgyWoLAmHJp/AfTdHB0+Ns5DlhL6UJ+O/6xys+CWVKtL9S8fVHkpwZZMJn6jVtiUTtXjywmiVXw9a6f/G7Qd4tZtcoS3aytxXYA9aGGmEeBobjiammhUaMDicH3nlOkDvvz19NqWOvHC2SMv7OQHtDIykYerPuoLz6SQNOBtw6oX2Sj3ZLITBDcWNx9CuZYYVaE+vleXnATrwn+PnuQ34jL52tp85aIOk684SUlQ8uyO2t+eIOHndZ3oxD+BcMAba/JVxRYUAUZoEw3D80WWOz0/ul+fYbhFnffx3PgOy2LLiu82D5FMSpi+Pd4EkIFTgfv7p/0vnX1wp0VpNzyXs/5S/4z0RFS21vIF67k1ERTfFuhLM/8fdbKognohMqTNF/+oqvXXLuJB7IHeDdn1X2eParLBEpz8y9CAN2g5VdE7EimekAOhkw+tTzqeEsgyQL4iVDnWrP/RcBd6CDm16/5t+I1SAxCn9wo8knzmpg8DYP8V/vHw8Stu7cliAt+G/VR4XPNZXWF2rZBeQO75os2jFJrbtkfhN9BzHT4HGgXTjyTy8NGsiQdeOw12GjYKCyxP+34kRHZqYsn0pFvVubB0+/emKRgiGXNRWQwMSvAB1xvTprD0Zyt08BjP/4W9HGNfNBcA0Qb9qF5hdQ4dDqpKAFLoIW2gFEVKOganw3M9/4WP9ckP0/g6kaJDRurtxNgT+PjvWYEWlFa80wKYCkd/0ZChV94njjGyg0t98Pz3AL2AFAhvRRiJwdfRcQqqhWkv/o6X45d5w1YLJOye3v7rgta7Ya0jAl/an42ng5Wz4S5we7n2+1W94JnpoGyV8WW2HYjKLkKmp4hBKlNtb5y4W1MrsG/wfq2N5Xrz2kqhdPQL/YoxgCQd6Y2KNkADVu7TxugQRWVuNL0BUj3JRFyWNeCmB74Wsz54OPnbq0GFFxzSkoiJ3Rtq8yEJMKvOMMalFKH7YFHKjb2nwrKVfuUUuRtTfJDiBuaEHHoX+MUrM2bBaAsSdnY5PjqcMBn/wwojQxzt2MoOCC3OEArr09ghhsj2M0mue5ntQcmcC1R/sK3zfShGJuazS+mJUeKxk5u36CYj8+SJCq8ZEv7bNf1+BywGeDQoTDGq6Yh1xW3Suwo2O/ykazTPK/TdVOICyiwK8MuQpK+FX3mqSPzxfLwFJ/iYDjs0WgW2kqXYgm+gkNToB5+jYH83Xlt0cbtEmkkBaVGlHz61rVuWzrK1yjn5nYHKvKCrBPPRth3AKDQQB83fdrbgIeIfB3iHya5NPpEyxbzmtN5Dnk7GqrQ4uu4h3QSoHU+74zs31cWqIx4SZ2bwWLvIxUtR6gufZhNZoMcmSB5z1O9TKvHMORD+VmuiqzsyJKA1OaApB+b9x6u9FTvUkalgl0r7raV+wRqimc2D7B1z/OiSagdd5UME2igLGUcgPlMSX1VsKQp/9yDiYei87KTBA2NPCUmgaLwVdvQFFFxWp2vGCY/KCUvxt3FOu6xIgwS4Vybvbj6feUCkrQPpO/wPHJPhAobSj/aa5YrUvjHMcQkDZwfc9mvghrk/PIPvcJa5InhVBfjh3Xr9vIvA4ac+m+pywS/EqkSX55xgiyj0TB1EE0NT3W2CPFdVD88P72SpdFzHS/6XsmbGtM8JE/m8eojzd4PM1bNADliZ+XG/9hbcKg6PftVKyKKt/8Bz4lGsHyT0VKj2vDGp/qDGBajSHrqzmpEjW5LXsb5kTV6HgbMcnPW2dzQju9N1sI/gPVlgGmk0bHKOX2Ws1q4aPizhcM/XiJ5EZNUK6bZNUeFaUJVTvGxglRUY7vdnoVOe0Raho3huh1XDeTlHpk/2gBjjhUQXe8FN5A4zcRqkNtKpSVq0xyw9j3yQlQxq/Lnqklpz8lXmzHkz8sX9HJjHwyn8UAjblvN0ZFIk4liejx0lVACoKvpsT9+pQoLY4weMHRzcuVC60DUFkaqLfclS4UJti5WK4FE3dYcc0OilX50uscLJomlR6pXriD6ELNNBWOSMt50CJjPkyt3Zn/xj1dlPVP1t6XExK+b3jMoULLPOrEGvjELfAMM1qcuBb0AijkIuFca8f8xapUlkvLjmmJW7RK94r8HaPzvmHHSqX9MXdivNI4A+JHy0VCe79UZZJvzMGzpnsj+Q6k3EItDBiA12fTMlSbEOMAWCdQq9TtyUiAaAqJozMzryEg0k+yVHqCc/DyJcCE2V4WXIhEnsOc5c8f4ChWfUaONhPPWogpDs/lyVCvp3m0NSfrAJKNiVy5aNC9gZ6c9BqwYgj/cDO3kdam6gCjhR+akALFYmt4ixHkWxKhDTGs5K+CwRiKJnvxP9dbxRPCBHbiVa8gsd2GuiNHZD98MNwXMdMC0MubVodd7dnyk3UQFfCIIL1osPxY0ZJ6DvZXwtZ2I0th6aqlTMULVo+lhSIU/5qO63lTSa3MgPRJEOi0AJ8/UlZuvgqLw9dyEDQoHTKWOsq+6fzoAyvIpv14fLaY+braPd6NkSaq0RClMenK1QLH87NZriUaeuCo6SZ7/CfUt2K6VOt0AjIK2jR0vorf6R8+TVzxZb+QdLimH9pU5tQc73xW93QRPMGy/gCK+R+YzmV4fHK52GWBEBL05EEoTY6OYG1WWji66dWnVTg0uPNw839p/yjLxkCfdTaH+v6hVUCd6HlROj6W8Mil6AYGC7NI2+qkZvJh/dAw/iQspXQNwwWHr6slLIp0hBHYTDh/J7Ba7ZR6cp3iU4bSXdmzhTahYDev4yKiIHyN64EANhI5OHYv1G4KXfIOvQizYWchPhzQg5eVGNMxsqrvWVxjtIbkKuHzE+IcA2NZ83GKz0D8z5zmgRnoJGKigseP9TmMS7BgAqtqyixA/SLc1KEUWrhXOQ6kA5ZQRazp3wwSa404cppBnfsS8EsEpbr/gXyW36cZ9pt1RhzyxGxDUmnZeBz/Uf1AP+gyLIg9x04u1fThm2w/H1ZXGvVqsO1VqutV5gUhFkdkwoCjzz3F3FUr1v0njGYT2mSZYvoF/fSd1W11c5VIhkEO06US5wYRmHVPYXmZnbK5YHQ8pkIDJ0yqssqFK34CuHE8RWb+Dr4omk779QOOcYomAMYQ9ILt2KUk2uNlahW/IjGtenuGLxb/t3aFoVz4oNwMZ7iyp4td8mdzgJAfnCcYtklubGAUB9k6bGC5DSkf5VFarnGEBWz600VGR8QywZ+jIYFZbtKT2QdDOYP6k7D8qVgEZByGmRedZRWaQDTggLyNgDD6pQwEeSs82+hTxWypqwU3zuAWqfwil+mytzVnKztyvMFJyJwPFaPr4Z3mTjyxCR2Jv674JVGGMUSWb0l+GtcYtd+NBGChwr8mB2hlyccget9liJhQEb0XgXfgVRlHlbO+jlZ9CcAew0Nw+tRcWgNnz/GL9Kur7RohRhaYZBBmQA6JhvzkazHRcdZDn0zDkfBmYP1PfQjP3d6qqx6gE7vrb3lBKEfK3Y/nCe4COdpr23oZCoIpssGXmqE8CGpO2bEwkSN6uqeqR4UtWR+xsgOzNeR49PTLJpFEAkXha5YaecJ8t/KR+eG7/HKV23zPZAMvHDC1rdxQ0l+6wlIgZbUybjBe6yusL7isRuuYYwg4+8+4lia2ox8RCdvmXlt00ZshBnAIfLkSwIqUzCcsD/d1ZG6Az728L4FCIqBKpbA6bzkJ87lYQpbaHpwPpqu3S0UqNDCwgg3q9MEn02X16E4xibz/rLx7NMDtHcwMOt9r1dVU6Hws9TvJVH7THrnSFESgN5eBy53Nq2Fdb8mySTxz5CitvVE+ZjHaYS3hq9Bax+uS7TxMIT4qJE7HGdsHM1/9uPNBylhP04Lck39JMe8v2dPOSJzyQoy8m/8Fc6h+X+5/mBVA9jAsG4vmx/KdUW+NXxgRt//SS2Ib7aGILsjOz+ZZQu/NMeuAsP1pFRTN90rqIVULbJ20ZJlrjoZD1VxHEoDFFGVWCVOT3jGK+vFD06gc3yDUSnZ7ZHjGmw4ZiAglY2nm78aUpXxI4BfUHqL6YQKFDCazUIryLi53RczlaTh0ry7WN4WpWK9sPJ0J49fu6RGUMYZd3+NrRvEdOrS5n+EJOTkr4lNzo8vawcYnR/n1Dq0rCHu5o2BGBEHABJbsFLi/mlWFO1MjpvUu6UPJjXlXse6MtBROT/mQfyegWGmFRQ7Q/O+rJp471+tQF10+bvkExfBoTQrewd5UwhAUODpyeW+aK6vx2AroUo2bGBZ/ZjcsJFfMYEMsm47LdQSq7T7peI2Ex+4/9oIAJGfhidbXA9UYPNhxigFTg83CETNYfYVkoambj3vv4MZNtE/wrIfTguBNqkQk9ebLPTmY2U4UCzbYqPKO5vjaZXeVksobDAJzhVjoU7p9TdFmNMyLyCQJryBSOcm0hFk/pcwcV15KZ/+IIqeQGPkTbiY1haWSnuQYBeyW5uSPHGtYw28cQS/v3rToNAUGVBSQ6zpBt4CHvaOfEJhuDJYZCcxvPeOStdCzaoSQn9nDe8wDc1MXrJ0+9N9TAKcS6u8ANLCLY4UfHLGf884/LFIn4OLOlRcNl7FS1IJgu1/vLm4INkgHt5ISp2vC3MFJHz1zJnopnKS1AgJtCmhJRZDaW6wis8CJ0KAJW0Yy0+kWI3lJ9N8yqJht68FMNVgkgaAGi5LuKmkZWm+ztKvf9gT8hJrXZkM/QdHI6wy9BqVeWa7g7ZM1YLbUv37YSnLmGsCrl/UVi/tG+fZbzY4bGye0zH08VQpGmyd/v++fS9EtasmbkQEIYnmLZLxO+tNHp3myIGwYBZVXjlWvrCiQcsP/Fu9l0HWmLBu3gvuJ4phtJsXXllJdM8iZIQR8Z6zEMs+cqVL7+TYhxDd0c0l4sbyIEw6N+V0v3ZbUlidyekdcz/aIomGdZtmdI+1QUrrHw7eDXT+G3zbTZMXxpEgJc4zY5bH5az8eHzwoo8QUleUKpVRrsErGmSF6GPJ2OltKYL6/C4zx4rHdcfsrQTcWBmrBWMMiFiU4NGtpYeACqYafRyu8j8x7ltp3nxVbsPO0MSoaR8tv61/q+YCqHX3h4vy4HzjCYEl+4ZDtj2+mawuj4J0rBpcDw+spzuCQ2khFbks09lPGxK8HYJl0Y/lNLUxGLZ+2h6+EFSaD22bYzF7dk/EhCWh6u/v1HUVKC/r/Wl6JHtd1V68J9zdOTgbvJuQug4r4vUV3JJolQQ5tecHKqcNoYjOIs6BZTlfB+yHGfGdxTKsGxbU/4taKuH8Qpd/M7fIG5zebrpiDHV97T4jiUNt7K64/u1e/+erXV34aOjfddcKNO76EzIf1pfD+KivBsRlzlsjj17aDPq/lnKHQCLsD+3TK021HNzhZyuwpLRKS3KE0XH/0TqUOr3VqLMcsSZM6349QJDznPG+sUqeS6wwMWp28TAoDKdmjzW6f+2au71HsOzLIeWencRa5JapKkVTYpvwMIC8u2L+/hYGJmk0588rq6Nnqe041NMzU6lj1K5KmSj0ZRiVpzu2FSTl4PBYHAuhe5dtwnRQwvvNqIELVxKMFWedxxB7UO4zpYRe2x0zH4X6pI2m4g6YdCs08vR9B7omy/goQUYbUZA+wJamq7/c0FhkNm74Mp05NSCK1Dcy1+9qp82p8XVkUB4+SsVRJ/Tqtn8v2esmemr7zjCfjLicMb05JqNoL6zzz0KaYkXeStBrF9+T7EbZTo2Fa/wS5NhJvRoZc8QUfS46HX8HIZ8A6LK8zKtROnakAnEEFoonVlvYR71xYuBAXbjtxfu/bteN8WkArB3//qp+3btpi2SIMyK6rX03iCLnzOd2OrPnD6xqgVT35e6NUMpN7EJSz0DRRzyze1J+Dx3cfx0M577W84qifD51mZG8VNbBf+5PxmGGrGOmkO+Q41YnCkx51D+X3CXsNAjaz/XfcPJUXJ00vaQyfYDtmFq4kU1ZHdnep48T4IskzPsYT9or3rd/ubiYLqeBqjnGbuNWb9ZdPDxkeBmJwYTjsTU+VugQmtz5+C3QBX0piVh3d7BK+Hk4mO3q8qJVQXeIqs4hKuRvBfIwwUyKg9W1x8dv+EwESuk2Bgs1+Zc3wzx4eGasynWs3V360wH3fKXZFTckeHZdgtzTqcQPC2hCHhSXyFMyljvrneLE+c+b/YQ0XcDBam1oAPzvKmmcgER6AqnyC32Ic4HMP4FQN2rh4Y2ntrawByV+9oq/Z8hdwQEPYRYiELBCnuGGXDQbl3ZLuUo0vfKU/AuMwYfNXmNM2vkn/GRrpc5WDP+MEL80tbJDZfDNBRfpfcvVpf75u0LrkIIjnU4adaolZWzB2yjIVwNrF7zF//n4N5xHeaGc7Vh1EYRdc0h2l23qFvLBNQ5kHbmX8Yta2Vj4DU6eBN3XyJBvJf9iL4x+hw1hx/7Ej5U8EZr/Qhgoni5r9PxBfU3fdvXICGW9DzST7GV141bvyMDXblFG5PizNjJUVAWNSxIAStz6+eDAbkYeAKTj6DIR6ysFvZAloBLCgSdMFd3ol/WXDQh3BbBtLqO9hp08BfumZjLpTJGRAIHzDizXZfhbgqejNSS27BIXQLV0muwzgXGqYt9McSvtLWo1Fos3k6Nu2qGyFftqQyDz0/bmgvtZyiFce/SLYnjt2Q9BnlmUVBWOtbDPvUgOSizvJDhdiSkbLLP96MJ7dKO3eUK2nZnpb4s4b2XGF4T6gC4qo9TDv9z2SY4Rffb/RjPs76P0YiWADpPB/nQjC2tDRlxt4sdNCIjmMsLgU+cr8cpyaMSYI9maP4HHww2jTPkGKvF6H6+DFAF+jAZKT9oi23gpZ2zavE0xXPkF7a2FTNJ3bwxvsJV+o0fXZAkmouYq6B2+6ccHhnUIeL10QtZaPoZPJB7/Xry/2Nv+JJFmQ/p2NSiO5bYGA8ej1vh5QlWhaX3JMs5gMBnyyIfXIMf4im0WEUnCPAJzq9q04Tmxzy7nGKKEf31kAp6IFk95aj0AogL7iljLVJlOXNvV7BwZn4dKfuZweSEZBqy+Mvual0TVDHiwHuIuXbvaw+OkU7aeAfck0Hc6H0jgt9g6Rxb6dAuaiKEN1cUYtD88y0b9Arq1q6ML9B20/FunTnZNF+IHgsg641FfllDFpQ+dqrIPKQ8IkLx/2ppx0ivQSrehNaf5dwtBjnPHroRGzG/RWOdiW0COPzepxIqcsWjhfmBXSUD7YCvPm/qTGcSnhcriFKew6a5s0AgK03I1gEifX6y90cJBY9REbQ7yW/XB+zAXN1XZQVEs7r+0ajtx8KvVBKJksKj5YFGdhEennMbwgCJJIMdt/pJD6FIcNVegt2LiQS70DAJeiNNG86dQVNYNZmYEfo8oa002xKLh1+rHlBX40iY8Wlv7FqswQFktpyLn5oSdo1jBRz8V3aRIOmhSnrs2wxGwGBEVEXvRm8RZVvSQ0xlKMVWs9Y7nnmJ9jEVuDL08D2ES3plzvCNP3FpKQeSknFeVBXv5T1Yk0/X5vdj1J1LYa6Ffxxrv90ObLHARkCI+tz6+0i5cZTinvgIYLMVnV/OL+m4RCsTy/+9VQPsYv6X2qSSlVdQ3KM1SOntMNUBpb4C0MsDh10xHQ0cbJK0gsR6X93ru63BDYbRZmPISt1casVwVVE7+u3l55XJGJ0Ev6S+2zpNqOAH66RuzpVskXE6X8x6wHOfp5PAI/7YG3Zozh1U27IXGEEKIm13Rt/nTE3pKWA7i1NFdVQKQ0CNdqEsBkjiuM41dd5rIbR4DMnoDva07v1esxYBGU4JWJUJQyejYbI9p7pqjrpHZUNlz2exX1lTAks+WxY6CExoPlSlNNv6AIsE0VdPmHOj4m0a8bigDelTpIL1WoePLhblmhRlkPDKiZvkzz6eG8vLeJjCGJL1+VFa4QREBVyuhcpZm1ygJm9kuQ+8v4yEMw0VO+TKee6sMFRVc/kS4IirJupnw48LoR2aRk+GuDBZ25xnKFxdSYqZqvWlEcemsbzl7wvQg5z2xKxEUsquyGziyzd/X+XFl/ct9KRLzyyb6ComIL8Wam9x6LPNZXvhO0QQZmQ8T2MFjmRJ42WyRzfyLGkJKft94uO0Yy6Fflo3AoIEon3XBygpi3Je932ToU5EKoikvqkeLFACpsBN5dseemiMdHxOJKrVJDdTS0qCcTzPCyz506oyENFdelskwdghmUnWyXK2WeJX2CBXudNUBON/i8kMdtJm52REvmGqVmxe5aricuTCGLbgZtYvigT++E7xltEh/ZgUoMP+d8vaPU/HdhZaUjsgQ8OoqZeezvNR2JFm2on+IliVyYQ/58LmZ2stgKoBbs4SllwiTpNRw7ecL2WR8bbg05aTN00C8aGWtReWSsYsirJ0K0I97flI2gJRRN717wESryWahXUAFZAdyD08j9SIZQm+wq5GkoUkK5cQ3wk1x01x4fKLPgPIj6D6lZiylqvWGtl6KxCfoSQXlNZIHeDsrIRqhINxdrCinM0iMMkveNxhqrEzhnBn8F6nXVY5zUDLzOXpp338I2HycFa2pueObEof3HQgFEMnHS3/CDKwJAyYl3HyA4X5vXUE8MMa79gYELseTf0IEUJRsfSa873vl6n29lFq+GCqF1I+mB5PSyLFvgHv6hG5Hd14PAHTKhY+xzCgOwwRZxygPwNET0UiO9ynH0p3j7GAFEs+VSjl4ArhHJbySohRLfm6B7FxxYJLJxJlQr5UdD+5Vs0nM6CehSZZNYw4FzcpYoL6nS+wGGSNKLVLXgbgvzAbT4B1J4GMS16IKMlo5S/dzM/NM4NI+a1Fuk4qwaewoHqGp78vgp+SkuhLyAVhI2Or50Id4LlHwRon9o7JT3D2pibchFvFi2VTEx6cLX/qorW2YGSSmnu9+M8teW9DIRH1TfabuDIuLk16NFz3kNr5QLPGAd0JzN2IYFA140yqfi9LfBcZI3aUK/Gt2bfMMk8eqttN8c92OmUYKUaHbB9C9cpEwaOYs49MztuGtI0VMqDDHN8HiRP55BpRIJtIWbSyi0/LOC94XhzqGVyuzaVaBfg0f++sV8wy7ytxlQYA9w1ejE0XaCkpM9zbOrymf4OrEaIyQX84Z9e6wQ1czIvOihnSaq/fcFdkxJcMzE2kWcARwWT1U80dW6B+v6HdclWMyMWLYr49iKWrhm7o1yumJKxVGiv1Rx3Tw61jrh+vuNjikpFRxa0F9G7ZWs57nuhaIeT8ZRjYzuyq4WZBEXs4CyfvmZxGcS4/G2aWon2O/UkjqrfdbBUF0yavSPdNJacaaZxFQNejGDPK7SCF82XxiahbNpwFs/t07gbCJkDUvvKjqaYv1SNJBa21RKsOuGJNKO/F6HTjc1Q5t8lqLL4e83gWTT4aubYGtE+D4e9zdPPo2R3dvG7bDrCQosp62YhTaV3B/kEQGqtzvu59fbgA6lFyGe7urhYr3TWCBFYBmrEpB78fWnXUEd1z0LSzMcWL6vuh4CJYR0tg1jX4H0wkw9mkbM07MXopLJ2Rt7/aL3Hl3MjO8h/1lqNlK74QTbgkurmgd23XflEcMhjO52Y/Wsz+CqwkBCDN8SUcd0hvJ6srikURdDKw75ZZMyms8NdzvzfsXreeCzpVaPKbkgWo0BlD+qWqaXziVa7YTSezNkCD1UBphMwE3IFwG3+Oja0AILbwR+VMjirrIkRPt+DMtp+OKLpkiE15AVv3jn19brZGZkhhAsuT2sTiWSjLvxJkMICAGdQY6CcJ1bmQsycrXCCxoxrME8B5k7aYQkl31h4kmnvmUA1Uo5bGEJkzebQNuMeVIRwKr7shM3Y3iowzuO8Jm833ALhjeDbR9i+ajGdiv5nuQcBDW0PZ0CB/GHvnmE702e3iEmWKin/StmkbfvsVh9mXnjLzZCRfht3g5Fu6OpDSsq1DSVUie4hNThGTSTWkOhTKbARv54Bxp1m/BqW0CfvfUJMQYci+HzQBrAw7lHJI8klNzq1wbwtxf0zzTFIpYQcsU3ddDWDMuciKmN+BHJ47B6FkgX4uR5QSWzLqgN2wQK1aLp2hgMJGqMII4rLK56VcDk89QQhw6cy8PCM19olNpuDwdrQFvP+77wiyyKx8Z4MVJNxV5vJWOwvF+aDouZMW5HNno5d960qcPPO89qYm6Zh6UO7MyFx272aWYtu/0+UZ6eThOP3s/uMGRarrYNGVN2bkl0VbM7ZArP2AnCQLuPoIbkry4nTS/RsIdFmPg98zeYI4R0RY41FQsBym1OXnJcHtmKPjfEXuujVQGfCPrCZsaT+vFbMFWIvUy7OxquIvdi2DVp3+q3E3NGG06d/cz77wgHGWrfcy5LJIzCMZHkk6m2QnZCXYVXwMsVhJI9nJcgG/CrU5lgDb/DlVEsXG06BHIuqVfnTyLdAQZYmJlEEk43pdgF69V12XC+sB9W5Tfm3jPwiHn/VmGszkYx+Er49CLbyk3hDBSKuzDj+nzCo77ZO40EIP4ZROdSwWlf5S8wfYcAzjNdj/aZ8uknw3tur126RfCzMA+cUo5mPaZL9cVp33X0mRTUIS2vgtwDRgsSSX5xcJUWR8gZbdeqyqQEEAeDu3+BMlrgYP2SH/le2u1yfVFn5JX9VQ04X9mmABR/KOd3rAYqR+OQwLWao9MXVS1y+0OKo0FlXuirKuPaY1BQbY3Vo05Gf/+N+u4rDcFBQqiCrYhgRAEjvVW9eNCaOsukcJWEaDuo/pWCYGJLadm4ssTCPvVVEJNBfVXAcTIxH4EFtWFMJUy5of50QNXNZBl+oRuFIkdbt04DeU6j2A3vzzP+IkMahLD6zBVJv+xRBIc5fODvnJMmJRMI8kcyMFqxpeWZAHxC68tGFNyl6yyGN95SwNYXwDSIQCPlL9bzjZaWNWvs5puiP2lbEBlDw5vCHtVmb/sD8QBgOhRassChwM5o5g4lhlD4u86wmdmVmhmEXnCyLeQJ0rRtqYIWRhg72ieDnqmPvOkDTWtKR38TeJwrK/7IRYfbNspygrU6yV9YtJyw3I3uEkDgbPrpcNUpISYvzv3beFg3ZN+swedqf3IVKkcdiAezu/KpHGHPyvX9oT6qzTS342/DenW9ctM197UfFl4rk21KxSma1KnLIWlGGasMF4+G3dxTnqBscul4CqNda6Qy8ita7HCzKlYa86yljm+HQA2B5ArJoZy4LNxeT9izFuQhEoEhUTNJQj2pCc/O44h8GpQX6XgpaAvAQJLVNq0yXGFbzb3O54XQ6sm557+lT3A+VWPyCJn1MLbsssHIdFhJcMtBFQYi0bS+exQ4Rq74xNE2CIRSzi3nj5TNy2AoO0gdyBC0/2iH67UB581jmM92OHqgD4EzAzyxDauPnlIdZu0nWwB4dtxWN+meq/faIuQpK2hoRP/ULwIJ9r3xyxtXxfFwJ3YquXldSEnxoPiYD85u0OAHvKOG6+3eBraUiOgvdfp1EjiroeSLLFutuPPV9XqhAReYPaRy87OAkV5tzSqvyfufCvOMTtkpxApWsJ9n+cNM2uBWu4lj1oDjGasCfCt6cfgCzh6UbZanbL/qCgf/iHjKYaavIiRLJrU2BuzdsP97XHkXLYbbfsHVTlXSohKOXOJ+3LiR6ix9UFLo9qieejYk+P4e5wC64jGQLSxJzYt3cErx1Rtc2+xlJaEBynLN4hLl/qOrgBM7a+yswC0Mh2OieA4SR6MfM9WK/FOWbVyoUBIUAKOhhIZp2LOgukk0/DInn7sF7dRP6Nw77MaAcYg6k0gdjQN9/1wtGVSBm+6LwkI+xfcK9l+JiWepXul+/EEdV7XXp/9lUsW4RQmIkda9H38FJj3EYJTrG4hEU9YWtNd2lKI1683cXFVzSMkh+2nuu9K0JUBoAnrYkKVZpAKF9G7y5n/KMZrP2xPuUFSOaruqriffSEX9Euj/k5dgewEyQCFTif83LhkIjt5qJ1LyI4ynIznWl1SoAdecEp+I5WmKBB2fr5yw33NX94q6HIP0jW3Np2E0r1f7fUjqdxV+iCRULU+yAwPXFvTL7HqfFLj+wCfIbOg+nsW03rGTf1haLvAZA/nC52pSDnC4f0qOiA6WtK20BldZUaA6GO3m5ZOCGyemGK4a12hM3BXnbladA/yTRV+pH7IiT/9WOijGGNXzV+K4wmdmRjU3It+QwUCRat2mGkEHhOcQY06pWeQqBGjHkWcceX8/drkk+tYysHMXVk8hLhLGjUVgivK1Ra4K+RtUcZO5fkVkWQ4W8fyo2tafhGEDSsflUH7yj8wsATBE9YpskR+r7Ac8xqdxtEAfRioGXSprjbLI2DAZZz9HAYR7rUHzvh/UPpFvrLbd/hFf7sF3RimWNpiGsQRZ11RqfZkck9IJu/FPU2DYr/HWUdskJHuLufXCvDbKn0F9sM31Hn3zIuAMTUc+tQsO9ll6jnNnW9Ulo7d32jEQMqJIrWQL5+Se0a8lKRp+XhYp4IfyUaTRC58vFEjKupeFEpU4EOp1AjeALc7vZV0ovza8QSl3ru6xFpY0/ckElMOChkhLWSDHLCKaFK/qC/SIfT50GJZnkCr5SgXZRddXq8Gc6XNjIzSdCF+9YlUFKMiri/sn1Gp/dEMhARah97GidLqitLNBlF+H8XoQmdrM3GXBSCN6izNn2ON0OzpCxOuM917OZCw2ZC0DSvNuTOFCGGYf1TYgUbgK2KKc4zm/25dz3GhVpFqs6x4yhZBbiy/6FD1vXW/aIcDiSUoIhwrUtxuGGZijb47Jz8JfUTblzx4eNPbXeYpygkQo1xXonjeouTuJvAH/zH+FK50zOLAtbN9AO6xjfX09CsjKitMVlHWmmQybLoBHBPkC5IbAZxvs3cH1VAcy2X90WL6y/0SXNsGeLBdr1OWVuYg+/wUNiR7QnP2ec7jNrZZOosT6Olwn02Dh6zSwKoDnMFLfk7lBO0p9mWjex7gEFXNfxFO19qmaoISUZEgdTuy7sHgrD/36o3XeFdzLFoFnOJa4yaENBXdTSmVZacz+5IGdVkEgjQt/TxuhNGHGtQuzNDfM4iNZ28Ly9S9WkUGMNAfDRLr4ipZkJxUA6HnlOi4Yb04/Ze8rB+HEXpDGC5Jpr4fN62LQh8o6kxknE1P5/rNmz43jehFlRUvCyNi3Y5St7lC7a2ogCt3Za6M7AshQdbVV2+R2DuuiLEJz0MLhnn/1/F2Z2U3h560PrnhR0Gc/5GW5DwO/DGrR/4PvL046BKjUp1lfrtKfE4osRTS9/oB0GrNW3cYgvhU8ld61sHhKOf4P94t4n7h9zdRXDaFv4ORPHokkY+NA9QA49RmsGMfJLu1/RXuluq0J4fsUUBoa9dL9T0yDJXvGtuoln8aYrNzoapa7E8cR73/wX6KwBPpwCUUlxsBtOj0rnca7zu5FqJC5W0U8Yt529SAI0S6nmWnS8zguQLRzf/gRLaqSQ6E9T6Q84u1cs56dzBMv2eBG+zAKw2V0x1NJX1gC8M2MYZpScdXEKPG1442UFWTEUlkM9OjbR4FurtJNV4IqEu1htlgltESO0SeZMHZ1JM7bNtYegevwPSCmW+S8uEGj7FTSSV0HbDg1rOnt4Ws8DxqN2T/HOXNd5NGboZ8VTSD6g6rLWcoWOwsyeG08GPG6KHPiLRunEdTPNmY74ObRGT1VCHP7nmBYmjnH+kqK6rDyrEoNjdqc8uG8yZrHWBXU9weqD5rpQ6S/annq7P/GiYepA2ZDdJA/GbdxpHYatPgkXt5sop564gVHZamW6cq/cdADaLCXWt1WgK7y11WaQR90YOen8BECQ56pmJbLvzzfWBhUUJP+dAEEK4o4wZv2+IBAFEdNkNF3mKntsLE5PDLA/IEiV0rziyORzLJsoxRMCQV/HlpCkXsaizcHT/vxU9iadf2hOkKehGum3973fFs7uRlqxz/oDerFL0617PqG+VYIxjeRb2IRLZJGH8vp8ITzF7U7HUg8Crs3WpVY5r8wxn8tzGvUUwY5csVu15Vmm1xcs0UL/lUCkrOXdLtlaa4pHLeQgpd/vu1ZzjMOcgzfQaIwiZK+fMZjRLAHUf83TSCOkovb3xPkD0jElmb4TBqFrwn8G4KWr+RM58qhCnlVimQ390m8YLz+fNHbBRDs7GJgHSK+v5Z9cwZq4glnR2eTjnqTy8Wo7BEg24CL/RT1AKzOIE7muo8oegzn8R6qab08LzTcbb0ippsScfjQoJhsr4jKG2pMVczpCYqptZcGD5rxTHFbL3+NDnEUptRMyARhF2FMiM7pgaB/IpAna1AHa5EPt7oBdzMGg7kOdSOpxrPXbdP3l/+QCfCLMpCsxFd3VAxA/IPVvK8JaenCYCadhyZ6rJeGxTUh11+OOAjrXIJxb/EbIy8rv6h7hywPp9ZhPCcgt9BN808JhGIaKwtL85jO5nipQyAF690xJ9A2DMuCx55TSG88fN6rqBMYDI+I+DtFmoAqJB27B/xxN9xMLnQwLcLCHOx4GIFCq3/6i7gwJePjoG/HKNb0XjhuEQmYFzTgtt/uIo1bBX4C+y1jrb+R0mRj+RyaDkRus8W4WW73qbcjpjIh2tGUY6KJyhEaKiK+LHG5euQeYZO4zXoKbZOWiJTvJNNVrWugpXkIIIE4zK/g4JKATQjtaC1qbJ6khaJHxOTS2goU5zGyjmaPKvVPrBh27E7E2iZ/6omwpBARV/9EKeU1m4Msz8Q7y3MzEF0C8VIIqAxB+Fk8qG970lhV/ZIX6CsxiHqybemqil3Qv/cWKm96fPoMJWSA1dcF03dSwSyNMdvKKBCYVYLuqr2pISKPaNRJJw2R43RNE6avh/TNA1tGJ/ilW/e4LbOvIh7cS2OsbjyXcD6WS0DYaDa+og0lSxehZQiDSt2fVdtF+DO7/cEUAM3uju47Fl17rUPkRPaheA+6/jpSYK5Nh6rSwO8Pbi1y4/L0L5SStva0NcscpH0pw/3Y9+Eqw1SDVvRn2r2d8vRC6YhQywdhKWraKGBMILqjiU2l5d3jb1tnQIwi95QiTJW7MAjJD4Plr9FGRGlM4NQyAiG8wSAKUbRCpmxE+zk9YhXjiC/Rbt983pV0VzovJW+90dH65IOb2VS+Wk+MpsRgZ86uEuxeGPyB++07HlAwqFjq0sm5Lvom/rcHSaLduJrDdabujYJRWbbY2QZptvGwTHAiaqsAafE9NQa2oq6hV8+E2YRbdEcrirxyx9JVWpti7CsFfA/egMevH0MR40/X1jQzMYbw6mr01MI833RiE3EuU79cpspC8tuN6QxFB7ExHF8yrFQ4vRniEkTgKc8kT2tC2HgNJJ+l/FwYXky6qbHj1cMtBGVOw3SFMHn5l5odYVrLqhL6R4DujKq/CEsEj742QjUogvrSb9DOh1Mm5Z7n6MI+YHii3bWp2abi25FJIiX3GM/137MQVr4wwQ5IQETnYx0CoXX1nLeqLjQ2VlOulhy58iVxN5d0Q2TEV6MPr+wA6lluGEC5890db42elDUvTbbMcjHGrT7WA4eEhNLqVT35NhLruSPkwg1UCAUz94Dj23i6dqS1MPh40Oyi0W+wfoWYXIw+siweU3qKdQM/IWLUwDjgMQuiK+CTyRgR/Cg+XmfazCLiF1JChK7C2x+ROCl4t2WjYngGRxBWRQqqrNqx1EesLx8Z8GOimBJK3Ip3O0TWp1z6fhibUBvCtBpCBH7Wz0MrsYEtW/6gd/rLbB2IcMxOrxgW5u+/ZBOjd+9Zg9SRf7ln5tqXgM7wZE2rj4u7BOezWvuyca2TpJkQOR8U/bR+LRjmN6RAS7MCfYSPtJWSbZYnQL8vGmJb39SyiYiER2Via1nlShjJEe3JgCwTOTiIQJ5h+NQeEs7qWkpIDJiQHb7VwcR7T1gLGhKAqUT5DPO5zvGPny/DOh+Lo+Xhxf5wTkF5p5yY0vM1gw2UZQ2nhCedQ+PBxACaAeuBYTyBs9aNWvYATPBLUtXJ3H/+rMIUQ3Xz5MJKdV6OhLEEK73rb9hfjPlA0gKO4j120U6VHh4AJvL3WqjaY/KCbwpCzUCADZmnJdpD4p4U5ry6/YuhcWXcVV4dFm5J8qADBWw9jPITjUtkf0lhIJkzhXLTcXQBZaaunvCCxyWh6ifYzNTTCGJcUD6DyfGam2zj4qdBy7DwBaL2S2IxicF7F2ubPDvx0+DEQVydAIF4Utn+/niyxDQpGlaaG5eRQcfYEHaZeHBOfZ8x6KnSsZnB8YZbLVBcEF3Mv/87cj4r/BYDYAaUWrrm/rWPImSVpvPlB3xQvVG305B+bCj4kIW4ZWzFnX7/nApDibPZxncAV04laDsD872g54z55DZylkUKHXF7Y5iFwsc0HDovYpJ1P+XIAb4pKZnw/e2BrTZn6jCeAAvAt6Z8EdXqS/KoRwK37xhZL7w17n2PYpqnoCtRAvnU/CocUq+el+PFEwM2GkhLBAJXvVbqxBMfPWlA8XMNY1+dfsV9Uy0C+WgSzcXw/ylN23DlELK9DPZ1nzFCvyDWygh1ABv0LXhuVuDEraYOrX0J/NpbYoxjl/mfncXN1DorfumMjOo/dWEk/OvdZ8w/66CtISpGM2htGRpT929qEz+kRM+2XpAqcSS9GOrLWVVUVIm3Ez/yIqAWm019Td/ytbE6eeYJaY+mJpelcp0h+4Y1hmcF9J6cZQEJi7foY8n1psVTCzE0QYMX+ScYxKxb/bU9eproUaSNTxHeNhomtba4y/CfLAZYXndn5ndeIjFIsRWRpwX3HwrIsKxRgd52tRs/iun5uy44w8u2wZgayiPbOTWGXUn/BDqak5EZebXbdQHyE0yEhUO5HcDnE6xlAuZFDSKLDTTZz9bWcfe1wy8KhSOwh15cBRibt+faUQgl7/5na6Nl5d1o7iUWTjOhjQa4z2Pha1PNGSn0hZFeICMKGtHJ6EGQbB+HF6+M2e8YSQjJ2cnG2SVpdzXlnkzxYqwXv0s0WM8nggSh7Viq5joXNiF3RJ0A9637p1HFJd2I7GrQ4ZTOWRi8jcZaL/25Pox9feMT7VDPV6TT++0Ri3a1aLS8IABZh2dWfxnBmXDWPdvrxmBiF3eePVqd2ZM5bI9YAN23/3qVLElDeD61xvgRdjkXkl2tqif3zsX1gGp9mzEm6suh1kWL75XC2kXlrCreiNi2pfI+iWVFJDXPd3MBNp7VSAZRp1jpt3ug1pQEM470lZXwotpDljklvGxuNeKwTuKNJw0EK74nc0d851QXL9P4pxZdM7pkmbA7IU2S2Xa/AJRP2VOz3Kyp9oW6FgoQi4noNkoHeNnprbQod8n+dQSSbMzNRZIuL/riHaxoOHkaGYwROCZwqcbK1tUnU2Qt1J+3UTvklj6wOD/d8lrZG7ucjZiCyHxK5XVtzq9lDJ4N1FvARCTUfnLeOLc5bmrtGvb8mmsr0lDDyR5607k41wzglZH1fExfmsXrEjiNLSzSKGb7FVusl07/BgeCclDsQkds2G654GVeUpX7UHaqQBEmJsIyvfxvz85+WyRaoYuQfSH9WpJLeUoXpUt7+Crnl1Jqz+eARyCmzL59OUUBwBuoQAl5VddIrfG6xvDA/RZBOV5AfwjOrJ2xRo4N42rCSFCcnOY7xfewl6tVLetiM2tGLqRLc9k/owyHriX1A9BnluzfDc5xdEUKyuwzWPG+tZGNDV0WLl1JyHPflzcBpj92G0AR0lGaMSZuKui5/LUMn69X9wPKc6FVkNEHEjHjQKPQjuFCokjN+N/6DlMscpE48IhHIa0Ghrc36GwGEiPRymXWKD/di92yfjZjDM3fdHBdwSxJRSBVKHSwh6Ey1/zWZRZ4kk+KMS8HuroIw1UPa+PDVpsSIKvmqZnZisbfHFWNW/dl9n5+wM4VIzhmrETz3k9WU3s+z84SHh2f7dGT/G5WvoisBYAgwm+pqFS0A8xyhy4PiKfgS+6TgnQD5hDEerpzgFSaMcw3yvDZ0+xfL0yznf0uY8N6APiqHdoJZOWqTPnTIbeBLc5dvFdh+mvD+sDtl8BAWzYR7QkSgnx30Ru7TH5a/g4byacurCNvG0lTgpkj9w42uqBp1zMsKr2riOCQwfCRKkuSX9CGADOYGqCHh1JUsk6RwvI9OvM9fCJoL7Sap8NUQ7mAvdB2ougA01NdqxVo8NeGta0R9C7QybiN4uAtDxw2zLTG9+0we68JkqZrj9tJilUV/f4wOLc83GfstXOVF2bAJ6zf56YworQQEDj6QnC+lqyMkGAr0QuAikm0jqS7fy9bYSBz5hekPILc94b8aUau3Kt69QI1kFEmcb19aFQA4bSegA9/hFi61RDIVQ7iOBqViYdGaK8d3zH5qWIjed0hR9e6o4zELdXWhOVOcPCmZIYYXvgUsAyGUoCszsCiTdwOaPEL2kRnYh0mNSZGb6/kr8XfbyUdbEZ7mDBYy0yTDxhkrpIoJmVutN6FHk/E4cTEolaGnv7x+QxQIKZus8IEygpdtBDxj+lC5M6HaJ313pLDYbjpCA+oYl11ISRJ/fB2oIdDBHFLefQmF1uHk7vtSmIyI7Q9HG0qxu8QRWecP8ipKR1o4bGrAhR2KcGEDE6k8r2F7N9lNUZCswXi/EXaOlPb9fdsaw1Sspku1xrmyADIImEs//XiPqI3Jl8BlrsHf1mAVCBmlqE7usMbDEpilt45ia5CXzVqlIZ95Fesu48LEATS3dyXVEjwQAqVbFBttbLfXvX4LhaGKv6P3XBsKWvqEFfq1rPYdohHtQH03ehlVMpZ/BRCBFV6dffGCrIa7OngRAbORd6wsIcR/gQSxhfrfHFmb9Ws3Pk/SikwIvAIYljNbXbvIpKTROSiPcmBDp4hxLkrjR+MfBFZLV5I4usLY6WYmjhT2kzW9XAxxLYCELLIf6lg6p/GFgpoRTm+yQ6PYtmKVvdTHyBxv28y3vTiy+reYBZqmC7x0TDasiMCcA+TxdKgDY4s61MpZyI1+RUzeMfx1qh9MBXg1tI/HSKpcUj7+qTrwp35J3ezefo6UZiEWMPBtx0/tJyaej7NUmUHVRBJfB1q0bsw4yHfui2ZOPNh/6R2/I0j09t9QGeRxpuJzB6DNbaPTOmER6WTXYEGXq7DhzkvCP247uSz6r7MfaasDs419fVF4RAt4XoxkFRmk3sjrhpNSeuDoG5RpjE4pI3rH/ESPaF6RIIJBiAbVU/ct/nKrDmBQPBYlNob0WmW07GhOvvz0m/BXTsPB8qA8Iesm6PsDuOLEEm5+jbniDFyXfndwIXHgWBB1GCyGV52MU+5iXguncQS8T+WyxaPDqCCXMjwPJxGObdF8mBkG2+SpqaBQkeN+1IL8Cbb72d3ySQUR/uO+N9v36KAiKVEPx8EERU0vfKi53JWN50+LSYqgHmF0UrnnHCNpcwfX8ezokGL4sK/rgFZlXnIqg6a8EJh7DfMOwMgTwRjjZ+TrXsj7SA6EaMRroFgxXRIOGDPYZgkadllrCosfuVZqNQwAY1cDJzuD4ocR7PgZYXbCA3g9Jd1PRx7PyRTNad56qFMVIv/9AYYd32opL/KQOuEa2LIoyMUHWsHVeJEgDnTAizkdfigKSmZVUDrztoGXA+B+9B+MYT2q5BETXJUKRLiEw3upTpXnlh7hkEk8/0D3rV1lUxxSlnDzLfFArxdnXRhBNu085RxiTwTISjItGPuj0MQknBfLTi9AeLTT9QUKRG7bxHm7P2Kei6fVAeNBP31q/OVsTuBJZfKaxLodsCxObxFdyJNLV2tAt+2SCAO5/VWcDOd7Or0wzbVGwbXJr73+/PYn3VfNQ4CSxdqgXNPWDqh9ZFVRQbSeb+bFmOpdkO7C70y6dTSHVuHlIY33/KV1QHDJ226atG4ltS4fk0ZNDrmPZ2Lps6qyMYO+Wkmsyw/ECuxfXcZ0zM7vmLjkk/LsX/XG0vaL3KZb2C51I5TVf8fBJmMxHHzKvaXDwSTGiya0f8ZZ3olqbqcd2cjXM0jicXlX0cJsaB81POyuItwEiYZwsHn4gymrnlD0mfAro2YoSC7KxDdL1DQVO+0a7fN1fLkv8ElaXx46Z8EGJ/W6akIr6uEuiFIQB9fHujgNzIzAgaDEYVITJJO5XQkyimdgaTBvra1hUbw4jb8imqVpd7G9dSoQVNPatqBlbm7NLsdI/einfpw6HdFlo9bpLb/wBxf2BGK/YWhn6LhzEvBuRuBZJTDv7HV9WfnA2SyT3HV/F6f+23aOYC8rxO7QQ1FI4/0m/OAHdCwYedzx6F6TIlSh668B+Id3ZxNP3V+Z82Tt/AHYSzDsxyYC8mxyk+Za4Q6u8y70AKpUm1NPP2WMeSHfqCc5mUcG67RR+sJWZg7P5iG4FPnFmWKv1nwwk+fM0IIA5p7xmHnj1zbj89sN0hc81tzI6enBjIyPd6P5GXzsmp9IRHKS506SAEK7IxfjQLxkNK1x+M8YAYLrD1qWXqo03kTvXgYllmtbguZX1FQGpXYjbZzgqSLxcXTKqQ/GhYqBJzZtvPaYGODBTozt0Rw6/vP+hTUJGOAYcEWWr5Mqy4792lLWmElkf2k2HiF5268DSkEL2oQl+VXl2NXgbfa8xxQoI7lpuNkURcA/pNz/go3LD+w41q4eQy20ecjCwekr0XfODump0XPUm2vvNfk4P/tAVA2PLhl21zoFOrSKjd6D1AiMtz/f41uWlBWCDDY4tDRMhyGsls4GW7P8b0/dGx6VTgC6oCCWxMyJyOgl5RPaFDE/EzGGGL9XUm5X9L3crn0DvEELm/Vx6HwlGWtnfZK7dA8/zJkr9b7PBgLeFlmXyfUBxZHF8kxgW5tcxvkEz0roS70jNLvk3QNCTUIwCHnqk5NRDEaewDCzjTR5lKzNzx1RHHJNiZZJ0lXrAsSM03iKPyYNdJfMwUAvRlKP49yIx7XS9cvseBWVvGNAc2I0PmR6Xc9KjqauqjgG/Q8i16OIPtQ2Ll3qDkunTNq2O65AEFG5qycHaB2/159N4n67iMEpyNowNdkq/ZlDxsX4dRKNvBUJaYqhID70qa2Rgq8+AzqTaJhuYrqrDDO1n/0rWggrBcFsYwo7ujJZblKGamFf+3B5MTAXNUOKn5PW91Gx56gtqTqz1dYMML1dFR/KZUZom7Wky7v9EfKnYbBseAvDuBFBFFCuXnhvWc/JS4ipUIe59Ls/kL+W5lteo1xt5bkJYfug17vGw6cqrOjTG4nQXZ+RbEDCMTf5JZ4DBcuVv+tGPyucc3B6R9NMF/lc4ubulrqcBPhRUjGBILbQ+4uBJ9eUHMAj2ijfMskRMLcV5FdgqIWhiEvxNVlZSRrzTzySfBUjZHCJQtbgDZ8nRWLwk6rQKWD5aSHuJh0vBgvlNTP+a4P7p59l0FYBPtoNpiFl/dOo05KHesQCueTxj7IB6io9sqTWxTu2PK2C3ACiXWNyxs52441hxg3eco87pSRV1NUvQeac35o3tgUpXtmtl2yHh3QO1mQ55wSqIri3PtVxJ57l0nOuyav/0ixzLEq3QlLZmLb8Y2JVlrdQMjhpcC1j0DS+VHrYIB4JgyXacVu9PCRoC5Y2+p8qfeJA3OFreaabxWxz5omyn/l55+ufQkO5e9iODCdLWl2crwLrUpaMCi8EUcVXGb3Z8oBCUdwuuohn1sivwQp1O+DaRFYXIbHQibdPfq4dU8WeiYJ4WKMlNEuQr/BRIGwOrAIM3Ppjmzvh27Lyx6xK14sUHgNy2ggNG57CBbXznFP/0NVrUQef5mMdso3AJ33SJxInqYebzcZ2pEVYHYczXE/+mcptBHb4ANtGohwQabL1xmFHav/wFH/al8TKjzGnYiFLEifJHL7OJD0x/rtzWuCrDToEWPBNtRKXFZqz/kBH6gsxzy/TUzP6R+C/A456FbGm8soK/uYyafgNmX0re6fgXeehUvtDCXdAUJElJt7AMv+VMdIrrOK7TAaHo6E8Khx1rq48yOqMqtC08so9cQh/AV760CiEtSm6PBL7JKCZBV4m7t8Gbbc4TQRawpuwTFyS/vt1JBnAQUBDPdEddlJlVAfbGy+OKkohOw9BB/JY9rDZQK1o/kpfl82umHijUnj0gVqhJCsrzUxYl+ygkRPDEPZqUIo/+AtsGplmBSxL8bUE1iBc8lCtShF2iqMC1DdHIH1DcucbSNtxOF9LY4IMng4T9eTYzDr+gnOPVxWBYMambJUexTzxyvFOneFg3r4FBEHqG3QZRgnKISYUQKv9B23A8vhFRe8uNZpBtiMtXqOQlVEbO/HzkRbqVaGj4s2XRVlhO+ewkvEaTp4pNLXG1OVF6ncxf3Fq94KmGuG29LLsFI1fuX35J0TsRNGo+TCioyTrXLVEjPztNVQL1/q5tGSrMPhfJEaQxHcrnqhVVqN1gfF+JK9Pgcud/lGa+Ig7eKQpJuUN+PYhBYQ/b6ahi4nLNe5+d8rQlfK/gl3OQ3WDGWuUMOt1YlBKoX+99JWlZr6tTAVgDF0NSHs5fqbU0euO7cXKnvVB3taBFHP6/KKZCBfGqzNo6DgZgiAELh1EYOni64dmOWUuwAQCKu+L8tnTFLlL6uKkaNtO8YGlOBVU9mQFYx4aGPgGEI/HTycxYXBClfKbmSErtcsuhalOh73FnzRz/thPjvRJcRwPtZmCHs1nYjivLMWWGprl4fRUOlrCDiwNU+9TZuaVsuCxj/4DzKfcla139igH7Z+0uskWkEq/c0mrsRLlVpl8ln0G77hwK9rLKc+RLeI6KLKy3Um5C6Of3qiKNoY/7ad3EFvdP4VICsuTMTii/bee9efmKAiym0A+l3hS7SofuEJ46In7BEO+Kf597wnd6s5mL1d5zNRBdOEmfNKyPdUuCW3u/SfFQes7nYlfV/B1DOE9p/pmgK+bx+eZdZUMu44uBGlaPvej5wxU9aumiyt/uCCZ4PyO0OYfFAMMqTaYcI8GxYeHO/3tDJsJisLleLpS/gvPLbEksIm3R4OCJ21S4P//uyzQ4EJZyYmWZjtknKJbz0vFEi0zDWnZHl4kvpMSPlVI8cEAG5r0JoNN59joEsMhUcPZ1YtIDYX9cnR711x6SQEnBGgTz6d3b1iebIdotlgqE03w87xlD0+qEykcVizaOB3Z+ocaMGWybZTIdpR4niV9mDm65EzKK8VQq59iMlABk54A7zAlMdkYNmaRuWJN+bLJ7RqEZf8vrpM0+3cwD0NctuwJJA13JIJVFlPStNIXzAW4pp1OnTx3rMZQfF+o4p92WDkF2tx1MUdC14Er9l1RlYsEYnOubj2IotL4tkgKwnE219ZsjXb8PJFkzakaWhRBJAkgbR6myiYFsJgC/lellsN9g1ML0j4HX4rwIzHbq20FDkBdfqN9SUnIbJf0QQr+QxHx4f0kRekXaqKZYUXYMbRKa6OObLPOaKGft7xFAgT2pHuSw7kdfloER91zsJPWQJbkAzyDFkkgUg80kW7n7n+WBN3CMXA3lU6QR23Ipx/98577h2OGkpcp5YiTX/TikBkcza+iwBGNBi/j+GwW8tGbKxpiSNEQqUDdqfscbVMQ+OSYGoeQKSLwREfUGDjR/emc+ZAJsy3sraTZkpHFZAI69dwO1dvsOw/Q+O/2lgghmEsk6NKzmfI+OYuOG2UoagP9Le/y9UABk4VHk54+6fW891qe1yVDT2KUc5hNeePBaQwVb5BQYPt/+2xEpqsHC4GY37hXyRSGvfwYa7DGUDbMKd8vud28h67mpOl7fe4uFRe/HOKf3TFs+9RX+QpL0+C2b4R/8VfkUQOABt4tcaDV34nU/UFXBUDvPYMYe0F24AZPIWphY9bLwt+tWvmuWwhvAgPN1rxvo3hpXvQNSPsVKgFUKENrmSCjWPYCUoQfJFpepI6oqpsVwJt6IlBFGO4soABNOS2KtnF9P7E9sSLK1WWOdGvYNhxKO5/D5ACMSM3oLy6XvjzPe57hP26DKKsIbhLZqcz8tJOcm1zlVKV87cVqDh5iOgGkNIKp7JU8eBp4VRPvv6peu3DR+ROhro3GOnpo6Cdltkq395hUi+pDXzwcONA2YjC4BKvX3JGZi77wJboSzwwPelRCe5297Gau3hHdjkNfDMaoCdfo4BX1IthlFNEHUm2nTsuiPe/rOux7FSlxIwT09NqnvyBmWQYcleqlPEreuoCZRFvXL07v84AxlxNdJM/atDmCjpmzumIoYOf4uVqV/8ZnSwV78WW0S0R7AwI0EDq4B6IaI6AUBwPrNLY0eeSw24zQ6qVAgBGW5aK79Mg+Skj4XxdPl8axMl4x6nwmnAfEBIju1ssp4yr/gdi9kl+ScGW3r5NVqJ1fXRkW9O0A6JBottvWGypQioSH2C46bepNpt5dXRK28XY0hseEnW9fDBaUMHziavWy8Q7jttulrsjOd5WunqGz20rPiwX/3fdKuQgv0g4CDqGBMamo9htCyKqN0qTOxWP5MmZG0lur+eIMwtcrfYqJujT19J3dps8mrCySt1MRdmlNIykG8cIMszw/nMlRV1DmpxNn2zf3gflXm1sXSH00EqrICj29dnyNSbIteQOqjPLqBf2QDDVVCAgcCz7vER9m5X4XkTIeB4ppqaFa2UHE05QSkAhs7FkyPf40UFGlKG8GnrdKq0ZLUk9m5jleTBwhdDsYP8HCDKRE6LS48qLHD4pvSl3XFvmH8KBEmyeyNwwJzAJQd8MqhmKsdandB6Ec1bHOw8agmVGP/vvY2C60X8AnR2r2HhdkUbclW9+ozjmxmipA1AJIZnqxg4aa1Le0RHfU2vkpf68y/rFMYgCXue7eNqxoS0NkOw9a9/WcDFJOh0Grb8zYjPgaSDENIFMCM0H5OlIqq2r2FKGkaQSMzVm87r9L7fysa4xxVMD0h7CIExLBVbCe1/r/WavK3yPhHVe3XBjyVTDOqI4/90N/Cm5KnqxFrVYOHbwMIXa3GwNwVME+38OpXvNwD6l+jN8BDCRDEjGDFC+WObTdm+5/tfm0QeEfVUYFtA7gTobiCnl8rywroMyBHNClofz+W7OhssrGuos+fRhh8kBA+Ni0fYdhKK+qCZaY0LUDpn17UUKCX6dOZccCYzSsD2iSQP74pFnhlkOzACsapdT20zbjF6ZqLgELUPT8IglaX38zP6zfdyBF+NjNf247XNtmIz4QCO5iRy/GcS8jjaWMfTxI3EbUvzrprtgRQDOz/eMnyVQVbbFiTMZfhfQLeu+j6iY0Qs/QYGFdHefwzAYuVpPhVZK/tXsy6DAioLlmNDzAu1eQ5ihCnobO+MOZtSD0+uTpiOAvPwGWf52xDUHj4zbdFtZULPV4c1TmWflDGMkg/Ia6kPHprHErwFTGoBg+1D6oX8lSPdz5srAF0RbktUTmq44+USAYYowZQOVbM3BWMc603Oy9SQD3buNTgzJ7yaMBbo/pjkzVrpW5xYH0Ra11ykiz32vo4nBg9Zvm92KHWhJm7uQJV5DMPA1JHBWBMcjz/uZupwXqjoTffeHZ17N3waXUaR7cZDs94ewlhsbQrmI7/A4zJDUZj0qKiVQhn3f3AneEhDwl6GUdCBdKY14q9n6ay58twW2PRXXPJ6UE6TUs6oqH/0xgDpP3bx/mfcCUy5oo91agCPtpTfowGZ0tyw5mIOsUqvdURDhjuWLX/WIqaPlYx3zmJ3ahTcxtC5xQgKWrQskF57LaOvwYN0lzIwz/joNYkiZwLyB7Joi0CsWWRC6SapEN5TClIisNQtNPmfwKaKYb+Hguo76RtcQMXdRZWjEJNHq8KZKeg/uWWDOW6aygLP9JDrNNW7JfWDyHPR8GL+29zBAD5FY1WZXsmYfdKU1VTLLzAHERJJGTpwKZH5k0uZrDYM8zG9WX+RVDM8bsmN8cI2wKz0Td8GEq9T4DvY6FuhMsqPGHC1tkLdxuwBYP0Lu2RvjXaxodrZhKfkkIwGcfm+lFS4WMFPCz3FwWwuvNLNqv7c85xnk3aXWl49yCW0YTzTqwyKuKWSIFJum5G8BBjvxx2yDOZMh18M2WhRGX5VA0p3eAilBsGa54P+iEat2c0lLnTrXg7fzDLJrjO/213hRmT/92zHwHShntUiR+9KUWKWRcx9OrMWfefEo/p2FR7dbNWoP/P/se7JJUfBzJixcPvTzMvSTQrccDAmpwoLnh6pnsAF37U9Cakvwb0EZzywhYhfUyAZ4oAu4R1X55yrbJifKRbLIC6NaYqZxbpzV9ec4/SFSjJKEvmVGa9tHfUJayAvrPPbVHNaxlbdJOOn7f43GTTdGGufXu/daAhuYtol2y5rFVUxlDpyKCfYRz3fOyJZEjhxizetlF5kpK8kUuEpKNWnSG9VEdmcn7Tu0/U9Pho+IZiTincXepD9zQXGusmr6j19TKRCe4dmbGmRl1cDDNABYeOKT51fHc6+d1Q9T2n1UMmkd+aiSUgNIrogqtnInezaEs7HmtmpjKttWg7ulLhPvEEnGE5TqPY3iCItPzYojGET4V755b+cNmqdG6OBTlbYjDs4AAp+ho1Iq8R/eWa0/FOyB4K5JLQ/WqwpaNPuaoufHcJMEld4peiw/7uIRZ9U4otV2lACBY2PfSUUu7vJ/iZUtvPoJmd8K/BmbnNo2iumTtQxEeARnjsHdzf1JrE1L6NGFsI7t81c5GCgmWILKM5pWDA5HO53I6aju6916JkUl1YcYyk9Hwwf/waKzGbNaeXD2d1jBd+rriDyPgR5p32kxAb41vjMM5QjUrVztISMmbVDBnx2qArnLJ6ECRGZcfK4U6LCAMxRtE+Y32MobWIYqbeJLCsaF4pCXyZjPABVmN36NRAavX8RXO80JuF2m/Snmg2NL0dSW67EVH9I4fcFSjpL73r6ohLh/V+uK3786Tpz4u9p1byZEEFVjn4eK4wBNeQ7DGhdbFbRTt6/9b55EBMfJGakrqZ4U+Fgnh2uIpidUcG+iBjHE5HMRX2ZKkKLyYQElkw/Kbj2w8OvDaxd8rzWoSUnwkiP9DB4L1FBdrrf9anTqNfPehHTBlyG9cgcQLrR8tQEZN9zuxs8BV1Zf+cIk9kSStcCODphQCbZP7NYhgTuqPh967gyo6DhJVEeM/gq2arEo3NkVtX7D7mzM4zzsjwEazeZbygY6xwP5F5NLqPJ0Hxncni2XMn/GdHQmTbQF1zee4LOhZaDlBzMZLsKXcJ3sJsBmPODcSW/FKYiVgzz7wLdz0C3bFpTwedWpIZzG+H0kpS6hOFF5yNj/xUGHEQK75qxYUFuXq2vFITPVf7aaAWUF+eBV5VbBqFcUccHNaTmGaDdRTdXTurKJ8ATxX0DHWz2qNhGP4nrYJRCKI12hvvahdfR6RlR+zca42mjybVuHEEGrU2KvnHy9+mmlQDH4jYHZKC6knkne5Q28ldgrISAF0p2u8YVTy2bGLZqUkIV6zWDXi0DuZMiQhOJwUgZQNnrjzpboxif7CaCAFdxHukA5fPTubF6aLOTWCnS/EP8ZSOIyNGpkn86BVLEgxNoCo5XDdJHdnSB0Zy+5O4NQSsoKdZzikwg0eSvXAE6j6WW27irlXjNHHxiuOY/LaFsSgXv62JfK2/O09r1DMjpxv32Y457Wd8wFBf9V6i6CdLP2Z9qNFsxcP88S7N6b5FAkZAkO78T3f4mpUVnXed/QQC1AAudBr+gg118i202+jHf4m1tBvD2iwt/8PqoAWQSajReU2kDJ91lZ9cqfgKVbzge5mUlKDSh7aeClFOoVz9UEdTQyNyjj+u7JaX9DWyqtt6955fcvBJF1aKEjjPQjYV4+FQr9Fnd8NqWavBRL91OUcILzXVselzvLQtPmmvtdhkUNi8G+O+b/qcVyHvls9lJjRGbe0YWtuq9zXA02yIjtBjoQd1vY0EmEFvb3u3xiPt9Wix6NZ7ljWQVbw229SAPrh/hsIECHTLmxKxWD3/K6TUieQeqJIfpcIoOQcgmvHDyyRUevzKImeikRzg+ly1+qSicz7hh/DCm/39Fyk6M86XNkhcEgJKANNt1matUHBPuMmqkqR0Irsee0uIofjg8efSzC4Ml6OzAV1PuydANODV+SaVqKrg8qTvT2ROpiQHqoOAq3EdFRo1QW+1ak/AYmGEVA4cF99A82GRm5mLHhLHqOSqBVNF5d+tjFko2morW+bAtWqE3Mhi2uYPJEeL+puWOoJaLV9uHtQIj2GvjqEnPiF3gSNk2kq1rb+v31DDwcalu1nsmfE1n7J39uQgliDyyoBoudkZrUtnIUrDsC6iGs/DA1YU+EpC8VYQ4iw91D0O8kJIRK0Zo3YzUzYnm6vxq+9EDAP5SWf+Eyupwlhcyq7rgfu0UcsS/cyy18bZBvpooyg1q0GNkTJ+MwtXBtDoaChHEqMdF/a7GjUgboSb8jHDJrfqRhQ/bbI62r8nHoOa6UgOaJLxxg1EhXpXmkd3Rch7uNxgpPzxP/mBdrGsygnoth1z7Q/YLYJb7LwpuGREdhP+ef4imi3CBmJrq9pWR8/s43S4uxqNYHUv9ha9RBACBhuz+S4xTQTZaCKSoDHnxC8CxGhiHczvJUTlt4rrWQpu9+AvsrR2wMvwqpTTd2ETTsO/P3JJiLBUvcs0TXCPCRY2h9Nx8ZqMz8XSEqa9ByDLoNM8PxxK/62v/Wkztb9dlxfHsl4u4UjIZo5lD7knNDevOZvFRYHhwFE22lXrX+Sffrt3y9R1DKaG/GlAPLQQX/Hetzpmce0TT69U3cFZSUWj1hcJa25OoCXx3O5jXSizjPu68eF6JRu4ly0GPmihJAcdY54LAu+PeTtHdGWaRfb6RVp9zxwP+2PoTSQm+qFhD5LkhsYuT1IwWLIAUjU9P0z7IOUj2QP4sYABt2vX5hJCVUnjOBPVGQTmwyR8LSRc2WvhlmD4DMitovW8AmruHvsuxxMnY/ybXB0f6jgvY+7tMu0sJN5r4DBEBXa37SH5PepbiAlY5L6+09qF9dbg57qZdXr+Lkj+9ODwIdoY9Ogs9QXAMPBK9sNLNDM1mFaODMVpqeBBx3+/X8BkyPofOmxl+kYJsG1PP50FDBXj0A4uVUwSXOnyDvjHd5pupMiy5DyOMVDjPDi22YVTeKKPxtGz5/wLm/x/DzHO4PBKlriUyR2fdazZ8MZwZO2yzm40RwLqezNhsNT7aqhOqWBMfTbYcyVtVzrROKLQ/cw8h9MBYgLQZ5m7RtajLhjAmwWRubbOysVY9+MbTxulvSqQymjxTj0/yGmowXOk8LorLHbyciHZbi5Wipq5e028xOnXPq0SO1Ei/BmXFCr+iw4toQwld1d5KXZJaq1eDPduqLEuVRpKA9CzB7KJsTTpdrYpMaOsIFM7Wgr9Oh/caoRAohQN6A6HSrmbUuxffYlS4ymc4W40QYfauuqpQ/JTXe2l3gW1vBU3Q0CQWi+YnGMAlM7QCe806vIrrgQmejgYb3z21bFn0KNZj8qMbtk0fubcrDYYwmBhjZezZtAK7N3MQKKCODWwtmN/WYEGctudKJzRB3xrBGIXPbh2oyOsQ4psvw2packPl36ulG2AlW5rvS3xsDrZG0jPgcLNOBZVquBKudvtx5EyYnivmLREWPn30cbkfL4RsfTwuJVSFZZJFh6UkofGq/bkz/WqbPwyDk8xppCVNz7JQstijvxEWrb40THMQJebLnzyY2q2jx2SLecaR7/0b676f5ddR3aDQqQxzS6YlPvFcYbw+8vic5SAk75H9CSsEorQCVlJSk7DU5HBRkzDnV2QtTJe9fsfqy1sQNBXqUXzv+3HDVDSjlHNPKEmNGm5+zlEP/Pa0mLR8hxOG5PeuHfsO4YAaC+btxGwKVWC9Se7tv8fBJBx1n+Kox6GyPB1SVukkNQkjh9dl8s6dR8uwRo6Ep3zrpyoDHwNvpGU0zV5/27gpveUjCyrt2ZF4TOPsS/WygLkfE2dbNXsNDXjU0kggbh+REnbrOGVNbeYAoc4ZX0aRdyTYOFzlRKaGo4MoHLkMH9FMwYlY+jItBYVbIzsByLIUmu7xM7N3q4VtOAzdBtYpwYx/5yTIIJ9yh2VZWg/uPZimDRgASUeaIeF/TU+n3NBLOkQvsf4CKuJi9s4FqpE2p0HLaw6yIcFU8mcl8Jx6XPWv+eL9Uv+Eyr1QVYQfaJcVwJ6kjFn9GSZ3uvbIxaZMwi7x+nNLp60sgdzogotqc5oVT+LDsygUDk+S361me7L2BWYFkcDER/Rx+J0tgDZ6wwKRu7kFtxCpqtt19WgsF6LzpqmDlLORvOsY68JnuZgBdo7ozFmFR6uGXxbySNeCvPKl92vkVsYEYjZ70nSsNQz9WiIy0pcd4Cjnd16gHVj3X+IIr+ZH/gTnYy0JQvVtpoQKA3yqTH8ZK5WAWFLSXjNeHCwtYmaan6uJoOWW3ktmR0n9j0uxSEniCHfobcaa4adhh6U65iKCHer9DsvpoFJxkj5jhGLhPSjJ+hLddzatV/1Ocn1CE5uZoZAMtgkhUYN5zk9+VUjJxOTjDsX8kQFan+fCSw0rK8IhXNp3dynfHXSYCNq076Pn60lpsgbLC41pl75UNjAtdkXJ0OFBP9SOFxYd/qxoACmCf2c4BNjgll3P8P77ikGQPLbKe6Bprf5RR7SLTcoLj+WEriYD+XvlnCQ6gwN09MIkc6PH+xS8JfJD7iyBoSsLx/L/1AzaxG7e0eIP2dxroERhpC6jg8arrg7XQBksDHIJZIPRhy16WjWaucMUOLtxrgBU9rezETjoCtMnBYdaOAagkVHdueRkp+p0+SRoZ4ejQaCwhOiYRYYJC7NsV73oO8dwYLioC3qILoo9B/eMud5uERJdTB+L3gaZcXObntZ43fegezhpmSwHyw4dM10xfsXF1MY5XAR1XmGR9Qz8Yrc2BSBiUUf1wSye1tGQLKtmsheBI0zWEKzJu8/tdWQ84lcWgnXo9INPwDU5XiJi0OyBQbwRH1ahR14L10g9kAYWlDK/0N3VzcgYYursjTtw/2wSHmfTGJsx5NOXmMmVliBLLHGu6G0jFBLZtUkH7EzFzorhlKhKRrLqXXlXpO8crQ3CHEcZLu9XzwCc9SvkPe94gxwonijdizLHtGfLLKLF1cdtXMFa7Mf4P/JQHiBZIRXBzCKoqPaIuvh7X4/SQdEJnxbsIECUF90ZnrLUpBjTXiX4XAc3Mse7eTXKyZp8Q3Sf1S3esZyDQl+BBER4PmbGOeQ+K1112FbEeyqQZg56WiQ0jRCUmP+Kew9A1ZxSjutLVOfkpuBwoSkP4RGNoe7WrmyTXKI6nk1Tnz0oe2Vm3PjBDf8Gwhe+fwAYSAjlPra1TtCj1uu1GcdIAm6ViQn9Srqf1ym9fPIxInLxt48mCIl6DSTi4ZJ+XkJrz2dXWQqhpSF4nNWapdIjJH+p1Opedufkw0xHlr4vORb9BCJ3W8vAPdZSqI7VxbNaaOfqhI/8w7L9horVKv7MLnEr2l2XgUM6+i5Ix58xgRlYVxa+ltEdaupD5yktPEOlldMIatEHTM9j7h7hxVvQPEbtQP6BmDdVaPz2u/o7+Aiy4lsXGE+Km2ss6828uqY4y28croxcwQBaemP2+4hEA88WmmXnQTmIMFje/i5qVzP/dynhApy5GEB55hU7+jPdveexxyrULupZB1hjyqISvKscuKXOXZUnp8dPLlTkOIlOhMu9t4Vx5PLPIDK0SdUiZ95AlS0+/1macnq6hXYYejgXigt9NePxN2PY9CC0HftH0q8httvBeLZ48ootbmSIZgK7/Wm1zqq/lUDZBL6CYC5KDyLg/WfRKIQMNyN2X432uLr/f/9AoV132hvDNWvIbdgJKmzFwnqjd8+MjwrCINW480Y/0ve7EpvtXHg4WzJv5MuILg89gjdMk86QRO9Q/YKdmb+HV6eMqRTq/oudO/E6zvH3NzGgHNz/zI4Clc1kXUMDTrnDpBI2KbWe//7iI6d1A8nhX4F+4tGki7hfsA4VOK83fdLmcdAGqQRjtItVXa3J7vhE+x0h3K+fVJpM2FZDdY7gVF9ME1rtQmyQOE+F7b6vQAUregqMnIegpxtIKRhyTvfx+DFWZLf+VUZHUO+CicH8sE+9LpldACFUpG+WMfE56X+8xIB5l+Eu4ij2kBUNYythq4o1kyIEuD1kt9XQ97gS9+waaIHokWae6jm/Y8Govgmk31Z2M0SBZAIeudbA/y6RkBys3zsWVHoPxD73jIs92cougppJ3Uxf/pQcoOw/qt20epdVJgHhT5/Rg5mNf+bvQ4LJnwSxs7VE9Qc/myZF4IFBUAom49bMTIghVW6RJ2gfXkP6ovc0THTEpxZWx4zTkARVTfH75vftaIkZptS+h3ERciwL+zFBfxojqrdRqqdkYWAVmXpf+ueckOfXPrN5b9eEwl8OJWgoXwyPM73RDn5ix09+qYTUbhIRquBAIHnO03H3q5TFdSXzP+sPDF+FV61ALiJwLttts7/NF2qhFJI57p4sixeZfoEtm0Dg5wGwPCH6tc6aqO8oe5R+IkDR8TuyFEN2w2kBdTxxvejaSoap3bQlCW4svakUIjVrpe7zCbbcGL0xSe/T3hysCfb20Xj0oFitmmY1Q+1QAbHJj3MfeeZfxuvYYoF7mLnb9sF2SPQEFrRwt08qapY0ODw4ReEM3TamVg4j3BvgKWWLIeWrMXPSM+I3hBzjUn6TbqMNWIPDWj5FBYrWBwXYB71BOpmX+5iYomjHoQ7LUcQ867QRS3qZXYnBbLy/FO2tEGfzE/rGyNxED2nvMySIIs4Fx3fZIsIZn/tCkocG9krZ5TWha4eDI3zmyCQeBMYsXlRDNsMfjEEBFh6/Qhq12c9IUp606kEY5bwbG/QnU+IAyJhlftn2f8iRL5A7v4R9oAJGU2GYjNHqZUGg2z6az4YMtQyXcV9X9WBRlaYnfVIRsmuVGDhDBIoG6C8AkCK6LdXd0NgeShgVCNpx7iacd6L5r4rVi1Gco6rCBwBfwyIJs4Fhnq8IZrURn9zhkJ2FenUPijnbIom4cDNJT3zqMfvySGt4ko2KqwoGDH25QLfuWMbcuRhuQwYKgCX9VgClxETR6DM5DNjTv7F3ysG0kI8NKZ5AZDzjJnJD4VVPwVR/fNKHpzgM8QQGSapVEbQCuiSw0xjHphp0eDxZeames1Mp9WwQ2puhmhj5ql1Lv0eYJEpN8RFa01yfNY0KZkTpYzcO/Ckhbb36k9esVXSMPl1G/K7/sR9Mcqvz7tEmdFwGaO02c6azfLxlRg6byx5y5aqHXBgH+N8X+0pGSjHsaENs0tEcJU4XtLrRLBJGIFVEe3TvIYkvc3siaU1d3xi9t7TPq1L/+hMRqojqmp8jBLyo7KEuYZeOKHFM3mUkV+XkyhiFhmwxtLgSsGMbh8fE6hCR2rTOIinlmsF74yj7IpViQkLbyCbrvDt5/yX6I7Y1abrFs7QBI3D9QnlxlwbgZHvFTKeaFKcI3NvUQFQURMimQ5M+eF6vwSlYff+7/cWpYmvPrIh9BVONzVYOe2tQdAWWT5fJSYL5Upt0L6Dl/pZObBEdo+FPC4b2+iU09eJ6vb/kc2/uq9CvCUV9KB+C/CPAJdOu7vq8wf/Yxy8081PEnm7VGsIzzoFYnDvfYTUyPhdXV2yICWljxWqkyEe4e1n+SZCRACDyiLTdzj5Dq5ThMdA+CNJhV09iM2iW1Pgf2XiLDkIpNo8ugDtNdVTMEBsO+uHzrqEI+EwMOFr2gevD8TkmyjvrYH9Bw6rkARUFwc7DRpOCIaACn2Edjv7bmiS3MFeVgdj1y0Rv+v1DYqY6EwHst3CNlpq6XBW7Q/fu+F1R20aHUR5Z1LIZ7wvY0E/w99bKzAyUjG7671ZUYF6F5+Ynv4Cm0twLZ+GTrBp8VL/LMeq8XYgzYldrklMglyWJS7iWBhdA5GraO3m3rO2AorN4N62bHcpIhG8kbvIkybnRVTEWt5a5f7iIYJN61OO1gLp+lMKa9CuaUR/y9eoF3/jHgqh6iPSadglFYQ/GTsLkzIXMTFtBelXwJHtvmQtoXItuOsLGvL2IK/M295YD8SaNfSND8zTfgUXGYQRyrzsPYC1cxWOto+YkW9R3EinZBFUy/5HWXF6WeqLcPADGeJH3U642mjV9hMqA/GY+7DcN2bpls25VizlGv+FyH0qhDmmd0gUS8y90rDX+Xk6y6McJ6S7gM/DYcoTHv/2NeKg4rjMw8TqrlL9LBcLKWQxtuJxVX7ObKDCs6fNlfUj6iRrGPFdJD+ziFknCJKgixZ5RJQEQZi2MefRmUYi5crYu3Oh50a5Jf+upvNzFAo7KhxO8WRvoqnLO0wvvdcPsaVUOIcvfZoUierdTyFyoxwnJI91KCBroEodybtBGshuLseewOL8RJP+H2Oqsca/SYdeeRtivXY+FFQeTQ33eeX3DdtS0+wgHXVCCQk/CkG/az4aY+ExO9eyJRmpeKAXose57USPZEoRKo6m3uIY0rsGhjw0xAS7X1DuBTFVuo29v3dChgu70cPjpl5/xQmrPdA36PXNZRWOszr9FtTYYxG7dHUooremnYo1QnUGWsN/xygLq9TDGLLhVH/pc4pD+15uGiALFzU4PINmfD25G8LAsJea1dQlpC1s7rkYJUQqIwFNDY4Eh0dawLn8fCol/rhUCEbEHM1dJlCBpXxKfm7zt/ZpsbXgy68nEkEoLjs9rk0E9GFFZoYLZv/4qZR7nl7qBbeALu0FWvdWoNb4hCvlkME+i5nbMafn9uVxxXlpXBlOxHA7IKvKJLMXQanWkuK9A+2VI1JSDoY06+R0/g5TPJIHfO3roljfhM9ncx6Qrk66xY1H0+2UgF+oQgm28A27u9+T4rGo0sT6suA8Jdwthg1T9gojZro33dFb5pubkZ5ZHchLzsKkibaR3DHxf769V4iImNuKKrpgMMK8vcvF4YgFx9Asca63MVyNPtp5+zXPASns3bwdmsxnn1S54GTdkB4DwX4L7JXMnQGqIaS+mPgWxbIZbFcDNIrMilEIEGFczfvcACtmReTyzqnpITyfsh5QK4RKX9ZWtvUy4bWXjsLYbNV7MrrZsT82c9cmf4f8I0sSYqVIlcUYgI782imxBuEKs3OWcogWDmwlr9TGLtVSSTlyzHUW4PU9f7Wv06gLioBSoAf5esTj3FD9kKtTKQZfTKEIOcCYWcfIk4IkcfoFGKSLqsHhBpBOTfEJ6dxkBJXCSlknDrb8XJYO4/96XFd4ThAg4/Heg3u5p1kP3QG2yMuUrty2cFQaT3cWMABIB2diEu/1KfFFSKbfjTp8aUhb99C/ZA5m7h8JWsGwT5Ml9Uhw6CmNHyRA15TyVwIsOH0I1tFeVqQaoqT7wGjyqrJ9bI+WtpjMv5CAGQfj+k2aPOJZ/zLvxAtkd/Bzh9BZPEwVE0I0DI82uWK72P5+mHKig5zbXYrQE5bSNA9/gHvSND2qLV3hLPnoJp5q/NeZX7mhb2aWf7qkF8iM4HEHQ6YiYA+E+kPmfMGabHq62QBi8sSJ3yb68iTcA4YT6f+gJb6G3adGkY9eeu7XQZiQEi2fXRSKUOj/zLkyh4R3hOAX6xhT1yCvCHT2Jb9tAzSMxe0RFbM3g6b/VHgP8nyZkt45j1ZYBTwOpQIaFU7nU5focNbiclNOds9b6I+FOnBXwyAf1ViJPMKBBofmR8wg+77g5o3CiYUzQ+KdNxUo14XQc58/GKrIq3XSIefM9azql5sX7KlTsU8DGT1HlHIYnd10cJYsAEHoN0mLKcHTySHsjTFesKWsmK+siZFXhlavE6F44mweXOrX6FBoELRrvIrsst4OH+O47VaML4CK/cNrjlTodfRr3u2XZsHCcw9kXLGX/15sm10DYmP3G3387x7LDyVoplrs0pzIvfcy41eb2Ob/wM6tQNLxQKnfSbL0eyYL+RWR09qeHT/lWpCFvcISYlmdF/jMaIWDyxE/LA1tguYOSiQtSqHfgqHr1n/k5nFhnUBnU1J1eys/8qySmWwIplgfD3uNcFHlg6trf2B11Om/f7E9onO53sWHhas4nNuhBJsUn2OjOnOAFZi2dcAvexHytVxIdybjHcEdXUcp0jkab19hwZ0RddTUGjtyulBmpbfGD+4d+oynTEjmMlYS/pfoCyhEk9XbgbBf7wtFs5qleFrCmB0NrUYZLxmw+2wFqYEUy2hYP3ZxY8uhRZeFXZfhOD58zGBx7lo4yMjiBc0zvOGqVQm8d4tk1CRpyGJOGJWVU4EpHPxqgMP6hV7f0IxJugziIEJHavrZauRXe0/THYEOKpl/a4jm/fah+oAzHRBqwetjJBSjNp5LaZ3ZUNQElZJBDOF1e4muumSHF6da394Cvppq45QN1B2wYBfbx4Y9fnq5b+heTNTCmP9XhMQGniDhmdhGzfPUY5YPvTUhEcaaA2ucNDUO/xvaUVhXDIodrM/05R31bnFkjUjn34N7Aiuagl9VB9SjYsu83Ws9eoevaZVwZMC4uiZko2GtNzZCyMHRq6GKhvEGBiM1gLyvMZk3eR2dGcn19YX72JnDBY6RWncG7lGAg0YZR9lyoCyQ13gtnyBi05gPlO9yOeIYGqQrhgRpR+pAvx4czdaBMpVI7SgZMAhMSsdPUEQ9stTtwSabBmrln0uHsOMhDvi0bNRUWUmqnu3eiLgzk2XKGyTaHCe59vZZcmDkk8aOO6pTw5H+DWALBPMcCOmfIz4cF9E5zesXbQkQNDFk7vlnAcetbpid+Ce9MnTb3Clhv0lL7lyusJYCpLpalVXmQ67YNR+IIDh9vW7XeWnU3FFfdnO0yqCON1josSLVMTTaH/T3Q7Y+gOUofDwwXaGyGRB+4GRC2kk7zANlgd7PmE5kXda4IpmTbP2OqUJ/O9EXW4aslQR5PtYy3tNMamtk4Lwzb6WIFll7MVBneG5vPfEGslblvK4unzLLIvceI6WxhiZNc/nr10k9nn8ikKPz5jmA9oC+lWIE8QR4XYTcO6WZ7VMORykmWLBbTE1NQc8/TBpYSaYjlsyOK50EEwZC6/hyMiltFDU/OcVfSs/4s0Rk68qJkU5mIFxzQcySQSzLKmqQzkbb2ZlC8MLMP8Tt/ui2UK3r3IoyOWjDNfAV+2/iYAbaU/gcEuC9PqZbBCpHpobrsMSJpIpAbdk+lZArMaQfdQP2kY9Krk6TsjNb/ad7Ghc/HTlJyxRISEoijGyuLhUJB5Ch35PrR1oibmRE3vvhC5cWj/AFFMlliT5ELHoj9ieMLEG0BOkVRUXKuv2bfaF8AdXORnzTtMfXYqB8UVY5TvybX4Mkg9YXaiDDrp7KV8wVHpmx3MIlmRkznG4Q7DbYNTZBEi2yxQfQW37NrAOyCP8AXP/EHi/BLLFg/ip1tleZLojlnpdzKgSmJyi4IRDWNifCtFxTRjzh2z9DNa3KUZLZnixrksQWHwp2gRkmuu7HYPHYIQrdjih0WnNb7CL7hFDLjbfGaVLQh5Fu7SHtZTqDYzgY4QnM/x2PC8v6+qmCAMbOvWxZOIxjgpUF1ud2/e41K1bJAXPTZ0ctJLsigJDqNH6fNsXGGXNx7cwJPgP6INK3Qxc3ylfv0L1e9m37k+CqkJJTN6MvvQuae8WjO1l0JvBh6yHIrZgf/Bt/DNS1QULgHfUCLdwH6GVXxn8JChzrTEJL4dTZGD6nCwPWD+eeU/jxNc/wph/HYngIZcSTOnA7ZoHemc7pUYXx0Nr45Sbce9CyAvFnCzoIYbXxoDXYVwt/7sf509VEfvoLzjbFrRKr4vntb5dgeDiwRX6neO0yQZsOSoVjVvOOSAuP4PT+ezKgOTL5CMeBFh5fTyCTneXHNexLrs1pBpLHH3kmt/Gi6938ByjJyGR1wM7/rvRQQoS1drQjQ0vefqIJKlavxUAyi0PuILAyGGfaeCzz00DKjY1cowpRuwwf7rYPEZOByjttnqj6EUZ84F5gZp+4HJmTpMjNq0q/lyKFhwHKG0wkVp5h+gESx82VKGR+mbao8YOh23JnEy+eNJ45yos7d1gFc6GC67dt+OzE5TpAYicEpe2YtuuIHNt0hQpdLBdS8eqx9D9RSrya3h16jYIp9Ogfv58USTrQa6bOJgC6Fuw3VSohoUOQpQ/XY+PVKw2eV8Q1N6yxzymT6QIiLizm3kcA+jtFVJVj/IlTTGr7Tj6P8fQmh0ag3AJfRbLs8nmEQ1QHGUtaUv9djTgKNG5hVLyiujHLL77tNlHcYLwqquU6Z2V+WMoDwfBiMDqK39/tNhs7dXQhQTHYkold5VgNmV+WJr8ETyoKTHTS8g1RZL+KCbZw1LZoGTgR6eNleq+XGRggG9pbw1+WcW0jzJpvQle+pDWTA3yPaJogeuohg7EijR/48Se6kjwNpGStelAHWNOtzrfgmNxtH9r1eSRWLz79nRNF5th43Vy+rZ9FcwK7PlfJojQmk6yDIgDVpS2IJtFflHkl2pdrA/ZK4Grks9dfURGUNk54HimplKaYEZX5dE2M9W/60vxTLBE6XeIZ01h4YiHBHGMX+eAHZAHpSk2dFZUbQL/ylbq8VdzyOCnwzB532xAsz2XqmJFNJCZ6YuvEpyZtLa07GuhPki8MeZUI63KN4jC30SSX7/bWpsMyfpqrzmMI+cCYlmRUB0Mu4kG/untuIlFzWG2JnuSThOvNB87WuxDF4K9MPLtApA2nPV+2yMqZtQu/5eBgMzg8/6FBhddJz3kV0onK4Jbo71w6dhI4czF3ksh7/wVe0vAH8B/pVGb1v7xscPIhg6KL+hvTtq6g1+kCPpBURUhkj6yrfPgZ3/Xtc22MaQJp0ouI8smF0IW7P8ZfkCNRlxyoz5rOlXJ2YoBYf+hZJACLpIW6Ecg7s2fptIWtvuAgGvGV7dSNLkYv17ghjkJQx6tLucnApd6V56PAKNj/7Yyi6MOC9uwvXC4HnQSolMT49c6/5ZRIfWauOyw+arQBxET3gqjgZPldHDuhPDdYxffuJ1ityuwa75OUwVzCfQ3DhhKAfuieBFYqqN1i5usxjNFwKad4V39gjt2wLjcS1yX59qz0LCyVW9KbSYU9A28hy5DC7hdtdQxRU9PX4vfg8R4KZzpT7OhJe4Rwnuob88KsYJT3Xdb5uQj/iI2b9k+IAL2RazReg2nxwi3ia771jH8mWcStAs1NJu+cMgx6oarFqLe8b1HSRxQ7za0WtQhVKdhOSo+l5MyUbO7l4rtMf8vOidRDYSBoESyiDirZR/lirb7mNwOHR9B00U3KDHjR+/6/p0FjHCVpWNOzJcWfIRQkZ6XmbdXoGNbYi+/6K31kVQSpEiFHlf0XTAzQKDh03BJv6aoldSXInQfAEINY34mN7TGvaILI1iq1F8qQD9LdUyM1y1GkmIcoViAyaqPmTF6srtanuyTM4L1D0wyuj0tEVAfuycGdwEON4fnsCqlt5T6S1obgnUutprS4s5WpzQgzd4U9TRXJErli2+o2bS7A/uISBZhgh/679K/zLda6gWtuZwAvTGNdCbAN9uwZti3Hk9kKWrIq/zDHz00+fSYLcc5sgjgY5sWd/F9nGirgGojICMTxUzGmVVyjsC+0iZ7i++UKuLA2KCekIgylXj+DAZVKUFgBgXYW5+1bwyASMUltB5MhCcaMuivyyhZw3MJ7OjjmJyH+sH7zwWOwFaztw+KQpl6ETunGZ4wgXDkkep9RDpXHKdERy5R1KfOfi61l4kXklOVi+UvIPbGuKxTqSuKxjgg5aUU0X3V/EKdOugbYyeYKlYTyfe6Py6u2Z+A0k4k2giHiUVqkoC8MKxTXxmChSs68WryAMhUxyo84ORdwTONcLdmrVJbnyH+ugmyyx9iKEPADsMijuo2U3uJDa7Wnfr9gcycQq006VxIwrhk0FV/BDjqzquNOsEJXdrimGw0G+JVU4/5BNk+lE5kSCYz9cOOfNBtbtPUoVHnu1jfPwwGlaTc7GUxPcDFnEgwaHh5znVnSwPAAdXz5o6vI34Epz0NKfx11wmUjfW8nTAn60/CwPV4XjHM2yzXbq/EA9hUimpPyH+gMWQc8fiEpaTtk7l1iADxvDO8EMdlaQ0nXdXnhCuCrsoC+Uvlb9IaXpTbhDyzTzYYUPRsJ1khYU6+UMPk1YHn7mE5V3/F28Yia/wrwDdF+R6TmVzsqudzix7NyUGk46wXs0WaHIURcZDicGiV7SEhoVNTU0zgBoaSd49LNnCcmSgWRMUa0JKdpcVnfovdDcIyEcqOXD4VeP1baW1O5XKi8DuZzNuEL/drafxlkHz2RIla0Jp8ILNn7S3fdeg9UhAx9q0+SKtkZq2KsJrdjjyAjr3GfTjVIDAz98414NxYOtS7EWs2ZaFK7+4WBYoC5Hkeq4b/TVXen2W5sxGUXGVbea0PfIOieEzqtacY9iZH8JBwrLvaO9mQx8S8Xs1qoQA5mRuhLUFIcDGMj1wJK/K+vclB5Bl071Plrpq5+L4WJ77f/haemR3QBDVN+DYo/NMMFkqokI7b1nRwuzDmI5dEx4XMlGANd6UtZZVQ12+CHjwiLfAM9yPWaei6wRjGbxBRZUWxyt/lA3BanlqVbrdSdMBG5p3j4Pa9sSfYjUr77zB9h2qpnC6V8u1+XFmGBTP3y97KCCHykGfB6mbCNng2OYcDfFxSp12MaqtqOwry+xB9gUkHlnfW9DENAGqcYOxFOWwZHAJEeIuPuyLr3pc8euQGkJA6K1rmHJDoeAl370hmHY+Wk02WBNr6bOj8owlbEPXZobBQ/xU4JVN9l2GH0nnIedokXyCvBiq+jOf90wECFhhyXgaKiOos+J5t5i72+cySCooSeyr88ULT2mwUuMCLDw9Pty72PByiEtatpiqNeZF8Kladg4jD+8iY+w8ru/PveAVmrABMft/YevFyzmyB1LNidUz8yrnolKmitwK2bPJrQzSfyMg7RCZtnj801QmxB2Hh1RdODJ04NYCR84mkyeVmLrySQsPfWBiZawIPusj3W803YTrCIFZh55a7RhYSAh5uolGsv0TMC+pfZ8CJFMfhrjIkPX4iPlpoVij0m+1EDPaObMhssohxiQLjAb8un88eH/6Z8SnJxoDDY9JjIkM28xe9G9BMqE8CdRizNqXF+yzFoq+i0JXmGCunk6mGwVz7dw0Aht2yZLXL1jgrrUpP84ikBVljLiJmABWcOUt5aq4e2FLPP4IYwNw6/6kBGhUw92jqGvzzSz2IXFoSGkFThCZ6Hdi95k3hbTR+UyOtNXxKf3qOHtoG1+tO5u2H6XvCe4OZ0IsSdV2C22f4X0XRjnoLI9dkAJcmaPzyLbgrWgj/dizWHsrNz5PzGCCZ7zywhZMyk6RrEJ5ucZ5k4Fosm8+U94ZyJFHYaHthMhJSLgoHd9plpggxNFeaBMx2BdSg8d0qM1P9s3xHTr7n+uvFsfU5qJafAkyfAi/gC+OLxCw0uMl/XJ+id3bpdG4VxQwyKvZaxCWrPaRHIy9KcdR43jv9jfykGUTzB9KjyF1G0SkyMHMeY5wgAmcEp9B8ffD92GR4FQExXAD/Rm70xyf9mrg0HowJ+Y5o1trz3gJx6Em+pGPt0PvCVSXsmyA7BLMqIiL8iKyvmFzR0O7FJPoUD5dZJ1eKn4tDUJJ4Umb72XTHqR1qs8KsHPpu1Bas2jM6FoTMyoX5aScTz2RVJH0xso6SkxxuMBg3uUblz4fj83SnK1GADX8ZJtrY6l5lrbF1/ZuSi1BShVAdFnfBB3Sh1SW4KQz2mL+Y4svWwspzeGp4W6pTFKdMDjOxHzkJHkAfLjLjqf+T1Axa9og+Cl7gRTi70bSWjsQM9F19HqH1IdJOoerLMQTLpuVpFU//G6/hsxG6sFsnzMJ7n73SbIizBrcriqJQot6sKe+uP1gONUVuBIPlDJA49atkvafSdkS4NR+zciAFrwoHjdIsVSJKqDxAVrM15uFJb4cUI1Z5j3Wgo4gLqLZDMdNtYKJ1P7oBTGSBKZGTqguAYXj9FtcQ4sSbuwAvEKj0iSHfGzNYpAzMhIVEl+O5tVLe4s/3uEd9Gsrl6bogS5HKQwX3XK8Vnj7lf+5qIQiTSzRnfkEpdxxgU0LAZG7OSxjiHkVD2gFaZ1GjKhIedce7dFUwac8qA8Ut250wwH7O4rKHFECWEhhPfyyNNFFWeFrcIjCB9QkpXuz0U80DXFirexggv6bCvxlzrpYL2A02HykHogeIIum14ATyzZnKSfKNZqYUHkFr6qN2/mPO1WK01C9CpwXcl3fLEficn+qMiFNH5a/JFJBAF2ZZWJ5EP8mGzPCF9CDlr0z0YHruP+6bAUG47CNw5yDdR0WDTjq/DqDE8W+/fc6iTB4r9945YbHjR76ZqoOFAkp3KnRniRLdWK5iKvLCCH/Jf9vzHnX4LfdHlAiEucOADd6aaTJnMDTB0DnLoW9pvA/TvJPoH2GYOwUyBgDkGv7VLqRPzjz9nIWylnnWqIlm7L9YRAuucHIleKaTQCeUrXP0Wnyp2nmBxzeDiVOPsap6l6MYLHO4xg8HBAK3J1dgvBpIjcYDKZexJV5mf8c0hpw5ODKTwdkKCeeTezcPXh/9nI/FlRcIYy8sH3nKCQ0EEucVi+uinLNXGTmZXSuB5jYC2k1R6X8FYDLSs7G3qg+Wa30/SZZVsN+vbIWPDRqs9HMz/V2eXRrxClGwzMRZTnpwuqrD1GTjLUluOf9uPygJGxe+/EB6Ak5UCCsCWe2GLD5iZX8ywqGyaP9CGKOOsQ504tSVjAMPPpKo7Ex8LT3xYdh4QReijfasLvMKd8/bu689y+WY+S8IO9LXV7KYzmOOycnb7imsjeiBPCZgNd2Hd2fLIQOaLorPkKjFZcGRaNO6lp+pBPTMvw9QIbYuQZBlhu48VmV3i/3Y0m71BChUWR3cdNSS4D96YC5J0Y7ZFqMHBW6G9p9pf1EMvsoq2dzX2wSvNYXqdP47zyePLrk+nreb97cBNao7U34lHDXeFQ+HqT8XvcE26g42SyQZmHFRlH2UZ0kohpcgm7Li2wAo0IHMre/0XfRV0HtarB6og11KC3Z7/RUcqKzEPA7ZEJQgZNgBZE02MFT702HN67p516Nvqkm0Gjx83wQdQMeqxlml8LDK0V5SdTdnatEK7C+bhiQ3CLRBupVuTeGYhJY/BbrqiE1SY1vdXZ2SFuvNbcrI6ErGJV8/qH1acDEtu58Cm9IYXlR4R//8FS+sjKjiIPcuzVQ+9bV25MODrRYTzxFJYbLhp2Um/HKOncgLdKHj7tOrMZfxR6CrV1qRAGh+vD5dMMDkqvh3RtFI8M/B+95gOm4879zLjARkfVycAOqjJdoBfgWjWNsJnafTkmc7B3nIQv/Doeol9zaGW/DlpeEHHLSCVAFpPcoRFbXqIB0NIfCnsKcK8GmaNVe1S1WmDjR9kV2WjYdDpu3d+gX3edjZ363f9jQEbUhFXtuRXOQv+gmYCubqBrqUoagUdP7xj0HIFEZg93/KZ2CrZfN9t0A6WcpUJBI5WLyoLnqf11jJxzi7XP7icTGifXh8HPdPwOvmb7A1BFcfY2H1yrgpQ9LL1WPc8f4dqfuE91BNq8DtcEql3/06rGk4gsNyWI77GnH9IKwUsAFlrpUmA3zzUPojorig8/2Cbd3TjsCKM9wxliCLyKPngKsM1KFkqM6bMFtyxYYrU2eewcxYM6RkLIzuCbt2tjjkrWkSVoIS5lGaeH9ACsgsCD8uBJTg2FG+jOXwTTSCvGIWOiSPmrIKKcqEISVvUcMWhHEeUKjXTMdtBmPl8s4WipwTYa2j7rmaa0RNf7IXAOT77NGep/q0h0KdWRo5UPERTufgAqHgtum1dZEPq6OH8ILA+nokd8MXPhCko+zgkNqNlrLQew5ugiVBI+TSaF0+Nh/0lIpsCoBQWlDacVD+Vx3x3aSXTbkp6URafBo7r4W0YMJYL0MnwFM5mzSBvH459mHAZ0yzT09dEXgjVW9/ggg2LxRO6yGo5FTpGQS5EwMSjG3crtd3U4X4CO+KX5W46TC5B/X/DpEipFhWLaE6rpYO0r44KwsS9Ge9H2dfFY3QNvXA1sWHN6WR25HgQ091u/FmxcmTXpvXerH0b5xRi1MwmGmrK4ZAT1TapoD8+smzXuW4xfFWkVDOL7zk9xNtB53A3+dJrIzc5OTB601UXSFtQkX3hWaSnhB0fIWaxp9w7vGQDYtDAeTTDigrLMhVNfLUpJcIxhrMjO0Amicb+Ubauev6gApJbByzVQRTWq047GGRSYgxukHnlk5+xWTYTi31cQQCJ9ILZRJ3tV05M1AIgNeeDW2H8IBJqkzSl9nnKSajGYOD7eMyjHHWbG4SEV8CvAH8Iew6SodPSlX4spOyb4O8XdYQ2bne98jMMolgBIbc8j1VfPhmdPcqVcmf5qMjZcC2VzGSMF9s4863hYPVGq86Huy5cmg6zBz+qDU3yje9vmEr3yJ6kZhF5z8UdlkJdjq/581O9VuCR2B3lyEAfQoUZot9HdVILawreyRxAy11JlpE3UoO/fi5/5omkUs0A7Gvb5+bsteFVIW+9l+qR2dINow47smAidv0bLLEr/yqKcUanjvixyzAQCM5CVzq0r7rDR9M7wjLxBq9eBWRVmyK9TfSJqXHjL8T3l8phqzWGZrkRC5oiPO6C5Wf59fFDP+ituUaiEqytebX0Feyu7U5Leql5gBMTdDPsmK7KUOyA5TuWxjGc7dN7kJKEYpro0VWRhjMArMIGbutu6vN2OSHb6nvd508S4Q34uCRKu96bSAD7YHASNVhzXv8N8jroYf5Y7E9s4wTpkvo3BZkkWqpF0M1vka3jjUC/JuZvw9V8avX+D9bciICl12vr/bQJxDe+TN9MQwDJwOe5HRWZKtCtH/1/2brHVDE381FF3JIILjZf20UTFL4MLwmZtFv3M88Bv1x6hEyoaAlZ5p5QEWzlw8bJBt8orARhiododtduYtJBSF7octT9JzbeKdozaif0LBWL/u9RjbeVNLZ8UV44Ye6Sz56Vn8QlwftWL01WoPryii3ZZ930Zx6Ins/HGvGQmHAD+2qvuKQAs8Y6ublb+Dvhp3Y2NNMjsuzOvb6m4YtkPzbhlctKadex8tBQuo0zhmSxfDIZm5VnEDdG2vZ6kcykYFxgAz3wrkVyXQnwxyQIeYMIHQYT+257jBWD0yJIiC3PqmohMzTC/65XVgSsowG2kgnlR7pYY18nBQ8aVfJ64D79rH2pymM4xMU1Zk/OS14XiDcldhO0c0RhQxiPSY72XYxpiaKVYmzOcEvI1PzQa7+LVZ6pBIwn8ffWvhqa38b3IskTs4RBkYs9i+i9/AqdAQg2IOeWv2fuo5tEcFyefI9nATJXQchbBEQO2Cj3kaBe2X+81o97B22kYSwjOkgZybf53qZFQ6p/N0dL/VnuL1cYTGi8k6rMpkKGx4j+Mc/fcHUVNXTKhyO10FkvHiN+qSbJGepJ/aLXoLZ8RET0Bshv/4hAQgzeS7yl0n74cedqdnmAeHmQ2CyXvMM0MWpEvA2ezZIKU+WvUSaGpTt1kvMloerqnqxHLfT01Yh2n3iD29EWnrQsyjedi1I5SUgvQKBM9G+oAai15cO1con2QFz3UK7w7ZgzM+vPmbk2QqR87fzlbdTSAhrLXzqVfLnWBA/4+5aC+0BRMZ6iX9lH3QXtKU9D01K3HprdilL456y5lsl38VQaMbz9hk0LgquziMY01Znz2WE4ClHG9cF/e7stVmn89oNFUE9NZ1RAc97KzDEWHLoKwlCG6L20/2Gj7/M6PDhsvhY+FMzYRg+v/0jo2gPT0UTCfaLBDRVvKQgUSYPMG1dr6ox7ohepBUS0msHq/V7A6Y9WfKDgSLatqTzwhOXnuXAoFc1LsdlV/Nv7XHqg5TAohZGa1mOn44SyY1fyPMCxL1QmxvhBC7mxDyj9DUnBpbjdAzrBW0mUzZ51brDVW3f0A8oKL6FYBf0mwK6YxDMJogq94OPgpZyKHKBYvJXMfs6u0pYnEn/jPeTVQMK6uY9Egww5setjqwdQmwi1ea0/uoNw7QKPorCWZohFt4VB+HUy/ObjCDdxryIg/y0wXGMwFyftSyf0v/ESOVaUNOHg1aA0SQ0KOwx/oqBneMvSoxZc7SqvQaHcx3ZLg7I0FQgQ9799KuVGTfGNgWvzIMnHqMNnCyCLJMNoNQK9XA4Wkq+6tVuCUREehKj+szE6KlaSwgAPfb6JeGqIyBrjJK/wNw2yPaYB9wHia3A56M5r4OplAvdVjO1vrsc4I8LAy1zqqpo0yM1hfixHeLNDG6ufXaX/4mWxYpqL3hBHpPbnox49P3jj/wGgdZFaJe1JTer036xd0Xak5qCI6SV86xqAdAChv6sj7ESw0SU7w0leCi/08lfYfucRQHdzjO3JkA7lvHw0ouMCSCweP+ms5HlStT1HLlgQ/pkLQ0HiDkuoPtTY6fDW0UPlH3ebKJKJsiIlEwAnWQ1ExfQhfs1IRdbEO6sgyC7u2YqSye9WFoH3s0+d4P2X78UPcUsRitbiSflMds3+5ixk47wEAbwHOouv3l0AUb9zZIP32hh+8n3fJx3LXT4wqErJXRmufydvyJuKW5IkA+rD7B5y3hJGUFrf+je8x2WEZ93MMZZjKF3R4hY4E82J7y0z9znWEXqtnGce0dejOBkrf6CbP1VCh4ixhRvmOXO9yA0A2XQqeWYNfk1eUkRWlybRDBiE5SOOtjudxOpqC6Hv0XRqdL58/dsrEItVoppvb13l9MrZRKzOe/vtw9JP9aAkOa7ra6MbT/3YE4LlEJ5ticKWKe+rOGibg+N20Vx6Vg7J3byZG9+hIpULnZWH4Tq3LmlMA+oUfgAbbzPl3twbDuQozSElI95KSsXaBWevUxIWPQdY+4eolMlTtLwn+51SP6BWFEiioYy+r2Rza4OqKJPMbx7t0CZCtpMKxYQ5JCowbAH7J4Y3Eh3C04j1H/2a7qH3cVo01mg0KjVVR59qENmLLCnQ4LNMS3i2XshEK7QAIvi4D+egZPpMUywog3s+tqRiaGXIEMFp3rd3TuvLXVT9tpJGxjgQLGMKXmGL1MVjoN97by2NaOn0JoIbOQqeBIHTVbBYNON5DD3XP+rStPIfVbuHd+90TJpGh8BlfV0dLneK2wDMnndVGVvQLhvaQxu6sL3XsvtxmQzeFWUSHLeAlmTc9yNQKkXtOJWS9faewS8yotiXdJQ6EI1vpVOHgh46gljSllVDRx9qlH7i2QFU/dKpaQEbpAFUBI/eSUGbpgT2ORGcUGXXDWjQJQo+nCkQVnIMRUCP367os5Iw4Rb3LDvOi+/mwcBozzUa4WkjVcSIURKO3RTFCiY9j3O6C5MBS6Y0WbBooC0nOzhKxL8xMIIaM/tnyEzIdlABrz3f9XlCiQ0hh+C7/bNp14eUvnjcHWjBOSw8E7BjzeXkRQkpIuZSOriwZ8PiOLZxCkXFOQ4hbXa4Tu69lccJ9Hd0F1lxkg5QnAhhfx5WdcTkBH3SibBUMCLPb/cYypz6s4GGDMV5smYibldp//j9gbCEhqanpxLsoexOMik4SOt879z21iz+8V3wgG8CicQsmxcsqCc5QUqOZhnpO4qAFgzHF+noxN835P4xf5EsOcPvYWwtzK3WEYVGy5tuvxE5WZB246SGIDgeC4sMge0B4p70Tse4b6NjlPHW+90GmqnySqY83r0ilaew46qmwi4RzmOcPehbn4YPCoISjQ44RURV++dfU53vcKhkSj6cWuh75tdSSUNMysFwoP+lN2gGTwxOfrha9wWxDPpimhEBVrt6dcBIvdoUbCLTDQDZuUOVVhZP4sATqq8z7Ai0STnGxzKmAHG+3I+/tvrDN/OOTHwR6W5aWSRj+M5wmS5hfdvimlus2z4pE6RV+l6scSEX3XjFUVgbSuuufln4qZfmgBxNvIZmkPtMh4WHAtuqRVdgDOLksqdhjqc9jrNVpRsYL4L5fXaKhNXYNJfTorxbaoSpoqj6ZEp05xsc4y4Qryx7BRs3iYvuHRbCUsiCPmmGdUPXDn6H7woEjiz1YeriH6NPF5au5aVrtcw0DvEgLLKMuVq6QvzE1mu+x9AFhhIEE3jVvzGWs7x+IBGJ2hfG8Kb57q5sDsPmddrc0s2doavGt3j59SpKkbETAVxcSwwHbpAEsYTNPM1KhVl7EPpQp+gNotyPx7hI11xG47CrYE7+4xlCFpaDwvf9FWescjE9qNrcgCXvSeme0GAOo6QjsttWQcRguwWZb6OG1VPN2xZcfyUeEGLHhPkrziDDf4SHNaCcXXJ9CtFdyRMVueZNWqaoSKhpFI91MMLSXju3pGbSzJlM8FPf/oxZbRADvlZZCyb8fbb4mQVBZZ3GWV4hj4PCrLA1qQvEqs9XLsRnoal9WaSQhWRzLJmCurnGGRc6wxyAAejp0pAR70k0M8R+ziXphTbSz5jU2xp2cFe1EhegrqPqjFAtYWbYwsm9X969oYf76RSVpD5DfI8iDfFILBkfvnZaZtHikQ2tfNY1T0QOYafZ+dfiQjWZxqrDxXDWbc/jYZSbOzpgJ0HvC9wodOgTk5d5d9dmNrnM0LH8bvtI4zgktUZdf/DkYM10EF8yMhbFqvpMTi+TaLBUNd9aLSzSGAqu41xsKxsEYHFPhxozYZMPCafc4U5t8Ja7k34czb9pTsN2JFnwl8AmZSpI39KzBoEcD8fz0CAcio2KlaDIhPF8V0HkEbwc2c0mkpBazhOMI1d4cxnKG15nlJ+haP4D9g/H1z7jIEHS7enL9st+r19iJpqLFuJiKD2NT7LXyBzaAcFxIJ/fo4roeZSvHUyfgqUjSVcPiszEAuk4Fgqjxih+ln6TZW8b5sbDIvrB1Ul++c1B63XbFgHdVJTaRPzIXeh5f5u+QYvfa7pHyQV0ZUIv4SnfFMvTC0g0/fdaaBd9rcpxu/CBpbobKZgCIyVRDZGdPlZs8UGyu7+Hxb64E/k0YIIyG0d7ZSIcU1dOwyAQt25Ow5B4W/oUhgU+Gf+qB/Eqf+V11+GylEkiyGag2sSabnAwgaqTr549u7USX8FH6EnKLv1g9jl2zIU7C6GM3aeDn8kP+9aBM0Agrl165RV4/UHaXPnrBjs3YOHlrMK9jziNkwwt6+rC5FPPvSm2uVuOQouD4+Rk/8X2VoT+8bijB9PNpfsOsNhiSOVgntu7dzfzJItraFExs2ylPt0vanTgZJP3SIxPvZsgaDSBNmxIh0KPLS+EZkJ1Xy0gY8WVOZDbYF9v0GJta6+GUy7ek8lisYumJ1nyw90NF5n7L6H1aFMYqA/WI2COJA7pWaf9Ugf5pniETIJNyNXtonwZOLeCG380p2a2m5Fs4WDJIbVCtkJ77ah+h3HMvJJ0fzW8OXfnZDuzbWB935lP5zr2+vOc7CL44LjNt8p2deJJKd+d8n1mwKwxWxUjkxJRVlpIqwq1a+Sfeu1oNGDaOXyS/LVoiWAi4/RFFK77j8sVBWyTeqc13DCYWKdEbHTgEcIdtBewm3fvU99V8J4gYLJijdis2O/D+3FBz8kG/SwAXwjzKgO1TmXuA3syLPxxfnEUxttkUPpzQJgAzcN6o79tpHr3QWX3TVy4USKZJPX/G7/sFv7TB2RKaM9LvG8518UTl/oNK6/mqMpSOqsv0xRVzNjumgamqz/e3LG3e1lkrW5SquqlrDJIrN90AProjO2hsva2vAv1ZNPbHVfvH6K8KnMmDbXcZImS+YAXafdXLVILS/Q0MSKuRaLPQABT6AsH1SpBlkiSLXyhT/gT5IbfD6Z1Jx0n7l33o2uGW4lgd8BRn8WUeEHBHEn2SCXVQwlREQtvN7iSC2y8qSngF4ytc3vgOucrGccauebyUn9sdKmkhMom+XHRGLg4yr7NW/ZAq8UDCTjimw0unj204NYoihtZTNdXwgmCpqzA6Y4a3S/braI7FEXELgpjVSnB+dqkyFq3Tny2G8lAz1OtN0TZdE3wgbqL8XtsE5Ut1NayTqmPNmEhJVC0f6ZfMop0HP5VawTxA+lq1XoeRAoIGH0ojuV+9O13sh2V2zoxj5jVyNGuZDtqZVlEeSIRI05PVi7nZfKw+EuT5YTkdX/qnx/AmQXABJR8mEbt5A8Oab2RqMdG+P0zvDI0gODnGDSO2w4ZOrD1zi5LnYaIljibbOMhpDWcwsd6Ry5eUmiLQ24OpaErO6a3/sYLybm9xOJLqfn7DNg/5SKBxEfKNyyUYP4KtkSMQI5Xo7dHcIhqH4l3CRK/gB7WtFU6bj0mReNJIitL8grYbUyZpqDuMDT5s5WQsWjOEmRSbMiH7HIkEIPvRu0WxMnRCJKjGFWdlKGqK96T7jlsEHCjsPjk/9VEQ4W5qB2tRAFGJ5YGgbmyYxqxGxduvkNdd3IZKcIbvtEtH4X7aHeyV4Dcn4wkEzUNRRhISM51Av5I1mwi2lj3DP8d6K9iFzNVDCSb+eb9pBu+SEqYrvFC8WKSi8OcZDj50KV871120hgz6n6OZy1KOh8OzKNuCKFt9mVlUfJKzD9gcuL53q+oTHGGIKFz4+4/zLC13N3l3y4Fn9dzM02uGyBGoJXmF3jrwW9OguOsh1FVykE1suM6kC/e005VRngkgcn29tixbfGSx7k8JzTId+5wTXE1HgKXCtGlwA7L6FxS+RUGGP2az1Em91D7THACjjqlVdoDOltQ7Yb4S8n4kG/m/CvtFfQB0e/e/JMgICLGKds6v5THENB7WYOdJ0P5s3GQzdbeXjUAG5Y2WCUBs5LZ6xDZzv1L7jfUHqBbmnHW7U4g+UTYB/tW7B0Ya0JAbpzWFSoVQH6CbY6q9fM8ccelwWdxeWdjZm+TcmBAHpje+emw8T5mUgl7Omvks7D2xk04/HjynzVyBN2dI3dBgxTkB1keL9tMN0WgyjY0ddKI8pigHP9lOa8hb7F2bZIa/FqS6JJPPHnlyPbVl+weIG7j4ocmWH/OkvaT4qtcbnafk2ocwOkjSqUob66ehit1UDMwKXreD2R92MZugTHNe/PWAZesANg9eBbm2p+4kqK52j8MW3AhqaffDN+kK195DUM4FLVYm8BQhOF+OWoM5tTD8LImCNRenutbU6qRxpaMDXCBU37/K3Y7eobcg/IaZaBuw44FteI67Hdgufk5VqCDjlK7jDBUtVq07hpPI9ymWW/m3nNLQlusNGDSBNYXOUBDRWNnHira/1eo9GEwVgpXn2tG1PUUxT15p/fbfGXCvpsj0QlzwErC0ge/Oqlsh7E0QhpqDAcvlBJOiXDD/bv01SkM269rmghWHJPUbmpq4trj7H6cCMXMIwWgOLaTXR0w3tamzJpReC8FXDNwkxSCbmg/ag17JdPyptz7mR3k6KvXor6tFCfEv85TW7CDWLEap1AC12Ym+LK9/CxdKPnXz9Qz4xNXGn3sG1wAfthifQfjDyiCnLo2uhuMzI9yKxH4PUTt52mReMLmnHFrrLpDYcPC+cU7ge55guYhGv/ANB92YzoXrI+Hs6gdXnnfE8GGhfydGwvKBKCtpDecGnu41Mz28j9/LTVtSV9WZEoxANMgPGo4BDbY2p69ixYGQWATdyg9TRDAK7f/Lrlubat60yuVZ9wcwqZ7NBP71mX6NEgdvfK1EgMnkZzsDQl/wWDHdAoOYCo4pKwY5I/V26cKTO4aMYcV/YDdgglOtas2KtIXBJAcgotsV4YfF+CDN4T5WdX808VdXh3/UXLrAdcMDF3QIXj1HyUHIOkXBH7DXICbJt9eNiowRXiuB0d1J/FqjPFe2IlNdXnwFwpRusB5PLSv0Lk/AdI1gQmao8wwLmnoh/L9riMbMMsWAOI+5B71d+lGTKlxx4hQn4ixRfedyZUUsRcpGrgAS1XqCKzggl0/LFuyQpe9BsgvZGkEHQ4ELkl6bcLtiHZ+7uFxmRjnV7v8PP1Whug1igIT3OTMnmb/dGJPuGKY5fRdvWoatxfNU3ABi+fY7eHiPqC0gQDpAC19twVfWBtBur+ST+y7fzmSE5Q0C3mcp8/31XIdqm7sEZJHtFnXBgaTyG+fWRGAY70K10IBvKH2TE6IMzm1k92/Cn2payTupKTtojgP3uaWIgFVgV0lD0WGR0PanqiKtrBFwqznvb/rz2PgpSjWd2BESLQpxY+6tmKXZnjvY9xfR12CQ8o/aKz1t+XxCSzy0uE5f/kaFUCrwxjL8gT7SEUJshp//5/yvPFJHgJlgsvXp+gRQCSzz+vS6rl3BhMsbj/HzwJYz8GsWppOQDGVswlOHEaFE/qhImhDrt2DUfNxtt21GW7KwJRn9/mtYIjlnnwgESPEpwoLyTru3SsVGzRxnZG6x+BiseUs57lTdb3H8KG7UPeH1SSjy9wZHELnar9x5cOtOR7lOvyjWm4Ab18Q+qoMxxLCFit0V8SmOu7AU8XGY3eSXb6Ly+kaQmDkRlOstgmcj+rD34KNz7LTvLL0O1Z9J/nCjp+1flOFgtbd7Yg0t5eNrPuppxYxJfSpnJRNL4S3YTffnV+x+zVsuioseET/On2wNi/TnL2rAQIKswi7Er3Sv48D/+PLsa2WJOSk6DqcCLmusILDiz0FwKEhMewrxtNyM2IAE0/6hiopIQoUgC6U8CLirhWbfVibSnCGZlF5uywIcaUlcEaYP/evokbi1NSquO62XNnWR4+fB3M1N7LaI5pwdHYOKEjg9OaSiTtEDypKGOVxZhdQS0jEvZ46foNS4SBpwZfPn60p6pQldNUmimhWeU5LUnEpZYjPJU6hmAsh4AKaLFfJANrZ9ou428yoEIFuiY9UgOYkqtSUocWxyijxK+NTtuDdbh7NJcyLIl6CUBWQjZiL34Bk0Qe3vmT9tpIKus3r5CvEdEu5Va2Wxm8CQJT9bESzuFBeH0QIRybKFAUVqNa9tCXukd1jwLXYKWsuMuFda8R1UjVG2cvAZ+R3lBV+nLksL4Ti6lubX3hKFcSyFsG5rK9pJt5nlSGIkBLP/HFqLL/KX0S96NdOo4CS+GYPBk+lBZxz6Yie12vvUj8l4t1ik/5PmvbLOTPCcaoPeZ7APUQIKIcxcNUDin3R1okbeAUGwt7Ja3G0ntQokBhlajisyXeqbfPLrTTKpTauclKp+DGdyBsbzFHEYtIqZnlLe5wjluF/UID6EgwWPGj0FVKM59Jom3+0Y1QTb+IKqHZv/0FIEEuVItlJHSixdza2w0UN80Hyc/eUGv6SBybC/EEs9cOcLBR1eeQXXe7p7hfIhtxxBrGhk9n7jom/4LXF125WzPmMCUiNyE8iO7sVSmRf/iSNFBveZWGPeCirfJ8a43fk5jCfA3NPEJyMAamu3Q5im0DKo8aonWXtye9iE8vraixlVTAGSXFMjP3+XiOE9jrnXTDzARnt7+9gvHctQpaAI0za6N7bq9R1lb55jILwmx4Ih4OA0K1/Xx7B9jytPFBRhEO8xqXLhxotsIRjnGRvnkMK/KJ1YhE9T2mNmclLYgMSn+7dzik8BzoHt+EcXstV8yNpTspqsnS96ATq3A66NbF449w9JqViBt4gWi7yVzt3kR4XSJ8iEB5anMqG+EsSyrMQVv0sMeEysGx+yYs6G2xPJw3zqTq4RzDQXPhYra/VMlt7E8zzl4D7L3HS3kkWf4ZkmFmnjcENPQdkmohl6p/gqkOg+8McyzNxxb5Fl19DsSr3MTuSMqhSKDn95ibzYCEdrZXJiKaqu7BFBuju+jSObOPchog2IsE/u/3U/UK2mntvSnD0qNkPYoRTskBnLJ3NJamL0V4sEbryX8NMr7MKMJ0+h2+xMKY4KERpvUrd0c6ABXWHqLdY1QTugC/5dhdoLy3+KwgG5FnL0MZw6qvOvHkKQRoQrcKLuwUld15s05QxurH67A9eAr02a/vUWNBIgP6vOa69ZZuZKElWttIerRDGIAkZ54fw7HBctSZtfspPxaliwbOEH/Laxot3ZQonzvXknSVodzZHA1Jw7BcNRsYvl+KJ0Y6pMRPpIbaN/QSuHtnjUoej+vlVhq5021xMUPKxCK/D8rSRbOmduHG85/JrIimgo5wXWP83lLvRaxwCxeTGVt44fTUqsfUARmQcS3f5DbHR9SZ4nJYIEvcCjIqLezJ3I6S7xBop57j3ZyMQX0Xxr5mc6IUmrlOXM9fJG5iDZQQ9rWsGZ0Y26GzTAEsD6pjPuDa1XAT1MRpxyZ8zN53sl1YEV0E0EHvZqcnBnqMTXRh6zC9PwDXEk3OHs2zLLIjBhY5+7lDxp1X0qcm8XtWorat33mUx+kEDDgaDUdpclQq/ZM6mMYoF433nKbCKDxCozugSPVaRjNPosMDy8FujvIJSb763XuBGBIYLS9x+HZhYiUa9xod0xKV9aRt7yczWWlLgfK8qn4fULHMBSP48m/wTWfDBdTH8uDAKt5WM033+2bCpxDhmZtE+d7XP65yBTOf9/EWaCG+Gs9/5kVbWS0JlfoDH6Si2tVCzCRGfV0XZAUWfXOMJ5F9dkMagbwaeqVqqbVONDQGg8zID5MUV7IkazdAz4JLOXsn1RuZnoZNIGV2Na15+dRKYUAmXFmkWBJpPMBwT8N4bd8VZwBnhm3WzH9S0sbpoP0sgf2OmPvQ6smMyfkVK+OLjXYubmtioAhdwDb5/pLRg3PGwfHEz6v9OOe4AK8iw2cma49tV44In8Rc9jGcqSQlFXPdlC8366ke4U/ITFy0/SQBl1vWvGk40KycwWGaLf8cCtEi/4X2W8961i6lYnpfNQhGcQyC8s2oIOW+Pw545Thq3ZBEyNC8YDr/pzCEmBI8U3A4IiQJoHiD9kUMNd8wfzysC2Kqc4OGeWYsJxmDev4Jn4HV+vqpgN6xxSEMABhRMdTteHiJAgnQEX9BR2V1sNqh5EcMvQNYYa5+bblQn7Rli1UFCtQkP6ECmGkxmPNkg2CGS2mmf0/WEuTZSyPMtbbrnftPgleOmJ3jSm0m1EU9fQHQo1NZti+KczpJ8mSYIVtXzXh4rNJcL3Fm7Bbftpjmj5UnuDpPk8HvqKOj2DGJyk4R0Md1x7umiH0DTOXaLwO0EI94k7n6R8nfqiwekgUQZ1rRek0HViM5YN0JLWp4f4NRE8ErcGNSHZd58+9Kx8lmkc9ogfQmX0rX1kB8QQzNbH+eVDee0jOQNUgQcew3y+0QbifXrtLHXDIxsqsej41Kz7vfcQRE1zUnY2phYNILK8a657zyHNMzPiRhxs28s1JX2kiCMEloubOXnc8BzU+n7LM9wztf63eFWN/eWHXVivSdCWg5DfWsk2CF8aFJrOP277QEPdkWlOlewCVEkLjyd5wUn9ZzaKOJKnDQDLfliiRLTKlU8TOeQj8jOU8FfpM9tayJTDpxw6sVlZuJRAILfxn+QAGIB/W1FGDjuuVu62hFDBdvzVSfge95Ebf9pclp0GrpV3S+gwBWn5J7aGiim/fRyIN7YVVXJsnAnVeq90vDdAV0XearTqjT2Ck/AMkBW6T/ls/6VUVnFWs01wxkahKR0tRwyLRKgHefm3RWie/pTVQpUMZw+/7ozQSW+7vuZd8lsvT1iX5rwlpiaFnOnDbHsr1As6vLETd5HVbcBCGbJHcS7ax9Byd50jdYyagUtjAaHYX8ryyuR/bDkw1o4j8+hXMfbzy+CVmgrfRDyl4dn+5LxrqRAXLoDKpQREAHqdLSsVSJh1s8KnZ/SsUVq27cq+O6LMSBmhT4X3E750rmWwCsoCre6bT//oFWYALjp2SbcxnULBaTvnYDHtfEbO1m/3c9nJk8ZO5KHQTV88ivTWN/S2EXwmisTPdcupMrvI8e48QZdkZu9WHyKron7MKhGFJw6Z0KZ3tleVrvvJo89siUwByPY+Hs4gkKPBQbLQOaedcv/xeM+Ih8rl1eHEC/C65xWVciToVqSGp9HfbhVzFSrO6kBnv7mJwnRLvMEwqiNankVdJJMw4icU3lKyw/ecNSWIUddqlbThYMiq8nHjRRufs+28cq0OI9zhpvxFvFgSZE/eAYvm0x+9lZO+EH9NkBngaqU1NMYhdombNuy3awUN9p0mJQ//e9L65YbShgoc+ZUlNy+c6F6gDEHXV0JrzevPIZFAe2RyRa2dNqzLvihAAMCszYueqszzXRkSyobx5+LTLK2V3lfg3wbS9DzP3QW7VHdHbjZcttQRvtjrGveJnNn2DE2ZDIbvkCrT0H8RzbGDdmIq4P1ey+hoY/W6NuZKOz4dv4HUNznxdKV1Wf3MvqUv35r2jTKvpPWBUWNm5fytX/QJwp6qkIOsSx7Y67BSCbCDVLM8/VcMG+T0j+INrgL9sfT1ICtACH8BI0G6ViUZPVzzCmQHW2oVIwZjAoFl6+meO/pD8teO1E+1y03mCpYfW9S8qhtH2GhlFlebPf4NbezVv9xbXKWz0xezRNQWqUqtYRTUbuzK7KTvjG4rQHfzBpVmK4wDLnSIwdSzTSk1fPNeY0WOpPZTLlvQ59xwgfFrb326vT2hS1JAZ9E6sujFtKTiJ7bxI6o4cBhDaX+adXREThhR+MwA4TqD7rga/o9iY7d6TVRe14CS2S3iSQsD0R6ApnhG/2Wa0A0AY2NtWTjmabdKU+KgIRDP9RQYVjXiF1qC+xyNVG03I9vpmEpY/G/zC4nLOKgXAZ/uTikHI9Afbkhfgfgo9arWbix5eH7WUo9RQygDzwCnVSjbXc7MihEufVj6WGbK963pw8VjY3RS8IH1cy2yZbIcKLO5CgAUcXJfF2+McnDLKtXxyZaf7SPA6KJq+zF2NHyfoeTOwHhGqNcnHVr1hT73pcoyXyfvCYBnG1Bp/aR9t8hoI7CXM3UZOisWGA1SHZ2jf7k9GlRnp3mF/c1AV+JjvUsnZrsybEOQJg/dn/9eJkyykQHjbF56zgcPX6DdMG03WKUMlYz+uOZ+5DZy9E9MZOZ9GMoLFdrIPPQQLjv+GlCMpoyHPXkzIODjHAID2PrnaRpqWVHh0rnieDILKq+Emrd5RnjgE9pDUXWTmHaKuqqYlcgEz4zbi46dbWrAAFBjsQq1rLHIiPJEcwFLCOY4JNlXRXQJqCUKXk2d1RSBGzDP6HDSpo863BhVRFFF6uIpjQV7j5ebFe3UkkO/+coIo2BTAcgBqOtQ134s9a4QJvofuqBYMGOBMsWZ+sn/2AOxDx6SfAnDFGw==";const yye=Uint8Array.from(atob(Nj),n=>n.charCodeAt(0));function kj(n,e,t){if(e.getQueryParameter(n,e.QUERY_RESULT_AVAILABLE)){const s=e.getQueryParameter(n,e.QUERY_RESULT)/1e6;t.lastTime=s}else setTimeout(()=>{kj(n,e,t)},1)}class vye extends _i{constructor(e,t,i=512,r=512){super(),this.width=i,this.height=r,this.clear=!0,this.camera=t,this.scene=e,this.autosetGamma=!0,this.configuration=new Proxy({aoSamples:16,aoRadius:5,denoiseSamples:8,denoiseRadius:12,distanceFalloff:1,intensity:5,denoiseIterations:2,renderMode:0,color:new Ke(0,0,0),gammaCorrection:!0,logarithmicDepthBuffer:!1,screenSpaceRadius:!1,halfRes:!1,depthAwareUpsampling:!0},{set:(s,o,a)=>{const l=s[o];return s[o]=a,o==="aoSamples"&&l!==a&&this.configureAOPass(this.configuration.logarithmicDepthBuffer),o==="denoiseSamples"&&l!==a&&this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),o==="halfRes"&&l!==a&&(this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureHalfResTargets(),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.setSize(this.width,this.height)),o==="depthAwareUpsampling"&&l!==a&&this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),o==="gammaCorrection"&&(this.autosetGamma=!1),!0}}),this.samples=[],this.samplesR=[],this.samplesDenoise=[],this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.configureSampleDependentPasses(),this.configureHalfResTargets(),this.copyQuad=new xm(new Nt({uniforms:{tDiffuse:{value:null}},vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }
            `,fragmentShader:`
            uniform sampler2D tDiffuse;
            varying vec2 vUv;
            void main() {
                gl_FragColor = texture2D(tDiffuse, vUv);
            }
            `})),this.writeTargetInternal=new Qt(this.width,this.height,{minFilter:ut,magFilter:ut,depthBuffer:!1}),this.readTargetInternal=new Qt(this.width,this.height,{minFilter:ut,magFilter:ut,depthBuffer:!1}),this.bluenoise=new pc(yye,128,128),this.bluenoise.colorSpace=EO,this.bluenoise.wrapS=ds,this.bluenoise.wrapT=ds,this.bluenoise.minFilter=Zt,this.bluenoise.magFilter=Zt,this.bluenoise.needsUpdate=!0,this.lastTime=0,this.needsDepthTexture=!0,this._r=new pe,this._c=new Ke}configureHalfResTargets(){this.configuration.halfRes?(this.depthDownsampleTarget=new k_(this.width/2,this.height/2,2),this.depthDownsampleTarget.texture[0].format=Rw,this.depthDownsampleTarget.texture[0].type=Hn,this.depthDownsampleTarget.texture[0].minFilter=Zt,this.depthDownsampleTarget.texture[0].magFilter=Zt,this.depthDownsampleTarget.texture[0].depthBuffer=!1,this.depthDownsampleTarget.texture[1].format=Yn,this.depthDownsampleTarget.texture[1].type=Pi,this.depthDownsampleTarget.texture[1].minFilter=Zt,this.depthDownsampleTarget.texture[1].magFilter=Zt,this.depthDownsampleTarget.texture[1].depthBuffer=!1,this.depthDownsampleQuad=new xm(new Nt(mye))):(this.depthDownsampleTarget&&(this.depthDownsampleTarget.dispose(),this.depthDownsampleTarget=null),this.depthDownsampleQuad&&(this.depthDownsampleQuad.dispose(),this.depthDownsampleQuad=null))}configureSampleDependentPasses(){this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer)}configureAOPass(e=!1){this.samples=this.generateHemisphereSamples(this.configuration.aoSamples),this.samplesR=this.generateHemisphereSamplesR(this.configuration.aoSamples);const t={...Aye};t.fragmentShader=t.fragmentShader.replace("16",this.configuration.aoSamples).replace("16.0",this.configuration.aoSamples+".0"),e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.configuration.halfRes&&(t.fragmentShader=`#define HALFRES
`+t.fragmentShader),this.effectShaderQuad?(this.effectShaderQuad.material.dispose(),this.effectShaderQuad.material=new Nt(t)):this.effectShaderQuad=new xm(new Nt(t))}configureDenoisePass(e=!1){this.samplesDenoise=this.generateDenoiseSamples(this.configuration.denoiseSamples,11);const t={...pye};t.fragmentShader=t.fragmentShader.replace("16",this.configuration.denoiseSamples),e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.poissonBlurQuad?(this.poissonBlurQuad.material.dispose(),this.poissonBlurQuad.material=new Nt(t)):this.poissonBlurQuad=new xm(new Nt(t))}configureEffectCompositer(e=!1){const t={...Cye};e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.configuration.halfRes&&this.configuration.depthAwareUpsampling&&(t.fragmentShader=`#define HALFRES
`+t.fragmentShader),this.effectCompositerQuad?(this.effectCompositerQuad.material.dispose(),this.effectCompositerQuad.material=new Nt(t)):this.effectCompositerQuad=new xm(new Nt(t))}generateHemisphereSamples(e){const t=[];for(let i=0;i<e;i++){const r=2.399963*i,s=Math.sqrt(i+.5)/Math.sqrt(e),o=s*Math.cos(r),a=s*Math.sin(r),l=Math.sqrt(1-(o*o+a*a));t.push(new D(o,a,l))}return t}generateHemisphereSamplesR(e){let t=[];for(let i=0;i<e;i++)t.push((i+1)/e);return t}generateDenoiseSamples(e,t){const i=2*Math.PI*t/e,r=1/e,s=r,o=[];let a=r,l=0;for(let c=0;c<e;c++)o.push(new pe(Math.cos(l),Math.sin(l)).multiplyScalar(Math.pow(a,.75))),a+=s,l+=i;return o}setSize(e,t){this.width=e,this.height=t;const i=this.configuration.halfRes?.5:1;this.writeTargetInternal.setSize(e*i,t*i),this.readTargetInternal.setSize(e*i,t*i),this.configuration.halfRes&&this.depthDownsampleTarget.setSize(e*i,t*i)}setDepthTexture(e){this.depthTexture=e}render(e,t,i){const r=e.xr.enabled;e.xr.enabled=!1,e.capabilities.logarithmicDepthBuffer!==this.configuration.logarithmicDepthBuffer&&(this.configuration.logarithmicDepthBuffer=e.capabilities.logarithmicDepthBuffer,this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer));let s,o,a;this.debugMode&&(s=e.getContext(),o=s.getExtension("EXT_disjoint_timer_query_webgl2"),o===null&&(console.error("EXT_disjoint_timer_query_webgl2 not available, disabling debug mode."),this.debugMode=!1)),this.debugMode&&(a=s.createQuery(),s.beginQuery(o.TIME_ELAPSED_EXT,a)),this.camera.updateMatrixWorld(),this._r.set(this.width,this.height);let l=this.configuration.aoRadius;this.configuration.halfRes&&this.configuration.screenSpaceRadius&&(l*=.5),this.configuration.halfRes&&(e.setRenderTarget(this.depthDownsampleTarget),this.depthDownsampleQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.depthDownsampleQuad.material.uniforms.resolution.value=this._r,this.depthDownsampleQuad.material.uniforms.near.value=this.camera.near,this.depthDownsampleQuad.material.uniforms.far.value=this.camera.far,this.depthDownsampleQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.depthDownsampleQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.depthDownsampleQuad.material.uniforms.logDepth.value=this.configuration.logarithmicDepthBuffer,this.depthDownsampleQuad.render(e)),this.effectShaderQuad.material.uniforms.sceneDiffuse.value=t.texture,this.effectShaderQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.depthTexture,this.effectShaderQuad.material.uniforms.sceneNormal.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[1]:null,this.effectShaderQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.effectShaderQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.effectShaderQuad.material.uniforms.projViewMat.value=this.camera.projectionMatrix.clone().multiply(this.camera.matrixWorldInverse.clone()),this.effectShaderQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectShaderQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectShaderQuad.material.uniforms.cameraPos.value=this.camera.position,this.effectShaderQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.effectShaderQuad.material.uniforms.time.value=performance.now()/1e3,this.effectShaderQuad.material.uniforms.samples.value=this.samples,this.effectShaderQuad.material.uniforms.samplesR.value=this.samplesR,this.effectShaderQuad.material.uniforms.bluenoise.value=this.bluenoise,this.effectShaderQuad.material.uniforms.radius.value=l,this.effectShaderQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectShaderQuad.material.uniforms.near.value=this.camera.near,this.effectShaderQuad.material.uniforms.far.value=this.camera.far,this.effectShaderQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectShaderQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectShaderQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,e.setRenderTarget(this.writeTargetInternal),this.effectShaderQuad.render(e);for(let c=0;c<this.configuration.denoiseIterations;c++)[this.writeTargetInternal,this.readTargetInternal]=[this.readTargetInternal,this.writeTargetInternal],this.poissonBlurQuad.material.uniforms.tDiffuse.value=this.readTargetInternal.texture,this.poissonBlurQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.depthTexture,this.poissonBlurQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.poissonBlurQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.poissonBlurQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.poissonBlurQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.poissonBlurQuad.material.uniforms.cameraPos.value=this.camera.position,this.poissonBlurQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.poissonBlurQuad.material.uniforms.time.value=performance.now()/1e3,this.poissonBlurQuad.material.uniforms.blueNoise.value=this.bluenoise,this.poissonBlurQuad.material.uniforms.radius.value=this.configuration.denoiseRadius*(this.configuration.halfRes?.5:1),this.poissonBlurQuad.material.uniforms.worldRadius.value=l,this.poissonBlurQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.poissonBlurQuad.material.uniforms.index.value=c,this.poissonBlurQuad.material.uniforms.poissonDisk.value=this.samplesDenoise,this.poissonBlurQuad.material.uniforms.near.value=this.camera.near,this.poissonBlurQuad.material.uniforms.far.value=this.camera.far,this.poissonBlurQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.poissonBlurQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,e.setRenderTarget(this.writeTargetInternal),this.poissonBlurQuad.render(e);this.effectCompositerQuad.material.uniforms.sceneDiffuse.value=t.texture,this.effectCompositerQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.effectCompositerQuad.material.uniforms.near.value=this.camera.near,this.effectCompositerQuad.material.uniforms.far.value=this.camera.far,this.effectCompositerQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectCompositerQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectCompositerQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectCompositerQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectCompositerQuad.material.uniforms.downsampledDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.depthTexture,this.effectCompositerQuad.material.uniforms.resolution.value=this._r,this.effectCompositerQuad.material.uniforms.blueNoise.value=this.bluenoise,this.effectCompositerQuad.material.uniforms.intensity.value=this.configuration.intensity,this.effectCompositerQuad.material.uniforms.renderMode.value=this.configuration.renderMode,this.effectCompositerQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectCompositerQuad.material.uniforms.radius.value=l,this.effectCompositerQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectCompositerQuad.material.uniforms.gammaCorrection.value=this.autosetGamma?this.renderToScreen:this.configuration.gammaCorrection,this.effectCompositerQuad.material.uniforms.tDiffuse.value=this.writeTargetInternal.texture,this.effectCompositerQuad.material.uniforms.color.value=this._c.copy(this.configuration.color).convertSRGBToLinear(),e.setRenderTarget(this.renderToScreen?null:i),this.effectCompositerQuad.render(e),this.debugMode&&(s.endQuery(o.TIME_ELAPSED_EXT),kj(a,s,this)),e.xr.enabled=r}enableDebugMode(){this.debugMode=!0}disableDebugMode(){this.debugMode=!1}setDisplayMode(e){this.configuration.renderMode=["Combined","AO","No AO","Split","Split AO"].indexOf(e)}setQualityMode(e){e==="Performance"?(this.configuration.aoSamples=8,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Low"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Medium"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=12):e==="High"?(this.configuration.aoSamples=64,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=6):e==="Ultra"&&(this.configuration.aoSamples=64,this.configuration.denoiseSamples=16,this.configuration.denoiseRadius=6)}}Uint8Array.from(atob(Nj),n=>n.charCodeAt(0));M.forwardRef(({halfRes:n,screenSpaceRadius:e,quality:t,depthAwareUpsampling:i=!0,aoRadius:r=5,aoSamples:s=16,denoiseSamples:o=4,denoiseRadius:a=12,distanceFalloff:l=1,intensity:c=1,color:g,renderMode:u=0},d)=>{const{camera:h,scene:f}=Bt(),I=M.useMemo(()=>new vye(f,h),[]);return M.useLayoutEffect(()=>{Sh(I.configuration,{color:g,aoRadius:r,distanceFalloff:l,intensity:c,aoSamples:s,denoiseSamples:o,denoiseRadius:a,screenSpaceRadius:e,renderMode:u,halfRes:n,depthAwareUpsampling:i})},[e,g,r,l,c,s,o,a,u,n,i]),M.useLayoutEffect(()=>{t&&I.setQualityMode(t.charAt(0).toUpperCase()+t.slice(1))},[t]),We("primitive",{ref:d,object:I})});function Ig(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Lj(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}/*!
 * GSAP 3.12.0
 * https://greensock.com
 *
 * @license Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var qo={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},IC={duration:.5,overwrite:!1,delay:0},qV,ls,bi,Fa=1e8,Nn=1/Fa,lW=Math.PI*2,bye=lW/4,Bye=0,Hj=Math.sqrt,Gye=Math.cos,wye=Math.sin,mr=function(e){return typeof e=="string"},wi=function(e){return typeof e=="function"},Ug=function(e){return typeof e=="number"},$V=function(e){return typeof e>"u"},Rc=function(e){return typeof e=="object"},mo=function(e){return e!==!1},eT=function(){return typeof window<"u"},aG=function(e){return wi(e)||mr(e)},zj=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},cs=Array.isArray,cW=/(?:-?\.?\d|\.)+/gi,Xj=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,bA=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,pZ=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,Yj=/[+-]=-?[.\d]+/,Kj=/[^,'"\[\]\s]+/gi,xye=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,di,Ga,gW,tT,ia={},S2={},Dj,Pj=function(e){return(S2=yf(e,ia))&&So},nT=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},R2=function(e,t){return!t&&console.warn(e)},Uj=function(e,t){return e&&(ia[e]=t)&&S2&&(S2[e]=t)||ia},Ny=function(){return 0},Sye={suppressEvents:!0,isStart:!0,kill:!1},b1={suppressEvents:!0,kill:!1},Rye={suppressEvents:!0},iT={},ud=[],uW={},Qj,Do={},mZ={},fX=30,B1=[],rT="",sT=function(e){var t=e[0],i,r;if(Rc(t)||wi(t)||(e=[e]),!(i=(t._gsap||{}).harness)){for(r=B1.length;r--&&!B1[r].targetTest(t););i=B1[r]}for(r=e.length;r--;)e[r]&&(e[r]._gsap||(e[r]._gsap=new p8(e[r],i)))||e.splice(r,1);return e},qh=function(e){return e._gsap||sT(_a(e))[0]._gsap},Oj=function(e,t,i){return(i=e[t])&&wi(i)?e[t]():$V(i)&&e.getAttribute&&e.getAttribute(t)||i},yo=function(e,t){return(e=e.split(",")).forEach(t)||e},Mi=function(e){return Math.round(e*1e5)/1e5||0},Zr=function(e){return Math.round(e*1e7)/1e7||0},YA=function(e,t){var i=t.charAt(0),r=parseFloat(t.substr(2));return e=parseFloat(e),i==="+"?e+r:i==="-"?e-r:i==="*"?e*r:e/r},Zye=function(e,t){for(var i=t.length,r=0;e.indexOf(t[r])<0&&++r<i;);return r<i},Z2=function(){var e=ud.length,t=ud.slice(0),i,r;for(uW={},ud.length=0,i=0;i<e;i++)r=t[i],r&&r._lazy&&(r.render(r._lazy[0],r._lazy[1],!0)._lazy=0)},Jj=function(e,t,i,r){ud.length&&!ls&&Z2(),e.render(t,i,r||ls&&t<0&&(e._initted||e._startAt)),ud.length&&!ls&&Z2()},jj=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(Kj).length<2?t:mr(e)?e.trim():e},qj=function(e){return e},Xa=function(e,t){for(var i in t)i in e||(e[i]=t[i]);return e},Mye=function(e){return function(t,i){for(var r in i)r in t||r==="duration"&&e||r==="ease"||(t[r]=i[r])}},yf=function(e,t){for(var i in t)e[i]=t[i];return e},IX=function n(e,t){for(var i in t)i!=="__proto__"&&i!=="constructor"&&i!=="prototype"&&(e[i]=Rc(t[i])?n(e[i]||(e[i]={}),t[i]):t[i]);return e},M2=function(e,t){var i={},r;for(r in e)r in t||(i[r]=e[r]);return i},k0=function(e){var t=e.parent||di,i=e.keyframes?Mye(cs(e.keyframes)):Xa;if(mo(e.inherit))for(;t;)i(e,t.vars.defaults),t=t.parent||t._dp;return e},Eye=function(e,t){for(var i=e.length,r=i===t.length;r&&i--&&e[i]===t[i];);return i<0},$j=function(e,t,i,r,s){i===void 0&&(i="_first"),r===void 0&&(r="_last");var o=e[r],a;if(s)for(a=t[s];o&&o[s]>a;)o=o._prev;return o?(t._next=o._next,o._next=t):(t._next=e[i],e[i]=t),t._next?t._next._prev=t:e[r]=t,t._prev=o,t.parent=t._dp=e,t},rx=function(e,t,i,r){i===void 0&&(i="_first"),r===void 0&&(r="_last");var s=t._prev,o=t._next;s?s._next=o:e[i]===t&&(e[i]=o),o?o._prev=s:e[r]===t&&(e[r]=s),t._next=t._prev=t.parent=null},vd=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},$h=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var i=e;i;)i._dirty=1,i=i.parent;return e},Wye=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},dW=function(e,t,i,r){return e._startAt&&(ls?e._startAt.revert(b1):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,r))},Fye=function n(e){return!e||e._ts&&n(e.parent)},AX=function(e){return e._repeat?AC(e._tTime,e=e.duration()+e._rDelay)*e:0},AC=function(e,t){var i=Math.floor(e/=t);return e&&i===e?i-1:i},E2=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},sx=function(e){return e._end=Zr(e._start+(e._tDur/Math.abs(e._ts||e._rts||Nn)||0))},ox=function(e,t){var i=e._dp;return i&&i.smoothChildTiming&&e._ts&&(e._start=Zr(i._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),sx(e),i._dirty||$h(i,e)),e},e8=function(e,t){var i;if((t._time||t._initted&&!t._dur)&&(i=E2(e.rawTime(),t),(!t._dur||Fv(0,t.totalDuration(),i)-t._tTime>Nn)&&t.render(i,!0)),$h(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(i=e;i._dp;)i.rawTime()>=0&&i.totalTime(i._tTime),i=i._dp;e._zTime=-Nn}},dc=function(e,t,i,r){return t.parent&&vd(t),t._start=Zr((Ug(i)?i:i||e!==di?Ba(e,i,t):e._time)+t._delay),t._end=Zr(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),$j(e,t,"_first","_last",e._sort?"_start":0),hW(t)||(e._recent=t),r||e8(e,t),e._ts<0&&ox(e,e._tTime),e},t8=function(e,t){return(ia.ScrollTrigger||nT("scrollTrigger",t))&&ia.ScrollTrigger.create(t,e)},n8=function(e,t,i,r,s){if(aT(e,t,s),!e._initted)return 1;if(!i&&e._pt&&!ls&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&Qj!==Uo.frame)return ud.push(e),e._lazy=[s,r],1},_ye=function n(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||n(t))},hW=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},Vye=function(e,t,i,r){var s=e.ratio,o=t<0||!t&&(!e._start&&_ye(e)&&!(!e._initted&&hW(e))||(e._ts<0||e._dp._ts<0)&&!hW(e))?0:1,a=e._rDelay,l=0,c,g,u;if(a&&e._repeat&&(l=Fv(0,e._tDur,t),g=AC(l,a),e._yoyo&&g&1&&(o=1-o),g!==AC(e._tTime,a)&&(s=1-o,e.vars.repeatRefresh&&e._initted&&e.invalidate())),o!==s||ls||r||e._zTime===Nn||!t&&e._zTime){if(!e._initted&&n8(e,t,r,i,l))return;for(u=e._zTime,e._zTime=t||(i?Nn:0),i||(i=t&&!u),e.ratio=o,e._from&&(o=1-o),e._time=0,e._tTime=l,c=e._pt;c;)c.r(o,c.d),c=c._next;t<0&&dW(e,t,i,!0),e._onUpdate&&!i&&Va(e,"onUpdate"),l&&e._repeat&&!i&&e.parent&&Va(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===o&&(o&&vd(e,1),!i&&!ls&&(Va(e,o?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},Tye=function(e,t,i){var r;if(i>t)for(r=e._first;r&&r._start<=i;){if(r.data==="isPause"&&r._start>t)return r;r=r._next}else for(r=e._last;r&&r._start>=i;){if(r.data==="isPause"&&r._start<t)return r;r=r._prev}},CC=function(e,t,i,r){var s=e._repeat,o=Zr(t)||0,a=e._tTime/e._tDur;return a&&!r&&(e._time*=o/e._dur),e._dur=o,e._tDur=s?s<0?1e10:Zr(o*(s+1)+e._rDelay*s):o,a>0&&!r&&ox(e,e._tTime=e._tDur*a),e.parent&&sx(e),i||$h(e.parent,e),e},CX=function(e){return e instanceof Ts?$h(e):CC(e,e._dur)},Nye={_start:0,endTime:Ny,totalDuration:Ny},Ba=function n(e,t,i){var r=e.labels,s=e._recent||Nye,o=e.duration()>=Fa?s.endTime(!1):e._dur,a,l,c;return mr(t)&&(isNaN(t)||t in r)?(l=t.charAt(0),c=t.substr(-1)==="%",a=t.indexOf("="),l==="<"||l===">"?(a>=0&&(t=t.replace(/=/,"")),(l==="<"?s._start:s.endTime(s._repeat>=0))+(parseFloat(t.substr(1))||0)*(c?(a<0?s:i).totalDuration()/100:1)):a<0?(t in r||(r[t]=o),r[t]):(l=parseFloat(t.charAt(a-1)+t.substr(a+1)),c&&i&&(l=l/100*(cs(i)?i[0]:i).totalDuration()),a>1?n(e,t.substr(0,a-1),i)+l:o+l)):t==null?o:+t},L0=function(e,t,i){var r=Ug(t[1]),s=(r?2:1)+(e<2?0:1),o=t[s],a,l;if(r&&(o.duration=t[1]),o.parent=i,e){for(a=o,l=i;l&&!("immediateRender"in a);)a=l.vars.defaults||{},l=mo(l.vars.inherit)&&l.parent;o.immediateRender=mo(a.immediateRender),e<2?o.runBackwards=1:o.startAt=t[s-1]}return new zi(t[0],o,t[s+1])},Ed=function(e,t){return e||e===0?t(e):t},Fv=function(e,t,i){return i<e?e:i>t?t:i},rs=function(e,t){return!mr(e)||!(t=xye.exec(e))?"":t[1]},kye=function(e,t,i){return Ed(i,function(r){return Fv(e,t,r)})},fW=[].slice,i8=function(e,t){return e&&Rc(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&Rc(e[0]))&&!e.nodeType&&e!==Ga},Lye=function(e,t,i){return i===void 0&&(i=[]),e.forEach(function(r){var s;return mr(r)&&!t||i8(r,1)?(s=i).push.apply(s,_a(r)):i.push(r)})||i},_a=function(e,t,i){return bi&&!t&&bi.selector?bi.selector(e):mr(e)&&!i&&(gW||!pC())?fW.call((t||tT).querySelectorAll(e),0):cs(e)?Lye(e,i):i8(e)?fW.call(e,0):e?[e]:[]},IW=function(e){return e=_a(e)[0]||R2("Invalid scope")||{},function(t){var i=e.current||e.nativeElement||e;return _a(t,i.querySelectorAll?i:i===e?R2("Invalid scope")||tT.createElement("div"):e)}},r8=function(e){return e.sort(function(){return .5-Math.random()})},s8=function(e){if(wi(e))return e;var t=Rc(e)?e:{each:e},i=ef(t.ease),r=t.from||0,s=parseFloat(t.base)||0,o={},a=r>0&&r<1,l=isNaN(r)||a,c=t.axis,g=r,u=r;return mr(r)?g=u={center:.5,edges:.5,end:1}[r]||0:!a&&l&&(g=r[0],u=r[1]),function(d,h,f){var I=(f||t).length,A=o[I],p,y,v,b,w,G,x,B,R;if(!A){if(R=t.grid==="auto"?0:(t.grid||[1,Fa])[1],!R){for(x=-Fa;x<(x=f[R++].getBoundingClientRect().left)&&R<I;);R--}for(A=o[I]=[],p=l?Math.min(R,I)*g-.5:r%R,y=R===Fa?0:l?I*u/R-.5:r/R|0,x=0,B=Fa,G=0;G<I;G++)v=G%R-p,b=y-(G/R|0),A[G]=w=c?Math.abs(c==="y"?b:v):Hj(v*v+b*b),w>x&&(x=w),w<B&&(B=w);r==="random"&&r8(A),A.max=x-B,A.min=B,A.v=I=(parseFloat(t.amount)||parseFloat(t.each)*(R>I?I-1:c?c==="y"?I/R:R:Math.max(R,I/R))||0)*(r==="edges"?-1:1),A.b=I<0?s-I:s,A.u=rs(t.amount||t.each)||0,i=i&&I<0?I8(i):i}return I=(A[d]-A.min)/A.max||0,Zr(A.b+(i?i(I):I)*A.v)+A.u}},AW=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(i){var r=Zr(Math.round(parseFloat(i)/e)*e*t);return(r-r%1)/t+(Ug(i)?0:rs(i))}},o8=function(e,t){var i=cs(e),r,s;return!i&&Rc(e)&&(r=i=e.radius||Fa,e.values?(e=_a(e.values),(s=!Ug(e[0]))&&(r*=r)):e=AW(e.increment)),Ed(t,i?wi(e)?function(o){return s=e(o),Math.abs(s-o)<=r?s:o}:function(o){for(var a=parseFloat(s?o.x:o),l=parseFloat(s?o.y:0),c=Fa,g=0,u=e.length,d,h;u--;)s?(d=e[u].x-a,h=e[u].y-l,d=d*d+h*h):d=Math.abs(e[u]-a),d<c&&(c=d,g=u);return g=!r||c<=r?e[g]:o,s||g===o||Ug(o)?g:g+rs(o)}:AW(e))},a8=function(e,t,i,r){return Ed(cs(e)?!t:i===!0?!!(i=0):!r,function(){return cs(e)?e[~~(Math.random()*e.length)]:(i=i||1e-5)&&(r=i<1?Math.pow(10,(i+"").length-2):1)&&Math.floor(Math.round((e-i/2+Math.random()*(t-e+i*.99))/i)*i*r)/r})},Hye=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(r){return t.reduce(function(s,o){return o(s)},r)}},zye=function(e,t){return function(i){return e(parseFloat(i))+(t||rs(i))}},Xye=function(e,t,i){return c8(e,t,0,1,i)},l8=function(e,t,i){return Ed(i,function(r){return e[~~t(r)]})},Yye=function n(e,t,i){var r=t-e;return cs(e)?l8(e,n(0,e.length),t):Ed(i,function(s){return(r+(s-e)%r)%r+e})},Kye=function n(e,t,i){var r=t-e,s=r*2;return cs(e)?l8(e,n(0,e.length-1),t):Ed(i,function(o){return o=(s+(o-e)%s)%s||0,e+(o>r?s-o:o)})},ky=function(e){for(var t=0,i="",r,s,o,a;~(r=e.indexOf("random(",t));)o=e.indexOf(")",r),a=e.charAt(r+7)==="[",s=e.substr(r+7,o-r-7).match(a?Kj:cW),i+=e.substr(t,r-t)+a8(a?s:+s[0],a?0:+s[1],+s[2]||1e-5),t=o+1;return i+e.substr(t,e.length-t)},c8=function(e,t,i,r,s){var o=t-e,a=r-i;return Ed(s,function(l){return i+((l-e)/o*a||0)})},Dye=function n(e,t,i,r){var s=isNaN(e+t)?0:function(h){return(1-h)*e+h*t};if(!s){var o=mr(e),a={},l,c,g,u,d;if(i===!0&&(r=1)&&(i=null),o)e={p:e},t={p:t};else if(cs(e)&&!cs(t)){for(g=[],u=e.length,d=u-2,c=1;c<u;c++)g.push(n(e[c-1],e[c]));u--,s=function(f){f*=u;var I=Math.min(d,~~f);return g[I](f-I)},i=t}else r||(e=yf(cs(e)?[]:{},e));if(!g){for(l in t)oT.call(a,e,l,"get",t[l]);s=function(f){return gT(f,a)||(o?e.p:e)}}}return Ed(i,s)},pX=function(e,t,i){var r=e.labels,s=Fa,o,a,l;for(o in r)a=r[o]-t,a<0==!!i&&a&&s>(a=Math.abs(a))&&(l=o,s=a);return l},Va=function(e,t,i){var r=e.vars,s=r[t],o=bi,a=e._ctx,l,c,g;if(s)return l=r[t+"Params"],c=r.callbackScope||e,i&&ud.length&&Z2(),a&&(bi=a),g=l?s.apply(c,l):s.call(c),bi=o,g},o0=function(e){return vd(e),e.scrollTrigger&&e.scrollTrigger.kill(!!ls),e.progress()<1&&Va(e,"onInterrupt"),e},BA,g8=[],u8=function(e){if(eT()&&e){e=!e.name&&e.default||e;var t=e.name,i=wi(e),r=t&&!i&&e.init?function(){this._props=[]}:e,s={init:Ny,render:gT,add:oT,kill:ave,modifier:ove,rawVars:0},o={targetTest:0,get:0,getSetter:cT,aliases:{},register:0};if(pC(),e!==r){if(Do[t])return;Xa(r,Xa(M2(e,s),o)),yf(r.prototype,yf(s,M2(e,o))),Do[r.prop=t]=r,e.targetTest&&(B1.push(r),iT[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}Uj(t,r),e.register&&e.register(So,r,vo)}else e&&g8.push(e)},Vn=255,a0={aqua:[0,Vn,Vn],lime:[0,Vn,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Vn],navy:[0,0,128],white:[Vn,Vn,Vn],olive:[128,128,0],yellow:[Vn,Vn,0],orange:[Vn,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Vn,0,0],pink:[Vn,192,203],cyan:[0,Vn,Vn],transparent:[Vn,Vn,Vn,0]},yZ=function(e,t,i){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(i-t)*e*6:e<.5?i:e*3<2?t+(i-t)*(2/3-e)*6:t)*Vn+.5|0},d8=function(e,t,i){var r=e?Ug(e)?[e>>16,e>>8&Vn,e&Vn]:0:a0.black,s,o,a,l,c,g,u,d,h,f;if(!r){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),a0[e])r=a0[e];else if(e.charAt(0)==="#"){if(e.length<6&&(s=e.charAt(1),o=e.charAt(2),a=e.charAt(3),e="#"+s+s+o+o+a+a+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return r=parseInt(e.substr(1,6),16),[r>>16,r>>8&Vn,r&Vn,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),r=[e>>16,e>>8&Vn,e&Vn]}else if(e.substr(0,3)==="hsl"){if(r=f=e.match(cW),!t)l=+r[0]%360/360,c=+r[1]/100,g=+r[2]/100,o=g<=.5?g*(c+1):g+c-g*c,s=g*2-o,r.length>3&&(r[3]*=1),r[0]=yZ(l+1/3,s,o),r[1]=yZ(l,s,o),r[2]=yZ(l-1/3,s,o);else if(~e.indexOf("="))return r=e.match(Xj),i&&r.length<4&&(r[3]=1),r}else r=e.match(cW)||a0.transparent;r=r.map(Number)}return t&&!f&&(s=r[0]/Vn,o=r[1]/Vn,a=r[2]/Vn,u=Math.max(s,o,a),d=Math.min(s,o,a),g=(u+d)/2,u===d?l=c=0:(h=u-d,c=g>.5?h/(2-u-d):h/(u+d),l=u===s?(o-a)/h+(o<a?6:0):u===o?(a-s)/h+2:(s-o)/h+4,l*=60),r[0]=~~(l+.5),r[1]=~~(c*100+.5),r[2]=~~(g*100+.5)),i&&r.length<4&&(r[3]=1),r},h8=function(e){var t=[],i=[],r=-1;return e.split(dd).forEach(function(s){var o=s.match(bA)||[];t.push.apply(t,o),i.push(r+=o.length+1)}),t.c=i,t},mX=function(e,t,i){var r="",s=(e+r).match(dd),o=t?"hsla(":"rgba(",a=0,l,c,g,u;if(!s)return e;if(s=s.map(function(d){return(d=d8(d,t,1))&&o+(t?d[0]+","+d[1]+"%,"+d[2]+"%,"+d[3]:d.join(","))+")"}),i&&(g=h8(e),l=i.c,l.join(r)!==g.c.join(r)))for(c=e.replace(dd,"1").split(bA),u=c.length-1;a<u;a++)r+=c[a]+(~l.indexOf(a)?s.shift()||o+"0,0,0,0)":(g.length?g:s.length?s:i).shift());if(!c)for(c=e.split(dd),u=c.length-1;a<u;a++)r+=c[a]+s[a];return r+c[u]},dd=function(){var n="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in a0)n+="|"+e+"\\b";return new RegExp(n+")","gi")}(),Pye=/hsl[a]?\(/,f8=function(e){var t=e.join(" "),i;if(dd.lastIndex=0,dd.test(t))return i=Pye.test(t),e[1]=mX(e[1],i),e[0]=mX(e[0],i,h8(e[1])),!0},Ly,Uo=function(){var n=Date.now,e=500,t=33,i=n(),r=i,s=1e3/240,o=s,a=[],l,c,g,u,d,h,f=function I(A){var p=n()-r,y=A===!0,v,b,w,G;if(p>e&&(i+=p-t),r+=p,w=r-i,v=w-o,(v>0||y)&&(G=++u.frame,d=w-u.time*1e3,u.time=w=w/1e3,o+=v+(v>=s?4:s-v),b=1),y||(l=c(I)),b)for(h=0;h<a.length;h++)a[h](w,d,G,A)};return u={time:0,frame:0,tick:function(){f(!0)},deltaRatio:function(A){return d/(1e3/(A||60))},wake:function(){Dj&&(!gW&&eT()&&(Ga=gW=window,tT=Ga.document||{},ia.gsap=So,(Ga.gsapVersions||(Ga.gsapVersions=[])).push(So.version),Pj(S2||Ga.GreenSockGlobals||!Ga.gsap&&Ga||{}),g=Ga.requestAnimationFrame,g8.forEach(u8)),l&&u.sleep(),c=g||function(A){return setTimeout(A,o-u.time*1e3+1|0)},Ly=1,f(2))},sleep:function(){(g?Ga.cancelAnimationFrame:clearTimeout)(l),Ly=0,c=Ny},lagSmoothing:function(A,p){e=A||1/0,t=Math.min(p||33,e)},fps:function(A){s=1e3/(A||240),o=u.time*1e3+s},add:function(A,p,y){var v=p?function(b,w,G,x){A(b,w,G,x),u.remove(v)}:A;return u.remove(A),a[y?"unshift":"push"](v),pC(),v},remove:function(A,p){~(p=a.indexOf(A))&&a.splice(p,1)&&h>=p&&h--},_listeners:a},u}(),pC=function(){return!Ly&&Uo.wake()},sn={},Uye=/^[\d.\-M][\d.\-,\s]/,Qye=/["']/g,Oye=function(e){for(var t={},i=e.substr(1,e.length-3).split(":"),r=i[0],s=1,o=i.length,a,l,c;s<o;s++)l=i[s],a=s!==o-1?l.lastIndexOf(","):l.length,c=l.substr(0,a),t[r]=isNaN(c)?c.replace(Qye,"").trim():+c,r=l.substr(a+1).trim();return t},Jye=function(e){var t=e.indexOf("(")+1,i=e.indexOf(")"),r=e.indexOf("(",t);return e.substring(t,~r&&r<i?e.indexOf(")",i+1):i)},jye=function(e){var t=(e+"").split("("),i=sn[t[0]];return i&&t.length>1&&i.config?i.config.apply(null,~e.indexOf("{")?[Oye(t[1])]:Jye(e).split(",").map(jj)):sn._CE&&Uye.test(e)?sn._CE("",e):i},I8=function(e){return function(t){return 1-e(1-t)}},A8=function n(e,t){for(var i=e._first,r;i;)i instanceof Ts?n(i,t):i.vars.yoyoEase&&(!i._yoyo||!i._repeat)&&i._yoyo!==t&&(i.timeline?n(i.timeline,t):(r=i._ease,i._ease=i._yEase,i._yEase=r,i._yoyo=t)),i=i._next},ef=function(e,t){return e&&(wi(e)?e:sn[e]||jye(e))||t},Ff=function(e,t,i,r){i===void 0&&(i=function(l){return 1-t(1-l)}),r===void 0&&(r=function(l){return l<.5?t(l*2)/2:1-t((1-l)*2)/2});var s={easeIn:t,easeOut:i,easeInOut:r},o;return yo(e,function(a){sn[a]=ia[a]=s,sn[o=a.toLowerCase()]=i;for(var l in s)sn[o+(l==="easeIn"?".in":l==="easeOut"?".out":".inOut")]=sn[a+"."+l]=s[l]}),s},C8=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},vZ=function n(e,t,i){var r=t>=1?t:1,s=(i||(e?.3:.45))/(t<1?t:1),o=s/lW*(Math.asin(1/r)||0),a=function(g){return g===1?1:r*Math.pow(2,-10*g)*wye((g-o)*s)+1},l=e==="out"?a:e==="in"?function(c){return 1-a(1-c)}:C8(a);return s=lW/s,l.config=function(c,g){return n(e,c,g)},l},bZ=function n(e,t){t===void 0&&(t=1.70158);var i=function(o){return o?--o*o*((t+1)*o+t)+1:0},r=e==="out"?i:e==="in"?function(s){return 1-i(1-s)}:C8(i);return r.config=function(s){return n(e,s)},r};yo("Linear,Quad,Cubic,Quart,Quint,Strong",function(n,e){var t=e<5?e+1:e;Ff(n+",Power"+(t-1),e?function(i){return Math.pow(i,t)}:function(i){return i},function(i){return 1-Math.pow(1-i,t)},function(i){return i<.5?Math.pow(i*2,t)/2:1-Math.pow((1-i)*2,t)/2})});sn.Linear.easeNone=sn.none=sn.Linear.easeIn;Ff("Elastic",vZ("in"),vZ("out"),vZ());(function(n,e){var t=1/e,i=2*t,r=2.5*t,s=function(a){return a<t?n*a*a:a<i?n*Math.pow(a-1.5/e,2)+.75:a<r?n*(a-=2.25/e)*a+.9375:n*Math.pow(a-2.625/e,2)+.984375};Ff("Bounce",function(o){return 1-s(1-o)},s)})(7.5625,2.75);Ff("Expo",function(n){return n?Math.pow(2,10*(n-1)):0});Ff("Circ",function(n){return-(Hj(1-n*n)-1)});Ff("Sine",function(n){return n===1?1:-Gye(n*bye)+1});Ff("Back",bZ("in"),bZ("out"),bZ());sn.SteppedEase=sn.steps=ia.SteppedEase={config:function(e,t){e===void 0&&(e=1);var i=1/e,r=e+(t?0:1),s=t?1:0,o=1-Nn;return function(a){return((r*Fv(0,o,a)|0)+s)*i}}};IC.ease=sn["quad.out"];yo("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(n){return rT+=n+","+n+"Params,"});var p8=function(e,t){this.id=Bye++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:Oj,this.set=t?t.getSetter:cT},Hy=function(){function n(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,CC(this,+t.duration,1,1),this.data=t.data,bi&&(this._ctx=bi,bi.data.push(this)),Ly||Uo.wake()}var e=n.prototype;return e.delay=function(i){return i||i===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+i-this._delay),this._delay=i,this):this._delay},e.duration=function(i){return arguments.length?this.totalDuration(this._repeat>0?i+(i+this._rDelay)*this._repeat:i):this.totalDuration()&&this._dur},e.totalDuration=function(i){return arguments.length?(this._dirty=0,CC(this,this._repeat<0?i:(i-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(i,r){if(pC(),!arguments.length)return this._tTime;var s=this._dp;if(s&&s.smoothChildTiming&&this._ts){for(ox(this,i),!s._dp||s.parent||e8(s,this);s&&s.parent;)s.parent._time!==s._start+(s._ts>=0?s._tTime/s._ts:(s.totalDuration()-s._tTime)/-s._ts)&&s.totalTime(s._tTime,!0),s=s.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&i<this._tDur||this._ts<0&&i>0||!this._tDur&&!i)&&dc(this._dp,this,this._start-this._delay)}return(this._tTime!==i||!this._dur&&!r||this._initted&&Math.abs(this._zTime)===Nn||!i&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=i),Jj(this,i,r)),this},e.time=function(i,r){return arguments.length?this.totalTime(Math.min(this.totalDuration(),i+AX(this))%(this._dur+this._rDelay)||(i?this._dur:0),r):this._time},e.totalProgress=function(i,r){return arguments.length?this.totalTime(this.totalDuration()*i,r):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},e.progress=function(i,r){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-i:i)+AX(this),r):this.duration()?Math.min(1,this._time/this._dur):this.ratio},e.iteration=function(i,r){var s=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(i-1)*s,r):this._repeat?AC(this._tTime,s)+1:1},e.timeScale=function(i){if(!arguments.length)return this._rts===-Nn?0:this._rts;if(this._rts===i)return this;var r=this.parent&&this._ts?E2(this.parent._time,this):this._tTime;return this._rts=+i||0,this._ts=this._ps||i===-Nn?0:this._rts,this.totalTime(Fv(-Math.abs(this._delay),this._tDur,r),!0),sx(this),Wye(this)},e.paused=function(i){return arguments.length?(this._ps!==i&&(this._ps=i,i?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(pC(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==Nn&&(this._tTime-=Nn)))),this):this._ps},e.startTime=function(i){if(arguments.length){this._start=i;var r=this.parent||this._dp;return r&&(r._sort||!this.parent)&&dc(r,this,i-this._delay),this}return this._start},e.endTime=function(i){return this._start+(mo(i)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(i){var r=this.parent||this._dp;return r?i&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?E2(r.rawTime(i),this):this._tTime:this._tTime},e.revert=function(i){i===void 0&&(i=Rye);var r=ls;return ls=i,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(i),this.totalTime(-.01,i.suppressEvents)),this.data!=="nested"&&i.kill!==!1&&this.kill(),ls=r,this},e.globalTime=function(i){for(var r=this,s=arguments.length?i:r.rawTime();r;)s=r._start+s/(r._ts||1),r=r._dp;return!this.parent&&this._sat?this._sat.vars.immediateRender?-1:this._sat.globalTime(i):s},e.repeat=function(i){return arguments.length?(this._repeat=i===1/0?-2:i,CX(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(i){if(arguments.length){var r=this._time;return this._rDelay=i,CX(this),r?this.time(r):this}return this._rDelay},e.yoyo=function(i){return arguments.length?(this._yoyo=i,this):this._yoyo},e.seek=function(i,r){return this.totalTime(Ba(this,i),mo(r))},e.restart=function(i,r){return this.play().totalTime(i?-this._delay:0,mo(r))},e.play=function(i,r){return i!=null&&this.seek(i,r),this.reversed(!1).paused(!1)},e.reverse=function(i,r){return i!=null&&this.seek(i||this.totalDuration(),r),this.reversed(!0).paused(!1)},e.pause=function(i,r){return i!=null&&this.seek(i,r),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(i){return arguments.length?(!!i!==this.reversed()&&this.timeScale(-this._rts||(i?-Nn:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-Nn,this},e.isActive=function(){var i=this.parent||this._dp,r=this._start,s;return!!(!i||this._ts&&this._initted&&i.isActive()&&(s=i.rawTime(!0))>=r&&s<this.endTime(!0)-Nn)},e.eventCallback=function(i,r,s){var o=this.vars;return arguments.length>1?(r?(o[i]=r,s&&(o[i+"Params"]=s),i==="onUpdate"&&(this._onUpdate=r)):delete o[i],this):o[i]},e.then=function(i){var r=this;return new Promise(function(s){var o=wi(i)?i:qj,a=function(){var c=r.then;r.then=null,wi(o)&&(o=o(r))&&(o.then||o===r)&&(r.then=c),s(o),r.then=c};r._initted&&r.totalProgress()===1&&r._ts>=0||!r._tTime&&r._ts<0?a():r._prom=a})},e.kill=function(){o0(this)},n}();Xa(Hy.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-Nn,_prom:0,_ps:!1,_rts:1});var Ts=function(n){Lj(e,n);function e(i,r){var s;return i===void 0&&(i={}),s=n.call(this,i)||this,s.labels={},s.smoothChildTiming=!!i.smoothChildTiming,s.autoRemoveChildren=!!i.autoRemoveChildren,s._sort=mo(i.sortChildren),di&&dc(i.parent||di,Ig(s),r),i.reversed&&s.reverse(),i.paused&&s.paused(!0),i.scrollTrigger&&t8(Ig(s),i.scrollTrigger),s}var t=e.prototype;return t.to=function(r,s,o){return L0(0,arguments,this),this},t.from=function(r,s,o){return L0(1,arguments,this),this},t.fromTo=function(r,s,o,a){return L0(2,arguments,this),this},t.set=function(r,s,o){return s.duration=0,s.parent=this,k0(s).repeatDelay||(s.repeat=0),s.immediateRender=!!s.immediateRender,new zi(r,s,Ba(this,o),1),this},t.call=function(r,s,o){return dc(this,zi.delayedCall(0,r,s),o)},t.staggerTo=function(r,s,o,a,l,c,g){return o.duration=s,o.stagger=o.stagger||a,o.onComplete=c,o.onCompleteParams=g,o.parent=this,new zi(r,o,Ba(this,l)),this},t.staggerFrom=function(r,s,o,a,l,c,g){return o.runBackwards=1,k0(o).immediateRender=mo(o.immediateRender),this.staggerTo(r,s,o,a,l,c,g)},t.staggerFromTo=function(r,s,o,a,l,c,g,u){return a.startAt=o,k0(a).immediateRender=mo(a.immediateRender),this.staggerTo(r,s,a,l,c,g,u)},t.render=function(r,s,o){var a=this._time,l=this._dirty?this.totalDuration():this._tDur,c=this._dur,g=r<=0?0:Zr(r),u=this._zTime<0!=r<0&&(this._initted||!c),d,h,f,I,A,p,y,v,b,w,G,x;if(this!==di&&g>l&&r>=0&&(g=l),g!==this._tTime||o||u){if(a!==this._time&&c&&(g+=this._time-a,r+=this._time-a),d=g,b=this._start,v=this._ts,p=!v,u&&(c||(a=this._zTime),(r||!s)&&(this._zTime=r)),this._repeat){if(G=this._yoyo,A=c+this._rDelay,this._repeat<-1&&r<0)return this.totalTime(A*100+r,s,o);if(d=Zr(g%A),g===l?(I=this._repeat,d=c):(I=~~(g/A),I&&I===g/A&&(d=c,I--),d>c&&(d=c)),w=AC(this._tTime,A),!a&&this._tTime&&w!==I&&this._tTime-w*A-this._dur<=0&&(w=I),G&&I&1&&(d=c-d,x=1),I!==w&&!this._lock){var B=G&&w&1,R=B===(G&&I&1);if(I<w&&(B=!B),a=B?0:c,this._lock=1,this.render(a||(x?0:Zr(I*A)),s,!c)._lock=0,this._tTime=g,!s&&this.parent&&Va(this,"onRepeat"),this.vars.repeatRefresh&&!x&&(this.invalidate()._lock=1),a&&a!==this._time||p!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(c=this._dur,l=this._tDur,R&&(this._lock=2,a=B?c:-1e-4,this.render(a,!0),this.vars.repeatRefresh&&!x&&this.invalidate()),this._lock=0,!this._ts&&!p)return this;A8(this,x)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(y=Tye(this,Zr(a),Zr(d)),y&&(g-=d-(d=y._start))),this._tTime=g,this._time=d,this._act=!v,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=r,a=0),!a&&d&&!s&&!I&&(Va(this,"onStart"),this._tTime!==g))return this;if(d>=a&&r>=0)for(h=this._first;h;){if(f=h._next,(h._act||d>=h._start)&&h._ts&&y!==h){if(h.parent!==this)return this.render(r,s,o);if(h.render(h._ts>0?(d-h._start)*h._ts:(h._dirty?h.totalDuration():h._tDur)+(d-h._start)*h._ts,s,o),d!==this._time||!this._ts&&!p){y=0,f&&(g+=this._zTime=-Nn);break}}h=f}else{h=this._last;for(var Z=r<0?r:d;h;){if(f=h._prev,(h._act||Z<=h._end)&&h._ts&&y!==h){if(h.parent!==this)return this.render(r,s,o);if(h.render(h._ts>0?(Z-h._start)*h._ts:(h._dirty?h.totalDuration():h._tDur)+(Z-h._start)*h._ts,s,o||ls&&(h._initted||h._startAt)),d!==this._time||!this._ts&&!p){y=0,f&&(g+=this._zTime=Z?-Nn:Nn);break}}h=f}}if(y&&!s&&(this.pause(),y.render(d>=a?0:-Nn)._zTime=d>=a?1:-1,this._ts))return this._start=b,sx(this),this.render(r,s,o);this._onUpdate&&!s&&Va(this,"onUpdate",!0),(g===l&&this._tTime>=this.totalDuration()||!g&&a)&&(b===this._start||Math.abs(v)!==Math.abs(this._ts))&&(this._lock||((r||!c)&&(g===l&&this._ts>0||!g&&this._ts<0)&&vd(this,1),!s&&!(r<0&&!a)&&(g||a||!l)&&(Va(this,g===l&&r>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(g<l&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(r,s){var o=this;if(Ug(s)||(s=Ba(this,s,r)),!(r instanceof Hy)){if(cs(r))return r.forEach(function(a){return o.add(a,s)}),this;if(mr(r))return this.addLabel(r,s);if(wi(r))r=zi.delayedCall(0,r);else return this}return this!==r?dc(this,r,s):this},t.getChildren=function(r,s,o,a){r===void 0&&(r=!0),s===void 0&&(s=!0),o===void 0&&(o=!0),a===void 0&&(a=-Fa);for(var l=[],c=this._first;c;)c._start>=a&&(c instanceof zi?s&&l.push(c):(o&&l.push(c),r&&l.push.apply(l,c.getChildren(!0,s,o)))),c=c._next;return l},t.getById=function(r){for(var s=this.getChildren(1,1,1),o=s.length;o--;)if(s[o].vars.id===r)return s[o]},t.remove=function(r){return mr(r)?this.removeLabel(r):wi(r)?this.killTweensOf(r):(rx(this,r),r===this._recent&&(this._recent=this._last),$h(this))},t.totalTime=function(r,s){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Zr(Uo.time-(this._ts>0?r/this._ts:(this.totalDuration()-r)/-this._ts))),n.prototype.totalTime.call(this,r,s),this._forcing=0,this):this._tTime},t.addLabel=function(r,s){return this.labels[r]=Ba(this,s),this},t.removeLabel=function(r){return delete this.labels[r],this},t.addPause=function(r,s,o){var a=zi.delayedCall(0,s||Ny,o);return a.data="isPause",this._hasPause=1,dc(this,a,Ba(this,r))},t.removePause=function(r){var s=this._first;for(r=Ba(this,r);s;)s._start===r&&s.data==="isPause"&&vd(s),s=s._next},t.killTweensOf=function(r,s,o){for(var a=this.getTweensOf(r,o),l=a.length;l--;)Qu!==a[l]&&a[l].kill(r,s);return this},t.getTweensOf=function(r,s){for(var o=[],a=_a(r),l=this._first,c=Ug(s),g;l;)l instanceof zi?Zye(l._targets,a)&&(c?(!Qu||l._initted&&l._ts)&&l.globalTime(0)<=s&&l.globalTime(l.totalDuration())>s:!s||l.isActive())&&o.push(l):(g=l.getTweensOf(a,s)).length&&o.push.apply(o,g),l=l._next;return o},t.tweenTo=function(r,s){s=s||{};var o=this,a=Ba(o,r),l=s,c=l.startAt,g=l.onStart,u=l.onStartParams,d=l.immediateRender,h,f=zi.to(o,Xa({ease:s.ease||"none",lazy:!1,immediateRender:!1,time:a,overwrite:"auto",duration:s.duration||Math.abs((a-(c&&"time"in c?c.time:o._time))/o.timeScale())||Nn,onStart:function(){if(o.pause(),!h){var A=s.duration||Math.abs((a-(c&&"time"in c?c.time:o._time))/o.timeScale());f._dur!==A&&CC(f,A,0,1).render(f._time,!0,!0),h=1}g&&g.apply(f,u||[])}},s));return d?f.render(0):f},t.tweenFromTo=function(r,s,o){return this.tweenTo(s,Xa({startAt:{time:Ba(this,r)}},o))},t.recent=function(){return this._recent},t.nextLabel=function(r){return r===void 0&&(r=this._time),pX(this,Ba(this,r))},t.previousLabel=function(r){return r===void 0&&(r=this._time),pX(this,Ba(this,r),1)},t.currentLabel=function(r){return arguments.length?this.seek(r,!0):this.previousLabel(this._time+Nn)},t.shiftChildren=function(r,s,o){o===void 0&&(o=0);for(var a=this._first,l=this.labels,c;a;)a._start>=o&&(a._start+=r,a._end+=r),a=a._next;if(s)for(c in l)l[c]>=o&&(l[c]+=r);return $h(this)},t.invalidate=function(r){var s=this._first;for(this._lock=0;s;)s.invalidate(r),s=s._next;return n.prototype.invalidate.call(this,r)},t.clear=function(r){r===void 0&&(r=!0);for(var s=this._first,o;s;)o=s._next,this.remove(s),s=o;return this._dp&&(this._time=this._tTime=this._pTime=0),r&&(this.labels={}),$h(this)},t.totalDuration=function(r){var s=0,o=this,a=o._last,l=Fa,c,g,u;if(arguments.length)return o.timeScale((o._repeat<0?o.duration():o.totalDuration())/(o.reversed()?-r:r));if(o._dirty){for(u=o.parent;a;)c=a._prev,a._dirty&&a.totalDuration(),g=a._start,g>l&&o._sort&&a._ts&&!o._lock?(o._lock=1,dc(o,a,g-a._delay,1)._lock=0):l=g,g<0&&a._ts&&(s-=g,(!u&&!o._dp||u&&u.smoothChildTiming)&&(o._start+=g/o._ts,o._time-=g,o._tTime-=g),o.shiftChildren(-g,!1,-1/0),l=0),a._end>s&&a._ts&&(s=a._end),a=c;CC(o,o===di&&o._time>s?o._time:s,1,1),o._dirty=0}return o._tDur},e.updateRoot=function(r){if(di._ts&&(Jj(di,E2(r,di)),Qj=Uo.frame),Uo.frame>=fX){fX+=qo.autoSleep||120;var s=di._first;if((!s||!s._ts)&&qo.autoSleep&&Uo._listeners.length<2){for(;s&&!s._ts;)s=s._next;s||Uo.sleep()}}},e}(Hy);Xa(Ts.prototype,{_lock:0,_hasPause:0,_forcing:0});var qye=function(e,t,i,r,s,o,a){var l=new vo(this._pt,e,t,0,1,G8,null,s),c=0,g=0,u,d,h,f,I,A,p,y;for(l.b=i,l.e=r,i+="",r+="",(p=~r.indexOf("random("))&&(r=ky(r)),o&&(y=[i,r],o(y,e,t),i=y[0],r=y[1]),d=i.match(pZ)||[];u=pZ.exec(r);)f=u[0],I=r.substring(c,u.index),h?h=(h+1)%5:I.substr(-5)==="rgba("&&(h=1),f!==d[g++]&&(A=parseFloat(d[g-1])||0,l._pt={_next:l._pt,p:I||g===1?I:",",s:A,c:f.charAt(1)==="="?YA(A,f)-A:parseFloat(f)-A,m:h&&h<4?Math.round:0},c=pZ.lastIndex);return l.c=c<r.length?r.substring(c,r.length):"",l.fp=a,(Yj.test(r)||p)&&(l.e=0),this._pt=l,l},oT=function(e,t,i,r,s,o,a,l,c,g){wi(r)&&(r=r(s||0,e,o));var u=e[t],d=i!=="get"?i:wi(u)?c?e[t.indexOf("set")||!wi(e["get"+t.substr(3)])?t:"get"+t.substr(3)](c):e[t]():u,h=wi(u)?c?ive:b8:lT,f;if(mr(r)&&(~r.indexOf("random(")&&(r=ky(r)),r.charAt(1)==="="&&(f=YA(d,r)+(rs(d)||0),(f||f===0)&&(r=f))),!g||d!==r||CW)return!isNaN(d*r)&&r!==""?(f=new vo(this._pt,e,t,+d||0,r-(d||0),typeof u=="boolean"?sve:B8,0,h),c&&(f.fp=c),a&&f.modifier(a,this,e),this._pt=f):(!u&&!(t in e)&&nT(t,r),qye.call(this,e,t,d,r,h,l||qo.stringFilter,c))},$ye=function(e,t,i,r,s){if(wi(e)&&(e=H0(e,s,t,i,r)),!Rc(e)||e.style&&e.nodeType||cs(e)||zj(e))return mr(e)?H0(e,s,t,i,r):e;var o={},a;for(a in e)o[a]=H0(e[a],s,t,i,r);return o},m8=function(e,t,i,r,s,o){var a,l,c,g;if(Do[e]&&(a=new Do[e]).init(s,a.rawVars?t[e]:$ye(t[e],r,s,o,i),i,r,o)!==!1&&(i._pt=l=new vo(i._pt,s,e,0,1,a.render,a,0,a.priority),i!==BA))for(c=i._ptLookup[i._targets.indexOf(s)],g=a._props.length;g--;)c[a._props[g]]=l;return a},Qu,CW,aT=function n(e,t,i){var r=e.vars,s=r.ease,o=r.startAt,a=r.immediateRender,l=r.lazy,c=r.onUpdate,g=r.onUpdateParams,u=r.callbackScope,d=r.runBackwards,h=r.yoyoEase,f=r.keyframes,I=r.autoRevert,A=e._dur,p=e._startAt,y=e._targets,v=e.parent,b=v&&v.data==="nested"?v.vars.targets:y,w=e._overwrite==="auto"&&!qV,G=e.timeline,x,B,R,Z,W,F,T,V,z,U,J,H,Y;if(G&&(!f||!s)&&(s="none"),e._ease=ef(s,IC.ease),e._yEase=h?I8(ef(h===!0?s:h,IC.ease)):0,h&&e._yoyo&&!e._repeat&&(h=e._yEase,e._yEase=e._ease,e._ease=h),e._from=!G&&!!r.runBackwards,!G||f&&!r.stagger){if(V=y[0]?qh(y[0]).harness:0,H=V&&r[V.prop],x=M2(r,iT),p&&(p._zTime<0&&p.progress(1),t<0&&d&&a&&!I?p.render(-1,!0):p.revert(d&&A?b1:Sye),p._lazy=0),o){if(vd(e._startAt=zi.set(y,Xa({data:"isStart",overwrite:!1,parent:v,immediateRender:!0,lazy:!p&&mo(l),startAt:null,delay:0,onUpdate:c,onUpdateParams:g,callbackScope:u,stagger:0},o))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(ls||!a&&!I)&&e._startAt.revert(b1),a&&A&&t<=0&&i<=0){t&&(e._zTime=t);return}}else if(d&&A&&!p){if(t&&(a=!1),R=Xa({overwrite:!1,data:"isFromStart",lazy:a&&!p&&mo(l),immediateRender:a,stagger:0,parent:v},x),H&&(R[V.prop]=H),vd(e._startAt=zi.set(y,R)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(ls?e._startAt.revert(b1):e._startAt.render(-1,!0)),e._zTime=t,!a)n(e._startAt,Nn,Nn);else if(!t)return}for(e._pt=e._ptCache=0,l=A&&mo(l)||l&&!A,B=0;B<y.length;B++){if(W=y[B],T=W._gsap||sT(y)[B]._gsap,e._ptLookup[B]=U={},uW[T.id]&&ud.length&&Z2(),J=b===y?B:b.indexOf(W),V&&(z=new V).init(W,H||x,e,J,b)!==!1&&(e._pt=Z=new vo(e._pt,W,z.name,0,1,z.render,z,0,z.priority),z._props.forEach(function(K){U[K]=Z}),z.priority&&(F=1)),!V||H)for(R in x)Do[R]&&(z=m8(R,x,e,J,W,b))?z.priority&&(F=1):U[R]=Z=oT.call(e,W,R,"get",x[R],J,b,0,r.stringFilter);e._op&&e._op[B]&&e.kill(W,e._op[B]),w&&e._pt&&(Qu=e,di.killTweensOf(W,U,e.globalTime(t)),Y=!e.parent,Qu=0),e._pt&&l&&(uW[T.id]=1)}F&&w8(e),e._onInit&&e._onInit(e)}e._onUpdate=c,e._initted=(!e._op||e._pt)&&!Y,f&&t<=0&&G.render(Fa,!0,!0)},eve=function(e,t,i,r,s,o,a){var l=(e._pt&&e._ptCache||(e._ptCache={}))[t],c,g,u,d;if(!l)for(l=e._ptCache[t]=[],u=e._ptLookup,d=e._targets.length;d--;){if(c=u[d][t],c&&c.d&&c.d._pt)for(c=c.d._pt;c&&c.p!==t&&c.fp!==t;)c=c._next;if(!c)return CW=1,e.vars[t]="+=0",aT(e,a),CW=0,1;l.push(c)}for(d=l.length;d--;)g=l[d],c=g._pt||g,c.s=(r||r===0)&&!s?r:c.s+(r||0)+o*c.c,c.c=i-c.s,g.e&&(g.e=Mi(i)+rs(g.e)),g.b&&(g.b=c.s+rs(g.b))},tve=function(e,t){var i=e[0]?qh(e[0]).harness:0,r=i&&i.aliases,s,o,a,l;if(!r)return t;s=yf({},t);for(o in r)if(o in s)for(l=r[o].split(","),a=l.length;a--;)s[l[a]]=s[o];return s},nve=function(e,t,i,r){var s=t.ease||r||"power1.inOut",o,a;if(cs(t))a=i[e]||(i[e]=[]),t.forEach(function(l,c){return a.push({t:c/(t.length-1)*100,v:l,e:s})});else for(o in t)a=i[o]||(i[o]=[]),o==="ease"||a.push({t:parseFloat(e),v:t[o],e:s})},H0=function(e,t,i,r,s){return wi(e)?e.call(t,i,r,s):mr(e)&&~e.indexOf("random(")?ky(e):e},y8=rT+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",v8={};yo(y8+",id,stagger,delay,duration,paused,scrollTrigger",function(n){return v8[n]=1});var zi=function(n){Lj(e,n);function e(i,r,s,o){var a;typeof r=="number"&&(s.duration=r,r=s,s=null),a=n.call(this,o?r:k0(r))||this;var l=a.vars,c=l.duration,g=l.delay,u=l.immediateRender,d=l.stagger,h=l.overwrite,f=l.keyframes,I=l.defaults,A=l.scrollTrigger,p=l.yoyoEase,y=r.parent||di,v=(cs(i)||zj(i)?Ug(i[0]):"length"in r)?[i]:_a(i),b,w,G,x,B,R,Z,W;if(a._targets=v.length?sT(v):R2("GSAP target "+i+" not found. https://greensock.com",!qo.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=h,f||d||aG(c)||aG(g)){if(r=a.vars,b=a.timeline=new Ts({data:"nested",defaults:I||{},targets:y&&y.data==="nested"?y.vars.targets:v}),b.kill(),b.parent=b._dp=Ig(a),b._start=0,d||aG(c)||aG(g)){if(x=v.length,Z=d&&s8(d),Rc(d))for(B in d)~y8.indexOf(B)&&(W||(W={}),W[B]=d[B]);for(w=0;w<x;w++)G=M2(r,v8),G.stagger=0,p&&(G.yoyoEase=p),W&&yf(G,W),R=v[w],G.duration=+H0(c,Ig(a),w,R,v),G.delay=(+H0(g,Ig(a),w,R,v)||0)-a._delay,!d&&x===1&&G.delay&&(a._delay=g=G.delay,a._start+=g,G.delay=0),b.to(R,G,Z?Z(w,R,v):0),b._ease=sn.none;b.duration()?c=g=0:a.timeline=0}else if(f){k0(Xa(b.vars.defaults,{ease:"none"})),b._ease=ef(f.ease||r.ease||"none");var F=0,T,V,z;if(cs(f))f.forEach(function(U){return b.to(v,U,">")}),b.duration();else{G={};for(B in f)B==="ease"||B==="easeEach"||nve(B,f[B],G,f.easeEach);for(B in G)for(T=G[B].sort(function(U,J){return U.t-J.t}),F=0,w=0;w<T.length;w++)V=T[w],z={ease:V.e,duration:(V.t-(w?T[w-1].t:0))/100*c},z[B]=V.v,b.to(v,z,F),F+=z.duration;b.duration()<c&&b.to({},{duration:c-b.duration()})}}c||a.duration(c=b.duration())}else a.timeline=0;return h===!0&&!qV&&(Qu=Ig(a),di.killTweensOf(v),Qu=0),dc(y,Ig(a),s),r.reversed&&a.reverse(),r.paused&&a.paused(!0),(u||!c&&!f&&a._start===Zr(y._time)&&mo(u)&&Fye(Ig(a))&&y.data!=="nested")&&(a._tTime=-Nn,a.render(Math.max(0,-g)||0)),A&&t8(Ig(a),A),a}var t=e.prototype;return t.render=function(r,s,o){var a=this._time,l=this._tDur,c=this._dur,g=r<0,u=r>l-Nn&&!g?l:r<Nn?0:r,d,h,f,I,A,p,y,v,b;if(!c)Vye(this,r,s,o);else if(u!==this._tTime||!r||o||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==g){if(d=u,v=this.timeline,this._repeat){if(I=c+this._rDelay,this._repeat<-1&&g)return this.totalTime(I*100+r,s,o);if(d=Zr(u%I),u===l?(f=this._repeat,d=c):(f=~~(u/I),f&&f===u/I&&(d=c,f--),d>c&&(d=c)),p=this._yoyo&&f&1,p&&(b=this._yEase,d=c-d),A=AC(this._tTime,I),d===a&&!o&&this._initted)return this._tTime=u,this;f!==A&&(v&&this._yEase&&A8(v,p),this.vars.repeatRefresh&&!p&&!this._lock&&(this._lock=o=1,this.render(Zr(I*f),!0).invalidate()._lock=0))}if(!this._initted){if(n8(this,g?r:d,o,s,u))return this._tTime=0,this;if(a!==this._time)return this;if(c!==this._dur)return this.render(r,s,o)}if(this._tTime=u,this._time=d,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=y=(b||this._ease)(d/c),this._from&&(this.ratio=y=1-y),d&&!a&&!s&&!f&&(Va(this,"onStart"),this._tTime!==u))return this;for(h=this._pt;h;)h.r(y,h.d),h=h._next;v&&v.render(r<0?r:!d&&p?-Nn:v._dur*v._ease(d/this._dur),s,o)||this._startAt&&(this._zTime=r),this._onUpdate&&!s&&(g&&dW(this,r,s,o),Va(this,"onUpdate")),this._repeat&&f!==A&&this.vars.onRepeat&&!s&&this.parent&&Va(this,"onRepeat"),(u===this._tDur||!u)&&this._tTime===u&&(g&&!this._onUpdate&&dW(this,r,!0,!0),(r||!c)&&(u===this._tDur&&this._ts>0||!u&&this._ts<0)&&vd(this,1),!s&&!(g&&!a)&&(u||a||p)&&(Va(this,u===l?"onComplete":"onReverseComplete",!0),this._prom&&!(u<l&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(r){return(!r||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(r),n.prototype.invalidate.call(this,r)},t.resetTo=function(r,s,o,a){Ly||Uo.wake(),this._ts||this.play();var l=Math.min(this._dur,(this._dp._time-this._start)*this._ts),c;return this._initted||aT(this,l),c=this._ease(l/this._dur),eve(this,r,s,o,a,c,l)?this.resetTo(r,s,o,a):(ox(this,0),this.parent||$j(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(r,s){if(s===void 0&&(s="all"),!r&&(!s||s==="all"))return this._lazy=this._pt=0,this.parent?o0(this):this;if(this.timeline){var o=this.timeline.totalDuration();return this.timeline.killTweensOf(r,s,Qu&&Qu.vars.overwrite!==!0)._first||o0(this),this.parent&&o!==this.timeline.totalDuration()&&CC(this,this._dur*this.timeline._tDur/o,0,1),this}var a=this._targets,l=r?_a(r):a,c=this._ptLookup,g=this._pt,u,d,h,f,I,A,p;if((!s||s==="all")&&Eye(a,l))return s==="all"&&(this._pt=0),o0(this);for(u=this._op=this._op||[],s!=="all"&&(mr(s)&&(I={},yo(s,function(y){return I[y]=1}),s=I),s=tve(a,s)),p=a.length;p--;)if(~l.indexOf(a[p])){d=c[p],s==="all"?(u[p]=s,f=d,h={}):(h=u[p]=u[p]||{},f=s);for(I in f)A=d&&d[I],A&&((!("kill"in A.d)||A.d.kill(I)===!0)&&rx(this,A,"_pt"),delete d[I]),h!=="all"&&(h[I]=1)}return this._initted&&!this._pt&&g&&o0(this),this},e.to=function(r,s){return new e(r,s,arguments[2])},e.from=function(r,s){return L0(1,arguments)},e.delayedCall=function(r,s,o,a){return new e(s,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:r,onComplete:s,onReverseComplete:s,onCompleteParams:o,onReverseCompleteParams:o,callbackScope:a})},e.fromTo=function(r,s,o){return L0(2,arguments)},e.set=function(r,s){return s.duration=0,s.repeatDelay||(s.repeat=0),new e(r,s)},e.killTweensOf=function(r,s,o){return di.killTweensOf(r,s,o)},e}(Hy);Xa(zi.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});yo("staggerTo,staggerFrom,staggerFromTo",function(n){zi[n]=function(){var e=new Ts,t=fW.call(arguments,0);return t.splice(n==="staggerFromTo"?5:4,0,0),e[n].apply(e,t)}});var lT=function(e,t,i){return e[t]=i},b8=function(e,t,i){return e[t](i)},ive=function(e,t,i,r){return e[t](r.fp,i)},rve=function(e,t,i){return e.setAttribute(t,i)},cT=function(e,t){return wi(e[t])?b8:$V(e[t])&&e.setAttribute?rve:lT},B8=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},sve=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},G8=function(e,t){var i=t._pt,r="";if(!e&&t.b)r=t.b;else if(e===1&&t.e)r=t.e;else{for(;i;)r=i.p+(i.m?i.m(i.s+i.c*e):Math.round((i.s+i.c*e)*1e4)/1e4)+r,i=i._next;r+=t.c}t.set(t.t,t.p,r,t)},gT=function(e,t){for(var i=t._pt;i;)i.r(e,i.d),i=i._next},ove=function(e,t,i,r){for(var s=this._pt,o;s;)o=s._next,s.p===r&&s.modifier(e,t,i),s=o},ave=function(e){for(var t=this._pt,i,r;t;)r=t._next,t.p===e&&!t.op||t.op===e?rx(this,t,"_pt"):t.dep||(i=1),t=r;return!i},lve=function(e,t,i,r){r.mSet(e,t,r.m.call(r.tween,i,r.mt),r)},w8=function(e){for(var t=e._pt,i,r,s,o;t;){for(i=t._next,r=s;r&&r.pr>t.pr;)r=r._next;(t._prev=r?r._prev:o)?t._prev._next=t:s=t,(t._next=r)?r._prev=t:o=t,t=i}e._pt=s},vo=function(){function n(t,i,r,s,o,a,l,c,g){this.t=i,this.s=s,this.c=o,this.p=r,this.r=a||B8,this.d=l||this,this.set=c||lT,this.pr=g||0,this._next=t,t&&(t._prev=this)}var e=n.prototype;return e.modifier=function(i,r,s){this.mSet=this.mSet||this.set,this.set=lve,this.m=i,this.mt=s,this.tween=r},n}();yo(rT+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(n){return iT[n]=1});ia.TweenMax=ia.TweenLite=zi;ia.TimelineLite=ia.TimelineMax=Ts;di=new Ts({sortChildren:!1,defaults:IC,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});qo.stringFilter=f8;var tf=[],G1={},cve=[],yX=0,gve=0,BZ=function(e){return(G1[e]||cve).map(function(t){return t()})},pW=function(){var e=Date.now(),t=[];e-yX>2&&(BZ("matchMediaInit"),tf.forEach(function(i){var r=i.queries,s=i.conditions,o,a,l,c;for(a in r)o=Ga.matchMedia(r[a]).matches,o&&(l=1),o!==s[a]&&(s[a]=o,c=1);c&&(i.revert(),l&&t.push(i))}),BZ("matchMediaRevert"),t.forEach(function(i){return i.onMatch(i)}),yX=e,BZ("matchMedia"))},x8=function(){function n(t,i){this.selector=i&&IW(i),this.data=[],this._r=[],this.isReverted=!1,this.id=gve++,t&&this.add(t)}var e=n.prototype;return e.add=function(i,r,s){wi(i)&&(s=r,r=i,i=wi);var o=this,a=function(){var c=bi,g=o.selector,u;return c&&c!==o&&c.data.push(o),s&&(o.selector=IW(s)),bi=o,u=r.apply(o,arguments),wi(u)&&o._r.push(u),bi=c,o.selector=g,o.isReverted=!1,u};return o.last=a,i===wi?a(o):i?o[i]=a:a},e.ignore=function(i){var r=bi;bi=null,i(this),bi=r},e.getTweens=function(){var i=[];return this.data.forEach(function(r){return r instanceof n?i.push.apply(i,r.getTweens()):r instanceof zi&&!(r.parent&&r.parent.data==="nested")&&i.push(r)}),i},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(i,r){var s=this;if(i){var o=this.getTweens();this.data.forEach(function(l){l.data==="isFlip"&&(l.revert(),l.getChildren(!0,!0,!1).forEach(function(c){return o.splice(o.indexOf(c),1)}))}),o.map(function(l){return{g:l.globalTime(0),t:l}}).sort(function(l,c){return c.g-l.g||-1}).forEach(function(l){return l.t.revert(i)}),this.data.forEach(function(l){return l instanceof Ts?l.data!=="nested"&&l.kill():!(l instanceof zi)&&l.revert&&l.revert(i)}),this._r.forEach(function(l){return l(i,s)}),this.isReverted=!0}else this.data.forEach(function(l){return l.kill&&l.kill()});if(this.clear(),r)for(var a=tf.length;a--;)tf[a].id===this.id&&tf.splice(a,1)},e.revert=function(i){this.kill(i||{})},n}(),uve=function(){function n(t){this.contexts=[],this.scope=t}var e=n.prototype;return e.add=function(i,r,s){Rc(i)||(i={matches:i});var o=new x8(0,s||this.scope),a=o.conditions={},l,c,g;bi&&!o.selector&&(o.selector=bi.selector),this.contexts.push(o),r=o.add("onMatch",r),o.queries=i;for(c in i)c==="all"?g=1:(l=Ga.matchMedia(i[c]),l&&(tf.indexOf(o)<0&&tf.push(o),(a[c]=l.matches)&&(g=1),l.addListener?l.addListener(pW):l.addEventListener("change",pW)));return g&&r(o),this},e.revert=function(i){this.kill(i||{})},e.kill=function(i){this.contexts.forEach(function(r){return r.kill(i,!0)})},n}(),W2={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(function(r){return u8(r)})},timeline:function(e){return new Ts(e)},getTweensOf:function(e,t){return di.getTweensOf(e,t)},getProperty:function(e,t,i,r){mr(e)&&(e=_a(e)[0]);var s=qh(e||{}).get,o=i?qj:jj;return i==="native"&&(i=""),e&&(t?o((Do[t]&&Do[t].get||s)(e,t,i,r)):function(a,l,c){return o((Do[a]&&Do[a].get||s)(e,a,l,c))})},quickSetter:function(e,t,i){if(e=_a(e),e.length>1){var r=e.map(function(g){return So.quickSetter(g,t,i)}),s=r.length;return function(g){for(var u=s;u--;)r[u](g)}}e=e[0]||{};var o=Do[t],a=qh(e),l=a.harness&&(a.harness.aliases||{})[t]||t,c=o?function(g){var u=new o;BA._pt=0,u.init(e,i?g+i:g,BA,0,[e]),u.render(1,u),BA._pt&&gT(1,BA)}:a.set(e,l);return o?c:function(g){return c(e,l,i?g+i:g,a,1)}},quickTo:function(e,t,i){var r,s=So.to(e,yf((r={},r[t]="+=0.1",r.paused=!0,r),i||{})),o=function(l,c,g){return s.resetTo(t,l,c,g)};return o.tween=s,o},isTweening:function(e){return di.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=ef(e.ease,IC.ease)),IX(IC,e||{})},config:function(e){return IX(qo,e||{})},registerEffect:function(e){var t=e.name,i=e.effect,r=e.plugins,s=e.defaults,o=e.extendTimeline;(r||"").split(",").forEach(function(a){return a&&!Do[a]&&!ia[a]&&R2(t+" effect requires "+a+" plugin.")}),mZ[t]=function(a,l,c){return i(_a(a),Xa(l||{},s),c)},o&&(Ts.prototype[t]=function(a,l,c){return this.add(mZ[t](a,Rc(l)?l:(c=l)&&{},this),c)})},registerEase:function(e,t){sn[e]=ef(t)},parseEase:function(e,t){return arguments.length?ef(e,t):sn},getById:function(e){return di.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var i=new Ts(e),r,s;for(i.smoothChildTiming=mo(e.smoothChildTiming),di.remove(i),i._dp=0,i._time=i._tTime=di._time,r=di._first;r;)s=r._next,(t||!(!r._dur&&r instanceof zi&&r.vars.onComplete===r._targets[0]))&&dc(i,r,r._start-r._delay),r=s;return dc(di,i,0),i},context:function(e,t){return e?new x8(e,t):bi},matchMedia:function(e){return new uve(e)},matchMediaRefresh:function(){return tf.forEach(function(e){var t=e.conditions,i,r;for(r in t)t[r]&&(t[r]=!1,i=1);i&&e.revert()})||pW()},addEventListener:function(e,t){var i=G1[e]||(G1[e]=[]);~i.indexOf(t)||i.push(t)},removeEventListener:function(e,t){var i=G1[e],r=i&&i.indexOf(t);r>=0&&i.splice(r,1)},utils:{wrap:Yye,wrapYoyo:Kye,distribute:s8,random:a8,snap:o8,normalize:Xye,getUnit:rs,clamp:kye,splitColor:d8,toArray:_a,selector:IW,mapRange:c8,pipe:Hye,unitize:zye,interpolate:Dye,shuffle:r8},install:Pj,effects:mZ,ticker:Uo,updateRoot:Ts.updateRoot,plugins:Do,globalTimeline:di,core:{PropTween:vo,globals:Uj,Tween:zi,Timeline:Ts,Animation:Hy,getCache:qh,_removeLinkedListItem:rx,reverting:function(){return ls},context:function(e){return e&&bi&&(bi.data.push(e),e._ctx=bi),bi},suppressOverwrites:function(e){return qV=e}}};yo("to,from,fromTo,delayedCall,set,killTweensOf",function(n){return W2[n]=zi[n]});Uo.add(Ts.updateRoot);BA=W2.to({},{duration:0});var dve=function(e,t){for(var i=e._pt;i&&i.p!==t&&i.op!==t&&i.fp!==t;)i=i._next;return i},hve=function(e,t){var i=e._targets,r,s,o;for(r in t)for(s=i.length;s--;)o=e._ptLookup[s][r],o&&(o=o.d)&&(o._pt&&(o=dve(o,r)),o&&o.modifier&&o.modifier(t[r],e,i[s],r))},GZ=function(e,t){return{name:e,rawVars:1,init:function(r,s,o){o._onInit=function(a){var l,c;if(mr(s)&&(l={},yo(s,function(g){return l[g]=1}),s=l),t){l={};for(c in s)l[c]=t(s[c]);s=l}hve(a,s)}}}},So=W2.registerPlugin({name:"attr",init:function(e,t,i,r,s){var o,a,l;this.tween=i;for(o in t)l=e.getAttribute(o)||"",a=this.add(e,"setAttribute",(l||0)+"",t[o],r,s,0,0,o),a.op=o,a.b=l,this._props.push(o)},render:function(e,t){for(var i=t._pt;i;)ls?i.set(i.t,i.p,i.b,i):i.r(e,i.d),i=i._next}},{name:"endArray",init:function(e,t){for(var i=t.length;i--;)this.add(e,i,e[i]||0,t[i],0,0,0,0,0,1)}},GZ("roundProps",AW),GZ("modifiers"),GZ("snap",o8))||W2;zi.version=Ts.version=So.version="3.12.0";Dj=1;eT()&&pC();sn.Power0;sn.Power1;sn.Power2;sn.Power3;sn.Power4;sn.Linear;sn.Quad;sn.Cubic;sn.Quart;sn.Quint;sn.Strong;sn.Elastic;sn.Back;sn.SteppedEase;sn.Bounce;sn.Sine;sn.Expo;sn.Circ;/*!
 * CSSPlugin 3.12.0
 * https://greensock.com
 *
 * Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var vX,Ou,KA,uT,Xh,bX,dT,fve=function(){return typeof window<"u"},Qg={},bh=180/Math.PI,DA=Math.PI/180,MI=Math.atan2,BX=1e8,hT=/([A-Z])/g,Ive=/(left|right|width|margin|padding|x)/i,Ave=/[\s,\(]\S/,fc={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},mW=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},Cve=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},pve=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},mve=function(e,t){var i=t.s+t.c*e;t.set(t.t,t.p,~~(i+(i<0?-.5:.5))+t.u,t)},S8=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},R8=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},yve=function(e,t,i){return e.style[t]=i},vve=function(e,t,i){return e.style.setProperty(t,i)},bve=function(e,t,i){return e._gsap[t]=i},Bve=function(e,t,i){return e._gsap.scaleX=e._gsap.scaleY=i},Gve=function(e,t,i,r,s){var o=e._gsap;o.scaleX=o.scaleY=i,o.renderTransform(s,o)},wve=function(e,t,i,r,s){var o=e._gsap;o[t]=i,o.renderTransform(s,o)},fi="transform",wl=fi+"Origin",xve=function n(e,t){var i=this,r=this.target,s=r.style;if(e in Qg&&s){if(this.tfm=this.tfm||{},e!=="transform")e=fc[e]||e,~e.indexOf(",")?e.split(",").forEach(function(o){return i.tfm[o]=yg(r,o)}):this.tfm[e]=r._gsap.x?r._gsap[e]:yg(r,e);else return fc.transform.split(",").forEach(function(o){return n.call(i,o,t)});if(this.props.indexOf(fi)>=0)return;r._gsap.svg&&(this.svgo=r.getAttribute("data-svg-origin"),this.props.push(wl,t,"")),e=fi}(s||t)&&this.props.push(e,t,s[e])},Z8=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},Sve=function(){var e=this.props,t=this.target,i=t.style,r=t._gsap,s,o;for(s=0;s<e.length;s+=3)e[s+1]?t[e[s]]=e[s+2]:e[s+2]?i[e[s]]=e[s+2]:i.removeProperty(e[s].substr(0,2)==="--"?e[s]:e[s].replace(hT,"-$1").toLowerCase());if(this.tfm){for(o in this.tfm)r[o]=this.tfm[o];r.svg&&(r.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),s=dT(),(!s||!s.isStart)&&!i[fi]&&(Z8(i),r.uncache=1)}},M8=function(e,t){var i={target:e,props:[],revert:Sve,save:xve};return e._gsap||So.core.getCache(e),t&&t.split(",").forEach(function(r){return i.save(r)}),i},E8,yW=function(e,t){var i=Ou.createElementNS?Ou.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Ou.createElement(e);return i.style?i:Ou.createElement(e)},bc=function n(e,t,i){var r=getComputedStyle(e);return r[t]||r.getPropertyValue(t.replace(hT,"-$1").toLowerCase())||r.getPropertyValue(t)||!i&&n(e,mC(t)||t,1)||""},GX="O,Moz,ms,Ms,Webkit".split(","),mC=function(e,t,i){var r=t||Xh,s=r.style,o=5;if(e in s&&!i)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);o--&&!(GX[o]+e in s););return o<0?null:(o===3?"ms":o>=0?GX[o]:"")+e},vW=function(){fve()&&window.document&&(vX=window,Ou=vX.document,KA=Ou.documentElement,Xh=yW("div")||{style:{}},yW("div"),fi=mC(fi),wl=fi+"Origin",Xh.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",E8=!!mC("perspective"),dT=So.core.reverting,uT=1)},wZ=function n(e){var t=yW("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=this.parentNode,r=this.nextSibling,s=this.style.cssText,o;if(KA.appendChild(t),t.appendChild(this),this.style.display="block",e)try{o=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=n}catch{}else this._gsapBBox&&(o=this._gsapBBox());return i&&(r?i.insertBefore(this,r):i.appendChild(this)),KA.removeChild(t),this.style.cssText=s,o},wX=function(e,t){for(var i=t.length;i--;)if(e.hasAttribute(t[i]))return e.getAttribute(t[i])},W8=function(e){var t;try{t=e.getBBox()}catch{t=wZ.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===wZ||(t=wZ.call(e,!0)),t&&!t.width&&!t.x&&!t.y?{x:+wX(e,["x","cx","x1"])||0,y:+wX(e,["y","cy","y1"])||0,width:0,height:0}:t},F8=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&W8(e))},zy=function(e,t){if(t){var i=e.style;t in Qg&&t!==wl&&(t=fi),i.removeProperty?((t.substr(0,2)==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),i.removeProperty(t.replace(hT,"-$1").toLowerCase())):i.removeAttribute(t)}},Ju=function(e,t,i,r,s,o){var a=new vo(e._pt,t,i,0,1,o?R8:S8);return e._pt=a,a.b=r,a.e=s,e._props.push(i),a},xX={deg:1,rad:1,turn:1},Rve={grid:1,flex:1},bd=function n(e,t,i,r){var s=parseFloat(i)||0,o=(i+"").trim().substr((s+"").length)||"px",a=Xh.style,l=Ive.test(t),c=e.tagName.toLowerCase()==="svg",g=(c?"client":"offset")+(l?"Width":"Height"),u=100,d=r==="px",h=r==="%",f,I,A,p;return r===o||!s||xX[r]||xX[o]?s:(o!=="px"&&!d&&(s=n(e,t,i,"px")),p=e.getCTM&&F8(e),(h||o==="%")&&(Qg[t]||~t.indexOf("adius"))?(f=p?e.getBBox()[l?"width":"height"]:e[g],Mi(h?s/f*u:s/100*f)):(a[l?"width":"height"]=u+(d?o:r),I=~t.indexOf("adius")||r==="em"&&e.appendChild&&!c?e:e.parentNode,p&&(I=(e.ownerSVGElement||{}).parentNode),(!I||I===Ou||!I.appendChild)&&(I=Ou.body),A=I._gsap,A&&h&&A.width&&l&&A.time===Uo.time&&!A.uncache?Mi(s/A.width*u):((h||o==="%")&&!Rve[bc(I,"display")]&&(a.position=bc(e,"position")),I===e&&(a.position="static"),I.appendChild(Xh),f=Xh[g],I.removeChild(Xh),a.position="absolute",l&&h&&(A=qh(I),A.time=Uo.time,A.width=I[g]),Mi(d?f*s/u:f&&s?u/f*s:0))))},yg=function(e,t,i,r){var s;return uT||vW(),t in fc&&t!=="transform"&&(t=fc[t],~t.indexOf(",")&&(t=t.split(",")[0])),Qg[t]&&t!=="transform"?(s=Yy(e,r),s=t!=="transformOrigin"?s[t]:s.svg?s.origin:_2(bc(e,wl))+" "+s.zOrigin+"px"):(s=e.style[t],(!s||s==="auto"||r||~(s+"").indexOf("calc("))&&(s=F2[t]&&F2[t](e,t,i)||bc(e,t)||Oj(e,t)||(t==="opacity"?1:0))),i&&!~(s+"").trim().indexOf(" ")?bd(e,t,s,i)+i:s},Zve=function(e,t,i,r){if(!i||i==="none"){var s=mC(t,e,1),o=s&&bc(e,s,1);o&&o!==i?(t=s,i=o):t==="borderColor"&&(i=bc(e,"borderTopColor"))}var a=new vo(this._pt,e.style,t,0,1,G8),l=0,c=0,g,u,d,h,f,I,A,p,y,v,b,w;if(a.b=i,a.e=r,i+="",r+="",r==="auto"&&(e.style[t]=r,r=bc(e,t)||r,e.style[t]=i),g=[i,r],f8(g),i=g[0],r=g[1],d=i.match(bA)||[],w=r.match(bA)||[],w.length){for(;u=bA.exec(r);)A=u[0],y=r.substring(l,u.index),f?f=(f+1)%5:(y.substr(-5)==="rgba("||y.substr(-5)==="hsla(")&&(f=1),A!==(I=d[c++]||"")&&(h=parseFloat(I)||0,b=I.substr((h+"").length),A.charAt(1)==="="&&(A=YA(h,A)+b),p=parseFloat(A),v=A.substr((p+"").length),l=bA.lastIndex-v.length,v||(v=v||qo.units[t]||b,l===r.length&&(r+=v,a.e+=v)),b!==v&&(h=bd(e,t,I,v)||0),a._pt={_next:a._pt,p:y||c===1?y:",",s:h,c:p-h,m:f&&f<4||t==="zIndex"?Math.round:0});a.c=l<r.length?r.substring(l,r.length):""}else a.r=t==="display"&&r==="none"?R8:S8;return Yj.test(r)&&(a.e=0),this._pt=a,a},SX={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Mve=function(e){var t=e.split(" "),i=t[0],r=t[1]||"50%";return(i==="top"||i==="bottom"||r==="left"||r==="right")&&(e=i,i=r,r=e),t[0]=SX[i]||i,t[1]=SX[r]||r,t.join(" ")},Eve=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var i=t.t,r=i.style,s=t.u,o=i._gsap,a,l,c;if(s==="all"||s===!0)r.cssText="",l=1;else for(s=s.split(","),c=s.length;--c>-1;)a=s[c],Qg[a]&&(l=1,a=a==="transformOrigin"?wl:fi),zy(i,a);l&&(zy(i,fi),o&&(o.svg&&i.removeAttribute("transform"),Yy(i,1),o.uncache=1,Z8(r)))}},F2={clearProps:function(e,t,i,r,s){if(s.data!=="isFromStart"){var o=e._pt=new vo(e._pt,t,i,0,0,Eve);return o.u=r,o.pr=-10,o.tween=s,e._props.push(i),1}}},Xy=[1,0,0,1,0,0],_8={},V8=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},RX=function(e){var t=bc(e,fi);return V8(t)?Xy:t.substr(7).match(Xj).map(Mi)},fT=function(e,t){var i=e._gsap||qh(e),r=e.style,s=RX(e),o,a,l,c;return i.svg&&e.getAttribute("transform")?(l=e.transform.baseVal.consolidate().matrix,s=[l.a,l.b,l.c,l.d,l.e,l.f],s.join(",")==="1,0,0,1,0,0"?Xy:s):(s===Xy&&!e.offsetParent&&e!==KA&&!i.svg&&(l=r.display,r.display="block",o=e.parentNode,(!o||!e.offsetParent)&&(c=1,a=e.nextElementSibling,KA.appendChild(e)),s=RX(e),l?r.display=l:zy(e,"display"),c&&(a?o.insertBefore(e,a):o?o.appendChild(e):KA.removeChild(e))),t&&s.length>6?[s[0],s[1],s[4],s[5],s[12],s[13]]:s)},bW=function(e,t,i,r,s,o){var a=e._gsap,l=s||fT(e,!0),c=a.xOrigin||0,g=a.yOrigin||0,u=a.xOffset||0,d=a.yOffset||0,h=l[0],f=l[1],I=l[2],A=l[3],p=l[4],y=l[5],v=t.split(" "),b=parseFloat(v[0])||0,w=parseFloat(v[1])||0,G,x,B,R;i?l!==Xy&&(x=h*A-f*I)&&(B=b*(A/x)+w*(-I/x)+(I*y-A*p)/x,R=b*(-f/x)+w*(h/x)-(h*y-f*p)/x,b=B,w=R):(G=W8(e),b=G.x+(~v[0].indexOf("%")?b/100*G.width:b),w=G.y+(~(v[1]||v[0]).indexOf("%")?w/100*G.height:w)),r||r!==!1&&a.smooth?(p=b-c,y=w-g,a.xOffset=u+(p*h+y*I)-p,a.yOffset=d+(p*f+y*A)-y):a.xOffset=a.yOffset=0,a.xOrigin=b,a.yOrigin=w,a.smooth=!!r,a.origin=t,a.originIsAbsolute=!!i,e.style[wl]="0px 0px",o&&(Ju(o,a,"xOrigin",c,b),Ju(o,a,"yOrigin",g,w),Ju(o,a,"xOffset",u,a.xOffset),Ju(o,a,"yOffset",d,a.yOffset)),e.setAttribute("data-svg-origin",b+" "+w)},Yy=function(e,t){var i=e._gsap||new p8(e);if("x"in i&&!t&&!i.uncache)return i;var r=e.style,s=i.scaleX<0,o="px",a="deg",l=getComputedStyle(e),c=bc(e,wl)||"0",g,u,d,h,f,I,A,p,y,v,b,w,G,x,B,R,Z,W,F,T,V,z,U,J,H,Y,K,Q,P,ne,oe,$;return g=u=d=I=A=p=y=v=b=0,h=f=1,i.svg=!!(e.getCTM&&F8(e)),l.translate&&((l.translate!=="none"||l.scale!=="none"||l.rotate!=="none")&&(r[fi]=(l.translate!=="none"?"translate3d("+(l.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(l.rotate!=="none"?"rotate("+l.rotate+") ":"")+(l.scale!=="none"?"scale("+l.scale.split(" ").join(",")+") ":"")+(l[fi]!=="none"?l[fi]:"")),r.scale=r.rotate=r.translate="none"),x=fT(e,i.svg),i.svg&&(i.uncache?(H=e.getBBox(),c=i.xOrigin-H.x+"px "+(i.yOrigin-H.y)+"px",J=""):J=!t&&e.getAttribute("data-svg-origin"),bW(e,J||c,!!J||i.originIsAbsolute,i.smooth!==!1,x)),w=i.xOrigin||0,G=i.yOrigin||0,x!==Xy&&(W=x[0],F=x[1],T=x[2],V=x[3],g=z=x[4],u=U=x[5],x.length===6?(h=Math.sqrt(W*W+F*F),f=Math.sqrt(V*V+T*T),I=W||F?MI(F,W)*bh:0,y=T||V?MI(T,V)*bh+I:0,y&&(f*=Math.abs(Math.cos(y*DA))),i.svg&&(g-=w-(w*W+G*T),u-=G-(w*F+G*V))):($=x[6],ne=x[7],K=x[8],Q=x[9],P=x[10],oe=x[11],g=x[12],u=x[13],d=x[14],B=MI($,P),A=B*bh,B&&(R=Math.cos(-B),Z=Math.sin(-B),J=z*R+K*Z,H=U*R+Q*Z,Y=$*R+P*Z,K=z*-Z+K*R,Q=U*-Z+Q*R,P=$*-Z+P*R,oe=ne*-Z+oe*R,z=J,U=H,$=Y),B=MI(-T,P),p=B*bh,B&&(R=Math.cos(-B),Z=Math.sin(-B),J=W*R-K*Z,H=F*R-Q*Z,Y=T*R-P*Z,oe=V*Z+oe*R,W=J,F=H,T=Y),B=MI(F,W),I=B*bh,B&&(R=Math.cos(B),Z=Math.sin(B),J=W*R+F*Z,H=z*R+U*Z,F=F*R-W*Z,U=U*R-z*Z,W=J,z=H),A&&Math.abs(A)+Math.abs(I)>359.9&&(A=I=0,p=180-p),h=Mi(Math.sqrt(W*W+F*F+T*T)),f=Mi(Math.sqrt(U*U+$*$)),B=MI(z,U),y=Math.abs(B)>2e-4?B*bh:0,b=oe?1/(oe<0?-oe:oe):0),i.svg&&(J=e.getAttribute("transform"),i.forceCSS=e.setAttribute("transform","")||!V8(bc(e,fi)),J&&e.setAttribute("transform",J))),Math.abs(y)>90&&Math.abs(y)<270&&(s?(h*=-1,y+=I<=0?180:-180,I+=I<=0?180:-180):(f*=-1,y+=y<=0?180:-180)),t=t||i.uncache,i.x=g-((i.xPercent=g&&(!t&&i.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-g)?-50:0)))?e.offsetWidth*i.xPercent/100:0)+o,i.y=u-((i.yPercent=u&&(!t&&i.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-u)?-50:0)))?e.offsetHeight*i.yPercent/100:0)+o,i.z=d+o,i.scaleX=Mi(h),i.scaleY=Mi(f),i.rotation=Mi(I)+a,i.rotationX=Mi(A)+a,i.rotationY=Mi(p)+a,i.skewX=y+a,i.skewY=v+a,i.transformPerspective=b+o,(i.zOrigin=parseFloat(c.split(" ")[2])||0)&&(r[wl]=_2(c)),i.xOffset=i.yOffset=0,i.force3D=qo.force3D,i.renderTransform=i.svg?Fve:E8?T8:Wve,i.uncache=0,i},_2=function(e){return(e=e.split(" "))[0]+" "+e[1]},xZ=function(e,t,i){var r=rs(t);return Mi(parseFloat(t)+parseFloat(bd(e,"x",i+"px",r)))+r},Wve=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,T8(e,t)},oh="0deg",Sm="0px",ah=") ",T8=function(e,t){var i=t||this,r=i.xPercent,s=i.yPercent,o=i.x,a=i.y,l=i.z,c=i.rotation,g=i.rotationY,u=i.rotationX,d=i.skewX,h=i.skewY,f=i.scaleX,I=i.scaleY,A=i.transformPerspective,p=i.force3D,y=i.target,v=i.zOrigin,b="",w=p==="auto"&&e&&e!==1||p===!0;if(v&&(u!==oh||g!==oh)){var G=parseFloat(g)*DA,x=Math.sin(G),B=Math.cos(G),R;G=parseFloat(u)*DA,R=Math.cos(G),o=xZ(y,o,x*R*-v),a=xZ(y,a,-Math.sin(G)*-v),l=xZ(y,l,B*R*-v+v)}A!==Sm&&(b+="perspective("+A+ah),(r||s)&&(b+="translate("+r+"%, "+s+"%) "),(w||o!==Sm||a!==Sm||l!==Sm)&&(b+=l!==Sm||w?"translate3d("+o+", "+a+", "+l+") ":"translate("+o+", "+a+ah),c!==oh&&(b+="rotate("+c+ah),g!==oh&&(b+="rotateY("+g+ah),u!==oh&&(b+="rotateX("+u+ah),(d!==oh||h!==oh)&&(b+="skew("+d+", "+h+ah),(f!==1||I!==1)&&(b+="scale("+f+", "+I+ah),y.style[fi]=b||"translate(0, 0)"},Fve=function(e,t){var i=t||this,r=i.xPercent,s=i.yPercent,o=i.x,a=i.y,l=i.rotation,c=i.skewX,g=i.skewY,u=i.scaleX,d=i.scaleY,h=i.target,f=i.xOrigin,I=i.yOrigin,A=i.xOffset,p=i.yOffset,y=i.forceCSS,v=parseFloat(o),b=parseFloat(a),w,G,x,B,R;l=parseFloat(l),c=parseFloat(c),g=parseFloat(g),g&&(g=parseFloat(g),c+=g,l+=g),l||c?(l*=DA,c*=DA,w=Math.cos(l)*u,G=Math.sin(l)*u,x=Math.sin(l-c)*-d,B=Math.cos(l-c)*d,c&&(g*=DA,R=Math.tan(c-g),R=Math.sqrt(1+R*R),x*=R,B*=R,g&&(R=Math.tan(g),R=Math.sqrt(1+R*R),w*=R,G*=R)),w=Mi(w),G=Mi(G),x=Mi(x),B=Mi(B)):(w=u,B=d,G=x=0),(v&&!~(o+"").indexOf("px")||b&&!~(a+"").indexOf("px"))&&(v=bd(h,"x",o,"px"),b=bd(h,"y",a,"px")),(f||I||A||p)&&(v=Mi(v+f-(f*w+I*x)+A),b=Mi(b+I-(f*G+I*B)+p)),(r||s)&&(R=h.getBBox(),v=Mi(v+r/100*R.width),b=Mi(b+s/100*R.height)),R="matrix("+w+","+G+","+x+","+B+","+v+","+b+")",h.setAttribute("transform",R),y&&(h.style[fi]=R)},_ve=function(e,t,i,r,s){var o=360,a=mr(s),l=parseFloat(s)*(a&&~s.indexOf("rad")?bh:1),c=l-r,g=r+c+"deg",u,d;return a&&(u=s.split("_")[1],u==="short"&&(c%=o,c!==c%(o/2)&&(c+=c<0?o:-o)),u==="cw"&&c<0?c=(c+o*BX)%o-~~(c/o)*o:u==="ccw"&&c>0&&(c=(c-o*BX)%o-~~(c/o)*o)),e._pt=d=new vo(e._pt,t,i,r,c,Cve),d.e=g,d.u="deg",e._props.push(i),d},ZX=function(e,t){for(var i in t)e[i]=t[i];return e},Vve=function(e,t,i){var r=ZX({},i._gsap),s="perspective,force3D,transformOrigin,svgOrigin",o=i.style,a,l,c,g,u,d,h,f;r.svg?(c=i.getAttribute("transform"),i.setAttribute("transform",""),o[fi]=t,a=Yy(i,1),zy(i,fi),i.setAttribute("transform",c)):(c=getComputedStyle(i)[fi],o[fi]=t,a=Yy(i,1),o[fi]=c);for(l in Qg)c=r[l],g=a[l],c!==g&&s.indexOf(l)<0&&(h=rs(c),f=rs(g),u=h!==f?bd(i,l,c,f):parseFloat(c),d=parseFloat(g),e._pt=new vo(e._pt,a,l,u,d-u,mW),e._pt.u=f||0,e._props.push(l));ZX(a,r)};yo("padding,margin,Width,Radius",function(n,e){var t="Top",i="Right",r="Bottom",s="Left",o=(e<3?[t,i,r,s]:[t+s,t+i,r+i,r+s]).map(function(a){return e<2?n+a:"border"+a+n});F2[e>1?"border"+n:n]=function(a,l,c,g,u){var d,h;if(arguments.length<4)return d=o.map(function(f){return yg(a,f,c)}),h=d.join(" "),h.split(d[0]).length===5?d[0]:h;d=(g+"").split(" "),h={},o.forEach(function(f,I){return h[f]=d[I]=d[I]||d[(I-1)/2|0]}),a.init(l,h,u)}});var N8={name:"css",register:vW,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,i,r,s){var o=this._props,a=e.style,l=i.vars.startAt,c,g,u,d,h,f,I,A,p,y,v,b,w,G,x,B;uT||vW(),this.styles=this.styles||M8(e),B=this.styles.props,this.tween=i;for(I in t)if(I!=="autoRound"&&(g=t[I],!(Do[I]&&m8(I,t,i,r,e,s)))){if(h=typeof g,f=F2[I],h==="function"&&(g=g.call(i,r,e,s),h=typeof g),h==="string"&&~g.indexOf("random(")&&(g=ky(g)),f)f(this,e,I,g,i)&&(x=1);else if(I.substr(0,2)==="--")c=(getComputedStyle(e).getPropertyValue(I)+"").trim(),g+="",dd.lastIndex=0,dd.test(c)||(A=rs(c),p=rs(g)),p?A!==p&&(c=bd(e,I,c,p)+p):A&&(g+=A),this.add(a,"setProperty",c,g,r,s,0,0,I),o.push(I),B.push(I,0,a[I]);else if(h!=="undefined"){if(l&&I in l?(c=typeof l[I]=="function"?l[I].call(i,r,e,s):l[I],mr(c)&&~c.indexOf("random(")&&(c=ky(c)),rs(c+"")||(c+=qo.units[I]||rs(yg(e,I))||""),(c+"").charAt(1)==="="&&(c=yg(e,I))):c=yg(e,I),d=parseFloat(c),y=h==="string"&&g.charAt(1)==="="&&g.substr(0,2),y&&(g=g.substr(2)),u=parseFloat(g),I in fc&&(I==="autoAlpha"&&(d===1&&yg(e,"visibility")==="hidden"&&u&&(d=0),B.push("visibility",0,a.visibility),Ju(this,a,"visibility",d?"inherit":"hidden",u?"inherit":"hidden",!u)),I!=="scale"&&I!=="transform"&&(I=fc[I],~I.indexOf(",")&&(I=I.split(",")[0]))),v=I in Qg,v){if(this.styles.save(I),b||(w=e._gsap,w.renderTransform&&!t.parseTransform||Yy(e,t.parseTransform),G=t.smoothOrigin!==!1&&w.smooth,b=this._pt=new vo(this._pt,a,fi,0,1,w.renderTransform,w,0,-1),b.dep=1),I==="scale")this._pt=new vo(this._pt,w,"scaleY",w.scaleY,(y?YA(w.scaleY,y+u):u)-w.scaleY||0,mW),this._pt.u=0,o.push("scaleY",I),I+="X";else if(I==="transformOrigin"){B.push(wl,0,a[wl]),g=Mve(g),w.svg?bW(e,g,0,G,0,this):(p=parseFloat(g.split(" ")[2])||0,p!==w.zOrigin&&Ju(this,w,"zOrigin",w.zOrigin,p),Ju(this,a,I,_2(c),_2(g)));continue}else if(I==="svgOrigin"){bW(e,g,1,G,0,this);continue}else if(I in _8){_ve(this,w,I,d,y?YA(d,y+g):g);continue}else if(I==="smoothOrigin"){Ju(this,w,"smooth",w.smooth,g);continue}else if(I==="force3D"){w[I]=g;continue}else if(I==="transform"){Vve(this,g,e);continue}}else I in a||(I=mC(I)||I);if(v||(u||u===0)&&(d||d===0)&&!Ave.test(g)&&I in a)A=(c+"").substr((d+"").length),u||(u=0),p=rs(g)||(I in qo.units?qo.units[I]:A),A!==p&&(d=bd(e,I,c,p)),this._pt=new vo(this._pt,v?w:a,I,d,(y?YA(d,y+u):u)-d,!v&&(p==="px"||I==="zIndex")&&t.autoRound!==!1?mve:mW),this._pt.u=p||0,A!==p&&p!=="%"&&(this._pt.b=c,this._pt.r=pve);else if(I in a)Zve.call(this,e,I,c,y?y+g:g);else if(I in e)this.add(e,I,c||e[I],y?y+g:g,r,s);else if(I!=="parseTransform"){nT(I,g);continue}v||(I in a?B.push(I,0,a[I]):B.push(I,1,c||e[I])),o.push(I)}}x&&w8(this)},render:function(e,t){if(t.tween._time||!dT())for(var i=t._pt;i;)i.r(e,i.d),i=i._next;else t.styles.revert()},get:yg,aliases:fc,getSetter:function(e,t,i){var r=fc[t];return r&&r.indexOf(",")<0&&(t=r),t in Qg&&t!==wl&&(e._gsap.x||yg(e,"x"))?i&&bX===i?t==="scale"?Bve:bve:(bX=i||{})&&(t==="scale"?Gve:wve):e.style&&!$V(e.style[t])?yve:~t.indexOf("-")?vve:cT(e,t)},core:{_removeProperty:zy,_getMatrix:fT}};So.utils.checkPrefix=mC;So.core.getStyleSaver=M8;(function(n,e,t,i){var r=yo(n+","+e+","+t,function(s){Qg[s]=1});yo(e,function(s){qo.units[s]="deg",_8[s]=1}),fc[r[13]]=n+","+e,yo(i,function(s){var o=s.split(":");fc[o[1]]=r[o[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");yo("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(n){qo.units[n]="px"});So.registerPlugin(N8);var w1=So.registerPlugin(N8)||So;w1.core.Tween;const k8=M.createContext(),Tve=({children:n})=>{const[e,t]=M.useState(!1),[i,r]=M.useState(!1),[s,o]=M.useState(!1);return We(k8.Provider,{value:{play:e,setPlay:t,end:i,setEnd:r,hasScroll:s,setHasScroll:o},children:n})},IT=()=>{const n=M.useContext(k8);if(n===void 0)throw new Error("usePlay must be used within a PlayProvider");return n},L8=n=>n.replace("#include <common>",`#include <common>
  float exponentialEasing(float x, float a) {
  
    float epsilon = 0.00001;
    float min_param_a = 0.0 + epsilon;
    float max_param_a = 1.0 - epsilon;
    a = max(min_param_a, min(max_param_a, a));
    
    if (a < 0.5){
      // emphasis
      a = 2.0*(a);
      float y = pow(x, a);
      return y;
    } else {
      // de-emphasis
      a = 2.0*(a-0.5);
      float y = pow(x, 1.0/(1.0-a));
      return y;
    }
  }`).replace("vec4 diffuseColor = vec4( diffuse, opacity );",`
float fadeDist = 350.0;
float dist = length(vViewPosition);

float fadeOpacity = smoothstep(fadeDist, 0.0, dist);
fadeOpacity = exponentialEasing(fadeOpacity, 0.93);
vec4 diffuseColor = vec4( diffuse, fadeOpacity * opacity );`),H8=n=>{n.fragmentShader=L8(n.fragmentShader)},MX=n=>{n.fragmentShader=L8(n.fragmentShader).replace("#include <output_fragment>","gl_FragColor = diffuseColor;")};function Nve(n){const{nodes:e,materials:t}=YC("./models/airplane/CloudShip.glb");return We("group",{...n,dispose:null,children:We("group",{rotation:[-Math.PI/2,0,0],children:cn("group",{rotation:[Math.PI/2,0,0],scale:.01,children:[We("group",{position:[0,59.417,0],rotation:[-Math.PI/2,-1.57,0],children:We("mesh",{geometry:e.balloon_flying_ship_balloon_flying_ship_0.geometry,material:e.balloon_flying_ship_balloon_flying_ship_0.material,position:[.148,-.283,-28.919]})}),We("group",{position:[-9.264,-8.344,0],rotation:[-Math.PI/2,0,0],scale:.661,children:We("mesh",{geometry:e.flying_ship_flying_ship_0.geometry,material:e.flying_ship_flying_ship_0.material,position:[4.55,0,8.344]})}),We("group",{position:[4.152,-1.003,.005],rotation:[-Math.PI/2,0,0],children:We("mesh",{geometry:e.cabin_flying_ship_cabin_flying_ship_0.geometry,material:e.cabin_flying_ship_cabin_flying_ship_0.material,position:[0,.005,1]})}),We("group",{position:[4.152,-1.003,.005],rotation:[-Math.PI/2,0,0],children:We("mesh",{geometry:e.window_flying_ship_window_door_flying_ship_0.geometry,material:e.window_flying_ship_window_door_flying_ship_0.material,position:[0,.005,1]})}),We("group",{position:[4.152,-1.003,.005],rotation:[-Math.PI/2,0,0],children:We("mesh",{geometry:e.door_part_flying_ship_window_door_flying_ship_0.geometry,material:e.door_part_flying_ship_window_door_flying_ship_0.material,position:[0,.005,1]})}),We("group",{position:[17.24,.545,-2.16],rotation:[-Math.PI/2,0,0],children:cn("group",{position:[-13.088,-2.165,-1.549],children:[We("mesh",{geometry:e.door_door_part_3_flying_ship_0.geometry,material:e.door_door_part_3_flying_ship_0.material}),We("mesh",{geometry:e.door_door_part_4_flying_ship_0.geometry,material:e.door_door_part_4_flying_ship_0.material}),We("mesh",{geometry:e.door_flying_ship_0.geometry,material:e.door_flying_ship_0.material})]})}),We("group",{position:[34.774,2.247,0],children:cn("group",{position:[-3.374,1.185,0],children:[We("mesh",{geometry:e.Line017_door_part_3_flying_ship_0.geometry,material:e.Line017_door_part_3_flying_ship_0.material}),We("mesh",{geometry:e.Line017_paddle_flying_ship_0.geometry,material:e.Line017_paddle_flying_ship_0.material})]})}),We("group",{position:[34.774,2.247,0],rotation:[1.358,1.55,.221],scale:[.614,.634,.845],children:cn("group",{position:[-.621,-42.192,-4.887],children:[We("mesh",{geometry:e.paddle_flying_ship010_paddle_flying_ship_0.geometry,material:e.paddle_flying_ship010_paddle_flying_ship_0.material}),We("mesh",{geometry:e.paddle_flying_ship010_sail_flying_ship_0.geometry,material:e.paddle_flying_ship010_sail_flying_ship_0.material})]})}),We("group",{position:[34.774,2.247,0],rotation:[.572,1.55,.221],scale:[.614,.634,.845],children:cn("group",{position:[-.621,-42.192,-4.887],children:[We("mesh",{geometry:e.paddle_flying_ship011_paddle_flying_ship_0.geometry,material:e.paddle_flying_ship011_paddle_flying_ship_0.material}),We("mesh",{geometry:e.paddle_flying_ship011_sail_flying_ship_0.geometry,material:e.paddle_flying_ship011_sail_flying_ship_0.material})]})}),We("group",{position:[34.774,2.247,0],rotation:[-.213,1.55,.221],scale:[.614,.634,.845],children:cn("group",{position:[-.621,-42.192,-4.887],children:[We("mesh",{geometry:e.paddle_flying_ship012_paddle_flying_ship_0.geometry,material:e.paddle_flying_ship012_paddle_flying_ship_0.material}),We("mesh",{geometry:e.paddle_flying_ship012_sail_flying_ship_0.geometry,material:e.paddle_flying_ship012_sail_flying_ship_0.material})]})}),We("group",{position:[34.774,2.247,0],rotation:[-.998,1.55,.221],scale:[.614,.634,.845],children:cn("group",{position:[-.621,-42.192,-4.887],children:[We("mesh",{geometry:e.paddle_flying_ship013_paddle_flying_ship_0.geometry,material:e.paddle_flying_ship013_paddle_flying_ship_0.material}),We("mesh",{geometry:e.paddle_flying_ship013_sail_flying_ship_0.geometry,material:e.paddle_flying_ship013_sail_flying_ship_0.material})]})}),We("group",{position:[34.774,2.247,0],rotation:[-1.784,1.55,.221],scale:[.614,.634,.845],children:cn("group",{position:[-.621,-42.192,-4.887],children:[We("mesh",{geometry:e.paddle_flying_ship014_paddle_flying_ship_0.geometry,material:e.paddle_flying_ship014_paddle_flying_ship_0.material}),We("mesh",{geometry:e.paddle_flying_ship014_sail_flying_ship_0.geometry,material:e.paddle_flying_ship014_sail_flying_ship_0.material})]})}),We("group",{position:[34.774,2.247,0],rotation:[-2.569,1.55,.221],scale:[.614,.634,.845],children:cn("group",{position:[-.621,-42.192,-4.887],children:[We("mesh",{geometry:e.paddle_flying_ship015_paddle_flying_ship_0.geometry,material:e.paddle_flying_ship015_paddle_flying_ship_0.material}),We("mesh",{geometry:e.paddle_flying_ship015_sail_flying_ship_0.geometry,material:e.paddle_flying_ship015_sail_flying_ship_0.material})]})}),We("group",{position:[34.774,2.247,0],rotation:[2.929,1.55,.221],scale:[.614,.634,.845],children:cn("group",{position:[-.621,-42.192,-4.887],children:[We("mesh",{geometry:e.paddle_flying_ship016_paddle_flying_ship_0.geometry,material:e.paddle_flying_ship016_paddle_flying_ship_0.material}),We("mesh",{geometry:e.paddle_flying_ship016_sail_flying_ship_0.geometry,material:e.paddle_flying_ship016_sail_flying_ship_0.material})]})}),We("group",{position:[34.774,2.247,0],rotation:[2.143,1.55,.221],scale:[.614,.634,.845],children:cn("group",{position:[-.621,-42.192,-4.887],children:[We("mesh",{geometry:e.paddle_flying_ship017_paddle_flying_ship_0.geometry,material:e.paddle_flying_ship017_paddle_flying_ship_0.material}),We("mesh",{geometry:e.paddle_flying_ship017_sail_flying_ship_0.geometry,material:e.paddle_flying_ship017_sail_flying_ship_0.material})]})}),We("group",{position:[-9.524,.545,-2.16],rotation:[-Math.PI/2,0,-Math.PI/3],children:cn("group",{position:[13.676,-2.165,-1.549],children:[We("mesh",{geometry:e.door004_door_part_3_flying_ship_0.geometry,material:e.door004_door_part_3_flying_ship_0.material}),We("mesh",{geometry:e.door004_door_part_4_flying_ship_0.geometry,material:e.door004_door_part_4_flying_ship_0.material}),We("mesh",{geometry:e.door004_flying_ship_0.geometry,material:e.door004_flying_ship_0.material})]})}),We("mesh",{geometry:e.rope_flying_ship_rope_flying_ship_0.geometry,material:e.rope_flying_ship_rope_flying_ship_0.material,position:[28.919,59.565,.283],rotation:[Math.PI/2,-1.57,0],scale:[-1,1,1]})]})})})}YC.preload("./models/airplane/CloudShip.glb");var z8=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","uint","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],kve=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],X8=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"],Lve=z8,Hve=Lve.slice().concat(["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray"]),BW=X8;BW=BW.slice().filter(function(n){return!/^(gl\_|texture)/.test(n)});var zve=BW.concat(["gl_VertexID","gl_InstanceID","gl_Position","gl_PointSize","gl_FragCoord","gl_FrontFacing","gl_FragDepth","gl_PointCoord","gl_MaxVertexAttribs","gl_MaxVertexUniformVectors","gl_MaxVertexOutputVectors","gl_MaxFragmentInputVectors","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformVectors","gl_MaxDrawBuffers","gl_MinProgramTexelOffset","gl_MaxProgramTexelOffset","gl_DepthRangeParameters","gl_DepthRange","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"]),Xve=qve,Yve=z8,EX=kve,Kve=X8,Dve=Hve,Pve=zve,sl=999,WX=9999,SZ=0,RZ=1,FX=2,_X=3,VX=4,Rm=5,Uve=6,Qve=7,Ove=8,TX=9,Jve=10,NX=11,jve=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function qve(n){var e=0,t=0,i=sl,r,s,o=[],a=[],l=1,c=0,g=0,u=!1,d=!1,h="",f;n=n||{};var I=Kve,A=Yve;n.version==="300 es"&&(I=Pve,A=Dve);for(var p={},y={},e=0;e<I.length;e++)p[I[e]]=!0;for(var e=0;e<A.length;e++)y[A[e]]=!0;return function(J){return a=[],J!==null?b(J):w()};function v(J){J.length&&a.push({type:jve[i],data:J,position:g,line:l,column:c})}function b(J){e=0,J.toString&&(J=J.toString()),h+=J.replace(/\r\n/g,`
`),f=h.length;for(var H;r=h[e],e<f;){switch(H=e,i){case SZ:e=Z();break;case RZ:e=R();break;case FX:e=B();break;case _X:e=W();break;case VX:e=V();break;case NX:e=T();break;case Rm:e=z();break;case WX:e=U();break;case TX:e=x();break;case sl:e=G();break}if(H!==e)switch(h[H]){case`
`:c=0,++l;break;default:++c;break}}return t+=e,h=h.slice(e),a}function w(J){return o.length&&v(o.join("")),i=Jve,v("(eof)"),a}function G(){return o=o.length?[]:o,s==="/"&&r==="*"?(g=t+e-1,i=SZ,s=r,e+1):s==="/"&&r==="/"?(g=t+e-1,i=RZ,s=r,e+1):r==="#"?(i=FX,g=t+e,e):/\s/.test(r)?(i=TX,g=t+e,e):(u=/\d/.test(r),d=/[^\w_]/.test(r),g=t+e,i=u?VX:d?_X:WX,e)}function x(){return/[^\s]/g.test(r)?(v(o.join("")),i=sl,e):(o.push(r),s=r,e+1)}function B(){return(r==="\r"||r===`
`)&&s!=="\\"?(v(o.join("")),i=sl,e):(o.push(r),s=r,e+1)}function R(){return B()}function Z(){return r==="/"&&s==="*"?(o.push(r),v(o.join("")),i=sl,e+1):(o.push(r),s=r,e+1)}function W(){if(s==="."&&/\d/.test(r))return i=Rm,e;if(s==="/"&&r==="*")return i=SZ,e;if(s==="/"&&r==="/")return i=RZ,e;if(r==="."&&o.length){for(;F(o););return i=Rm,e}if(r===";"||r===")"||r==="("){if(o.length)for(;F(o););return v(r),i=sl,e+1}var J=o.length===2&&r!=="=";if(/[\w_\d\s]/.test(r)||J){for(;F(o););return i=sl,e}return o.push(r),s=r,e+1}function F(J){var H=0,Y,K;do{if(Y=EX.indexOf(J.slice(0,J.length+H).join("")),K=EX[Y],Y===-1){if(H--+J.length>0)continue;K=J.slice(0,1).join("")}return v(K),g+=K.length,o=o.slice(K.length),o.length}while(1)}function T(){return/[^a-fA-F0-9]/.test(r)?(v(o.join("")),i=sl,e):(o.push(r),s=r,e+1)}function V(){return r==="."||/[eE]/.test(r)?(o.push(r),i=Rm,s=r,e+1):r==="x"&&o.length===1&&o[0]==="0"?(i=NX,o.push(r),s=r,e+1):/[^\d]/.test(r)?(v(o.join("")),i=sl,e):(o.push(r),s=r,e+1)}function z(){return r==="f"&&(o.push(r),s=r,e+=1),/[eE]/.test(r)||(r==="-"||r==="+")&&/[eE]/.test(s)?(o.push(r),s=r,e+1):/[^\d]/.test(r)?(v(o.join("")),i=sl,e):(o.push(r),s=r,e+1)}function U(){if(/[^\d\w_]/.test(r)){var J=o.join("");return y[J]?i=Ove:p[J]?i=Qve:i=Uve,v(o.join("")),i=sl,e}return o.push(r),s=r,e+1}}var $ve=Xve,ebe=tbe;function tbe(n,e){var t=$ve(e),i=[];return i=i.concat(t(n)),i=i.concat(t(null)),i}const GW=Ks(ebe);var ZZ,kX;function nbe(){if(kX)return ZZ;kX=1,ZZ=n;function n(e){for(var t=!1,i=0,r=0;r<e.length;r++)switch(t=t||e[r].type==="keyword"&&e[r].data==="for",e[r].data){case"(":e[r].depth=t?i++:i;break;case"{":e[r].depth=t?i:i++,t=!1;break;case"}":e[r].depth=--i;break;default:e[r].depth=i}for(var r=0;r<e.length;r++){var s=e[r],o=r+1;if(!(s.type!=="ident"&&s.type!=="keyword")&&(a(),e[o].type==="ident"&&(a(),o++,e[o].data==="("))){for(;e[o]&&e[o].data!==";"&&e[o].data!=="{";)e[o++].depth++;e[o]&&e[o].data==="{"&&e[o].depth++}}return e;function a(){for(;e[o]&&(e[o].type==="whitespace"||e[o].data==="["||e[o].data==="]"||e[o].data==="integer");)o++}}return ZZ}var MZ,LX;function ibe(){if(LX)return MZ;LX=1,MZ=n;function n(e){var t=[0],i=t[0],r=0;if(!e||!e.length)return e;if(!("depth"in e[0]))throw new Error("glsl-token-scope: No scope depth defined on tokens! Use glsl-token-depth on these tokens first");for(var s=0;s<e.length;s++){var o=e[s],a=o.depth;a>r?t.push(++i):a<r&&t.splice(-1,1),o.scope=t[t.length-1],o.stack=t.slice(),r=o.depth}return e}return MZ}var EZ,HX;function rbe(){if(HX)return EZ;HX=1,EZ=n;function n(e){for(var t=0;t<e.length;t++){var i=e[t];if(i.property=!1,i.type==="ident"){for(var r=t;e[--r]&&e[r].type==="whitespace";);e[r]&&e[r].type==="operator"&&e[r].data==="."&&(i.property=!0)}}return e}return EZ}var WZ,zX;function sbe(){return zX||(zX=1,WZ={"<<=":!0,">>=":!0,"++":!0,"--":!0,"+=":!0,"-=":!0,"*=":!0,"/=":!0,"%=":!0,"&=":!0,"^=":!0,"|=":!0,"=":!0}),WZ}var FZ,XX;function obe(){return XX||(XX=1,FZ={precision:!0,highp:!0,mediump:!0,lowp:!0,attribute:!0,const:!0,uniform:!0,varying:!0,break:!0,continue:!0,do:!0,for:!0,while:!0,if:!0,else:!0,in:!0,out:!0,inout:!0,true:!0,false:!0,return:!0}),FZ}var _Z,YX;function abe(){if(YX)return _Z;YX=1;var n=sbe(),e=obe();_Z=t;function t(i){for(var r=0,s=0;s<i.length;s++){var o=i[s],a=o.type;o.assignment=!1,o.declaration=!1,!(a!=="ident"&&a!=="builtin")&&(r=s+1,g(),i[r].type==="operator"&&n[i[r].data]&&(o.assignment=!0))}for(var s=0;s<i.length;s++){var l=i[s],a=l.type,c=l.data;if(l.declaration=!1,a==="keyword"){if(e[c])continue}else if(a!=="ident")continue;if(r=s+1,u(),i[r].type==="ident"){if(i[r++].declaration=!0,u(),i[r].data==="("){for(r++,g();i[r]&&i[r].data!==")"&&!(i[r].type!=="keyword"&&i[r].type!=="ident");)r++,g(),i[r].type==="ident"&&(i[r++].declaration=!0,g(),u(),g(),i[r].data===","&&(r++,g()));s=r;continue}for(;i[r]&&i[r].data!==";";)i[r].data===","?(r++,g(),(i[r].declaration=i[r].type==="ident")&&r++):(g(),d(),g(),r++);s=r}}for(var s=0;s<i.length;s++){var o=i[s];if(o.type==="keyword"&&o.data==="struct"&&(r=s+1,g(),i[r].type==="ident"&&(r++,g(),i[r++].data==="{"))){for(g();i[r].type==="ident"||i[r].type==="keyword";){do r++,g(),i[r].structMember=!0,i[r].declaration=!1,r++,u();while(i[r].data===",");i[r].data===";"&&r++,g()}if(r++,g(),i[r].type==="ident")for(i[r].declaration=!0,g();i[++r].data===",";)g(),r++,g(),i[r].type==="ident"&&(i[r].declaration=!0),g()}}return i;function g(h){for(;i[r]&&i[r].type==="whitespace";)r++}function u(){for(;i[r]&&(i[r].type==="integer"||i[r].data==="["||i[r].data==="]"||i[r].type==="whitespace");)r++}function d(){if(i[r]&&i[r].data==="("){var h=0;do{if(i[r].data===";")break;i[r].data==="("&&h++,i[r].data===")"&&h--}while(h&&i[++r])}}}return _Z}var lbe=cbe;function cbe(n,e){nbe()(n),ibe()(n),rbe()(n),abe()(n);for(var t=ube(n),i=e||gbe(),r={},s=0;s<n.length;s++){var o=n[s],a=o.stack,l=o.data;if(o.descoped=!1,o.type==="ident"&&!o.property&&!o.structMember){for(var c=!1,g=a.length-1;g>=0;g--){var u=t[a[g]];if(u&&u[l]){if(c=!0,g)break;o.descoped=o.data,o.data=r[l]=r[l]||i(l,o)||o.data}}c||(o.descoped=o.data,o.data=r[l]=r[l]||i(l,o)||o.data)}}return n}function gbe(){var n=0;return function(t){return t+"_"+(n++).toString(36)}}function ube(n){for(var e={},t=0;t<n.length;t++){var i=n[t];i.declaration&&(e[i.scope]=e[i.scope]||{},e[i.scope][i.data]=i)}return e}const KX=Ks(lbe);var dbe=hbe;function hbe(n){for(var e=[],t=0;t<n.length;t++)n[t].type!=="eof"&&e.push(n[t].data);return e.join("")}const z0=Ks(dbe);var fbe=Ibe;function Ibe(n){var e=null,t=null,i=0,r=0,s=0,o=0,a=0,l=[],c,g,u;for(c=0,g;c<n.length;c++)if(u=n[c],u.data==="{"){if(i&&i++||(g=h(c,Ru(")"),Ru()),g<0)||(o=g,g=h(g,Ru("("),Ru(")")),g<0)||(a=g,g=h(g,Zm),g<0)||n[g].type!=="ident"||(t=n[g].data,g=h(g,Zm),g<0))continue;i=1,r=c,e=n[g].data,s=g;var d=h(g,Zm);switch(n[d]&&n[d].data){case"lowp":case"highp":case"mediump":s=d}}else if(i&&u.data==="}"){if(--i)continue;l.push({name:t,type:e,body:[r+1,c],args:[a,o+1],outer:[s,c+1]})}for(c=0;c<n.length;c++)if(u=n[c],u.data===";"){if(g=h(c,Ru(")"),Ru()),g<0||(o=g,g=h(g,Ru("("),Ru(")")),g<0)||(a=g,g=h(g,Zm),g<0)||n[g].type!=="ident"||(t=n[g].data,g=h(g,Zm),g<0)||n[g].type==="operator"||n[g].data==="return")continue;e=n[g].data,l.push({name:t,type:e,body:!1,args:[a,o+1],outer:[g,c+1]})}return l.sort(function(f,I){return f.outer[0]-I.outer[0]});function h(f,I,A){for(var p=f-1;p>=0;p--){if(I(n[p]))return p;if(A&&A(n[p]))return-1}return-1}}function Ru(n){return function(e){return e.type==="operator"&&(!n||e.data===n)}}function Zm(n){return n.type!=="whitespace"}const wW=Ks(fbe);function lG(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Y8={exports:{}};(function(n,e){(function(t){n.exports=t()})(function(){return function t(i,r,s){function o(c,g){if(!r[c]){if(!i[c]){var u=typeof lG=="function"&&lG;if(!g&&u)return u(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+c+"'")}g=r[c]={exports:{}},i[c][0].call(g.exports,function(d){var h=i[c][1][d];return o(h||d)},g,g.exports,t,i,r,s)}return r[c].exports}for(var a=typeof lG=="function"&&lG,l=0;l<s.length;l++)o(s[l]);return o}({1:[function(t,i,r){(function(s,o,a,l,c,g,u,d,h){var f=t("crypto");function I(G,x){x=y(G,x);var B;return(B=x.algorithm!=="passthrough"?f.createHash(x.algorithm):new w).write===void 0&&(B.write=B.update,B.end=B.update),b(x,B).dispatch(G),B.update||B.end(""),B.digest?B.digest(x.encoding==="buffer"?void 0:x.encoding):(G=B.read(),x.encoding!=="buffer"?G.toString(x.encoding):G)}(r=i.exports=I).sha1=function(G){return I(G)},r.keys=function(G){return I(G,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},r.MD5=function(G){return I(G,{algorithm:"md5",encoding:"hex"})},r.keysMD5=function(G){return I(G,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var A=f.getHashes?f.getHashes().slice():["sha1","md5"],p=(A.push("passthrough"),["buffer","hex","binary","base64"]);function y(G,x){var B={};if(B.algorithm=(x=x||{}).algorithm||"sha1",B.encoding=x.encoding||"hex",B.excludeValues=!!x.excludeValues,B.algorithm=B.algorithm.toLowerCase(),B.encoding=B.encoding.toLowerCase(),B.ignoreUnknown=x.ignoreUnknown===!0,B.respectType=x.respectType!==!1,B.respectFunctionNames=x.respectFunctionNames!==!1,B.respectFunctionProperties=x.respectFunctionProperties!==!1,B.unorderedArrays=x.unorderedArrays===!0,B.unorderedSets=x.unorderedSets!==!1,B.unorderedObjects=x.unorderedObjects!==!1,B.replacer=x.replacer||void 0,B.excludeKeys=x.excludeKeys||void 0,G===void 0)throw new Error("Object argument required.");for(var R=0;R<A.length;++R)A[R].toLowerCase()===B.algorithm.toLowerCase()&&(B.algorithm=A[R]);if(A.indexOf(B.algorithm)===-1)throw new Error('Algorithm "'+B.algorithm+'"  not supported. supported values: '+A.join(", "));if(p.indexOf(B.encoding)===-1&&B.algorithm!=="passthrough")throw new Error('Encoding "'+B.encoding+'"  not supported. supported values: '+p.join(", "));return B}function v(G){if(typeof G=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(G))!=null}function b(G,x,B){B=B||[];function R(Z){return x.update?x.update(Z,"utf8"):x.write(Z,"utf8")}return{dispatch:function(Z){return this["_"+((Z=G.replacer?G.replacer(Z):Z)===null?"null":typeof Z)](Z)},_object:function(Z){var W,F=Object.prototype.toString.call(Z),T=/\[object (.*)\]/i.exec(F);if(T=(T=T?T[1]:"unknown:["+F+"]").toLowerCase(),0<=(F=B.indexOf(Z)))return this.dispatch("[CIRCULAR:"+F+"]");if(B.push(Z),a!==void 0&&a.isBuffer&&a.isBuffer(Z))return R("buffer:"),R(Z);if(T==="object"||T==="function"||T==="asyncfunction")return F=Object.keys(Z),G.unorderedObjects&&(F=F.sort()),G.respectType===!1||v(Z)||F.splice(0,0,"prototype","__proto__","constructor"),G.excludeKeys&&(F=F.filter(function(V){return!G.excludeKeys(V)})),R("object:"+F.length+":"),W=this,F.forEach(function(V){W.dispatch(V),R(":"),G.excludeValues||W.dispatch(Z[V]),R(",")});if(!this["_"+T]){if(G.ignoreUnknown)return R("["+T+"]");throw new Error('Unknown object type "'+T+'"')}this["_"+T](Z)},_array:function(Z,V){V=V!==void 0?V:G.unorderedArrays!==!1;var F=this;if(R("array:"+Z.length+":"),!V||Z.length<=1)return Z.forEach(function(z){return F.dispatch(z)});var T=[],V=Z.map(function(z){var U=new w,J=B.slice();return b(G,U,J).dispatch(z),T=T.concat(J.slice(B.length)),U.read().toString()});return B=B.concat(T),V.sort(),this._array(V,!1)},_date:function(Z){return R("date:"+Z.toJSON())},_symbol:function(Z){return R("symbol:"+Z.toString())},_error:function(Z){return R("error:"+Z.toString())},_boolean:function(Z){return R("bool:"+Z.toString())},_string:function(Z){R("string:"+Z.length+":"),R(Z.toString())},_function:function(Z){R("fn:"),v(Z)?this.dispatch("[native]"):this.dispatch(Z.toString()),G.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(Z.name)),G.respectFunctionProperties&&this._object(Z)},_number:function(Z){return R("number:"+Z.toString())},_xml:function(Z){return R("xml:"+Z.toString())},_null:function(){return R("Null")},_undefined:function(){return R("Undefined")},_regexp:function(Z){return R("regex:"+Z.toString())},_uint8array:function(Z){return R("uint8array:"),this.dispatch(Array.prototype.slice.call(Z))},_uint8clampedarray:function(Z){return R("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(Z))},_int8array:function(Z){return R("int8array:"),this.dispatch(Array.prototype.slice.call(Z))},_uint16array:function(Z){return R("uint16array:"),this.dispatch(Array.prototype.slice.call(Z))},_int16array:function(Z){return R("int16array:"),this.dispatch(Array.prototype.slice.call(Z))},_uint32array:function(Z){return R("uint32array:"),this.dispatch(Array.prototype.slice.call(Z))},_int32array:function(Z){return R("int32array:"),this.dispatch(Array.prototype.slice.call(Z))},_float32array:function(Z){return R("float32array:"),this.dispatch(Array.prototype.slice.call(Z))},_float64array:function(Z){return R("float64array:"),this.dispatch(Array.prototype.slice.call(Z))},_arraybuffer:function(Z){return R("arraybuffer:"),this.dispatch(new Uint8Array(Z))},_url:function(Z){return R("url:"+Z.toString())},_map:function(Z){return R("map:"),Z=Array.from(Z),this._array(Z,G.unorderedSets!==!1)},_set:function(Z){return R("set:"),Z=Array.from(Z),this._array(Z,G.unorderedSets!==!1)},_file:function(Z){return R("file:"),this.dispatch([Z.name,Z.size,Z.type,Z.lastModfied])},_blob:function(){if(G.ignoreUnknown)return R("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return R("domwindow")},_bigint:function(Z){return R("bigint:"+Z.toString())},_process:function(){return R("process")},_timer:function(){return R("timer")},_pipe:function(){return R("pipe")},_tcp:function(){return R("tcp")},_udp:function(){return R("udp")},_tty:function(){return R("tty")},_statwatcher:function(){return R("statwatcher")},_securecontext:function(){return R("securecontext")},_connection:function(){return R("connection")},_zlib:function(){return R("zlib")},_context:function(){return R("context")},_nodescript:function(){return R("nodescript")},_httpparser:function(){return R("httpparser")},_dataview:function(){return R("dataview")},_signal:function(){return R("signal")},_fsevent:function(){return R("fsevent")},_tlswrap:function(){return R("tlswrap")}}}function w(){return{buf:"",write:function(G){this.buf+=G},end:function(G){this.buf+=G},read:function(){return this.buf}}}r.writeToStream=function(G,x,B){return B===void 0&&(B=x,x={}),b(x=y(G,x),B).dispatch(G)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(t,i,r){(function(s,o,a,l,c,g,u,d,h){(function(f){var I=typeof Uint8Array<"u"?Uint8Array:Array,A="+".charCodeAt(0),p="/".charCodeAt(0),y="0".charCodeAt(0),v="a".charCodeAt(0),b="A".charCodeAt(0),w="-".charCodeAt(0),G="_".charCodeAt(0);function x(B){return B=B.charCodeAt(0),B===A||B===w?62:B===p||B===G?63:B<y?-1:B<y+10?B-y+26+26:B<b+26?B-b:B<v+26?B-v+26:void 0}f.toByteArray=function(B){var R,Z;if(0<B.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var W=B.length,W=B.charAt(W-2)==="="?2:B.charAt(W-1)==="="?1:0,F=new I(3*B.length/4-W),T=0<W?B.length-4:B.length,V=0;function z(U){F[V++]=U}for(R=0;R<T;R+=4,0)z((16711680&(Z=x(B.charAt(R))<<18|x(B.charAt(R+1))<<12|x(B.charAt(R+2))<<6|x(B.charAt(R+3))))>>16),z((65280&Z)>>8),z(255&Z);return W==2?z(255&(Z=x(B.charAt(R))<<2|x(B.charAt(R+1))>>4)):W==1&&(z((Z=x(B.charAt(R))<<10|x(B.charAt(R+1))<<4|x(B.charAt(R+2))>>2)>>8&255),z(255&Z)),F},f.fromByteArray=function(B){var R,Z,W,F,T=B.length%3,V="";function z(U){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(U)}for(R=0,W=B.length-T;R<W;R+=3)Z=(B[R]<<16)+(B[R+1]<<8)+B[R+2],V+=z((F=Z)>>18&63)+z(F>>12&63)+z(F>>6&63)+z(63&F);switch(T){case 1:V=(V+=z((Z=B[B.length-1])>>2))+z(Z<<4&63)+"==";break;case 2:V=(V=(V+=z((Z=(B[B.length-2]<<8)+B[B.length-1])>>10))+z(Z>>4&63))+z(Z<<2&63)+"="}return V}})(r===void 0?this.base64js={}:r)}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(t,i,r){(function(s,o,A,l,c,g,u,d,h){var f=t("base64-js"),I=t("ieee754");function A(k,O,q){if(!(this instanceof A))return new A(k,O,q);var ee,le,he,be,xe=typeof k;if(O==="base64"&&xe=="string")for(k=(be=k).trim?be.trim():be.replace(/^\s+|\s+$/g,"");k.length%4!=0;)k+="=";if(xe=="number")ee=H(k);else if(xe=="string")ee=A.byteLength(k,O);else{if(xe!="object")throw new Error("First argument needs to be a number, array or string.");ee=H(k.length)}if(A._useTypedArrays?le=A._augment(new Uint8Array(ee)):((le=this).length=ee,le._isBuffer=!0),A._useTypedArrays&&typeof k.byteLength=="number")le._set(k);else if(Y(be=k)||A.isBuffer(be)||be&&typeof be=="object"&&typeof be.length=="number")for(he=0;he<ee;he++)A.isBuffer(k)?le[he]=k.readUInt8(he):le[he]=k[he];else if(xe=="string")le.write(k,0,O);else if(xe=="number"&&!A._useTypedArrays&&!q)for(he=0;he<ee;he++)le[he]=0;return le}function p(k,O,q,ee){return A._charsWritten=ne(function(le){for(var he=[],be=0;be<le.length;be++)he.push(255&le.charCodeAt(be));return he}(O),k,q,ee)}function y(k,O,q,ee){return A._charsWritten=ne(function(le){for(var he,be,xe=[],ze=0;ze<le.length;ze++)be=le.charCodeAt(ze),he=be>>8,be=be%256,xe.push(be),xe.push(he);return xe}(O),k,q,ee)}function v(k,O,q){var ee="";q=Math.min(k.length,q);for(var le=O;le<q;le++)ee+=String.fromCharCode(k[le]);return ee}function b(k,O,q,he){he||(se(typeof q=="boolean","missing or invalid endian"),se(O!=null,"missing offset"),se(O+1<k.length,"Trying to read beyond buffer length"));var le,he=k.length;if(!(he<=O))return q?(le=k[O],O+1<he&&(le|=k[O+1]<<8)):(le=k[O]<<8,O+1<he&&(le|=k[O+1])),le}function w(k,O,q,he){he||(se(typeof q=="boolean","missing or invalid endian"),se(O!=null,"missing offset"),se(O+3<k.length,"Trying to read beyond buffer length"));var le,he=k.length;if(!(he<=O))return q?(O+2<he&&(le=k[O+2]<<16),O+1<he&&(le|=k[O+1]<<8),le|=k[O],O+3<he&&(le+=k[O+3]<<24>>>0)):(O+1<he&&(le=k[O+1]<<16),O+2<he&&(le|=k[O+2]<<8),O+3<he&&(le|=k[O+3]),le+=k[O]<<24>>>0),le}function G(k,O,q,ee){if(ee||(se(typeof q=="boolean","missing or invalid endian"),se(O!=null,"missing offset"),se(O+1<k.length,"Trying to read beyond buffer length")),!(k.length<=O))return ee=b(k,O,q,!0),32768&ee?-1*(65535-ee+1):ee}function x(k,O,q,ee){if(ee||(se(typeof q=="boolean","missing or invalid endian"),se(O!=null,"missing offset"),se(O+3<k.length,"Trying to read beyond buffer length")),!(k.length<=O))return ee=w(k,O,q,!0),2147483648&ee?-1*(4294967295-ee+1):ee}function B(k,O,q,ee){return ee||(se(typeof q=="boolean","missing or invalid endian"),se(O+3<k.length,"Trying to read beyond buffer length")),I.read(k,O,q,23,4)}function R(k,O,q,ee){return ee||(se(typeof q=="boolean","missing or invalid endian"),se(O+7<k.length,"Trying to read beyond buffer length")),I.read(k,O,q,52,8)}function Z(k,O,q,ee,le){if(le||(se(O!=null,"missing value"),se(typeof ee=="boolean","missing or invalid endian"),se(q!=null,"missing offset"),se(q+1<k.length,"trying to write beyond buffer length"),$(O,65535)),le=k.length,!(le<=q))for(var he=0,be=Math.min(le-q,2);he<be;he++)k[q+he]=(O&255<<8*(ee?he:1-he))>>>8*(ee?he:1-he)}function W(k,O,q,ee,le){if(le||(se(O!=null,"missing value"),se(typeof ee=="boolean","missing or invalid endian"),se(q!=null,"missing offset"),se(q+3<k.length,"trying to write beyond buffer length"),$(O,4294967295)),le=k.length,!(le<=q))for(var he=0,be=Math.min(le-q,4);he<be;he++)k[q+he]=O>>>8*(ee?he:3-he)&255}function F(k,O,q,ee,le){le||(se(O!=null,"missing value"),se(typeof ee=="boolean","missing or invalid endian"),se(q!=null,"missing offset"),se(q+1<k.length,"Trying to write beyond buffer length"),de(O,32767,-32768)),k.length<=q||Z(k,0<=O?O:65535+O+1,q,ee,le)}function T(k,O,q,ee,le){le||(se(O!=null,"missing value"),se(typeof ee=="boolean","missing or invalid endian"),se(q!=null,"missing offset"),se(q+3<k.length,"Trying to write beyond buffer length"),de(O,2147483647,-2147483648)),k.length<=q||W(k,0<=O?O:4294967295+O+1,q,ee,le)}function V(k,O,q,ee,le){le||(se(O!=null,"missing value"),se(typeof ee=="boolean","missing or invalid endian"),se(q!=null,"missing offset"),se(q+3<k.length,"Trying to write beyond buffer length"),ge(O,34028234663852886e22,-34028234663852886e22)),k.length<=q||I.write(k,O,q,ee,23,4)}function z(k,O,q,ee,le){le||(se(O!=null,"missing value"),se(typeof ee=="boolean","missing or invalid endian"),se(q!=null,"missing offset"),se(q+7<k.length,"Trying to write beyond buffer length"),ge(O,17976931348623157e292,-17976931348623157e292)),k.length<=q||I.write(k,O,q,ee,52,8)}r.Buffer=A,r.SlowBuffer=A,r.INSPECT_MAX_BYTES=50,A.poolSize=8192,A._useTypedArrays=function(){try{var k=new ArrayBuffer(0),O=new Uint8Array(k);return O.foo=function(){return 42},O.foo()===42&&typeof O.subarray=="function"}catch{return!1}}(),A.isEncoding=function(k){switch(String(k).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},A.isBuffer=function(k){return!(k==null||!k._isBuffer)},A.byteLength=function(k,O){var q;switch(k+="",O||"utf8"){case"hex":q=k.length/2;break;case"utf8":case"utf-8":q=Q(k).length;break;case"ascii":case"binary":case"raw":q=k.length;break;case"base64":q=P(k).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":q=2*k.length;break;default:throw new Error("Unknown encoding")}return q},A.concat=function(k,O){if(se(Y(k),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),k.length===0)return new A(0);if(k.length===1)return k[0];if(typeof O!="number")for(le=O=0;le<k.length;le++)O+=k[le].length;for(var q=new A(O),ee=0,le=0;le<k.length;le++){var he=k[le];he.copy(q,ee),ee+=he.length}return q},A.prototype.write=function(k,O,q,ee){isFinite(O)?isFinite(q)||(ee=q,q=void 0):(ze=ee,ee=O,O=q,q=ze),O=Number(O)||0;var le,he,be,xe,ze=this.length-O;switch((!q||ze<(q=Number(q)))&&(q=ze),ee=String(ee||"utf8").toLowerCase()){case"hex":le=function(Se,ke,He,Be){He=Number(He)||0;var j=Se.length-He;(!Be||j<(Be=Number(Be)))&&(Be=j),se((j=ke.length)%2==0,"Invalid hex string"),j/2<Be&&(Be=j/2);for(var X=0;X<Be;X++){var ce=parseInt(ke.substr(2*X,2),16);se(!isNaN(ce),"Invalid hex string"),Se[He+X]=ce}return A._charsWritten=2*X,X}(this,k,O,q);break;case"utf8":case"utf-8":he=this,be=O,xe=q,le=A._charsWritten=ne(Q(k),he,be,xe);break;case"ascii":case"binary":le=p(this,k,O,q);break;case"base64":he=this,be=O,xe=q,le=A._charsWritten=ne(P(k),he,be,xe);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":le=y(this,k,O,q);break;default:throw new Error("Unknown encoding")}return le},A.prototype.toString=function(k,O,q){var ee,le,he,be,xe=this;if(k=String(k||"utf8").toLowerCase(),O=Number(O)||0,(q=q!==void 0?Number(q):xe.length)===O)return"";switch(k){case"hex":ee=function(ze,Se,ke){var He=ze.length;(!Se||Se<0)&&(Se=0),(!ke||ke<0||He<ke)&&(ke=He);for(var Be="",j=Se;j<ke;j++)Be+=K(ze[j]);return Be}(xe,O,q);break;case"utf8":case"utf-8":ee=function(ze,Se,ke){var He="",Be="";ke=Math.min(ze.length,ke);for(var j=Se;j<ke;j++)ze[j]<=127?(He+=oe(Be)+String.fromCharCode(ze[j]),Be=""):Be+="%"+ze[j].toString(16);return He+oe(Be)}(xe,O,q);break;case"ascii":case"binary":ee=v(xe,O,q);break;case"base64":le=xe,be=q,ee=(he=O)===0&&be===le.length?f.fromByteArray(le):f.fromByteArray(le.slice(he,be));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ee=function(ze,Se,ke){for(var He=ze.slice(Se,ke),Be="",j=0;j<He.length;j+=2)Be+=String.fromCharCode(He[j]+256*He[j+1]);return Be}(xe,O,q);break;default:throw new Error("Unknown encoding")}return ee},A.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},A.prototype.copy=function(k,O,q,ee){if(O=O||0,(ee=ee||ee===0?ee:this.length)!==(q=q||0)&&k.length!==0&&this.length!==0){se(q<=ee,"sourceEnd < sourceStart"),se(0<=O&&O<k.length,"targetStart out of bounds"),se(0<=q&&q<this.length,"sourceStart out of bounds"),se(0<=ee&&ee<=this.length,"sourceEnd out of bounds"),ee>this.length&&(ee=this.length);var le=(ee=k.length-O<ee-q?k.length-O+q:ee)-q;if(le<100||!A._useTypedArrays)for(var he=0;he<le;he++)k[he+O]=this[he+q];else k._set(this.subarray(q,q+le),O)}},A.prototype.slice=function(k,O){var q=this.length;if(k=J(k,q,0),O=J(O,q,q),A._useTypedArrays)return A._augment(this.subarray(k,O));for(var ee=O-k,le=new A(ee,void 0,!0),he=0;he<ee;he++)le[he]=this[he+k];return le},A.prototype.get=function(k){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(k)},A.prototype.set=function(k,O){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(k,O)},A.prototype.readUInt8=function(k,O){if(O||(se(k!=null,"missing offset"),se(k<this.length,"Trying to read beyond buffer length")),!(k>=this.length))return this[k]},A.prototype.readUInt16LE=function(k,O){return b(this,k,!0,O)},A.prototype.readUInt16BE=function(k,O){return b(this,k,!1,O)},A.prototype.readUInt32LE=function(k,O){return w(this,k,!0,O)},A.prototype.readUInt32BE=function(k,O){return w(this,k,!1,O)},A.prototype.readInt8=function(k,O){if(O||(se(k!=null,"missing offset"),se(k<this.length,"Trying to read beyond buffer length")),!(k>=this.length))return 128&this[k]?-1*(255-this[k]+1):this[k]},A.prototype.readInt16LE=function(k,O){return G(this,k,!0,O)},A.prototype.readInt16BE=function(k,O){return G(this,k,!1,O)},A.prototype.readInt32LE=function(k,O){return x(this,k,!0,O)},A.prototype.readInt32BE=function(k,O){return x(this,k,!1,O)},A.prototype.readFloatLE=function(k,O){return B(this,k,!0,O)},A.prototype.readFloatBE=function(k,O){return B(this,k,!1,O)},A.prototype.readDoubleLE=function(k,O){return R(this,k,!0,O)},A.prototype.readDoubleBE=function(k,O){return R(this,k,!1,O)},A.prototype.writeUInt8=function(k,O,q){q||(se(k!=null,"missing value"),se(O!=null,"missing offset"),se(O<this.length,"trying to write beyond buffer length"),$(k,255)),O>=this.length||(this[O]=k)},A.prototype.writeUInt16LE=function(k,O,q){Z(this,k,O,!0,q)},A.prototype.writeUInt16BE=function(k,O,q){Z(this,k,O,!1,q)},A.prototype.writeUInt32LE=function(k,O,q){W(this,k,O,!0,q)},A.prototype.writeUInt32BE=function(k,O,q){W(this,k,O,!1,q)},A.prototype.writeInt8=function(k,O,q){q||(se(k!=null,"missing value"),se(O!=null,"missing offset"),se(O<this.length,"Trying to write beyond buffer length"),de(k,127,-128)),O>=this.length||(0<=k?this.writeUInt8(k,O,q):this.writeUInt8(255+k+1,O,q))},A.prototype.writeInt16LE=function(k,O,q){F(this,k,O,!0,q)},A.prototype.writeInt16BE=function(k,O,q){F(this,k,O,!1,q)},A.prototype.writeInt32LE=function(k,O,q){T(this,k,O,!0,q)},A.prototype.writeInt32BE=function(k,O,q){T(this,k,O,!1,q)},A.prototype.writeFloatLE=function(k,O,q){V(this,k,O,!0,q)},A.prototype.writeFloatBE=function(k,O,q){V(this,k,O,!1,q)},A.prototype.writeDoubleLE=function(k,O,q){z(this,k,O,!0,q)},A.prototype.writeDoubleBE=function(k,O,q){z(this,k,O,!1,q)},A.prototype.fill=function(k,O,q){if(O=O||0,q=q||this.length,se(typeof(k=typeof(k=k||0)=="string"?k.charCodeAt(0):k)=="number"&&!isNaN(k),"value is not a number"),se(O<=q,"end < start"),q!==O&&this.length!==0){se(0<=O&&O<this.length,"start out of bounds"),se(0<=q&&q<=this.length,"end out of bounds");for(var ee=O;ee<q;ee++)this[ee]=k}},A.prototype.inspect=function(){for(var k=[],O=this.length,q=0;q<O;q++)if(k[q]=K(this[q]),q===r.INSPECT_MAX_BYTES){k[q+1]="...";break}return"<Buffer "+k.join(" ")+">"},A.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(A._useTypedArrays)return new A(this).buffer;for(var k=new Uint8Array(this.length),O=0,q=k.length;O<q;O+=1)k[O]=this[O];return k.buffer};var U=A.prototype;function J(k,O,q){return typeof k!="number"?q:O<=(k=~~k)?O:0<=k||0<=(k+=O)?k:0}function H(k){return(k=~~Math.ceil(+k))<0?0:k}function Y(k){return(Array.isArray||function(O){return Object.prototype.toString.call(O)==="[object Array]"})(k)}function K(k){return k<16?"0"+k.toString(16):k.toString(16)}function Q(k){for(var O=[],q=0;q<k.length;q++){var ee=k.charCodeAt(q);if(ee<=127)O.push(k.charCodeAt(q));else for(var le=q,he=(55296<=ee&&ee<=57343&&q++,encodeURIComponent(k.slice(le,q+1)).substr(1).split("%")),be=0;be<he.length;be++)O.push(parseInt(he[be],16))}return O}function P(k){return f.toByteArray(k)}function ne(k,O,q,ee){for(var le=0;le<ee&&!(le+q>=O.length||le>=k.length);le++)O[le+q]=k[le];return le}function oe(k){try{return decodeURIComponent(k)}catch{return String.fromCharCode(65533)}}function $(k,O){se(typeof k=="number","cannot write a non-number as a number"),se(0<=k,"specified a negative value for writing an unsigned value"),se(k<=O,"value is larger than maximum value for type"),se(Math.floor(k)===k,"value has a fractional component")}function de(k,O,q){se(typeof k=="number","cannot write a non-number as a number"),se(k<=O,"value larger than maximum allowed value"),se(q<=k,"value smaller than minimum allowed value"),se(Math.floor(k)===k,"value has a fractional component")}function ge(k,O,q){se(typeof k=="number","cannot write a non-number as a number"),se(k<=O,"value larger than maximum allowed value"),se(q<=k,"value smaller than minimum allowed value")}function se(k,O){if(!k)throw new Error(O||"Failed assertion")}A._augment=function(k){return k._isBuffer=!0,k._get=k.get,k._set=k.set,k.get=U.get,k.set=U.set,k.write=U.write,k.toString=U.toString,k.toLocaleString=U.toString,k.toJSON=U.toJSON,k.copy=U.copy,k.slice=U.slice,k.readUInt8=U.readUInt8,k.readUInt16LE=U.readUInt16LE,k.readUInt16BE=U.readUInt16BE,k.readUInt32LE=U.readUInt32LE,k.readUInt32BE=U.readUInt32BE,k.readInt8=U.readInt8,k.readInt16LE=U.readInt16LE,k.readInt16BE=U.readInt16BE,k.readInt32LE=U.readInt32LE,k.readInt32BE=U.readInt32BE,k.readFloatLE=U.readFloatLE,k.readFloatBE=U.readFloatBE,k.readDoubleLE=U.readDoubleLE,k.readDoubleBE=U.readDoubleBE,k.writeUInt8=U.writeUInt8,k.writeUInt16LE=U.writeUInt16LE,k.writeUInt16BE=U.writeUInt16BE,k.writeUInt32LE=U.writeUInt32LE,k.writeUInt32BE=U.writeUInt32BE,k.writeInt8=U.writeInt8,k.writeInt16LE=U.writeInt16LE,k.writeInt16BE=U.writeInt16BE,k.writeInt32LE=U.writeInt32LE,k.writeInt32BE=U.writeInt32BE,k.writeFloatLE=U.writeFloatLE,k.writeFloatBE=U.writeFloatBE,k.writeDoubleLE=U.writeDoubleLE,k.writeDoubleBE=U.writeDoubleBE,k.fill=U.fill,k.inspect=U.inspect,k.toArrayBuffer=U.toArrayBuffer,k}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(t,i,r){(function(s,o,f,l,c,g,u,d,h){var f=t("buffer").Buffer,I=4,A=new f(I);A.fill(0),i.exports={hash:function(p,y,v,b){for(var w=y(function(Z,W){Z.length%I!=0&&(F=Z.length+(I-Z.length%I),Z=f.concat([Z,A],F));for(var F,T=[],V=W?Z.readInt32BE:Z.readInt32LE,z=0;z<Z.length;z+=I)T.push(V.call(Z,z));return T}(p=f.isBuffer(p)?p:new f(p),b),8*p.length),y=b,G=new f(v),x=y?G.writeInt32BE:G.writeInt32LE,B=0;B<w.length;B++)x.call(G,w[B],4*B,!0);return G}}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(t,i,r){(function(s,o,f,l,c,g,u,d,h){var f=t("buffer").Buffer,I=t("./sha"),A=t("./sha256"),p=t("./rng"),y={sha1:I,sha256:A,md5:t("./md5")},v=64,b=new f(v);function w(Z,W){var F=y[Z=Z||"sha1"],T=[];return F||G("algorithm:",Z,"is not yet supported"),{update:function(V){return f.isBuffer(V)||(V=new f(V)),T.push(V),V.length,this},digest:function(V){var z=f.concat(T),z=W?function(U,J,H){f.isBuffer(J)||(J=new f(J)),f.isBuffer(H)||(H=new f(H)),J.length>v?J=U(J):J.length<v&&(J=f.concat([J,b],v));for(var Y=new f(v),K=new f(v),Q=0;Q<v;Q++)Y[Q]=54^J[Q],K[Q]=92^J[Q];return H=U(f.concat([Y,H])),U(f.concat([K,H]))}(F,W,z):F(z);return T=null,V?z.toString(V):z}}}function G(){var Z=[].slice.call(arguments).join(" ");throw new Error([Z,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}b.fill(0),r.createHash=function(Z){return w(Z)},r.createHmac=w,r.randomBytes=function(Z,W){if(!W||!W.call)return new f(p(Z));try{W.call(this,void 0,new f(p(Z)))}catch(F){W(F)}};var x,B=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],R=function(Z){r[Z]=function(){G("sorry,",Z,"is not implemented yet")}};for(x in B)R(B[x])}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(t,i,r){(function(s,o,a,l,c,g,u,d,h){var f=t("./helpers");function I(G,x){G[x>>5]|=128<<x%32,G[14+(x+64>>>9<<4)]=x;for(var B=1732584193,R=-271733879,Z=-1732584194,W=271733878,F=0;F<G.length;F+=16){var T=B,V=R,z=Z,U=W,B=p(B,R,Z,W,G[F+0],7,-680876936),W=p(W,B,R,Z,G[F+1],12,-389564586),Z=p(Z,W,B,R,G[F+2],17,606105819),R=p(R,Z,W,B,G[F+3],22,-1044525330);B=p(B,R,Z,W,G[F+4],7,-176418897),W=p(W,B,R,Z,G[F+5],12,1200080426),Z=p(Z,W,B,R,G[F+6],17,-1473231341),R=p(R,Z,W,B,G[F+7],22,-45705983),B=p(B,R,Z,W,G[F+8],7,1770035416),W=p(W,B,R,Z,G[F+9],12,-1958414417),Z=p(Z,W,B,R,G[F+10],17,-42063),R=p(R,Z,W,B,G[F+11],22,-1990404162),B=p(B,R,Z,W,G[F+12],7,1804603682),W=p(W,B,R,Z,G[F+13],12,-40341101),Z=p(Z,W,B,R,G[F+14],17,-1502002290),B=y(B,R=p(R,Z,W,B,G[F+15],22,1236535329),Z,W,G[F+1],5,-165796510),W=y(W,B,R,Z,G[F+6],9,-1069501632),Z=y(Z,W,B,R,G[F+11],14,643717713),R=y(R,Z,W,B,G[F+0],20,-373897302),B=y(B,R,Z,W,G[F+5],5,-701558691),W=y(W,B,R,Z,G[F+10],9,38016083),Z=y(Z,W,B,R,G[F+15],14,-660478335),R=y(R,Z,W,B,G[F+4],20,-405537848),B=y(B,R,Z,W,G[F+9],5,568446438),W=y(W,B,R,Z,G[F+14],9,-1019803690),Z=y(Z,W,B,R,G[F+3],14,-187363961),R=y(R,Z,W,B,G[F+8],20,1163531501),B=y(B,R,Z,W,G[F+13],5,-1444681467),W=y(W,B,R,Z,G[F+2],9,-51403784),Z=y(Z,W,B,R,G[F+7],14,1735328473),B=v(B,R=y(R,Z,W,B,G[F+12],20,-1926607734),Z,W,G[F+5],4,-378558),W=v(W,B,R,Z,G[F+8],11,-2022574463),Z=v(Z,W,B,R,G[F+11],16,1839030562),R=v(R,Z,W,B,G[F+14],23,-35309556),B=v(B,R,Z,W,G[F+1],4,-1530992060),W=v(W,B,R,Z,G[F+4],11,1272893353),Z=v(Z,W,B,R,G[F+7],16,-155497632),R=v(R,Z,W,B,G[F+10],23,-1094730640),B=v(B,R,Z,W,G[F+13],4,681279174),W=v(W,B,R,Z,G[F+0],11,-358537222),Z=v(Z,W,B,R,G[F+3],16,-722521979),R=v(R,Z,W,B,G[F+6],23,76029189),B=v(B,R,Z,W,G[F+9],4,-640364487),W=v(W,B,R,Z,G[F+12],11,-421815835),Z=v(Z,W,B,R,G[F+15],16,530742520),B=b(B,R=v(R,Z,W,B,G[F+2],23,-995338651),Z,W,G[F+0],6,-198630844),W=b(W,B,R,Z,G[F+7],10,1126891415),Z=b(Z,W,B,R,G[F+14],15,-1416354905),R=b(R,Z,W,B,G[F+5],21,-57434055),B=b(B,R,Z,W,G[F+12],6,1700485571),W=b(W,B,R,Z,G[F+3],10,-1894986606),Z=b(Z,W,B,R,G[F+10],15,-1051523),R=b(R,Z,W,B,G[F+1],21,-2054922799),B=b(B,R,Z,W,G[F+8],6,1873313359),W=b(W,B,R,Z,G[F+15],10,-30611744),Z=b(Z,W,B,R,G[F+6],15,-1560198380),R=b(R,Z,W,B,G[F+13],21,1309151649),B=b(B,R,Z,W,G[F+4],6,-145523070),W=b(W,B,R,Z,G[F+11],10,-1120210379),Z=b(Z,W,B,R,G[F+2],15,718787259),R=b(R,Z,W,B,G[F+9],21,-343485551),B=w(B,T),R=w(R,V),Z=w(Z,z),W=w(W,U)}return Array(B,R,Z,W)}function A(G,x,B,R,Z,W){return w((x=w(w(x,G),w(R,W)))<<Z|x>>>32-Z,B)}function p(G,x,B,R,Z,W,F){return A(x&B|~x&R,G,x,Z,W,F)}function y(G,x,B,R,Z,W,F){return A(x&R|B&~R,G,x,Z,W,F)}function v(G,x,B,R,Z,W,F){return A(x^B^R,G,x,Z,W,F)}function b(G,x,B,R,Z,W,F){return A(B^(x|~R),G,x,Z,W,F)}function w(G,x){var B=(65535&G)+(65535&x);return(G>>16)+(x>>16)+(B>>16)<<16|65535&B}i.exports=function(G){return f.hash(G,I,16)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(t,i,r){(function(s,o,a,l,c,g,u,d,h){i.exports=function(f){for(var I,A=new Array(f),p=0;p<f;p++)!(3&p)&&(I=4294967296*Math.random()),A[p]=I>>>((3&p)<<3)&255;return A}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(t,i,r){(function(s,o,a,l,c,g,u,d,h){var f=t("./helpers");function I(y,v){y[v>>5]|=128<<24-v%32,y[15+(v+64>>9<<4)]=v;for(var b,w,G,x=Array(80),B=1732584193,R=-271733879,Z=-1732584194,W=271733878,F=-1009589776,T=0;T<y.length;T+=16){for(var V=B,z=R,U=Z,J=W,H=F,Y=0;Y<80;Y++){x[Y]=Y<16?y[T+Y]:p(x[Y-3]^x[Y-8]^x[Y-14]^x[Y-16],1);var K=A(A(p(B,5),(K=R,w=Z,G=W,(b=Y)<20?K&w|~K&G:!(b<40)&&b<60?K&w|K&G|w&G:K^w^G)),A(A(F,x[Y]),(b=Y)<20?1518500249:b<40?1859775393:b<60?-1894007588:-899497514)),F=W,W=Z,Z=p(R,30),R=B,B=K}B=A(B,V),R=A(R,z),Z=A(Z,U),W=A(W,J),F=A(F,H)}return Array(B,R,Z,W,F)}function A(y,v){var b=(65535&y)+(65535&v);return(y>>16)+(v>>16)+(b>>16)<<16|65535&b}function p(y,v){return y<<v|y>>>32-v}i.exports=function(y){return f.hash(y,I,20,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(t,i,r){(function(s,o,a,l,c,g,u,d,h){function f(v,b){var w=(65535&v)+(65535&b);return(v>>16)+(b>>16)+(w>>16)<<16|65535&w}function I(v,b){var w,G=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),x=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),B=new Array(64);v[b>>5]|=128<<24-b%32,v[15+(b+64>>9<<4)]=b;for(var R,Z,W=0;W<v.length;W+=16){for(var F=x[0],T=x[1],V=x[2],z=x[3],U=x[4],J=x[5],H=x[6],Y=x[7],K=0;K<64;K++)B[K]=K<16?v[K+W]:f(f(f((Z=B[K-2],p(Z,17)^p(Z,19)^y(Z,10)),B[K-7]),(Z=B[K-15],p(Z,7)^p(Z,18)^y(Z,3))),B[K-16]),w=f(f(f(f(Y,p(Z=U,6)^p(Z,11)^p(Z,25)),U&J^~U&H),G[K]),B[K]),R=f(p(R=F,2)^p(R,13)^p(R,22),F&T^F&V^T&V),Y=H,H=J,J=U,U=f(z,w),z=V,V=T,T=F,F=f(w,R);x[0]=f(F,x[0]),x[1]=f(T,x[1]),x[2]=f(V,x[2]),x[3]=f(z,x[3]),x[4]=f(U,x[4]),x[5]=f(J,x[5]),x[6]=f(H,x[6]),x[7]=f(Y,x[7])}return x}var A=t("./helpers"),p=function(v,b){return v>>>b|v<<32-b},y=function(v,b){return v>>>b};i.exports=function(v){return A.hash(v,I,32,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(t,i,r){(function(s,o,a,l,c,g,u,d,h){r.read=function(f,I,A,p,W){var v,b,w=8*W-p-1,G=(1<<w)-1,x=G>>1,B=-7,R=A?W-1:0,Z=A?-1:1,W=f[I+R];for(R+=Z,v=W&(1<<-B)-1,W>>=-B,B+=w;0<B;v=256*v+f[I+R],R+=Z,B-=8);for(b=v&(1<<-B)-1,v>>=-B,B+=p;0<B;b=256*b+f[I+R],R+=Z,B-=8);if(v===0)v=1-x;else{if(v===G)return b?NaN:1/0*(W?-1:1);b+=Math.pow(2,p),v-=x}return(W?-1:1)*b*Math.pow(2,v-p)},r.write=function(f,I,A,p,y,F){var b,w,G=8*F-y-1,x=(1<<G)-1,B=x>>1,R=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,Z=p?0:F-1,W=p?1:-1,F=I<0||I===0&&1/I<0?1:0;for(I=Math.abs(I),isNaN(I)||I===1/0?(w=isNaN(I)?1:0,b=x):(b=Math.floor(Math.log(I)/Math.LN2),I*(p=Math.pow(2,-b))<1&&(b--,p*=2),2<=(I+=1<=b+B?R/p:R*Math.pow(2,1-B))*p&&(b++,p/=2),x<=b+B?(w=0,b=x):1<=b+B?(w=(I*p-1)*Math.pow(2,y),b+=B):(w=I*Math.pow(2,B-1)*Math.pow(2,y),b=0));8<=y;f[A+Z]=255&w,Z+=W,w/=256,y-=8);for(b=b<<y|w,G+=y;0<G;f[A+Z]=255&b,Z+=W,b/=256,G-=8);f[A+Z-W]|=128*F}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(t,i,r){(function(s,o,a,l,c,g,u,d,h){var f,I,A;function p(){}(s=i.exports={}).nextTick=(I=typeof window<"u"&&window.setImmediate,A=typeof window<"u"&&window.postMessage&&window.addEventListener,I?function(y){return window.setImmediate(y)}:A?(f=[],window.addEventListener("message",function(y){var v=y.source;v!==window&&v!==null||y.data!=="process-tick"||(y.stopPropagation(),0<f.length&&f.shift()())},!0),function(y){f.push(y),window.postMessage("process-tick","*")}):function(y){setTimeout(y,0)}),s.title="browser",s.browser=!0,s.env={},s.argv=[],s.on=p,s.addListener=p,s.once=p,s.off=p,s.removeListener=p,s.removeAllListeners=p,s.emit=p,s.binding=function(y){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(y){throw new Error("process.chdir is not supported")}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(Y8);var Abe=Y8.exports;const Cbe=Ks(Abe);var Ln={position:"csm_Position",positionRaw:"csm_PositionRaw",pointSize:"csm_PointSize",fragColor:"csm_FragColor",diffuseColor:"csm_DiffuseColor",normal:"csm_Normal",roughness:"csm_Roughness",metalness:"csm_Metalness",emissive:"csm_Emissive"};const pbe={[`${Ln.normal}`]:{"#include <beginnormal_vertex>":`
    vec3 objectNormal = ${Ln.normal};
    #ifdef USE_TANGENT
	    vec3 objectTangent = vec3( tangent.xyz );
    #endif
    `},[`${Ln.position}`]:{"#include <begin_vertex>":`
    vec3 transformed = ${Ln.position};
  `},[`${Ln.positionRaw}`]:{"#include <begin_vertex>":`
    vec4 csm_positionUnprojected = ${Ln.positionRaw};
    mat4x4 csm_unprojectMatrix = projectionMatrix * modelViewMatrix;
    #ifdef USE_INSTANCING
      csm_unprojectMatrix = csm_unprojectMatrix * instanceMatrix;
    #endif
    csm_positionUnprojected = inverse(csm_unprojectMatrix) * csm_positionUnprojected;
    vec3 transformed = csm_positionUnprojected.xyz;
  `},[`${Ln.pointSize}`]:{"gl_PointSize = size;":`
    gl_PointSize = ${Ln.pointSize};
    `},[`${Ln.diffuseColor}`]:{"#include <color_fragment>":`
    #include <color_fragment>
    diffuseColor = ${Ln.diffuseColor};
  `},[`${Ln.fragColor}`]:{"#include <dithering_fragment>":`
    #include <dithering_fragment>
    gl_FragColor  = ${Ln.fragColor};
  `},[`${Ln.emissive}`]:{"vec3 totalEmissiveRadiance = emissive;":`
    vec3 totalEmissiveRadiance = ${Ln.emissive};
    `},[`${Ln.roughness}`]:{"#include <roughnessmap_fragment>":`
    #include <roughnessmap_fragment>
    roughnessFactor = ${Ln.roughness};
    `},[`${Ln.metalness}`]:{"#include <metalnessmap_fragment>":`
    #include <metalnessmap_fragment>
    metalnessFactor = ${Ln.metalness};
    `}},mbe={[`${Ln.position}`]:{"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );":`
    gl_Position = projectionMatrix * modelViewMatrix * vec4( ${Ln.position}, 1.0 );
  `},[`${Ln.positionRaw}`]:{"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );":`
    gl_Position = ${Ln.position};
  `},[`${Ln.diffuseColor}`]:{"gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );":`
    gl_FragColor = ${Ln.diffuseColor};
  `},[`${Ln.fragColor}`]:{"gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );":`
    gl_FragColor = ${Ln.fragColor};
  `}},ybe=`

#ifdef IS_VERTEX
    vec3 csm_Position = position;
    vec4 csm_PositionRaw = projectionMatrix * modelViewMatrix * vec4(position, 1.);
    vec3 csm_Normal = normal;
#else
    #if defined IS_SHADERMATERIAL || defined IS_MESHDEPTHMATERIAL || defined IS_MESHNORMALMATERIAL
        vec4 csm_DiffuseColor = vec4(1., 0., 1., 1.);
        vec4 csm_FragColor = vec4(1., 0., 1., 1.);
    #else
        #if defined IS_MESHSTANDARDMATERIAL || defined IS_MESHPHYSICALMATERIAL
            vec3 csm_Emissive = emissive;
            float csm_Roughness = roughness;
            float csm_Metalness = metalness;
        #endif
        
        #ifdef USE_MAP
            vec4 _csm_sampledDiffuseColor = texture2D(map, vUv);

            #ifdef DECODE_VIDEO_TEXTURE
            // inline sRGB decode (TODO: Remove this code when https://crbug.com/1256340 is solved)
            _csm_sampledDiffuseColor = vec4(mix(pow(_csm_sampledDiffuseColor.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), _csm_sampledDiffuseColor.rgb * 0.0773993808, vec3(lessThanEqual(_csm_sampledDiffuseColor.rgb, vec3(0.04045)))), _csm_sampledDiffuseColor.w);
            #endif

            vec4 csm_DiffuseColor = vec4(diffuse, opacity) * _csm_sampledDiffuseColor;
            vec4 csm_FragColor = vec4(diffuse, opacity) * _csm_sampledDiffuseColor;
        #else
            vec4 csm_DiffuseColor = vec4(diffuse, opacity);
            vec4 csm_FragColor = vec4(diffuse, opacity);
        #endif
    #endif
#endif
`,vbe=(n,e,t)=>n.split(e).join(t),bbe=function(n){return n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},Bbe=(n,e)=>new RegExp(`\\b${bbe(e)}\\b`).test(n);function Gbe(n){try{new n}catch(e){if(e.message.indexOf("is not a constructor")>=0)return!1}return!0}class wbe extends ai{constructor({baseMaterial:e,fragmentShader:t,vertexShader:i,uniforms:r,patchMap:s,cacheKey:o,...a}){let l;if(Gbe(e)?l=new e(a):(l=e,Object.assign(l,a)),l.type==="RawShaderMaterial")throw new Error("CustomShaderMaterial does not support RawShaderMaterial");super(),this.uniforms=r||{},this._customPatchMap=s||{},this._fs=t||"",this._vs=i||"",this._cacheKey=o,this._base=e,this._type=l.type,this._instanceID=ss.generateUUID();for(const c in l){let g=c;c.startsWith("_")&&(g=c.split("_")[1]),this[g]===void 0&&(this[g]=0),this[g]=l[g]}this.update({fragmentShader:t,vertexShader:i,uniforms:r,cacheKey:o})}update(e){const t=(e==null?void 0:e.uniforms)||{},i=(e==null?void 0:e.fragmentShader)||this._fs,r=(e==null?void 0:e.vertexShader)||this._vs,s=Object.values(t).reduce((o,{value:a})=>o+JSON.stringify(a),"");this.uuid=(e==null||e.cacheKey==null?void 0:e.cacheKey())||Cbe([i,r,s,this._instanceID]),this.generateMaterial({fragmentShader:i,vertexShader:r,uniforms:t})}clone(){const e=new this.constructor({baseMaterial:this._base,fragmentShader:this._fs,vertexShader:this._vs,patchMap:this._customPatchMap,uniforms:this.uniforms,cacheKey:this._cacheKey});for(const t in this)t!=="uuid"&&(e[t]=this[t]);return e}generateMaterial({fragmentShader:e,vertexShader:t,uniforms:i}){const r=this.parseShader(e),s=this.parseShader(t);this.uniforms=i||{},this.customProgramCacheKey=()=>this.uuid,this.onBeforeCompile=o=>{if(r){const a=this.patchShader(r,o.fragmentShader);o.fragmentShader=this.getMaterialDefine()+a}if(s){const a=this.patchShader(s,o.vertexShader);o.vertexShader=`#define IS_VERTEX;
`+a,o.vertexShader=this.getMaterialDefine()+o.vertexShader}o.uniforms={...o.uniforms,...this.uniforms},this.uniforms=o.uniforms},this.needsUpdate=!0}getMaterialDefine(){return`#define IS_${this._type.toUpperCase()};
`}getPatchMapForMaterial(){switch(this._type){case"ShaderMaterial":return mbe;default:return pbe}}patchShader(e,t){let i=t;const r={...this.getPatchMapForMaterial(),...this._customPatchMap};return Object.keys(r).forEach(s=>{Object.keys(r[s]).forEach(o=>{Bbe(e.main,s)&&(i=vbe(i,o,r[s][o]))})}),i=i.replace("void main() {",`
          ${e.header}
          void main() {
            ${ybe}
            ${e.main}
          `),i=e.defines+i,i}parseShader(e){if(!e)return;const t=e.replace(/\/\*\*(.*?)\*\/|\/\/(.*?)\n/gm,""),i=GW(t),r=wW(i),s=r.map(l=>l.name).indexOf("main"),o=z0(i.slice(0,s>=0?r[s].outer[0]:void 0)),a=s>=0?this.getShaderFromIndex(i,r[s].body):"";return{defines:"",header:o,main:a}}getShaderFromIndex(e,t){return z0(e.slice(t[0],t[1]))}}function K8(...n){return e=>n.forEach(t=>function(i,r){typeof i=="function"?i(r):i!=null&&(i.current=r)}(t,e))}function ax(...n){return M.useCallback(K8(...n),n)}const AT=M.forwardRef((n,e)=>{const{children:t,...i}=n;return M.Children.toArray(t).some(DX)?M.createElement(M.Fragment,null,M.Children.map(t,r=>DX(r)?M.createElement(xW,pt({},i,{ref:e}),r.props.children):r)):M.createElement(xW,pt({},i,{ref:e}),t)});AT.displayName="Slot";const xW=M.forwardRef((n,e)=>{const{children:t,...i}=n;return M.isValidElement(t)?M.cloneElement(t,{...xbe(i,t.props),ref:K8(e,t.ref)}):M.Children.count(t)>1?M.Children.only(null):null});xW.displayName="SlotClone";const D8=({children:n})=>M.createElement(M.Fragment,null,n);function DX(n){return M.isValidElement(n)&&n.type===D8}function xbe(n,e){const t={...e};for(const i in e){const r=n[i],s=e[i];/^on[A-Z]/.test(i)?t[i]=(...o)=>{s==null||s(...o),r==null||r(...o)}:i==="style"?t[i]={...r,...s}:i==="className"&&(t[i]=[r,s].filter(Boolean).join(" "))}return{...n,...t}}const Sbe=["a","button","div","h2","h3","img","li","nav","ol","p","span","svg","ul"].reduce((n,e)=>({...n,[e]:M.forwardRef((t,i)=>{const{asChild:r,...s}=t,o=r?AT:e;return M.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),M.createElement(o,pt({},s,{ref:i}))})}),{}),Ky=globalThis!=null&&globalThis.document?M.useLayoutEffect:()=>{},Rbe=M.forwardRef((n,e)=>{var t,i;const{containerRef:r,style:s,...o}=n,a=(t=r==null?void 0:r.current)!==null&&t!==void 0?t:globalThis==null||(i=globalThis.document)===null||i===void 0?void 0:i.body,[,l]=M.useState({});return Ky(()=>{l({})},[]),a?DQ.createPortal(M.createElement(Sbe.div,pt({"data-radix-portal":""},o,{ref:e,style:a===document.body?{position:"absolute",top:0,left:0,zIndex:2147483647,...s}:void 0})),a):null}),Zbe=Rbe;var PX=Object.prototype.hasOwnProperty;function V2(n,e){var t,i;if(n===e)return!0;if(n&&e&&(t=n.constructor)===e.constructor){if(t===Date)return n.getTime()===e.getTime();if(t===RegExp)return n.toString()===e.toString();if(t===Array){if((i=n.length)===e.length)for(;i--&&V2(n[i],e[i]););return i===-1}if(!t||typeof n=="object"){i=0;for(t in n)if(PX.call(n,t)&&++i&&!PX.call(e,t)||!(t in e)||!V2(n[t],e[t]))return!1;return Object.keys(e).length===i}}return n!==n&&e!==e}var lx=function(e,t,i,r){this.name=e,this.fn=t,this.args=i,this.modifiers=r};lx.prototype._test=function(e){var t=this.fn;try{PA(this.modifiers.slice(),t,this)(e)}catch{t=function(){return!1}}try{return PA(this.modifiers.slice(),t,this)(e)}catch{return!1}};lx.prototype._check=function(e){try{PA(this.modifiers.slice(),this.fn,this)(e)}catch{if(PA(this.modifiers.slice(),function(i){return i},this)(!1))return}if(!PA(this.modifiers.slice(),this.fn,this)(e))throw null};lx.prototype._testAsync=function(e){var t=this;return new Promise(function(i,r){U8(t.modifiers.slice(),t.fn,t)(e).then(function(s){s?i(e):r(null)}).catch(function(s){return r(s)})})};function P8(n,e){return e===void 0&&(e="simple"),typeof n=="object"?n[e]:n}function PA(n,e,t){if(n.length){var i=n.shift(),r=PA(n,e,t);return i.perform(r,t)}else return P8(e)}function U8(n,e,t){if(n.length){var i=n.shift(),r=U8(n,e,t);return i.performAsync(r,t)}else return function(s){return Promise.resolve(P8(e,"async")(s))}}var Mbe=function(e,t,i){this.name=e,this.perform=t,this.performAsync=i},CT=function(n){function e(t,i,r,s){for(var o=[],a=arguments.length-4;a-- >0;)o[a]=arguments[a+4];n.call(this,o),n.captureStackTrace&&n.captureStackTrace(this,e),this.rule=t,this.value=i,this.cause=r,this.target=s}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e}(Error),Zc=function(e,t){e===void 0&&(e=[]),t===void 0&&(t=[]),this.chain=e,this.nextRuleModifiers=t};Zc.prototype._applyRule=function(e,t){var i=this;return function(){for(var r=[],s=arguments.length;s--;)r[s]=arguments[s];return i.chain.push(new lx(t,e.apply(i,r),r,i.nextRuleModifiers)),i.nextRuleModifiers=[],i}};Zc.prototype._applyModifier=function(e,t){return this.nextRuleModifiers.push(new Mbe(t,e.simple,e.async)),this};Zc.prototype._clone=function(){return new Zc(this.chain.slice(),this.nextRuleModifiers.slice())};Zc.prototype.test=function(e){return this.chain.every(function(t){return t._test(e)})};Zc.prototype.testAll=function(e){var t=[];return this.chain.forEach(function(i){try{i._check(e)}catch(r){t.push(new CT(i,e,r))}}),t};Zc.prototype.check=function(e){this.chain.forEach(function(t){try{t._check(e)}catch(i){throw new CT(t,e,i)}})};Zc.prototype.testAsync=function(e){var t=this;return new Promise(function(i,r){Q8(e,t.chain.slice(),i,r)})};function Q8(n,e,t,i){if(e.length){var r=e.shift();r._testAsync(n).then(function(){Q8(n,e,t,i)},function(s){i(new CT(r,n,s))})}else t(n)}var UX=function(n,e){return e&&typeof n=="string"&&n.trim().length===0?!0:n==null};function Ebe(n,e){return e===void 0&&(e=!1),{simple:function(t){return UX(t,e)||n.check(t)===void 0},async:function(t){return UX(t,e)||n.testAsync(t)}}}function Io(){return typeof Proxy<"u"?O8(new Zc):SW(new Zc)}var Dy={};Io.extend=function(n){Object.assign(Dy,n)};Io.clearCustomRules=function(){Dy={}};function O8(n){return new Proxy(n,{get:function(t,i){if(i in t)return t[i];var r=O8(n._clone());if(i in T2)return r._applyModifier(T2[i],i);if(i in Dy)return r._applyRule(Dy[i],i);if(i in RW)return r._applyRule(RW[i],i)}})}function SW(n){var e=function(r,s){return Object.keys(r).forEach(function(o){s[o]=function(){for(var a=[],l=arguments.length;l--;)a[l]=arguments[l];var c=SW(s._clone()),g=c._applyRule(r[o],o).apply(void 0,a);return g}}),s},t=e(RW,n),i=e(Dy,t);return Object.keys(T2).forEach(function(r){Object.defineProperty(i,r,{get:function(){var s=SW(i._clone());return s._applyModifier(T2[r],r)}})}),i}var T2={not:{simple:function(n){return function(e){return!n(e)}},async:function(n){return function(e){return Promise.resolve(n(e)).then(function(t){return!t}).catch(function(){return!0})}}},some:{simple:function(n){return function(e){return cG(e).some(function(t){try{return n(t)}catch{return!1}})}},async:function(n){return function(e){return Promise.all(cG(e).map(function(t){try{return n(t).catch(function(){return!1})}catch{return!1}})).then(function(t){return t.some(Boolean)})}}},every:{simple:function(n){return function(e){return e!==!1&&cG(e).every(n)}},async:function(n){return function(e){return Promise.all(cG(e).map(n)).then(function(t){return t.every(Boolean)})}}},strict:{simple:function(n,e){return function(t){return QX(e)&&t&&typeof t=="object"?Object.keys(e.args[0]).length===Object.keys(t).length&&n(t):n(t)}},async:function(n,e){return function(t){return Promise.resolve(n(t)).then(function(i){return QX(e)&&t&&typeof t=="object"?Object.keys(e.args[0]).length===Object.keys(t).length&&i:i}).catch(function(){return!1})}}}};function QX(n){return n&&n.name==="schema"&&n.args.length>0&&typeof n.args[0]=="object"}function cG(n){return typeof n=="string"?n.split(""):n}var RW={equal:function(n){return function(e){return e==n}},exact:function(n){return function(e){return e===n}},number:function(n){return n===void 0&&(n=!0),function(e){return typeof e=="number"&&(n||isFinite(e))}},integer:function(){return function(n){var e=Number.isInteger||Wbe;return e(n)}},numeric:function(){return function(n){return!isNaN(parseFloat(n))&&isFinite(n)}},string:function(){return EI("string")},boolean:function(){return EI("boolean")},undefined:function(){return EI("undefined")},null:function(){return EI("null")},array:function(){return EI("array")},object:function(){return EI("object")},instanceOf:function(n){return function(e){return e instanceof n}},pattern:function(n){return function(e){return n.test(e)}},lowercase:function(){return function(n){return typeof n=="boolean"||n===n.toLowerCase()&&n.trim()!==""}},uppercase:function(){return function(n){return n===n.toUpperCase()&&n.trim()!==""}},vowel:function(){return function(n){return/^[aeiou]+$/i.test(n)}},consonant:function(){return function(n){return/^(?=[^aeiou])([a-z]+)$/i.test(n)}},first:function(n){return function(e){return e[0]==n}},last:function(n){return function(e){return e[e.length-1]==n}},empty:function(){return function(n){return n.length===0}},length:function(n,e){return function(t){return t.length>=n&&t.length<=(e||n)}},minLength:function(n){return function(e){return e.length>=n}},maxLength:function(n){return function(e){return e.length<=n}},negative:function(){return function(n){return n<0}},positive:function(){return function(n){return n>=0}},between:function(n,e){return function(t){return t>=n&&t<=e}},range:function(n,e){return function(t){return t>=n&&t<=e}},lessThan:function(n){return function(e){return e<n}},lessThanOrEqual:function(n){return function(e){return e<=n}},greaterThan:function(n){return function(e){return e>n}},greaterThanOrEqual:function(n){return function(e){return e>=n}},even:function(){return function(n){return n%2===0}},odd:function(){return function(n){return n%2!==0}},includes:function(n){return function(e){return~e.indexOf(n)}},schema:function(n){return Fbe(n)},passesAnyOf:function(){for(var n=[],e=arguments.length;e--;)n[e]=arguments[e];return function(t){return n.some(function(i){return i.test(t)})}},optional:Ebe};function EI(n){return function(e){return Array.isArray(e)&&n==="array"||e===null&&n==="null"||typeof e===n}}function Wbe(n){return typeof n=="number"&&isFinite(n)&&Math.floor(n)===n}function Fbe(n){return{simple:function(e){var t=[];if(Object.keys(n).forEach(function(i){var r=n[i];try{r.check((e||{})[i])}catch(s){s.target=i,t.push(s)}}),t.length>0)throw t;return!0},async:function(e){var t=[],i=Object.keys(n).map(function(r){var s=n[r];return s.testAsync((e||{})[r]).catch(function(o){o.target=r,t.push(o)})});return Promise.all(i).then(function(){if(t.length>0)throw t;return!0})}}}var En="colors",Ss="sizes",ct="space",_be={gap:ct,gridGap:ct,columnGap:ct,gridColumnGap:ct,rowGap:ct,gridRowGap:ct,inset:ct,insetBlock:ct,insetBlockEnd:ct,insetBlockStart:ct,insetInline:ct,insetInlineEnd:ct,insetInlineStart:ct,margin:ct,marginTop:ct,marginRight:ct,marginBottom:ct,marginLeft:ct,marginBlock:ct,marginBlockEnd:ct,marginBlockStart:ct,marginInline:ct,marginInlineEnd:ct,marginInlineStart:ct,padding:ct,paddingTop:ct,paddingRight:ct,paddingBottom:ct,paddingLeft:ct,paddingBlock:ct,paddingBlockEnd:ct,paddingBlockStart:ct,paddingInline:ct,paddingInlineEnd:ct,paddingInlineStart:ct,top:ct,right:ct,bottom:ct,left:ct,scrollMargin:ct,scrollMarginTop:ct,scrollMarginRight:ct,scrollMarginBottom:ct,scrollMarginLeft:ct,scrollMarginX:ct,scrollMarginY:ct,scrollMarginBlock:ct,scrollMarginBlockEnd:ct,scrollMarginBlockStart:ct,scrollMarginInline:ct,scrollMarginInlineEnd:ct,scrollMarginInlineStart:ct,scrollPadding:ct,scrollPaddingTop:ct,scrollPaddingRight:ct,scrollPaddingBottom:ct,scrollPaddingLeft:ct,scrollPaddingX:ct,scrollPaddingY:ct,scrollPaddingBlock:ct,scrollPaddingBlockEnd:ct,scrollPaddingBlockStart:ct,scrollPaddingInline:ct,scrollPaddingInlineEnd:ct,scrollPaddingInlineStart:ct,fontSize:"fontSizes",background:En,backgroundColor:En,backgroundImage:En,borderImage:En,border:En,borderBlock:En,borderBlockEnd:En,borderBlockStart:En,borderBottom:En,borderBottomColor:En,borderColor:En,borderInline:En,borderInlineEnd:En,borderInlineStart:En,borderLeft:En,borderLeftColor:En,borderRight:En,borderRightColor:En,borderTop:En,borderTopColor:En,caretColor:En,color:En,columnRuleColor:En,fill:En,outline:En,outlineColor:En,stroke:En,textDecorationColor:En,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:Ss,minBlockSize:Ss,maxBlockSize:Ss,inlineSize:Ss,minInlineSize:Ss,maxInlineSize:Ss,width:Ss,minWidth:Ss,maxWidth:Ss,height:Ss,minHeight:Ss,maxHeight:Ss,flexBasis:Ss,gridTemplateColumns:Ss,gridTemplateRows:Ss,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},Vbe=(n,e)=>typeof e=="function"?{"()":Function.prototype.toString.call(e)}:e,UC=()=>{const n=Object.create(null);return(e,t,...i)=>{const r=(s=>JSON.stringify(s,Vbe))(e);return r in n?n[r]:n[r]=t(e,...i)}},nf=Symbol.for("sxs.internal"),pT=(n,e)=>Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)),OX=n=>{for(const e in n)return!0;return!1},{hasOwnProperty:Tbe}=Object.prototype,ZW=n=>n.includes("-")?n:n.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()),Nbe=/\s+(?![^()]*\))/,WI=n=>e=>n(...typeof e=="string"?String(e).split(Nbe):[e]),JX={appearance:n=>({WebkitAppearance:n,appearance:n}),backfaceVisibility:n=>({WebkitBackfaceVisibility:n,backfaceVisibility:n}),backdropFilter:n=>({WebkitBackdropFilter:n,backdropFilter:n}),backgroundClip:n=>({WebkitBackgroundClip:n,backgroundClip:n}),boxDecorationBreak:n=>({WebkitBoxDecorationBreak:n,boxDecorationBreak:n}),clipPath:n=>({WebkitClipPath:n,clipPath:n}),content:n=>({content:n.includes('"')||n.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(n)?n:`"${n}"`}),hyphens:n=>({WebkitHyphens:n,hyphens:n}),maskImage:n=>({WebkitMaskImage:n,maskImage:n}),maskSize:n=>({WebkitMaskSize:n,maskSize:n}),tabSize:n=>({MozTabSize:n,tabSize:n}),textSizeAdjust:n=>({WebkitTextSizeAdjust:n,textSizeAdjust:n}),userSelect:n=>({WebkitUserSelect:n,userSelect:n}),marginBlock:WI((n,e)=>({marginBlockStart:n,marginBlockEnd:e||n})),marginInline:WI((n,e)=>({marginInlineStart:n,marginInlineEnd:e||n})),maxSize:WI((n,e)=>({maxBlockSize:n,maxInlineSize:e||n})),minSize:WI((n,e)=>({minBlockSize:n,minInlineSize:e||n})),paddingBlock:WI((n,e)=>({paddingBlockStart:n,paddingBlockEnd:e||n})),paddingInline:WI((n,e)=>({paddingInlineStart:n,paddingInlineEnd:e||n}))},VZ=/([\d.]+)([^]*)/,kbe=(n,e)=>n.length?n.reduce((t,i)=>(t.push(...e.map(r=>r.includes("&")?r.replace(/&/g,/[ +>|~]/.test(i)&&/&.*&/.test(r)?`:is(${i})`:i):i+" "+r)),t),[]):e,Lbe=(n,e)=>n in Hbe&&typeof e=="string"?e.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(t,i,r,s)=>i+(r==="stretch"?`-moz-available${s};${ZW(n)}:${i}-webkit-fill-available`:`-moz-fit-content${s};${ZW(n)}:${i}fit-content`)+s):String(e),Hbe={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},Og=n=>n?n+"-":"",J8=(n,e,t)=>n.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(i,r,s,o,a)=>o=="$"==!!s?i:(r||o=="--"?"calc(":"")+"var(--"+(o==="$"?Og(e)+(a.includes("$")?"":Og(t))+a.replace(/\$/g,"-"):a)+")"+(r||o=="--"?"*"+(r||"")+(s||"1")+")":"")),zbe=/\s*,\s*(?![^()]*\))/,Xbe=Object.prototype.toString,GA=(n,e,t,i,r)=>{let s,o,a;const l=(c,g,u)=>{let d,h;const f=I=>{for(d in I){const y=d.charCodeAt(0)===64,v=y&&Array.isArray(I[d])?I[d]:[I[d]];for(h of v){const b=/[A-Z]/.test(p=d)?p:p.replace(/-[^]/g,G=>G[1].toUpperCase()),w=typeof h=="object"&&h&&h.toString===Xbe&&(!i.utils[b]||!g.length);if(b in i.utils&&!w){const G=i.utils[b];if(G!==o){o=G,f(G(h)),o=null;continue}}else if(b in JX){const G=JX[b];if(G!==a){a=G,f(G(h)),a=null;continue}}if(y&&(A=d.slice(1)in i.media?"@media "+i.media[d.slice(1)]:d,d=A.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(G,x,B,R,Z,W)=>{const F=VZ.test(x),T=.0625*(F?-1:1),[V,z]=F?[R,x]:[x,R];return"("+(B[0]==="="?"":B[0]===">"===F?"max-":"min-")+V+":"+(B[0]!=="="&&B.length===1?z.replace(VZ,(U,J,H)=>Number(J)+T*(B===">"?1:-1)+H):z)+(Z?") and ("+(Z[0]===">"?"min-":"max-")+V+":"+(Z.length===1?W.replace(VZ,(U,J,H)=>Number(J)+T*(Z===">"?-1:1)+H):W):"")+")"})),w){const G=y?u.concat(d):[...u],x=y?[...g]:kbe(g,d.split(zbe));s!==void 0&&r(jX(...s)),s=void 0,l(h,x,G)}else s===void 0&&(s=[[],g,u]),d=y||d.charCodeAt(0)!==36?d:`--${Og(i.prefix)}${d.slice(1).replace(/\$/g,"-")}`,h=w?h:typeof h=="number"?h&&b in Ybe?String(h)+"px":String(h):J8(Lbe(b,h??""),i.prefix,i.themeMap[b]),s[0].push(`${y?`${d} `:`${ZW(d)}:`}${h}`)}}var A,p};f(c),s!==void 0&&r(jX(...s)),s=void 0};l(n,e,t)},jX=(n,e,t)=>`${t.map(i=>`${i}{`).join("")}${e.length?`${e.join(",")}{`:""}${n.join(";")}${e.length?"}":""}${Array(t.length?t.length+1:0).join("}")}`,Ybe={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},qX=n=>String.fromCharCode(n+(n>25?39:97)),rf=n=>(e=>{let t,i="";for(t=Math.abs(e);t>52;t=t/52|0)i=qX(t%52)+i;return qX(t%52)+i})(((e,t)=>{let i=t.length;for(;i;)e=33*e^t.charCodeAt(--i);return e})(5381,JSON.stringify(n))>>>0),l0=["themed","global","styled","onevar","resonevar","allvar","inline"],Kbe=n=>{if(n.href&&!n.href.startsWith(location.origin))return!1;try{return!!n.cssRules}catch{return!1}},Dbe=n=>{let e;const t=()=>{const{cssRules:r}=e.sheet;return[].map.call(r,(s,o)=>{const{cssText:a}=s;let l="";if(a.startsWith("--sxs"))return"";if(r[o-1]&&(l=r[o-1].cssText).startsWith("--sxs")){if(!s.cssRules.length)return"";for(const c in e.rules)if(e.rules[c].group===s)return`--sxs{--sxs:${[...e.rules[c].cache].join(" ")}}${a}`;return s.cssRules.length?`${l}${a}`:""}return a}).join("")},i=()=>{if(e){const{rules:a,sheet:l}=e;if(!l.deleteRule){for(;Object(Object(l.cssRules)[0]).type===3;)l.cssRules.splice(0,1);l.cssRules=[]}for(const c in a)delete a[c]}const r=Object(n).styleSheets||[];for(const a of r)if(Kbe(a)){for(let l=0,c=a.cssRules;c[l];++l){const g=Object(c[l]);if(g.type!==1)continue;const u=Object(c[l+1]);if(u.type!==4)continue;++l;const{cssText:d}=g;if(!d.startsWith("--sxs"))continue;const h=d.slice(14,-3).trim().split(/\s+/),f=l0[h[0]];f&&(e||(e={sheet:a,reset:i,rules:{},toString:t}),e.rules[f]={group:u,index:l,cache:new Set(h)})}if(e)break}if(!e){const a=(l,c)=>({type:c,cssRules:[],insertRule(g,u){this.cssRules.splice(u,0,a(g,{import:3,undefined:1}[(g.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return l==="@media{}"?`@media{${[].map.call(this.cssRules,g=>g.cssText).join("")}}`:l}});e={sheet:n?(n.head||n).appendChild(document.createElement("style")).sheet:a("","text/css"),rules:{},reset:i,toString:t}}const{sheet:s,rules:o}=e;for(let a=l0.length-1;a>=0;--a){const l=l0[a];if(!o[l]){const c=l0[a+1],g=o[c]?o[c].index:s.cssRules.length;s.insertRule("@media{}",g),s.insertRule(`--sxs{--sxs:${a}}`,g),o[l]={group:s.cssRules[g+1],index:g,cache:new Set([a])}}Pbe(o[l])}};return i(),e},Pbe=n=>{const e=n.group;let t=e.cssRules.length;n.apply=i=>{try{e.insertRule(i,t),++t}catch{}}},Mm=Symbol(),Ube=UC(),$X=(n,e)=>Ube(n,()=>(...t)=>{let i={type:null,composers:new Set};for(const r of t)if(r!=null)if(r[nf]){i.type==null&&(i.type=r[nf].type);for(const s of r[nf].composers)i.composers.add(s)}else r.constructor!==Object||r.$$typeof?i.type==null&&(i.type=r):i.composers.add(Qbe(r,n));return i.type==null&&(i.type="span"),i.composers.size||i.composers.add(["PJLV",{},[],[],{},[]]),Obe(n,i,e)}),Qbe=({variants:n,compoundVariants:e,defaultVariants:t,...i},r)=>{const s=`${Og(r.prefix)}c-${rf(i)}`,o=[],a=[],l=Object.create(null),c=[];for(const d in t)l[d]=String(t[d]);if(typeof n=="object"&&n)for(const d in n){g=l,u=d,Tbe.call(g,u)||(l[d]="undefined");const h=n[d];for(const f in h){const I={[d]:String(f)};String(f)==="undefined"&&c.push(d);const A=h[f],p=[I,A,!OX(A)];o.push(p)}}var g,u;if(typeof e=="object"&&e)for(const d of e){let{css:h,...f}=d;h=typeof h=="object"&&h||{};for(const A in f)f[A]=String(f[A]);const I=[f,h,!OX(h)];a.push(I)}return[s,i,o,a,l,c]},Obe=(n,e,t)=>{const[i,r,s,o]=Jbe(e.composers),a=typeof e.type=="function"||e.type.$$typeof?(u=>{function d(){for(let h=0;h<d[Mm].length;h++){const[f,I]=d[Mm][h];u.rules[f].apply(I)}return d[Mm]=[],null}return d[Mm]=[],d.rules={},l0.forEach(h=>d.rules[h]={apply:f=>d[Mm].push([h,f])}),d})(t):null,l=(a||t).rules,c=`.${i}${r.length>1?`:where(.${r.slice(1).join(".")})`:""}`,g=u=>{u=typeof u=="object"&&u||jbe;const{css:d,...h}=u,f={};for(const p in s)if(delete h[p],p in u){let y=u[p];typeof y=="object"&&y?f[p]={"@initial":s[p],...y}:(y=String(y),f[p]=y!=="undefined"||o.has(p)?y:s[p])}else f[p]=s[p];const I=new Set([...r]);for(const[p,y,v,b]of e.composers){t.rules.styled.cache.has(p)||(t.rules.styled.cache.add(p),GA(y,[`.${p}`],[],n,x=>{l.styled.apply(x)}));const w=eY(v,f,n.media),G=eY(b,f,n.media,!0);for(const x of w)if(x!==void 0)for(const[B,R,Z]of x){const W=`${p}-${rf(R)}-${B}`;I.add(W);const F=(Z?t.rules.resonevar:t.rules.onevar).cache,T=Z?l.resonevar:l.onevar;F.has(W)||(F.add(W),GA(R,[`.${W}`],[],n,V=>{T.apply(V)}))}for(const x of G)if(x!==void 0)for(const[B,R]of x){const Z=`${p}-${rf(R)}-${B}`;I.add(Z),t.rules.allvar.cache.has(Z)||(t.rules.allvar.cache.add(Z),GA(R,[`.${Z}`],[],n,W=>{l.allvar.apply(W)}))}}if(typeof d=="object"&&d){const p=`${i}-i${rf(d)}-css`;I.add(p),t.rules.inline.cache.has(p)||(t.rules.inline.cache.add(p),GA(d,[`.${p}`],[],n,y=>{l.inline.apply(y)}))}for(const p of String(u.className||"").trim().split(/\s+/))p&&I.add(p);const A=h.className=[...I].join(" ");return{type:e.type,className:A,selector:c,props:h,toString:()=>A,deferredInjector:a}};return pT(g,{className:i,selector:c,[nf]:e,toString:()=>(t.rules.styled.cache.has(i)||g(),i)})},Jbe=n=>{let e="";const t=[],i={},r=[];for(const[s,,,,o,a]of n){e===""&&(e=s),t.push(s),r.push(...a);for(const l in o){const c=o[l];(i[l]===void 0||c!=="undefined"||a.includes(c))&&(i[l]=c)}}return[e,t,i,new Set(r)]},eY=(n,e,t,i)=>{const r=[];e:for(let[s,o,a]of n){if(a)continue;let l,c=0,g=!1;for(l in s){const u=s[l];let d=e[l];if(d!==u){if(typeof d!="object"||!d)continue e;{let h,f,I=0;for(const A in d){if(u===String(d[A])){if(A!=="@initial"){const p=A.slice(1);(f=f||[]).push(p in t?t[p]:A.replace(/^@media ?/,"")),g=!0}c+=I,h=!0}++I}if(f&&f.length&&(o={["@media "+f.join(", ")]:o}),!h)continue e}}}(r[c]=r[c]||[]).push([i?"cv":`${l}-${s[l]}`,o,g])}return r},jbe={},qbe=UC(),$be=(n,e)=>qbe(n,()=>(...t)=>{const i=()=>{for(let r of t){r=typeof r=="object"&&r||{};let s=rf(r);if(!e.rules.global.cache.has(s)){if(e.rules.global.cache.add(s),"@import"in r){let o=[].indexOf.call(e.sheet.cssRules,e.rules.themed.group)-1;for(let a of[].concat(r["@import"]))a=a.includes('"')||a.includes("'")?a:`"${a}"`,e.sheet.insertRule(`@import ${a};`,o++);delete r["@import"]}GA(r,[],[],n,o=>{e.rules.global.apply(o)})}}return""};return pT(i,{toString:i})}),eBe=UC(),tBe=(n,e)=>eBe(n,()=>t=>{const i=`${Og(n.prefix)}k-${rf(t)}`,r=()=>{if(!e.rules.global.cache.has(i)){e.rules.global.cache.add(i);const s=[];GA(t,[],[],n,a=>s.push(a));const o=`@keyframes ${i}{${s.join("")}}`;e.rules.global.apply(o)}return i};return pT(r,{get name(){return r()},toString:r})}),nBe=class{constructor(n,e,t,i){this.token=n==null?"":String(n),this.value=e==null?"":String(e),this.scale=t==null?"":String(t),this.prefix=i==null?"":String(i)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+Og(this.prefix)+Og(this.scale)+this.token}toString(){return this.computedValue}},iBe=UC(),rBe=(n,e)=>iBe(n,()=>(t,i)=>{i=typeof t=="object"&&t||Object(i);const r=`.${t=(t=typeof t=="string"?t:"")||`${Og(n.prefix)}t-${rf(i)}`}`,s={},o=[];for(const l in i){s[l]={};for(const c in i[l]){const g=`--${Og(n.prefix)}${l}-${c}`,u=J8(String(i[l][c]),n.prefix,l);s[l][c]=new nBe(c,u,l,n.prefix),o.push(`${g}:${u}`)}}const a=()=>{if(o.length&&!e.rules.themed.cache.has(t)){e.rules.themed.cache.add(t);const l=`${i===n.theme?":root,":""}.${t}{${o.join(";")}}`;e.rules.themed.apply(l)}return t};return{...s,get className(){return a()},selector:r,toString:a}}),sBe=UC(),oBe=UC(),aBe=n=>{const e=(t=>{let i=!1;const r=sBe(t,s=>{i=!0;const o="prefix"in(s=typeof s=="object"&&s||{})?String(s.prefix):"",a=typeof s.media=="object"&&s.media||{},l=typeof s.root=="object"?s.root||null:globalThis.document||null,c=typeof s.theme=="object"&&s.theme||{},g={prefix:o,media:a,theme:c,themeMap:typeof s.themeMap=="object"&&s.themeMap||{..._be},utils:typeof s.utils=="object"&&s.utils||{}},u=Dbe(l),d={css:$X(g,u),globalCss:$be(g,u),keyframes:tBe(g,u),createTheme:rBe(g,u),reset(){u.reset(),d.theme.toString()},theme:{},sheet:u,config:g,prefix:o,getCssText:u.toString,toString:u.toString};return String(d.theme=d.createTheme(c)),d});return i||r.reset(),r})(n);return e.styled=(({config:t,sheet:i})=>oBe(t,()=>{const r=$X(t,i);return(...s)=>{const o=r(...s),a=o[nf].type,l=L.forwardRef((c,g)=>{const u=c&&c.as||a,{props:d,deferredInjector:h}=o(c);return delete d.as,d.ref=g,h?L.createElement(L.Fragment,null,L.createElement(u,d),L.createElement(h,null)):L.createElement(u,d)});return l.className=o.className,l.displayName=`Styled.${a.displayName||a.name||a}`,l.selector=o.selector,l.toString=()=>o.selector,l[nf]=o[nf],l}}))(e),e};const lBe=UM["useId".toString()]||(()=>{});let cBe=0;function gBe(n){const[e,t]=M.useState(lBe());return Ky(()=>{n||t(i=>i??String(cBe++))},[n]),n||(e?`radix-${e}`:"")}const QC=["a","button","div","h2","h3","img","li","nav","p","span","svg","ul"].reduce((n,e)=>({...n,[e]:M.forwardRef((t,i)=>{const{asChild:r,...s}=t,o=r?AT:e;return M.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),t.as&&console.error(uBe),M.createElement(o,pt({},s,{ref:i}))})}),{}),uBe="Warning: The `as` prop has been removed in favour of `asChild`. For details, see https://radix-ui.com/docs/primitives/overview/styling#changing-the-rendered-element",dBe=M.forwardRef((n,e)=>M.createElement(QC.span,pt({},n,{ref:e,style:{...n.style,position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}}))),hBe=dBe,fBe=M.forwardRef((n,e)=>{var t,i;const{containerRef:r,style:s,...o}=n,a=(t=r==null?void 0:r.current)!==null&&t!==void 0?t:globalThis==null||(i=globalThis.document)===null||i===void 0?void 0:i.body,[,l]=M.useState({});return Ky(()=>{l({})},[]),a?DQ.createPortal(M.createElement(QC.div,pt({"data-radix-portal":""},o,{ref:e,style:a===document.body?{position:"absolute",top:0,left:0,zIndex:2147483647,...s}:void 0})),a):null}),IBe=M.forwardRef((n,e)=>{const{children:t,width:i=10,height:r=5,...s}=n;return M.createElement(QC.svg,pt({},s,{ref:e,width:i,height:r,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),n.asChild?t:M.createElement("polygon",{points:"0,0 30,0 15,10"}))}),ABe=IBe;function tY(n){const[e,t]=M.useState(void 0);return M.useEffect(()=>{if(n){const i=new ResizeObserver(r=>{if(!Array.isArray(r)||!r.length)return;const s=r[0];let o,a;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;o=c.inlineSize,a=c.blockSize}else{const l=n.getBoundingClientRect();o=l.width,a=l.height}t({width:o,height:a})});return i.observe(n,{box:"border-box"}),()=>{t(void 0),i.unobserve(n)}}},[n]),e}function CBe(n,e){const t=Bh.get(n);return t===void 0?(Bh.set(n,{rect:{},callbacks:[e]}),Bh.size===1&&(MW=requestAnimationFrame(j8))):(t.callbacks.push(e),e(n.getBoundingClientRect())),()=>{const i=Bh.get(n);if(i===void 0)return;const r=i.callbacks.indexOf(e);r>-1&&i.callbacks.splice(r,1),i.callbacks.length===0&&(Bh.delete(n),Bh.size===0&&cancelAnimationFrame(MW))}}let MW;const Bh=new Map;function j8(){const n=[];Bh.forEach((e,t)=>{const i=t.getBoundingClientRect();var r,s;r=e.rect,s=i,(r.width!==s.width||r.height!==s.height||r.top!==s.top||r.right!==s.right||r.bottom!==s.bottom||r.left!==s.left)&&(e.rect=i,n.push(e))}),n.forEach(e=>{e.callbacks.forEach(t=>t(e.rect))}),MW=requestAnimationFrame(j8)}function q8(n){const[e,t]=M.useState();return M.useEffect(()=>{if(n){const i=CBe(n,t);return()=>{t(void 0),i()}}},[n]),e}function $8(n,e=[]){let t=[];const i=()=>{const r=t.map(s=>M.createContext(s));return function(s){const o=(s==null?void 0:s[n])||r;return M.useMemo(()=>({[`__scope${n}`]:{...s,[n]:o}}),[s,o])}};return i.scopeName=n,[function(r,s){const o=M.createContext(s),a=t.length;function l(c){const{scope:g,children:u,...d}=c,h=(g==null?void 0:g[n][a])||o,f=M.useMemo(()=>d,Object.values(d));return M.createElement(h.Provider,{value:f},u)}return t=[...t,s],l.displayName=r+"Provider",[l,function(c,g){const u=(g==null?void 0:g[n][a])||o,d=M.useContext(u);if(d)return d;if(s!==void 0)return s;throw new Error(`\`${c}\` must be used within \`${r}\``)}]},pBe(i,...e)]}function pBe(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const i=n.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(r){const s=i.reduce((o,{useScope:a,scopeName:l})=>({...o,...a(r)[`__scope${l}`]}),{});return M.useMemo(()=>({[`__scope${e.scopeName}`]:s}),[s])}};return t.scopeName=e.scopeName,t}function mBe({anchorRect:n,popperSize:e,arrowSize:t,arrowOffset:i=0,side:r,sideOffset:s=0,align:o,alignOffset:a=0,shouldAvoidCollisions:l=!0,collisionBoundariesRect:c,collisionTolerance:g=0}){if(!n||!e||!c)return{popperStyles:yBe,arrowStyles:TZ};const u=function(x,B,R=0,Z=0,W){const F=W?W.height:0,T=nY(B,x,"x"),V=nY(B,x,"y"),z=V.before-R-F,U=V.after+R+F,J=T.before-R-F,H=T.after+R+F;return{top:{start:{x:T.start+Z,y:z},center:{x:T.center,y:z},end:{x:T.end-Z,y:z}},right:{start:{x:H,y:V.start+Z},center:{x:H,y:V.center},end:{x:H,y:V.end-Z}},bottom:{start:{x:T.start+Z,y:U},center:{x:T.center,y:U},end:{x:T.end-Z,y:U}},left:{start:{x:J,y:V.start+Z},center:{x:J,y:V.center},end:{x:J,y:V.end-Z}}}}(e,n,s,a,t),d=u[r][o];if(l===!1){const x=iY(d);let B=TZ;return t&&(B=sY({popperSize:e,arrowSize:t,arrowOffset:i,side:r,align:o})),{popperStyles:{...x,"--radix-popper-transform-origin":rY(e,r,o,i,t)},arrowStyles:B,placedSide:r,placedAlign:o}}const h=DOMRect.fromRect({...e,...d}),f=(I=c,A=g,DOMRect.fromRect({width:I.width-2*A,height:I.height-2*A,x:I.left+A,y:I.top+A}));var I,A;const p=aY(h,f),y=u[oY(r)][o],v=function(x,B,R){const Z=oY(x);return B[x]&&!R[Z]?Z:x}(r,p,aY(DOMRect.fromRect({...e,...y}),f)),b=function(x,B,R,Z,W){const F=R==="top"||R==="bottom",T=F?"left":"top",V=F?"right":"bottom",z=F?"width":"height",U=B[z]>x[z];return(Z==="start"||Z==="center")&&(W[T]&&U||W[V]&&!U)?"end":(Z==="end"||Z==="center")&&(W[V]&&U||W[T]&&!U)?"start":Z}(e,n,r,o,p),w=iY(u[v][b]);let G=TZ;return t&&(G=sY({popperSize:e,arrowSize:t,arrowOffset:i,side:v,align:b})),{popperStyles:{...w,"--radix-popper-transform-origin":rY(e,v,b,i,t)},arrowStyles:G,placedSide:v,placedAlign:b}}function nY(n,e,t){const i=n[t==="x"?"left":"top"],r=t==="x"?"width":"height",s=n[r],o=e[r];return{before:i-o,start:i,center:i+(s-o)/2,end:i+s-o,after:i+s}}function iY(n){return{position:"absolute",top:0,left:0,minWidth:"max-content",willChange:"transform",transform:`translate3d(${Math.round(n.x+window.scrollX)}px, ${Math.round(n.y+window.scrollY)}px, 0)`}}function rY(n,e,t,i,r){const s=e==="top"||e==="bottom",o=r?r.width:0,a=r?r.height:0,l=o/2+i;let c="",g="";return s?(c={start:`${l}px`,center:"center",end:n.width-l+"px"}[t],g=e==="top"?`${n.height+a}px`:-a+"px"):(c=e==="left"?`${n.width+a}px`:-a+"px",g={start:`${l}px`,center:"center",end:n.height-l+"px"}[t]),`${c} ${g}`}const yBe={position:"fixed",top:0,left:0,opacity:0,transform:"translate3d(0, -200%, 0)"},TZ={position:"absolute",opacity:0};function sY({popperSize:n,arrowSize:e,arrowOffset:t,side:i,align:r}){const s=(n.width-e.width)/2,o=(n.height-e.width)/2,a={top:0,right:90,bottom:180,left:-90}[i],l=Math.max(e.width,e.height),c={width:`${l}px`,height:`${l}px`,transform:`rotate(${a}deg)`,willChange:"transform",position:"absolute",[i]:"100%",direction:vBe(i,r)};return i!=="top"&&i!=="bottom"||(r==="start"&&(c.left=`${t}px`),r==="center"&&(c.left=`${s}px`),r==="end"&&(c.right=`${t}px`)),i!=="left"&&i!=="right"||(r==="start"&&(c.top=`${t}px`),r==="center"&&(c.top=`${o}px`),r==="end"&&(c.bottom=`${t}px`)),c}function vBe(n,e){return(n!=="top"&&n!=="right"||e!=="end")&&(n!=="bottom"&&n!=="left"||e==="end")?"ltr":"rtl"}function oY(n){return{top:"bottom",right:"left",bottom:"top",left:"right"}[n]}function aY(n,e){return{top:n.top<e.top,right:n.right>e.right,bottom:n.bottom>e.bottom,left:n.left<e.left}}const[e7,t7]=$8("Popper"),[bBe,n7]=e7("Popper"),BBe=n=>{const{__scopePopper:e,children:t}=n,[i,r]=M.useState(null);return M.createElement(bBe,{scope:e,anchor:i,onAnchorChange:r},t)},GBe=M.forwardRef((n,e)=>{const{__scopePopper:t,virtualRef:i,...r}=n,s=n7("PopperAnchor",t),o=M.useRef(null),a=ax(e,o);return M.useEffect(()=>{s.onAnchorChange((i==null?void 0:i.current)||o.current)}),i?null:M.createElement(QC.div,pt({},r,{ref:a}))}),[wBe,xBe]=e7("PopperContent"),SBe=M.forwardRef((n,e)=>{const{__scopePopper:t,side:i="bottom",sideOffset:r,align:s="center",alignOffset:o,collisionTolerance:a,avoidCollisions:l=!0,...c}=n,g=n7("PopperContent",t),[u,d]=M.useState(),h=q8(g.anchor),[f,I]=M.useState(null),A=tY(f),[p,y]=M.useState(null),v=tY(p),b=ax(e,F=>I(F)),w=function(){const[F,T]=M.useState(void 0);return M.useEffect(()=>{let V;function z(){T({width:window.innerWidth,height:window.innerHeight})}function U(){window.clearTimeout(V),V=window.setTimeout(z,100)}return z(),window.addEventListener("resize",U),()=>window.removeEventListener("resize",U)},[]),F}(),G=w?DOMRect.fromRect({...w,x:0,y:0}):void 0,{popperStyles:x,arrowStyles:B,placedSide:R,placedAlign:Z}=mBe({anchorRect:h,popperSize:A,arrowSize:v,arrowOffset:u,side:i,sideOffset:r,align:s,alignOffset:o,shouldAvoidCollisions:l,collisionBoundariesRect:G,collisionTolerance:a}),W=R!==void 0;return M.createElement("div",{style:x,"data-radix-popper-content-wrapper":""},M.createElement(wBe,{scope:t,arrowStyles:B,onArrowChange:y,onArrowOffsetChange:d},M.createElement(QC.div,pt({"data-side":R,"data-align":Z},c,{style:{...c.style,animation:W?void 0:"none"},ref:b}))))}),RBe=M.forwardRef(function(n,e){const{__scopePopper:t,offset:i,...r}=n,s=xBe("PopperArrow",t),{onArrowOffsetChange:o}=s;return M.useEffect(()=>o(i),[o,i]),M.createElement("span",{style:{...s.arrowStyles,pointerEvents:"none"}},M.createElement("span",{ref:s.onArrowChange,style:{display:"inline-block",verticalAlign:"top",pointerEvents:"auto"}},M.createElement(ABe,pt({},r,{ref:e,style:{...r.style,display:"block"}}))))}),ZBe=BBe,MBe=GBe,EBe=SBe,WBe=RBe,i7=n=>{const{present:e,children:t}=n,i=function(o){const[a,l]=M.useState(),c=M.useRef({}),g=M.useRef(o),u=M.useRef("none"),d=o?"mounted":"unmounted",[h,f]=function(I,A){return M.useReducer((p,y)=>{const v=A[p][y];return v??p},I)}(d,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return M.useEffect(()=>{const I=gG(c.current);u.current=h==="mounted"?I:"none"},[h]),Ky(()=>{const I=c.current,A=g.current;if(A!==o){const p=u.current,y=gG(I);o?f("MOUNT"):y==="none"||(I==null?void 0:I.display)==="none"?f("UNMOUNT"):f(A&&p!==y?"ANIMATION_OUT":"UNMOUNT"),g.current=o}},[o,f]),Ky(()=>{if(a){const I=p=>{const y=gG(c.current).includes(p.animationName);p.target===a&&y&&f("ANIMATION_END")},A=p=>{p.target===a&&(u.current=gG(c.current))};return a.addEventListener("animationstart",A),a.addEventListener("animationcancel",I),a.addEventListener("animationend",I),()=>{a.removeEventListener("animationstart",A),a.removeEventListener("animationcancel",I),a.removeEventListener("animationend",I)}}},[a,f]),{isPresent:["mounted","unmountSuspended"].includes(h),ref:M.useCallback(I=>{I&&(c.current=getComputedStyle(I)),l(I)},[])}}(e),r=typeof t=="function"?t({present:i.isPresent}):M.Children.only(t),s=ax(i.ref,r.ref);return typeof t=="function"||i.isPresent?M.cloneElement(r,{ref:s}):null};function gG(n){return(n==null?void 0:n.animationName)||"none"}i7.displayName="Presence";function lY(n){const e=M.useRef(n);return M.useEffect(()=>{e.current=n},[n]),e.current}function EW(n){const e=M.useRef(n);return M.useEffect(()=>{e.current=n}),M.useMemo(()=>(...t)=>{var i;return(i=e.current)===null||i===void 0?void 0:i.call(e,...t)},[])}function FBe(n){const e=EW(n);M.useEffect(()=>{const t=i=>{i.key==="Escape"&&e(i)};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[e])}function _Be({prop:n,defaultProp:e,onChange:t=()=>{}}){const[i,r]=function({defaultProp:l,onChange:c}){const g=M.useState(l),[u]=g,d=M.useRef(u),h=EW(c);return M.useEffect(()=>{d.current!==u&&(h(u),d.current=u)},[u,d,h]),g}({defaultProp:e,onChange:t}),s=n!==void 0,o=s?n:i,a=EW(t);return[o,M.useCallback(l=>{if(s){const c=l,g=typeof l=="function"?c(n):l;g!==n&&a(g)}else r(l)},[s,n,r,a])]}function FI(n,e,{checkForDefaultPrevented:t=!0}={}){return function(i){if(n==null||n(i),t===!1||!i.defaultPrevented)return e==null?void 0:e(i)}}const[r7,Wke]=$8("Tooltip",[t7]),cx=t7(),VBe=700,[Fke,TBe]=r7("TooltipProvider",{isOpenDelayed:!0,delayDuration:VBe,onOpen:()=>{},onClose:()=>{}}),[NBe,gx]=r7("Tooltip"),kBe=n=>{const{__scopeTooltip:e,children:t,open:i,defaultOpen:r=!1,onOpenChange:s,delayDuration:o}=n,a=TBe("Tooltip",e),l=cx(e),[c,g]=M.useState(null),u=gBe(),d=M.useRef(0),h=o??a.delayDuration,f=M.useRef(!1),{onOpen:I,onClose:A}=a,[p=!1,y]=_Be({prop:i,defaultProp:r,onChange:G=>{G&&(document.dispatchEvent(new CustomEvent("tooltip.open")),I()),s==null||s(G)}}),v=M.useMemo(()=>p?f.current?"delayed-open":"instant-open":"closed",[p]),b=M.useCallback(()=>{window.clearTimeout(d.current),f.current=!1,y(!0)},[y]),w=M.useCallback(()=>{window.clearTimeout(d.current),d.current=window.setTimeout(()=>{f.current=!0,y(!0)},h)},[h,y]);return M.useEffect(()=>()=>window.clearTimeout(d.current),[]),M.createElement(ZBe,l,M.createElement(NBe,{scope:e,contentId:u,open:p,stateAttribute:v,trigger:c,onTriggerChange:g,onTriggerEnter:M.useCallback(()=>{a.isOpenDelayed?w():b()},[a.isOpenDelayed,w,b]),onOpen:M.useCallback(b,[b]),onClose:M.useCallback(()=>{window.clearTimeout(d.current),y(!1),A()},[y,A])},t))},LBe=M.forwardRef((n,e)=>{const{__scopeTooltip:t,...i}=n,r=gx("TooltipTrigger",t),s=cx(t),o=ax(e,r.onTriggerChange),a=M.useRef(!1),l=M.useCallback(()=>a.current=!1,[]);return M.useEffect(()=>()=>document.removeEventListener("mouseup",l),[l]),M.createElement(MBe,pt({asChild:!0},s),M.createElement(QC.button,pt({"aria-describedby":r.open?r.contentId:void 0,"data-state":r.stateAttribute},i,{ref:o,onMouseEnter:FI(n.onMouseEnter,r.onTriggerEnter),onMouseLeave:FI(n.onMouseLeave,r.onClose),onMouseDown:FI(n.onMouseDown,()=>{r.onClose(),a.current=!0,document.addEventListener("mouseup",l,{once:!0})}),onFocus:FI(n.onFocus,()=>{a.current||r.onOpen()}),onBlur:FI(n.onBlur,r.onClose),onClick:FI(n.onClick,r.onClose)})))}),HBe=M.forwardRef((n,e)=>{const{forceMount:t,...i}=n,r=gx("TooltipContent",n.__scopeTooltip);return M.createElement(i7,{present:t||r.open},M.createElement(zBe,pt({ref:e},i)))}),zBe=M.forwardRef((n,e)=>{const{__scopeTooltip:t,children:i,"aria-label":r,portalled:s=!0,...o}=n,a=gx("TooltipContent",t),l=cx(t),c=s?fBe:M.Fragment,{onClose:g}=a;return FBe(()=>g()),M.useEffect(()=>(document.addEventListener("tooltip.open",g),()=>document.removeEventListener("tooltip.open",g)),[g]),M.createElement(c,null,M.createElement(YBe,{__scopeTooltip:t}),M.createElement(EBe,pt({"data-state":a.stateAttribute},l,o,{ref:e,style:{...o.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)"}}),M.createElement(D8,null,i),M.createElement(hBe,{id:a.contentId,role:"tooltip"},r||i)))}),XBe=M.forwardRef((n,e)=>{const{__scopeTooltip:t,...i}=n,r=cx(t);return M.createElement(WBe,pt({},r,i,{ref:e}))});function YBe(n){const{__scopeTooltip:e}=n,t=gx("CheckTriggerMoved",e),i=q8(t.trigger),r=i==null?void 0:i.left,s=lY(r),o=i==null?void 0:i.top,a=lY(o),l=t.onClose;return M.useEffect(()=>{(s!==void 0&&s!==r||a!==void 0&&a!==o)&&l()},[l,s,a,r,o]),null}const KBe=kBe,DBe=LBe,PBe=HBe,UBe=XBe;function QBe(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}function Kn(n,e){if(n==null)return{};var t=QBe(n,e),i,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(n,i)&&(t[i]=n[i])}return t}let gi;(function(n){n[n.UNSUPPORTED_INPUT=0]="UNSUPPORTED_INPUT",n[n.NO_COMPONENT_FOR_TYPE=1]="NO_COMPONENT_FOR_TYPE",n[n.UNKNOWN_INPUT=2]="UNKNOWN_INPUT",n[n.DUPLICATE_KEYS=3]="DUPLICATE_KEYS",n[n.ALREADY_REGISTERED_TYPE=4]="ALREADY_REGISTERED_TYPE",n[n.CLIPBOARD_ERROR=5]="CLIPBOARD_ERROR",n[n.THEME_ERROR=6]="THEME_ERROR",n[n.PATH_DOESNT_EXIST=7]="PATH_DOESNT_EXIST",n[n.INPUT_TYPE_OVERRIDE=8]="INPUT_TYPE_OVERRIDE",n[n.EMPTY_KEY=9]="EMPTY_KEY"})(gi||(gi={}));const OBe={[gi.UNSUPPORTED_INPUT]:(n,e)=>[`An input with type \`${n}\` input was found at path \`${e}\` but it's not supported yet.`],[gi.NO_COMPONENT_FOR_TYPE]:(n,e)=>[`Type \`${n}\` found at path \`${e}\` can't be displayed in panel because no component supports it yet.`],[gi.UNKNOWN_INPUT]:(n,e)=>[`input at path \`${n}\` is not recognized.`,e],[gi.DUPLICATE_KEYS]:(n,e,t)=>[`Key \`${n}\` of path \`${e}\` already exists at path \`${t}\`. Even nested keys need to be unique. Rename one of the keys.`],[gi.ALREADY_REGISTERED_TYPE]:n=>[`Type ${n} has already been registered. You can't register a component with the same type.`],[gi.CLIPBOARD_ERROR]:n=>["Error copying the value",n],[gi.THEME_ERROR]:(n,e)=>[`Error accessing the theme \`${n}.${e}\` value.`],[gi.PATH_DOESNT_EXIST]:n=>[`Error getting the value at path \`${n}\`. There is probably an error in your \`render\` function.`],[gi.PATH_DOESNT_EXIST]:n=>[`Error accessing the value at path \`${n}\``],[gi.INPUT_TYPE_OVERRIDE]:(n,e,t)=>[`Input at path \`${n}\` already exists with type: \`${e}\`. Its type cannot be overridden with type \`${t}\`.`],[gi.EMPTY_KEY]:()=>["Keys can not be empty, if you want to hide a label use whitespace."]};function s7(n,e,...t){const[i,...r]=OBe[e](...t);console[n]("LEVA: "+i,...r)}const Gg=s7.bind(null,"warn"),JBe=s7.bind(null,"log"),jBe=["value"],qBe=["schema"],$Be=["value"],o7=[],vf={};function cY(n){let{value:e}=n,t=Kn(n,jBe);for(let i of o7){const r=i(e,t);if(r)return r}}function $g(n,e){let{schema:t}=e,i=Kn(e,qBe);if(n in vf){Gg(gi.ALREADY_REGISTERED_TYPE,n);return}o7.push((r,s)=>t(r,s)&&n),vf[n]=i}function NZ(n,e,t,i){const{normalize:r}=vf[n];if(r)return r(e,t,i);if(typeof e!="object"||!("value"in e))return{value:e};const{value:s}=e,o=Kn(e,$Be);return{value:s,settings:o}}function eGe(n,e,t,i,r,s){const{sanitize:o}=vf[n];return o?o(e,t,i,r,s):e}function gY(n,e,t){const{format:i}=vf[n];return i?i(e,t):e}function tGe(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function uY(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function Vt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?uY(Object(t),!0).forEach(function(i){tGe(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):uY(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}const Bd=(n,e,t)=>n>t?t:n<e?e:n,nGe=n=>{if(n===""||typeof n=="number")return n;try{const e=_u(n);if(!isNaN(e))return e}catch{}return parseFloat(n)},iGe=Math.log(10);function dY(n){let e=Math.abs(+String(n).replace(".",""));if(e===0)return .01;for(;e!==0&&e%10===0;)e/=10;const t=Math.floor(Math.log(e)/iGe)+1,i=Math.floor(Math.log10(Math.abs(n))),r=Math.pow(10,i-t);return Math.max(r,.001)}const N2=(n,e,t)=>t===e?0:(Bd(n,e,t)-e)/(t-e),k2=(n,e,t)=>n*(t-e)+e,rGe=()=>"_"+Math.random().toString(36).substr(2,9),hY=/\(([0-9+\-*/^ .]+)\)/,fY=/(\d+(?:\.\d+)?) ?\^ ?(\d+(?:\.\d+)?)/,IY=/(\d+(?:\.\d+)?) ?\* ?(\d+(?:\.\d+)?)/,AY=/(\d+(?:\.\d+)?) ?\/ ?(\d+(?:\.\d+)?)/,CY=/(\d+(?:\.\d+)?) ?\+ ?(\d+(?:\.\d+)?)/,pY=/(\d+(?:\.\d+)?) ?- ?(\d+(?:\.\d+)?)/;function _u(n){if(isNaN(Number(n)))if(hY.test(n)){const e=n.replace(hY,(t,i)=>String(_u(i)));return _u(e)}else if(fY.test(n)){const e=n.replace(fY,(t,i,r)=>String(Math.pow(Number(i),Number(r))));return _u(e)}else if(IY.test(n)){const e=n.replace(IY,(t,i,r)=>String(Number(i)*Number(r)));return _u(e)}else if(AY.test(n)){const e=n.replace(AY,(t,i,r)=>{if(r!=0)return String(Number(i)/Number(r));throw new Error("Division by zero")});return _u(e)}else if(CY.test(n)){const e=n.replace(CY,(t,i,r)=>String(Number(i)+Number(r)));return _u(e)}else if(pY.test(n)){const e=n.replace(pY,(t,i,r)=>String(Number(i)-Number(r)));return _u(e)}else return Number(n);return Number(n)}function sGe(n,e){const t=Vt({},n);return e.forEach(i=>i in n&&delete t[i]),t}function oGe(n,e){return n.reduce((t,i,r)=>Object.assign(t,{[e[r]]:i}),{})}function a7(n){return Object.prototype.toString.call(n)==="[object Object]"}const aGe=n=>a7(n)&&Object.keys(n).length===0;let Bc;(function(n){n.BUTTON="BUTTON",n.BUTTON_GROUP="BUTTON_GROUP",n.MONITOR="MONITOR",n.FOLDER="FOLDER"})(Bc||(Bc={}));let Rl;(function(n){n.SELECT="SELECT",n.IMAGE="IMAGE",n.NUMBER="NUMBER",n.COLOR="COLOR",n.STRING="STRING",n.BOOLEAN="BOOLEAN",n.INTERVAL="INTERVAL",n.VECTOR3D="VECTOR3D",n.VECTOR2D="VECTOR2D"})(Rl||(Rl={}));const lGe=["type","__customInput"],cGe=["render","label","optional","order","disabled","hint","onChange","onEditStart","onEditEnd","transient"],gGe=["type"];function l7(n,e,t={},i){var r,s;if(typeof n!="object"||Array.isArray(n))return{type:i,input:n,options:Vt({key:e,label:e,optional:!1,disabled:!1,order:0},t)};if("__customInput"in n){const{type:w,__customInput:G}=n,x=Kn(n,lGe);return l7(G,e,x,w)}const{render:o,label:a,optional:l,order:c=0,disabled:g,hint:u,onChange:d,onEditStart:h,onEditEnd:f,transient:I}=n,A=Kn(n,cGe),p=Vt({render:o,key:e,label:a??e,hint:u,transient:I??!!d,onEditStart:h,onEditEnd:f,disabled:g,optional:l,order:c},t);let{type:y}=A,v=Kn(A,gGe);if(y=i??y,y in Bc)return{type:y,input:v,options:p};let b;return i&&a7(v)&&"value"in v?b=v.value:b=aGe(v)?void 0:v,{type:y,input:b,options:Vt(Vt({},p),{},{onChange:d,optional:(r=p.optional)!==null&&r!==void 0?r:!1,disabled:(s=p.disabled)!==null&&s!==void 0?s:!1})}}function uGe(n,e,t,i){const r=l7(n,e),{type:s,input:o,options:a}=r;if(s)return s in Bc?r:{type:s,input:NZ(s,o,t,i),options:a};let l=cY(o);return l?{type:l,input:NZ(l,o,t,i),options:a}:(l=cY({value:o}),l?{type:l,input:NZ(l,{value:o},t,i),options:a}:!1)}function mY(n,e,t,i,r){const{value:s,type:o,settings:a}=n;n.value=c7({type:o,value:s,settings:a},e,t,i),n.fromPanel=r}const dGe=function(e,t,i){this.type="LEVA_ERROR",this.message="LEVA: "+e,this.previousValue=t,this.error=i};function c7({type:n,value:e,settings:t},i,r,s){const o=n!=="SELECT"&&typeof i=="function"?i(e):i;let a;try{a=eGe(n,o,t,e,r,s)}catch(l){throw new dGe(`The value \`${i}\` did not result in a correct value.`,e,l)}return V2(a,e)?e:a}const g7=(n,e,t=!1)=>{let i=0;return function(){const r=arguments,s=t&&!i,o=()=>n.apply(this,r);window.clearTimeout(i),i=window.setTimeout(o,e),s&&o()}},u7=n=>n.shiftKey?5:n.altKey?1/5:1,hGe=["value"],fGe=["min","max"],IGe=n=>{if(typeof n=="number")return!0;if(typeof n=="string"){const e=parseFloat(n);return isNaN(e)?!1:n.substring((""+e).length).trim().length<4}return!1},d7=(n,{min:e=-1/0,max:t=1/0,suffix:i})=>{const r=parseFloat(n);if(n===""||isNaN(r))throw Error("Invalid number");const s=Bd(r,e,t);return i?s+i:s},AGe=(n,{pad:e=0,suffix:t})=>{const i=parseFloat(n).toFixed(e);return t?i+t:i},h7=n=>{let{value:e}=n,t=Kn(n,hGe);const{min:i=-1/0,max:r=1/0}=t,s=Kn(t,fGe);let o=parseFloat(e);const a=typeof e=="string"?e.substring((""+o).length):void 0;o=Bd(o,i,r);let l=t.step;l||(Number.isFinite(i)?Number.isFinite(r)?l=+(Math.abs(r-i)/100).toPrecision(1):l=+(Math.abs(o-i)/100).toPrecision(1):Number.isFinite(r)&&(l=+(Math.abs(r-o)/100).toPrecision(1)));const c=l?dY(l)*10:dY(o);l=l||c/10;const g=Math.round(Bd(Math.log10(1/c),0,2));return{value:a?o+a:o,settings:Vt({initialValue:o,step:l,pad:g,min:i,max:r,suffix:a},s)}},f7=(n,{step:e,initialValue:t})=>{const i=Math.round((n-t)/e);return t+i*e};var I7=Object.freeze({__proto__:null,schema:IGe,sanitize:d7,format:AGe,normalize:h7,sanitizeStep:f7});function Ui(){return Ui=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Ui.apply(this,arguments)}const A7=M.createContext({});function ps(){return M.useContext(A7)}const C7=M.createContext(null),p7=M.createContext(null),m7=M.createContext(null);function _v(){return M.useContext(p7)}function CGe(){return M.useContext(m7)}const pGe=()=>({colors:{elevation1:"#292d39",elevation2:"#181c20",elevation3:"#373c4b",accent1:"#0066dc",accent2:"#007bff",accent3:"#3c93ff",highlight1:"#535760",highlight2:"#8c92a4",highlight3:"#fefefe",vivid1:"#ffcc00",folderWidgetColor:"$highlight2",folderTextColor:"$highlight3",toolTipBackground:"$highlight3",toolTipText:"$elevation2"},radii:{xs:"2px",sm:"3px",lg:"10px"},space:{xs:"3px",sm:"6px",md:"10px",rowGap:"7px",colGap:"7px"},fonts:{mono:"ui-monospace, SFMono-Regular, Menlo, 'Roboto Mono', monospace",sans:"system-ui, sans-serif"},fontSizes:{root:"11px",toolTip:"$root"},sizes:{rootWidth:"280px",controlWidth:"160px",numberInputMinWidth:"38px",scrubberWidth:"8px",scrubberHeight:"16px",rowHeight:"24px",folderTitleHeight:"20px",checkboxSize:"16px",joystickWidth:"100px",joystickHeight:"100px",colorPickerWidth:"$controlWidth",colorPickerHeight:"100px",imagePreviewWidth:"$controlWidth",imagePreviewHeight:"100px",monitorHeight:"60px",titleBarHeight:"39px"},shadows:{level1:"0 0 9px 0 #00000088",level2:"0 4px 14px #00000033"},borderWidths:{root:"0px",input:"1px",focus:"1px",hover:"1px",active:"1px",folder:"1px"},fontWeights:{label:"normal",folder:"normal",button:"normal"}});function uG(n,e){const[t,i]=n.split(" "),r={};return t!=="none"&&(r.boxShadow=`${e.inset?"inset ":""}0 0 0 $borderWidths${[e.key]} $colors${t!=="default"&&t||e.borderColor}`),i&&(r.backgroundColor=i),r}const Em={$inputStyle:()=>n=>uG(n,{key:"$input",borderColor:"$highlight1",inset:!0}),$focusStyle:()=>n=>uG(n,{key:"$focus",borderColor:"$accent2"}),$hoverStyle:()=>n=>uG(n,{key:"$hover",borderColor:"$accent1",inset:!0}),$activeStyle:()=>n=>uG(n,{key:"$active",borderColor:"$accent1",inset:!0})},{styled:wt,css:_ke,createTheme:Vke,globalCss:mGe,keyframes:Tke}=aBe({prefix:"leva",theme:pGe(),utils:Vt(Vt({},Em),{},{$flex:()=>({display:"flex",alignItems:"center"}),$flexCenter:()=>({display:"flex",alignItems:"center",justifyContent:"center"}),$reset:()=>({outline:"none",fontSize:"inherit",fontWeight:"inherit",color:"inherit",fontFamily:"inherit",border:"none",backgroundColor:"transparent",appearance:"none"}),$draggable:()=>({touchAction:"none",WebkitUserDrag:"none",userSelect:"none"}),$focus:n=>({"&:focus":Em.$focusStyle()(n)}),$focusWithin:n=>({"&:focus-within":Em.$focusStyle()(n)}),$hover:n=>({"&:hover":Em.$hoverStyle()(n)}),$active:n=>({"&:active":Em.$activeStyle()(n)})})}),yGe=mGe({".leva__panel__dragged":{WebkitUserDrag:"none",userSelect:"none",input:{userSelect:"none"},"*":{cursor:"ew-resize !important"}}});function Vg(n,e){const{theme:t}=M.useContext(C7);if(!(n in t)||!(e in t[n]))return Gg(gi.THEME_ERROR,n,e),"";let i=e;for(;;){let r=t[n][i];if(typeof r=="string"&&r.charAt(0)==="$")i=r.substr(1);else return r}}const y7=wt("input",{$reset:"",padding:"0 $sm",width:0,minWidth:0,flex:1,height:"100%",variants:{levaType:{number:{textAlign:"right"}},as:{textarea:{padding:"$sm"}}}}),v7=wt("div",{$draggable:"",height:"100%",$flexCenter:"",position:"relative",padding:"0 $xs",fontSize:"0.8em",opacity:.8,cursor:"default",touchAction:"none",[`& + ${y7}`]:{paddingLeft:0}}),vGe=wt(v7,{cursor:"ew-resize",marginRight:"-$xs",textTransform:"uppercase",opacity:.3,"&:hover":{opacity:1},variants:{dragging:{true:{backgroundColor:"$accent2",opacity:1}}}}),bGe=wt("div",{$flex:"",position:"relative",borderRadius:"$sm",overflow:"hidden",color:"inherit",height:"$rowHeight",backgroundColor:"$elevation3",$inputStyle:"$elevation1",$hover:"",$focusWithin:"",variants:{textArea:{true:{height:"auto"}}}}),BGe=["innerLabel","value","onUpdate","onChange","onKeyDown","type","id","inputType","rows"],GGe=["onUpdate"];function mT(n){let{innerLabel:e,value:t,onUpdate:i,onChange:r,onKeyDown:s,type:o,id:a,inputType:l="text",rows:c=0}=n,g=Kn(n,BGe);const{id:u,emitOnEditStart:d,emitOnEditEnd:h,disabled:f}=ps(),I=a||u,A=M.useRef(null),p=c>0,y=p?"textarea":"input",v=M.useCallback(G=>x=>{const B=x.currentTarget.value;G(B)},[]);L.useEffect(()=>{const G=A.current,x=v(B=>{i(B),h()});return G==null||G.addEventListener("blur",x),()=>G==null?void 0:G.removeEventListener("blur",x)},[v,i,h]);const b=M.useCallback(G=>{G.key==="Enter"&&v(i)(G)},[v,i]),w=Object.assign({as:y},p?{rows:c}:{},g);return L.createElement(bGe,{textArea:p},e&&typeof e=="string"?L.createElement(v7,null,e):e,L.createElement(y7,Ui({levaType:o,ref:A,id:I,type:l,autoComplete:"off",spellCheck:"false",value:t,onChange:v(r),onFocus:()=>d(),onKeyPress:b,onKeyDown:s,disabled:f},w)))}function wGe(n){let{onUpdate:e}=n,t=Kn(n,GGe);const i=M.useCallback(s=>e(nGe(s)),[e]),r=M.useCallback(s=>{const o=s.key==="ArrowUp"?1:s.key==="ArrowDown"?-1:0;if(o){s.preventDefault();const a=s.altKey?.1:s.shiftKey?10:1;e(l=>parseFloat(l)+o*a)}},[e]);return L.createElement(mT,Ui({},t,{onUpdate:i,onKeyDown:r,type:"number"}))}const L2=wt("div",{}),WW=wt("div",{position:"relative",background:"$elevation2",transition:"height 300ms ease",variants:{fill:{true:{},false:{}},flat:{false:{},true:{}},isRoot:{true:{},false:{paddingLeft:"$md","&::after":{content:'""',position:"absolute",left:0,top:0,width:"$borderWidths$folder",height:"100%",backgroundColor:"$folderWidgetColor",opacity:.4,transform:"translateX(-50%)"}}}},compoundVariants:[{isRoot:!0,fill:!1,css:{overflowY:"auto",maxHeight:"calc(100vh - 20px - $$titleBarHeight)"}},{isRoot:!0,flat:!1,css:{borderRadius:"$lg"}}]}),xGe=wt("div",{$flex:"",color:"$folderTextColor",userSelect:"none",cursor:"pointer",height:"$folderTitleHeight",fontWeight:"$folder","> svg":{marginLeft:-4,marginRight:4,cursor:"pointer",fill:"$folderWidgetColor",opacity:.6},"&:hover > svg":{fill:"$folderWidgetColor"},[`&:hover + ${WW}::after`]:{opacity:.6},[`${L2}:hover > & + ${WW}::after`]:{opacity:.6},[`${L2}:hover > & > svg`]:{opacity:1}}),b7=wt("div",{position:"relative",display:"grid",gridTemplateColumns:"100%",rowGap:"$rowGap",transition:"opacity 250ms ease",variants:{toggled:{true:{opacity:1,transitionDelay:"250ms"},false:{opacity:0,transitionDelay:"0ms",pointerEvents:"none"}},isRoot:{true:{"& > div":{paddingLeft:"$md",paddingRight:"$md"},"& > div:first-of-type":{paddingTop:"$sm"},"& > div:last-of-type":{paddingBottom:"$sm"},[`> ${L2}:not(:first-of-type)`]:{paddingTop:"$sm",marginTop:"$md",borderTop:"$borderWidths$folder solid $colors$elevation1"}}}}}),B7=wt("div",{position:"relative",zIndex:100,display:"grid",rowGap:"$rowGap",gridTemplateRows:"minmax($sizes$rowHeight, max-content)",alignItems:"center",color:"$highlight2",[`${b7} > &`]:{"&:first-of-type":{marginTop:"$rowGap"},"&:last-of-type":{marginBottom:"$rowGap"}},variants:{disabled:{true:{pointerEvents:"none"},false:{"&:hover,&:focus-within":{color:"$highlight3"}}}}}),G7=wt(B7,{gridTemplateColumns:"auto $sizes$controlWidth",columnGap:"$colGap"}),SGe=wt("div",{$flex:"",height:"100%",position:"relative",overflow:"hidden","& > div":{marginLeft:"$colGap",padding:"0 $xs",opacity:.4},"& > div:hover":{opacity:.8},"& > div > svg":{display:"none",cursor:"pointer",width:13,minWidth:13,height:13,backgroundColor:"$elevation2"},"&:hover > div > svg":{display:"block"},variants:{align:{top:{height:"100%",alignItems:"flex-start",paddingTop:"$sm"}}}}),RGe=wt("input",{$reset:"",height:0,width:0,opacity:0,margin:0,"& + label":{position:"relative",$flexCenter:"",height:"100%",userSelect:"none",cursor:"pointer",paddingLeft:2,paddingRight:"$sm",pointerEvents:"auto"},"& + label:after":{content:'""',width:6,height:6,backgroundColor:"$elevation3",borderRadius:"50%",$activeStyle:""},"&:focus + label:after":{$focusStyle:""},"& + label:active:after":{backgroundColor:"$accent1",$focusStyle:""},"&:checked + label:after":{backgroundColor:"$accent1"}}),FW=wt("label",{fontWeight:"$label",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap","& > svg":{display:"block"}}),ZGe=wt("div",{opacity:1,variants:{disabled:{true:{opacity:.6,pointerEvents:"none",[`& ${FW}`]:{pointerEvents:"auto"}}}}}),w7=wt("div",{position:"fixed",top:0,bottom:0,right:0,left:0,zIndex:1e3,userSelect:"none"}),MGe=wt("div",{background:"$toolTipBackground",fontFamily:"$sans",fontSize:"$toolTip",padding:"$xs $sm",color:"$toolTipText",borderRadius:"$xs",boxShadow:"$level2",maxWidth:260}),EGe=wt(UBe,{fill:"$toolTipBackground"});function yT({children:n}){const{className:e}=M.useContext(C7);return L.createElement(Zbe,{className:e},n)}const WGe=["align"];function FGe(){const{id:n,disable:e,disabled:t}=ps();return L.createElement(L.Fragment,null,L.createElement(RGe,{id:n+"__disable",type:"checkbox",checked:!t,onChange:()=>e(!t)}),L.createElement("label",{htmlFor:n+"__disable"}))}function _Ge(n){const{id:e,optional:t,hint:i}=ps(),r=n.htmlFor||(e?{htmlFor:e}:null),s=!i&&typeof n.children=="string"?{title:n.children}:null;return L.createElement(L.Fragment,null,t&&L.createElement(FGe,null),i!==void 0?L.createElement(KBe,null,L.createElement(DBe,{asChild:!0},L.createElement(FW,Ui({},r,n))),L.createElement(PBe,{side:"top",sideOffset:2},L.createElement(MGe,null,i,L.createElement(EGe,null)))):L.createElement(FW,Ui({},r,s,n)))}function Fl(n){let{align:e}=n,t=Kn(n,WGe);const{value:i,label:r,key:s,disabled:o}=ps(),{hideCopyButton:a}=CGe(),l=!a&&s!==void 0,[c,g]=M.useState(!1),u=async()=>{try{await navigator.clipboard.writeText(JSON.stringify({[s]:i??""})),g(!0)}catch{Gg(gi.CLIPBOARD_ERROR,{[s]:i})}};return L.createElement(SGe,{align:e,onPointerLeave:()=>g(!1)},L.createElement(_Ge,t),l&&!o&&L.createElement("div",{title:`Click to copy ${typeof r=="string"?r:s} value`},c?L.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},L.createElement("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),L.createElement("path",{fillRule:"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})):L.createElement("svg",{onClick:u,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},L.createElement("path",{d:"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"}),L.createElement("path",{d:"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"}))))}const VGe=["toggled"],TGe=wt("svg",{fill:"currentColor",transition:"transform 350ms ease, fill 250ms ease"});function vT(n){let{toggled:e}=n,t=Kn(n,VGe);return L.createElement(TGe,Ui({width:"9",height:"5",viewBox:"0 0 9 5",xmlns:"http://www.w3.org/2000/svg",style:{transform:`rotate(${e?0:-90}deg)`}},t),L.createElement("path",{d:"M3.8 4.4c.4.3 1 .3 1.4 0L8 1.7A1 1 0 007.4 0H1.6a1 1 0 00-.7 1.7l3 2.7z"}))}const NGe=["input"];function Pa(n){let{input:e}=n,t=Kn(n,NGe);return e?L.createElement(G7,t):L.createElement(B7,t)}function x7({value:n,type:e,settings:t,setValue:i}){const[r,s]=M.useState(gY(e,n,t)),o=M.useRef(n),a=M.useRef(t);a.current=t;const l=M.useCallback(g=>s(gY(e,g,a.current)),[e]),c=M.useCallback(g=>{try{i(g)}catch(u){const{type:d,previousValue:h}=u;if(d!=="LEVA_ERROR")throw u;l(h)}},[l,i]);return M.useEffect(()=>{V2(n,o.current)||l(n),o.current=n},[n,l]),{displayValue:r,onChange:s,onUpdate:c}}function Vv(n,e){const{emitOnEditStart:t,emitOnEditEnd:i}=ps();return lIe(r=>{r.first&&(document.body.classList.add("leva__panel__dragged"),t==null||t());const s=n(r);return r.last&&(document.body.classList.remove("leva__panel__dragged"),i==null||i()),s},e)}function kGe(n){const e=M.useRef(null),t=M.useRef(null),i=M.useRef(!1);return M.useEffect(()=>{const r=g7(()=>{e.current.width=e.current.offsetWidth*window.devicePixelRatio,e.current.height=e.current.offsetHeight*window.devicePixelRatio,n(e.current,t.current)},250);return window.addEventListener("resize",r),i.current||(r(),i.current=!0),()=>window.removeEventListener("resize",r)},[n]),M.useEffect(()=>{t.current=e.current.getContext("2d")},[]),[e,t]}function S7(){const n=M.useRef(null),e=M.useRef({x:0,y:0}),t=M.useCallback(i=>{Object.assign(e.current,i),n.current&&(n.current.style.transform=`translate3d(${e.current.x}px, ${e.current.y}px, 0)`)},[]);return[n,t]}const LGe=["__refCount"],kZ=(n,e)=>{if(!n[e])return null;const t=n[e];return Kn(t,LGe)};function HGe(n){const e=_v(),[t,i]=M.useState(kZ(e.getData(),n)),r=M.useCallback(c=>e.setValueAtPath(n,c,!0),[n,e]),s=M.useCallback(c=>e.setSettingsAtPath(n,c),[n,e]),o=M.useCallback(c=>e.disableInputAtPath(n,c),[n,e]),a=M.useCallback(()=>e.emitOnEditStart(n),[n,e]),l=M.useCallback(()=>e.emitOnEditEnd(n),[n,e]);return M.useEffect(()=>{i(kZ(e.getData(),n));const c=e.useStore.subscribe(g=>kZ(g.data,n),i,{equalityFn:nj});return()=>c()},[e,n]),[t,{set:r,setSettings:s,disable:o,storeId:e.storeId,emitOnEditStart:a,emitOnEditEnd:l}]}const zGe=wt("div",{variants:{hasRange:{true:{position:"relative",display:"grid",gridTemplateColumns:"auto $sizes$numberInputMinWidth",columnGap:"$colGap",alignItems:"center"}}}}),R7=wt("div",{position:"relative",width:"100%",height:2,borderRadius:"$xs",backgroundColor:"$elevation1"}),_W=wt("div",{position:"absolute",width:"$scrubberWidth",height:"$scrubberHeight",borderRadius:"$xs",boxShadow:"0 0 0 2px $colors$elevation2",backgroundColor:"$accent2",cursor:"pointer",$active:"none $accent1",$hover:"none $accent3",variants:{position:{left:{borderTopRightRadius:0,borderBottomRightRadius:0,transform:"translateX(calc(-0.5 * ($sizes$scrubberWidth + 4px)))"},right:{borderTopLeftRadius:0,borderBottomLeftRadius:0,transform:"translateX(calc(0.5 * ($sizes$scrubberWidth + 4px)))"}}}}),Z7=wt("div",{position:"relative",$flex:"",height:"100%",cursor:"pointer",touchAction:"none"}),M7=wt("div",{position:"absolute",height:"100%",backgroundColor:"$accent2"});function XGe({value:n,min:e,max:t,onDrag:i,step:r,initialValue:s}){const o=M.useRef(null),a=M.useRef(null),l=M.useRef(0),c=Vg("sizes","scrubberWidth"),g=Vv(({event:d,first:h,xy:[f],movement:[I],memo:A})=>{if(h){const{width:y,left:v}=o.current.getBoundingClientRect();l.current=y-parseFloat(c),A=(d==null?void 0:d.target)===a.current?n:k2((f-v)/y,e,t)}const p=A+k2(I/l.current,0,t-e);return i(f7(p,{step:r,initialValue:s})),A}),u=N2(n,e,t);return L.createElement(Z7,Ui({ref:o},g()),L.createElement(R7,null,L.createElement(M7,{style:{left:0,right:`${(1-u)*100}%`}})),L.createElement(_W,{ref:a,style:{left:`calc(${u} * (100% - ${c}))`}}))}const YGe=L.memo(({label:n,onUpdate:e,step:t,innerLabelTrim:i})=>{const[r,s]=M.useState(!1),o=Vv(({active:a,delta:[l],event:c,memo:g=0})=>(s(a),g+=l/2,Math.abs(g)>=1&&(e(u=>parseFloat(u)+Math.floor(g)*t*u7(c)),g=0),g));return L.createElement(vGe,Ui({dragging:r,title:n.length>1?n:""},o()),n.slice(0,i))});function E7({label:n,id:e,displayValue:t,onUpdate:i,onChange:r,settings:s,innerLabelTrim:o=1}){const a=o>0&&L.createElement(YGe,{label:n,step:s.step,onUpdate:i,innerLabelTrim:o});return L.createElement(wGe,{id:e,value:String(t),onUpdate:i,onChange:r,innerLabel:a})}function KGe(){const n=ps(),{label:e,value:t,onUpdate:i,settings:r,id:s}=n,{min:o,max:a}=r,l=a!==1/0&&o!==-1/0;return L.createElement(Pa,{input:!0},L.createElement(Fl,null,e),L.createElement(zGe,{hasRange:l},l&&L.createElement(XGe,Ui({value:parseFloat(t),onDrag:i},r)),L.createElement(E7,Ui({},n,{id:s,label:"value",innerLabelTrim:l?0:1}))))}const{sanitizeStep:DGe}=I7,PGe=Kn(I7,["sanitizeStep"]);var UGe=Vt({component:KGe},PGe);const QGe=(n,e)=>Io().schema({options:Io().passesAnyOf(Io().object(),Io().array())}).test(e),OGe=(n,{values:e})=>{if(e.indexOf(n)<0)throw Error("Selected value doesn't match Select options");return n},JGe=(n,{values:e})=>e.indexOf(n),jGe=n=>{let{value:e,options:t}=n,i,r;return Array.isArray(t)?(r=t,i=t.map(s=>String(s))):(r=Object.values(t),i=Object.keys(t)),"value"in n?r.includes(e)||(i.unshift(String(e)),r.unshift(e)):e=r[0],Object.values(t).includes(e)||(t[String(e)]=e),{value:e,settings:{keys:i,values:r}}};var qGe=Object.freeze({__proto__:null,schema:QGe,sanitize:OGe,format:JGe,normalize:jGe});const $Ge=wt("div",{$flexCenter:"",position:"relative","> svg":{pointerEvents:"none",position:"absolute",right:"$md"}}),VW=wt("select",{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0}),e1e=wt("div",{display:"flex",alignItems:"center",width:"100%",height:"$rowHeight",backgroundColor:"$elevation3",borderRadius:"$sm",padding:"0 $sm",cursor:"pointer",[`${VW}:focus + &`]:{$focusStyle:""},[`${VW}:hover + &`]:{$hoverStyle:""}});function t1e({displayValue:n,value:e,onUpdate:t,id:i,settings:r,disabled:s}){const{keys:o,values:a}=r,l=M.useRef();return e===a[n]&&(l.current=o[n]),L.createElement($Ge,null,L.createElement(VW,{id:i,value:n,onChange:c=>t(a[Number(c.currentTarget.value)]),disabled:s},o.map((c,g)=>L.createElement("option",{key:c,value:g},c))),L.createElement(e1e,null,l.current),L.createElement(vT,{toggled:!0}))}function n1e(){const{label:n,value:e,displayValue:t,onUpdate:i,id:r,disabled:s,settings:o}=ps();return L.createElement(Pa,{input:!0},L.createElement(Fl,null,n),L.createElement(t1e,{id:r,value:e,displayValue:t,onUpdate:i,settings:o,disabled:s}))}var i1e=Vt({component:n1e},qGe);const r1e=n=>Io().string().test(n),s1e=n=>{if(typeof n!="string")throw Error("Invalid string");return n},o1e=({value:n,editable:e=!0,rows:t=!1})=>({value:n,settings:{editable:e,rows:typeof t=="number"?t:t?5:0}});var a1e=Object.freeze({__proto__:null,schema:r1e,sanitize:s1e,normalize:o1e});const l1e=["displayValue","onUpdate","onChange","editable"],c1e=wt("div",{whiteSpace:"pre-wrap"});function g1e(n){let{displayValue:e,onUpdate:t,onChange:i,editable:r=!0}=n,s=Kn(n,l1e);return r?L.createElement(mT,Ui({value:e,onUpdate:t,onChange:i},s)):L.createElement(c1e,null,e)}function u1e(){const{label:n,settings:e,displayValue:t,onUpdate:i,onChange:r}=ps();return L.createElement(Pa,{input:!0},L.createElement(Fl,null,n),L.createElement(g1e,Ui({displayValue:t,onUpdate:i,onChange:r},e)))}var d1e=Vt({component:u1e},a1e);const h1e=n=>Io().boolean().test(n),f1e=n=>{if(typeof n!="boolean")throw Error("Invalid boolean");return n};var I1e=Object.freeze({__proto__:null,schema:h1e,sanitize:f1e});const A1e=wt("div",{position:"relative",$flex:"",height:"$rowHeight",input:{$reset:"",height:0,width:0,opacity:0,margin:0},label:{position:"relative",$flexCenter:"",userSelect:"none",cursor:"pointer",height:"$checkboxSize",width:"$checkboxSize",backgroundColor:"$elevation3",borderRadius:"$sm",$hover:""},"input:focus + label":{$focusStyle:""},"input:focus:checked + label, input:checked + label:hover":{$hoverStyle:"$accent3"},"input + label:active":{backgroundColor:"$accent1"},"input:checked + label:active":{backgroundColor:"$accent1"},"label > svg":{display:"none",width:"90%",height:"90%",stroke:"$highlight3"},"input:checked + label":{backgroundColor:"$accent2"},"input:checked + label > svg":{display:"block"}});function C1e({value:n,onUpdate:e,id:t,disabled:i}){return L.createElement(A1e,null,L.createElement("input",{id:t,type:"checkbox",checked:n,onChange:r=>e(r.currentTarget.checked),disabled:i}),L.createElement("label",{htmlFor:t},L.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},L.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"}))))}function p1e(){const{label:n,value:e,onUpdate:t,disabled:i,id:r}=ps();return L.createElement(Pa,{input:!0},L.createElement(Fl,null,n),L.createElement(C1e,{value:e,onUpdate:t,id:r,disabled:i}))}var m1e=Vt({component:p1e},I1e);const y1e=["locked"];function v1e({value:n,id:e,valueKey:t,settings:i,onUpdate:r,innerLabelTrim:s}){const o=M.useRef(n[t]);o.current=n[t];const a=M.useCallback(c=>r({[t]:c7({type:"NUMBER",value:o.current,settings:i},c)}),[r,i,t]),l=x7({type:"NUMBER",value:n[t],settings:i,setValue:a});return L.createElement(E7,{id:e,label:t,value:n[t],displayValue:l.displayValue,onUpdate:l.onUpdate,onChange:l.onChange,settings:i,innerLabelTrim:s})}const b1e=wt("div",{display:"grid",columnGap:"$colGap",gridAutoFlow:"column dense",alignItems:"center",variants:{withLock:{true:{gridTemplateColumns:"10px auto","> svg":{cursor:"pointer"}}}}});function B1e(n){let{locked:e}=n,t=Kn(n,y1e);return L.createElement("svg",Ui({width:"10",height:"10",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),e?L.createElement("path",{d:"M5 4.63601C5 3.76031 5.24219 3.1054 5.64323 2.67357C6.03934 2.24705 6.64582 1.9783 7.5014 1.9783C8.35745 1.9783 8.96306 2.24652 9.35823 2.67208C9.75838 3.10299 10 3.75708 10 4.63325V5.99999H5V4.63601ZM4 5.99999V4.63601C4 3.58148 4.29339 2.65754 4.91049 1.99307C5.53252 1.32329 6.42675 0.978302 7.5014 0.978302C8.57583 0.978302 9.46952 1.32233 10.091 1.99162C10.7076 2.65557 11 3.57896 11 4.63325V5.99999H12C12.5523 5.99999 13 6.44771 13 6.99999V13C13 13.5523 12.5523 14 12 14H3C2.44772 14 2 13.5523 2 13V6.99999C2 6.44771 2.44772 5.99999 3 5.99999H4ZM3 6.99999H12V13H3V6.99999Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}):L.createElement("path",{d:"M9 3.63601C9 2.76044 9.24207 2.11211 9.64154 1.68623C10.0366 1.26502 10.6432 1 11.5014 1C12.4485 1 13.0839 1.30552 13.4722 1.80636C13.8031 2.23312 14 2.84313 14 3.63325H15C15 2.68242 14.7626 1.83856 14.2625 1.19361C13.6389 0.38943 12.6743 0 11.5014 0C10.4294 0 9.53523 0.337871 8.91218 1.0021C8.29351 1.66167 8 2.58135 8 3.63601V6H1C0.447715 6 0 6.44772 0 7V13C0 13.5523 0.447715 14 1 14H10C10.5523 14 11 13.5523 11 13V7C11 6.44772 10.5523 6 10 6H9V3.63601ZM1 7H10V13H1V7Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}))}function bT({value:n,onUpdate:e,settings:t,innerLabelTrim:i}){const{id:r,setSettings:s}=ps(),{lock:o,locked:a}=t;return L.createElement(b1e,{withLock:o},o&&L.createElement(B1e,{locked:a,onClick:()=>s({locked:!a})}),Object.keys(n).map((l,c)=>L.createElement(v1e,{id:c===0?r:`${r}.${l}`,key:l,valueKey:l,value:n,settings:t[l],onUpdate:e,innerLabelTrim:i})))}const W7=(n,e)=>{const t={};let i=0,r=1/0;Object.entries(n).forEach(([s,o])=>{t[s]=h7(Vt({value:o},e[s])).settings,i=Math.max(i,t[s].step),r=Math.min(r,t[s].pad)});for(let s in t){const{step:o,min:a,max:l}=e[s]||{};!isFinite(o)&&(!isFinite(a)||!isFinite(l))&&(t[s].step=i,t[s].pad=r)}return t},G1e=["lock"],w1e=["value"];function x1e(n){const e=Io().array().length(n).every.number(),t=i=>{if(!i||typeof i!="object")return!1;const r=Object.values(i);return r.length===n&&r.every(s=>isFinite(s))};return i=>e.test(i)||t(i)}function S1e(n){return Array.isArray(n)?"array":"object"}function X0(n,e,t){return S1e(n)===e?n:e==="array"?Object.values(n):oGe(n,t)}const R1e=(n,e,t)=>{const i=X0(n,"object",e.keys);for(let o in i)i[o]=d7(i[o],e[o]);const r=Object.keys(i);let s={};if(r.length===e.keys.length)s=i;else{const o=X0(t,"object",e.keys);if(r.length===1&&e.locked){const a=r[0],l=i[a],c=o[a],g=c!==0?l/c:1;for(let u in o)u===a?s[a]=l:s[u]=o[u]*g}else s=Vt(Vt({},o),i)}return X0(s,e.format,e.keys)},Z1e=(n,e)=>X0(n,"object",e.keys),M1e=n=>!!n&&("step"in n||"min"in n||"max"in n);function E1e(n,e,t=[]){const{lock:i=!1}=e,r=Kn(e,G1e),s=Array.isArray(n)?"array":"object",o=s==="object"?Object.keys(n):t,a=X0(n,"object",o),l=M1e(r)?o.reduce((g,u)=>Object.assign(g,{[u]:r}),{}):r,c=W7(a,l);return{value:s==="array"?n:a,settings:Vt(Vt({},c),{},{format:s,keys:o,lock:i,locked:!1})}}function F7(n){return{schema:x1e(n.length),normalize:e=>{let{value:t}=e,i=Kn(e,w1e);return E1e(t,i,n)},format:(e,t)=>Z1e(e,t),sanitize:(e,t,i)=>R1e(e,t,i)}}var W1e={grad:.9,turn:360,rad:360/(2*Math.PI)},ig=function(n){return typeof n=="string"?n.length>0:typeof n=="number"},hr=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*n)/t+0},Ta=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),n>t?t:n>e?n:e},_7=function(n){return(n=isFinite(n)?n%360:0)>0?n:n+360},yY=function(n){return{r:Ta(n.r,0,255),g:Ta(n.g,0,255),b:Ta(n.b,0,255),a:Ta(n.a)}},LZ=function(n){return{r:hr(n.r),g:hr(n.g),b:hr(n.b),a:hr(n.a,3)}},F1e=/^#([0-9a-f]{3,8})$/i,dG=function(n){var e=n.toString(16);return e.length<2?"0"+e:e},V7=function(n){var e=n.r,t=n.g,i=n.b,r=n.a,s=Math.max(e,t,i),o=s-Math.min(e,t,i),a=o?s===e?(t-i)/o:s===t?2+(i-e)/o:4+(e-t)/o:0;return{h:60*(a<0?a+6:a),s:s?o/s*100:0,v:s/255*100,a:r}},T7=function(n){var e=n.h,t=n.s,i=n.v,r=n.a;e=e/360*6,t/=100,i/=100;var s=Math.floor(e),o=i*(1-t),a=i*(1-(e-s)*t),l=i*(1-(1-e+s)*t),c=s%6;return{r:255*[i,a,o,o,l,i][c],g:255*[l,i,i,a,o,o][c],b:255*[o,o,l,i,i,a][c],a:r}},vY=function(n){return{h:_7(n.h),s:Ta(n.s,0,100),l:Ta(n.l,0,100),a:Ta(n.a)}},bY=function(n){return{h:hr(n.h),s:hr(n.s),l:hr(n.l),a:hr(n.a,3)}},BY=function(n){return T7((t=(e=n).s,{h:e.h,s:(t*=((i=e.l)<50?i:100-i)/100)>0?2*t/(i+t)*100:0,v:i+t,a:e.a}));var e,t,i},Y0=function(n){return{h:(e=V7(n)).h,s:(r=(200-(t=e.s))*(i=e.v)/100)>0&&r<200?t*i/100/(r<=100?r:200-r)*100:0,l:r/2,a:e.a};var e,t,i,r},_1e=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,V1e=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,T1e=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,N1e=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,TW={string:[[function(n){var e=F1e.exec(n);return e?(n=e[1]).length<=4?{r:parseInt(n[0]+n[0],16),g:parseInt(n[1]+n[1],16),b:parseInt(n[2]+n[2],16),a:n.length===4?hr(parseInt(n[3]+n[3],16)/255,2):1}:n.length===6||n.length===8?{r:parseInt(n.substr(0,2),16),g:parseInt(n.substr(2,2),16),b:parseInt(n.substr(4,2),16),a:n.length===8?hr(parseInt(n.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(n){var e=T1e.exec(n)||N1e.exec(n);return e?e[2]!==e[4]||e[4]!==e[6]?null:yY({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(n){var e=_1e.exec(n)||V1e.exec(n);if(!e)return null;var t,i,r=vY({h:(t=e[1],i=e[2],i===void 0&&(i="deg"),Number(t)*(W1e[i]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return BY(r)},"hsl"]],object:[[function(n){var e=n.r,t=n.g,i=n.b,r=n.a,s=r===void 0?1:r;return ig(e)&&ig(t)&&ig(i)?yY({r:Number(e),g:Number(t),b:Number(i),a:Number(s)}):null},"rgb"],[function(n){var e=n.h,t=n.s,i=n.l,r=n.a,s=r===void 0?1:r;if(!ig(e)||!ig(t)||!ig(i))return null;var o=vY({h:Number(e),s:Number(t),l:Number(i),a:Number(s)});return BY(o)},"hsl"],[function(n){var e=n.h,t=n.s,i=n.v,r=n.a,s=r===void 0?1:r;if(!ig(e)||!ig(t)||!ig(i))return null;var o=function(a){return{h:_7(a.h),s:Ta(a.s,0,100),v:Ta(a.v,0,100),a:Ta(a.a)}}({h:Number(e),s:Number(t),v:Number(i),a:Number(s)});return T7(o)},"hsv"]]},GY=function(n,e){for(var t=0;t<e.length;t++){var i=e[t][0](n);if(i)return[i,e[t][1]]}return[null,void 0]},N7=function(n){return typeof n=="string"?GY(n.trim(),TW.string):typeof n=="object"&&n!==null?GY(n,TW.object):[null,void 0]},k1e=function(n){return N7(n)[1]},HZ=function(n,e){var t=Y0(n);return{h:t.h,s:Ta(t.s+100*e,0,100),l:t.l,a:t.a}},zZ=function(n){return(299*n.r+587*n.g+114*n.b)/1e3/255},wY=function(n,e){var t=Y0(n);return{h:t.h,s:t.s,l:Ta(t.l+100*e,0,100),a:t.a}},NW=function(){function n(e){this.parsed=N7(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return n.prototype.isValid=function(){return this.parsed!==null},n.prototype.brightness=function(){return hr(zZ(this.rgba),2)},n.prototype.isDark=function(){return zZ(this.rgba)<.5},n.prototype.isLight=function(){return zZ(this.rgba)>=.5},n.prototype.toHex=function(){return e=LZ(this.rgba),t=e.r,i=e.g,r=e.b,o=(s=e.a)<1?dG(hr(255*s)):"","#"+dG(t)+dG(i)+dG(r)+o;var e,t,i,r,s,o},n.prototype.toRgb=function(){return LZ(this.rgba)},n.prototype.toRgbString=function(){return e=LZ(this.rgba),t=e.r,i=e.g,r=e.b,(s=e.a)<1?"rgba("+t+", "+i+", "+r+", "+s+")":"rgb("+t+", "+i+", "+r+")";var e,t,i,r,s},n.prototype.toHsl=function(){return bY(Y0(this.rgba))},n.prototype.toHslString=function(){return e=bY(Y0(this.rgba)),t=e.h,i=e.s,r=e.l,(s=e.a)<1?"hsla("+t+", "+i+"%, "+r+"%, "+s+")":"hsl("+t+", "+i+"%, "+r+"%)";var e,t,i,r,s},n.prototype.toHsv=function(){return e=V7(this.rgba),{h:hr(e.h),s:hr(e.s),v:hr(e.v),a:hr(e.a,3)};var e},n.prototype.invert=function(){return Ws({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},n.prototype.saturate=function(e){return e===void 0&&(e=.1),Ws(HZ(this.rgba,e))},n.prototype.desaturate=function(e){return e===void 0&&(e=.1),Ws(HZ(this.rgba,-e))},n.prototype.grayscale=function(){return Ws(HZ(this.rgba,-1))},n.prototype.lighten=function(e){return e===void 0&&(e=.1),Ws(wY(this.rgba,e))},n.prototype.darken=function(e){return e===void 0&&(e=.1),Ws(wY(this.rgba,-e))},n.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},n.prototype.alpha=function(e){return typeof e=="number"?Ws({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):hr(this.rgba.a,3);var t},n.prototype.hue=function(e){var t=Y0(this.rgba);return typeof e=="number"?Ws({h:e,s:t.s,l:t.l,a:t.a}):hr(t.h)},n.prototype.isEqual=function(e){return this.toHex()===Ws(e).toHex()},n}(),Ws=function(n){return n instanceof NW?n:new NW(n)},xY=[],L1e=function(n){n.forEach(function(e){xY.indexOf(e)<0&&(e(NW,TW),xY.push(e))})};function H1e(n,e){var t={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var r in t)i[t[r]]=r;var s={};n.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,c=i[this.toHex()];if(c)return c;if(o!=null&&o.closest){var g=this.toRgb(),u=1/0,d="black";if(!s.length)for(var h in t)s[h]=new n(t[h]).toRgb();for(var f in t){var I=(a=g,l=s[f],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));I<u&&(u=I,d=f)}return d}},e.string.push([function(o){var a=o.toLowerCase(),l=a==="transparent"?"#0000":t[a];return l?new n(l).toRgb():null},"name"])}function OC(){return(OC=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n}).apply(this,arguments)}function BT(n,e){if(n==null)return{};var t,i,r={},s=Object.keys(n);for(i=0;i<s.length;i++)e.indexOf(t=s[i])>=0||(r[t]=n[t]);return r}function kW(n){var e=M.useRef(n),t=M.useRef(function(i){e.current&&e.current(i)});return e.current=n,t.current}var yC=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),n>t?t:n<e?e:n},K0=function(n){return"touches"in n},LW=function(n){return n&&n.ownerDocument.defaultView||self},SY=function(n,e,t){var i=n.getBoundingClientRect(),r=K0(e)?function(s,o){for(var a=0;a<s.length;a++)if(s[a].identifier===o)return s[a];return s[0]}(e.touches,t):e;return{left:yC((r.pageX-(i.left+LW(n).pageXOffset))/i.width),top:yC((r.pageY-(i.top+LW(n).pageYOffset))/i.height)}},RY=function(n){!K0(n)&&n.preventDefault()},GT=L.memo(function(n){var e=n.onMove,t=n.onKey,i=BT(n,["onMove","onKey"]),r=M.useRef(null),s=kW(e),o=kW(t),a=M.useRef(null),l=M.useRef(!1),c=M.useMemo(function(){var h=function(A){RY(A),(K0(A)?A.touches.length>0:A.buttons>0)&&r.current?s(SY(r.current,A,a.current)):I(!1)},f=function(){return I(!1)};function I(A){var p=l.current,y=LW(r.current),v=A?y.addEventListener:y.removeEventListener;v(p?"touchmove":"mousemove",h),v(p?"touchend":"mouseup",f)}return[function(A){var p=A.nativeEvent,y=r.current;if(y&&(RY(p),!function(b,w){return w&&!K0(b)}(p,l.current)&&y)){if(K0(p)){l.current=!0;var v=p.changedTouches||[];v.length&&(a.current=v[0].identifier)}y.focus(),s(SY(y,p,a.current)),I(!0)}},function(A){var p=A.which||A.keyCode;p<37||p>40||(A.preventDefault(),o({left:p===39?.05:p===37?-.05:0,top:p===40?.05:p===38?-.05:0}))},I]},[o,s]),g=c[0],u=c[1],d=c[2];return M.useEffect(function(){return d},[d]),L.createElement("div",OC({},i,{onTouchStart:g,onMouseDown:g,className:"react-colorful__interactive",ref:r,onKeyDown:u,tabIndex:0,role:"slider"}))}),Tv=function(n){return n.filter(Boolean).join(" ")},wT=function(n){var e=n.color,t=n.left,i=n.top,r=i===void 0?.5:i,s=Tv(["react-colorful__pointer",n.className]);return L.createElement("div",{className:s,style:{top:100*r+"%",left:100*t+"%"}},L.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:e}}))},ks=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*n)/t},k7=function(n){var e=n.s,t=n.v,i=n.a,r=(200-e)*t/100;return{h:ks(n.h),s:ks(r>0&&r<200?e*t/100/(r<=100?r:200-r)*100:0),l:ks(r/2),a:ks(i,2)}},HW=function(n){var e=k7(n);return"hsl("+e.h+", "+e.s+"%, "+e.l+"%)"},XZ=function(n){var e=k7(n);return"hsla("+e.h+", "+e.s+"%, "+e.l+"%, "+e.a+")"},L7=function(n){var e=n.h,t=n.s,i=n.v,r=n.a;e=e/360*6,t/=100,i/=100;var s=Math.floor(e),o=i*(1-t),a=i*(1-(e-s)*t),l=i*(1-(1-e+s)*t),c=s%6;return{r:ks(255*[i,a,o,o,l,i][c]),g:ks(255*[l,i,i,a,o,o][c]),b:ks(255*[o,o,l,i,i,a][c]),a:ks(r,2)}},H7=function(n){var e=n.r,t=n.g,i=n.b,r=n.a,s=Math.max(e,t,i),o=s-Math.min(e,t,i),a=o?s===e?(t-i)/o:s===t?2+(i-e)/o:4+(e-t)/o:0;return{h:ks(60*(a<0?a+6:a)),s:ks(s?o/s*100:0),v:ks(s/255*100),a:r}},z7=L.memo(function(n){var e=n.hue,t=n.onChange,i=Tv(["react-colorful__hue",n.className]);return L.createElement("div",{className:i},L.createElement(GT,{onMove:function(r){t({h:360*r.left})},onKey:function(r){t({h:yC(e+360*r.left,0,360)})},"aria-label":"Hue","aria-valuenow":ks(e),"aria-valuemax":"360","aria-valuemin":"0"},L.createElement(wT,{className:"react-colorful__hue-pointer",left:e/360,color:HW({h:e,s:100,v:100,a:1})})))}),X7=L.memo(function(n){var e=n.hsva,t=n.onChange,i={backgroundColor:HW({h:e.h,s:100,v:100,a:1})};return L.createElement("div",{className:"react-colorful__saturation",style:i},L.createElement(GT,{onMove:function(r){t({s:100*r.left,v:100-100*r.top})},onKey:function(r){t({s:yC(e.s+100*r.left,0,100),v:yC(e.v-100*r.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+ks(e.s)+"%, Brightness "+ks(e.v)+"%"},L.createElement(wT,{className:"react-colorful__saturation-pointer",top:1-e.v/100,left:e.s/100,color:HW(e)})))}),xT=function(n,e){if(n===e)return!0;for(var t in n)if(n[t]!==e[t])return!1;return!0};function Y7(n,e,t){var i=kW(t),r=M.useState(function(){return n.toHsva(e)}),s=r[0],o=r[1],a=M.useRef({color:e,hsva:s});M.useEffect(function(){if(!n.equal(e,a.current.color)){var c=n.toHsva(e);a.current={hsva:c,color:e},o(c)}},[e,n]),M.useEffect(function(){var c;xT(s,a.current.hsva)||n.equal(c=n.fromHsva(s),a.current.color)||(a.current={hsva:s,color:c},i(c))},[s,n,i]);var l=M.useCallback(function(c){o(function(g){return Object.assign({},g,c)})},[]);return[s,l]}var z1e=typeof window<"u"?M.useLayoutEffect:M.useEffect,X1e=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},ZY=new Map,K7=function(n){z1e(function(){var e=n.current?n.current.ownerDocument:document;if(e!==void 0&&!ZY.has(e)){var t=e.createElement("style");t.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,ZY.set(e,t);var i=X1e();i&&t.setAttribute("nonce",i),e.head.appendChild(t)}},[])},Y1e=function(n){var e=n.className,t=n.colorModel,i=n.color,r=i===void 0?t.defaultColor:i,s=n.onChange,o=BT(n,["className","colorModel","color","onChange"]),a=M.useRef(null);K7(a);var l=Y7(t,r,s),c=l[0],g=l[1],u=Tv(["react-colorful",e]);return L.createElement("div",OC({},o,{ref:a,className:u}),L.createElement(X7,{hsva:c,onChange:g}),L.createElement(z7,{hue:c.h,onChange:g,className:"react-colorful__last-control"}))},K1e=function(n){var e=n.className,t=n.hsva,i=n.onChange,r={backgroundImage:"linear-gradient(90deg, "+XZ(Object.assign({},t,{a:0}))+", "+XZ(Object.assign({},t,{a:1}))+")"},s=Tv(["react-colorful__alpha",e]),o=ks(100*t.a);return L.createElement("div",{className:s},L.createElement("div",{className:"react-colorful__alpha-gradient",style:r}),L.createElement(GT,{onMove:function(a){i({a:a.left})},onKey:function(a){i({a:yC(t.a+a.left)})},"aria-label":"Alpha","aria-valuetext":o+"%","aria-valuenow":o,"aria-valuemin":"0","aria-valuemax":"100"},L.createElement(wT,{className:"react-colorful__alpha-pointer",left:t.a,color:XZ(t)})))},D1e=function(n){var e=n.className,t=n.colorModel,i=n.color,r=i===void 0?t.defaultColor:i,s=n.onChange,o=BT(n,["className","colorModel","color","onChange"]),a=M.useRef(null);K7(a);var l=Y7(t,r,s),c=l[0],g=l[1],u=Tv(["react-colorful",e]);return L.createElement("div",OC({},o,{ref:a,className:u}),L.createElement(X7,{hsva:c,onChange:g}),L.createElement(z7,{hue:c.h,onChange:g}),L.createElement(K1e,{hsva:c,onChange:g,className:"react-colorful__last-control"}))},P1e={defaultColor:{r:0,g:0,b:0,a:1},toHsva:H7,fromHsva:L7,equal:xT},U1e=function(n){return L.createElement(D1e,OC({},n,{colorModel:P1e}))},Q1e={defaultColor:{r:0,g:0,b:0},toHsva:function(n){return H7({r:n.r,g:n.g,b:n.b,a:1})},fromHsva:function(n){return{r:(e=L7(n)).r,g:e.g,b:e.b};var e},equal:xT},O1e=function(n){return L.createElement(Y1e,OC({},n,{colorModel:Q1e}))};function JC(n,e,t,i){function r(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(g){try{c(i.next(g))}catch(u){o(u)}}function l(g){try{c(i.throw(g))}catch(u){o(u)}}function c(g){g.done?s(g.value):r(g.value).then(a,l)}c((i=i.apply(n,e||[])).next())})}function jC(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,r,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(g){return l([c,g])}}function l(c){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(t=0)),t;)try{if(i=1,r&&(s=c[0]&2?r.return:c[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,c[1])).done)return s;switch(r=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,r=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){t.label=c[1];break}if(c[0]===6&&t.label<s[1]){t.label=s[1],s=c;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(c);break}s[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(g){c=[6,g],r=0}finally{i=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function J1e(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),r,s=[],o;try{for(;(e===void 0||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(a){o={error:a}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return s}function j1e(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(J1e(arguments[e]));return n}var q1e=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function Nv(n,e){var t=$1e(n);if(typeof t.path!="string"){var i=n.webkitRelativePath;Object.defineProperty(t,"path",{value:typeof e=="string"?e:typeof i=="string"&&i.length>0?i:n.name,writable:!1,configurable:!1,enumerable:!0})}return t}function $1e(n){var e=n.name,t=e&&e.lastIndexOf(".")!==-1;if(t&&!n.type){var i=e.split(".").pop().toLowerCase(),r=q1e.get(i);r&&Object.defineProperty(n,"type",{value:r,writable:!1,configurable:!1,enumerable:!0})}return n}var e2e=[".DS_Store","Thumbs.db"];function t2e(n){return JC(this,void 0,void 0,function(){return jC(this,function(e){return H2(n)&&n2e(n)?[2,o2e(n.dataTransfer,n.type)]:i2e(n)?[2,r2e(n)]:Array.isArray(n)&&n.every(function(t){return"getFile"in t&&typeof t.getFile=="function"})?[2,s2e(n)]:[2,[]]})})}function n2e(n){return H2(n.dataTransfer)}function i2e(n){return H2(n)&&H2(n.target)}function H2(n){return typeof n=="object"&&n!==null}function r2e(n){return zW(n.target.files).map(function(e){return Nv(e)})}function s2e(n){return JC(this,void 0,void 0,function(){var e;return jC(this,function(t){switch(t.label){case 0:return[4,Promise.all(n.map(function(i){return i.getFile()}))];case 1:return e=t.sent(),[2,e.map(function(i){return Nv(i)})]}})})}function o2e(n,e){return JC(this,void 0,void 0,function(){var t,i;return jC(this,function(r){switch(r.label){case 0:return n===null?[2,[]]:n.items?(t=zW(n.items).filter(function(s){return s.kind==="file"}),e!=="drop"?[2,t]:[4,Promise.all(t.map(a2e))]):[3,2];case 1:return i=r.sent(),[2,MY(D7(i))];case 2:return[2,MY(zW(n.files).map(function(s){return Nv(s)}))]}})})}function MY(n){return n.filter(function(e){return e2e.indexOf(e.name)===-1})}function zW(n){if(n===null)return[];for(var e=[],t=0;t<n.length;t++){var i=n[t];e.push(i)}return e}function a2e(n){if(typeof n.webkitGetAsEntry!="function")return EY(n);var e=n.webkitGetAsEntry();return e&&e.isDirectory?P7(e):EY(n)}function D7(n){return n.reduce(function(e,t){return j1e(e,Array.isArray(t)?D7(t):[t])},[])}function EY(n){var e=n.getAsFile();if(!e)return Promise.reject(n+" is not a File");var t=Nv(e);return Promise.resolve(t)}function l2e(n){return JC(this,void 0,void 0,function(){return jC(this,function(e){return[2,n.isDirectory?P7(n):c2e(n)]})})}function P7(n){var e=n.createReader();return new Promise(function(t,i){var r=[];function s(){var o=this;e.readEntries(function(a){return JC(o,void 0,void 0,function(){var l,c,g;return jC(this,function(u){switch(u.label){case 0:if(a.length)return[3,5];u.label=1;case 1:return u.trys.push([1,3,,4]),[4,Promise.all(r)];case 2:return l=u.sent(),t(l),[3,4];case 3:return c=u.sent(),i(c),[3,4];case 4:return[3,6];case 5:g=Promise.all(a.map(l2e)),r.push(g),s(),u.label=6;case 6:return[2]}})})},function(a){i(a)})}s()})}function c2e(n){return JC(this,void 0,void 0,function(){return jC(this,function(e){return[2,new Promise(function(t,i){n.file(function(r){var s=Nv(r,n.fullPath);t(s)},function(r){i(r)})})]})})}var g2e=function(n,e){if(n&&e){var t=Array.isArray(e)?e:e.split(","),i=n.name||"",r=(n.type||"").toLowerCase(),s=r.replace(/\/.*$/,"");return t.some(function(o){var a=o.trim().toLowerCase();return a.charAt(0)==="."?i.toLowerCase().endsWith(a):a.endsWith("/*")?s===a.replace(/\/.*$/,""):r===a})}return!0};function WY(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function FY(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?WY(Object(t),!0).forEach(function(i){U7(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):WY(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function U7(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function _Y(n,e){return f2e(n)||h2e(n,e)||d2e(n,e)||u2e()}function u2e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function d2e(n,e){if(n){if(typeof n=="string")return VY(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return VY(n,e)}}function VY(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=n[t];return i}function h2e(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i=[],r=!0,s=!1,o,a;try{for(t=t.call(n);!(r=(o=t.next()).done)&&(i.push(o.value),!(e&&i.length===e));r=!0);}catch(l){s=!0,a=l}finally{try{!r&&t.return!=null&&t.return()}finally{if(s)throw a}}return i}}function f2e(n){if(Array.isArray(n))return n}var I2e="file-invalid-type",A2e="file-too-large",C2e="file-too-small",p2e="too-many-files",m2e=function(e){e=Array.isArray(e)&&e.length===1?e[0]:e;var t=Array.isArray(e)?"one of ".concat(e.join(", ")):e;return{code:I2e,message:"File type must be ".concat(t)}},TY=function(e){return{code:A2e,message:"File is larger than ".concat(e," ").concat(e===1?"byte":"bytes")}},NY=function(e){return{code:C2e,message:"File is smaller than ".concat(e," ").concat(e===1?"byte":"bytes")}},y2e={code:p2e,message:"Too many files"};function Q7(n,e){var t=n.type==="application/x-moz-file"||g2e(n,e);return[t,t?null:m2e(e)]}function O7(n,e,t){if(Wm(n.size))if(Wm(e)&&Wm(t)){if(n.size>t)return[!1,TY(t)];if(n.size<e)return[!1,NY(e)]}else{if(Wm(e)&&n.size<e)return[!1,NY(e)];if(Wm(t)&&n.size>t)return[!1,TY(t)]}return[!0,null]}function Wm(n){return n!=null}function v2e(n){var e=n.files,t=n.accept,i=n.minSize,r=n.maxSize,s=n.multiple,o=n.maxFiles;return!s&&e.length>1||s&&o>=1&&e.length>o?!1:e.every(function(a){var l=Q7(a,t),c=_Y(l,1),g=c[0],u=O7(a,i,r),d=_Y(u,1),h=d[0];return g&&h})}function z2(n){return typeof n.isPropagationStopped=="function"?n.isPropagationStopped():typeof n.cancelBubble<"u"?n.cancelBubble:!1}function hG(n){return n.dataTransfer?Array.prototype.some.call(n.dataTransfer.types,function(e){return e==="Files"||e==="application/x-moz-file"}):!!n.target&&!!n.target.files}function kY(n){n.preventDefault()}function b2e(n){return n.indexOf("MSIE")!==-1||n.indexOf("Trident/")!==-1}function B2e(n){return n.indexOf("Edge/")!==-1}function G2e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return b2e(n)||B2e(n)}function Ul(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return function(i){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return e.some(function(a){return!z2(i)&&a&&a.apply(void 0,[i].concat(s)),z2(i)})}}function w2e(){return"showOpenFilePicker"in window}function x2e(n){return n=typeof n=="string"?n.split(","):n,[{description:"everything",accept:Array.isArray(n)?n.filter(function(e){return e==="audio/*"||e==="video/*"||e==="image/*"||e==="text/*"||/\w+\/[-+.\w]+/g.test(e)}).reduce(function(e,t){return FY(FY({},e),{},U7({},t,[]))},{}):{}}]}function S2e(n){return n instanceof DOMException&&(n.name==="AbortError"||n.code===n.ABORT_ERR)}function R2e(n){return n instanceof DOMException&&(n.name==="SecurityError"||n.code===n.SECURITY_ERR)}var Z2e=["children"],M2e=["open"],E2e=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],W2e=["refKey","onChange","onClick"];function F2e(n){return T2e(n)||V2e(n)||J7(n)||_2e()}function _2e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function V2e(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function T2e(n){if(Array.isArray(n))return XW(n)}function YZ(n,e){return L2e(n)||k2e(n,e)||J7(n,e)||N2e()}function N2e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function J7(n,e){if(n){if(typeof n=="string")return XW(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return XW(n,e)}}function XW(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=n[t];return i}function k2e(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i=[],r=!0,s=!1,o,a;try{for(t=t.call(n);!(r=(o=t.next()).done)&&(i.push(o.value),!(e&&i.length===e));r=!0);}catch(l){s=!0,a=l}finally{try{!r&&t.return!=null&&t.return()}finally{if(s)throw a}}return i}}function L2e(n){if(Array.isArray(n))return n}function LY(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function ci(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?LY(Object(t),!0).forEach(function(i){YW(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):LY(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function YW(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function X2(n,e){if(n==null)return{};var t=H2e(n,e),i,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(n,i)&&(t[i]=n[i])}return t}function H2e(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}var ST=M.forwardRef(function(n,e){var t=n.children,i=X2(n,Z2e),r=q7(i),s=r.open,o=X2(r,M2e);return M.useImperativeHandle(e,function(){return{open:s}},[s]),L.createElement(M.Fragment,null,t(ci(ci({},o),{},{open:s})))});ST.displayName="Dropzone";var j7={disabled:!1,getFilesFromEvent:t2e,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!0};ST.defaultProps=j7;ST.propTypes={children:ln.func,accept:ln.oneOfType([ln.string,ln.arrayOf(ln.string)]),multiple:ln.bool,preventDropOnDocument:ln.bool,noClick:ln.bool,noKeyboard:ln.bool,noDrag:ln.bool,noDragEventsBubbling:ln.bool,minSize:ln.number,maxSize:ln.number,maxFiles:ln.number,disabled:ln.bool,getFilesFromEvent:ln.func,onFileDialogCancel:ln.func,onFileDialogOpen:ln.func,useFsAccessApi:ln.bool,onDragEnter:ln.func,onDragLeave:ln.func,onDragOver:ln.func,onDrop:ln.func,onDropAccepted:ln.func,onDropRejected:ln.func,validator:ln.func};var KW={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,draggedFiles:[],acceptedFiles:[],fileRejections:[]};function q7(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=ci(ci({},j7),n),t=e.accept,i=e.disabled,r=e.getFilesFromEvent,s=e.maxSize,o=e.minSize,a=e.multiple,l=e.maxFiles,c=e.onDragEnter,g=e.onDragLeave,u=e.onDragOver,d=e.onDrop,h=e.onDropAccepted,f=e.onDropRejected,I=e.onFileDialogCancel,A=e.onFileDialogOpen,p=e.useFsAccessApi,y=e.preventDropOnDocument,v=e.noClick,b=e.noKeyboard,w=e.noDrag,G=e.noDragEventsBubbling,x=e.validator,B=M.useMemo(function(){return typeof A=="function"?A:HY},[A]),R=M.useMemo(function(){return typeof I=="function"?I:HY},[I]),Z=M.useRef(null),W=M.useRef(null),F=M.useReducer(z2e,KW),T=YZ(F,2),V=T[0],z=T[1],U=V.isFocused,J=V.isFileDialogActive,H=V.draggedFiles,Y=M.useRef(typeof window<"u"&&window.isSecureContext&&p&&w2e()),K=function(){!Y.current&&J&&setTimeout(function(){if(W.current){var ce=W.current.files;ce.length||(z({type:"closeDialog"}),R())}},300)};M.useEffect(function(){return window.addEventListener("focus",K,!1),function(){window.removeEventListener("focus",K,!1)}},[W,J,R,Y]);var Q=M.useRef([]),P=function(ce){Z.current&&Z.current.contains(ce.target)||(ce.preventDefault(),Q.current=[])};M.useEffect(function(){return y&&(document.addEventListener("dragover",kY,!1),document.addEventListener("drop",P,!1)),function(){y&&(document.removeEventListener("dragover",kY),document.removeEventListener("drop",P))}},[Z,y]);var ne=M.useCallback(function(X){X.preventDefault(),X.persist(),xe(X),Q.current=[].concat(F2e(Q.current),[X.target]),hG(X)&&Promise.resolve(r(X)).then(function(ce){z2(X)&&!G||(z({draggedFiles:ce,isDragActive:!0,type:"setDraggedFiles"}),c&&c(X))})},[r,c,G]),oe=M.useCallback(function(X){X.preventDefault(),X.persist(),xe(X);var ce=hG(X);if(ce&&X.dataTransfer)try{X.dataTransfer.dropEffect="copy"}catch{}return ce&&u&&u(X),!1},[u,G]),$=M.useCallback(function(X){X.preventDefault(),X.persist(),xe(X);var ce=Q.current.filter(function(Ge){return Z.current&&Z.current.contains(Ge)}),fe=ce.indexOf(X.target);fe!==-1&&ce.splice(fe,1),Q.current=ce,!(ce.length>0)&&(z({isDragActive:!1,type:"setDraggedFiles",draggedFiles:[]}),hG(X)&&g&&g(X))},[Z,g,G]),de=M.useCallback(function(X,ce){var fe=[],Ge=[];X.forEach(function(me){var Fe=Q7(me,t),Le=YZ(Fe,2),Re=Le[0],Xe=Le[1],we=O7(me,o,s),Ue=YZ(we,2),Pe=Ue[0],Ye=Ue[1],$e=x?x(me):null;if(Re&&Pe&&!$e)fe.push(me);else{var mt=[Xe,Ye];$e&&(mt=mt.concat($e)),Ge.push({file:me,errors:mt.filter(function(Wt){return Wt})})}}),(!a&&fe.length>1||a&&l>=1&&fe.length>l)&&(fe.forEach(function(me){Ge.push({file:me,errors:[y2e]})}),fe.splice(0)),z({acceptedFiles:fe,fileRejections:Ge,type:"setFiles"}),d&&d(fe,Ge,ce),Ge.length>0&&f&&f(Ge,ce),fe.length>0&&h&&h(fe,ce)},[z,a,t,o,s,l,d,h,f,x]),ge=M.useCallback(function(X){X.preventDefault(),X.persist(),xe(X),Q.current=[],hG(X)&&Promise.resolve(r(X)).then(function(ce){z2(X)&&!G||de(ce,X)}),z({type:"reset"})},[r,de,G]),se=M.useCallback(function(){if(Y.current){z({type:"openDialog"}),B();var X={multiple:a,types:x2e(t)};window.showOpenFilePicker(X).then(function(ce){return r(ce)}).then(function(ce){de(ce,null),z({type:"closeDialog"})}).catch(function(ce){S2e(ce)?(R(ce),z({type:"closeDialog"})):R2e(ce)&&(Y.current=!1,W.current&&(W.current.value=null,W.current.click()))});return}W.current&&(z({type:"openDialog"}),B(),W.current.value=null,W.current.click())},[z,B,R,p,de,t,a]),k=M.useCallback(function(X){!Z.current||!Z.current.isEqualNode(X.target)||(X.key===" "||X.key==="Enter"||X.keyCode===32||X.keyCode===13)&&(X.preventDefault(),se())},[Z,se]),O=M.useCallback(function(){z({type:"focus"})},[]),q=M.useCallback(function(){z({type:"blur"})},[]),ee=M.useCallback(function(){v||(G2e()?setTimeout(se,0):se())},[v,se]),le=function(ce){return i?null:ce},he=function(ce){return b?null:le(ce)},be=function(ce){return w?null:le(ce)},xe=function(ce){G&&ce.stopPropagation()},ze=M.useMemo(function(){return function(){var X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ce=X.refKey,fe=ce===void 0?"ref":ce,Ge=X.role,me=X.onKeyDown,Fe=X.onFocus,Le=X.onBlur,Re=X.onClick,Xe=X.onDragEnter,we=X.onDragOver,Ue=X.onDragLeave,Pe=X.onDrop,Ye=X2(X,E2e);return ci(ci(YW({onKeyDown:he(Ul(me,k)),onFocus:he(Ul(Fe,O)),onBlur:he(Ul(Le,q)),onClick:le(Ul(Re,ee)),onDragEnter:be(Ul(Xe,ne)),onDragOver:be(Ul(we,oe)),onDragLeave:be(Ul(Ue,$)),onDrop:be(Ul(Pe,ge)),role:typeof Ge=="string"&&Ge!==""?Ge:"button"},fe,Z),!i&&!b?{tabIndex:0}:{}),Ye)}},[Z,k,O,q,ee,ne,oe,$,ge,b,w,i]),Se=M.useCallback(function(X){X.stopPropagation()},[]),ke=M.useMemo(function(){return function(){var X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ce=X.refKey,fe=ce===void 0?"ref":ce,Ge=X.onChange,me=X.onClick,Fe=X2(X,W2e),Le=YW({accept:t,multiple:a,type:"file",style:{display:"none"},onChange:le(Ul(Ge,ge)),onClick:le(Ul(me,Se)),tabIndex:-1},fe,W);return ci(ci({},Le),Fe)}},[W,t,a,ge,i]),He=H.length,Be=He>0&&v2e({files:H,accept:t,minSize:o,maxSize:s,multiple:a,maxFiles:l}),j=He>0&&!Be;return ci(ci({},V),{},{isDragAccept:Be,isDragReject:j,isFocused:U&&!i,getRootProps:ze,getInputProps:ke,rootRef:Z,inputRef:W,open:le(se)})}function z2e(n,e){switch(e.type){case"focus":return ci(ci({},n),{},{isFocused:!0});case"blur":return ci(ci({},n),{},{isFocused:!1});case"openDialog":return ci(ci({},KW),{},{isFileDialogActive:!0});case"closeDialog":return ci(ci({},n),{},{isFileDialogActive:!1});case"setDraggedFiles":var t=e.isDragActive,i=e.draggedFiles;return ci(ci({},n),{},{draggedFiles:i,isDragActive:t});case"setFiles":return ci(ci({},n),{},{acceptedFiles:e.acceptedFiles,fileRejections:e.fileRejections});case"reset":return ci({},KW);default:return n}}function HY(){}/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var X2e=function(e){return e!=null&&typeof e=="object"&&Array.isArray(e)===!1};/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var Y2e=X2e;function zY(n){return Y2e(n)===!0&&Object.prototype.toString.call(n)==="[object Object]"}var $7=function(e){var t,i;return!(zY(e)===!1||(t=e.constructor,typeof t!="function")||(i=t.prototype,zY(i)===!1)||i.hasOwnProperty("isPrototypeOf")===!1)};/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var K2e=$7,RT=function(e){return K2e(e)||typeof e=="function"||Array.isArray(e)};/*!
 * for-in <https://github.com/jonschlinkert/for-in>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var D2e=function(e,t,i){for(var r in e)if(t.call(i,e[r],r,e)===!1)break},P2e=RT,U2e=D2e;function e6(n,e){for(var t=arguments.length,i=0;++i<t;){var r=arguments[i];DW(r)&&U2e(r,Q2e,n)}return n}function Q2e(n,e){if(O2e(e)){var t=this[e];DW(n)&&DW(t)?e6(t,n):this[e]=n}}function DW(n){return P2e(n)&&!Array.isArray(n)}function O2e(n){return n!=="__proto__"&&n!=="constructor"&&n!=="prototype"}var J2e=e6;/*!
 * get-value <https://github.com/jonschlinkert/get-value>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var j2e=function(n,e,t,i,r){if(!q2e(n)||!e)return n;if(e=fG(e),t&&(e+="."+fG(t)),i&&(e+="."+fG(i)),r&&(e+="."+fG(r)),e in n)return n[e];for(var s=e.split("."),o=s.length,a=-1;n&&++a<o;){for(var l=s[a];l[l.length-1]==="\\";)l=l.slice(0,-1)+"."+s[++a];n=n[l]}return n};function q2e(n){return n!==null&&(typeof n=="object"||typeof n=="function")}function fG(n){return n?Array.isArray(n)?n.join("."):n:""}/*!
 * assign-symbols <https://github.com/jonschlinkert/assign-symbols>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var $2e=function(n,e){if(n===null||typeof n>"u")throw new TypeError("expected first argument to be an object.");if(typeof e>"u"||typeof Symbol>"u"||typeof Object.getOwnPropertySymbols!="function")return n;for(var t=Object.prototype.propertyIsEnumerable,i=Object(n),r=arguments.length,s=0;++s<r;)for(var o=Object(arguments[s]),a=Object.getOwnPropertySymbols(o),l=0;l<a.length;l++){var c=a[l];t.call(o,c)&&(i[c]=o[c])}return i},ewe=RT,twe=$2e,nwe=Object.assign||function(n){if(n===null||typeof n>"u")throw new TypeError("Cannot convert undefined or null to object");XY(n)||(n={});for(var e=1;e<arguments.length;e++){var t=arguments[e];rwe(t)&&(t=swe(t)),XY(t)&&(iwe(n,t),twe(n,t))}return n};function iwe(n,e){for(var t in e)owe(e,t)&&(n[t]=e[t])}function rwe(n){return n&&typeof n=="string"}function swe(n){var e={};for(var t in n)e[t]=n[t];return e}function XY(n){return n&&typeof n=="object"||ewe(n)}function owe(n,e){return Object.prototype.hasOwnProperty.call(n,e)}/*!
 * split-string <https://github.com/jonschlinkert/split-string>
 *
 * Copyright (c) 2015-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var awe=nwe,lwe=function(n,e,t){if(typeof n!="string")throw new TypeError("expected a string");typeof e=="function"&&(t=e,e=null),typeof e=="string"&&(e={sep:e});var i=awe({sep:"."},e),r=i.quotes||['"',"'","`"],s;i.brackets===!0?s={"<":">","(":")","[":"]","{":"}"}:i.brackets&&(s=i.brackets);var o=[],a=[],l=[""],c=i.sep,g=n.length,u=-1,d;function h(){if(s&&a.length)return s[a[a.length-1]]}for(;++u<g;){var f=n[u],I=n[u+1],A={val:f,idx:u,arr:l,str:n};if(o.push(A),f==="\\"){A.val=gwe(i,n,u)===!0?f+I:I,A.escaped=!0,typeof t=="function"&&t(A),l[l.length-1]+=A.val,u++;continue}if(s&&s[f]){a.push(f);var p=h(),y=u+1;if(n.indexOf(p,y+1)!==-1)for(;a.length&&y<g;){var v=n[++y];if(v==="\\"){v++;continue}if(r.indexOf(v)!==-1){y=PW(n,v,y+1);continue}if(p=h(),a.length&&n.indexOf(p,y+1)===-1)break;if(s[v]){a.push(v);continue}p===v&&a.pop()}if(d=y,d===-1){l[l.length-1]+=f;continue}f=n.slice(u,d+1),A.val=f,A.idx=u=d}if(r.indexOf(f)!==-1){if(d=PW(n,f,u+1),d===-1){l[l.length-1]+=f;continue}cwe(f,i)===!0?f=n.slice(u,d+1):f=n.slice(u+1,d),A.val=f,A.idx=u=d}if(typeof t=="function"&&(t(A,o),f=A.val,u=A.idx),A.val===c&&A.split!==!1){l.push("");continue}l[l.length-1]+=A.val}return l};function PW(n,e,t,i){var r=n.indexOf(e,t);return n.charAt(r-1)==="\\"?PW(n,e,r+1):r}function cwe(n,e){return e.keepDoubleQuotes===!0&&n==='"'||e.keepSingleQuotes===!0&&n==="'"?!0:e.keepQuotes}function gwe(n,e,t){return typeof n.keepEscaping=="function"?n.keepEscaping(e,t):n.keepEscaping===!0||e[t+1]==="\\"}/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var uwe=function(e){return typeof e<"u"&&e!==null&&(typeof e=="object"||typeof e=="function")},YY=uwe,dwe=function(e){YY(e)||(e={});for(var t=arguments.length,i=1;i<t;i++){var r=arguments[i];YY(r)&&hwe(e,r)}return e};function hwe(n,e){for(var t in e)fwe(e,t)&&(n[t]=e[t])}function fwe(n,e){return Object.prototype.hasOwnProperty.call(n,e)}/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var Iwe=function(e){return typeof e<"u"&&e!==null&&(typeof e=="object"||typeof e=="function")};/*!
 * set-value <https://github.com/jonschlinkert/set-value>
 *
 * Copyright (c) 2014-2015, 2017, Jon Schlinkert.
 * Released under the MIT License.
 */var Awe=lwe,Cwe=dwe,KY=$7,DY=Iwe,pwe=function(n,e,t){if(!DY(n)||(Array.isArray(e)&&(e=[].concat.apply([],e).join(".")),typeof e!="string"))return n;for(var i=Awe(e,{sep:".",brackets:!0}).filter(mwe),r=i.length,s=-1,o=n;++s<r;){var a=i[s];if(s!==r-1){DY(o[a])||(o[a]={}),o=o[a];continue}KY(o[a])&&KY(t)?o[a]=Cwe({},o[a],t):o[a]=t}return n};function mwe(n){return n!=="__proto__"&&n!=="constructor"&&n!=="prototype"}var KZ=RT,PY=J2e,ywe=j2e,UY=pwe,vwe=function(e,t,i){if(!KZ(e))throw new TypeError("expected an object");if(typeof t!="string"||i==null)return PY.apply(null,arguments);if(typeof i=="string")return UY(e,t,i),e;var r=ywe(e,t);return KZ(i)&&KZ(r)&&(i=PY({},r,i)),UY(e,t,i),e};const bwe=Ks(vwe),ZT=(...n)=>n.filter(Boolean).join(".");function Bwe(n){const e=n.split(".");return[e.pop(),e.join(".")||void 0]}function Gwe(n){const e=M.useRef(null),t=M.useRef(null),i=M.useRef(!0);return M.useLayoutEffect(()=>{n||(e.current.style.height="0px",e.current.style.overflow="hidden")},[]),M.useEffect(()=>{if(i.current){i.current=!1;return}let r;const s=e.current,o=()=>{n&&(s.style.removeProperty("height"),s.style.removeProperty("overflow"),t.current.scrollIntoView({behavior:"smooth",block:"nearest"}))};s.addEventListener("transitionend",o,{once:!0});const{height:a}=t.current.getBoundingClientRect();return s.style.height=a+"px",n||(s.style.overflow="hidden",r=window.setTimeout(()=>s.style.height="0px",50)),()=>{s.removeEventListener("transitionend",o),clearTimeout(r)}},[n]),{wrapperRef:e,contentRef:t}}const wwe=n=>{const[e,t]=M.useState(n.getVisiblePaths());return M.useEffect(()=>{t(n.getVisiblePaths());const i=n.useStore.subscribe(n.getVisiblePaths,t,{equalityFn:nj});return()=>i()},[n]),e};function t6(n=3){const e=M.useRef(null),t=M.useRef(null),[i,r]=M.useState(!1),s=M.useCallback(()=>r(!0),[]),o=M.useCallback(()=>r(!1),[]);return M.useLayoutEffect(()=>{if(i){const{bottom:a,top:l,left:c}=e.current.getBoundingClientRect(),{height:g}=t.current.getBoundingClientRect(),u=a+g>window.innerHeight-40?"up":"down";t.current.style.position="fixed",t.current.style.zIndex="10000",t.current.style.left=c+"px",u==="down"?t.current.style.top=a+n+"px":t.current.style.bottom=window.innerHeight-l+n+"px"}},[n,i]),{popinRef:e,wrapperRef:t,shown:i,show:s,hide:o}}L1e([H1e]);const xwe={rgb:"toRgb",hsl:"toHsl",hsv:"toHsv",hex:"toHex"};Io.extend({color:()=>n=>Ws(n).isValid()});const Swe=n=>Io().color().test(n);function n6(n,{format:e,hasAlpha:t,isString:i}){const r=xwe[e]+(i&&e!=="hex"?"String":""),s=n[r]();return typeof s=="object"&&!t?sGe(s,["a"]):s}const i6=(n,e)=>{const t=Ws(n);if(!t.isValid())throw Error("Invalid color");return n6(t,e)},Rwe=(n,e)=>n6(Ws(n),Vt(Vt({},e),{},{isString:!0,format:"hex"})),Zwe=({value:n})=>{const e=k1e(n),t=e==="name"?"hex":e,i=typeof n=="object"?"a"in n:e==="hex"&&n.length===8||/^(rgba)|(hsla)|(hsva)/.test(n),r={format:t,hasAlpha:i,isString:typeof n=="string"};return{value:i6(n,r),settings:r}};var Mwe=Object.freeze({__proto__:null,schema:Swe,sanitize:i6,format:Rwe,normalize:Zwe});const Ewe=wt("div",{position:"relative",boxSizing:"border-box",borderRadius:"$sm",overflow:"hidden",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",backgroundColor:"#fff",backgroundImage:`url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')`,$inputStyle:"",$hover:"",zIndex:1,variants:{active:{true:{$inputStyle:"$accent1"}}},"&::before":{content:'""',position:"absolute",top:0,bottom:0,right:0,left:0,backgroundColor:"currentColor",zIndex:1}}),Wwe=wt("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto",columnGap:"$colGap",alignItems:"center"}),Fwe=wt("div",{width:"$colorPickerWidth",height:"$colorPickerHeight",".react-colorful":{width:"100%",height:"100%",boxShadow:"$level2",cursor:"crosshair"},".react-colorful__saturation":{borderRadius:"$sm $sm 0 0"},".react-colorful__alpha, .react-colorful__hue":{height:10},".react-colorful__last-control":{borderRadius:"0 0 $sm $sm"},".react-colorful__pointer":{height:12,width:12}});function QY(n,e){return e!=="rgb"?Ws(n).toRgb():n}function _we({value:n,displayValue:e,settings:t,onUpdate:i}){const{emitOnEditStart:r,emitOnEditEnd:s}=ps(),{format:o,hasAlpha:a}=t,{popinRef:l,wrapperRef:c,shown:g,show:u,hide:d}=t6(),h=M.useRef(0),[f,I]=M.useState(()=>QY(n,o)),A=a?U1e:O1e,p=()=>{I(QY(n,o)),u(),r()},y=()=>{d(),s(),window.clearTimeout(h.current)},v=()=>{h.current=window.setTimeout(y,500)};return M.useEffect(()=>()=>window.clearTimeout(h.current),[]),L.createElement(L.Fragment,null,L.createElement(Ewe,{ref:l,active:g,onClick:()=>p(),style:{color:e}}),g&&L.createElement(yT,null,L.createElement(w7,{onPointerUp:y}),L.createElement(Fwe,{ref:c,onMouseEnter:()=>window.clearTimeout(h.current),onMouseLeave:b=>b.buttons===0&&v()},L.createElement(A,{color:f,onChange:i}))))}function Vwe(){const{value:n,displayValue:e,label:t,onChange:i,onUpdate:r,settings:s}=ps();return L.createElement(Pa,{input:!0},L.createElement(Fl,null,t),L.createElement(Wwe,null,L.createElement(_we,{value:n,displayValue:e,onChange:i,onUpdate:r,settings:s}),L.createElement(mT,{value:e,onChange:i,onUpdate:r})))}var Twe=Vt({component:Vwe},Mwe);function Nwe(){const{label:n,displayValue:e,onUpdate:t,settings:i}=ps();return L.createElement(Pa,{input:!0},L.createElement(Fl,null,n),L.createElement(bT,{value:e,settings:i,onUpdate:t}))}var kwe=Vt({component:Nwe},F7(["x","y","z"]));const Lwe=wt("div",{$flexCenter:"",position:"relative",backgroundColor:"$elevation3",borderRadius:"$sm",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",touchAction:"none",$draggable:"",$hover:"","&:active":{cursor:"none"},"&::after":{content:'""',backgroundColor:"$accent2",height:4,width:4,borderRadius:2}}),Hwe=wt("div",{$flexCenter:"",width:"$joystickWidth",height:"$joystickHeight",borderRadius:"$sm",boxShadow:"$level2",position:"fixed",zIndex:1e4,overflow:"hidden",$draggable:"",transform:"translate(-50%, -50%)",variants:{isOutOfBounds:{true:{backgroundColor:"$elevation1"},false:{backgroundColor:"$elevation3"}}},"> div":{position:"absolute",$flexCenter:"",borderStyle:"solid",borderWidth:1,borderColor:"$highlight1",backgroundColor:"$elevation3",width:"80%",height:"80%","&::after,&::before":{content:'""',position:"absolute",zindex:10,backgroundColor:"$highlight1"},"&::before":{width:"100%",height:1},"&::after":{height:"100%",width:1}},"> span":{position:"relative",zindex:100,width:10,height:10,backgroundColor:"$accent2",borderRadius:"50%"}});function zwe({value:n,settings:e,onUpdate:t}){const i=M.useRef(),r=M.useRef(0),s=M.useRef(0),o=M.useRef(1),[a,l]=M.useState(!1),[c,g]=M.useState(!1),[u,d]=S7(),h=M.useRef(null),f=M.useRef(null);M.useLayoutEffect(()=>{if(a){const{top:F,left:T,width:V,height:z}=h.current.getBoundingClientRect();f.current.style.left=T+V/2+"px",f.current.style.top=F+z/2+"px"}},[a]);const{keys:[I,A],joystick:p}=e,y=p==="invertY"?1:-1,{[I]:{step:v},[A]:{step:b}}=e,w=Vg("sizes","joystickWidth"),G=Vg("sizes","joystickHeight"),x=parseFloat(w)*.8/2,B=parseFloat(G)*.8/2,R=M.useCallback(()=>{i.current||(g(!0),r.current&&d({x:r.current*x}),s.current&&d({y:s.current*-B}),i.current=window.setInterval(()=>{t(F=>{const T=v*r.current*o.current,V=y*b*s.current*o.current;return Array.isArray(F)?{[I]:F[0]+T,[A]:F[1]+V}:{[I]:F[I]+T,[A]:F[A]+V}})},16))},[x,B,t,d,v,b,I,A,y]),Z=M.useCallback(()=>{window.clearTimeout(i.current),i.current=void 0,g(!1)},[]);M.useEffect(()=>{function F(T){o.current=u7(T)}return window.addEventListener("keydown",F),window.addEventListener("keyup",F),()=>{window.clearTimeout(i.current),window.removeEventListener("keydown",F),window.removeEventListener("keyup",F)}},[]);const W=Vv(({first:F,active:T,delta:[V,z],movement:[U,J]})=>{F&&l(!0);const H=Bd(U,-x,x),Y=Bd(J,-B,B);r.current=Math.abs(U)>Math.abs(H)?Math.sign(U-H):0,s.current=Math.abs(J)>Math.abs(Y)?Math.sign(Y-J):0;let K=n[I],Q=n[A];T?(r.current||(K+=V*v*o.current,d({x:H})),s.current||(Q-=y*z*b*o.current,d({y:Y})),r.current||s.current?R():Z(),t({[I]:K,[A]:Q})):(l(!1),r.current=0,s.current=0,d({x:0,y:0}),Z())});return L.createElement(Lwe,Ui({ref:h},W()),a&&L.createElement(yT,null,L.createElement(Hwe,{ref:f,isOutOfBounds:c},L.createElement("div",null),L.createElement("span",{ref:u}))))}const Xwe=wt("div",{display:"grid",columnGap:"$colGap",variants:{withJoystick:{true:{gridTemplateColumns:"$sizes$rowHeight auto"},false:{gridTemplateColumns:"auto"}}}});function Ywe(){const{label:n,displayValue:e,onUpdate:t,settings:i}=ps();return L.createElement(Pa,{input:!0},L.createElement(Fl,null,n),L.createElement(Xwe,{withJoystick:!!i.joystick},i.joystick&&L.createElement(zwe,{value:e,settings:i,onUpdate:t}),L.createElement(bT,{value:e,settings:i,onUpdate:t})))}const Kwe=["joystick"],r6=F7(["x","y"]),Dwe=n=>{let{joystick:e=!0}=n,t=Kn(n,Kwe);const{value:i,settings:r}=r6.normalize(t);return{value:i,settings:Vt(Vt({},r),{},{joystick:e})}};var Pwe=Vt(Vt({component:Ywe},r6),{},{normalize:Dwe});const Uwe=n=>{if(n!==void 0){if(n instanceof File)try{return URL.createObjectURL(n)}catch{return}if(typeof n=="string"&&n.indexOf("blob:")===0)return n;throw Error("Invalid image format [undefined | blob | File].")}},Qwe=(n,e)=>typeof e=="object"&&"image"in e,Owe=({image:n})=>({value:n});var Jwe=Object.freeze({__proto__:null,sanitize:Uwe,schema:Qwe,normalize:Owe});const jwe=wt("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto 20px",columnGap:"$colGap",alignItems:"center"}),qwe=wt("div",{$flexCenter:"",overflow:"hidden",height:"$rowHeight",background:"$elevation3",textAlign:"center",color:"inherit",borderRadius:"$sm",outline:"none",userSelect:"none",cursor:"pointer",$inputStyle:"",$hover:"",$focusWithin:"",$active:"$accent1 $elevation1",variants:{isDragAccept:{true:{$inputStyle:"$accent1",backgroundColor:"$elevation1"}}}}),$we=wt("div",{boxSizing:"border-box",borderRadius:"$sm",height:"$rowHeight",width:"$rowHeight",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center",variants:{hasImage:{true:{cursor:"pointer",$hover:"",$active:""}}}}),exe=wt("div",{$flexCenter:"",width:"$imagePreviewWidth",height:"$imagePreviewHeight",borderRadius:"$sm",boxShadow:"$level2",pointerEvents:"none",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center"}),txe=wt("div",{fontSize:"0.8em",height:"100%",padding:"$rowGap $md"}),nxe=wt("div",{$flexCenter:"",top:"0",right:"0",marginRight:"$sm",height:"100%",cursor:"pointer",variants:{disabled:{true:{color:"$elevation3",cursor:"default"}}},"&::after,&::before":{content:'""',position:"absolute",height:2,width:10,borderRadius:1,backgroundColor:"currentColor"},"&::after":{transform:"rotate(45deg)"},"&::before":{transform:"rotate(-45deg)"}});function ixe(){const{label:n,value:e,onUpdate:t,disabled:i}=ps(),{popinRef:r,wrapperRef:s,shown:o,show:a,hide:l}=t6(),c=M.useCallback(f=>{f.length&&t(f[0])},[t]),g=M.useCallback(f=>{f.stopPropagation(),t(void 0)},[t]),{getRootProps:u,getInputProps:d,isDragAccept:h}=q7({maxFiles:1,accept:"image/*",onDrop:c,disabled:i});return L.createElement(Pa,{input:!0},L.createElement(Fl,null,n),L.createElement(jwe,null,L.createElement($we,{ref:r,hasImage:!!e,onPointerDown:()=>!!e&&a(),onPointerUp:l,style:{backgroundImage:e?`url(${e})`:"none"}}),o&&!!e&&L.createElement(yT,null,L.createElement(w7,{onPointerUp:l,style:{cursor:"pointer"}}),L.createElement(exe,{ref:s,style:{backgroundImage:`url(${e})`}})),L.createElement(qwe,u({isDragAccept:h}),L.createElement("input",d()),L.createElement(txe,null,h?"drop image":"click or drop")),L.createElement(nxe,{onClick:g,disabled:!e})))}var rxe=Vt({component:ixe},Jwe);const OY=Io().number(),sxe=(n,e)=>Io().array().length(2).every.number().test(n)&&Io().schema({min:OY,max:OY}).test(e),Y2=n=>({min:n[0],max:n[1]}),s6=(n,{bounds:[e,t]},i)=>{const r=Array.isArray(n)?Y2(n):n,s={min:i[0],max:i[1]},{min:o,max:a}=Vt(Vt({},s),r);return[Bd(Number(o),e,Math.max(e,a)),Bd(Number(a),Math.min(t,o),t)]},oxe=({value:n,min:e,max:t})=>{const i={min:e,max:t},r=W7(Y2(n),{min:i,max:i}),s=[e,t],o=Vt(Vt({},r),{},{bounds:s});return{value:s6(Y2(n),o,n),settings:o}};var axe=Object.freeze({__proto__:null,schema:sxe,format:Y2,sanitize:s6,normalize:oxe});const lxe=["value","bounds","onDrag"],cxe=["bounds"],gxe=wt("div",{display:"grid",columnGap:"$colGap",gridTemplateColumns:"auto calc($sizes$numberInputMinWidth * 2 + $space$rowGap)"});function uxe(n){let{value:e,bounds:[t,i],onDrag:r}=n,s=Kn(n,lxe);const o=M.useRef(null),a=M.useRef(null),l=M.useRef(null),c=M.useRef(0),g=Vg("sizes","scrubberWidth"),u=Vv(({event:f,first:I,xy:[A],movement:[p],memo:y={}})=>{if(I){const{width:b,left:w}=o.current.getBoundingClientRect();c.current=b-parseFloat(g);const G=(f==null?void 0:f.target)===a.current||(f==null?void 0:f.target)===l.current;y.pos=k2((A-w)/b,t,i);const x=Math.abs(y.pos-e.min)-Math.abs(y.pos-e.max);y.key=x<0||x===0&&y.pos<=e.min?"min":"max",G&&(y.pos=e[y.key])}const v=y.pos+k2(p/c.current,0,i-t);return r({[y.key]:DGe(v,s[y.key])}),y}),d=`calc(${N2(e.min,t,i)} * (100% - ${g} - 8px) + 4px)`,h=`calc(${1-N2(e.max,t,i)} * (100% - ${g} - 8px) + 4px)`;return L.createElement(Z7,Ui({ref:o},u()),L.createElement(R7,null,L.createElement(M7,{style:{left:d,right:h}})),L.createElement(_W,{position:"left",ref:a,style:{left:d}}),L.createElement(_W,{position:"right",ref:l,style:{right:h}}))}function dxe(){const{label:n,displayValue:e,onUpdate:t,settings:i}=ps(),r=Kn(i,cxe);return L.createElement(L.Fragment,null,L.createElement(Pa,{input:!0},L.createElement(Fl,null,n),L.createElement(gxe,null,L.createElement(uxe,Ui({value:e},i,{onDrag:t})),L.createElement(bT,{value:e,settings:r,onUpdate:t,innerLabelTrim:0}))))}var hxe=Vt({component:dxe},axe);const fxe=()=>{const n=new Map;return{on:(e,t)=>{let i=n.get(e);i===void 0&&(i=new Set,n.set(e,i)),i.add(t)},off:(e,t)=>{const i=n.get(e);i!==void 0&&(i.delete(t),i.size===0&&n.delete(e))},emit:(e,...t)=>{const i=n.get(e);if(i!==void 0)for(const r of i)r(...t)}}},Ixe=["type","value"],Axe=["onChange","transient","onEditStart","onEditEnd"],Cxe=function(){const e=HC(cIe(()=>({data:{}}))),t=fxe();this.storeId=rGe(),this.useStore=e;const i={},r=new Set;this.getVisiblePaths=()=>{const o=this.getData(),a=Object.keys(o),l=[];Object.entries(i).forEach(([g,u])=>{u.render&&a.some(d=>d.indexOf(g)===0)&&!u.render(this.get)&&l.push(g+".")});const c=[];return r.forEach(g=>{g in o&&o[g].__refCount>0&&l.every(u=>g.indexOf(u)===-1)&&(!o[g].render||o[g].render(this.get))&&c.push(g)}),c},this.setOrderedPaths=o=>{o.forEach(a=>r.add(a))},this.orderPaths=o=>(this.setOrderedPaths(o),o),this.disposePaths=o=>{e.setState(a=>{const l=a.data;return o.forEach(c=>{if(c in l){const g=l[c];g.__refCount--,g.__refCount===0&&g.type in Bc&&delete l[c]}}),{data:l}})},this.dispose=()=>{e.setState(()=>({data:{}}))},this.getFolderSettings=o=>i[o]||{},this.getData=()=>e.getState().data,this.addData=(o,a)=>{e.setState(l=>{const c=l.data;return Object.entries(o).forEach(([g,u])=>{let d=c[g];if(d){const{type:h,value:f}=u,I=Kn(u,Ixe);h!==d.type?Gg(gi.INPUT_TYPE_OVERRIDE,h):((d.__refCount===0||a)&&Object.assign(d,I),d.__refCount++)}else c[g]=Vt(Vt({},u),{},{__refCount:1})}),{data:c}})},this.setValueAtPath=(o,a,l)=>{e.setState(c=>{const g=c.data;return mY(g[o],a,o,this,l),{data:g}})},this.setSettingsAtPath=(o,a)=>{e.setState(l=>{const c=l.data;return c[o].settings=Vt(Vt({},c[o].settings),a),{data:c}})},this.disableInputAtPath=(o,a)=>{e.setState(l=>{const c=l.data;return c[o].disabled=a,{data:c}})},this.set=(o,a)=>{e.setState(l=>{const c=l.data;return Object.entries(o).forEach(([g,u])=>{try{mY(c[g],u,void 0,void 0,a)}catch{}}),{data:c}})},this.getInput=o=>{try{return this.getData()[o]}catch{Gg(gi.PATH_DOESNT_EXIST,o)}},this.get=o=>{var a;return(a=this.getInput(o))===null||a===void 0?void 0:a.value},this.emitOnEditStart=o=>{t.emit(`onEditStart:${o}`,this.get(o),o,Vt(Vt({},this.getInput(o)),{},{get:this.get}))},this.emitOnEditEnd=o=>{t.emit(`onEditEnd:${o}`,this.get(o),o,Vt(Vt({},this.getInput(o)),{},{get:this.get}))},this.subscribeToEditStart=(o,a)=>{const l=`onEditStart:${o}`;return t.on(l,a),()=>t.off(l,a)},this.subscribeToEditEnd=(o,a)=>{const l=`onEditEnd:${o}`;return t.on(l,a),()=>t.off(l,a)};const s=(o,a,l)=>{const c={};return Object.entries(o).forEach(([g,u])=>{if(g==="")return Gg(gi.EMPTY_KEY);let d=ZT(a,g);if(u.type===Bc.FOLDER){const h=s(u.schema,d,l);Object.assign(c,h),d in i||(i[d]=u.settings)}else if(g in l)Gg(gi.DUPLICATE_KEYS,g,d,l[g].path);else{const h=uGe(u,g,d,c);if(h){const{type:f,options:I,input:A}=h,{onChange:p,transient:y,onEditStart:v,onEditEnd:b}=I,w=Kn(I,Axe);c[d]=Vt(Vt(Vt({type:f},w),A),{},{fromPanel:!0}),l[g]={path:d,onChange:p,transient:y,onEditStart:v,onEditEnd:b}}else Gg(gi.UNKNOWN_INPUT,d,u)}}),c};this.getDataFromSchema=o=>{const a={};return[s(o,"",a),a]}};new Cxe;const JY=n=>"__levaInput"in n,pxe=(n,e)=>{const t={},i=e?e.toLowerCase():null;return n.forEach(r=>{const[s,o]=Bwe(r);(!i||s.toLowerCase().indexOf(i)>-1)&&bwe(t,o,{[s]:{__levaInput:!0,path:r}})}),t},mxe=["type","label","path","valueKey","value","settings","setValue","disabled"];function yxe(n){let{type:e,label:t,path:i,valueKey:r,value:s,settings:o,setValue:a,disabled:l}=n,c=Kn(n,mxe);const{displayValue:g,onChange:u,onUpdate:d}=x7({type:e,value:s,settings:o,setValue:a}),h=vf[e].component;return h?L.createElement(A7.Provider,{value:Vt({key:r,path:i,id:""+i,label:t,displayValue:g,value:s,onChange:u,onUpdate:d,settings:o,setValue:a,disabled:l},c)},L.createElement(ZGe,{disabled:l},L.createElement(h,null))):(Gg(gi.NO_COMPONENT_FOR_TYPE,e,i),null)}const vxe=wt("button",{display:"block",$reset:"",fontWeight:"$button",height:"$rowHeight",borderStyle:"none",borderRadius:"$sm",backgroundColor:"$elevation1",color:"$highlight1","&:not(:disabled)":{color:"$highlight3",backgroundColor:"$accent2",cursor:"pointer",$hover:"$accent3",$active:"$accent3 $accent1",$focus:""}});function bxe({onClick:n,settings:e,label:t}){const i=_v();return L.createElement(Pa,null,L.createElement(vxe,{disabled:e.disabled,onClick:()=>n(i.get)},t))}const Bxe=wt("div",{$flex:"",justifyContent:"flex-end",gap:"$colGap"}),Gxe=wt("button",{$reset:"",cursor:"pointer",borderRadius:"$xs","&:hover":{backgroundColor:"$elevation3"}}),wxe=({label:n,opts:e})=>{let t=typeof n=="string"&&n.trim()===""?null:n,i=e;return typeof e.opts=="object"&&(i.label!==void 0&&(t=e.label),i=e.opts),{label:t,opts:i}};function xxe(n){const{label:e,opts:t}=wxe(n),i=_v();return L.createElement(Pa,{input:!!e},e&&L.createElement(Fl,null,e),L.createElement(Bxe,null,Object.entries(t).map(([r,s])=>L.createElement(Gxe,{key:r,onClick:()=>s(i.get)},r))))}const Sxe=wt("canvas",{height:"$monitorHeight",width:"100%",display:"block",borderRadius:"$sm"}),o6=100;function Rxe(n,e){n.push(e),n.length>o6&&n.shift()}const Zxe=M.forwardRef(function({initialValue:n},e){const t=Vg("colors","highlight3"),i=Vg("colors","elevation2"),r=Vg("colors","highlight1"),[s,o]=M.useMemo(()=>[Ws(r).alpha(.4).toRgbString(),Ws(r).alpha(.1).toRgbString()],[r]),a=M.useRef([n]),l=M.useRef(n),c=M.useRef(n),g=M.useRef(),u=M.useCallback((f,I)=>{if(!f)return;const{width:A,height:p}=f,y=new Path2D,v=A/o6,b=p*.05;for(let x=0;x<a.current.length;x++){const B=N2(a.current[x],l.current,c.current),R=v*x,Z=p-B*(p-b*2)-b;y.lineTo(R,Z)}I.clearRect(0,0,A,p);const w=new Path2D(y);w.lineTo(v*(a.current.length+1),p),w.lineTo(0,p),w.lineTo(0,0);const G=I.createLinearGradient(0,0,0,p);G.addColorStop(0,s),G.addColorStop(1,o),I.fillStyle=G,I.fill(w),I.strokeStyle=i,I.lineJoin="round",I.lineWidth=14,I.stroke(y),I.strokeStyle=t,I.lineWidth=2,I.stroke(y)},[t,i,s,o]),[d,h]=kGe(u);return M.useImperativeHandle(e,()=>({frame:f=>{(l.current===void 0||f<l.current)&&(l.current=f),(c.current===void 0||f>c.current)&&(c.current=f),Rxe(a.current,f),g.current=requestAnimationFrame(()=>u(d.current,h.current))}}),[d,h,u]),M.useEffect(()=>()=>cancelAnimationFrame(g.current),[]),L.createElement(Sxe,{ref:d})}),jY=n=>Number.isFinite(n)?n.toPrecision(2):n.toString(),Mxe=M.forwardRef(function({initialValue:n},e){const[t,i]=M.useState(jY(n));return M.useImperativeHandle(e,()=>({frame:r=>i(jY(r))}),[]),L.createElement("div",null,t)});function qY(n){return typeof n=="function"?n():n.current}function Exe({label:n,objectOrFn:e,settings:t}){const i=M.useRef(),r=M.useRef(qY(e));return M.useEffect(()=>{const s=window.setInterval(()=>{var o;document.hidden||(o=i.current)===null||o===void 0||o.frame(qY(e))},t.interval);return()=>window.clearInterval(s)},[e,t.interval]),L.createElement(Pa,{input:!0},L.createElement(Fl,{align:"top"},n),t.graph?L.createElement(Zxe,{ref:i,initialValue:r.current}):L.createElement(Mxe,{ref:i,initialValue:r.current}))}const Wxe=["type","label","key"],Fxe={[Bc.BUTTON]:bxe,[Bc.BUTTON_GROUP]:xxe,[Bc.MONITOR]:Exe},_xe=L.memo(({path:n})=>{const[e,{set:t,setSettings:i,disable:r,storeId:s,emitOnEditStart:o,emitOnEditEnd:a}]=HGe(n);if(!e)return null;const{type:l,label:c,key:g}=e,u=Kn(e,Wxe);if(l in Bc){const d=Fxe[l];return L.createElement(d,Ui({label:c,path:n},u))}return l in vf?L.createElement(yxe,Ui({key:s+n,type:l,label:c,storeId:s,path:n,valueKey:g,setValue:t,setSettings:i,disable:r,emitOnEditStart:o,emitOnEditEnd:a},u)):(JBe(gi.UNSUPPORTED_INPUT,l,n),null)});function Vxe({toggle:n,toggled:e,name:t}){return L.createElement(xGe,{onClick:()=>n()},L.createElement(vT,{toggled:e}),L.createElement("div",null,t))}const Txe=({name:n,path:e,tree:t})=>{const i=_v(),r=ZT(e,n),{collapsed:s,color:o}=i.getFolderSettings(r),[a,l]=M.useState(!s),c=M.useRef(null),g=Vg("colors","folderWidgetColor"),u=Vg("colors","folderTextColor");return M.useLayoutEffect(()=>{c.current.style.setProperty("--leva-colors-folderWidgetColor",o||g),c.current.style.setProperty("--leva-colors-folderTextColor",o||u)},[o,g,u]),L.createElement(L2,{ref:c},L.createElement(Vxe,{name:n,toggled:a,toggle:()=>l(d=>!d)}),L.createElement(a6,{parent:r,tree:t,toggled:a}))},a6=L.memo(({isRoot:n=!1,fill:e=!1,flat:t=!1,parent:i,tree:r,toggled:s})=>{const{wrapperRef:o,contentRef:a}=Gwe(s),l=_v(),c=([u,d])=>{var h;return(JY(d)?(h=l.getInput(d.path))===null||h===void 0?void 0:h.order:l.getFolderSettings(ZT(i,u)).order)||0},g=Object.entries(r).sort((u,d)=>c(u)-c(d));return L.createElement(WW,{ref:o,isRoot:n,fill:e,flat:t},L.createElement(b7,{ref:a,isRoot:n,toggled:s},g.map(([u,d])=>JY(d)?L.createElement(_xe,{key:d.path,valueKey:d.valueKey,path:d.path}):L.createElement(Txe,{key:u,name:u,path:i,tree:d}))))}),Nxe=wt("div",{position:"relative",fontFamily:"$mono",fontSize:"$root",color:"$rootText",backgroundColor:"$elevation1",variants:{fill:{false:{position:"fixed",top:"10px",right:"10px",zIndex:1e3,width:"$rootWidth"},true:{position:"relative",width:"100%"}},flat:{false:{borderRadius:"$lg",boxShadow:"$level1"}},oneLineLabels:{true:{[`${G7}`]:{gridTemplateColumns:"auto",gridAutoColumns:"minmax(max-content, 1fr)",gridAutoRows:"minmax($sizes$rowHeight), auto)",rowGap:0,columnGap:0,marginTop:"$rowGap"}}},hideTitleBar:{true:{$$titleBarHeight:"0px"},false:{$$titleBarHeight:"$sizes$titleBarHeight"}}},"&,*,*:after,*:before":{boxSizing:"border-box"},"*::selection":{backgroundColor:"$accent2"}}),l6=40,K2=wt("i",{$flexCenter:"",width:l6,userSelect:"none",cursor:"pointer","> svg":{fill:"$highlight1",transition:"transform 350ms ease, fill 250ms ease"},"&:hover > svg":{fill:"$highlight3"},variants:{active:{true:{"> svg":{fill:"$highlight2"}}}}}),kxe=wt("div",{display:"flex",alignItems:"stretch",justifyContent:"space-between",height:"$titleBarHeight",variants:{mode:{drag:{cursor:"grab"}}}}),Lxe=wt("div",{$flex:"",position:"relative",width:"100%",overflow:"hidden",transition:"height 250ms ease",color:"$highlight3",paddingLeft:"$md",[`> ${K2}`]:{height:30},variants:{toggled:{true:{height:30},false:{height:0}}}}),Hxe=wt("input",{$reset:"",flex:1,position:"relative",height:30,width:"100%",backgroundColor:"transparent",fontSize:"10px",borderRadius:"$root","&:focus":{},"&::placeholder":{color:"$highlight2"}}),zxe=wt("div",{touchAction:"none",$flexCenter:"",flex:1,"> svg":{fill:"$highlight1"},color:"$highlight1",variants:{drag:{true:{$draggable:"","> svg":{transition:"fill 250ms ease"},"&:hover":{color:"$highlight3"},"&:hover > svg":{fill:"$highlight3"}}},filterEnabled:{false:{paddingRight:l6}}}}),Xxe=L.forwardRef(({setFilter:n,toggle:e},t)=>{const[i,r]=M.useState(""),s=M.useMemo(()=>g7(n,250),[n]),o=()=>{n(""),r("")},a=l=>{const c=l.currentTarget.value;e(!0),r(c)};return M.useEffect(()=>{s(i)},[i,s]),L.createElement(L.Fragment,null,L.createElement(Hxe,{ref:t,value:i,placeholder:"[Open filter with CMD+SHIFT+L]",onPointerDown:l=>l.stopPropagation(),onChange:a}),L.createElement(K2,{onClick:()=>o(),style:{visibility:i?"visible":"hidden"}},L.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"14",width:"14",viewBox:"0 0 20 20",fill:"currentColor"},L.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"}))))});function Yxe({setFilter:n,onDrag:e,onDragStart:t,onDragEnd:i,toggle:r,toggled:s,title:o,drag:a,filterEnabled:l,from:c}){const[g,u]=M.useState(!1),d=M.useRef(null);M.useEffect(()=>{var f,I;g?(f=d.current)===null||f===void 0||f.focus():(I=d.current)===null||I===void 0||I.blur()},[g]);const h=Vv(({offset:[f,I],first:A,last:p})=>{e({x:f,y:I}),A&&t({x:f,y:I}),p&&i({x:f,y:I})},{filterTaps:!0,from:({offset:[f,I]})=>[(c==null?void 0:c.x)||f,(c==null?void 0:c.y)||I]});return M.useEffect(()=>{const f=I=>{I.key==="L"&&I.shiftKey&&I.metaKey&&u(A=>!A)};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[]),L.createElement(L.Fragment,null,L.createElement(kxe,{mode:a?"drag":void 0},L.createElement(K2,{active:!s,onClick:()=>r()},L.createElement(vT,{toggled:s,width:12,height:8})),L.createElement(zxe,Ui({},a?h():{},{drag:a,filterEnabled:l}),o===void 0&&a?L.createElement("svg",{width:"20",height:"10",viewBox:"0 0 28 14",xmlns:"http://www.w3.org/2000/svg"},L.createElement("circle",{cx:"2",cy:"2",r:"2"}),L.createElement("circle",{cx:"14",cy:"2",r:"2"}),L.createElement("circle",{cx:"26",cy:"2",r:"2"}),L.createElement("circle",{cx:"2",cy:"12",r:"2"}),L.createElement("circle",{cx:"14",cy:"12",r:"2"}),L.createElement("circle",{cx:"26",cy:"12",r:"2"})):o),l&&L.createElement(K2,{active:g,onClick:()=>u(f=>!f)},L.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"20",viewBox:"0 0 20 20"},L.createElement("path",{d:"M9 9a2 2 0 114 0 2 2 0 01-4 0z"}),L.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a4 4 0 00-3.446 6.032l-2.261 2.26a1 1 0 101.414 1.415l2.261-2.261A4 4 0 1011 5z",clipRule:"evenodd"})))),L.createElement(Lxe,{toggled:g},L.createElement(Xxe,{ref:d,setFilter:n,toggle:r})))}L.memo(({store:n,rootClass:e,fill:t=!1,flat:i=!1,neverHide:r=!1,oneLineLabels:s=!1,titleBar:o={title:void 0,drag:!0,filter:!0,position:void 0,onDrag:void 0,onDragStart:void 0,onDragEnd:void 0},hideCopyButton:a=!1,toggled:l,setToggle:c})=>{var g,u;const d=wwe(n),[h,f]=M.useState(""),I=M.useMemo(()=>pxe(d,h),[d,h]),[A,p]=S7(),y=r||d.length>0,v=typeof o=="object"&&o.title||void 0,b=typeof o=="object"&&(g=o.drag)!==null&&g!==void 0?g:!0,w=typeof o=="object"&&(u=o.filter)!==null&&u!==void 0?u:!0,G=typeof o=="object"&&o.position||void 0,x=typeof o=="object"&&o.onDrag||void 0,B=typeof o=="object"&&o.onDragStart||void 0,R=typeof o=="object"&&o.onDragEnd||void 0;return L.useEffect(()=>{p({x:G==null?void 0:G.x,y:G==null?void 0:G.y})},[G,p]),yGe(),L.createElement(m7.Provider,{value:{hideCopyButton:a}},L.createElement(Nxe,{ref:A,className:e,fill:t,flat:i,oneLineLabels:s,hideTitleBar:!o,style:{display:y?"block":"none"}},o&&L.createElement(Yxe,{onDrag:Z=>{p(Z),x==null||x(Z)},onDragStart:Z=>B==null?void 0:B(Z),onDragEnd:Z=>R==null?void 0:R(Z),setFilter:f,toggle:Z=>c(W=>Z??!W),toggled:l,title:v,drag:b,filterEnabled:w,from:G}),y&&L.createElement(p7.Provider,{value:n},L.createElement(a6,{isRoot:!0,fill:t,flat:i,tree:I,toggled:l}))))});$g(Rl.SELECT,i1e);$g(Rl.IMAGE,rxe);$g(Rl.NUMBER,UGe);$g(Rl.COLOR,Twe);$g(Rl.STRING,d1e);$g(Rl.BOOLEAN,m1e);$g(Rl.INTERVAL,hxe);$g(Rl.VECTOR3D,kwe);$g(Rl.VECTOR2D,Pwe);function $Y(n){return typeof n=="string"?new Ke(n).convertLinearToSRGB():n}function Kxe(n){switch(n){case"alpha":return{min:0,max:1};case"scale":return{min:0};case"map":return{image:void 0};default:return{}}}function Dxe({color:n,alpha:e,lighting:t,name:i,...r}={}){return[{color:n,alpha:e,lighting:t,name:i},r]}function c6(n){return n instanceof D||n instanceof pe||n instanceof Lt||n instanceof Ir||n instanceof qe}function eK(n){return c6(n)?n.toArray():n instanceof Ke?"#"+n.clone().convertLinearToSRGB().getHexString():n instanceof Pn?n.image.src:n}const Pxe={normal:"normal",add:"add",subtract:"subtract",multiply:"multiply",lighten:"lighten",darken:"darken",divide:"divide",overlay:"overlay",screen:"screen",softlight:"softlight",negation:"negation",reflect:"reflect"},g6={perlin:"perlin",simplex:"simplex",cell:"cell",curl:"curl",white:"white"},MT={local:"local",world:"world",uv:"uv"},Uxe={phong:tV,physical:Vc,toon:nV,basic:os,lambert:rV,standard:Sf};class eu{constructor(e,t,i){this.uuid=ss.generateUUID().replace(/-/g,"_"),this.name="LayerMaterial",this.mode="normal",this.visible=!0;const s=Object.getOwnPropertyNames(e).filter(a=>a.startsWith("u_")).reduce((a,l)=>{var c;let g=(c=Object.getOwnPropertyDescriptor(e,l))==null?void 0:c.value;return(c6(g)||g instanceof Ke)&&(g=g.clone()),{...a,[l.slice(1)]:g}},{});for(const a in s){const l=a.split("_")[1];(t==null?void 0:t[l])!==void 0&&(s[a]=t[l])}t&&Object.keys(t).map(a=>{t[a]!==void 0&&(this[a]=t[a])}),this.uniforms={},this.schema=[];const o={};Object.keys(s).map(a=>{const l=a.split("_")[1];this.uniforms[`u_${this.uuid}_${l}`]={value:$Y(s[a])},this.schema.push({value:s[a],label:l}),o[l]={set:c=>{this.uniforms[`u_${this.uuid}_${l}`].value=$Y(c)},get:()=>this.uniforms[`u_${this.uuid}_${l}`].value}}),t!=null&&t.name&&(this.name=t.name),t!=null&&t.mode&&(this.mode=t.mode),t!=null&&t.visible&&(this.visible=t.visible),Object.defineProperties(this,o),this.vertexShader="",this.fragmentShader="",this.vertexVariables="",this.fragmentVariables="",this.onParse=i,this.buildShaders(e),this.schema.push({value:this.mode,label:"mode",options:Object.values(Pxe)}),this.schema.push({value:this.visible,label:"visible"})}buildShaders(e){var t;const i=Object.getOwnPropertyNames(e).filter(g=>g==="fragmentShader"||g==="vertexShader").reduce((g,u)=>{var d;return{...g,[u]:(d=Object.getOwnPropertyDescriptor(e,u))==null?void 0:d.value}},{}),r={vert:GW(i.vertexShader||""),frag:GW(i.fragmentShader||"")},s={vert:KX(r.vert,this.renameTokens.bind(this)),frag:KX(r.frag,this.renameTokens.bind(this))},o={vert:wW(s.vert),frag:wW(s.frag)},a={vert:o.vert.map(g=>g.name).indexOf("main"),frag:o.frag.map(g=>g.name).indexOf("main")},l={vert:a.vert>=0?z0(s.vert.slice(0,o.vert[a.vert].outer[0])):"",frag:a.frag>=0?z0(s.frag.slice(0,o.frag[a.frag].outer[0])):""},c={vert:a.vert>=0?this.getShaderFromIndex(s.vert,o.vert[a.vert].body):"",frag:a.frag>=0?this.getShaderFromIndex(s.frag,o.frag[a.frag].body):""};this.vertexShader=this.processFinal(c.vert,!0),this.fragmentShader=this.processFinal(c.frag),this.vertexVariables=l.vert,this.fragmentVariables=l.frag,(t=this.onParse)==null||t.call(this,this),this.schema=this.schema.filter((g,u)=>{const d=g.label;return u===this.schema.findIndex(h=>h.label===d)})}renameTokens(e){if(e.startsWith("u_")){const t=e.slice(2);return`u_${this.uuid}_${t}`}else if(e.startsWith("v_")){const t=e.slice(2);return`v_${this.uuid}_${t}`}else if(e.startsWith("f_")){const t=e.slice(2);return`f_${this.uuid}_${t}`}else return e}processFinal(e,t){const i=e.replace(/\sf_/gm,` f_${this.uuid}_`).replace(/\(f_/gm,`(f_${this.uuid}_`),r=i.match(/^.*return.*$/gm);let s=i.replace(/^.*return.*$/gm,"");if(r!=null&&r[0]){const o=r[0].replace("return","").trim().replace(";",""),a=this.getBlendMode(o,"lamina_finalColor");s+=t?`lamina_finalPosition = ${o};`:`lamina_finalColor = ${a};`}return s}getShaderFromIndex(e,t){return z0(e.slice(t[0],t[1]))}getBlendMode(e,t){switch(this.mode){default:case"normal":return`lamina_blend_alpha(${t}, ${e}, ${e}.a)`;case"add":return`lamina_blend_add(${t}, ${e}, ${e}.a)`;case"subtract":return`lamina_blend_subtract(${t}, ${e}, ${e}.a)`;case"multiply":return`lamina_blend_multiply(${t}, ${e}, ${e}.a)`;case"lighten":return`lamina_blend_lighten(${t}, ${e}, ${e}.a)`;case"darken":return`lamina_blend_darken(${t}, ${e}, ${e}.a)`;case"divide":return`lamina_blend_divide(${t}, ${e}, ${e}.a)`;case"overlay":return`lamina_blend_overlay(${t}, ${e}, ${e}.a)`;case"screen":return`lamina_blend_screen(${t}, ${e}, ${e}.a)`;case"softlight":return`lamina_blend_softlight(${t}, ${e}, ${e}.a)`;case"reflect":return`lamina_blend_reflect(${t}, ${e}, ${e}.a)`;case"negation":return`lamina_blend_negation(${t}, ${e}, ${e}.a)`}}getSchema(){return this.schema.map(({label:t,options:i,...r})=>({label:t,options:i,...Kxe(t),...r,value:eK(this[t])}))}serialize(){const e=this.constructor.name.split("$")[0];let t=Object.keys(this);t=t.filter(s=>!["uuid","uniforms","schema","fragmentShader","vertexShader","fragmentVariables","vertexVariables","attribs","events","__r3f","onParse"].includes(s));const i={};t.forEach(s=>{i[s]=this[s]});const r={};for(const s in this.uniforms){const o=s.replace(`u_${this.uuid}_`,"");r[o]=eK(this.uniforms[s].value)}return{constructor:e,properties:{...r,...i}}}}class Ya extends eu{constructor(e){super(Ya,{name:"Depth",...e},t=>{t.schema.push({value:t.mapping,label:"mapping",options:["vector","world","camera"]});const i=Ya.getMapping(t.uuid,t.mapping);t.fragmentShader=t.fragmentShader.replace("lamina_mapping_template",i)}),this.mapping="vector"}static getMapping(e,t){switch(t){default:case"vector":return`length(v_${e}_worldPosition - u_${e}_origin)`;case"world":return`length(v_${e}_position - vec3(0.))`;case"camera":return`length(v_${e}_worldPosition - cameraPosition)`}}}Ya.u_near=2;Ya.u_far=10;Ya.u_origin=new D(0,0,0);Ya.u_colorA="white";Ya.u_colorB="black";Ya.u_alpha=1;Ya.vertexShader=`
  varying vec3 v_worldPosition;
  varying vec3 v_position;

  void main() {
    v_worldPosition = (vec4(position, 1.0) * modelMatrix).xyz;
    v_position = position;
  }
  `;Ya.fragmentShader=`   
    uniform float u_alpha;
    uniform float u_near;
    uniform float u_far;
    uniform float u_isVector;
    uniform vec3 u_origin;
    uniform vec3 u_colorA;
    uniform vec3 u_colorB;

    varying vec3 v_worldPosition;
    varying vec3 v_position;

    void main() {
      float f_dist = lamina_mapping_template;
      float f_depth = (f_dist - u_near) / (u_far - u_near);
			vec3 f_depthColor =  mix(u_colorB, u_colorA, 1.0 - clamp(f_depth, 0., 1.));
  
  
      return vec4(f_depthColor, u_alpha);
    }
  `;class qC extends eu{constructor(e){super(qC,{name:"Color",...e})}}qC.u_color="red";qC.u_alpha=1;qC.fragmentShader=`   
    uniform vec3 u_color;
    uniform float u_alpha;

    void main() {
      return vec4(u_color, u_alpha);
    }
  `;class bo extends eu{constructor(e){super(bo,{name:"noise",...e},t=>{t.schema.push({value:t.type,label:"type",options:Object.values(g6)}),t.schema.push({value:t.mapping,label:"mapping",options:Object.values(MT)});const i=bo.getNoiseFunction(t.type),r=bo.getMapping(t.mapping);t.vertexShader=t.vertexShader.replace("lamina_mapping_template",r),t.fragmentShader=t.fragmentShader.replace("lamina_noise_template",i)}),this.type="perlin",this.mapping="local"}static getNoiseFunction(e){switch(e){default:case"perlin":return"lamina_noise_perlin";case"simplex":return"lamina_noise_simplex";case"cell":return"lamina_noise_worley";case"white":return"lamina_noise_white";case"curl":return"lamina_noise_swirl"}}static getMapping(e){switch(e){default:case"local":return"position";case"world":return"(modelMatrix * vec4(position,1.0)).xyz";case"uv":return"vec3(uv, 0.)"}}}bo.u_colorA="#666666";bo.u_colorB="#666666";bo.u_colorC="#FFFFFF";bo.u_colorD="#FFFFFF";bo.u_alpha=1;bo.u_scale=1;bo.u_offset=new D(0,0,0);bo.vertexShader=`
    varying vec3 v_position;

    void main() {
        v_position = lamina_mapping_template;
    }
  `;bo.fragmentShader=`   
    uniform vec3 u_colorA;
    uniform vec3 u_colorB;
    uniform vec3 u_colorC;
    uniform vec3 u_colorD;
    uniform vec3 u_offset;

    uniform float u_alpha;
    uniform float u_scale;

    varying vec3 v_position;


    void main() {
        float f_n = lamina_noise_template((v_position + u_offset) * u_scale);

        float f_step1 = 0.;
        float f_step2 = 0.2;
        float f_step3 = 0.6;
        float f_step4 = 1.;

        vec3 f_color = mix(u_colorA, u_colorB, smoothstep(f_step1, f_step2, f_n));
        f_color = mix(f_color, u_colorC, smoothstep(f_step2, f_step3, f_n));
        f_color = mix(f_color, u_colorD, smoothstep(f_step3, f_step4, f_n));

        return vec4(f_color, u_alpha);
    }
  `;class _l extends eu{constructor(e){super(_l,{name:"Fresnel",...e})}}_l.u_color="white";_l.u_alpha=1;_l.u_bias=0;_l.u_intensity=1;_l.u_power=2;_l.u_factor=1;_l.vertexShader=`
    varying vec3 v_worldPosition;
    varying vec3 v_worldNormal;

    void main() {
        v_worldPosition = vec3(-viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2]);
        v_worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );
        
    }
  `;_l.fragmentShader=`   
    uniform vec3 u_color;
    uniform float u_alpha;
    uniform float u_bias;
    uniform float u_intensity;
    uniform float u_power;
    uniform float u_factor;

    varying vec3 v_worldPosition;
    varying vec3 v_worldNormal;

    void main() {
        float f_a = (u_factor  + dot(v_worldPosition, v_worldNormal));
        float f_fresnel = u_bias + u_intensity * pow(abs(f_a), u_power);

        f_fresnel = clamp(f_fresnel, 0.0, 1.0);
        return vec4(f_fresnel * u_color, u_alpha);
    }
  `;class Ka extends eu{constructor(e){super(Ka,{name:"Gradient",...e},t=>{t.schema.push({value:t.axes,label:"axes",options:["x","y","z"]}),t.schema.push({value:t.mapping,label:"mapping",options:Object.values(MT)});const i=Ka.getMapping(t.mapping);t.vertexShader=t.vertexShader.replace("lamina_mapping_template",i||"local"),t.fragmentShader=t.fragmentShader.replace("axes_template",t.axes||"x")}),this.axes="x",this.mapping="local"}static getMapping(e){switch(e){default:case"local":return"position";case"world":return"(modelMatrix * vec4(position,1.0)).xyz";case"uv":return"vec3(uv, 0.)"}}}Ka.u_colorA="white";Ka.u_colorB="black";Ka.u_alpha=1;Ka.u_start=1;Ka.u_end=-1;Ka.u_contrast=1;Ka.vertexShader=`
		varying vec3 v_position;

		vod main() {
      v_position = lamina_mapping_template;
		}
  `;Ka.fragmentShader=`   
    uniform vec3 u_colorA;
    uniform vec3 u_colorB;
    uniform vec3 u_axis;
    uniform float u_alpha;
    uniform float u_start;
    uniform float u_end;
    uniform float u_contrast;

		varying vec3 v_position;

    void main() {

      float f_step = smoothstep(u_start, u_end, v_position.axes_template * u_contrast);
      vec3 f_color = mix(u_colorA, u_colorB, f_step);

      return vec4(f_color, u_alpha);
    }
  `;class _f extends eu{constructor(e){super(_f,{name:"Matcap",...e})}}_f.u_alpha=1;_f.u_map=void 0;_f.vertexShader=`
    varying vec3 v_position;
    varying vec3 v_normal;
    
    void main() {
      v_position = normalize( vec3( modelViewMatrix * vec4( position, 1.0 ) ) );
      v_normal = normalize( normalMatrix * normal );
    }
    `;_f.fragmentShader=` 
		uniform sampler2D u_map;  
		uniform float u_alpha;  
		varying vec3 v_position;
		varying vec3 v_normal;

		
    void main() {
			vec3 f_r = reflect( v_position, v_normal );
			float f_m = 2. * sqrt( pow( f_r.x, 2. ) + pow( f_r.y, 2. ) + pow( f_r.z + 1., 2. ) );
			vec2 f_vN = f_r.xy / f_m + .5;

			vec3 f_base = texture2D(u_map, f_vN).rgb;

      return vec4(f_base, u_alpha);
    }
  `;class Vf extends eu{constructor(e){super(Vf,{name:"Texture",...e})}}Vf.u_alpha=1;Vf.u_map=void 0;Vf.vertexShader=`
    varying vec2 v_uv;
    
    void main() {
        v_uv = uv;
    }
    `;Vf.fragmentShader=` 
		uniform sampler2D u_map;  
		uniform float u_alpha;  
		varying vec2 v_uv;

    void main() {
			vec4 f_color = texture2D(u_map, v_uv);
      return vec4(f_color.rgb, f_color.a * u_alpha);
    }
  `;class Tg extends eu{constructor(e){super(Tg,{name:"Displace",...e},t=>{t.schema.push({value:t.type,label:"type",options:Object.values(g6)}),t.schema.push({value:t.mapping,label:"mapping",options:Object.values(MT)});const i=Tg.getNoiseFunction(t.type),r=Tg.getMapping(t.mapping);t.vertexVariables=t.vertexVariables.replace("lamina_mapping_template",r),t.vertexVariables=t.vertexVariables.replace("lamina_noise_template",i)}),this.type="perlin",this.mapping="local"}static getNoiseFunction(e){switch(e){default:case"perlin":return"lamina_noise_perlin";case"simplex":return"lamina_noise_simplex";case"cell":return"lamina_noise_worley";case"white":return"lamina_noise_white";case"curl":return"lamina_noise_swirl"}}static getMapping(e){switch(e){default:case"local":return"p";case"world":return"(modelMatrix * vec4(p,1.0)).xyz";case"uv":return"vec3(uv, 0.)"}}}Tg.u_strength=1;Tg.u_scale=1;Tg.u_offset=new D(0,0,0);Tg.vertexShader=`
       
      uniform float u_strength;
      uniform float u_scale;
      uniform vec3 u_offset;

      vec3 displace(vec3 p) {
				vec3 f_position = lamina_mapping_template;
        float f_n = lamina_noise_template((f_position + u_offset) * u_scale) * u_strength;
        vec3 f_newPosition = p + (f_n * normal);

				return f_newPosition;
      }

      
			vec3 orthogonal(vec3 v) {
  		  return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0)
  		  : vec3(0.0, -v.z, v.y));
  		}
  		vec3 recalcNormals(vec3 newPos) {
  		  float offset = 0.001;
  		  vec3 tangent = orthogonal(normal);
  		  vec3 bitangent = normalize(cross(normal, tangent));
  		  vec3 neighbour1 = position + tangent * offset;
  		  vec3 neighbour2 = position + bitangent * offset;
  		  vec3 displacedNeighbour1 = displace(neighbour1);
  		  vec3 displacedNeighbour2 = displace(neighbour2);
  		  vec3 displacedTangent = displacedNeighbour1 - newPos;
  		  vec3 displacedBitangent = displacedNeighbour2 - newPos;
  		  return normalize(cross(displacedTangent, displacedBitangent));
  		}
  
  
      void main() {
       
				vec3 f_newPosition = displace(position);
        lamina_finalNormal = recalcNormals(f_newPosition);

        return f_newPosition;
      }
    `;class Tf extends eu{constructor(e){super(Tf,{name:"Normal",...e})}}Tf.u_alpha=1;Tf.u_direction=new D(1,1,1);Tf.vertexShader=`   
  varying vec3 v_normals; 

  void main() {
    v_normals = normal;
  }
`;Tf.fragmentShader=`   
  	uniform float u_alpha;
  	uniform vec3 u_color;
  	uniform vec3 u_direction;

		varying vec3 v_normals;

    void main() {
			vec3 f_normalColor = vec3(1.);
      f_normalColor.x = v_normals.x * u_direction.x;
      f_normalColor.y = v_normals.y * u_direction.y;
      f_normalColor.z = v_normals.z * u_direction.z;

      return vec4(f_normalColor, u_alpha);
    }
  `;var Qxe=`
vec4 lamina_blend_add(const in vec4 x, const in vec4 y, const in float opacity) {

	return vec4(min(x.xyz + y.xyz, 1.0) * opacity + x.xyz * (1.0 - opacity), x.a);

}
vec3 lamina_blend_alpha(const in vec3 x, const in vec3 y, const in float opacity) {

	return y * opacity + x * (1.0 - opacity);

}

vec4 lamina_blend_alpha(const in vec4 x, const in vec4 y, const in float opacity) {

	float a = min(y.a, opacity);

	return vec4(lamina_blend_alpha(x.rgb, y.rgb, a), x.a);

}
vec4 lamina_blend_average(const in vec4 x, const in vec4 y, const in float opacity) {

	return vec4((x.xyz + y.xyz) * 0.5 * opacity + x.xyz * (1.0 - opacity), x.a);

}
float lamina_blend_color_burn(const in float x, const in float y) {

	return (y == 0.0) ? y : max(1.0 - (1.0 - x) / y, 0.0);

}

vec4 lamina_blend_color_burn(const in vec4 x, const in vec4 y, const in float opacity) {

	vec4 z = vec4(
		lamina_blend_color_burn(x.r, y.r),
		lamina_blend_color_burn(x.g, y.g),
		lamina_blend_color_burn(x.b, y.b),
		lamina_blend_color_burn(x.a, y.a)
	);

	return vec4(z.xyz * opacity + x.xyz * (1.0 - opacity), x.a);

}
float lamina_blend_color_dodge(const in float x, const in float y) {

	return (y == 1.0) ? y : min(x / (1.0 - y), 1.0);

}

vec4 lamina_blend_color_dodge(const in vec4 x, const in vec4 y, const in float opacity) {

	vec4 z = vec4(
		lamina_blend_color_dodge(x.r, y.r),
		lamina_blend_color_dodge(x.g, y.g),
		lamina_blend_color_dodge(x.b, y.b),
		lamina_blend_color_dodge(x.a, y.a)
	);

	return vec4(z.xyz * opacity + x.xyz * (1.0 - opacity), x.a);

}
vec4 lamina_blend_darken(const in vec4 x, const in vec4 y, const in float opacity) {

	return vec4(min(x.xyz, y.xyz) * opacity + x.xyz * (1.0 - opacity), x.a);

}
vec4 lamina_blend_difference(const in vec4 x, const in vec4 y, const in float opacity) {

	return vec4(abs(x.xyz - y.xyz) * opacity + x.xyz * (1.0 - opacity), x.a);

}
float lamina_blend_divide(const in float x, const in float y) {

	return (y > 0.0) ? min(x / y, 1.0) : 1.0;

}

vec4 lamina_blend_divide(const in vec4 x, const in vec4 y, const in float opacity) {

	vec4 z = vec4(
		lamina_blend_divide(x.r, y.r),
		lamina_blend_divide(x.g, y.g),
		lamina_blend_divide(x.b, y.b),
		lamina_blend_divide(x.a, y.a)
	);

	return vec4(z.xyz * opacity + x.xyz * (1.0 - opacity), x.a);

}
vec4 lamina_blend_exclusion(const in vec4 x, const in vec4 y, const in float opacity) {

	return vec4((x.xyz + y.xyz - 2.0 * x.xyz * y.xyz) * opacity + x.xyz * (1.0 - opacity), x.a);

}
vec4 lamina_blend_lighten(const in vec4 x, const in vec4 y, const in float opacity) {

	return vec4(max(x.xyz, y.xyz) * opacity + x.xyz * (1.0 - opacity), x.a);

}
vec4 lamina_blend_multiply(const in vec4 x, const in vec4 y, const in float opacity) {

	return vec4( x.xyz * y.xyz * opacity + x.xyz * (1.0 - opacity), x.a);

}
vec4 lamina_blend_negation(const in vec4 x, const in vec4 y, const in float opacity) {

	return vec4((1.0 - abs(1.0 - x.xyz - y.xyz)) * opacity + x.xyz * (1.0 - opacity), x.a);

}
vec4 lamina_blend_normal(const in vec4 x, const in vec4 y, const in float opacity) {

	return vec4(y.xyz * opacity + x.xyz * (1.0 - opacity), x.a);

}
float lamina_blend_overlay(const in float x, const in float y) {

	return (x < 0.5) ? (2.0 * x * y) : (1.0 - 2.0 * (1.0 - x) * (1.0 - y));

}

vec4 lamina_blend_overlay(const in vec4 x, const in vec4 y, const in float opacity) {

	vec4 z = vec4(
		lamina_blend_overlay(x.r, y.r),
		lamina_blend_overlay(x.g, y.g),
		lamina_blend_overlay(x.b, y.b),
		lamina_blend_overlay(x.a, y.a)
	);

	return vec4(z.xyz * opacity + x.xyz * (1.0 - opacity), x.a);

}
float lamina_blend_reflect(const in float x, const in float y) {

	return (y == 1.0) ? y : min(x * x / (1.0 - y), 1.0);

}

vec4 lamina_blend_reflect(const in vec4 x, const in vec4 y, const in float opacity) {

	vec4 z = vec4(
		lamina_blend_reflect(x.r, y.r),
		lamina_blend_reflect(x.g, y.g),
		lamina_blend_reflect(x.b, y.b),
		lamina_blend_reflect(x.a, y.a)
	);

	return vec4(z.xyz * opacity + x.xyz * (1.0 - opacity), x.a);

}
vec4 lamina_blend_screen(const in vec4 x, const in vec4 y, const in float opacity) {

	return vec4((1.0 - (1.0 - x.xyz) * (1.0 - y.xyz)) * opacity + x.xyz * (1.0 - opacity), x.a);

}
float lamina_blend_softlight(const in float x, const in float y) {

	return (y < 0.5) ?
		(2.0 * x * y + x * x * (1.0 - 2.0 * y)) :
		(sqrt(x) * (2.0 * y - 1.0) + 2.0 * x * (1.0 - y));

}

vec4 lamina_blend_softlight(const in vec4 x, const in vec4 y, const in float opacity) {

	vec4 z = vec4(
		lamina_blend_softlight(x.r, y.r),
		lamina_blend_softlight(x.g, y.g),
		lamina_blend_softlight(x.b, y.b),
		lamina_blend_softlight(x.a, y.a)
	);

	return vec4(z.xyz * opacity + x.xyz * (1.0 - opacity), x.a);

}
vec4 lamina_blend_subtract(const in vec4 x, const in vec4 y, const in float opacity) {

	return vec4(max(x.xyz + y.xyz - 1.0, 0.0) * opacity + x.xyz * (1.0 - opacity), x.a);

}

`,tK=`

// From: https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83
// Huge thanks to the creators of these algorithms

float lamina_noise_mod289(float x){return x - floor(x * (1.0 / 289.0)) * 289.0;}
vec4 lamina_noise_mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}
vec4 lamina_noise_perm(vec4 x){return lamina_noise_mod289(((x * 34.0) + 1.0) * x);}
vec4 lamina_noise_permute(vec4 x) { return mod(((x * 34.0) + 1.0) * x, 289.0); }
vec4 lamina_noise_taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }


float lamina_noise_white(vec2 p) {
  return fract(1e4 * sin(17.0 * p.x + p.y * 0.1) *
               (0.1 + abs(sin(p.y * 13.0 + p.x))));
}

float lamina_noise_white(vec3 p) {
  return lamina_noise_white(p.xy);
}


vec3 lamina_noise_fade(vec3 t) { return t * t * t * (t * (t * 6.0 - 15.0) + 10.0); }

float lamina_noise_perlin(vec3 P) {
  vec3 Pi0 = floor(P);        // Integer part for indexing
  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1
  Pi0 = mod(Pi0, 289.0);
  Pi1 = mod(Pi1, 289.0);
  vec3 Pf0 = fract(P);        // Fractional part for interpolation
  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
  vec4 iy = vec4(Pi0.yy, Pi1.yy);
  vec4 iz0 = Pi0.zzzz;
  vec4 iz1 = Pi1.zzzz;

  vec4 ixy = lamina_noise_permute(lamina_noise_permute(ix) + iy);
  vec4 ixy0 = lamina_noise_permute(ixy + iz0);
  vec4 ixy1 = lamina_noise_permute(ixy + iz1);

  vec4 gx0 = ixy0 / 7.0;
  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
  gx0 = fract(gx0);
  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
  vec4 sz0 = step(gz0, vec4(0.0));
  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
  gy0 -= sz0 * (step(0.0, gy0) - 0.5);

  vec4 gx1 = ixy1 / 7.0;
  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
  gx1 = fract(gx1);
  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
  vec4 sz1 = step(gz1, vec4(0.0));
  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
  gy1 -= sz1 * (step(0.0, gy1) - 0.5);

  vec3 g000 = vec3(gx0.x, gy0.x, gz0.x);
  vec3 g100 = vec3(gx0.y, gy0.y, gz0.y);
  vec3 g010 = vec3(gx0.z, gy0.z, gz0.z);
  vec3 g110 = vec3(gx0.w, gy0.w, gz0.w);
  vec3 g001 = vec3(gx1.x, gy1.x, gz1.x);
  vec3 g101 = vec3(gx1.y, gy1.y, gz1.y);
  vec3 g011 = vec3(gx1.z, gy1.z, gz1.z);
  vec3 g111 = vec3(gx1.w, gy1.w, gz1.w);

  vec4 norm0 = lamina_noise_taylorInvSqrt(
      vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
  g000 *= norm0.x;
  g010 *= norm0.y;
  g100 *= norm0.z;
  g110 *= norm0.w;
  vec4 norm1 = lamina_noise_taylorInvSqrt(
      vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
  g001 *= norm1.x;
  g011 *= norm1.y;
  g101 *= norm1.z;
  g111 *= norm1.w;

  float n000 = dot(g000, Pf0);
  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
  float n111 = dot(g111, Pf1);

  vec3 fade_xyz = lamina_noise_fade(Pf0);
  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111),
                 fade_xyz.z);
  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);
  return lamina_normalize(2.2 * n_xyz);
}

float lamina_noise_simplex(vec3 v) {
  const vec2 C = vec2(1.0 / 6.0, 1.0 / 3.0);
  const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);

  // First corner
  vec3 i = floor(v + dot(v, C.yyy));
  vec3 x0 = v - i + dot(i, C.xxx);

  // Other corners
  vec3 g = step(x0.yzx, x0.xyz);
  vec3 l = 1.0 - g;
  vec3 i1 = min(g.xyz, l.zxy);
  vec3 i2 = max(g.xyz, l.zxy);

  //  x0 = x0 - 0. + 0.0 * C
  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
  vec3 x3 = x0 - 1. + 3.0 * C.xxx;

  // Permutations
  i = mod(i, 289.0);
  vec4 p = lamina_noise_permute(lamina_noise_permute(lamina_noise_permute(i.z + vec4(0.0, i1.z, i2.z, 1.0)) + i.y +
                             vec4(0.0, i1.y, i2.y, 1.0)) +
                    i.x + vec4(0.0, i1.x, i2.x, 1.0));

  // Gradients
  // ( N*N points uniformly over a square, mapped onto an octahedron.)
  float n_ = 1.0 / 7.0; // N=7
  vec3 ns = n_ * D.wyz - D.xzx;

  vec4 j = p - 49.0 * floor(p * ns.z * ns.z); //  mod(p,N*N)

  vec4 x_ = floor(j * ns.z);
  vec4 y_ = floor(j - 7.0 * x_); // mod(j,N)

  vec4 x = x_ * ns.x + ns.yyyy;
  vec4 y = y_ * ns.x + ns.yyyy;
  vec4 h = 1.0 - abs(x) - abs(y);

  vec4 b0 = vec4(x.xy, y.xy);
  vec4 b1 = vec4(x.zw, y.zw);

  vec4 s0 = floor(b0) * 2.0 + 1.0;
  vec4 s1 = floor(b1) * 2.0 + 1.0;
  vec4 sh = -step(h, vec4(0.0));

  vec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy;
  vec4 a1 = b1.xzyw + s1.xzyw * sh.zzww;

  vec3 p0 = vec3(a0.xy, h.x);
  vec3 p1 = vec3(a0.zw, h.y);
  vec3 p2 = vec3(a1.xy, h.z);
  vec3 p3 = vec3(a1.zw, h.w);

  // Normalise gradients
  vec4 norm =
      lamina_noise_taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));
  p0 *= norm.x;
  p1 *= norm.y;
  p2 *= norm.z;
  p3 *= norm.w;

  // Mix final noise value
  vec4 m =
      max(0.6 - vec4(dot(x0, x0), dot(x1, x1), dot(x2, x2), dot(x3, x3)), 0.0);
  m = m * m;
  return lamina_normalize(42.0 *
         dot(m * m, vec4(dot(p0, x0), dot(p1, x1), dot(p2, x2), dot(p3, x3))));
}

vec3 lamina_noise_simplex3(vec3 x) {
  float s = lamina_noise_simplex(vec3(x));
  float s1 = lamina_noise_simplex(vec3(x.y - 19.1, x.z + 33.4, x.x + 47.2));
  float s2 = lamina_noise_simplex(vec3(x.z + 74.2, x.x - 124.5, x.y + 99.4));
  vec3 c = vec3(s, s1, s2);
  return c;
}

vec3 lamina_noise_curl(vec3 p) {
  const float e = .1;
  vec3 dx = vec3(e, 0.0, 0.0);
  vec3 dy = vec3(0.0, e, 0.0);
  vec3 dz = vec3(0.0, 0.0, e);

  vec3 p_x0 = lamina_noise_simplex3(p - dx);
  vec3 p_x1 = lamina_noise_simplex3(p + dx);
  vec3 p_y0 = lamina_noise_simplex3(p - dy);
  vec3 p_y1 = lamina_noise_simplex3(p + dy);
  vec3 p_z0 = lamina_noise_simplex3(p - dz);
  vec3 p_z1 = lamina_noise_simplex3(p + dz);

  float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;
  float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;
  float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;

  const float divisor = 1.0 / (2.0 * e);
  return normalize(vec3(x, y, z) * divisor);
}

vec3 lamina_permute(vec3 x) {
  return mod((34.0 * x + 1.0) * x, 289.0);
}

vec3 lamina_dist(vec3 x, vec3 y, vec3 z,  bool manhattanDistance) {
  return manhattanDistance ?  abs(x) + abs(y) + abs(z) :  (x * x + y * y + z * z);
}

// From: https://github.com/Erkaman/glsl-worley
float lamina_noise_worley(vec3 P) {
  float jitter = 1.;
  bool manhattanDistance = false; 

  float K = 0.142857142857; // 1/7
  float Ko = 0.428571428571; // 1/2-K/2
  float  K2 = 0.020408163265306; // 1/(7*7)
  float Kz = 0.166666666667; // 1/6
  float Kzo = 0.416666666667; // 1/2-1/6*2

	vec3 Pi = mod(floor(P), 289.0);
 	vec3 Pf = fract(P) - 0.5;

	vec3 Pfx = Pf.x + vec3(1.0, 0.0, -1.0);
	vec3 Pfy = Pf.y + vec3(1.0, 0.0, -1.0);
	vec3 Pfz = Pf.z + vec3(1.0, 0.0, -1.0);

	vec3 p = lamina_permute(Pi.x + vec3(-1.0, 0.0, 1.0));
	vec3 p1 = lamina_permute(p + Pi.y - 1.0);
	vec3 p2 = lamina_permute(p + Pi.y);
	vec3 p3 = lamina_permute(p + Pi.y + 1.0);

	vec3 p11 = lamina_permute(p1 + Pi.z - 1.0);
	vec3 p12 = lamina_permute(p1 + Pi.z);
	vec3 p13 = lamina_permute(p1 + Pi.z + 1.0);

	vec3 p21 = lamina_permute(p2 + Pi.z - 1.0);
	vec3 p22 = lamina_permute(p2 + Pi.z);
	vec3 p23 = lamina_permute(p2 + Pi.z + 1.0);

	vec3 p31 = lamina_permute(p3 + Pi.z - 1.0);
	vec3 p32 = lamina_permute(p3 + Pi.z);
	vec3 p33 = lamina_permute(p3 + Pi.z + 1.0);

	vec3 ox11 = fract(p11*K) - Ko;
	vec3 oy11 = mod(floor(p11*K), 7.0)*K - Ko;
	vec3 oz11 = floor(p11*K2)*Kz - Kzo; // p11 < 289 guaranteed

	vec3 ox12 = fract(p12*K) - Ko;
	vec3 oy12 = mod(floor(p12*K), 7.0)*K - Ko;
	vec3 oz12 = floor(p12*K2)*Kz - Kzo;

	vec3 ox13 = fract(p13*K) - Ko;
	vec3 oy13 = mod(floor(p13*K), 7.0)*K - Ko;
	vec3 oz13 = floor(p13*K2)*Kz - Kzo;

	vec3 ox21 = fract(p21*K) - Ko;
	vec3 oy21 = mod(floor(p21*K), 7.0)*K - Ko;
	vec3 oz21 = floor(p21*K2)*Kz - Kzo;

	vec3 ox22 = fract(p22*K) - Ko;
	vec3 oy22 = mod(floor(p22*K), 7.0)*K - Ko;
	vec3 oz22 = floor(p22*K2)*Kz - Kzo;

	vec3 ox23 = fract(p23*K) - Ko;
	vec3 oy23 = mod(floor(p23*K), 7.0)*K - Ko;
	vec3 oz23 = floor(p23*K2)*Kz - Kzo;

	vec3 ox31 = fract(p31*K) - Ko;
	vec3 oy31 = mod(floor(p31*K), 7.0)*K - Ko;
	vec3 oz31 = floor(p31*K2)*Kz - Kzo;

	vec3 ox32 = fract(p32*K) - Ko;
	vec3 oy32 = mod(floor(p32*K), 7.0)*K - Ko;
	vec3 oz32 = floor(p32*K2)*Kz - Kzo;

	vec3 ox33 = fract(p33*K) - Ko;
	vec3 oy33 = mod(floor(p33*K), 7.0)*K - Ko;
	vec3 oz33 = floor(p33*K2)*Kz - Kzo;

	vec3 dx11 = Pfx + jitter*ox11;
	vec3 dy11 = Pfy.x + jitter*oy11;
	vec3 dz11 = Pfz.x + jitter*oz11;

	vec3 dx12 = Pfx + jitter*ox12;
	vec3 dy12 = Pfy.x + jitter*oy12;
	vec3 dz12 = Pfz.y + jitter*oz12;

	vec3 dx13 = Pfx + jitter*ox13;
	vec3 dy13 = Pfy.x + jitter*oy13;
	vec3 dz13 = Pfz.z + jitter*oz13;

	vec3 dx21 = Pfx + jitter*ox21;
	vec3 dy21 = Pfy.y + jitter*oy21;
	vec3 dz21 = Pfz.x + jitter*oz21;

	vec3 dx22 = Pfx + jitter*ox22;
	vec3 dy22 = Pfy.y + jitter*oy22;
	vec3 dz22 = Pfz.y + jitter*oz22;

	vec3 dx23 = Pfx + jitter*ox23;
	vec3 dy23 = Pfy.y + jitter*oy23;
	vec3 dz23 = Pfz.z + jitter*oz23;

	vec3 dx31 = Pfx + jitter*ox31;
	vec3 dy31 = Pfy.z + jitter*oy31;
	vec3 dz31 = Pfz.x + jitter*oz31;

	vec3 dx32 = Pfx + jitter*ox32;
	vec3 dy32 = Pfy.z + jitter*oy32;
	vec3 dz32 = Pfz.y + jitter*oz32;

	vec3 dx33 = Pfx + jitter*ox33;
	vec3 dy33 = Pfy.z + jitter*oy33;
	vec3 dz33 = Pfz.z + jitter*oz33;

	vec3 d11 = lamina_dist(dx11, dy11, dz11, manhattanDistance);
	vec3 d12 = lamina_dist(dx12, dy12, dz12, manhattanDistance);
	vec3 d13 = lamina_dist(dx13, dy13, dz13, manhattanDistance);
	vec3 d21 = lamina_dist(dx21, dy21, dz21, manhattanDistance);
	vec3 d22 = lamina_dist(dx22, dy22, dz22, manhattanDistance);
	vec3 d23 = lamina_dist(dx23, dy23, dz23, manhattanDistance);
	vec3 d31 = lamina_dist(dx31, dy31, dz31, manhattanDistance);
	vec3 d32 = lamina_dist(dx32, dy32, dz32, manhattanDistance);
	vec3 d33 = lamina_dist(dx33, dy33, dz33, manhattanDistance);

	vec3 d1a = min(d11, d12);
	d12 = max(d11, d12);
	d11 = min(d1a, d13); // Smallest now not in d12 or d13
	d13 = max(d1a, d13);
	d12 = min(d12, d13); // 2nd smallest now not in d13
	vec3 d2a = min(d21, d22);
	d22 = max(d21, d22);
	d21 = min(d2a, d23); // Smallest now not in d22 or d23
	d23 = max(d2a, d23);
	d22 = min(d22, d23); // 2nd smallest now not in d23
	vec3 d3a = min(d31, d32);
	d32 = max(d31, d32);
	d31 = min(d3a, d33); // Smallest now not in d32 or d33
	d33 = max(d3a, d33);
	d32 = min(d32, d33); // 2nd smallest now not in d33
	vec3 da = min(d11, d21);
	d21 = max(d11, d21);
	d11 = min(da, d31); // Smallest now in d11
	d31 = max(da, d31); // 2nd smallest now not in d31
	d11.xy = (d11.x < d11.y) ? d11.xy : d11.yx;
	d11.xz = (d11.x < d11.z) ? d11.xz : d11.zx; // d11.x now smallest
	d12 = min(d12, d21); // 2nd smallest now not in d21
	d12 = min(d12, d22); // nor in d22
	d12 = min(d12, d31); // nor in d31
	d12 = min(d12, d32); // nor in d32
	d11.yz = min(d11.yz,d12.xy); // nor in d12.yz
	d11.y = min(d11.y,d12.z); // Only two more to go
	d11.y = min(d11.y,d11.z); // Done! (Phew!)

  vec2 F = sqrt(d11.xy);
	return F.x; // F1, F2

}

float lamina_noise_swirl(vec3 position) {
    float scale = 0.1;
    float freq = 4. * scale;
    float t = 1.;

    vec3 pos = (position * scale) + lamina_noise_curl(position * 7. * scale);

    float worley1 = 1. - lamina_noise_worley((pos * (freq * 2.)) +  (t * 2.));
    float worley2 = 1. - lamina_noise_worley((pos * (freq * 4.)) +  (t * 4.));
    float worley3 = 1. - lamina_noise_worley((pos * (freq * 8.)) +  (t * 8.));
    float worley4 = 1. - lamina_noise_worley((pos * (freq * 16.)) +  (t * 16.));
    
    float fbm1 = worley1 * .625 + worley2 * .25 + worley3 * .125;
    float fbm2 = worley2 * .625 + worley3 * .25 + worley4 * .125;
    float fbm3 = worley3 * .75 + worley4 * .25;

    vec3 curlWorleyFbm = vec3(fbm1, fbm2, fbm3);
    float curlWorley = curlWorleyFbm.r * .625 + curlWorleyFbm.g * .25 + 
        curlWorleyFbm.b * .125;

    return curlWorley;
}
  
  
`,nK=`

float lamina_map(float value, float min1, float max1, float min2, float max2) {
  return min2 + (value - min1) * (max2 - min2) / (max1 - min1);
}

float lamina_normalize(float v) { return lamina_map(v, -1.0, 1.0, 0.0, 1.0); }
`;class u6 extends wbe{constructor({color:e,alpha:t,lighting:i,layers:r,name:s,...o}={}){super({baseMaterial:Uxe[i||"basic"],...o}),this.name="LayerMaterial",this.layers=[],this.lighting="basic";const a=e||"white",l=t??1;this.uniforms={u_lamina_color:{value:typeof a=="string"?new Ke(a).convertSRGBToLinear():a},u_lamina_alpha:{value:l}},this.layers=r||this.layers,this.lighting=i||this.lighting,this.name=s||this.name,this.refresh()}genShaders(){let e="",t="",i="",r="",s={};return this.layers.filter(o=>o.visible).forEach(o=>{e+=o.vertexVariables+`
`,t+=o.fragmentVariables+`
`,i+=o.vertexShader+`
`,r+=o.fragmentShader+`
`,s={...s,...o.uniforms}}),s={...s,...this.uniforms},{uniforms:s,vertexShader:`
        ${nK}
        ${tK}
        ${e}

        void main() {
          vec3 lamina_finalPosition = position;
          vec3 lamina_finalNormal = normal;

          ${i}

          csm_Position = lamina_finalPosition;
          csm_Normal = lamina_finalNormal;
        }
        `,fragmentShader:`
        ${nK}
        ${tK}
        ${Qxe}
        ${t}

        uniform vec3 u_lamina_color;
        uniform float u_lamina_alpha;

        void main() {
          vec4 lamina_finalColor = vec4(u_lamina_color, u_lamina_alpha);

          ${r}

          csm_DiffuseColor = lamina_finalColor;
         
        }
        `}}refresh(){const{uniforms:e,fragmentShader:t,vertexShader:i}=this.genShaders();super.update({fragmentShader:t,vertexShader:i,uniforms:e})}serialize(){return{constructor:"LayerMaterial",properties:{color:this.color,alpha:this.alpha,name:this.name,lighting:this.lighting}}}set color(e){var t,i;(t=this.uniforms)!=null&&(i=t.u_lamina_color)!=null&&i.value&&(this.uniforms.u_lamina_color.value=typeof e=="string"?new Ke(e).convertSRGBToLinear():e)}get color(){var e,t;return(e=this.uniforms)==null||(t=e.u_lamina_color)==null?void 0:t.value}set alpha(e){this.uniforms.u_lamina_alpha.value=e}get alpha(){return this.uniforms.u_lamina_alpha.value}}Zd({LayerMaterial:u6});Zd({LayerMaterial:u6,Depth_:Ya,Color_:qC,Noise_:bo,Fresnel_:_l,Gradient_:Ka,Matcap_:_f,Texture_:Vf,Displace_:Tg,Normal_:Tf});const iK=L.forwardRef(({children:n,...e},t)=>{const i=L.useRef(null);M.useImperativeHandle(t,()=>i.current),L.useLayoutEffect(()=>{i.current.layers=i.current.__r3f.objects,i.current.refresh()},[n]);const[r,s]=M.useMemo(()=>Dxe(e),[e]);return L.createElement("layerMaterial",pt({args:[r],ref:i},s),n)});function Oxe(n){return[{mode:n==null?void 0:n.mode,visible:n==null?void 0:n.visible,type:n==null?void 0:n.type,mapping:n==null?void 0:n.mapping,map:n==null?void 0:n.map,axes:n==null?void 0:n.axes}]}const rK=L.forwardRef((n,e)=>L.createElement("gradient_",pt({ref:e,args:Oxe(n)},n))),Jxe=({backgroundColors:n})=>{const i=M.useRef(),r=M.useRef();return yn(()=>{i.current.colorA=new Ke(n.current.colorA),i.current.colorB=new Ke(n.current.colorB),r.current.colorA=new Ke(n.current.colorA),r.current.colorB=new Ke(n.current.colorB)}),cn(O0,{children:[We(fz,{scale:[500,500,500],"rotation-y":Math.PI/2,children:We(iK,{color:"#ffffff",side:Bi,children:We(rK,{ref:i,axes:"y",start:.2,end:-.5})})}),We(kCe,{resolution:256,frames:1/0,children:We(fz,{scale:[100,100,100],"rotation-y":Math.PI/2,"rotation-x":Math.PI,children:We(iK,{color:"#ffffff",side:Bi,children:We(rK,{ref:r,axes:"y",start:.2,end:-.5})})})})]})};function jxe({sceneOpacity:n,...e}){const{nodes:t,materials:i}=YC("./models/cloud/cloud.gltf"),r=M.useRef();return yn(()=>{r.current.opacity=n.current}),We("group",{...e,dispose:null,children:We("mesh",{geometry:t.Mball001.geometry,children:We("meshStandardMaterial",{ref:r,onBeforeCompile:H8,envMapIntensity:2,transparent:!0})})})}YC.preload("./models/cloud/cloud.gltf");const qxe=({title:n,subtitle:e,...t})=>cn("group",{...t,children:[!!n&&cn(mf,{color:"white",anchorX:"left",anchorY:"bottom",fontSize:.52,maxWidth:2.5,lineHeight:1,font:"./fonts/DMSerifDisplay-Regular.ttf",children:[n,We("meshStandardMaterial",{color:"white",onBeforeCompile:MX})]}),cn(mf,{color:"white",anchorX:"left",anchorY:"top",fontSize:.2,maxWidth:2.5,font:"./fonts/Inter-Regular.ttf",children:[e,We("meshStandardMaterial",{color:"white",onBeforeCompile:MX})]})]}),$xe=240,eSe=.1,tSe=()=>{const n=M.useRef();let e={x:0,y:0,z:0},t=0;const i=()=>{e={x:ss.randFloatSpread(8),y:ss.randFloatSpread(5),z:ss.randFloatSpread(8)},t=ss.randFloat(16,20)};return i(),yn((r,s)=>{n.current&&(n.current.position.z+=t*s,n.current.position.z>5&&(i(),n.current.position.z=e.z))}),We(Gj,{ref:n,color:"white",position:[e.x,e.y,e.z],"rotation-y":Math.PI/2})},nSe=()=>{const n=M.useRef(),e=IJ(),t=M.useRef(0);return yn((i,r)=>{e.offset-t.current>5e-4&&(n.current.opacity=eSe),t.current=e.offset,n.current.opacity>0&&(n.current.opacity-=r*.2)}),We("group",{children:cn(PCe,{children:[We("planeGeometry",{args:[1,.004]}),We("meshBasicMaterial",{ref:n,side:Di,blending:g2,opacity:0,transparent:!0}),Array($xe).fill().map((i,r)=>We(tSe,{},r))]})})},iSe=1e3,lh=250,rSe=.008,sSe=.02,sK=35,DZ=42,oSe=()=>{const n=M.useMemo(()=>[new D(0,0,0),new D(0,0,-lh),new D(100,0,-2*lh),new D(-100,0,-3*lh),new D(100,0,-4*lh),new D(0,0,-5*lh),new D(0,0,-6*lh),new D(0,0,-7*lh)],[]),e=M.useRef(0),t=M.useRef(),i=M.useMemo(()=>new O_(n,!1,"catmullrom",.5),[]),r=M.useMemo(()=>[{cameraRailDist:-1,position:new D(n[1].x-3,n[1].y,n[1].z),subtitle:`Welcome to SpusuemSky,
Have a seat and enjoy the ride!`},{cameraRailDist:1.5,position:new D(n[2].x+2,n[2].y,n[2].z),title:"Services",subtitle:"Immersive Adventures With Unmatched Safety & Spectacular Entertainment"},{cameraRailDist:-1,position:new D(n[3].x-3,n[3].y,n[3].z),title:"Dare To Explore?",subtitle:"Step Into A World Of Wonder, Where History, Art & Knowledge Converge, Inspiring & Enriching Your Soul."},{cameraRailDist:1.5,position:new D(n[4].x+3.5,n[4].y,n[4].z-12),title:"Curiosity Unleashed",subtitle:"Delve Into Captivating Exhibits & Ignite Your Curiosity At The Museum."}],[]),s=M.useMemo(()=>[{position:new D(-3.5,-3.2,-7)},{position:new D(3.5,-4,-10)},{scale:new D(4,4,4),position:new D(-18,.2,-68),rotation:new Hi(-Math.PI/5,Math.PI/6,0)},{scale:new D(2.5,2.5,2.5),position:new D(10,-1.2,-52)},{scale:new D(4,4,4),position:new D(n[1].x+10,n[1].y-4,n[1].z+64)},{scale:new D(3,3,3),position:new D(n[1].x-20,n[1].y+4,n[1].z+28),rotation:new Hi(0,Math.PI/7,0)},{rotation:new Hi(0,Math.PI/7,Math.PI/5),scale:new D(5,5,5),position:new D(n[1].x-13,n[1].y+4,n[1].z-62)},{rotation:new Hi(Math.PI/2,Math.PI/2,Math.PI/3),scale:new D(5,5,5),position:new D(n[1].x+54,n[1].y+2,n[1].z-82)},{scale:new D(5,5,5),position:new D(n[1].x+8,n[1].y-14,n[1].z-22)},{scale:new D(3,3,3),position:new D(n[2].x+6,n[2].y-7,n[2].z+50)},{scale:new D(2,2,2),position:new D(n[2].x-2,n[2].y+4,n[2].z-26)},{scale:new D(4,4,4),position:new D(n[2].x+12,n[2].y+1,n[2].z-86),rotation:new Hi(Math.PI/4,0,Math.PI/3)},{scale:new D(3,3,3),position:new D(n[3].x+3,n[3].y-10,n[3].z+50)},{scale:new D(3,3,3),position:new D(n[3].x-10,n[3].y,n[3].z+30),rotation:new Hi(Math.PI/4,0,Math.PI/5)},{scale:new D(4,4,4),position:new D(n[3].x-20,n[3].y-5,n[3].z-8),rotation:new Hi(Math.PI,0,Math.PI/5)},{scale:new D(5,5,5),position:new D(n[3].x+0,n[3].y-5,n[3].z-98),rotation:new Hi(0,Math.PI/3,0)},{scale:new D(2,2,2),position:new D(n[4].x+3,n[4].y-10,n[4].z+2)},{scale:new D(3,3,3),position:new D(n[4].x+24,n[4].y-6,n[4].z-42),rotation:new Hi(Math.PI/4,0,Math.PI/5)},{scale:new D(3,3,3),position:new D(n[4].x-4,n[4].y+9,n[4].z-62),rotation:new Hi(Math.PI/3,0,Math.PI/3)},{scale:new D(3,3,3),position:new D(n[7].x+12,n[7].y-5,n[7].z+60),rotation:new Hi(-Math.PI/4,-Math.PI/6,0)},{scale:new D(3,3,3),position:new D(n[7].x-12,n[7].y+5,n[7].z+120),rotation:new Hi(Math.PI/4,Math.PI/6,0)}],[]),o=M.useMemo(()=>{const w=new ad;return w.moveTo(0,-.08),w.lineTo(0,.08),w},[i]),a=M.useRef(),l=M.useRef(),c=M.useRef(),g=IJ(),u=M.useRef(0),{play:d,setHasScroll:h,end:f,setEnd:I}=IT();yn((w,G)=>{if(window.innerWidth>window.innerHeight?(c.current.fov=30,c.current.position.z=5):(c.current.fov=80,c.current.position.z=2),u.current<=0&&g.offset>0&&h(!0),d&&!f&&e.current<1&&(e.current=ss.lerp(e.current,1,G*.1)),f&&e.current>0&&(e.current=ss.lerp(e.current,0,G)),t.current.opacity=e.current,f)return;const x=Math.max(0,g.offset);let B=1,R=!0;if(r.forEach(Q=>{const P=Q.position.distanceTo(a.current.position);if(P<DZ){B=Math.max(P/DZ,.1);const ne=new D((1-P/DZ)*Q.cameraRailDist,0,0);l.current.position.lerp(ne,G),R=!1}}),R){const Q=new D(0,0,0);l.current.position.lerp(Q,G)}let Z=ss.lerp(u.current,x,G*B);Z=Math.min(Z,1),Z=Math.max(Z,0),u.current=Z,p.current.seek(Z*p.current.duration());const W=i.getPoint(Z);a.current.position.lerp(W,G*24);const F=i.getPoint(Math.min(Z+rSe,1)),T=a.current.getWorldDirection(new D),V=new D().subVectors(W,F).normalize(),z=T.lerp(V,G*24);a.current.lookAt(a.current.position.clone().add(z));const U=i.getTangent(Z+sSe),J=new ho;J.position.copy(W),J.lookAt(J.position.clone().add(V)),U.applyAxisAngle(new D(0,1,0),-J.rotation.y);let H=Math.atan2(-U.z,U.x);H=-Math.PI/2+H;let Y=H*180/Math.PI;Y*=2.4,Y<0&&(Y=Math.max(Y,-sK)),Y>0&&(Y=Math.min(Y,sK)),H=Y*Math.PI/180;const K=new xn().setFromEuler(new Hi(A.current.rotation.x,A.current.rotation.y,H));A.current.quaternion.slerp(K,G*2),a.current.position.z<n[n.length-1].z+100&&(I(!0),b.current.play())});const A=M.useRef(),p=M.useRef(),y=M.useRef({colorA:"gray",colorB:"#abaadd"}),v=M.useRef(),b=M.useRef();return M.useLayoutEffect(()=>{p.current=w1.timeline(),p.current.to(y.current,{duration:1,colorA:"gray",colorB:"black"}),p.current.to(y.current,{duration:1,colorA:"#3535cc",colorB:"black"}),p.current.to(y.current,{duration:1,colorA:"#3535cc",colorB:"gray"}),p.current.pause(),v.current=w1.timeline(),v.current.pause(),v.current.from(A.current.position,{duration:3,z:5,y:-2}),b.current=w1.timeline(),b.current.pause(),b.current.to(A.current.position,{duration:10,z:-250,y:10},0),b.current.to(l.current.position,{duration:8,y:12},0),b.current.to(A.current.position,{duration:1,z:-1e3})},[]),M.useEffect(()=>{d&&v.current.play()},[d]),M.useMemo(()=>cn(O0,{children:[We("directionalLight",{position:[0,3,1],intensity:.1}),cn("group",{ref:a,children:[We(nSe,{}),We(Jxe,{backgroundColors:y}),We("group",{ref:l,children:We($Ae,{ref:c,position:[0,0,5],fov:30,makeDefault:!0})}),We("group",{ref:A,children:We(WCe,{floatIntensity:1,speed:1.5,rotationIntensity:.5,children:We(Nve,{"rotation-y":Math.PI/2+Math.PI,scale:[1.5,1.5,1.5],position:[0,-.6,-.35]})})})]}),r.map((w,G)=>M.createElement(qxe,{...w,key:G})),We("group",{"position-y":-2,children:cn("mesh",{children:[We("extrudeGeometry",{args:[o,{steps:iSe,bevelEnabled:!1,extrudePath:i}]}),We("meshStandardMaterial",{color:"white",ref:t,transparent:!0,envMapIntensity:2,onBeforeCompile:H8})]})}),s.map((w,G)=>M.createElement(jxe,{sceneOpacity:e,...w,key:G}))]}),[])},aSe="/assets/HipHopLofi-2f949c14.mp3";function UW(n,e){return UW=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},UW(n,e)}function Mc(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,UW(n,e)}function IG(n){return n.charAt(0)==="/"}function PZ(n,e){for(var t=e,i=t+1,r=n.length;i<r;t+=1,i+=1)n[t]=n[i];n.pop()}function lSe(n,e){e===void 0&&(e="");var t=n&&n.split("/")||[],i=e&&e.split("/")||[],r=n&&IG(n),s=e&&IG(e),o=r||s;if(n&&IG(n)?i=t:t.length&&(i.pop(),i=i.concat(t)),!i.length)return"/";var a;if(i.length){var l=i[i.length-1];a=l==="."||l===".."||l===""}else a=!1;for(var c=0,g=i.length;g>=0;g--){var u=i[g];u==="."?PZ(i,g):u===".."?(PZ(i,g),c++):c&&(PZ(i,g),c--)}if(!o)for(;c--;c)i.unshift("..");o&&i[0]!==""&&(!i[0]||!IG(i[0]))&&i.unshift("");var d=i.join("/");return a&&d.substr(-1)!=="/"&&(d+="/"),d}var cSe=!0,UZ="Invariant failed";function Nf(n,e){if(!n){if(cSe)throw new Error(UZ);var t=typeof e=="function"?e():e,i=t?"".concat(UZ,": ").concat(t):UZ;throw new Error(i)}}function D0(n){return n.charAt(0)==="/"?n:"/"+n}function oK(n){return n.charAt(0)==="/"?n.substr(1):n}function gSe(n,e){return n.toLowerCase().indexOf(e.toLowerCase())===0&&"/?#".indexOf(n.charAt(e.length))!==-1}function d6(n,e){return gSe(n,e)?n.substr(e.length):n}function h6(n){return n.charAt(n.length-1)==="/"?n.slice(0,-1):n}function uSe(n){var e=n||"/",t="",i="",r=e.indexOf("#");r!==-1&&(i=e.substr(r),e=e.substr(0,r));var s=e.indexOf("?");return s!==-1&&(t=e.substr(s),e=e.substr(0,s)),{pathname:e,search:t==="?"?"":t,hash:i==="#"?"":i}}function so(n){var e=n.pathname,t=n.search,i=n.hash,r=e||"/";return t&&t!=="?"&&(r+=t.charAt(0)==="?"?t:"?"+t),i&&i!=="#"&&(r+=i.charAt(0)==="#"?i:"#"+i),r}function Oo(n,e,t,i){var r;typeof n=="string"?(r=uSe(n),r.state=e):(r=pt({},n),r.pathname===void 0&&(r.pathname=""),r.search?r.search.charAt(0)!=="?"&&(r.search="?"+r.search):r.search="",r.hash?r.hash.charAt(0)!=="#"&&(r.hash="#"+r.hash):r.hash="",e!==void 0&&r.state===void 0&&(r.state=e));try{r.pathname=decodeURI(r.pathname)}catch(s){throw s instanceof URIError?new URIError('Pathname "'+r.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.'):s}return t&&(r.key=t),i?r.pathname?r.pathname.charAt(0)!=="/"&&(r.pathname=lSe(r.pathname,i.pathname)):r.pathname=i.pathname:r.pathname||(r.pathname="/"),r}function ET(){var n=null;function e(o){return n=o,function(){n===o&&(n=null)}}function t(o,a,l,c){if(n!=null){var g=typeof n=="function"?n(o,a):n;typeof g=="string"?typeof l=="function"?l(g,c):c(!0):c(g!==!1)}else c(!0)}var i=[];function r(o){var a=!0;function l(){a&&o.apply(void 0,arguments)}return i.push(l),function(){a=!1,i=i.filter(function(c){return c!==l})}}function s(){for(var o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];i.forEach(function(c){return c.apply(void 0,a)})}return{setPrompt:e,confirmTransitionTo:t,appendListener:r,notifyListeners:s}}var f6=!!(typeof window<"u"&&window.document&&window.document.createElement);function I6(n,e){e(window.confirm(n))}function dSe(){var n=window.navigator.userAgent;return(n.indexOf("Android 2.")!==-1||n.indexOf("Android 4.0")!==-1)&&n.indexOf("Mobile Safari")!==-1&&n.indexOf("Chrome")===-1&&n.indexOf("Windows Phone")===-1?!1:window.history&&"pushState"in window.history}function hSe(){return window.navigator.userAgent.indexOf("Trident")===-1}function fSe(){return window.navigator.userAgent.indexOf("Firefox")===-1}function ISe(n){return n.state===void 0&&navigator.userAgent.indexOf("CriOS")===-1}var aK="popstate",lK="hashchange";function cK(){try{return window.history.state||{}}catch{return{}}}function ASe(n){n===void 0&&(n={}),f6||Nf(!1);var e=window.history,t=dSe(),i=!hSe(),r=n,s=r.forceRefresh,o=s===void 0?!1:s,a=r.getUserConfirmation,l=a===void 0?I6:a,c=r.keyLength,g=c===void 0?6:c,u=n.basename?h6(D0(n.basename)):"";function d(Y){var K=Y||{},Q=K.key,P=K.state,ne=window.location,oe=ne.pathname,$=ne.search,de=ne.hash,ge=oe+$+de;return u&&(ge=d6(ge,u)),Oo(ge,P,Q)}function h(){return Math.random().toString(36).substr(2,g)}var f=ET();function I(Y){pt(H,Y),H.length=e.length,f.notifyListeners(H.location,H.action)}function A(Y){ISe(Y)||v(d(Y.state))}function p(){v(d(cK()))}var y=!1;function v(Y){if(y)y=!1,I();else{var K="POP";f.confirmTransitionTo(Y,K,l,function(Q){Q?I({action:K,location:Y}):b(Y)})}}function b(Y){var K=H.location,Q=G.indexOf(K.key);Q===-1&&(Q=0);var P=G.indexOf(Y.key);P===-1&&(P=0);var ne=Q-P;ne&&(y=!0,Z(ne))}var w=d(cK()),G=[w.key];function x(Y){return u+so(Y)}function B(Y,K){var Q="PUSH",P=Oo(Y,K,h(),H.location);f.confirmTransitionTo(P,Q,l,function(ne){if(ne){var oe=x(P),$=P.key,de=P.state;if(t)if(e.pushState({key:$,state:de},null,oe),o)window.location.href=oe;else{var ge=G.indexOf(H.location.key),se=G.slice(0,ge+1);se.push(P.key),G=se,I({action:Q,location:P})}else window.location.href=oe}})}function R(Y,K){var Q="REPLACE",P=Oo(Y,K,h(),H.location);f.confirmTransitionTo(P,Q,l,function(ne){if(ne){var oe=x(P),$=P.key,de=P.state;if(t)if(e.replaceState({key:$,state:de},null,oe),o)window.location.replace(oe);else{var ge=G.indexOf(H.location.key);ge!==-1&&(G[ge]=P.key),I({action:Q,location:P})}else window.location.replace(oe)}})}function Z(Y){e.go(Y)}function W(){Z(-1)}function F(){Z(1)}var T=0;function V(Y){T+=Y,T===1&&Y===1?(window.addEventListener(aK,A),i&&window.addEventListener(lK,p)):T===0&&(window.removeEventListener(aK,A),i&&window.removeEventListener(lK,p))}var z=!1;function U(Y){Y===void 0&&(Y=!1);var K=f.setPrompt(Y);return z||(V(1),z=!0),function(){return z&&(z=!1,V(-1)),K()}}function J(Y){var K=f.appendListener(Y);return V(1),function(){V(-1),K()}}var H={length:e.length,action:"POP",location:w,createHref:x,push:B,replace:R,go:Z,goBack:W,goForward:F,block:U,listen:J};return H}var gK="hashchange",CSe={hashbang:{encodePath:function(e){return e.charAt(0)==="!"?e:"!/"+oK(e)},decodePath:function(e){return e.charAt(0)==="!"?e.substr(1):e}},noslash:{encodePath:oK,decodePath:D0},slash:{encodePath:D0,decodePath:D0}};function A6(n){var e=n.indexOf("#");return e===-1?n:n.slice(0,e)}function Fm(){var n=window.location.href,e=n.indexOf("#");return e===-1?"":n.substring(e+1)}function pSe(n){window.location.hash=n}function QZ(n){window.location.replace(A6(window.location.href)+"#"+n)}function mSe(n){n===void 0&&(n={}),f6||Nf(!1);var e=window.history;fSe();var t=n,i=t.getUserConfirmation,r=i===void 0?I6:i,s=t.hashType,o=s===void 0?"slash":s,a=n.basename?h6(D0(n.basename)):"",l=CSe[o],c=l.encodePath,g=l.decodePath;function u(){var K=g(Fm());return a&&(K=d6(K,a)),Oo(K)}var d=ET();function h(K){pt(Y,K),Y.length=e.length,d.notifyListeners(Y.location,Y.action)}var f=!1,I=null;function A(K,Q){return K.pathname===Q.pathname&&K.search===Q.search&&K.hash===Q.hash}function p(){var K=Fm(),Q=c(K);if(K!==Q)QZ(Q);else{var P=u(),ne=Y.location;if(!f&&A(ne,P)||I===so(P))return;I=null,y(P)}}function y(K){if(f)f=!1,h();else{var Q="POP";d.confirmTransitionTo(K,Q,r,function(P){P?h({action:Q,location:K}):v(K)})}}function v(K){var Q=Y.location,P=x.lastIndexOf(so(Q));P===-1&&(P=0);var ne=x.lastIndexOf(so(K));ne===-1&&(ne=0);var oe=P-ne;oe&&(f=!0,W(oe))}var b=Fm(),w=c(b);b!==w&&QZ(w);var G=u(),x=[so(G)];function B(K){var Q=document.querySelector("base"),P="";return Q&&Q.getAttribute("href")&&(P=A6(window.location.href)),P+"#"+c(a+so(K))}function R(K,Q){var P="PUSH",ne=Oo(K,void 0,void 0,Y.location);d.confirmTransitionTo(ne,P,r,function(oe){if(oe){var $=so(ne),de=c(a+$),ge=Fm()!==de;if(ge){I=$,pSe(de);var se=x.lastIndexOf(so(Y.location)),k=x.slice(0,se+1);k.push($),x=k,h({action:P,location:ne})}else h()}})}function Z(K,Q){var P="REPLACE",ne=Oo(K,void 0,void 0,Y.location);d.confirmTransitionTo(ne,P,r,function(oe){if(oe){var $=so(ne),de=c(a+$),ge=Fm()!==de;ge&&(I=$,QZ(de));var se=x.indexOf(so(Y.location));se!==-1&&(x[se]=$),h({action:P,location:ne})}})}function W(K){e.go(K)}function F(){W(-1)}function T(){W(1)}var V=0;function z(K){V+=K,V===1&&K===1?window.addEventListener(gK,p):V===0&&window.removeEventListener(gK,p)}var U=!1;function J(K){K===void 0&&(K=!1);var Q=d.setPrompt(K);return U||(z(1),U=!0),function(){return U&&(U=!1,z(-1)),Q()}}function H(K){var Q=d.appendListener(K);return z(1),function(){z(-1),Q()}}var Y={length:e.length,action:"POP",location:G,createHref:B,push:R,replace:Z,go:W,goBack:F,goForward:T,block:J,listen:H};return Y}function uK(n,e,t){return Math.min(Math.max(n,e),t)}function ySe(n){n===void 0&&(n={});var e=n,t=e.getUserConfirmation,i=e.initialEntries,r=i===void 0?["/"]:i,s=e.initialIndex,o=s===void 0?0:s,a=e.keyLength,l=a===void 0?6:a,c=ET();function g(B){pt(x,B),x.length=x.entries.length,c.notifyListeners(x.location,x.action)}function u(){return Math.random().toString(36).substr(2,l)}var d=uK(o,0,r.length-1),h=r.map(function(B){return typeof B=="string"?Oo(B,void 0,u()):Oo(B,void 0,B.key||u())}),f=so;function I(B,R){var Z="PUSH",W=Oo(B,R,u(),x.location);c.confirmTransitionTo(W,Z,t,function(F){if(F){var T=x.index,V=T+1,z=x.entries.slice(0);z.length>V?z.splice(V,z.length-V,W):z.push(W),g({action:Z,location:W,index:V,entries:z})}})}function A(B,R){var Z="REPLACE",W=Oo(B,R,u(),x.location);c.confirmTransitionTo(W,Z,t,function(F){F&&(x.entries[x.index]=W,g({action:Z,location:W}))})}function p(B){var R=uK(x.index+B,0,x.entries.length-1),Z="POP",W=x.entries[R];c.confirmTransitionTo(W,Z,t,function(F){F?g({action:Z,location:W,index:R}):g()})}function y(){p(-1)}function v(){p(1)}function b(B){var R=x.index+B;return R>=0&&R<x.entries.length}function w(B){return B===void 0&&(B=!1),c.setPrompt(B)}function G(B){return c.appendListener(B)}var x={length:h.length,action:"POP",location:h[d],index:d,entries:h,createHref:f,push:I,replace:A,go:p,goBack:y,goForward:v,canGo:b,block:w,listen:G};return x}var OZ=1073741823,dK=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{};function vSe(){var n="__global_unique_id__";return dK[n]=(dK[n]||0)+1}function bSe(n,e){return n===e?n!==0||1/n===1/e:n!==n&&e!==e}function BSe(n){var e=[];return{on:function(i){e.push(i)},off:function(i){e=e.filter(function(r){return r!==i})},get:function(){return n},set:function(i,r){n=i,e.forEach(function(s){return s(n,r)})}}}function GSe(n){return Array.isArray(n)?n[0]:n}function wSe(n,e){var t,i,r="__create-react-context-"+vSe()+"__",s=function(a){Mc(l,a);function l(){var g;return g=a.apply(this,arguments)||this,g.emitter=BSe(g.props.value),g}var c=l.prototype;return c.getChildContext=function(){var u;return u={},u[r]=this.emitter,u},c.componentWillReceiveProps=function(u){if(this.props.value!==u.value){var d=this.props.value,h=u.value,f;bSe(d,h)?f=0:(f=typeof e=="function"?e(d,h):OZ,f|=0,f!==0&&this.emitter.set(u.value,f))}},c.render=function(){return this.props.children},l}(M.Component);s.childContextTypes=(t={},t[r]=ln.object.isRequired,t);var o=function(a){Mc(l,a);function l(){var g;return g=a.apply(this,arguments)||this,g.state={value:g.getValue()},g.onUpdate=function(u,d){var h=g.observedBits|0;h&d&&g.setState({value:g.getValue()})},g}var c=l.prototype;return c.componentWillReceiveProps=function(u){var d=u.observedBits;this.observedBits=d??OZ},c.componentDidMount=function(){this.context[r]&&this.context[r].on(this.onUpdate);var u=this.props.observedBits;this.observedBits=u??OZ},c.componentWillUnmount=function(){this.context[r]&&this.context[r].off(this.onUpdate)},c.getValue=function(){return this.context[r]?this.context[r].get():n},c.render=function(){return GSe(this.props.children)(this.state.value)},l}(M.Component);return o.contextTypes=(i={},i[r]=ln.object,i),{Provider:s,Consumer:o}}var xSe=L.createContext||wSe,$C={exports:{}},SSe=Array.isArray||function(n){return Object.prototype.toString.call(n)=="[object Array]"},D2=SSe;$C.exports=m6;$C.exports.parse=WT;$C.exports.compile=ZSe;$C.exports.tokensToFunction=C6;$C.exports.tokensToRegExp=p6;var RSe=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function WT(n,e){for(var t=[],i=0,r=0,s="",o=e&&e.delimiter||"/",a;(a=RSe.exec(n))!=null;){var l=a[0],c=a[1],g=a.index;if(s+=n.slice(r,g),r=g+l.length,c){s+=c[1];continue}var u=n[r],d=a[2],h=a[3],f=a[4],I=a[5],A=a[6],p=a[7];s&&(t.push(s),s="");var y=d!=null&&u!=null&&u!==d,v=A==="+"||A==="*",b=A==="?"||A==="*",w=a[2]||o,G=f||I;t.push({name:h||i++,prefix:d||"",delimiter:w,optional:b,repeat:v,partial:y,asterisk:!!p,pattern:G?WSe(G):p?".*":"[^"+x1(w)+"]+?"})}return r<n.length&&(s+=n.substr(r)),s&&t.push(s),t}function ZSe(n,e){return C6(WT(n,e),e)}function MSe(n){return encodeURI(n).replace(/[\/?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function ESe(n){return encodeURI(n).replace(/[?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function C6(n,e){for(var t=new Array(n.length),i=0;i<n.length;i++)typeof n[i]=="object"&&(t[i]=new RegExp("^(?:"+n[i].pattern+")$",_T(e)));return function(r,s){for(var o="",a=r||{},l=s||{},c=l.pretty?MSe:encodeURIComponent,g=0;g<n.length;g++){var u=n[g];if(typeof u=="string"){o+=u;continue}var d=a[u.name],h;if(d==null)if(u.optional){u.partial&&(o+=u.prefix);continue}else throw new TypeError('Expected "'+u.name+'" to be defined');if(D2(d)){if(!u.repeat)throw new TypeError('Expected "'+u.name+'" to not repeat, but received `'+JSON.stringify(d)+"`");if(d.length===0){if(u.optional)continue;throw new TypeError('Expected "'+u.name+'" to not be empty')}for(var f=0;f<d.length;f++){if(h=c(d[f]),!t[g].test(h))throw new TypeError('Expected all "'+u.name+'" to match "'+u.pattern+'", but received `'+JSON.stringify(h)+"`");o+=(f===0?u.prefix:u.delimiter)+h}continue}if(h=u.asterisk?ESe(d):c(d),!t[g].test(h))throw new TypeError('Expected "'+u.name+'" to match "'+u.pattern+'", but received "'+h+'"');o+=u.prefix+h}return o}}function x1(n){return n.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function WSe(n){return n.replace(/([=!:$\/()])/g,"\\$1")}function FT(n,e){return n.keys=e,n}function _T(n){return n&&n.sensitive?"":"i"}function FSe(n,e){var t=n.source.match(/\((?!\?)/g);if(t)for(var i=0;i<t.length;i++)e.push({name:i,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return FT(n,e)}function _Se(n,e,t){for(var i=[],r=0;r<n.length;r++)i.push(m6(n[r],e,t).source);var s=new RegExp("(?:"+i.join("|")+")",_T(t));return FT(s,e)}function VSe(n,e,t){return p6(WT(n,t),e,t)}function p6(n,e,t){D2(e)||(t=e||t,e=[]),t=t||{};for(var i=t.strict,r=t.end!==!1,s="",o=0;o<n.length;o++){var a=n[o];if(typeof a=="string")s+=x1(a);else{var l=x1(a.prefix),c="(?:"+a.pattern+")";e.push(a),a.repeat&&(c+="(?:"+l+c+")*"),a.optional?a.partial?c=l+"("+c+")?":c="(?:"+l+"("+c+"))?":c=l+"("+c+")",s+=c}}var g=x1(t.delimiter||"/"),u=s.slice(-g.length)===g;return i||(s=(u?s.slice(0,-g.length):s)+"(?:"+g+"(?=$))?"),r?s+="$":s+=i&&u?"":"(?="+g+"|$)",FT(new RegExp("^"+s,_T(t)),e)}function m6(n,e,t){return D2(e)||(t=e||t,e=[]),t=t||{},n instanceof RegExp?FSe(n,e):D2(n)?_Se(n,e,t):VSe(n,e,t)}var TSe=$C.exports;const NSe=Ks(TSe);var y6={exports:{}},Mn={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vr=typeof Symbol=="function"&&Symbol.for,VT=vr?Symbol.for("react.element"):60103,TT=vr?Symbol.for("react.portal"):60106,ux=vr?Symbol.for("react.fragment"):60107,dx=vr?Symbol.for("react.strict_mode"):60108,hx=vr?Symbol.for("react.profiler"):60114,fx=vr?Symbol.for("react.provider"):60109,Ix=vr?Symbol.for("react.context"):60110,NT=vr?Symbol.for("react.async_mode"):60111,Ax=vr?Symbol.for("react.concurrent_mode"):60111,Cx=vr?Symbol.for("react.forward_ref"):60112,px=vr?Symbol.for("react.suspense"):60113,kSe=vr?Symbol.for("react.suspense_list"):60120,mx=vr?Symbol.for("react.memo"):60115,yx=vr?Symbol.for("react.lazy"):60116,LSe=vr?Symbol.for("react.block"):60121,HSe=vr?Symbol.for("react.fundamental"):60117,zSe=vr?Symbol.for("react.responder"):60118,XSe=vr?Symbol.for("react.scope"):60119;function la(n){if(typeof n=="object"&&n!==null){var e=n.$$typeof;switch(e){case VT:switch(n=n.type,n){case NT:case Ax:case ux:case hx:case dx:case px:return n;default:switch(n=n&&n.$$typeof,n){case Ix:case Cx:case yx:case mx:case fx:return n;default:return e}}case TT:return e}}}function v6(n){return la(n)===Ax}Mn.AsyncMode=NT;Mn.ConcurrentMode=Ax;Mn.ContextConsumer=Ix;Mn.ContextProvider=fx;Mn.Element=VT;Mn.ForwardRef=Cx;Mn.Fragment=ux;Mn.Lazy=yx;Mn.Memo=mx;Mn.Portal=TT;Mn.Profiler=hx;Mn.StrictMode=dx;Mn.Suspense=px;Mn.isAsyncMode=function(n){return v6(n)||la(n)===NT};Mn.isConcurrentMode=v6;Mn.isContextConsumer=function(n){return la(n)===Ix};Mn.isContextProvider=function(n){return la(n)===fx};Mn.isElement=function(n){return typeof n=="object"&&n!==null&&n.$$typeof===VT};Mn.isForwardRef=function(n){return la(n)===Cx};Mn.isFragment=function(n){return la(n)===ux};Mn.isLazy=function(n){return la(n)===yx};Mn.isMemo=function(n){return la(n)===mx};Mn.isPortal=function(n){return la(n)===TT};Mn.isProfiler=function(n){return la(n)===hx};Mn.isStrictMode=function(n){return la(n)===dx};Mn.isSuspense=function(n){return la(n)===px};Mn.isValidElementType=function(n){return typeof n=="string"||typeof n=="function"||n===ux||n===Ax||n===hx||n===dx||n===px||n===kSe||typeof n=="object"&&n!==null&&(n.$$typeof===yx||n.$$typeof===mx||n.$$typeof===fx||n.$$typeof===Ix||n.$$typeof===Cx||n.$$typeof===HSe||n.$$typeof===zSe||n.$$typeof===XSe||n.$$typeof===LSe)};Mn.typeOf=la;y6.exports=Mn;var YSe=y6.exports;function vx(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}var b6=YSe,KSe={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},DSe={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},B6={};B6[b6.ForwardRef]=KSe;B6[b6.Memo]=DSe;var G6=function(e){var t=xSe();return t.displayName=e,t},PSe=G6("Router-History"),vC=G6("Router"),bx=function(n){Mc(e,n),e.computeRootMatch=function(r){return{path:"/",url:"/",params:{},isExact:r==="/"}};function e(i){var r;return r=n.call(this,i)||this,r.state={location:i.history.location},r._isMounted=!1,r._pendingLocation=null,i.staticContext||(r.unlisten=i.history.listen(function(s){r._isMounted?r.setState({location:s}):r._pendingLocation=s})),r}var t=e.prototype;return t.componentDidMount=function(){this._isMounted=!0,this._pendingLocation&&this.setState({location:this._pendingLocation})},t.componentWillUnmount=function(){this.unlisten&&(this.unlisten(),this._isMounted=!1,this._pendingLocation=null)},t.render=function(){return L.createElement(vC.Provider,{value:{history:this.props.history,location:this.state.location,match:e.computeRootMatch(this.state.location.pathname),staticContext:this.props.staticContext}},L.createElement(PSe.Provider,{children:this.props.children||null,value:this.props.history}))},e}(L.Component);L.Component;L.Component;var hK={},USe=1e4,fK=0;function QSe(n,e){var t=""+e.end+e.strict+e.sensitive,i=hK[t]||(hK[t]={});if(i[n])return i[n];var r=[],s=NSe(n,r,e),o={regexp:s,keys:r};return fK<USe&&(i[n]=o,fK++),o}function kT(n,e){e===void 0&&(e={}),(typeof e=="string"||Array.isArray(e))&&(e={path:e});var t=e,i=t.path,r=t.exact,s=r===void 0?!1:r,o=t.strict,a=o===void 0?!1:o,l=t.sensitive,c=l===void 0?!1:l,g=[].concat(i);return g.reduce(function(u,d){if(!d&&d!=="")return null;if(u)return u;var h=QSe(d,{end:s,strict:a,sensitive:c}),f=h.regexp,I=h.keys,A=f.exec(n);if(!A)return null;var p=A[0],y=A.slice(1),v=n===p;return s&&!v?null:{path:d,url:d==="/"&&p===""?"/":p,isExact:v,params:I.reduce(function(b,w,G){return b[w.name]=y[G],b},{})}},null)}function OSe(n){return L.Children.count(n)===0}var IK=function(n){Mc(e,n);function e(){return n.apply(this,arguments)||this}var t=e.prototype;return t.render=function(){var r=this;return L.createElement(vC.Consumer,null,function(s){s||Nf(!1);var o=r.props.location||s.location,a=r.props.computedMatch?r.props.computedMatch:r.props.path?kT(o.pathname,r.props):s.match,l=pt({},s,{location:o,match:a}),c=r.props,g=c.children,u=c.component,d=c.render;return Array.isArray(g)&&OSe(g)&&(g=null),L.createElement(vC.Provider,{value:l},l.match?g?typeof g=="function"?g(l):g:u?L.createElement(u,l):d?d(l):null:typeof g=="function"?g(l):null)})},e}(L.Component);function LT(n){return n.charAt(0)==="/"?n:"/"+n}function JSe(n,e){return n?pt({},e,{pathname:LT(n)+e.pathname}):e}function jSe(n,e){if(!n)return e;var t=LT(n);return e.pathname.indexOf(t)!==0?e:pt({},e,{pathname:e.pathname.substr(t.length)})}function AK(n){return typeof n=="string"?n:so(n)}function JZ(n){return function(){Nf(!1)}}function CK(){}L.Component;var qSe=function(n){Mc(e,n);function e(){return n.apply(this,arguments)||this}var t=e.prototype;return t.render=function(){var r=this;return L.createElement(vC.Consumer,null,function(s){s||Nf(!1);var o=r.props.location||s.location,a,l;return L.Children.forEach(r.props.children,function(c){if(l==null&&L.isValidElement(c)){a=c;var g=c.props.path||c.props.from;l=g?kT(o.pathname,pt({},c.props,{path:g})):s.match}}),l?L.cloneElement(a,{location:o,computedMatch:l}):null})},e}(L.Component);L.useContext;L.Component;var $Se=function(n){Mc(e,n);function e(){for(var i,r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=n.call.apply(n,[this].concat(s))||this,i.history=mSe(i.props),i}var t=e.prototype;return t.render=function(){return L.createElement(bx,{history:this.history,children:this.props.children})},e}(L.Component),QW=function(e,t){return typeof e=="function"?e(t):e},OW=function(e,t){return typeof e=="string"?Oo(e,null,null,t):e},HT=function(e){return e},bC=L.forwardRef;typeof bC>"u"&&(bC=HT);function eRe(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}var tRe=bC(function(n,e){var t=n.innerRef,i=n.navigate,r=n.onClick,s=vx(n,["innerRef","navigate","onClick"]),o=s.target,a=pt({},s,{onClick:function(c){try{r&&r(c)}catch(g){throw c.preventDefault(),g}!c.defaultPrevented&&c.button===0&&(!o||o==="_self")&&!eRe(c)&&(c.preventDefault(),i())}});return HT!==bC?a.ref=e||t:a.ref=t,L.createElement("a",a)}),w6=bC(function(n,e){var t=n.component,i=t===void 0?tRe:t,r=n.replace,s=n.to,o=n.innerRef,a=vx(n,["component","replace","to","innerRef"]);return L.createElement(vC.Consumer,null,function(l){l||Nf(!1);var c=l.history,g=OW(QW(s,l.location),l.location),u=g?c.createHref(g):"",d=pt({},a,{href:u,navigate:function(){var f=QW(s,l.location),I=so(l.location)===so(OW(f)),A=r||I?c.replace:c.push;A(f)}});return HT!==bC?d.ref=e||o:d.innerRef=o,L.createElement(i,d)})}),x6=function(e){return e},P2=L.forwardRef;typeof P2>"u"&&(P2=x6);function nRe(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return e.filter(function(i){return i}).join(" ")}P2(function(n,e){var t=n["aria-current"],i=t===void 0?"page":t,r=n.activeClassName,s=r===void 0?"active":r,o=n.activeStyle,a=n.className,l=n.exact,c=n.isActive,g=n.location,u=n.sensitive,d=n.strict,h=n.style,f=n.to,I=n.innerRef,A=vx(n,["aria-current","activeClassName","activeStyle","className","exact","isActive","location","sensitive","strict","style","to","innerRef"]);return L.createElement(vC.Consumer,null,function(p){p||Nf(!1);var y=g||p.location,v=OW(QW(f,y),y),b=v.pathname,w=b&&b.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1"),G=w?kT(y.pathname,{path:w,exact:l,sensitive:u,strict:d}):null,x=!!(c?c(G,y):G),B=x?nRe(a,s):a,R=x?pt({},h,o):h,Z=pt({"aria-current":x&&i||null,className:B,style:R,to:v},A);return x6!==P2?Z.ref=e||I:Z.innerRef=I,L.createElement(w6,Z)})});const iRe=()=>{const{progress:n}=gJ(),{play:e,end:t,setPlay:i,hasScroll:r}=IT(),[s,o]=M.useState(!1),a=M.useRef(new Audio(aSe)),l=()=>{a.current.play(),o(!0)},c=()=>{a.current.pause(),o(!1)};return M.useEffect(()=>{t&&i(!1)},[t,i]),cn("div",{className:`overlay ${e?"overlay--disable":""}
    ${r?"overlay--scrolled":""}`,children:[We("div",{className:`loader ${n===100?"loader--disappear":""}`}),n===100&&cn("div",{className:`intro ${t||e?"intro--disappear":""}`,children:[cn("h1",{className:"logo",children:["SPUSEUM",We("div",{className:"spinner",children:We("div",{className:"spinner__image"})})]}),s?cn("div",{class:"loading-wave",children:[We("button",{className:"PauseMusic",onClick:c,children:"Pause"}),We("div",{className:"loading-bar"}),We("div",{className:"loading-bar"}),We("div",{className:"loading-bar"}),We("div",{className:"loading-bar"})]}):We("button",{className:"music",onClick:l,children:"Start Music"}),We("p",{className:"intro__scroll",children:"Scroll to begin the journey"}),We("button",{className:"explore",onClick:()=>{i(!0)},children:"Explore"})]}),We("div",{className:`outro ${t?"outro--appear":""}`,children:We("p",{className:"outro__text",children:"Wish you had a great flight with us..."})}),We("div",{className:`outro ${t?"outro--appear":""}`,children:cn("div",{class:"card",children:[cn("div",{class:"align",children:[We("span",{class:"red"}),We("span",{class:"yellow"}),We("span",{class:"green"})]}),We("p",{className:"Vrp",children:"Explore Our Museum From Your Home Using VR"}),We("nav",{children:We(w6,{class:"bn",to:"/vrshow",children:"Go To VrShow"})})]})})]})};function rRe(){const{play:n,end:e}=IT(),t=M.useMemo(()=>We(oye,{children:We(gye,{opacity:.2})}),[]);return cn("div",{className:"slideShow",children:[cn(lJ,{children:[We("color",{attach:"background",args:["#ececec"]}),We(rhe,{pages:n&&!e?20:0,damping:.5,style:{top:"10px",left:"0px",bottom:"10px",right:"10px",width:"auto",height:"auto",animation:"fadeIn 2.4s ease-in-out 1.2s forwards",opacity:0},children:We(oSe,{})}),t]}),We(iRe,{})]})}/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const S6="151",JW=0,R6=1,Bx=2,sRe=0,pK=1,oRe=100,aRe=204,lRe=205,cRe=3,Z6=0,M6=0,E6=300,gRe=301,mK=1e3,wA=1001,yK=1002,U2=1003,BC=1006,zT=1008,oc=1009,S1=1015,R1=1016,Yh=1023,AG=1028,CG=1030,uRe=33776,dRe=33779,hRe=35840,fRe=35842,IRe=36196,ARe=37492,CRe=37496,pRe=37808,mRe=36492,XT=3e3,Z1=3001,YT=0,Ag="srgb",KT="srgb-linear",W6="display-p3",jZ=7680,yRe=519,vK=35044;class kv{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const jr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let bK=1234567;const P0=Math.PI/180,Q2=180/Math.PI;function ep(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(jr[n&255]+jr[n>>8&255]+jr[n>>16&255]+jr[n>>24&255]+"-"+jr[e&255]+jr[e>>8&255]+"-"+jr[e>>16&15|64]+jr[e>>24&255]+"-"+jr[t&63|128]+jr[t>>8&255]+"-"+jr[t>>16&255]+jr[t>>24&255]+jr[i&255]+jr[i>>8&255]+jr[i>>16&255]+jr[i>>24&255]).toLowerCase()}function Fs(n,e,t){return Math.max(e,Math.min(t,n))}function DT(n,e){return(n%e+e)%e}function vRe(n,e,t,i,r){return i+(n-e)*(r-i)/(t-e)}function bRe(n,e,t){return n!==e?(t-n)/(e-n):0}function U0(n,e,t){return(1-t)*n+t*e}function BRe(n,e,t,i){return U0(n,e,1-Math.exp(-t*i))}function GRe(n,e=1){return e-Math.abs(DT(n,e*2)-e)}function wRe(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function xRe(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function SRe(n,e){return n+Math.floor(Math.random()*(e-n+1))}function RRe(n,e){return n+Math.random()*(e-n)}function ZRe(n){return n*(.5-Math.random())}function MRe(n){n!==void 0&&(bK=n);let e=bK+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function ERe(n){return n*P0}function WRe(n){return n*Q2}function FRe(n){return(n&n-1)===0&&n!==0}function _Re(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function VRe(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function TRe(n,e,t,i,r){const s=Math.cos,o=Math.sin,a=s(t/2),l=o(t/2),c=s((e+i)/2),g=o((e+i)/2),u=s((e-i)/2),d=o((e-i)/2),h=s((i-e)/2),f=o((i-e)/2);switch(r){case"XYX":n.set(a*g,l*u,l*d,a*c);break;case"YZY":n.set(l*d,a*g,l*u,a*c);break;case"ZXZ":n.set(l*u,l*d,a*g,a*c);break;case"XZX":n.set(a*g,l*f,l*h,a*c);break;case"YXY":n.set(l*h,a*g,l*f,a*c);break;case"ZYZ":n.set(l*f,l*h,a*g,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function c0(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function no(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const xA={DEG2RAD:P0,RAD2DEG:Q2,generateUUID:ep,clamp:Fs,euclideanModulo:DT,mapLinear:vRe,inverseLerp:bRe,lerp:U0,damp:BRe,pingpong:GRe,smoothstep:wRe,smootherstep:xRe,randInt:SRe,randFloat:RRe,randFloatSpread:ZRe,seededRandom:MRe,degToRad:ERe,radToDeg:WRe,isPowerOfTwo:FRe,ceilPowerOfTwo:_Re,floorPowerOfTwo:VRe,setQuaternionFromProperEuler:TRe,normalize:no,denormalize:c0};class mn{constructor(e=0,t=0){mn.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Fs(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*i-o*r+e.x,this.y=s*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Wd{constructor(){Wd.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,r,s,o,a,l,c){const g=this.elements;return g[0]=e,g[1]=r,g[2]=a,g[3]=t,g[4]=s,g[5]=l,g[6]=i,g[7]=o,g[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],g=i[4],u=i[7],d=i[2],h=i[5],f=i[8],I=r[0],A=r[3],p=r[6],y=r[1],v=r[4],b=r[7],w=r[2],G=r[5],x=r[8];return s[0]=o*I+a*y+l*w,s[3]=o*A+a*v+l*G,s[6]=o*p+a*b+l*x,s[1]=c*I+g*y+u*w,s[4]=c*A+g*v+u*G,s[7]=c*p+g*b+u*x,s[2]=d*I+h*y+f*w,s[5]=d*A+h*v+f*G,s[8]=d*p+h*b+f*x,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],g=e[8];return t*o*g-t*a*c-i*s*g+i*a*l+r*s*c-r*o*l}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],g=e[8],u=g*o-a*c,d=a*l-g*s,h=c*s-o*l,f=t*u+i*d+r*h;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);const I=1/f;return e[0]=u*I,e[1]=(r*c-g*i)*I,e[2]=(a*i-r*o)*I,e[3]=d*I,e[4]=(g*t-r*l)*I,e[5]=(r*s-a*t)*I,e[6]=h*I,e[7]=(i*l-c*t)*I,e[8]=(o*t-i*s)*I,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-r*c,r*l,-r*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(qZ.makeScale(e,t)),this}rotate(e){return this.premultiply(qZ.makeRotation(-e)),this}translate(e,t){return this.premultiply(qZ.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const qZ=new Wd;function NRe(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function jW(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function UA(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function $Z(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}const kRe=new Wd().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),LRe=new Wd().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);function HRe(n){return n.convertSRGBToLinear().applyMatrix3(LRe)}function zRe(n){return n.applyMatrix3(kRe).convertLinearToSRGB()}const XRe={[KT]:n=>n,[Ag]:n=>n.convertSRGBToLinear(),[W6]:HRe},YRe={[KT]:n=>n,[Ag]:n=>n.convertLinearToSRGB(),[W6]:zRe},Ho={enabled:!1,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(n){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!n},get workingColorSpace(){return KT},set workingColorSpace(n){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(n,e,t){if(this.enabled===!1||e===t||!e||!t)return n;const i=XRe[e],r=YRe[t];if(i===void 0||r===void 0)throw new Error(`Unsupported color space conversion, "${e}" to "${t}".`);return r(i(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this.workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this.workingColorSpace)}};let _I;class KRe{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{_I===void 0&&(_I=jW("canvas")),_I.width=e.width,_I.height=e.height;const i=_I.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=_I}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=jW("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=UA(s[o]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(UA(t[i]/255)*255):t[i]=UA(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class F6{constructor(e=null){this.isSource=!0,this.uuid=ep(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(eM(r[o].image)):s.push(eM(r[o]))}else s=eM(r);i.url=s}return t||(e.images[this.uuid]=i),i}}function eM(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?KRe.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let DRe=0;class Bo extends kv{constructor(e=Bo.DEFAULT_IMAGE,t=Bo.DEFAULT_MAPPING,i=wA,r=wA,s=BC,o=zT,a=Yh,l=oc,c=Bo.DEFAULT_ANISOTROPY,g=XT){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:DRe++}),this.uuid=ep(),this.name="",this.source=new F6(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new mn(0,0),this.repeat=new mn(1,1),this.center=new mn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Wd,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=g,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==E6)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case mK:e.x=e.x-Math.floor(e.x);break;case wA:e.x=e.x<0?0:1;break;case yK:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case mK:e.y=e.y-Math.floor(e.y);break;case wA:e.y=e.y<0?0:1;break;case yK:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}Bo.DEFAULT_IMAGE=null;Bo.DEFAULT_MAPPING=E6;Bo.DEFAULT_ANISOTROPY=1;class O2{constructor(e=0,t=0,i=0,r=1){O2.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s;const l=e.elements,c=l[0],g=l[4],u=l[8],d=l[1],h=l[5],f=l[9],I=l[2],A=l[6],p=l[10];if(Math.abs(g-d)<.01&&Math.abs(u-I)<.01&&Math.abs(f-A)<.01){if(Math.abs(g+d)<.1&&Math.abs(u+I)<.1&&Math.abs(f+A)<.1&&Math.abs(c+h+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const v=(c+1)/2,b=(h+1)/2,w=(p+1)/2,G=(g+d)/4,x=(u+I)/4,B=(f+A)/4;return v>b&&v>w?v<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(v),r=G/i,s=x/i):b>w?b<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(b),i=G/r,s=B/r):w<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(w),i=x/s,r=B/s),this.set(i,r,s,t),this}let y=Math.sqrt((A-f)*(A-f)+(u-I)*(u-I)+(d-g)*(d-g));return Math.abs(y)<.001&&(y=1),this.x=(A-f)/y,this.y=(u-I)/y,this.z=(d-g)/y,this.w=Math.acos((c+h+p-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class _6 extends kv{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new O2(0,0,e,t),this.scissorTest=!1,this.viewport=new O2(0,0,e,t);const r={width:e,height:t,depth:1};this.texture=new Bo(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:BC,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new F6(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class PRe extends Bo{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=U2,this.minFilter=U2,this.wrapR=wA,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}let Ns=class{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,o,a){let l=i[r+0],c=i[r+1],g=i[r+2],u=i[r+3];const d=s[o+0],h=s[o+1],f=s[o+2],I=s[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=g,e[t+3]=u;return}if(a===1){e[t+0]=d,e[t+1]=h,e[t+2]=f,e[t+3]=I;return}if(u!==I||l!==d||c!==h||g!==f){let A=1-a;const p=l*d+c*h+g*f+u*I,y=p>=0?1:-1,v=1-p*p;if(v>Number.EPSILON){const w=Math.sqrt(v),G=Math.atan2(w,p*y);A=Math.sin(A*G)/w,a=Math.sin(a*G)/w}const b=a*y;if(l=l*A+d*b,c=c*A+h*b,g=g*A+f*b,u=u*A+I*b,A===1-a){const w=1/Math.sqrt(l*l+c*c+g*g+u*u);l*=w,c*=w,g*=w,u*=w}}e[t]=l,e[t+1]=c,e[t+2]=g,e[t+3]=u}static multiplyQuaternionsFlat(e,t,i,r,s,o){const a=i[r],l=i[r+1],c=i[r+2],g=i[r+3],u=s[o],d=s[o+1],h=s[o+2],f=s[o+3];return e[t]=a*f+g*u+l*h-c*d,e[t+1]=l*f+g*d+c*u-a*h,e[t+2]=c*f+g*h+a*d-l*u,e[t+3]=g*f-a*u-l*d-c*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const i=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),g=a(r/2),u=a(s/2),d=l(i/2),h=l(r/2),f=l(s/2);switch(o){case"XYZ":this._x=d*g*u+c*h*f,this._y=c*h*u-d*g*f,this._z=c*g*f+d*h*u,this._w=c*g*u-d*h*f;break;case"YXZ":this._x=d*g*u+c*h*f,this._y=c*h*u-d*g*f,this._z=c*g*f-d*h*u,this._w=c*g*u+d*h*f;break;case"ZXY":this._x=d*g*u-c*h*f,this._y=c*h*u+d*g*f,this._z=c*g*f+d*h*u,this._w=c*g*u-d*h*f;break;case"ZYX":this._x=d*g*u-c*h*f,this._y=c*h*u+d*g*f,this._z=c*g*f-d*h*u,this._w=c*g*u+d*h*f;break;case"YZX":this._x=d*g*u+c*h*f,this._y=c*h*u+d*g*f,this._z=c*g*f-d*h*u,this._w=c*g*u-d*h*f;break;case"XZY":this._x=d*g*u-c*h*f,this._y=c*h*u-d*g*f,this._z=c*g*f+d*h*u,this._w=c*g*u+d*h*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],c=t[2],g=t[6],u=t[10],d=i+a+u;if(d>0){const h=.5/Math.sqrt(d+1);this._w=.25/h,this._x=(g-l)*h,this._y=(s-c)*h,this._z=(o-r)*h}else if(i>a&&i>u){const h=2*Math.sqrt(1+i-a-u);this._w=(g-l)/h,this._x=.25*h,this._y=(r+o)/h,this._z=(s+c)/h}else if(a>u){const h=2*Math.sqrt(1+a-i-u);this._w=(s-c)/h,this._x=(r+o)/h,this._y=.25*h,this._z=(l+g)/h}else{const h=2*Math.sqrt(1+u-i-a);this._w=(o-r)/h,this._x=(s+c)/h,this._y=(l+g)/h,this._z=.25*h}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Fs(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,o=e._w,a=t._x,l=t._y,c=t._z,g=t._w;return this._x=i*g+o*a+r*c-s*l,this._y=r*g+o*l+s*a-i*c,this._z=s*g+o*c+i*l-r*a,this._w=o*g-i*a-r*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+i*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const h=1-t;return this._w=h*o+t*this._w,this._x=h*i+t*this._x,this._y=h*r+t*this._y,this._z=h*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),g=Math.atan2(c,a),u=Math.sin((1-t)*g)/c,d=Math.sin(t*g)/c;return this._w=o*u+this._w*d,this._x=i*u+this._x*d,this._y=r*u+this._y*d,this._z=s*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(s),i*Math.cos(s),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}};class Ve{constructor(e=0,t=0,i=0){Ve.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(BK.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(BK.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,c=l*t+o*r-a*i,g=l*i+a*t-s*r,u=l*r+s*i-o*t,d=-s*t-o*i-a*r;return this.x=c*l+d*-s+g*-a-u*-o,this.y=g*l+d*-o+u*-s-c*-a,this.z=u*l+d*-a+c*-o-g*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=r*l-s*a,this.y=s*o-i*l,this.z=i*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return tM.copy(this).projectOnVector(e),this.sub(tM)}reflect(e){return this.sub(tM.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Fs(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const tM=new Ve,BK=new Ns;class Lv{constructor(e=new Ve(1/0,1/0,1/0),t=new Ve(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(sg.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(sg.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=sg.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){if(e.updateWorldMatrix(!1,!1),e.boundingBox!==void 0)e.boundingBox===null&&e.computeBoundingBox(),VI.copy(e.boundingBox),VI.applyMatrix4(e.matrixWorld),this.union(VI);else{const r=e.geometry;if(r!==void 0)if(t&&r.attributes!==void 0&&r.attributes.position!==void 0){const s=r.attributes.position;for(let o=0,a=s.count;o<a;o++)sg.fromBufferAttribute(s,o).applyMatrix4(e.matrixWorld),this.expandByPoint(sg)}else r.boundingBox===null&&r.computeBoundingBox(),VI.copy(r.boundingBox),VI.applyMatrix4(e.matrixWorld),this.union(VI)}const i=e.children;for(let r=0,s=i.length;r<s;r++)this.expandByObject(i[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,sg),sg.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(_m),pG.subVectors(this.max,_m),TI.subVectors(e.a,_m),NI.subVectors(e.b,_m),kI.subVectors(e.c,_m),Zu.subVectors(NI,TI),Mu.subVectors(kI,NI),ch.subVectors(TI,kI);let t=[0,-Zu.z,Zu.y,0,-Mu.z,Mu.y,0,-ch.z,ch.y,Zu.z,0,-Zu.x,Mu.z,0,-Mu.x,ch.z,0,-ch.x,-Zu.y,Zu.x,0,-Mu.y,Mu.x,0,-ch.y,ch.x,0];return!nM(t,TI,NI,kI,pG)||(t=[1,0,0,0,1,0,0,0,1],!nM(t,TI,NI,kI,pG))?!1:(mG.crossVectors(Zu,Mu),t=[mG.x,mG.y,mG.z],nM(t,TI,NI,kI,pG))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,sg).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(sg).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(rg[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),rg[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),rg[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),rg[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),rg[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),rg[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),rg[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),rg[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(rg),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const rg=[new Ve,new Ve,new Ve,new Ve,new Ve,new Ve,new Ve,new Ve],sg=new Ve,VI=new Lv,TI=new Ve,NI=new Ve,kI=new Ve,Zu=new Ve,Mu=new Ve,ch=new Ve,_m=new Ve,pG=new Ve,mG=new Ve,gh=new Ve;function nM(n,e,t,i,r){for(let s=0,o=n.length-3;s<=o;s+=3){gh.fromArray(n,s);const a=r.x*Math.abs(gh.x)+r.y*Math.abs(gh.y)+r.z*Math.abs(gh.z),l=e.dot(gh),c=t.dot(gh),g=i.dot(gh);if(Math.max(-Math.max(l,c,g),Math.min(l,c,g))>a)return!1}return!0}const URe=new Lv,Vm=new Ve,iM=new Ve;class V6{constructor(e=new Ve,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):URe.setFromPoints(e).getCenter(i);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Vm.subVectors(e,this.center);const t=Vm.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(Vm,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(iM.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Vm.copy(e.center).add(iM)),this.expandByPoint(Vm.copy(e.center).sub(iM))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const og=new Ve,rM=new Ve,yG=new Ve,Eu=new Ve,sM=new Ve,vG=new Ve,oM=new Ve;let T6=class{constructor(e=new Ve,t=new Ve(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,og)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=og.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(og.copy(this.origin).addScaledVector(this.direction,t),og.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){rM.copy(e).add(t).multiplyScalar(.5),yG.copy(t).sub(e).normalize(),Eu.copy(this.origin).sub(rM);const s=e.distanceTo(t)*.5,o=-this.direction.dot(yG),a=Eu.dot(this.direction),l=-Eu.dot(yG),c=Eu.lengthSq(),g=Math.abs(1-o*o);let u,d,h,f;if(g>0)if(u=o*l-a,d=o*a-l,f=s*g,u>=0)if(d>=-f)if(d<=f){const I=1/g;u*=I,d*=I,h=u*(u+o*d+2*a)+d*(o*u+d+2*l)+c}else d=s,u=Math.max(0,-(o*d+a)),h=-u*u+d*(d+2*l)+c;else d=-s,u=Math.max(0,-(o*d+a)),h=-u*u+d*(d+2*l)+c;else d<=-f?(u=Math.max(0,-(-o*s+a)),d=u>0?-s:Math.min(Math.max(-s,-l),s),h=-u*u+d*(d+2*l)+c):d<=f?(u=0,d=Math.min(Math.max(-s,-l),s),h=d*(d+2*l)+c):(u=Math.max(0,-(o*s+a)),d=u>0?s:Math.min(Math.max(-s,-l),s),h=-u*u+d*(d+2*l)+c);else d=o>0?-s:s,u=Math.max(0,-(o*d+a)),h=-u*u+d*(d+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,u),r&&r.copy(rM).addScaledVector(yG,d),h}intersectSphere(e,t){og.subVectors(e.center,this.origin);const i=og.dot(this.direction),r=og.dot(og)-i*i,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,o,a,l;const c=1/this.direction.x,g=1/this.direction.y,u=1/this.direction.z,d=this.origin;return c>=0?(i=(e.min.x-d.x)*c,r=(e.max.x-d.x)*c):(i=(e.max.x-d.x)*c,r=(e.min.x-d.x)*c),g>=0?(s=(e.min.y-d.y)*g,o=(e.max.y-d.y)*g):(s=(e.max.y-d.y)*g,o=(e.min.y-d.y)*g),i>o||s>r||((s>i||isNaN(i))&&(i=s),(o<r||isNaN(r))&&(r=o),u>=0?(a=(e.min.z-d.z)*u,l=(e.max.z-d.z)*u):(a=(e.max.z-d.z)*u,l=(e.min.z-d.z)*u),i>l||a>r)||((a>i||i!==i)&&(i=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,og)!==null}intersectTriangle(e,t,i,r,s){sM.subVectors(t,e),vG.subVectors(i,e),oM.crossVectors(sM,vG);let o=this.direction.dot(oM),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Eu.subVectors(this.origin,e);const l=a*this.direction.dot(vG.crossVectors(Eu,vG));if(l<0)return null;const c=a*this.direction.dot(sM.cross(Eu));if(c<0||l+c>o)return null;const g=-a*Eu.dot(oM);return g<0?null:this.at(g/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};class Go{constructor(){Go.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,r,s,o,a,l,c,g,u,d,h,f,I,A){const p=this.elements;return p[0]=e,p[4]=t,p[8]=i,p[12]=r,p[1]=s,p[5]=o,p[9]=a,p[13]=l,p[2]=c,p[6]=g,p[10]=u,p[14]=d,p[3]=h,p[7]=f,p[11]=I,p[15]=A,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Go().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/LI.setFromMatrixColumn(e,0).length(),s=1/LI.setFromMatrixColumn(e,1).length(),o=1/LI.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,s=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(r),c=Math.sin(r),g=Math.cos(s),u=Math.sin(s);if(e.order==="XYZ"){const d=o*g,h=o*u,f=a*g,I=a*u;t[0]=l*g,t[4]=-l*u,t[8]=c,t[1]=h+f*c,t[5]=d-I*c,t[9]=-a*l,t[2]=I-d*c,t[6]=f+h*c,t[10]=o*l}else if(e.order==="YXZ"){const d=l*g,h=l*u,f=c*g,I=c*u;t[0]=d+I*a,t[4]=f*a-h,t[8]=o*c,t[1]=o*u,t[5]=o*g,t[9]=-a,t[2]=h*a-f,t[6]=I+d*a,t[10]=o*l}else if(e.order==="ZXY"){const d=l*g,h=l*u,f=c*g,I=c*u;t[0]=d-I*a,t[4]=-o*u,t[8]=f+h*a,t[1]=h+f*a,t[5]=o*g,t[9]=I-d*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const d=o*g,h=o*u,f=a*g,I=a*u;t[0]=l*g,t[4]=f*c-h,t[8]=d*c+I,t[1]=l*u,t[5]=I*c+d,t[9]=h*c-f,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const d=o*l,h=o*c,f=a*l,I=a*c;t[0]=l*g,t[4]=I-d*u,t[8]=f*u+h,t[1]=u,t[5]=o*g,t[9]=-a*g,t[2]=-c*g,t[6]=h*u+f,t[10]=d-I*u}else if(e.order==="XZY"){const d=o*l,h=o*c,f=a*l,I=a*c;t[0]=l*g,t[4]=-u,t[8]=c*g,t[1]=d*u+I,t[5]=o*g,t[9]=h*u-f,t[2]=f*u-h,t[6]=a*g,t[10]=I*u+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(QRe,e,ORe)}lookAt(e,t,i){const r=this.elements;return zo.subVectors(e,t),zo.lengthSq()===0&&(zo.z=1),zo.normalize(),Wu.crossVectors(i,zo),Wu.lengthSq()===0&&(Math.abs(i.z)===1?zo.x+=1e-4:zo.z+=1e-4,zo.normalize(),Wu.crossVectors(i,zo)),Wu.normalize(),bG.crossVectors(zo,Wu),r[0]=Wu.x,r[4]=bG.x,r[8]=zo.x,r[1]=Wu.y,r[5]=bG.y,r[9]=zo.y,r[2]=Wu.z,r[6]=bG.z,r[10]=zo.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],g=i[1],u=i[5],d=i[9],h=i[13],f=i[2],I=i[6],A=i[10],p=i[14],y=i[3],v=i[7],b=i[11],w=i[15],G=r[0],x=r[4],B=r[8],R=r[12],Z=r[1],W=r[5],F=r[9],T=r[13],V=r[2],z=r[6],U=r[10],J=r[14],H=r[3],Y=r[7],K=r[11],Q=r[15];return s[0]=o*G+a*Z+l*V+c*H,s[4]=o*x+a*W+l*z+c*Y,s[8]=o*B+a*F+l*U+c*K,s[12]=o*R+a*T+l*J+c*Q,s[1]=g*G+u*Z+d*V+h*H,s[5]=g*x+u*W+d*z+h*Y,s[9]=g*B+u*F+d*U+h*K,s[13]=g*R+u*T+d*J+h*Q,s[2]=f*G+I*Z+A*V+p*H,s[6]=f*x+I*W+A*z+p*Y,s[10]=f*B+I*F+A*U+p*K,s[14]=f*R+I*T+A*J+p*Q,s[3]=y*G+v*Z+b*V+w*H,s[7]=y*x+v*W+b*z+w*Y,s[11]=y*B+v*F+b*U+w*K,s[15]=y*R+v*T+b*J+w*Q,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],c=e[13],g=e[2],u=e[6],d=e[10],h=e[14],f=e[3],I=e[7],A=e[11],p=e[15];return f*(+s*l*u-r*c*u-s*a*d+i*c*d+r*a*h-i*l*h)+I*(+t*l*h-t*c*d+s*o*d-r*o*h+r*c*g-s*l*g)+A*(+t*c*u-t*a*h-s*o*u+i*o*h+s*a*g-i*c*g)+p*(-r*a*g-t*l*u+t*a*d+r*o*u-i*o*d+i*l*g)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],g=e[8],u=e[9],d=e[10],h=e[11],f=e[12],I=e[13],A=e[14],p=e[15],y=u*A*c-I*d*c+I*l*h-a*A*h-u*l*p+a*d*p,v=f*d*c-g*A*c-f*l*h+o*A*h+g*l*p-o*d*p,b=g*I*c-f*u*c+f*a*h-o*I*h-g*a*p+o*u*p,w=f*u*l-g*I*l-f*a*d+o*I*d+g*a*A-o*u*A,G=t*y+i*v+r*b+s*w;if(G===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const x=1/G;return e[0]=y*x,e[1]=(I*d*s-u*A*s-I*r*h+i*A*h+u*r*p-i*d*p)*x,e[2]=(a*A*s-I*l*s+I*r*c-i*A*c-a*r*p+i*l*p)*x,e[3]=(u*l*s-a*d*s-u*r*c+i*d*c+a*r*h-i*l*h)*x,e[4]=v*x,e[5]=(g*A*s-f*d*s+f*r*h-t*A*h-g*r*p+t*d*p)*x,e[6]=(f*l*s-o*A*s-f*r*c+t*A*c+o*r*p-t*l*p)*x,e[7]=(o*d*s-g*l*s+g*r*c-t*d*c-o*r*h+t*l*h)*x,e[8]=b*x,e[9]=(f*u*s-g*I*s-f*i*h+t*I*h+g*i*p-t*u*p)*x,e[10]=(o*I*s-f*a*s+f*i*c-t*I*c-o*i*p+t*a*p)*x,e[11]=(g*a*s-o*u*s-g*i*c+t*u*c+o*i*h-t*a*h)*x,e[12]=w*x,e[13]=(g*I*r-f*u*r+f*i*d-t*I*d-g*i*A+t*u*A)*x,e[14]=(f*a*r-o*I*r-f*i*l+t*I*l+o*i*A-t*a*A)*x,e[15]=(o*u*r-g*a*r+g*i*l-t*u*l-o*i*d+t*a*d)*x,this}scale(e){const t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),s=1-i,o=e.x,a=e.y,l=e.z,c=s*o,g=s*a;return this.set(c*o+i,c*a-r*l,c*l+r*a,0,c*a+r*l,g*a+i,g*l-r*o,0,c*l-r*a,g*l+r*o,s*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,o){return this.set(1,i,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,c=s+s,g=o+o,u=a+a,d=s*c,h=s*g,f=s*u,I=o*g,A=o*u,p=a*u,y=l*c,v=l*g,b=l*u,w=i.x,G=i.y,x=i.z;return r[0]=(1-(I+p))*w,r[1]=(h+b)*w,r[2]=(f-v)*w,r[3]=0,r[4]=(h-b)*G,r[5]=(1-(d+p))*G,r[6]=(A+y)*G,r[7]=0,r[8]=(f+v)*x,r[9]=(A-y)*x,r[10]=(1-(d+I))*x,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let s=LI.set(r[0],r[1],r[2]).length();const o=LI.set(r[4],r[5],r[6]).length(),a=LI.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],ol.copy(this);const c=1/s,g=1/o,u=1/a;return ol.elements[0]*=c,ol.elements[1]*=c,ol.elements[2]*=c,ol.elements[4]*=g,ol.elements[5]*=g,ol.elements[6]*=g,ol.elements[8]*=u,ol.elements[9]*=u,ol.elements[10]*=u,t.setFromRotationMatrix(ol),i.x=s,i.y=o,i.z=a,this}makePerspective(e,t,i,r,s,o){const a=this.elements,l=2*s/(t-e),c=2*s/(i-r),g=(t+e)/(t-e),u=(i+r)/(i-r),d=-(o+s)/(o-s),h=-2*o*s/(o-s);return a[0]=l,a[4]=0,a[8]=g,a[12]=0,a[1]=0,a[5]=c,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=h,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,i,r,s,o){const a=this.elements,l=1/(t-e),c=1/(i-r),g=1/(o-s),u=(t+e)*l,d=(i+r)*c,h=(o+s)*g;return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=-2*g,a[14]=-h,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const LI=new Ve,ol=new Go,QRe=new Ve(0,0,0),ORe=new Ve(1,1,1),Wu=new Ve,bG=new Ve,zo=new Ve,GK=new Go,wK=new Ns;class Jg{constructor(e=0,t=0,i=0,r=Jg.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],l=r[1],c=r[5],g=r[9],u=r[2],d=r[6],h=r[10];switch(t){case"XYZ":this._y=Math.asin(Fs(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-g,h),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Fs(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(a,h),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,s),this._z=0);break;case"ZXY":this._x=Math.asin(Fs(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,h),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Fs(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Fs(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-g,c),this._y=Math.atan2(-u,s)):(this._x=0,this._y=Math.atan2(a,h));break;case"XZY":this._z=Math.asin(-Fs(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-g,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return GK.makeRotationFromQuaternion(e),this.setFromRotationMatrix(GK,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return wK.setFromEuler(this),this.setFromQuaternion(wK,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Jg.DEFAULT_ORDER="XYZ";class N6{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let JRe=0;const xK=new Ve,HI=new Ns,ag=new Go,BG=new Ve,Tm=new Ve,jRe=new Ve,qRe=new Ns,SK=new Ve(1,0,0),RK=new Ve(0,1,0),ZK=new Ve(0,0,1),$Re={type:"added"},MK={type:"removed"};class gs extends kv{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:JRe++}),this.uuid=ep(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=gs.DEFAULT_UP.clone();const e=new Ve,t=new Jg,i=new Ns,r=new Ve(1,1,1);function s(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(s),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Go},normalMatrix:{value:new Wd}}),this.matrix=new Go,this.matrixWorld=new Go,this.matrixAutoUpdate=gs.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=gs.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new N6,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return HI.setFromAxisAngle(e,t),this.quaternion.multiply(HI),this}rotateOnWorldAxis(e,t){return HI.setFromAxisAngle(e,t),this.quaternion.premultiply(HI),this}rotateX(e){return this.rotateOnAxis(SK,e)}rotateY(e){return this.rotateOnAxis(RK,e)}rotateZ(e){return this.rotateOnAxis(ZK,e)}translateOnAxis(e,t){return xK.copy(e).applyQuaternion(this.quaternion),this.position.add(xK.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(SK,e)}translateY(e){return this.translateOnAxis(RK,e)}translateZ(e){return this.translateOnAxis(ZK,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(ag.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?BG.copy(e):BG.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),Tm.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ag.lookAt(Tm,BG,this.up):ag.lookAt(BG,Tm,this.up),this.quaternion.setFromRotationMatrix(ag),r&&(ag.extractRotation(r.matrixWorld),HI.setFromRotationMatrix(ag),this.quaternion.premultiply(HI.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent($Re)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(MK)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(MK)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),ag.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),ag.multiply(e.parent.matrixWorld)),e.applyMatrix4(ag),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t){let i=[];this[e]===t&&i.push(this);for(let r=0,s=this.children.length;r<s;r++){const o=this.children[r].getObjectsByProperty(e,t);o.length>0&&(i=i.concat(o))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Tm,e,jRe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Tm,qRe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++){const s=t[i];(s.matrixWorldAutoUpdate===!0||e===!0)&&s.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++){const a=r[s];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,g=l.length;c<g;c++){const u=l[c];s(e.shapes,u)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(s(e.materials,this.material[l]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];r.animations.push(s(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),g=o(e.images),u=o(e.shapes),d=o(e.skeletons),h=o(e.animations),f=o(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),g.length>0&&(i.images=g),u.length>0&&(i.shapes=u),d.length>0&&(i.skeletons=d),h.length>0&&(i.animations=h),f.length>0&&(i.nodes=f)}return i.object=r,i;function o(a){const l=[];for(const c in a){const g=a[c];delete g.metadata,l.push(g)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}}gs.DEFAULT_UP=new Ve(0,1,0);gs.DEFAULT_MATRIX_AUTO_UPDATE=!0;gs.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const al=new Ve,lg=new Ve,aM=new Ve,cg=new Ve,zI=new Ve,XI=new Ve,EK=new Ve,lM=new Ve,cM=new Ve,gM=new Ve;let GG=!1;class ml{constructor(e=new Ve,t=new Ve,i=new Ve){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),al.subVectors(e,t),r.cross(al);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){al.subVectors(r,t),lg.subVectors(i,t),aM.subVectors(e,t);const o=al.dot(al),a=al.dot(lg),l=al.dot(aM),c=lg.dot(lg),g=lg.dot(aM),u=o*c-a*a;if(u===0)return s.set(-2,-1,-1);const d=1/u,h=(c*l-a*g)*d,f=(o*g-a*l)*d;return s.set(1-h-f,f,h)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,cg),cg.x>=0&&cg.y>=0&&cg.x+cg.y<=1}static getUV(e,t,i,r,s,o,a,l){return GG===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),GG=!0),this.getInterpolation(e,t,i,r,s,o,a,l)}static getInterpolation(e,t,i,r,s,o,a,l){return this.getBarycoord(e,t,i,r,cg),l.setScalar(0),l.addScaledVector(s,cg.x),l.addScaledVector(o,cg.y),l.addScaledVector(a,cg.z),l}static isFrontFacing(e,t,i,r){return al.subVectors(i,t),lg.subVectors(e,t),al.cross(lg).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return al.subVectors(this.c,this.b),lg.subVectors(this.a,this.b),al.cross(lg).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ml.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return ml.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,s){return GG===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),GG=!0),ml.getInterpolation(e,this.a,this.b,this.c,t,i,r,s)}getInterpolation(e,t,i,r,s){return ml.getInterpolation(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return ml.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ml.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,s=this.c;let o,a;zI.subVectors(r,i),XI.subVectors(s,i),lM.subVectors(e,i);const l=zI.dot(lM),c=XI.dot(lM);if(l<=0&&c<=0)return t.copy(i);cM.subVectors(e,r);const g=zI.dot(cM),u=XI.dot(cM);if(g>=0&&u<=g)return t.copy(r);const d=l*u-g*c;if(d<=0&&l>=0&&g<=0)return o=l/(l-g),t.copy(i).addScaledVector(zI,o);gM.subVectors(e,s);const h=zI.dot(gM),f=XI.dot(gM);if(f>=0&&h<=f)return t.copy(s);const I=h*c-l*f;if(I<=0&&c>=0&&f<=0)return a=c/(c-f),t.copy(i).addScaledVector(XI,a);const A=g*f-h*u;if(A<=0&&u-g>=0&&h-f>=0)return EK.subVectors(s,r),a=(u-g)/(u-g+(h-f)),t.copy(r).addScaledVector(EK,a);const p=1/(A+I+d);return o=I*p,a=d*p,t.copy(i).addScaledVector(zI,o).addScaledVector(XI,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let eZe=0;class Hv extends kv{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:eZe++}),this.uuid=ep(),this.name="",this.type="Material",this.blending=pK,this.side=JW,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=aRe,this.blendDst=lRe,this.blendEquation=oRe,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=cRe,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=yRe,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=jZ,this.stencilZFail=jZ,this.stencilZPass=jZ,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==pK&&(i.blending=this.blending),this.side!==JW&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(t){const s=r(e.textures),o=r(e.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}const k6={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ll={h:0,s:0,l:0},wG={h:0,s:0,l:0};function uM(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class zs{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Ag){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Ho.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=Ho.workingColorSpace){return this.r=e,this.g=t,this.b=i,Ho.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=Ho.workingColorSpace){if(e=DT(e,1),t=Fs(t,0,1),i=Fs(i,0,1),t===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,o=2*i-s;this.r=uM(o,s,e+1/3),this.g=uM(o,s,e),this.b=uM(o,s,e-1/3)}return Ho.toWorkingColorSpace(this,r),this}setStyle(e,t=Ag){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(s[1],10))/255,this.g=Math.min(255,parseInt(s[2],10))/255,this.b=Math.min(255,parseInt(s[3],10))/255,Ho.toWorkingColorSpace(this,t),i(s[4]),this;if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(s[1],10))/100,this.g=Math.min(100,parseInt(s[2],10))/100,this.b=Math.min(100,parseInt(s[3],10))/100,Ho.toWorkingColorSpace(this,t),i(s[4]),this;break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){const l=parseFloat(s[1])/360,c=parseFloat(s[2])/100,g=parseFloat(s[3])/100;return i(s[4]),this.setHSL(l,c,g,t)}break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Ag){const i=k6[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=UA(e.r),this.g=UA(e.g),this.b=UA(e.b),this}copyLinearToSRGB(e){return this.r=$Z(e.r),this.g=$Z(e.g),this.b=$Z(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Ag){return Ho.fromWorkingColorSpace(qr.copy(this),e),Fs(qr.r*255,0,255)<<16^Fs(qr.g*255,0,255)<<8^Fs(qr.b*255,0,255)<<0}getHexString(e=Ag){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Ho.workingColorSpace){Ho.fromWorkingColorSpace(qr.copy(this),t);const i=qr.r,r=qr.g,s=qr.b,o=Math.max(i,r,s),a=Math.min(i,r,s);let l,c;const g=(a+o)/2;if(a===o)l=0,c=0;else{const u=o-a;switch(c=g<=.5?u/(o+a):u/(2-o-a),o){case i:l=(r-s)/u+(r<s?6:0);break;case r:l=(s-i)/u+2;break;case s:l=(i-r)/u+4;break}l/=6}return e.h=l,e.s=c,e.l=g,e}getRGB(e,t=Ho.workingColorSpace){return Ho.fromWorkingColorSpace(qr.copy(this),t),e.r=qr.r,e.g=qr.g,e.b=qr.b,e}getStyle(e=Ag){Ho.fromWorkingColorSpace(qr.copy(this),e);const t=qr.r,i=qr.g,r=qr.b;return e!==Ag?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${t*255|0},${i*255|0},${r*255|0})`}offsetHSL(e,t,i){return this.getHSL(ll),ll.h+=e,ll.s+=t,ll.l+=i,this.setHSL(ll.h,ll.s,ll.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(ll),e.getHSL(wG);const i=U0(ll.h,wG.h,t),r=U0(ll.s,wG.s,t),s=U0(ll.l,wG.l,t);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*i+s[6]*r,this.g=s[1]*t+s[4]*i+s[7]*r,this.b=s[2]*t+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const qr=new zs;zs.NAMES=k6;class eA extends Hv{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new zs(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z6,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Li=new Ve,xG=new mn;class sf{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=vK,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)xG.fromBufferAttribute(this,t),xG.applyMatrix3(e),this.setXY(t,xG.x,xG.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)Li.fromBufferAttribute(this,t),Li.applyMatrix3(e),this.setXYZ(t,Li.x,Li.y,Li.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Li.fromBufferAttribute(this,t),Li.applyMatrix4(e),this.setXYZ(t,Li.x,Li.y,Li.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Li.fromBufferAttribute(this,t),Li.applyNormalMatrix(e),this.setXYZ(t,Li.x,Li.y,Li.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Li.fromBufferAttribute(this,t),Li.transformDirection(e),this.setXYZ(t,Li.x,Li.y,Li.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=c0(t,this.array)),t}setX(e,t){return this.normalized&&(t=no(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=c0(t,this.array)),t}setY(e,t){return this.normalized&&(t=no(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=c0(t,this.array)),t}setZ(e,t){return this.normalized&&(t=no(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=c0(t,this.array)),t}setW(e,t){return this.normalized&&(t=no(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=no(t,this.array),i=no(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=no(t,this.array),i=no(i,this.array),r=no(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=no(t,this.array),i=no(i,this.array),r=no(r,this.array),s=no(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==vK&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class tZe extends sf{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class nZe extends sf{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class of extends sf{constructor(e,t,i){super(new Float32Array(e),t,i)}}let iZe=0;const va=new Go,dM=new gs,YI=new Ve,Xo=new Lv,Nm=new Lv,ur=new Ve;class tp extends kv{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:iZe++}),this.uuid=ep(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(NRe(e)?nZe:tZe)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new Wd().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return va.makeRotationFromQuaternion(e),this.applyMatrix4(va),this}rotateX(e){return va.makeRotationX(e),this.applyMatrix4(va),this}rotateY(e){return va.makeRotationY(e),this.applyMatrix4(va),this}rotateZ(e){return va.makeRotationZ(e),this.applyMatrix4(va),this}translate(e,t,i){return va.makeTranslation(e,t,i),this.applyMatrix4(va),this}scale(e,t,i){return va.makeScale(e,t,i),this.applyMatrix4(va),this}lookAt(e){return dM.lookAt(e),dM.updateMatrix(),this.applyMatrix4(dM.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(YI).negate(),this.translate(YI.x,YI.y,YI.z),this}setFromPoints(e){const t=[];for(let i=0,r=e.length;i<r;i++){const s=e[i];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new of(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Lv);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Ve(-1/0,-1/0,-1/0),new Ve(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){const s=t[i];Xo.setFromBufferAttribute(s),this.morphTargetsRelative?(ur.addVectors(this.boundingBox.min,Xo.min),this.boundingBox.expandByPoint(ur),ur.addVectors(this.boundingBox.max,Xo.max),this.boundingBox.expandByPoint(ur)):(this.boundingBox.expandByPoint(Xo.min),this.boundingBox.expandByPoint(Xo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new V6);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Ve,1/0);return}if(e){const i=this.boundingSphere.center;if(Xo.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];Nm.setFromBufferAttribute(a),this.morphTargetsRelative?(ur.addVectors(Xo.min,Nm.min),Xo.expandByPoint(ur),ur.addVectors(Xo.max,Nm.max),Xo.expandByPoint(ur)):(Xo.expandByPoint(Nm.min),Xo.expandByPoint(Nm.max))}Xo.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)ur.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(ur));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let c=0,g=a.count;c<g;c++)ur.fromBufferAttribute(a,c),l&&(YI.fromBufferAttribute(e,c),ur.add(YI)),r=Math.max(r,i.distanceToSquared(ur))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.array,r=t.position.array,s=t.normal.array,o=t.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new sf(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],g=[];for(let Z=0;Z<a;Z++)c[Z]=new Ve,g[Z]=new Ve;const u=new Ve,d=new Ve,h=new Ve,f=new mn,I=new mn,A=new mn,p=new Ve,y=new Ve;function v(Z,W,F){u.fromArray(r,Z*3),d.fromArray(r,W*3),h.fromArray(r,F*3),f.fromArray(o,Z*2),I.fromArray(o,W*2),A.fromArray(o,F*2),d.sub(u),h.sub(u),I.sub(f),A.sub(f);const T=1/(I.x*A.y-A.x*I.y);isFinite(T)&&(p.copy(d).multiplyScalar(A.y).addScaledVector(h,-I.y).multiplyScalar(T),y.copy(h).multiplyScalar(I.x).addScaledVector(d,-A.x).multiplyScalar(T),c[Z].add(p),c[W].add(p),c[F].add(p),g[Z].add(y),g[W].add(y),g[F].add(y))}let b=this.groups;b.length===0&&(b=[{start:0,count:i.length}]);for(let Z=0,W=b.length;Z<W;++Z){const F=b[Z],T=F.start,V=F.count;for(let z=T,U=T+V;z<U;z+=3)v(i[z+0],i[z+1],i[z+2])}const w=new Ve,G=new Ve,x=new Ve,B=new Ve;function R(Z){x.fromArray(s,Z*3),B.copy(x);const W=c[Z];w.copy(W),w.sub(x.multiplyScalar(x.dot(W))).normalize(),G.crossVectors(B,W);const T=G.dot(g[Z])<0?-1:1;l[Z*4]=w.x,l[Z*4+1]=w.y,l[Z*4+2]=w.z,l[Z*4+3]=T}for(let Z=0,W=b.length;Z<W;++Z){const F=b[Z],T=F.start,V=F.count;for(let z=T,U=T+V;z<U;z+=3)R(i[z+0]),R(i[z+1]),R(i[z+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new sf(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let d=0,h=i.count;d<h;d++)i.setXYZ(d,0,0,0);const r=new Ve,s=new Ve,o=new Ve,a=new Ve,l=new Ve,c=new Ve,g=new Ve,u=new Ve;if(e)for(let d=0,h=e.count;d<h;d+=3){const f=e.getX(d+0),I=e.getX(d+1),A=e.getX(d+2);r.fromBufferAttribute(t,f),s.fromBufferAttribute(t,I),o.fromBufferAttribute(t,A),g.subVectors(o,s),u.subVectors(r,s),g.cross(u),a.fromBufferAttribute(i,f),l.fromBufferAttribute(i,I),c.fromBufferAttribute(i,A),a.add(g),l.add(g),c.add(g),i.setXYZ(f,a.x,a.y,a.z),i.setXYZ(I,l.x,l.y,l.z),i.setXYZ(A,c.x,c.y,c.z)}else for(let d=0,h=t.count;d<h;d+=3)r.fromBufferAttribute(t,d+0),s.fromBufferAttribute(t,d+1),o.fromBufferAttribute(t,d+2),g.subVectors(o,s),u.subVectors(r,s),g.cross(u),i.setXYZ(d+0,g.x,g.y,g.z),i.setXYZ(d+1,g.x,g.y,g.z),i.setXYZ(d+2,g.x,g.y,g.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)ur.fromBufferAttribute(e,t),ur.normalize(),e.setXYZ(t,ur.x,ur.y,ur.z)}toNonIndexed(){function e(a,l){const c=a.array,g=a.itemSize,u=a.normalized,d=new c.constructor(l.length*g);let h=0,f=0;for(let I=0,A=l.length;I<A;I++){a.isInterleavedBufferAttribute?h=l[I]*a.data.stride+a.offset:h=l[I]*g;for(let p=0;p<g;p++)d[f++]=c[h++]}return new sf(d,g,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new tp,i=this.index.array,r=this.attributes;for(const a in r){const l=r[a],c=e(l,i);t.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let g=0,u=c.length;g<u;g++){const d=c[g],h=e(d,i);l.push(h)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],g=[];for(let u=0,d=c.length;u<d;u++){const h=c[u];g.push(h.toJSON(e.data))}g.length>0&&(r[l]=g,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const r=e.attributes;for(const c in r){const g=r[c];this.setAttribute(c,g.clone(t))}const s=e.morphAttributes;for(const c in s){const g=[],u=s[c];for(let d=0,h=u.length;d<h;d++)g.push(u[d].clone(t));this.morphAttributes[c]=g}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,g=o.length;c<g;c++){const u=o[c];this.addGroup(u.start,u.count,u.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const WK=new Go,Ql=new T6,SG=new V6,FK=new Ve,KI=new Ve,DI=new Ve,PI=new Ve,hM=new Ve,RG=new Ve,ZG=new mn,MG=new mn,EG=new mn,_K=new Ve,VK=new Ve,TK=new Ve,WG=new Ve,FG=new Ve;class rZe extends gs{constructor(e=new tp,t=new eA){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const i=this.geometry,r=i.attributes.position,s=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(s&&a){RG.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const g=a[l],u=s[l];g!==0&&(hM.fromBufferAttribute(u,e),o?RG.addScaledVector(hM,g):RG.addScaledVector(hM.sub(t),g))}t.add(RG)}return this.isSkinnedMesh&&this.applyBoneTransform(e,t),t}raycast(e,t){const i=this.geometry,r=this.material,s=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),SG.copy(i.boundingSphere),SG.applyMatrix4(s),Ql.copy(e.ray).recast(e.near),SG.containsPoint(Ql.origin)===!1&&(Ql.intersectSphere(SG,FK)===null||Ql.origin.distanceToSquared(FK)>(e.far-e.near)**2))||(WK.copy(s).invert(),Ql.copy(e.ray).applyMatrix4(WK),i.boundingBox!==null&&Ql.intersectsBox(i.boundingBox)===!1))return;let o;const a=i.index,l=i.attributes.position,c=i.attributes.uv,g=i.attributes.uv2,u=i.attributes.normal,d=i.groups,h=i.drawRange;if(a!==null)if(Array.isArray(r))for(let f=0,I=d.length;f<I;f++){const A=d[f],p=r[A.materialIndex],y=Math.max(A.start,h.start),v=Math.min(a.count,Math.min(A.start+A.count,h.start+h.count));for(let b=y,w=v;b<w;b+=3){const G=a.getX(b),x=a.getX(b+1),B=a.getX(b+2);o=_G(this,p,e,Ql,c,g,u,G,x,B),o&&(o.faceIndex=Math.floor(b/3),o.face.materialIndex=A.materialIndex,t.push(o))}}else{const f=Math.max(0,h.start),I=Math.min(a.count,h.start+h.count);for(let A=f,p=I;A<p;A+=3){const y=a.getX(A),v=a.getX(A+1),b=a.getX(A+2);o=_G(this,r,e,Ql,c,g,u,y,v,b),o&&(o.faceIndex=Math.floor(A/3),t.push(o))}}else if(l!==void 0)if(Array.isArray(r))for(let f=0,I=d.length;f<I;f++){const A=d[f],p=r[A.materialIndex],y=Math.max(A.start,h.start),v=Math.min(l.count,Math.min(A.start+A.count,h.start+h.count));for(let b=y,w=v;b<w;b+=3){const G=b,x=b+1,B=b+2;o=_G(this,p,e,Ql,c,g,u,G,x,B),o&&(o.faceIndex=Math.floor(b/3),o.face.materialIndex=A.materialIndex,t.push(o))}}else{const f=Math.max(0,h.start),I=Math.min(l.count,h.start+h.count);for(let A=f,p=I;A<p;A+=3){const y=A,v=A+1,b=A+2;o=_G(this,r,e,Ql,c,g,u,y,v,b),o&&(o.faceIndex=Math.floor(A/3),t.push(o))}}}}function sZe(n,e,t,i,r,s,o,a){let l;if(e.side===R6?l=i.intersectTriangle(o,s,r,!0,a):l=i.intersectTriangle(r,s,o,e.side===JW,a),l===null)return null;FG.copy(a),FG.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(FG);return c<t.near||c>t.far?null:{distance:c,point:FG.clone(),object:n}}function _G(n,e,t,i,r,s,o,a,l,c){n.getVertexPosition(a,KI),n.getVertexPosition(l,DI),n.getVertexPosition(c,PI);const g=sZe(n,e,t,i,KI,DI,PI,WG);if(g){r&&(ZG.fromBufferAttribute(r,a),MG.fromBufferAttribute(r,l),EG.fromBufferAttribute(r,c),g.uv=ml.getInterpolation(WG,KI,DI,PI,ZG,MG,EG,new mn)),s&&(ZG.fromBufferAttribute(s,a),MG.fromBufferAttribute(s,l),EG.fromBufferAttribute(s,c),g.uv2=ml.getInterpolation(WG,KI,DI,PI,ZG,MG,EG,new mn)),o&&(_K.fromBufferAttribute(o,a),VK.fromBufferAttribute(o,l),TK.fromBufferAttribute(o,c),g.normal=ml.getInterpolation(WG,KI,DI,PI,_K,VK,TK,new Ve),g.normal.dot(i.direction)>0&&g.normal.multiplyScalar(-1));const u={a,b:l,c,normal:new Ve,materialIndex:0};ml.getNormal(KI,DI,PI,u.normal),g.face=u}return g}class ac extends tp{constructor(e=1,t=1,i=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],c=[],g=[],u=[];let d=0,h=0;f("z","y","x",-1,-1,i,t,e,o,s,0),f("z","y","x",1,-1,i,t,-e,o,s,1),f("x","z","y",1,1,e,i,t,r,o,2),f("x","z","y",1,-1,e,i,-t,r,o,3),f("x","y","z",1,-1,e,t,i,r,s,4),f("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(l),this.setAttribute("position",new of(c,3)),this.setAttribute("normal",new of(g,3)),this.setAttribute("uv",new of(u,2));function f(I,A,p,y,v,b,w,G,x,B,R){const Z=b/x,W=w/B,F=b/2,T=w/2,V=G/2,z=x+1,U=B+1;let J=0,H=0;const Y=new Ve;for(let K=0;K<U;K++){const Q=K*W-T;for(let P=0;P<z;P++){const ne=P*Z-F;Y[I]=ne*y,Y[A]=Q*v,Y[p]=V,c.push(Y.x,Y.y,Y.z),Y[I]=0,Y[A]=0,Y[p]=G>0?1:-1,g.push(Y.x,Y.y,Y.z),u.push(P/x),u.push(1-K/B),J+=1}}for(let K=0;K<B;K++)for(let Q=0;Q<x;Q++){const P=d+Q+z*K,ne=d+Q+z*(K+1),oe=d+(Q+1)+z*(K+1),$=d+(Q+1)+z*K;l.push(P,ne,$),l.push(ne,oe,$),H+=6}a.addGroup(h,H,R),h+=H,d+=J}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ac(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function L6(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=r.clone():Array.isArray(r)?e[t][i]=r.slice():e[t][i]=r}}return e}function oZe(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}var aZe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,lZe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class cZe extends Hv{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=aZe,this.fragmentShader=lZe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=L6(e.uniforms),this.uniformsGroups=oZe(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class gZe extends gs{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Go,this.projectionMatrix=new Go,this.projectionMatrixInverse=new Go}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class UI extends gZe{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Q2*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(P0*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Q2*2*Math.atan(Math.tan(P0*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(P0*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*r/l,t-=o.offsetY*i/c,r*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const QI=-90,OI=1;class H6 extends gs{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;const r=new UI(QI,OI,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);const s=new UI(QI,OI,e,t);s.layers=this.layers,s.up.set(0,1,0),s.lookAt(-1,0,0),this.add(s);const o=new UI(QI,OI,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(0,1,0),this.add(o);const a=new UI(QI,OI,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);const l=new UI(QI,OI,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,1),this.add(l);const c=new UI(QI,OI,e,t);c.layers=this.layers,c.up.set(0,1,0),c.lookAt(0,0,-1),this.add(c)}update(e,t){this.parent===null&&this.updateMatrixWorld();const i=this.renderTarget,[r,s,o,a,l,c]=this.children,g=e.getRenderTarget(),u=e.toneMapping,d=e.xr.enabled;e.toneMapping=M6,e.xr.enabled=!1;const h=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,s),e.setRenderTarget(i,2),e.render(t,o),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,l),i.texture.generateMipmaps=h,e.setRenderTarget(i,5),e.render(t,c),e.setRenderTarget(g),e.toneMapping=u,e.xr.enabled=d,i.texture.needsPMREMUpdate=!0}}class uZe extends Bo{constructor(e,t,i,r,s,o,a,l,c,g){e=e!==void 0?e:[],t=t!==void 0?t:gRe,super(e,t,i,r,s,o,a,l,c,g),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class dZe extends _6{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new uZe(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:BC}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new ac(5,5,5),s=new cZe({name:"CubemapFromEquirect",uniforms:L6(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:R6,blending:sRe});s.uniforms.tEquirect.value=t;const o=new rZe(r,s),a=t.minFilter;return t.minFilter===zT&&(t.minFilter=BC),new H6(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,r);e.setRenderTarget(s)}}let hZe=class z6{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new zs(e),this.near=t,this.far=i}clone(){return new z6(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}};class fZe extends gs{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class IZe extends Bo{constructor(e=null,t=1,i=1,r,s,o,a,l,c=U2,g=U2,u,d){super(null,o,a,l,c,g,r,s,u,d),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class X6 extends Bo{constructor(e,t,i,r,s,o,a,l,c,g,u,d){super(null,o,a,l,c,g,r,s,u,d),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class AZe extends X6{constructor(e,t,i,r,s,o){super(e,t,i,s,o),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=wA}}class CZe extends Bo{constructor(e,t,i,r,s,o,a,l,c){super(e,t,i,r,s,o,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class PT extends tp{constructor(e=1,t=1,i=1,r=32,s=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l};const c=this;r=Math.floor(r),s=Math.floor(s);const g=[],u=[],d=[],h=[];let f=0;const I=[],A=i/2;let p=0;y(),o===!1&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(g),this.setAttribute("position",new of(u,3)),this.setAttribute("normal",new of(d,3)),this.setAttribute("uv",new of(h,2));function y(){const b=new Ve,w=new Ve;let G=0;const x=(t-e)/i;for(let B=0;B<=s;B++){const R=[],Z=B/s,W=Z*(t-e)+e;for(let F=0;F<=r;F++){const T=F/r,V=T*l+a,z=Math.sin(V),U=Math.cos(V);w.x=W*z,w.y=-Z*i+A,w.z=W*U,u.push(w.x,w.y,w.z),b.set(z,x,U).normalize(),d.push(b.x,b.y,b.z),h.push(T,1-Z),R.push(f++)}I.push(R)}for(let B=0;B<r;B++)for(let R=0;R<s;R++){const Z=I[R][B],W=I[R+1][B],F=I[R+1][B+1],T=I[R][B+1];g.push(Z,W,T),g.push(W,F,T),G+=6}c.addGroup(p,G,0),p+=G}function v(b){const w=f,G=new mn,x=new Ve;let B=0;const R=b===!0?e:t,Z=b===!0?1:-1;for(let F=1;F<=r;F++)u.push(0,A*Z,0),d.push(0,Z,0),h.push(.5,.5),f++;const W=f;for(let F=0;F<=r;F++){const V=F/r*l+a,z=Math.cos(V),U=Math.sin(V);x.x=R*U,x.y=A*Z,x.z=R*z,u.push(x.x,x.y,x.z),d.push(0,Z,0),G.x=z*.5+.5,G.y=U*.5*Z+.5,h.push(G.x,G.y),f++}for(let F=0;F<r;F++){const T=w+F,V=W+F;b===!0?g.push(V,V+1,T):g.push(V+1,V,T),B+=3}c.addGroup(p,B,b===!0?1:2),p+=B}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new PT(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Hu extends Hv{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new zs(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zs(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=YT,this.normalScale=new mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class pZe extends Hv{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=YT,this.normalScale=new mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class mZe extends Hv{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new zs(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zs(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=YT,this.normalScale=new mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z6,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}const J2={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class yZe{constructor(e,t,i){const r=this;let s=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(g){a++,s===!1&&r.onStart!==void 0&&r.onStart(g,o,a),s=!0},this.itemEnd=function(g){o++,r.onProgress!==void 0&&r.onProgress(g,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(g){r.onError!==void 0&&r.onError(g)},this.resolveURL=function(g){return l?l(g):g},this.setURLModifier=function(g){return l=g,this},this.addHandler=function(g,u){return c.push(g,u),this},this.removeHandler=function(g){const u=c.indexOf(g);return u!==-1&&c.splice(u,2),this},this.getHandler=function(g){for(let u=0,d=c.length;u<d;u+=2){const h=c[u],f=c[u+1];if(h.global&&(h.lastIndex=0),h.test(g))return f}return null}}}const vZe=new yZe;class Gx{constructor(e){this.manager=e!==void 0?e:vZe,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,s){i.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const gg={};class bZe extends Error{constructor(e,t){super(e),this.response=t}}class fM extends Gx{constructor(e){super(e)}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=J2.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(gg[e]!==void 0){gg[e].push({onLoad:t,onProgress:i,onError:r});return}gg[e]=[],gg[e].push({onLoad:t,onProgress:i,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const g=gg[e],u=c.body.getReader(),d=c.headers.get("Content-Length")||c.headers.get("X-File-Size"),h=d?parseInt(d):0,f=h!==0;let I=0;const A=new ReadableStream({start(p){y();function y(){u.read().then(({done:v,value:b})=>{if(v)p.close();else{I+=b.byteLength;const w=new ProgressEvent("progress",{lengthComputable:f,loaded:I,total:h});for(let G=0,x=g.length;G<x;G++){const B=g[G];B.onProgress&&B.onProgress(w)}p.enqueue(b),y()}})}}});return new Response(A)}else throw new bZe(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(g=>new DOMParser().parseFromString(g,a));case"json":return c.json();default:if(a===void 0)return c.text();{const u=/charset="?([^;"\s]*)"?/i.exec(a),d=u&&u[1]?u[1].toLowerCase():void 0,h=new TextDecoder(d);return c.arrayBuffer().then(f=>h.decode(f))}}}).then(c=>{J2.add(e,c);const g=gg[e];delete gg[e];for(let u=0,d=g.length;u<d;u++){const h=g[u];h.onLoad&&h.onLoad(c)}}).catch(c=>{const g=gg[e];if(g===void 0)throw this.manager.itemError(e),c;delete gg[e];for(let u=0,d=g.length;u<d;u++){const h=g[u];h.onError&&h.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class BZe extends Gx{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=J2.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=jW("img");function l(){g(),J2.add(e,this),t&&t(this),s.manager.itemEnd(e)}function c(u){g(),r&&r(u),s.manager.itemError(e),s.manager.itemEnd(e)}function g(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class GZe extends Gx{constructor(e){super(e)}load(e,t,i,r){const s=new Bo,o=new BZe(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,t!==void 0&&t(s)},i,r),s}}class Y6 extends gs{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new zs(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}class wZe extends Y6{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}let VG;class UT{static getContext(){return VG===void 0&&(VG=new(window.AudioContext||window.webkitAudioContext)),VG}static setContext(e){VG=e}}class xZe{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=NK(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=NK();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function NK(){return(typeof performance>"u"?Date:performance).now()}const uh=new Ve,kK=new Ns,SZe=new Ve,dh=new Ve;class RZe extends gs{constructor(){super(),this.type="AudioListener",this.context=UT.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new xZe}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(uh,kK,SZe),dh.set(0,0,-1).applyQuaternion(kK),t.positionX){const r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(uh.x,r),t.positionY.linearRampToValueAtTime(uh.y,r),t.positionZ.linearRampToValueAtTime(uh.z,r),t.forwardX.linearRampToValueAtTime(dh.x,r),t.forwardY.linearRampToValueAtTime(dh.y,r),t.forwardZ.linearRampToValueAtTime(dh.z,r),t.upX.linearRampToValueAtTime(i.x,r),t.upY.linearRampToValueAtTime(i.y,r),t.upZ.linearRampToValueAtTime(i.z,r)}else t.setPosition(uh.x,uh.y,uh.z),t.setOrientation(dh.x,dh.y,dh.z,i.x,i.y,i.z)}}let ZZe=class extends gs{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}};const hh=new Ve,LK=new Ns,MZe=new Ve,fh=new Ve;class EZe extends ZZe{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(hh,LK,MZe),fh.set(0,0,1).applyQuaternion(LK);const t=this.panner;if(t.positionX){const i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(hh.x,i),t.positionY.linearRampToValueAtTime(hh.y,i),t.positionZ.linearRampToValueAtTime(hh.z,i),t.orientationX.linearRampToValueAtTime(fh.x,i),t.orientationY.linearRampToValueAtTime(fh.y,i),t.orientationZ.linearRampToValueAtTime(fh.z,i)}else t.setPosition(hh.x,hh.y,hh.z),t.setOrientation(fh.x,fh.y,fh.z)}}class zu{constructor(e){this.value=e}clone(){return new zu(this.value.clone===void 0?this.value:this.value.clone())}}class WZe{constructor(e,t,i=0,r=1/0){this.ray=new T6(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new N6,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return qW(e,this,i,t),i.sort(HK),i}intersectObjects(e,t=!0,i=[]){for(let r=0,s=e.length;r<s;r++)qW(e[r],this,i,t);return i.sort(HK),i}}function HK(n,e){return n.distance-e.distance}function qW(n,e,t,i){if(n.layers.test(e.layers)&&n.raycast(e,t),i===!0){const r=n.children;for(let s=0,o=r.length;s<o;s++)qW(r[s],e,t,!0)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:S6}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=S6);var QT=function(n,e){if(typeof n=="number"){if(e===3)return{mode:"rgb",r:(n>>8&15|n>>4&240)/255,g:(n>>4&15|n&240)/255,b:(n&15|n<<4&240)/255};if(e===4)return{mode:"rgb",r:(n>>12&15|n>>8&240)/255,g:(n>>8&15|n>>4&240)/255,b:(n>>4&15|n&240)/255,alpha:(n&15|n<<4&240)/255};if(e===6)return{mode:"rgb",r:(n>>16&255)/255,g:(n>>8&255)/255,b:(n&255)/255};if(e===8)return{mode:"rgb",r:(n>>24&255)/255,g:(n>>16&255)/255,b:(n>>8&255)/255,alpha:(n&255)/255}}},FZe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_Ze=function(n){return typeof n=="string"&&QT(FZe[n.toLowerCase()],6)||void 0},Hs=(/([+-]?\d*\.?\d+(?:[eE][+-]?\d+)?)/+"").replace(/^\/|\/$/g,""),La=Hs+"%",K6=Hs+"%?",tu="(?:"+Hs+"%|"+Hs+")",wx="(?:"+Hs+"(deg|grad|rad|turn)|"+Hs+")",GC="\\s*,\\s*",Da="\\s+",VZe=new RegExp("^rgba?\\(\\s*"+Hs+GC+Hs+GC+Hs+"\\s*(?:,\\s*"+tu+"\\s*)?\\)$"),TZe=new RegExp("^rgba?\\(\\s*"+La+GC+La+GC+La+"\\s*(?:,\\s*"+tu+"\\s*)?\\)$"),NZe=new RegExp("^rgba?\\(\\s*"+Hs+Da+Hs+Da+Hs+"\\s*(?:\\/\\s*"+tu+"\\s*)?\\)$"),kZe=new RegExp("^rgba?\\(\\s*"+La+Da+La+Da+La+"\\s*(?:\\/\\s*"+tu+"\\s*)?\\)$"),LZe=new RegExp("^hsla?\\(\\s*"+wx+GC+La+GC+La+"\\s*(?:,\\s*"+tu+"\\s*)?\\)$"),HZe=new RegExp("^hsla?\\(\\s*"+wx+Da+La+Da+La+"\\s*(?:\\/\\s*"+tu+"\\s*)?\\)$"),zZe=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,XZe=new RegExp("^hwb\\(\\s*"+wx+Da+La+Da+La+"\\s*(?:\\/\\s*"+tu+"\\s*)?\\)$"),YZe=new RegExp("^lab\\(\\s*"+K6+Da+Hs+Da+Hs+"\\s*(?:\\/\\s*"+tu+"\\s*)?\\)$"),KZe=new RegExp("^lch\\(\\s*"+K6+Da+Hs+Da+wx+"\\s*(?:\\/\\s*"+tu+"\\s*)?\\)$"),DZe=function(n){var e;return(e=n.match(zZe))?QT(parseInt(e[1],16),e[1].length):void 0},PZe=function(n){var e,t;if(e=n.match(VZe)||n.match(NZe))t={mode:"rgb",r:e[1]/255,g:e[2]/255,b:e[3]/255};else if(e=n.match(TZe)||n.match(kZe))t={mode:"rgb",r:e[1]/100,g:e[2]/100,b:e[3]/100};else return;return e[4]!==void 0?t.alpha=e[4]/100:e[5]!==void 0&&(t.alpha=+e[5]),t},UZe=function(n){return n==="transparent"?QT(0,8):void 0},QZe=function(n,e,t){return n+t*(e-n)},OZe=function(n){for(var e=[],t=0;t<n.length-1;t++){var i=n[t],r=n[t+1];i===void 0&&r===void 0?e.push(void 0):i!==void 0&&r!==void 0?e.push([i,r]):e.push(i!==void 0?[i,i]:[r,r])}return e},JZe=function(n){return function(e){var t=OZe(e);return function(i){var r=i*t.length,s=i===1?t.length-1:Math.floor(r),o=t[s];return o===void 0?void 0:n(o[0],o[1],r-s)}}},ot=JZe(QZe),_r=function(n){var e=!1,t=n.map(function(i){return i!==void 0?(e=!0,i):1});return e?t:n},np={mode:"rgb",channels:["r","g","b","alpha"],alias:["srgb"],parsers:[DZe,PZe,_Ze,UZe],interpolate:{r:ot,g:ot,b:ot,alpha:{use:ot,fixup:_r}}},IM=function(n){return n<.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)},ip=function(n){var e=n.r,t=n.g,i=n.b,r=n.alpha,s={mode:"lrgb",r:IM(e),g:IM(t),b:IM(i)};return r!==void 0&&(s.alpha=r),s},AM=function(n){return n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n},rp=function(n,e){var t=n.r,i=n.g,r=n.b,s=n.alpha;e===void 0&&(e="rgb");var o={mode:e,r:AM(t),g:AM(i),b:AM(r)};return s!==void 0&&(o.alpha=s),o},jZe=Object.assign({},np,{mode:"lrgb",output:{rgb:rp},input:{rgb:ip},parsers:[]}),CM=function(n){return Math.pow(Math.abs(n),563/256)*Math.sign(n)},zK=function(n){var e=CM(n.r),t=CM(n.g),i=CM(n.b),r={mode:"xyz65",x:.5766690429101305*e+.1855582379065463*t+.1882286462349947*i,y:.29734497525053605*e+.6273635662554661*t+.07529145849399788*i,z:.02703136138641234*e+.07068885253582723*t+.9913375368376388*i};return n.alpha!==void 0&&(r.alpha=n.alpha),r},pM=function(n){return Math.pow(Math.abs(n),256/563)*Math.sign(n)},XK=function(n){var e=n.x,t=n.y,i=n.z,r=n.alpha,s={mode:"a98",r:pM(e*2.0415879038107465-t*.5650069742788596-.34473135077832956*i),g:pM(e*-.9692436362808795+t*1.8759675015077202+.04155505740717557*i),b:pM(e*.013444280632031142-t*.11836239223101838+1.0151749943912054*i)};return r!==void 0&&(s.alpha=r),s},sp=function(n){var e=ip(n),t=e.r,i=e.g,r=e.b,s=e.alpha,o={mode:"xyz65",x:.4124564*t+.3575761*i+.1804375*r,y:.2126729*t+.7151522*i+.072175*r,z:.0193339*t+.119192*i+.9503041*r};return s!==void 0&&(o.alpha=s),o},op=function(n){var e=n.x,t=n.y,i=n.z,r=n.alpha,s=rp({r:e*3.2404542-t*1.5371385-.4985314*i,g:e*-.969266+t*1.8760108+.041556*i,b:e*.0556434-t*.2040259+1.0572252*i});return r!==void 0&&(s.alpha=r),s},qZe=Object.assign({},np,{mode:"a98",alias:["a98-rgb"],parsers:[],input:{rgb:function(n){return XK(sp(n))},xyz65:XK},output:{rgb:function(n){return op(zK(n))},xyz65:zK}}),YK=function(n){var e=ip(n),t=e.r,i=e.g,r=e.b,s=e.alpha,o={mode:"xyz65",x:.4865709*t+.2656676*i+.1982172*r,y:.2289745*t+.6917385*i+.0792869*r,z:0*t+.0451133*i+1.0439443*r};return s!==void 0&&(o.alpha=s),o},KK=function(n){var e=n.x,t=n.y,i=n.z,r=n.alpha,s=rp({r:e*2.4934969-t*.9313836-.4027107*i,g:e*-.8294889+t*1.762664+.0236246*i,b:e*.0358458-t*.0761723+.9568845*i},"p3");return r!==void 0&&(s.alpha=r),s},$Ze=Object.assign({},np,{mode:"p3",alias:["display-p3"],input:{rgb:function(n){return KK(sp(n))},xyz65:KK},output:{rgb:function(n){return op(YK(n))},xyz65:YK},parsers:[]}),mM=function(n){return n>=1/512?Math.pow(n,1/1.8):16*n},DK=function(n){var e=n.x,t=n.y,i=n.z,r=n.alpha,s={mode:"prophoto",r:mM(e*1.3457989731028281-t*.25558010007997534-.05110628506753401*i),g:mM(e*-.5446224939028347+t*1.5082327413132781+.02053603239147973*i),b:mM(e*0+t*0+1.2119675456389454*i)};return r!==void 0&&(s.alpha=r),s},yM=function(n){return n>=16/512?Math.pow(n,1.8):n/16},PK=function(n){var e=yM(n.r),t=yM(n.g),i=yM(n.b),r={mode:"xyz65",x:.7977604896723027*e+.13518583717574031*t+.0313493495815248*i,y:.2880711282292934*e+.7118432178101014*t+8565396060525902e-20*i,z:0*e+0*t+.8251046025104601*i};return n.alpha!==void 0&&(r.alpha=n.alpha),r},xx=function(n){var e=n.x,t=n.y,i=n.z,r=n.alpha,s=rp({r:e*3.1338561-t*1.6168667-.4906146*i,g:e*-.9787684+t*1.9161415+.033454*i,b:e*.0719453-t*.2289914+1.4052427*i});return r!==void 0&&(s.alpha=r),s},Sx=function(n){var e=ip(n),t=e.r,i=e.g,r=e.b,s=e.alpha,o={mode:"xyz",x:.4360747*t+.3850649*i+.1430804*r,y:.2225045*t+.7168786*i+.0606169*r,z:.0139322*t+.0971045*i+.7141733*r};return s!==void 0&&(o.alpha=s),o},eMe=Object.assign({},np,{mode:"prophoto",alias:["prophoto-rgb"],parsers:[],input:{xyz:DK,rgb:function(n){return DK(Sx(n))}},output:{xyz:PK,rgb:function(n){return xx(PK(n))}}}),UK=1.09929682680944,tMe=.018053968510807,vM=function(n){return n>tMe?UK*Math.pow(n,1/2.4)-(UK-1):4.5*n},QK=function(n){var e=n.x,t=n.y,i=n.z,r=n.alpha,s={mode:"rec2020",r:vM(e*1.7166511879712674-t*.35567078377639233-.25336628137365974*i),g:vM(e*-.6666843518324892+t*1.6164812366349395+.01576854581391113*i),b:vM(e*.017639857445310783-t*.042770613257808524+.9421031212354738*i)};return r!==void 0&&(s.alpha=r),s},OK=1.09929682680944,nMe=.018053968510807,bM=function(n){return n<nMe*4.5?n/4.5:Math.pow((n+OK-1)/OK,2.4)},JK=function(n){var e=bM(n.r),t=bM(n.g),i=bM(n.b),r={mode:"xyz65",x:.6369580483012914*e+.14461690358620832*t+.1688809751641721*i,y:.2627002120112671*e+.6779980715188708*t+.05930171646986196*i,z:0*e+.028072693049087428*t+1.060985057710791*i};return n.alpha!==void 0&&(r.alpha=n.alpha),r},iMe=Object.assign({},np,{mode:"rec2020",input:{xyz:QK,rgb:function(n){return QK(sp(n))}},output:{xyz:JK,rgb:function(n){return op(JK(n))}},parsers:[]}),Is=function(n){return(n=n%360)<0?n+360:n};function rMe(n){var e=n.h,t=n.s,i=n.l,r=n.alpha;e=Is(e);var s=i+t*(i<.5?i:1-i),o=s-(s-i)*2*Math.abs(e/60%2-1),a;switch(Math.floor(e/60)){case 0:a={r:s,g:o,b:2*i-s};break;case 1:a={r:o,g:s,b:2*i-s};break;case 2:a={r:2*i-s,g:s,b:o};break;case 3:a={r:2*i-s,g:o,b:s};break;case 4:a={r:o,g:2*i-s,b:s};break;case 5:a={r:s,g:2*i-s,b:o};break;default:a={r:2*i-s,g:2*i-s,b:2*i-s}}return a.mode="rgb",r!==void 0&&(a.alpha=r),a}function sMe(n){var e=n.r,t=n.g,i=n.b,r=n.alpha,s=Math.max(e,t,i),o=Math.min(e,t,i),a={mode:"hsl",s:s===o?0:(s-o)/(1-Math.abs(s+o-1)),l:.5*(s+o)};return s-o!==0&&(a.h=(s===e?(t-i)/(s-o)+(t<i)*6:s===t?(i-e)/(s-o)+2:(e-t)/(s-o)+4)*60),r!==void 0&&(a.alpha=r),a}var OT=function(n,e){switch(e){case"deg":return+n;case"rad":return n/Math.PI*180;case"grad":return n/10*9;case"turn":return n*360}},oMe=function(n){if(typeof n=="string"){var e=n.match(LZe)||n.match(HZe);if(e){var t={mode:"hsl",h:e[3]===void 0?OT(e[1],e[2]):+e[3],s:Math.min(Math.max(0,e[4]/100),1),l:Math.min(Math.max(0,e[5]/100),1)};return e[6]!==void 0?t.alpha=e[6]/100:e[7]!==void 0&&(t.alpha=+e[7]),t}}},aMe=function(n,e){return n.map(function(t,i,r){if(t===void 0)return t;var s=Is(t);return i===0||n[i-1]===void 0?s:e(s-Is(r[i-1]))}).reduce(function(t,i){return!t.length||i===void 0||t[t.length-1]===void 0?(t.push(i),t):(t.push(i+t[t.length-1]),t)},[])},nu=function(n){return aMe(n,function(e){return Math.abs(e)<=180?e:e-360*Math.sign(e)})},hc={},lMe={},$W=[],cMe=function(n){return n},On=function(n){hc[n.mode]=Object.assign(hc[n.mode]||{},n.output),Object.keys(n.input||{}).forEach(function(e){hc[e]||(hc[e]={}),hc[e][n.mode]=n.input[e]}),n.ranges||(n.ranges={}),n.difference||(n.difference={}),n.channels.forEach(function(e){if(n.ranges[e]===void 0&&(n.ranges[e]=[0,1]),!n.interpolate[e])throw new Error("Missing interpolator for: "+e);typeof n.interpolate[e]=="function"&&(n.interpolate[e]={use:n.interpolate[e]}),n.interpolate[e].fixup||(n.interpolate[e].fixup=cMe)}),lMe[n.mode]=n,(n.parsers||[]).forEach(function(e){return $W.push(e)})},gMe=function(n){for(var e,t=0,i=$W.length;t<i&&(e=$W[t++](n))===void 0;);return e},uMe=function(n,e){return n===void 0?void 0:typeof n!="object"?gMe(n):n.mode!==void 0?n:e?Object.assign({},n,{mode:e}):void 0},vn=function(n){return n===void 0&&(n="rgb"),function(e){return(e=uMe(e,n))!==void 0?e.mode===n?e:hc[e.mode][n]?hc[e.mode][n](e):n==="rgb"?hc[e.mode].rgb(e):hc.rgb[n](hc[e.mode].rgb(e)):void 0}},Rx=function(n,e){if(n.h===void 0||e.h===void 0||!n.s||!e.s)return 0;var t=Is(n.h),i=Is(e.h),r=Math.sin((i-t+360)/2*Math.PI/180);return 2*Math.sqrt(n.s*e.s)*r},dMe=function(n,e){if(n.h===void 0||e.h===void 0)return 0;var t=Is(n.h),i=Is(e.h);return Math.abs(i-t)>180?t-(i-360*Math.sign(i-t)):i-t},Zx=function(n,e){if(n.h===void 0||e.h===void 0||!n.c||!e.c)return 0;var t=Is(n.h),i=Is(e.h),r=Math.sin((i-t+360)/2*Math.PI/180);return 2*Math.sqrt(n.c*e.c)*r},iu=function(n){var e=n.reduce(function(t,i){if(i!==void 0){var r=i*Math.PI/180;t.sin+=Math.sin(r),t.cos+=Math.cos(r)}return t},{sin:0,cos:0});return Math.atan2(e.sin,e.cos)*180/Math.PI},hMe={mode:"hsl",output:{rgb:rMe},input:{rgb:sMe},channels:["h","s","l","alpha"],ranges:{h:[0,360]},parsers:[oMe],interpolate:{h:{use:ot,fixup:nu},s:ot,l:ot,alpha:{use:ot,fixup:_r}},difference:{h:Rx},average:{h:iu}};function D6(n){var e=n.h,t=n.s,i=n.v,r=n.alpha;e=Is(e);var s=Math.abs(e/60%2-1),o;switch(Math.floor(e/60)){case 0:o={r:i,g:i*(1-t*s),b:i*(1-t)};break;case 1:o={r:i*(1-t*s),g:i,b:i*(1-t)};break;case 2:o={r:i*(1-t),g:i,b:i*(1-t*s)};break;case 3:o={r:i*(1-t),g:i*(1-t*s),b:i};break;case 4:o={r:i*(1-t*s),g:i*(1-t),b:i};break;case 5:o={r:i,g:i*(1-t),b:i*(1-t*s)};break;default:o={r:i*(1-t),g:i*(1-t),b:i*(1-t)}}return o.mode="rgb",r!==void 0&&(o.alpha=r),o}function P6(n){var e=n.r,t=n.g,i=n.b,r=n.alpha,s=Math.max(e,t,i),o=Math.min(e,t,i),a={mode:"hsv",s:s===0?0:1-o/s,v:s};return s-o!==0&&(a.h=(s===e?(t-i)/(s-o)+(t<i)*6:s===t?(i-e)/(s-o)+2:(e-t)/(s-o)+4)*60),r!==void 0&&(a.alpha=r),a}var fMe={mode:"hsv",output:{rgb:D6},input:{rgb:P6},channels:["h","s","v","alpha"],ranges:{h:[0,360]},interpolate:{h:{use:ot,fixup:nu},s:ot,v:ot,alpha:{use:ot,fixup:_r}},difference:{h:Rx},average:{h:iu}};function IMe(n){var e=n.h,t=n.s,i=n.i,r=n.alpha;e=Is(e);var s=Math.abs(e/60%2-1),o;switch(Math.floor(e/60)){case 0:o={r:i*(1+t*(3/(2-s)-1)),g:i*(1+t*(3*(1-s)/(2-s)-1)),b:i*(1-t)};break;case 1:o={r:i*(1+t*(3*(1-s)/(2-s)-1)),g:i*(1+t*(3/(2-s)-1)),b:i*(1-t)};break;case 2:o={r:i*(1-t),g:i*(1+t*(3/(2-s)-1)),b:i*(1+t*(3*(1-s)/(2-s)-1))};break;case 3:o={r:i*(1-t),g:i*(1+t*(3*(1-s)/(2-s)-1)),b:i*(1+t*(3/(2-s)-1))};break;case 4:o={r:i*(1+t*(3*(1-s)/(2-s)-1)),g:i*(1-t),b:i*(1+t*(3/(2-s)-1))};break;case 5:o={r:i*(1+t*(3/(2-s)-1)),g:i*(1-t),b:i*(1+t*(3*(1-s)/(2-s)-1))};break;default:o={r:i*(1-t),g:i*(1-t),b:i*(1-t)}}return o.mode="rgb",r!==void 0&&(o.alpha=r),o}function AMe(n){var e=n.r,t=n.g,i=n.b,r=n.alpha,s=Math.max(e,t,i),o=Math.min(e,t,i),a={mode:"hsi",s:e+t+i===0?0:1-3*o/(e+t+i),i:(e+t+i)/3};return s-o!==0&&(a.h=(s===e?(t-i)/(s-o)+(t<i)*6:s===t?(i-e)/(s-o)+2:(e-t)/(s-o)+4)*60),r!==void 0&&(a.alpha=r),a}var CMe={mode:"hsi",output:{rgb:IMe},input:{rgb:AMe},channels:["h","s","i","alpha"],ranges:{h:[0,360]},interpolate:{h:{use:ot,fixup:nu},s:ot,i:ot,alpha:{use:ot,fixup:_r}},difference:{h:Rx},average:{h:iu}};function pMe(n){var e=n.h,t=n.w,i=n.b,r=n.alpha;if(t+i>1){var s=t+i;t/=s,i/=s}return D6({h:e,s:i===1?1:1-t/(1-i),v:1-i,alpha:r})}function mMe(n){var e=P6(n);if(e!==void 0){var t={mode:"hwb",w:(1-e.s)*e.v,b:1-e.v};return e.h!==void 0&&(t.h=e.h),e.alpha!==void 0&&(t.alpha=e.alpha),t}}var yMe=function(n){if(typeof n=="string"){var e=n.match(XZe);if(e){var t={mode:"hwb",h:e[3]===void 0?OT(e[1],e[2]):+e[3],w:e[4]/100,b:e[5]/100};if(t.w+t.b>1){var i=t.w+t.b;t.w/=i,t.b/=i}return e[6]!==void 0?t.alpha=e[6]/100:e[7]!==void 0&&(t.alpha=+e[7]),t}}},vMe={mode:"hwb",output:{rgb:pMe},input:{rgb:mMe},channels:["h","w","b","alpha"],ranges:{h:[0,360]},parsers:[yMe],interpolate:{h:{use:ot,fixup:nu},w:ot,b:ot,alpha:{use:ot,fixup:_r}},difference:{h:dMe},average:{h:iu}},bMe=.1593017578125,BMe=134.03437499999998,GMe=.8359375,wMe=18.8515625,xMe=18.6875,SMe=16295499532821565e-27,BM=function(n){var e=Math.pow(n/1e4,bMe);return Math.pow((GMe+wMe*e)/(1+xMe*e),BMe)},GM=function(n){return Math.max(n*203,0)},U6=function(n){var e=n.x,t=n.y,i=n.z,r=n.alpha;e=GM(e),t=GM(t),i=GM(i);var s=1.15*e-.15*i,o=.66*t+.34*e,a=BM(.41478972*s+.579999*o+.014648*i),l=BM(-.20151*s+1.120649*o+.0531008*i),c=BM(-.0166008*s+.2648*o+.6684799*i),g=(a+l)/2,u={mode:"jab",j:.44*g/(1-.56*g)-SMe,a:3.524*a-4.066708*l+.542708*c,b:.199076*a+1.096799*l-1.295875*c};return r!==void 0&&(u.alpha=r),u},RMe=.1593017578125,ZMe=134.03437499999998,MMe=.8359375,EMe=18.8515625,WMe=18.6875,jK=16295499532821565e-27,wM=function(n){var e=Math.pow(n,1/ZMe);return 1e4*Math.pow((MMe-e)/(WMe*e-EMe),1/RMe)},xM=function(n){return n/203},Q6=function(n){var e=n.j,t=n.a,i=n.b,r=n.alpha,s=(e+jK)/(.44+.56*(e+jK)),o=wM(s+.13860504*t+.058047316*i),a=wM(s-.13860504*t-.058047316*i),l=wM(s-.096019242*t-.8118919*i),c={mode:"xyz65",x:xM(1.661373024652174*o-.914523081304348*a+.23136208173913045*l),y:xM(-.3250758611844533*o+1.571847026732543*a-.21825383453227928*l),z:xM(-.090982811*o-.31272829*a+1.5227666*l)};return r!==void 0&&(c.alpha=r),c},O6=function(n){var e=U6(sp(n));return n.r===n.b&&n.b===n.g&&(e.a=e.b=0),e},J6=function(n){return op(Q6(n))},FMe={mode:"jab",channels:["j","a","b","alpha"],input:{rgb:O6,xyz65:U6},output:{rgb:J6,xyz65:Q6},ranges:{j:[0,.221],a:[-.108,.129],b:[-.185,.134]},interpolate:{j:ot,a:ot,b:ot,alpha:{use:ot,fixup:_r}}},qK=function(n){var e=n.j,t=n.a,i=n.b,r=n.alpha,s=Math.sqrt(t*t+i*i),o={mode:"jch",j:e,c:s};return s&&(o.h=Is(Math.atan2(i,t)*180/Math.PI)),r!==void 0&&(o.alpha=r),o},$K=function(n){var e=n.j,t=n.c,i=n.h,r=n.alpha,s={mode:"jab",j:e,a:t?t*Math.cos(i/180*Math.PI):0,b:t?t*Math.sin(i/180*Math.PI):0};return r!==void 0&&(s.alpha=r),s},_Me={mode:"jch",output:{lab:$K,rgb:function(n){return J6($K(n))}},input:{rgb:function(n){return qK(O6(n))},lab:qK},channels:["j","c","h","alpha"],ranges:{j:[0,.221],c:[0,.19],h:[0,360]},interpolate:{h:{use:ot,fixup:nu},c:ot,j:ot,alpha:{use:ot,fixup:_r}},difference:{h:Zx},average:{h:iu}},ap=.96422,Fd=1,lp=.82521,Mx=Math.pow(29,3)/Math.pow(3,3),JT=Math.pow(6,3)/Math.pow(29,3),SM=function(n){return Math.pow(n,3)>JT?Math.pow(n,3):(116*n-16)/Mx},jT=function(n){var e=n.l,t=n.a,i=n.b,r=n.alpha,s=(e+16)/116,o=t/500+s,a=s-i/200,l={mode:"xyz",x:SM(o)*ap,y:SM(s)*Fd,z:SM(a)*lp};return r!==void 0&&(l.alpha=r),l},j6=function(n){return xx(jT(n))},RM=function(n){return n>JT?Math.cbrt(n):(Mx*n+16)/116},qT=function(n){var e=n.x,t=n.y,i=n.z,r=n.alpha,s=RM(e/ap),o=RM(t/Fd),a=RM(i/lp),l={mode:"lab",l:116*o-16,a:500*(s-o),b:200*(o-a)};return r!==void 0&&(l.alpha=r),l},q6=function(n){var e=qT(Sx(n));return n.r===n.b&&n.b===n.g&&(e.a=e.b=0),e},VMe=function(n){if(typeof n=="string"){var e=n.match(YZe);if(e){var t={mode:"lab",l:+e[1],a:+e[2],b:+e[3]};return e[4]!==void 0?t.alpha=e[4]/100:e[5]!==void 0&&(t.alpha=+e[5]),t}}},$T={mode:"lab",alias:["lab-d50"],output:{xyz:jT,rgb:j6},input:{xyz:qT,rgb:q6},channels:["l","a","b","alpha"],ranges:{l:[0,100],a:[-79.167,93.408],b:[-111.859,93.246]},parsers:[VMe],interpolate:{l:ot,a:ot,b:ot,alpha:{use:ot,fixup:_r}}},$6=.95047,eq=1,tq=1.08883,nq=Math.pow(29,3)/Math.pow(3,3),iq=Math.pow(6,3)/Math.pow(29,3),ZM=function(n){return Math.pow(n,3)>iq?Math.pow(n,3):(116*n-16)/nq},rq=function(n){var e=n.l,t=n.a,i=n.b,r=n.alpha,s=(e+16)/116,o=t/500+s,a=s-i/200,l={mode:"xyz65",x:ZM(o)*$6,y:ZM(s)*eq,z:ZM(a)*tq};return r!==void 0&&(l.alpha=r),l},Ex=function(n){return op(rq(n))},MM=function(n){return n>iq?Math.cbrt(n):(nq*n+16)/116},sq=function(n){var e=n.x,t=n.y,i=n.z,r=n.alpha,s=MM(e/$6),o=MM(t/eq),a=MM(i/tq),l={mode:"lab65",l:116*o-16,a:500*(s-o),b:200*(o-a)};return r!==void 0&&(l.alpha=r),l},Wx=function(n){var e=sq(sp(n));return n.r===n.b&&n.b===n.g&&(e.a=e.b=0),e},TMe=Object.assign({},$T,{mode:"lab65",alias:["lab-d65"],output:{xyz65:rq,rgb:Ex},input:{xyz65:sq,rgb:Wx},ranges:{l:[0,100],a:[-86.183,98.234],b:[-107.86,94.478]},parsers:[]}),wC=function(n,e){var t=n.l,i=n.a,r=n.b,s=n.alpha;e===void 0&&(e="lch");var o=Math.sqrt(i*i+r*r),a={mode:e,l:t,c:o};return o&&(a.h=Is(Math.atan2(r,i)*180/Math.PI)),s!==void 0&&(a.alpha=s),a},xC=function(n,e){var t=n.l,i=n.c,r=n.h,s=n.alpha;e===void 0&&(e="lab");var o={mode:e,l:t,a:i?i*Math.cos(r/180*Math.PI):0,b:i?i*Math.sin(r/180*Math.PI):0};return s!==void 0&&(o.alpha=s),o},NMe=function(n){if(typeof n=="string"){var e=n.match(KZe);if(e){var t={mode:"lch",l:+e[1],c:Math.max(0,+e[2]),h:e[5]===void 0?OT(e[3],e[4]):+e[5]};return e[6]!==void 0?t.alpha=e[6]/100:e[7]!==void 0&&(t.alpha=+e[7]),t}}},e5={mode:"lch",alias:["lch-d50"],output:{lab:xC,rgb:function(n){return j6(xC(n))}},input:{rgb:function(n){return wC(q6(n))},lab:wC},channels:["l","c","h","alpha"],ranges:{l:[0,100],c:[0,131.008],h:[0,360]},parsers:[NMe],interpolate:{h:{use:ot,fixup:nu},c:ot,l:ot,alpha:{use:ot,fixup:_r}},difference:{h:Zx},average:{h:iu}},kMe=Object.assign({},e5,{mode:"lch65",alias:["lch-d65"],output:{lab65:function(n){return xC(n,"lab65")},rgb:function(n){return Ex(xC(n,"lab65"))}},input:{rgb:function(n){return wC(Wx(n),"lch65")},lab65:function(n){return wC(n,"lch65")}},parsers:[],ranges:{l:[0,100],c:[0,133.807],h:[0,360]}}),oq=function(n,e,t){return 4*n/(n+15*e+3*t)},aq=function(n,e,t){return 9*e/(n+15*e+3*t)},LMe=oq(ap,Fd,lp),HMe=aq(ap,Fd,lp),zMe=function(n){return n<=JT?Mx*n:116*Math.cbrt(n)-16},lq=function(n){var e=n.x,t=n.y,i=n.z,r=n.alpha,s=zMe(t/Fd),o=oq(e,t,i),a=aq(e,t,i);!isFinite(o)||!isFinite(a)?s=o=a=0:(o=13*s*(o-LMe),a=13*s*(a-HMe));var l={mode:"luv",l:s,u:o,v:a};return r!==void 0&&(l.alpha=r),l},cq=function(n){return lq(Sx(n))},XMe=function(n,e,t){return 4*n/(n+15*e+3*t)},YMe=function(n,e,t){return 9*e/(n+15*e+3*t)},KMe=XMe(ap,Fd,lp),DMe=YMe(ap,Fd,lp),gq=function(n){var e=n.l,t=n.u,i=n.v,r=n.alpha,s=t/(13*e)+KMe,o=i/(13*e)+DMe,a=Fd*(e<=8?e/Mx:Math.pow((e+16)/116,3)),l=a*(9*s)/(4*o),c=a*(12-3*s-20*o)/(4*o),g={mode:"xyz",x:l,y:a,z:c};return r!==void 0&&(g.alpha=r),g},uq=function(n){return xx(gq(n))},PMe={mode:"luv",output:{xyz:gq,rgb:uq},input:{xyz:lq,rgb:cq},channels:["l","u","v","alpha"],ranges:{l:[0,100],u:[-84.86,174.87],v:[-125.744,87.165]},interpolate:{l:ot,u:ot,v:ot,alpha:{use:ot,fixup:_r}}},dq=function(n){var e=n.l,t=n.u,i=n.v,r=n.alpha,s=Math.sqrt(t*t+i*i),o={mode:"lchuv",l:e,c:s};return s&&(o.h=Is(Math.atan2(i,t)*180/Math.PI)),r!==void 0&&(o.alpha=r),o},hq=function(n){var e=n.l,t=n.c,i=n.h,r=n.alpha,s={mode:"luv",l:e,u:t?t*Math.cos(i/180*Math.PI):0,v:t?t*Math.sin(i/180*Math.PI):0};return r!==void 0&&(s.alpha=r),s},UMe=function(n){return uq(hq(n))},QMe=function(n){return dq(cq(n))},OMe={mode:"lchuv",output:{luv:hq,rgb:UMe},input:{rgb:QMe,luv:dq},channels:["l","c","h","alpha"],ranges:{l:[0,100],c:[0,131.008],h:[0,360]},interpolate:{h:{use:ot,fixup:nu},c:ot,l:ot,alpha:{use:ot,fixup:_r}},difference:{h:Zx},average:{h:iu}},fr=[-.14861,1.78277,-.29227,-.90649,1.97294,0],JMe=Math.PI/180,jMe=180/Math.PI,eD=fr[3]*fr[4],tD=fr[1]*fr[4],nD=fr[1]*fr[2]-fr[0]*fr[3],qMe=function(n){var e=n.r,t=n.g,i=n.b,r=n.alpha,s=(nD*i+e*eD-t*tD)/(nD+eD-tD),o=i-s,a=(fr[4]*(t-s)-fr[2]*o)/fr[3],l={mode:"cubehelix",l:s,s:s===0||s===1?void 0:Math.sqrt(o*o+a*a)/(fr[4]*s*(1-s))};return l.s&&(l.h=Math.atan2(a,o)*jMe-120),r!==void 0&&(l.alpha=r),l},$Me=function(n){var e=n.h,t=n.s,i=n.l,r=n.alpha,s={mode:"rgb"};e=(e===void 0?0:e+120)*JMe;var o=t===void 0?0:t*i*(1-i),a=Math.cos(e),l=Math.sin(e);return s.r=i+o*(fr[0]*a+fr[1]*l),s.g=i+o*(fr[2]*a+fr[3]*l),s.b=i+o*(fr[4]*a+fr[5]*l),r!==void 0&&(s.alpha=r),s},eEe={mode:"cubehelix",channels:["h","s","l","alpha"],ranges:{h:[0,360],s:[0,4.6143]},input:{rgb:qMe},output:{rgb:$Me},interpolate:{h:{use:ot,fixup:nu},s:ot,l:ot,alpha:{use:ot,fixup:_r}},difference:{h:Rx},average:{h:iu}},fq=function(n){var e=n.l,t=n.a,i=n.b,r=n.alpha,s=Math.sqrt(t*t+i*i),o={mode:"dlch",l:e,c:s};return s&&(o.h=Is(Math.atan2(i,t)*180/Math.PI)),r!==void 0&&(o.alpha=r),o},j2=1,Iq=1,Py=26/180*Math.PI,q2=Math.cos(Py),$2=Math.sin(Py),Aq=100/Math.log(139/100),eF=function(n){var e=n.l,t=n.c,i=n.h,r=n.alpha,s={mode:"lab65",l:(Math.exp(e*j2/Aq)-1)/.0039};if(i===void 0)s.a=s.b=0;else{var o=(Math.exp(.0435*t*Iq*j2)-1)/.075,a=o*Math.cos(i/180*Math.PI-Py),l=o*Math.sin(i/180*Math.PI-Py);s.a=a*q2-l/.83*$2,s.b=a*$2+l/.83*q2}return r!==void 0&&(s.alpha=r),s},iD=function(n){return eF(fq(n))},tF=function(n){var e=n.l,t=n.a,i=n.b,r=n.alpha,s=t*q2+i*$2,o=.83*(i*q2-t*$2),a=Math.sqrt(s*s+o*o),l={mode:"dlch",l:Aq/j2*Math.log(1+.0039*e),c:Math.log(1+.075*a)/(.0435*Iq*j2)};return l.c&&(l.h=Is((Math.atan2(o,s)+Py)/Math.PI*180)),r!==void 0&&(l.alpha=r),l},Cq=function(n){var e=n.l,t=n.c,i=n.h,r=n.alpha,s={mode:"dlab",l:e,a:t===0?0:t*Math.cos(i/180*Math.PI),b:t===0?0:t*Math.sin(i/180*Math.PI)};return r!==void 0&&(s.alpha=r),s},rD=function(n){return Cq(tF(n))},tEe={mode:"dlab",output:{lab65:iD,rgb:function(n){return Ex(iD(n))}},input:{lab65:rD,rgb:function(n){return rD(Wx(n))}},channels:["l","a","b","alpha"],ranges:{l:[0,100],a:[-40.09,45.5],b:[-40.47,44.344]},interpolate:{l:ot,a:ot,b:ot,alpha:{use:ot,fixup:_r}}},nEe={mode:"dlch",output:{lab65:eF,dlab:Cq,rgb:function(n){return Ex(eF(n))}},input:{lab65:tF,dlab:fq,rgb:function(n){return tF(Wx(n))}},channels:["l","c","h","alpha"],ranges:{l:[0,100],c:[0,51.484],h:[0,360]},interpolate:{l:ot,c:ot,h:{use:ot,fixup:nu},alpha:{use:ot,fixup:_r}},difference:{h:Zx},average:{h:iu}},iEe={mode:"xyz",alias:["xyz-d50"],output:{rgb:xx,lab:qT},input:{rgb:Sx,lab:jT},channels:["x","y","z","alpha"],ranges:{x:[0,.962],y:[0,.997],z:[0,.823]},interpolate:{x:ot,y:ot,z:ot,alpha:{use:ot,fixup:_r}}},rEe=function(n){var e=n.x,t=n.y,i=n.z,r=n.alpha,s={mode:"xyz",x:1.0478112*e+.0228866*t-.050127*i,y:.0295424*e+.9904844*t-.0170491*i,z:-.0092345*e+.0150436*t+.7521316*i};return r!==void 0&&(s.alpha=r),s},sEe=function(n){var e=n.x,t=n.y,i=n.z,r=n.alpha,s={mode:"xyz65",x:.9555766*e-.0230393*t+.0631636*i,y:-.0282895*e+1.0099416*t+.0210077*i,z:.0122982*e-.020483*t+1.3299098*i};return r!==void 0&&(s.alpha=r),s},oEe={mode:"xyz65",alias:["xyz-d65"],output:{rgb:op,xyz:rEe},input:{rgb:sp,xyz:sEe},ranges:{x:[0,.946],y:[0,.995],z:[0,1.083]},channels:["x","y","z","alpha"],interpolate:{x:ot,y:ot,z:ot,alpha:{use:ot,fixup:_r}}},aEe=function(n){var e=ip(n),t=e.r,i=e.g,r=e.b,s=e.alpha,o={mode:"yiq",y:.29889531*t+.58662247*i+.11448223*r,i:.59597799*t-.2741761*i-.32180189*r,q:.21147017*t-.52261711*i+.31114694*r};return s!==void 0&&(o.alpha=s),o},lEe=function(n){var e=n.y,t=n.i,i=n.q,r=n.alpha;return rp({r:e+.95608445*t+.6208885*i,g:e-.27137664*t-.6486059*i,b:e-1.10561724*t+1.70250126*i,alpha:r})},cEe={mode:"yiq",output:{rgb:lEe},input:{rgb:aEe},channels:["y","i","q","alpha"],ranges:{i:[-.593,.593],q:[-.52,.52]},interpolate:{y:ot,i:ot,q:ot,alpha:{use:ot,fixup:_r}}},pq=function(n){var e=n.l,t=n.a,i=n.b,r=n.alpha,s=Math.pow(e+.3963377774*t+.2158037573*i,3),o=Math.pow(e-.1055613458*t-.0638541728*i,3),a=Math.pow(e-.0894841775*t-1.291485548*i,3),l={mode:"lrgb",r:4.0767245293*s-3.3072168827*o+.2307590544*a,g:-1.2681437731*s+2.6093323231*o-.341134429*a,b:-.0041119885*s-.7034763098*o+1.7068625689*a};return r!==void 0&&(l.alpha=r),l},mq=function(n){var e=n.r,t=n.g,i=n.b,r=n.alpha,s=Math.cbrt(.412165612*e+.536275208*t+.0514575653*i),o=Math.cbrt(.211859107*e+.6807189584*t+.107406579*i),a=Math.cbrt(.0883097947*e+.2818474174*t+.6302613616*i),l={mode:"oklab",l:.2104542553*s+.793617785*o-.0040720468*a,a:1.9779984951*s-2.428592205*o+.4505937099*a,b:.0259040371*s+.7827717662*o-.808675766*a};return r!==void 0&&(l.alpha=r),l},yq=function(n){var e=mq(ip(n));return n.r===n.b&&n.b===n.g&&(e.a=e.b=0),e},vq=function(n){return rp(pq(n))},gEe=Object.assign({},$T,{mode:"oklab",alias:[],output:{lrgb:pq,rgb:vq},input:{lrgb:mq,rgb:yq},ranges:{l:[0,1],a:[-.233,.276],b:[-.311,.198]},parsers:[]}),uEe=Object.assign({},e5,{mode:"oklch",alias:[],output:{oklab:function(n){return xC(n,"oklab")},rgb:function(n){return vq(xC(n,"oklab"))}},input:{rgb:function(n){return wC(yq(n),"oklch")},oklab:function(n){return wC(n,"oklch")}},parsers:[],ranges:{l:[0,1],c:[0,.322],h:[0,360]}}),EM=function(n){return Math.round(Math.max(0,Math.min(n,1))*255)},dEe=vn("rgb"),hEe=function(n){var e=dEe(n);if(e!==void 0){var t=EM(e.r),i=EM(e.g),r=EM(e.b);return"#"+(1<<24|t<<16|i<<8|r).toString(16).slice(1)}};vn("rgb");vn("lch");vn("rgb");vn("rgb");On(qZe);On(eEe);On(tEe);On(nEe);On(CMe);On(hMe);On(fMe);On(vMe);On(FMe);On(_Me);On($T);On(TMe);On(e5);On(kMe);On(OMe);On(jZe);On(PMe);On($Ze);On(eMe);On(iMe);On(np);On(oEe);On(iEe);On(cEe);On(gEe);On(uEe);vn("a98");vn("cubehelix");vn("dlab");vn("dlch");vn("hsi");vn("hsl");vn("hsv");vn("hwb");vn("jab");vn("jch");vn("lab");vn("lab65");vn("lch");vn("lch65");vn("lchuv");vn("lrgb");vn("luv");vn("p3");vn("prophoto");vn("rec2020");var sD=vn("rgb");vn("xyz");vn("xyz65");vn("yiq");vn("oklab");var fEe=vn("oklch"),t5={exports:{}},QA=typeof Reflect=="object"?Reflect:null,oD=QA&&typeof QA.apply=="function"?QA.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)},M1;QA&&typeof QA.ownKeys=="function"?M1=QA.ownKeys:Object.getOwnPropertySymbols?M1=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:M1=function(e){return Object.getOwnPropertyNames(e)};function IEe(n){console&&console.warn&&console.warn(n)}var bq=Number.isNaN||function(e){return e!==e};function Wn(){Wn.init.call(this)}t5.exports=Wn;t5.exports.once=mEe;Wn.EventEmitter=Wn;Wn.prototype._events=void 0;Wn.prototype._eventsCount=0;Wn.prototype._maxListeners=void 0;var aD=10;function Fx(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(Wn,"defaultMaxListeners",{enumerable:!0,get:function(){return aD},set:function(n){if(typeof n!="number"||n<0||bq(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");aD=n}});Wn.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Wn.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||bq(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Bq(n){return n._maxListeners===void 0?Wn.defaultMaxListeners:n._maxListeners}Wn.prototype.getMaxListeners=function(){return Bq(this)};Wn.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r=e==="error",s=this._events;if(s!==void 0)r=r&&s.error===void 0;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=s[e];if(l===void 0)return!1;if(typeof l=="function")oD(l,this,t);else for(var c=l.length,g=Rq(l,c),i=0;i<c;++i)oD(g[i],this,t);return!0};function Gq(n,e,t,i){var r,s,o;if(Fx(t),s=n._events,s===void 0?(s=n._events=Object.create(null),n._eventsCount=0):(s.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),s=n._events),o=s[e]),o===void 0)o=s[e]=t,++n._eventsCount;else if(typeof o=="function"?o=s[e]=i?[t,o]:[o,t]:i?o.unshift(t):o.push(t),r=Bq(n),r>0&&o.length>r&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=n,a.type=e,a.count=o.length,IEe(a)}return n}Wn.prototype.addListener=function(e,t){return Gq(this,e,t,!1)};Wn.prototype.on=Wn.prototype.addListener;Wn.prototype.prependListener=function(e,t){return Gq(this,e,t,!0)};function AEe(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function wq(n,e,t){var i={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},r=AEe.bind(i);return r.listener=t,i.wrapFn=r,r}Wn.prototype.once=function(e,t){return Fx(t),this.on(e,wq(this,e,t)),this};Wn.prototype.prependOnceListener=function(e,t){return Fx(t),this.prependListener(e,wq(this,e,t)),this};Wn.prototype.removeListener=function(e,t){var i,r,s,o,a;if(Fx(t),r=this._events,r===void 0)return this;if(i=r[e],i===void 0)return this;if(i===t||i.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if(typeof i!="function"){for(s=-1,o=i.length-1;o>=0;o--)if(i[o]===t||i[o].listener===t){a=i[o].listener,s=o;break}if(s<0)return this;s===0?i.shift():CEe(i,s),i.length===1&&(r[e]=i[0]),r.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};Wn.prototype.off=Wn.prototype.removeListener;Wn.prototype.removeAllListeners=function(e){var t,i,r;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var s=Object.keys(i),o;for(r=0;r<s.length;++r)o=s[r],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=i[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this};function xq(n,e,t){var i=n._events;if(i===void 0)return[];var r=i[e];return r===void 0?[]:typeof r=="function"?t?[r.listener||r]:[r]:t?pEe(r):Rq(r,r.length)}Wn.prototype.listeners=function(e){return xq(this,e,!0)};Wn.prototype.rawListeners=function(e){return xq(this,e,!1)};Wn.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):Sq.call(n,e)};Wn.prototype.listenerCount=Sq;function Sq(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}Wn.prototype.eventNames=function(){return this._eventsCount>0?M1(this._events):[]};function Rq(n,e){for(var t=new Array(e),i=0;i<e;++i)t[i]=n[i];return t}function CEe(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function pEe(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function mEe(n,e){return new Promise(function(t,i){function r(o){n.removeListener(e,s),i(o)}function s(){typeof n.removeListener=="function"&&n.removeListener("error",r),t([].slice.call(arguments))}Zq(n,e,s,{once:!0}),e!=="error"&&yEe(n,r,{once:!0})})}function yEe(n,e,t){typeof n.on=="function"&&Zq(n,"error",e,t)}function Zq(n,e,t,i){if(typeof n.on=="function")i.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function r(s){i.once&&n.removeEventListener(e,r),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var vEe=t5.exports;function bEe(n,e){var t=atob(n);if(e){for(var i=new Uint8Array(t.length),r=0,s=t.length;r<s;++r)i[r]=t.charCodeAt(r);return String.fromCharCode.apply(null,new Uint16Array(i.buffer))}return t}function BEe(n,e,t){var i=e===void 0?null:e,r=t===void 0?!1:t,s=bEe(n,r),o=s.indexOf(`
`,10)+1,a=s.substring(o)+(i?"//# sourceMappingURL="+i:""),l=new Blob([a],{type:"application/javascript"});return URL.createObjectURL(l)}function GEe(n,e,t){var i;return function(s){return i=i||BEe(n,e,t),new Worker(i,s)}}var wEe=GEe("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KCiAgLyoqCiAgICogQSAzeDMgbWF0cml4LgogICAqIEF1dGhvcmVkIGJ5IHtAbGluayBodHRwOi8vZ2l0aHViLmNvbS9zY2h0ZXBwZS8gc2NodGVwcGV9CiAgICovCiAgY2xhc3MgTWF0MyB7CiAgICAvKioKICAgICAqIEEgdmVjdG9yIG9mIGxlbmd0aCA5LCBjb250YWluaW5nIGFsbCBtYXRyaXggZWxlbWVudHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBlbGVtZW50cyBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihlbGVtZW50cykgewogICAgICBpZiAoZWxlbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIGVsZW1lbnRzID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwogICAgICB9CgogICAgICB0aGlzLmVsZW1lbnRzID0gZWxlbWVudHM7CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIG1hdHJpeCB0byBpZGVudGl0eQogICAgICogQHRvZG8gU2hvdWxkIHBlcmhhcHMgYmUgcmVuYW1lZCB0byBgc2V0SWRlbnRpdHkoKWAgdG8gYmUgbW9yZSBjbGVhci4KICAgICAqIEB0b2RvIENyZWF0ZSBhbm90aGVyIGZ1bmN0aW9uIHRoYXQgaW1tZWRpYXRlbHkgY3JlYXRlcyBhbiBpZGVudGl0eSBtYXRyaXggZWcuIGBleWUoKWAKICAgICAqLwoKCiAgICBpZGVudGl0eSgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSAxOwogICAgICBlWzFdID0gMDsKICAgICAgZVsyXSA9IDA7CiAgICAgIGVbM10gPSAwOwogICAgICBlWzRdID0gMTsKICAgICAgZVs1XSA9IDA7CiAgICAgIGVbNl0gPSAwOwogICAgICBlWzddID0gMDsKICAgICAgZVs4XSA9IDE7CiAgICB9CiAgICAvKioKICAgICAqIFNldCBhbGwgZWxlbWVudHMgdG8gemVybwogICAgICovCgoKICAgIHNldFplcm8oKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMDsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDA7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMgZnJvbSBhIFZlYzMKICAgICAqLwoKCiAgICBzZXRUcmFjZSh2ZWN0b3IpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSB2ZWN0b3IueDsKICAgICAgZVs0XSA9IHZlY3Rvci55OwogICAgICBlWzhdID0gdmVjdG9yLno7CiAgICB9CiAgICAvKioKICAgICAqIEdldHMgdGhlIG1hdHJpeCBkaWFnb25hbCBlbGVtZW50cwogICAgICovCgoKICAgIGdldFRyYWNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgdGFyZ2V0LnggPSBlWzBdOwogICAgICB0YXJnZXQueSA9IGVbNF07CiAgICAgIHRhcmdldC56ID0gZVs4XTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LVZlY3RvciBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIHYgVGhlIHZlY3RvciB0byBtdWx0aXBseSB3aXRoCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLCB0YXJnZXQgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgeCA9IHYueDsKICAgICAgY29uc3QgeSA9IHYueTsKICAgICAgY29uc3QgeiA9IHYuejsKICAgICAgdGFyZ2V0LnggPSBlWzBdICogeCArIGVbMV0gKiB5ICsgZVsyXSAqIHo7CiAgICAgIHRhcmdldC55ID0gZVszXSAqIHggKyBlWzRdICogeSArIGVbNV0gKiB6OwogICAgICB0YXJnZXQueiA9IGVbNl0gKiB4ICsgZVs3XSAqIHkgKyBlWzhdICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LXNjYWxhciBtdWx0aXBsaWNhdGlvbgogICAgICovCgoKICAgIHNtdWx0KHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSAqPSBzOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIG1hdHJpeCBNYXRyaXggdG8gbXVsdGlwbHkgd2l0aCBmcm9tIGxlZnQgc2lkZS4KICAgICAqLwoKCiAgICBtbXVsdChtYXRyaXgsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICBjb25zdCBBID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgQiA9IG1hdHJpeC5lbGVtZW50czsKICAgICAgY29uc3QgVCA9IHRhcmdldC5lbGVtZW50czsKICAgICAgY29uc3QgYTExID0gQVswXSwKICAgICAgICAgICAgYTEyID0gQVsxXSwKICAgICAgICAgICAgYTEzID0gQVsyXSwKICAgICAgICAgICAgYTIxID0gQVszXSwKICAgICAgICAgICAgYTIyID0gQVs0XSwKICAgICAgICAgICAgYTIzID0gQVs1XSwKICAgICAgICAgICAgYTMxID0gQVs2XSwKICAgICAgICAgICAgYTMyID0gQVs3XSwKICAgICAgICAgICAgYTMzID0gQVs4XTsKICAgICAgY29uc3QgYjExID0gQlswXSwKICAgICAgICAgICAgYjEyID0gQlsxXSwKICAgICAgICAgICAgYjEzID0gQlsyXSwKICAgICAgICAgICAgYjIxID0gQlszXSwKICAgICAgICAgICAgYjIyID0gQls0XSwKICAgICAgICAgICAgYjIzID0gQls1XSwKICAgICAgICAgICAgYjMxID0gQls2XSwKICAgICAgICAgICAgYjMyID0gQls3XSwKICAgICAgICAgICAgYjMzID0gQls4XTsKICAgICAgVFswXSA9IGExMSAqIGIxMSArIGExMiAqIGIyMSArIGExMyAqIGIzMTsKICAgICAgVFsxXSA9IGExMSAqIGIxMiArIGExMiAqIGIyMiArIGExMyAqIGIzMjsKICAgICAgVFsyXSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMzsKICAgICAgVFszXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKICAgICAgVFs0XSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKICAgICAgVFs1XSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKICAgICAgVFs2XSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMTsKICAgICAgVFs3XSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMjsKICAgICAgVFs4XSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2NhbGUgZWFjaCBjb2x1bW4gb2YgdGhlIG1hdHJpeAogICAgICovCgoKICAgIHNjYWxlKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCB0ID0gdGFyZ2V0LmVsZW1lbnRzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDM7IGkrKykgewogICAgICAgIHRbMyAqIGkgKyAwXSA9IHZlY3Rvci54ICogZVszICogaSArIDBdOwogICAgICAgIHRbMyAqIGkgKyAxXSA9IHZlY3Rvci55ICogZVszICogaSArIDFdOwogICAgICAgIHRbMyAqIGkgKyAyXSA9IHZlY3Rvci56ICogZVszICogaSArIDJdOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSBBeD1iCiAgICAgKiBAcGFyYW0gYiBUaGUgcmlnaHQgaGFuZCBzaWRlCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBUYXJnZXQgdmVjdG9yIHRvIHNhdmUgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSBzb2x1dGlvbiB4CiAgICAgKiBAdG9kbyBzaG91bGQgcmV1c2UgYXJyYXlzCiAgICAgKi8KCgogICAgc29sdmUoYiwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA0OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IFtdOwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbnIgKiBuYzsgaSsrKSB7CiAgICAgICAgZXFucy5wdXNoKDApOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgZXFuc1tpICsgbmMgKiBqXSA9IHRoaXMuZWxlbWVudHNbaSArIDMgKiBqXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGVxbnNbMyArIDQgKiAwXSA9IGIueDsKICAgICAgZXFuc1szICsgNCAqIDFdID0gYi55OwogICAgICBlcW5zWzMgKyA0ICogMl0gPSBiLno7IC8vIENvbXB1dGUgcmlnaHQgdXBwZXIgdHJpYW5ndWxhciB2ZXJzaW9uIG9mIHRoZSBtYXRyaXggLSBHYXVzcyBlbGltaW5hdGlvbgoKICAgICAgbGV0IG4gPSAzOwogICAgICBjb25zdCBrID0gbjsKICAgICAgbGV0IG5wOwogICAgICBjb25zdCBrcCA9IDQ7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaWduZSggaSApID0gbGlnbmUoIGkgKSArIGxpZ25lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaWduZSggayApID0gbGlnbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaWduZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gR2V0IHRoZSBzb2x1dGlvbgoKCiAgICAgIHRhcmdldC56ID0gZXFuc1syICogbmMgKyAzXSAvIGVxbnNbMiAqIG5jICsgMl07CiAgICAgIHRhcmdldC55ID0gKGVxbnNbMSAqIG5jICsgM10gLSBlcW5zWzEgKiBuYyArIDJdICogdGFyZ2V0LnopIC8gZXFuc1sxICogbmMgKyAxXTsKICAgICAgdGFyZ2V0LnggPSAoZXFuc1swICogbmMgKyAzXSAtIGVxbnNbMCAqIG5jICsgMl0gKiB0YXJnZXQueiAtIGVxbnNbMCAqIG5jICsgMV0gKiB0YXJnZXQueSkgLyBlcW5zWzAgKiBuYyArIDBdOwoKICAgICAgaWYgKGlzTmFOKHRhcmdldC54KSB8fCBpc05hTih0YXJnZXQueSkgfHwgaXNOYU4odGFyZ2V0LnopIHx8IHRhcmdldC54ID09PSBJbmZpbml0eSB8fCB0YXJnZXQueSA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnogPT09IEluZmluaXR5KSB7CiAgICAgICAgdGhyb3cgYENvdWxkIG5vdCBzb2x2ZSBlcXVhdGlvbiEgR290IHg9WyR7dGFyZ2V0LnRvU3RyaW5nKCl9XSwgYj1bJHtiLnRvU3RyaW5nKCl9XSwgQT1bJHt0aGlzLnRvU3RyaW5nKCl9XWA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50IGluIHRoZSBtYXRyaXggYnkgaW5kZXguIEluZGV4IHN0YXJ0cyBhdCAwLCBub3QgMSEhIQogICAgICogQHBhcmFtIHZhbHVlIElmIHByb3ZpZGVkLCB0aGUgbWF0cml4IGVsZW1lbnQgd2lsbCBiZSBzZXQgdG8gdGhpcyB2YWx1ZS4KICAgICAqLwoKCiAgICBlKHJvdywgY29sdW1uLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNldCB2YWx1ZQogICAgICAgIHRoaXMuZWxlbWVudHNbY29sdW1uICsgMyAqIHJvd10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGFub3RoZXIgbWF0cml4IGludG8gdGhpcyBtYXRyaXggb2JqZWN0LgogICAgICovCgoKICAgIGNvcHkobWF0cml4KSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0cml4LmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSA9IG1hdHJpeC5lbGVtZW50c1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hdHJpeC4KICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgbGV0IHIgPSAnJzsKICAgICAgY29uc3Qgc2VwID0gJywnOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICByICs9IHRoaXMuZWxlbWVudHNbaV0gKyBzZXA7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQogICAgLyoqCiAgICAgKiByZXZlcnNlIHRoZSBtYXRyaXgKICAgICAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IG1hdHJpeCB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICovCgoKICAgIHJldmVyc2UodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA2OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IHJldmVyc2VfZXFuczsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgZm9yIChpID0gMDsgaSA8IDM7IGkrKykgewogICAgICAgIGZvciAoaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIGVxbnNbaSArIG5jICogal0gPSB0aGlzLmVsZW1lbnRzW2kgKyAzICogal07CiAgICAgICAgfQogICAgICB9CgogICAgICBlcW5zWzMgKyA2ICogMF0gPSAxOwogICAgICBlcW5zWzMgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzMgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMV0gPSAxOwogICAgICBlcW5zWzQgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMl0gPSAxOyAvLyBDb21wdXRlIHJpZ2h0IHVwcGVyIHRyaWFuZ3VsYXIgdmVyc2lvbiBvZiB0aGUgbWF0cml4IC0gR2F1c3MgZWxpbWluYXRpb24KCiAgICAgIGxldCBuID0gMzsKICAgICAgY29uc3QgayA9IG47CiAgICAgIGxldCBucDsKICAgICAgY29uc3Qga3AgPSBuYzsgLy8gbnVtIHJvd3MKCiAgICAgIGxldCBwOwoKICAgICAgZG8gewogICAgICAgIGkgPSBrIC0gbjsKCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gPT09IDApIHsKICAgICAgICAgIC8vIHRoZSBwaXZvdCBpcyBudWxsLCBzd2FwIGxpbmVzCiAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IGs7IGorKykgewogICAgICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBqXSAhPT0gMCkgewogICAgICAgICAgICAgIG5wID0ga3A7CgogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGkgKSA9IGxpbmUoIGkgKSArIGxpbmUoIGsgKQogICAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldICs9IGVxbnNbcCArIG5jICogal07CiAgICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBpXSAhPT0gMCkgewogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGsgKSA9IGxpbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaW5lKCBpICkKICAgICAgICAgICAgICBwID0ga3AgLSBucDsKICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gcCA8PSBpID8gMCA6IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IHdoaWxlICgtLW4pOyAvLyBlbGltaW5hdGUgdGhlIHVwcGVyIGxlZnQgdHJpYW5nbGUgb2YgdGhlIG1hdHJpeAoKCiAgICAgIGkgPSAyOwoKICAgICAgZG8gewogICAgICAgIGogPSBpIC0gMTsKCiAgICAgICAgZG8gewogICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gZXFuc1twICsgbmMgKiBqXSAtIGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgfSB3aGlsZSAoai0tKTsKICAgICAgfSB3aGlsZSAoLS1pKTsgLy8gb3BlcmF0aW9ucyBvbiB0aGUgZGlhZ29uYWwKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gMSAvIGVxbnNbaSArIG5jICogaV07CiAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IG5jIC0gbnA7CiAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldID0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgIH0gd2hpbGUgKGktLSk7CgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gMjsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IGVxbnNbbnIgKyBqICsgbmMgKiBpXTsKCiAgICAgICAgICBpZiAoaXNOYU4ocCkgfHwgcCA9PT0gSW5maW5pdHkpIHsKICAgICAgICAgICAgdGhyb3cgYENvdWxkIG5vdCByZXZlcnNlISBBPVske3RoaXMudG9TdHJpbmcoKX1dYDsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgTSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGxldCB0bXA7IC8vU2V0IGRpYWdvbmFscwoKICAgICAgVFswXSA9IE1bMF07CiAgICAgIFRbNF0gPSBNWzRdOwogICAgICBUWzhdID0gTVs4XTsKICAgICAgdG1wID0gTVsxXTsKICAgICAgVFsxXSA9IE1bM107CiAgICAgIFRbM10gPSB0bXA7CiAgICAgIHRtcCA9IE1bMl07CiAgICAgIFRbMl0gPSBNWzZdOwogICAgICBUWzZdID0gdG1wOwogICAgICB0bXAgPSBNWzVdOwogICAgICBUWzVdID0gTVs3XTsKICAgICAgVFs3XSA9IHRtcDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgfQogIGNvbnN0IHJldmVyc2VfZXFucyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKCiAgLyoqCiAgICogMy1kaW1lbnNpb25hbCB2ZWN0b3IKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCB2ID0gbmV3IFZlYzMoMSwgMiwgMykKICAgKiAgICAgY29uc29sZS5sb2coJ3g9JyArIHYueCkgLy8geD0xCiAgICovCgogIGNsYXNzIFZlYzMgewogICAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDAuMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwLjA7CiAgICAgIH0KCiAgICAgIGlmICh6ID09PSB2b2lkIDApIHsKICAgICAgICB6ID0gMC4wOwogICAgICB9CgogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgY3Jvc3MgcHJvZHVjdAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbi4KICAgICAqLwoKCiAgICBjcm9zcyh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB2eCA9IHZlY3Rvci54OwogICAgICBjb25zdCB2eSA9IHZlY3Rvci55OwogICAgICBjb25zdCB2eiA9IHZlY3Rvci56OwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHkgKiB2eiAtIHogKiB2eTsKICAgICAgdGFyZ2V0LnkgPSB6ICogdnggLSB4ICogdno7CiAgICAgIHRhcmdldC56ID0geCAqIHZ5IC0geSAqIHZ4OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZlY3RvcnMnIDMgZWxlbWVudHMKICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeikgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFsbCBjb21wb25lbnRzIG9mIHRoZSB2ZWN0b3IgdG8gemVyby4KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICB0aGlzLnggPSB0aGlzLnkgPSB0aGlzLnogPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgYWRkaXRpb24KICAgICAqLwoKCiAgICB2YWRkKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICsgdGhpcy54OwogICAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKyB0aGlzLnk7CiAgICAgICAgdGFyZ2V0LnogPSB2ZWN0b3IueiArIHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54ICsgdmVjdG9yLngsIHRoaXMueSArIHZlY3Rvci55LCB0aGlzLnogKyB2ZWN0b3Iueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIHN1YnRyYWN0aW9uCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluLgogICAgICovCgoKICAgIHZzdWIodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdGhpcy54IC0gdmVjdG9yLng7CiAgICAgICAgdGFyZ2V0LnkgPSB0aGlzLnkgLSB2ZWN0b3IueTsKICAgICAgICB0YXJnZXQueiA9IHRoaXMueiAtIHZlY3Rvci56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggLSB2ZWN0b3IueCwgdGhpcy55IC0gdmVjdG9yLnksIHRoaXMueiAtIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNyb3NzIHByb2R1Y3QgbWF0cml4IGFfY3Jvc3MgZnJvbSBhIHZlY3Rvciwgc3VjaCB0aGF0IGEgeCBiID0gYV9jcm9zcyAqIGIgPSBjCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci9UREJEMjQvVlQwNi9sZWN0dXJlcy9MZWN0dXJlNi5wZGYgVW1lw6UgVW5pdmVyc2l0eSBMZWN0dXJlfQogICAgICovCgoKICAgIGNyb3NzbWF0KCkgewogICAgICByZXR1cm4gbmV3IE1hdDMoWzAsIC10aGlzLnosIHRoaXMueSwgdGhpcy56LCAwLCAtdGhpcy54LCAtdGhpcy55LCB0aGlzLngsIDBdKTsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSB2ZWN0b3IuIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBpbiB0aGUgdmVjdG9yLgogICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgbm9ybSBvZiB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBuID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeik7CgogICAgICBpZiAobiA+IDAuMCkgewogICAgICAgIGNvbnN0IGludk4gPSAxIC8gbjsKICAgICAgICB0aGlzLnggKj0gaW52TjsKICAgICAgICB0aGlzLnkgKj0gaW52TjsKICAgICAgICB0aGlzLnogKj0gaW52TjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBNYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB2ZXJzaW9uIG9mIHRoaXMgdmVjdG9yIHRoYXQgaXMgb2YgbGVuZ3RoIDEuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIHVuaXQgdmVjdG9yCiAgICAgKi8KCgogICAgdW5pdCh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHNjYWxhciAqIHg7CiAgICAgIHRhcmdldC55ID0gc2NhbGFyICogeTsKICAgICAgdGFyZ2V0LnogPSBzY2FsYXIgKiB6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgdmVjdG9yIHdpdGggYW4gb3RoZXIgdmVjdG9yLCBjb21wb25lbnQtd2lzZS4KICAgICAqIEBwYXJhbSB0YXJnZXQgVGhlIHZlY3RvciB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bCh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICogdGhpcy54OwogICAgICB0YXJnZXQueSA9IHZlY3Rvci55ICogdGhpcy55OwogICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICogdGhpcy56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTY2FsZSBhIHZlY3RvciBhbmQgYWRkIGl0IHRvIHRoaXMgdmVjdG9yLiBTYXZlIHRoZSByZXN1bHQgaW4gInRhcmdldCIuICh0YXJnZXQgPSB0aGlzICsgdmVjdG9yICogc2NhbGFyKQogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBhZGRTY2FsZWRWZWN0b3Ioc2NhbGFyLCB2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnggPSAtdGhpcy54OwogICAgICB0YXJnZXQueSA9IC10aGlzLnk7CiAgICAgIHRhcmdldC56ID0gLXRoaXMuejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0d28gYXJ0aWZpY2lhbCB0YW5nZW50cyB0byB0aGUgdmVjdG9yCiAgICAgKiBAcGFyYW0gdDEgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBmaXJzdCB0YW5nZW50IGluCiAgICAgKiBAcGFyYW0gdDIgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBzZWNvbmQgdGFuZ2VudCBpbgogICAgICovCgoKICAgIHRhbmdlbnRzKHQxLCB0MikgewogICAgICBjb25zdCBub3JtID0gdGhpcy5sZW5ndGgoKTsKCiAgICAgIGlmIChub3JtID4gMC4wKSB7CiAgICAgICAgY29uc3QgbiA9IFZlYzNfdGFuZ2VudHNfbjsKICAgICAgICBjb25zdCBpbm9ybSA9IDEgLyBub3JtOwogICAgICAgIG4uc2V0KHRoaXMueCAqIGlub3JtLCB0aGlzLnkgKiBpbm9ybSwgdGhpcy56ICogaW5vcm0pOwogICAgICAgIGNvbnN0IHJhbmRWZWMgPSBWZWMzX3RhbmdlbnRzX3JhbmRWZWM7CgogICAgICAgIGlmIChNYXRoLmFicyhuLngpIDwgMC45KSB7CiAgICAgICAgICByYW5kVmVjLnNldCgxLCAwLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5kVmVjLnNldCgwLCAxLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0KCiAgICAgICAgbi5jcm9zcyh0MSwgdDIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBub3JtYWwgbGVuZ3RoIGlzIHplcm8sIG1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdDEuc2V0KDEsIDAsIDApOwogICAgICAgIHQyLnNldCgwLCAxLCAwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhIG1vcmUgcmVhZGFibGUgZm9ybWF0CiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen1gOwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhbiBhcnJheQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMuel07CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAgKi8KCgogICAgY29weSh2ZWN0b3IpIHsKICAgICAgdGhpcy54ID0gdmVjdG9yLng7CiAgICAgIHRoaXMueSA9IHZlY3Rvci55OwogICAgICB0aGlzLnogPSB2ZWN0b3IuejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIERvIGEgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmVjdG9ycwogICAgICogQHBhcmFtIHQgQSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLiAwIHdpbGwgbWFrZSB0aGlzIGZ1bmN0aW9uIHJldHVybiB1LCBhbmQgMSB3aWxsIG1ha2UgaXQgcmV0dXJuIHYuIE51bWJlcnMgaW4gYmV0d2VlbiB3aWxsIGdlbmVyYXRlIGEgdmVjdG9yIGluIGJldHdlZW4gdGhlbS4KICAgICAqLwoKCiAgICBsZXJwKHZlY3RvciwgdCwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geCArICh2ZWN0b3IueCAtIHgpICogdDsKICAgICAgdGFyZ2V0LnkgPSB5ICsgKHZlY3Rvci55IC0geSkgKiB0OwogICAgICB0YXJnZXQueiA9IHogKyAodmVjdG9yLnogLSB6KSAqIHQ7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGVxdWFscyBpcyBhbG1vc3QgZXF1YWwgdG8gYW5vdGhlciBvbmUuCiAgICAgKi8KCgogICAgYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIGlmIChwcmVjaXNpb24gPT09IHZvaWQgMCkgewogICAgICAgIHByZWNpc2lvbiA9IDFlLTY7CiAgICAgIH0KCiAgICAgIGlmIChNYXRoLmFicyh0aGlzLnggLSB2ZWN0b3IueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55IC0gdmVjdG9yLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueiAtIHZlY3Rvci56KSA+IHByZWNpc2lvbikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGlzIGFsbW9zdCB6ZXJvCiAgICAgKi8KCgogICAgYWxtb3N0WmVybyhwcmVjaXNpb24pIHsKICAgICAgaWYgKHByZWNpc2lvbiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcHJlY2lzaW9uID0gMWUtNjsKICAgICAgfQoKICAgICAgaWYgKE1hdGguYWJzKHRoaXMueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnopID4gcHJlY2lzaW9uKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIHZlY3RvciBpcyBhbnRpLXBhcmFsbGVsIHRvIGFub3RoZXIgdmVjdG9yLgogICAgICogQHBhcmFtIHByZWNpc2lvbiBTZXQgdG8gemVybyBmb3IgZXhhY3QgY29tcGFyaXNvbnMKICAgICAqLwoKCiAgICBpc0FudGlwYXJhbGxlbFRvKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIHRoaXMubmVnYXRlKGFudGlwX25lZyk7CiAgICAgIHJldHVybiBhbnRpcF9uZWcuYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKTsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgdGhlIHZlY3RvcgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54LCB0aGlzLnksIHRoaXMueik7CiAgICB9CgogIH0KICBWZWMzLlpFUk8gPSBuZXcgVmVjMygwLCAwLCAwKTsKICBWZWMzLlVOSVRfWCA9IG5ldyBWZWMzKDEsIDAsIDApOwogIFZlYzMuVU5JVF9ZID0gbmV3IFZlYzMoMCwgMSwgMCk7CiAgVmVjMy5VTklUX1ogPSBuZXcgVmVjMygwLCAwLCAxKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IFZlYzNfdGFuZ2VudHNfcmFuZFZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYW50aXBfbmVnID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KICBjbGFzcyBBQUJCIHsKICAgIC8qKgogICAgICogVGhlIGxvd2VyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHVwcGVyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLmxvd2VyQm91bmQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnVwcGVyQm91bmQgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG93ZXJCb3VuZCkgewogICAgICAgIHRoaXMubG93ZXJCb3VuZC5jb3B5KG9wdGlvbnMubG93ZXJCb3VuZCk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnVwcGVyQm91bmQpIHsKICAgICAgICB0aGlzLnVwcGVyQm91bmQuY29weShvcHRpb25zLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgQUFCQiBib3VuZHMgZnJvbSBhIHNldCBvZiBwb2ludHMuCiAgICAgKiBAcGFyYW0gcG9pbnRzIEFuIGFycmF5IG9mIFZlYzMncy4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0CiAgICAgKi8KCgogICAgc2V0RnJvbVBvaW50cyhwb2ludHMsIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBza2luU2l6ZSkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBxID0gcXVhdGVybmlvbjsgLy8gU2V0IHRvIHRoZSBmaXJzdCBwb2ludAoKICAgICAgbC5jb3B5KHBvaW50c1swXSk7CgogICAgICBpZiAocSkgewogICAgICAgIHEudm11bHQobCwgbCk7CiAgICAgIH0KCiAgICAgIHUuY29weShsKTsKCiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IHAgPSBwb2ludHNbaV07CgogICAgICAgIGlmIChxKSB7CiAgICAgICAgICBxLnZtdWx0KHAsIHRtcCQxKTsKICAgICAgICAgIHAgPSB0bXAkMTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPiB1LngpIHsKICAgICAgICAgIHUueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPCBsLnkpIHsKICAgICAgICAgIGwueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHAuejsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHAuejsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIG9mZnNldAoKCiAgICAgIGlmIChwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uLnZhZGQobCwgbCk7CiAgICAgICAgcG9zaXRpb24udmFkZCh1LCB1KTsKICAgICAgfQoKICAgICAgaWYgKHNraW5TaXplKSB7CiAgICAgICAgbC54IC09IHNraW5TaXplOwogICAgICAgIGwueSAtPSBza2luU2l6ZTsKICAgICAgICBsLnogLT0gc2tpblNpemU7CiAgICAgICAgdS54ICs9IHNraW5TaXplOwogICAgICAgIHUueSArPSBza2luU2l6ZTsKICAgICAgICB1LnogKz0gc2tpblNpemU7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGJvdW5kcyBmcm9tIGFuIEFBQkIgdG8gdGhpcyBBQUJCCiAgICAgKiBAcGFyYW0gYWFiYiBTb3VyY2UgdG8gY29weSBmcm9tCiAgICAgKiBAcmV0dXJuIFRoZSB0aGlzIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eQogICAgICovCgoKICAgIGNvcHkoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQuY29weShhYWJiLmxvd2VyQm91bmQpOwogICAgICB0aGlzLnVwcGVyQm91bmQuY29weShhYWJiLnVwcGVyQm91bmQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgYW4gQUFCQgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IEFBQkIoKS5jb3B5KHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBFeHRlbmQgdGhpcyBBQUJCIHNvIHRoYXQgaXQgY292ZXJzIHRoZSBnaXZlbiBBQUJCIHRvby4KICAgICAqLwoKCiAgICBleHRlbmQoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQueCA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC54ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC54KTsKICAgICAgdGhpcy5sb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueSwgYWFiYi5sb3dlckJvdW5kLnkpOwogICAgICB0aGlzLnVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC55LCBhYWJiLnVwcGVyQm91bmQueSk7CiAgICAgIHRoaXMubG93ZXJCb3VuZC56ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLnosIGFhYmIubG93ZXJCb3VuZC56KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnogPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueiwgYWFiYi51cHBlckJvdW5kLnopOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIEFBQkIgb3ZlcmxhcHMgdGhpcyBBQUJCLgogICAgICovCgoKICAgIG92ZXJsYXBzKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tfAogICAgICAvLyBsMSAgICAgICB1MQoKICAgICAgY29uc3Qgb3ZlcmxhcHNYID0gbDIueCA8PSB1MS54ICYmIHUxLnggPD0gdTIueCB8fCBsMS54IDw9IHUyLnggJiYgdTIueCA8PSB1MS54OwogICAgICBjb25zdCBvdmVybGFwc1kgPSBsMi55IDw9IHUxLnkgJiYgdTEueSA8PSB1Mi55IHx8IGwxLnkgPD0gdTIueSAmJiB1Mi55IDw9IHUxLnk7CiAgICAgIGNvbnN0IG92ZXJsYXBzWiA9IGwyLnogPD0gdTEueiAmJiB1MS56IDw9IHUyLnogfHwgbDEueiA8PSB1Mi56ICYmIHUyLnogPD0gdTEuejsKICAgICAgcmV0dXJuIG92ZXJsYXBzWCAmJiBvdmVybGFwc1kgJiYgb3ZlcmxhcHNaOwogICAgfSAvLyBNb3N0bHkgZm9yIGRlYnVnZ2luZwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIHJldHVybiAodS54IC0gbC54KSAqICh1LnkgLSBsLnkpICogKHUueiAtIGwueik7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gQUFCQiBpcyBmdWxseSBjb250YWluZWQgaW4gdGhpcyBBQUJCLgogICAgICovCgoKICAgIGNvbnRhaW5zKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tLS0tLS0tLXwKICAgICAgLy8gbDEgICAgICAgICAgICAgIHUxCgogICAgICByZXR1cm4gbDEueCA8PSBsMi54ICYmIHUxLnggPj0gdTIueCAmJiBsMS55IDw9IGwyLnkgJiYgdTEueSA+PSB1Mi55ICYmIGwxLnogPD0gbDIueiAmJiB1MS56ID49IHUyLno7CiAgICB9CgogICAgZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGEuY29weShsKTsKICAgICAgYi5zZXQodS54LCBsLnksIGwueik7CiAgICAgIGMuc2V0KHUueCwgdS55LCBsLnopOwogICAgICBkLnNldChsLngsIHUueSwgdS56KTsKICAgICAgZS5zZXQodS54LCBsLnksIHUueik7CiAgICAgIGYuc2V0KGwueCwgdS55LCBsLnopOwogICAgICBnLnNldChsLngsIGwueSwgdS56KTsKICAgICAgaC5jb3B5KHUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gYW5vdGhlciBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvTG9jYWxGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb0xvY2FsKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gdGhlIGdsb2JhbCBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvV29ybGRGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb1dvcmxkKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgQUFCQiBpcyBoaXQgYnkgYSByYXkuCiAgICAgKi8KCgogICAgb3ZlcmxhcHNSYXkocmF5KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkaXJlY3Rpb24sCiAgICAgICAgZnJvbQogICAgICB9ID0gcmF5OyAvLyBjb25zdCB0ID0gMAogICAgICAvLyByYXkuZGlyZWN0aW9uIGlzIHVuaXQgZGlyZWN0aW9uIHZlY3RvciBvZiByYXkKCiAgICAgIGNvbnN0IGRpckZyYWNYID0gMSAvIGRpcmVjdGlvbi54OwogICAgICBjb25zdCBkaXJGcmFjWSA9IDEgLyBkaXJlY3Rpb24ueTsKICAgICAgY29uc3QgZGlyRnJhY1ogPSAxIC8gZGlyZWN0aW9uLno7IC8vIHRoaXMubG93ZXJCb3VuZCBpcyB0aGUgY29ybmVyIG9mIEFBQkIgd2l0aCBtaW5pbWFsIGNvb3JkaW5hdGVzIC0gbGVmdCBib3R0b20sIHJ0IGlzIG1heGltYWwgY29ybmVyCgogICAgICBjb25zdCB0MSA9ICh0aGlzLmxvd2VyQm91bmQueCAtIGZyb20ueCkgKiBkaXJGcmFjWDsKICAgICAgY29uc3QgdDIgPSAodGhpcy51cHBlckJvdW5kLnggLSBmcm9tLngpICogZGlyRnJhY1g7CiAgICAgIGNvbnN0IHQzID0gKHRoaXMubG93ZXJCb3VuZC55IC0gZnJvbS55KSAqIGRpckZyYWNZOwogICAgICBjb25zdCB0NCA9ICh0aGlzLnVwcGVyQm91bmQueSAtIGZyb20ueSkgKiBkaXJGcmFjWTsKICAgICAgY29uc3QgdDUgPSAodGhpcy5sb3dlckJvdW5kLnogLSBmcm9tLnopICogZGlyRnJhY1o7CiAgICAgIGNvbnN0IHQ2ID0gKHRoaXMudXBwZXJCb3VuZC56IC0gZnJvbS56KSAqIGRpckZyYWNaOyAvLyBjb25zdCB0bWluID0gTWF0aC5tYXgoTWF0aC5tYXgoTWF0aC5taW4odDEsIHQyKSwgTWF0aC5taW4odDMsIHQ0KSkpOwogICAgICAvLyBjb25zdCB0bWF4ID0gTWF0aC5taW4oTWF0aC5taW4oTWF0aC5tYXgodDEsIHQyKSwgTWF0aC5tYXgodDMsIHQ0KSkpOwoKICAgICAgY29uc3QgdG1pbiA9IE1hdGgubWF4KE1hdGgubWF4KE1hdGgubWluKHQxLCB0MiksIE1hdGgubWluKHQzLCB0NCkpLCBNYXRoLm1pbih0NSwgdDYpKTsKICAgICAgY29uc3QgdG1heCA9IE1hdGgubWluKE1hdGgubWluKE1hdGgubWF4KHQxLCB0MiksIE1hdGgubWF4KHQzLCB0NCkpLCBNYXRoLm1heCh0NSwgdDYpKTsgLy8gaWYgdG1heCA8IDAsIHJheSAobGluZSkgaXMgaW50ZXJzZWN0aW5nIEFBQkIsIGJ1dCB3aG9sZSBBQUJCIGlzIGJlaGluZyB1cwoKICAgICAgaWYgKHRtYXggPCAwKSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gaWYgdG1pbiA+IHRtYXgsIHJheSBkb2Vzbid0IGludGVyc2VjdCBBQUJCCgoKICAgICAgaWYgKHRtaW4gPiB0bWF4KSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICB9CiAgY29uc3QgdG1wJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBDb2xsaXNpb24gIm1hdHJpeCIuCiAgICogSXQncyBhY3R1YWxseSBhIHRyaWFuZ3VsYXItc2hhcGVkIGFycmF5IG9mIHdoZXRoZXIgdHdvIGJvZGllcyBhcmUgdG91Y2hpbmcgdGhpcyBzdGVwLCBmb3IgcmVmZXJlbmNlIG5leHQgc3RlcAogICAqLwogIGNsYXNzIEFycmF5Q29sbGlzaW9uTWF0cml4IHsKICAgIC8qKgogICAgICogVGhlIG1hdHJpeCBzdG9yYWdlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5tYXRyaXggPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBnZXQoYmksIGJqKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYW4gZWxlbWVudAogICAgICovCgoKICAgIHNldChiaSwgYmosIHZhbHVlKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICB0aGlzLm1hdHJpeFsoaSAqIChpICsgMSkgPj4gMSkgKyBqIC0gMV0gPSB2YWx1ZSA/IDEgOiAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBlbGVtZW50cyB0byB6ZXJvCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5tYXRyaXgubGVuZ3RoOyBpICE9PSBsOyBpKyspIHsKICAgICAgICB0aGlzLm1hdHJpeFtpXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF4IG51bWJlciBvZiBvYmplY3RzCiAgICAgKi8KCgogICAgc2V0TnVtT2JqZWN0cyhuKSB7CiAgICAgIHRoaXMubWF0cml4Lmxlbmd0aCA9IG4gKiAobiAtIDEpID4+IDE7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3Igb2JqZWN0cyB0aGF0IGRpc3BhdGNoZXMgZXZlbnRzLgogICAqLwogIGNsYXNzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQWRkIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwogICAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdID0gW107CiAgICAgIH0KCiAgICAgIGlmICghbGlzdGVuZXJzW3R5cGVdLmluY2x1ZGVzKGxpc3RlbmVyKSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGV2ZW50IGxpc3RlbmVyIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbdHlwZV0uaW5jbHVkZXMobGlzdGVuZXIpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW55IGV2ZW50IGxpc3RlbmVyIG9mIHRoZSBnaXZlbiB0eXBlIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzQW55RXZlbnRMaXN0ZW5lcih0eXBlKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwogICAgICByZXR1cm4gbGlzdGVuZXJzW3R5cGVdICE9PSB1bmRlZmluZWQ7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhbiBldmVudCBsaXN0ZW5lcgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZGV4ID0gbGlzdGVuZXJzW3R5cGVdLmluZGV4T2YobGlzdGVuZXIpOwoKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogRW1pdCBhbiBldmVudC4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKICAgICAgY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1tldmVudC50eXBlXTsKCiAgICAgIGlmIChsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBldmVudC50YXJnZXQgPSB0aGlzOwoKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBsaXN0ZW5lckFycmF5W2ldLmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBRdWF0ZXJuaW9uIGRlc2NyaWJlcyBhIHJvdGF0aW9uIGluIDNEIHNwYWNlLiBUaGUgUXVhdGVybmlvbiBpcyBtYXRoZW1hdGljYWxseSBkZWZpbmVkIGFzIFEgPSB4KmkgKyB5KmogKyB6KmsgKyB3LCB3aGVyZSAoaSxqLGspIGFyZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9ycy4gKHgseSx6KSBjYW4gYmUgc2VlbiBhcyBhIHZlY3RvciByZWxhdGVkIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uLCB3aGlsZSB0aGUgcmVhbCBtdWx0aXBsaWVyLCB3LCBpcyByZWxhdGVkIHRvIHRoZSBhbW91bnQgb2Ygcm90YXRpb24uCiAgICogQHBhcmFtIHggTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBpLgogICAqIEBwYXJhbSB5IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3Igai4KICAgKiBAcGFyYW0geiBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGsuCiAgICogQHBhcmFtIHcgTXVsdGlwbGllciBvZiB0aGUgcmVhbCBwYXJ0LgogICAqIEBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9RdWF0ZXJuaW9uCiAgICovCgogIGNsYXNzIFF1YXRlcm5pb24gewogICAgY29uc3RydWN0b3IoeCwgeSwgeiwgdykgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDA7CiAgICAgIH0KCiAgICAgIGlmICh5ID09PSB2b2lkIDApIHsKICAgICAgICB5ID0gMDsKICAgICAgfQoKICAgICAgaWYgKHogPT09IHZvaWQgMCkgewogICAgICAgIHogPSAwOwogICAgICB9CgogICAgICBpZiAodyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdyA9IDE7CiAgICAgIH0KCiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgdmFsdWUgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgc2V0KHgsIHksIHosIHcpIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgICAgdGhpcy53ID0gdzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdG8gYSByZWFkYWJsZSBmb3JtYXQKICAgICAqIEByZXR1cm4gIngseSx6LHciCiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen0sJHt0aGlzLnd9YDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhbiBBcnJheQogICAgICogQHJldHVybiBbeCwgeSwgeiwgd10KICAgICAqLwoKCiAgICB0b0FycmF5KCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMud107CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIGFuIGF4aXMgYW5kIGFuIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgc2V0RnJvbUF4aXNBbmdsZSh2ZWN0b3IsIGFuZ2xlKSB7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihhbmdsZSAqIDAuNSk7CiAgICAgIHRoaXMueCA9IHZlY3Rvci54ICogczsKICAgICAgdGhpcy55ID0gdmVjdG9yLnkgKiBzOwogICAgICB0aGlzLnogPSB2ZWN0b3IueiAqIHM7CiAgICAgIHRoaXMudyA9IE1hdGguY29zKGFuZ2xlICogMC41KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRoZSBxdWF0ZXJuaW9uIHRvIFsgYXhpcywgYW5nbGUgXSByZXByZXNlbnRhdGlvbi4KICAgICAqIEBwYXJhbSB0YXJnZXRBeGlzIEEgdmVjdG9yIG9iamVjdCB0byByZXVzZSBmb3Igc3RvcmluZyB0aGUgYXhpcy4KICAgICAqIEByZXR1cm4gQW4gYXJyYXksIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGF4aXMgYW5kIHRoZSBzZWNvbmQgaXMgdGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgdG9BeGlzQW5nbGUodGFyZ2V0QXhpcykgewogICAgICBpZiAodGFyZ2V0QXhpcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0QXhpcyA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMubm9ybWFsaXplKCk7IC8vIGlmIHc+MSBhY29zIGFuZCBzcXJ0IHdpbGwgcHJvZHVjZSBlcnJvcnMsIHRoaXMgY2FudCBoYXBwZW4gaWYgcXVhdGVybmlvbiBpcyBub3JtYWxpc2VkCgogICAgICBjb25zdCBhbmdsZSA9IDIgKiBNYXRoLmFjb3ModGhpcy53KTsKICAgICAgY29uc3QgcyA9IE1hdGguc3FydCgxIC0gdGhpcy53ICogdGhpcy53KTsgLy8gYXNzdW1pbmcgcXVhdGVybmlvbiBub3JtYWxpc2VkIHRoZW4gdyBpcyBsZXNzIHRoYW4gMSwgc28gdGVybSBhbHdheXMgcG9zaXRpdmUuCgogICAgICBpZiAocyA8IDAuMDAxKSB7CiAgICAgICAgLy8gdGVzdCB0byBhdm9pZCBkaXZpZGUgYnkgemVybywgcyBpcyBhbHdheXMgcG9zaXRpdmUgZHVlIHRvIHNxcnQKICAgICAgICAvLyBpZiBzIGNsb3NlIHRvIHplcm8gdGhlbiBkaXJlY3Rpb24gb2YgYXhpcyBub3QgaW1wb3J0YW50CiAgICAgICAgdGFyZ2V0QXhpcy54ID0gdGhpcy54OyAvLyBpZiBpdCBpcyBpbXBvcnRhbnQgdGhhdCBheGlzIGlzIG5vcm1hbGlzZWQgdGhlbiByZXBsYWNlIHdpdGggeD0xOyB5PXo9MDsKCiAgICAgICAgdGFyZ2V0QXhpcy55ID0gdGhpcy55OwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLnggLyBzOyAvLyBub3JtYWxpc2UgYXhpcwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnkgLyBzOwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMueiAvIHM7CiAgICAgIH0KCiAgICAgIHJldHVybiBbdGFyZ2V0QXhpcywgYW5nbGVdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHF1YXRlcm5pb24gdmFsdWUgZ2l2ZW4gdHdvIHZlY3RvcnMuIFRoZSByZXN1bHRpbmcgcm90YXRpb24gd2lsbCBiZSB0aGUgbmVlZGVkIHJvdGF0aW9uIHRvIHJvdGF0ZSB1IHRvIHYuCiAgICAgKi8KCgogICAgc2V0RnJvbVZlY3RvcnModSwgdikgewogICAgICBpZiAodS5pc0FudGlwYXJhbGxlbFRvKHYpKSB7CiAgICAgICAgY29uc3QgdDEgPSBzZnZfdDE7CiAgICAgICAgY29uc3QgdDIgPSBzZnZfdDI7CiAgICAgICAgdS50YW5nZW50cyh0MSwgdDIpOwogICAgICAgIHRoaXMuc2V0RnJvbUF4aXNBbmdsZSh0MSwgTWF0aC5QSSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYSA9IHUuY3Jvc3Modik7CiAgICAgICAgdGhpcy54ID0gYS54OwogICAgICAgIHRoaXMueSA9IGEueTsKICAgICAgICB0aGlzLnogPSBhLno7CiAgICAgICAgdGhpcy53ID0gTWF0aC5zcXJ0KHUubGVuZ3RoKCkgKiogMiAqIHYubGVuZ3RoKCkgKiogMikgKyB1LmRvdCh2KTsKICAgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgdGhlIHF1YXRlcm5pb24gd2l0aCBhbiBvdGhlciBxdWF0ZXJuaW9uLgogICAgICovCgoKICAgIG11bHQocXVhdCwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBjb25zdCBieCA9IHF1YXQueDsKICAgICAgY29uc3QgYnkgPSBxdWF0Lnk7CiAgICAgIGNvbnN0IGJ6ID0gcXVhdC56OwogICAgICBjb25zdCBidyA9IHF1YXQudzsKICAgICAgdGFyZ2V0LnggPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICB0YXJnZXQueSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYno7CiAgICAgIHRhcmdldC56ID0gYXogKiBidyArIGF3ICogYnogKyBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgdGFyZ2V0LncgPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGludmVyc2UgcXVhdGVybmlvbiByb3RhdGlvbi4KICAgICAqLwoKCiAgICBpbnZlcnNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCB3ID0gdGhpcy53OwogICAgICB0aGlzLmNvbmp1Z2F0ZSh0YXJnZXQpOwogICAgICBjb25zdCBpbm9ybTIgPSAxIC8gKHggKiB4ICsgeSAqIHkgKyB6ICogeiArIHcgKiB3KTsKICAgICAgdGFyZ2V0LnggKj0gaW5vcm0yOwogICAgICB0YXJnZXQueSAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC56ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LncgKj0gaW5vcm0yOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHF1YXRlcm5pb24gY29uanVnYXRlCiAgICAgKi8KCgogICAgY29uanVnYXRlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IC10aGlzLng7CiAgICAgIHRhcmdldC55ID0gLXRoaXMueTsKICAgICAgdGFyZ2V0LnogPSAtdGhpcy56OwogICAgICB0YXJnZXQudyA9IHRoaXMudzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSBxdWF0ZXJuaW9uLiBOb3RlIHRoYXQgdGhpcyBjaGFuZ2VzIHRoZSB2YWx1ZXMgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBsZXQgbCA9IE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpOwoKICAgICAgaWYgKGwgPT09IDApIHsKICAgICAgICB0aGlzLnggPSAwOwogICAgICAgIHRoaXMueSA9IDA7CiAgICAgICAgdGhpcy56ID0gMDsKICAgICAgICB0aGlzLncgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGwgPSAxIC8gbDsKICAgICAgICB0aGlzLnggKj0gbDsKICAgICAgICB0aGlzLnkgKj0gbDsKICAgICAgICB0aGlzLnogKj0gbDsKICAgICAgICB0aGlzLncgKj0gbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEFwcHJveGltYXRpb24gb2YgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uLiBXb3JrcyBiZXN0IHdoZW4gcXVhdCBpcyBhbHJlYWR5IGFsbW9zdC1ub3JtYWxpemVkLgogICAgICogQGF1dGhvciB1bnBoYXNlZCwgaHR0cHM6Ly9naXRodWIuY29tL3VucGhhc2VkCiAgICAgKi8KCgogICAgbm9ybWFsaXplRmFzdCgpIHsKICAgICAgY29uc3QgZiA9ICgzLjAgLSAodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53KSkgLyAyLjA7CgogICAgICBpZiAoZiA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy54ICo9IGY7CiAgICAgICAgdGhpcy55ICo9IGY7CiAgICAgICAgdGhpcy56ICo9IGY7CiAgICAgICAgdGhpcy53ICo9IGY7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiBieSBhIHZlY3RvcgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdi54OwogICAgICBjb25zdCB5ID0gdi55OwogICAgICBjb25zdCB6ID0gdi56OwogICAgICBjb25zdCBxeCA9IHRoaXMueDsKICAgICAgY29uc3QgcXkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHF6ID0gdGhpcy56OwogICAgICBjb25zdCBxdyA9IHRoaXMudzsgLy8gcSp2CgogICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CiAgICAgIGNvbnN0IGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgIHRhcmdldC54ID0gaXggKiBxdyArIGl3ICogLXF4ICsgaXkgKiAtcXogLSBpeiAqIC1xeTsKICAgICAgdGFyZ2V0LnkgPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6OwogICAgICB0YXJnZXQueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgICogQHJldHVybiB0aGlzCiAgICAgKi8KCgogICAgY29weShxdWF0KSB7CiAgICAgIHRoaXMueCA9IHF1YXQueDsKICAgICAgdGhpcy55ID0gcXVhdC55OwogICAgICB0aGlzLnogPSBxdWF0Lno7CiAgICAgIHRoaXMudyA9IHF1YXQudzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHF1YXRlcm5pb24gdG8gZXVsZXIgYW5nbGUgcmVwcmVzZW50YXRpb24uIE9yZGVyOiBZWlgsIGFzIHRoaXMgcGFnZSBkZXNjcmliZXM6IGh0dHBzOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9zdGFuZGFyZHMvaW5kZXguaHRtCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhyZWUtY2hhcmFjdGVyIHN0cmluZywgZGVmYXVsdHMgdG8gIllaWCIKICAgICAqLwoKCiAgICB0b0V1bGVyKHRhcmdldCwgb3JkZXIpIHsKICAgICAgaWYgKG9yZGVyID09PSB2b2lkIDApIHsKICAgICAgICBvcmRlciA9ICdZWlgnOwogICAgICB9CgogICAgICBsZXQgaGVhZGluZzsKICAgICAgbGV0IGF0dGl0dWRlOwogICAgICBsZXQgYmFuazsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKCiAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICBjYXNlICdZWlgnOgogICAgICAgICAgY29uc3QgdGVzdCA9IHggKiB5ICsgeiAqIHc7CgogICAgICAgICAgaWYgKHRlc3QgPiAwLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBub3J0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAyICogTWF0aC5hdGFuMih4LCB3KTsKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRlc3QgPCAtMC40OTkpIHsKICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgc291dGggcG9sZQogICAgICAgICAgICBoZWFkaW5nID0gLTIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhlYWRpbmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzcXggPSB4ICogeDsKICAgICAgICAgICAgY29uc3Qgc3F5ID0geSAqIHk7CiAgICAgICAgICAgIGNvbnN0IHNxeiA9IHogKiB6OwogICAgICAgICAgICBoZWFkaW5nID0gTWF0aC5hdGFuMigyICogeSAqIHcgLSAyICogeCAqIHosIDEgLSAyICogc3F5IC0gMiAqIHNxeik7IC8vIEhlYWRpbmcKCiAgICAgICAgICAgIGF0dGl0dWRlID0gTWF0aC5hc2luKDIgKiB0ZXN0KTsgLy8gYXR0aXR1ZGUKCiAgICAgICAgICAgIGJhbmsgPSBNYXRoLmF0YW4yKDIgKiB4ICogdyAtIDIgKiB5ICogeiwgMSAtIDIgKiBzcXggLSAyICogc3F6KTsgLy8gYmFuawogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFdWxlciBvcmRlciAke29yZGVyfSBub3Qgc3VwcG9ydGVkIHlldC5gKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnkgPSBoZWFkaW5nOwogICAgICB0YXJnZXQueiA9IGF0dGl0dWRlOwogICAgICB0YXJnZXQueCA9IGJhbms7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIEV1bGVyIGFuZ2xlIHJlcHJlc2VudGF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBvcmRlciBUaGUgb3JkZXIgdG8gYXBwbHkgYW5nbGVzOiAnWFlaJyBvciAnWVhaJyBvciBhbnkgb3RoZXIgY29tYmluYXRpb24uCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLzIwNjk2LWZ1bmN0aW9uLXRvLWNvbnZlcnQtYmV0d2Vlbi1kY20tZXVsZXItYW5nbGVzLXF1YXRlcm5pb25zLWFuZC1ldWxlci12ZWN0b3JzIE1hdGhXb3Jrc30gcmVmZXJlbmNlCiAgICAgKi8KCgogICAgc2V0RnJvbUV1bGVyKHgsIHksIHosIG9yZGVyKSB7CiAgICAgIGlmIChvcmRlciA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3JkZXIgPSAnWFlaJzsKICAgICAgfQoKICAgICAgY29uc3QgYzEgPSBNYXRoLmNvcyh4IC8gMik7CiAgICAgIGNvbnN0IGMyID0gTWF0aC5jb3MoeSAvIDIpOwogICAgICBjb25zdCBjMyA9IE1hdGguY29zKHogLyAyKTsKICAgICAgY29uc3QgczEgPSBNYXRoLnNpbih4IC8gMik7CiAgICAgIGNvbnN0IHMyID0gTWF0aC5zaW4oeSAvIDIpOwogICAgICBjb25zdCBzMyA9IE1hdGguc2luKHogLyAyKTsKCiAgICAgIGlmIChvcmRlciA9PT0gJ1hZWicpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWFonKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWlhZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1pZWCcpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWlgnKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWFpZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgUXVhdGVybmlvbih0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncpOwogICAgfQogICAgLyoqCiAgICAgKiBQZXJmb3JtcyBhIHNwaGVyaWNhbCBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byBxdWF0CiAgICAgKgogICAgICogQHBhcmFtIHRvUXVhdCBzZWNvbmQgb3BlcmFuZAogICAgICogQHBhcmFtIHQgaW50ZXJwb2xhdGlvbiBhbW91bnQgYmV0d2VlbiB0aGUgc2VsZiBxdWF0ZXJuaW9uIGFuZCB0b1F1YXQKICAgICAqIEBwYXJhbSB0YXJnZXQgQSBxdWF0ZXJuaW9uIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uIElmIG5vdCBwcm92aWRlZCwgYSBuZXcgb25lIHdpbGwgYmUgY3JlYXRlZC4KICAgICAqIEByZXR1cm5zIHtRdWF0ZXJuaW9ufSBUaGUgInRhcmdldCIgb2JqZWN0CiAgICAgKi8KCgogICAgc2xlcnAodG9RdWF0LCB0LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGxldCBieCA9IHRvUXVhdC54OwogICAgICBsZXQgYnkgPSB0b1F1YXQueTsKICAgICAgbGV0IGJ6ID0gdG9RdWF0Lno7CiAgICAgIGxldCBidyA9IHRvUXVhdC53OwogICAgICBsZXQgb21lZ2E7CiAgICAgIGxldCBjb3NvbTsKICAgICAgbGV0IHNpbm9tOwogICAgICBsZXQgc2NhbGUwOwogICAgICBsZXQgc2NhbGUxOyAvLyBjYWxjIGNvc2luZQoKICAgICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3OyAvLyBhZGp1c3Qgc2lnbnMgKGlmIG5lY2Vzc2FyeSkKCiAgICAgIGlmIChjb3NvbSA8IDAuMCkgewogICAgICAgIGNvc29tID0gLWNvc29tOwogICAgICAgIGJ4ID0gLWJ4OwogICAgICAgIGJ5ID0gLWJ5OwogICAgICAgIGJ6ID0gLWJ6OwogICAgICAgIGJ3ID0gLWJ3OwogICAgICB9IC8vIGNhbGN1bGF0ZSBjb2VmZmljaWVudHMKCgogICAgICBpZiAoMS4wIC0gY29zb20gPiAwLjAwMDAwMSkgewogICAgICAgIC8vIHN0YW5kYXJkIGNhc2UgKHNsZXJwKQogICAgICAgIG9tZWdhID0gTWF0aC5hY29zKGNvc29tKTsKICAgICAgICBzaW5vbSA9IE1hdGguc2luKG9tZWdhKTsKICAgICAgICBzY2FsZTAgPSBNYXRoLnNpbigoMS4wIC0gdCkgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgICBzY2FsZTEgPSBNYXRoLnNpbih0ICogb21lZ2EpIC8gc2lub207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIHF1YXRlcm5pb25zIGFyZSB2ZXJ5IGNsb3NlCiAgICAgICAgLy8gIC4uLiBzbyB3ZSBjYW4gZG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbgogICAgICAgIHNjYWxlMCA9IDEuMCAtIHQ7CiAgICAgICAgc2NhbGUxID0gdDsKICAgICAgfSAvLyBjYWxjdWxhdGUgZmluYWwgdmFsdWVzCgoKICAgICAgdGFyZ2V0LnggPSBzY2FsZTAgKiBheCArIHNjYWxlMSAqIGJ4OwogICAgICB0YXJnZXQueSA9IHNjYWxlMCAqIGF5ICsgc2NhbGUxICogYnk7CiAgICAgIHRhcmdldC56ID0gc2NhbGUwICogYXogKyBzY2FsZTEgKiBiejsKICAgICAgdGFyZ2V0LncgPSBzY2FsZTAgKiBhdyArIHNjYWxlMSAqIGJ3OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBSb3RhdGUgYW4gYWJzb2x1dGUgb3JpZW50YXRpb24gcXVhdGVybmlvbiBnaXZlbiBhbiBhbmd1bGFyIHZlbG9jaXR5IGFuZCBhIHRpbWUgc3RlcC4KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoYW5ndWxhclZlbG9jaXR5LCBkdCwgYW5ndWxhckZhY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gYW5ndWxhclZlbG9jaXR5LnggKiBhbmd1bGFyRmFjdG9yLngsCiAgICAgICAgICAgIGF5ID0gYW5ndWxhclZlbG9jaXR5LnkgKiBhbmd1bGFyRmFjdG9yLnksCiAgICAgICAgICAgIGF6ID0gYW5ndWxhclZlbG9jaXR5LnogKiBhbmd1bGFyRmFjdG9yLnosCiAgICAgICAgICAgIGJ4ID0gdGhpcy54LAogICAgICAgICAgICBieSA9IHRoaXMueSwKICAgICAgICAgICAgYnogPSB0aGlzLnosCiAgICAgICAgICAgIGJ3ID0gdGhpcy53OwogICAgICBjb25zdCBoYWxmX2R0ID0gZHQgKiAwLjU7CiAgICAgIHRhcmdldC54ICs9IGhhbGZfZHQgKiAoYXggKiBidyArIGF5ICogYnogLSBheiAqIGJ5KTsKICAgICAgdGFyZ2V0LnkgKz0gaGFsZl9kdCAqIChheSAqIGJ3ICsgYXogKiBieCAtIGF4ICogYnopOwogICAgICB0YXJnZXQueiArPSBoYWxmX2R0ICogKGF6ICogYncgKyBheCAqIGJ5IC0gYXkgKiBieCk7CiAgICAgIHRhcmdldC53ICs9IGhhbGZfZHQgKiAoLWF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBieik7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogIH0KICBjb25zdCBzZnZfdDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNmdl90MiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIFRoZSBhdmFpbGFibGUgc2hhcGUgdHlwZXMuCiAgICovCiAgY29uc3QgU0hBUEVfVFlQRVMgPSB7CiAgICAvKiogU1BIRVJFICovCiAgICBTUEhFUkU6IDEsCgogICAgLyoqIFBMQU5FICovCiAgICBQTEFORTogMiwKCiAgICAvKiogQk9YICovCiAgICBCT1g6IDQsCgogICAgLyoqIENPTVBPVU5EICovCiAgICBDT01QT1VORDogOCwKCiAgICAvKiogQ09OVkVYUE9MWUhFRFJPTiAqLwogICAgQ09OVkVYUE9MWUhFRFJPTjogMTYsCgogICAgLyoqIEhFSUdIVEZJRUxEICovCiAgICBIRUlHSFRGSUVMRDogMzIsCgogICAgLyoqIFBBUlRJQ0xFICovCiAgICBQQVJUSUNMRTogNjQsCgogICAgLyoqIENZTElOREVSICovCiAgICBDWUxJTkRFUjogMTI4LAoKICAgIC8qKiBUUklNRVNIICovCiAgICBUUklNRVNIOiAyNTYKICB9OwogIC8qKgogICAqIFNoYXBlVHlwZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBzaGFwZXMKICAgKi8KICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IFNoYXBlLmlkQ291bnRlcisrOwogICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgPyBvcHRpb25zLm1hdGVyaWFsIDogbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSByYWRpdXMuCiAgICAgKiBUaGUgcmVzdWx0IGlzIHN0b3JlZCBpbiB0aGUgcHJvcGVydHkgYC5ib3VuZGluZ1NwaGVyZVJhZGl1c2AKICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhyb3cgYGNvbXB1dGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZvbHVtZSBvZiB0aGlzIHNoYXBlCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICB0aHJvdyBgdm9sdW1lKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgdGhlIGluZXJ0aWEgaW4gdGhlIGxvY2FsIGZyYW1lIGZvciB0aGlzIHNoYXBlLgogICAgICogQHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbW9tZW50c19vZl9pbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICB0aHJvdyBgY2FsY3VsYXRlTG9jYWxJbmVydGlhKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdCBmb3IgdGhlc2Uga2luZCBvZiBtZXRob2RzCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgdGhyb3cgYGNhbGN1bGF0ZVdvcmxkQUFCQigpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQoKICB9CiAgU2hhcGUuaWRDb3VudGVyID0gMDsKICBTaGFwZS50eXBlcyA9IFNIQVBFX1RZUEVTOwoKICAvKioKICAgKiBUcmFuc2Zvcm1hdGlvbiB1dGlsaXRpZXMuCiAgICovCiAgY2xhc3MgVHJhbnNmb3JtIHsKICAgIC8qKgogICAgICogcG9zaXRpb24KICAgICAqLwoKICAgIC8qKgogICAgICogcXVhdGVybmlvbgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGdsb2JhbCBwb2ludCBpbiBsb2NhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgd29ybGRQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgbG9jYWwgcG9pbnQgaW4gZ2xvYmFsIHRyYW5zZm9ybSBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGQobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIHJldHVybiBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCBsb2NhbFBvaW50LCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHBvaW50VG9Mb2NhbEZyYW1lCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQocG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb1dvcmxkRnJhbWUocXVhdGVybmlvbiwgbG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CiAgY29uc3QgdG1wUXVhdCQxID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwogIGNsYXNzIENvbnZleFBvbHloZWRyb24gZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogdmVydGljZXMgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggZmFjZSBjb25zaXN0cyBvZgogICAgICovCgogICAgLyoqIGZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkVmVydGljZXMgKi8KCiAgICAvKiogd29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHMgKi8KCiAgICAvKiogd29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlICovCgogICAgLyoqCiAgICAgKiBJZiBnaXZlbiwgdGhlc2UgbG9jYWxseSBkZWZpbmVkLCBub3JtYWxpemVkIGF4ZXMgYXJlIHRoZSBvbmx5IG9uZXMgYmVpbmcgY2hlY2tlZCB3aGVuIGRvaW5nIHNlcGFyYXRpbmcgYXhpcyBjaGVjay4KICAgICAqLwoKICAgIC8qKiB1bmlxdWVFZGdlcyAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHZlcnRpY2VzIEFuIGFycmF5IG9mIFZlYzMncwogICAgICogQHBhcmFtIGZhY2VzIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBkZXNjcmliaW5nIHdoaWNoIHZlcnRpY2VzIHRoYXQgaXMgaW5jbHVkZWQgaW4gZWFjaCBmYWNlLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihwcm9wcykgewogICAgICBpZiAocHJvcHMgPT09IHZvaWQgMCkgewogICAgICAgIHByb3BzID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IHsKICAgICAgICB2ZXJ0aWNlcyA9IFtdLAogICAgICAgIGZhY2VzID0gW10sCiAgICAgICAgbm9ybWFscyA9IFtdLAogICAgICAgIGF4ZXMsCiAgICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMKICAgICAgfSA9IHByb3BzOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTgogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZlcnRleCAke3RoaXMuZmFjZXNbaV1bal19IG5vdCBmb3VuZCFgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ldIHx8IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5nZXRGYWNlTm9ybWFsKGksIG4pOwogICAgICAgIG4ubmVnYXRlKG4pOwogICAgICAgIHRoaXMuZmFjZU5vcm1hbHNbaV0gPSBuOwogICAgICAgIGNvbnN0IHZlcnRleCA9IHRoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVswXV07CgogICAgICAgIGlmIChuLmRvdCh2ZXJ0ZXgpIDwgMCkgewogICAgICAgICAgY29uc29sZS5lcnJvcihgLmZhY2VOb3JtYWxzWyR7aX1dID0gVmVjMygke24udG9TdHJpbmcoKX0pIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuYCk7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybihgLnZlcnRpY2VzWyR7dGhpcy5mYWNlc1tpXVtqXX1dID0gVmVjMygke3RoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVtqXV0udG9TdHJpbmcoKX0pYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiBhIGZhY2UgZnJvbSBpdHMgdmVydGljZXMKICAgICAqLwoKCiAgICBnZXRGYWNlTm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tpXTsKICAgICAgY29uc3QgdmEgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCB2YiA9IHRoaXMudmVydGljZXNbZlsxXV07CiAgICAgIGNvbnN0IHZjID0gdGhpcy52ZXJ0aWNlc1tmWzJdXTsKICAgICAgQ29udmV4UG9seWhlZHJvbi5jb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWIgPSBuZXcgVmVjMygpOwogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAcGFyYW0gbWluRGlzdCBDbGFtcCBkaXN0YW5jZQogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgYW4gYXJyYXkgb2YgY29udGFjdCBwb2ludCBvYmplY3RzLCBzZWUgY2xpcEZhY2VBZ2FpbnN0SHVsbAogICAgICovCgoKICAgIGNsaXBBZ2FpbnN0SHVsbChwb3NBLCBxdWF0QSwgaHVsbEIsIHBvc0IsIHF1YXRCLCBzZXBhcmF0aW5nTm9ybWFsLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgV29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBsZXQgY2xvc2VzdEZhY2VCID0gLTE7CiAgICAgIGxldCBkbWF4ID0gLU51bWJlci5NQVhfVkFMVUU7CgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxCLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgV29ybGROb3JtYWwuY29weShodWxsQi5mYWNlTm9ybWFsc1tmYWNlXSk7CiAgICAgICAgcXVhdEIudm11bHQoV29ybGROb3JtYWwsIFdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCBkID0gV29ybGROb3JtYWwuZG90KHNlcGFyYXRpbmdOb3JtYWwpOwoKICAgICAgICBpZiAoZCA+IGRtYXgpIHsKICAgICAgICAgIGRtYXggPSBkOwogICAgICAgICAgY2xvc2VzdEZhY2VCID0gZmFjZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkVmVydHNCMSA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGh1bGxCLnZlcnRpY2VzW2h1bGxCLmZhY2VzW2Nsb3Nlc3RGYWNlQl1baV1dOwogICAgICAgIGNvbnN0IHdvcmxkYiA9IG5ldyBWZWMzKCk7CiAgICAgICAgd29ybGRiLmNvcHkoYik7CiAgICAgICAgcXVhdEIudm11bHQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHBvc0IudmFkZCh3b3JsZGIsIHdvcmxkYik7CiAgICAgICAgd29ybGRWZXJ0c0IxLnB1c2god29ybGRiKTsKICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQiA+PSAwKSB7CiAgICAgICAgdGhpcy5jbGlwRmFjZUFnYWluc3RIdWxsKHNlcGFyYXRpbmdOb3JtYWwsIHBvc0EsIHF1YXRBLCB3b3JsZFZlcnRzQjEsIG1pbkRpc3QsIG1heERpc3QsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRmluZCB0aGUgc2VwYXJhdGluZyBheGlzIGJldHdlZW4gdGhpcyBodWxsIGFuZCBhbm90aGVyCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdmVjdG9yIHRvIHNhdmUgdGhlIGF4aXMgaW4KICAgICAqIEByZXR1cm4gUmV0dXJucyBmYWxzZSBpZiBhIHNlcGFyYXRpb24gaXMgZm91bmQsIGVsc2UgdHJ1ZQogICAgICovCgoKICAgIGZpbmRTZXBhcmF0aW5nQXhpcyhodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCLCB0YXJnZXQsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MzID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRub3JtYWwxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGVsdGFDID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBDcm9zcyA9IG5ldyBWZWMzKCk7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwoKICAgICAgaWYgKCFodWxsQS51bmlxdWVBeGVzKSB7CiAgICAgICAgY29uc3QgbnVtRmFjZXNBID0gZmFjZUxpc3RBID8gZmFjZUxpc3RBLmxlbmd0aCA6IGh1bGxBLmZhY2VzLmxlbmd0aDsgLy8gVGVzdCBmYWNlIG5vcm1hbHMgZnJvbSBodWxsQQoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QVtpXSA6IGk7IC8vIEdldCB3b3JsZCBmYWNlIG5vcm1hbAoKICAgICAgICAgIGZhY2VBTm9ybWFsV1MzLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MzLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEEudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGF4aXMKICAgICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUF4ZXNbaV0sIGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhmYWNlQU5vcm1hbFdTMywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghaHVsbEIudW5pcXVlQXhlcykgewogICAgICAgIC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEIKICAgICAgICBjb25zdCBudW1GYWNlc0IgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEIubGVuZ3RoIDogaHVsbEIuZmFjZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QiA/IGZhY2VMaXN0QltpXSA6IGk7CiAgICAgICAgICBXb3JsZG5vcm1hbDEuY29weShodWxsQi5mYWNlTm9ybWFsc1tmaV0pOwogICAgICAgICAgcXVhdEIudm11bHQoV29ybGRub3JtYWwxLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMgaW4gQgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBodWxsQi51bmlxdWVBeGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBxdWF0Qi52bXVsdChodWxsQi51bmlxdWVBeGVzW2ldLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRlc3QgZWRnZXMKCgogICAgICBmb3IgKGxldCBlMCA9IDA7IGUwICE9PSBodWxsQS51bmlxdWVFZGdlcy5sZW5ndGg7IGUwKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgZWRnZQogICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUVkZ2VzW2UwXSwgd29ybGRFZGdlMCk7CgogICAgICAgIGZvciAobGV0IGUxID0gMDsgZTEgIT09IGh1bGxCLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgZTErKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UgMgogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlRWRnZXNbZTFdLCB3b3JsZEVkZ2UxKTsKICAgICAgICAgIHdvcmxkRWRnZTAuY3Jvc3Mod29ybGRFZGdlMSwgQ3Jvc3MpOwoKICAgICAgICAgIGlmICghQ3Jvc3MuYWxtb3N0WmVybygpKSB7CiAgICAgICAgICAgIENyb3NzLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBjb25zdCBkaXN0ID0gaHVsbEEudGVzdFNlcEF4aXMoQ3Jvc3MsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgICAgaWYgKGRpc3QgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGlzdCA8IGRtaW4pIHsKICAgICAgICAgICAgICBkbWluID0gZGlzdDsKICAgICAgICAgICAgICB0YXJnZXQuY29weShDcm9zcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHBvc0IudnN1Yihwb3NBLCBkZWx0YUMpOwoKICAgICAgaWYgKGRlbHRhQy5kb3QodGFyZ2V0KSA+IDAuMCkgewogICAgICAgIHRhcmdldC5uZWdhdGUodGFyZ2V0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFRlc3Qgc2VwYXJhdGluZyBheGlzIGFnYWluc3QgdHdvIGh1bGxzLiBCb3RoIGh1bGxzIGFyZSBwcm9qZWN0ZWQgb250byB0aGUgYXhpcyBhbmQgdGhlIG92ZXJsYXAgc2l6ZSBpcyByZXR1cm5lZCBpZiB0aGVyZSBpcyBvbmUuCiAgICAgKiBAcmV0dXJuIFRoZSBvdmVybGFwIGRlcHRoLCBvciBGQUxTRSBpZiBubyBwZW5ldHJhdGlvbi4KICAgICAqLwoKCiAgICB0ZXN0U2VwQXhpcyhheGlzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKSB7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgQ29udmV4UG9seWhlZHJvbi5wcm9qZWN0KGh1bGxBLCBheGlzLCBwb3NBLCBxdWF0QSwgbWF4bWluQSk7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQiwgYXhpcywgcG9zQiwgcXVhdEIsIG1heG1pbkIpOwogICAgICBjb25zdCBtYXhBID0gbWF4bWluQVswXTsKICAgICAgY29uc3QgbWluQSA9IG1heG1pbkFbMV07CiAgICAgIGNvbnN0IG1heEIgPSBtYXhtaW5CWzBdOwogICAgICBjb25zdCBtaW5CID0gbWF4bWluQlsxXTsKCiAgICAgIGlmIChtYXhBIDwgbWluQiB8fCBtYXhCIDwgbWluQSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gU2VwYXJhdGVkCiAgICAgIH0KCiAgICAgIGNvbnN0IGQwID0gbWF4QSAtIG1pbkI7CiAgICAgIGNvbnN0IGQxID0gbWF4QiAtIG1pbkE7CiAgICAgIGNvbnN0IGRlcHRoID0gZDAgPCBkMSA/IGQwIDogZDE7CiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICBjb25zdCBhYWJibWF4ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWFiYm1pbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29tcHV0ZUxvY2FsQUFCQihhYWJibWluLCBhYWJibWF4KTsKICAgICAgY29uc3QgeCA9IGFhYmJtYXgueCAtIGFhYmJtaW4ueDsKICAgICAgY29uc3QgeSA9IGFhYmJtYXgueSAtIGFhYmJtaW4ueTsKICAgICAgY29uc3QgeiA9IGFhYmJtYXgueiAtIGFhYmJtaW4uejsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHggKiAyICogeCArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueiA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KTsKICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIGZhY2VfaSBJbmRleCBvZiB0aGUgZmFjZQogICAgICovCgoKICAgIGdldFBsYW5lQ29uc3RhbnRPZkZhY2UoZmFjZV9pKSB7CiAgICAgIGNvbnN0IGYgPSB0aGlzLmZhY2VzW2ZhY2VfaV07CiAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ZhY2VfaV07CiAgICAgIGNvbnN0IHYgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCBjID0gLW4uZG90KHYpOwogICAgICByZXR1cm4gYzsKICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgYWdhaW5zdCBhIGh1bGwuCiAgICAgKiBAcGFyYW0gd29ybGRWZXJ0c0IxIEFuIGFycmF5IG9mIFZlYzMgd2l0aCB2ZXJ0aWNlcyBpbiB0aGUgd29ybGQgZnJhbWUuCiAgICAgKiBAcGFyYW0gbWluRGlzdCBEaXN0YW5jZSBjbGFtcGluZwogICAgICogQHBhcmFtIEFycmF5IHJlc3VsdCBBcnJheSB0byBzdG9yZSByZXN1bHRpbmcgY29udGFjdCBwb2ludHMgaW4uIFdpbGwgYmUgb2JqZWN0cyB3aXRoIHByb3BlcnRpZXM6IHBvaW50LCBkZXB0aCwgbm9ybWFsLiBUaGVzZSBhcmUgcmVwcmVzZW50ZWQgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgZmFjZUFOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGVkZ2UwID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkUGxhbmVBbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBsYW5lTm9ybWFsV1MxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRBMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVOb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwogICAgICBjb25zdCB3b3JsZFZlcnRzQjIgPSBbXTsKICAgICAgY29uc3QgcFZ0eEluID0gd29ybGRWZXJ0c0IxOwogICAgICBjb25zdCBwVnR4T3V0ID0gd29ybGRWZXJ0c0IyOwogICAgICBsZXQgY2xvc2VzdEZhY2VBID0gLTE7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsgLy8gRmluZCB0aGUgZmFjZSB3aXRoIG5vcm1hbCBjbG9zZXN0IHRvIHRoZSBzZXBhcmF0aW5nIGF4aXMKCiAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgaHVsbEEuZmFjZXMubGVuZ3RoOyBmYWNlKyspIHsKICAgICAgICBmYWNlQU5vcm1hbFdTLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MsIGZhY2VBTm9ybWFsV1MpOwogICAgICAgIGNvbnN0IGQgPSBmYWNlQU5vcm1hbFdTLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQSA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoY2xvc2VzdEZhY2VBIDwgMCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBHZXQgdGhlIGZhY2UgYW5kIGNvbnN0cnVjdCBjb25uZWN0ZWQgZmFjZXMKCgogICAgICBjb25zdCBwb2x5QSA9IGh1bGxBLmZhY2VzW2Nsb3Nlc3RGYWNlQV07CiAgICAgIHBvbHlBLmNvbm5lY3RlZEZhY2VzID0gW107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBodWxsQS5mYWNlc1tpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKAogICAgICAgICAgLyogU2hhcmluZyBhIHZlcnRleCovCiAgICAgICAgICBwb2x5QS5pbmRleE9mKGh1bGxBLmZhY2VzW2ldW2pdKSAhPT0gLTEgJiYKICAgICAgICAgIC8qIE5vdCB0aGUgb25lIHdlIGFyZSBsb29raW5nIGZvciBjb25uZWN0aW9ucyBmcm9tICovCiAgICAgICAgICBpICE9PSBjbG9zZXN0RmFjZUEgJiYKICAgICAgICAgIC8qIE5vdCBhbHJlYWR5IGFkZGVkICovCiAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5pbmRleE9mKGkpID09PSAtMSkgewogICAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5wdXNoKGkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDbGlwIHRoZSBwb2x5Z29uIHRvIHRoZSBiYWNrIG9mIHRoZSBwbGFuZXMgb2YgYWxsIGZhY2VzIG9mIGh1bGwgQSwKICAgICAgLy8gdGhhdCBhcmUgYWRqYWNlbnQgdG8gdGhlIHdpdG5lc3MgZmFjZQoKCiAgICAgIGNvbnN0IG51bVZlcnRpY2VzQSA9IHBvbHlBLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVmVydGljZXNBOyBpKyspIHsKICAgICAgICBjb25zdCBhID0gaHVsbEEudmVydGljZXNbcG9seUFbaV1dOwogICAgICAgIGNvbnN0IGIgPSBodWxsQS52ZXJ0aWNlc1twb2x5QVsoaSArIDEpICUgbnVtVmVydGljZXNBXV07CiAgICAgICAgYS52c3ViKGIsIGVkZ2UwKTsKICAgICAgICBXb3JsZEVkZ2UwLmNvcHkoZWRnZTApOwogICAgICAgIHF1YXRBLnZtdWx0KFdvcmxkRWRnZTAsIFdvcmxkRWRnZTApOwogICAgICAgIHBvc0EudmFkZChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICB3b3JsZFBsYW5lQW5vcm1hbDEuY29weSh0aGlzLmZhY2VOb3JtYWxzW2Nsb3Nlc3RGYWNlQV0pOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBwb3NBLnZhZGQod29ybGRQbGFuZUFub3JtYWwxLCB3b3JsZFBsYW5lQW5vcm1hbDEpOwogICAgICAgIFdvcmxkRWRnZTAuY3Jvc3Mod29ybGRQbGFuZUFub3JtYWwxLCBwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgcGxhbmVOb3JtYWxXUzEubmVnYXRlKHBsYW5lTm9ybWFsV1MxKTsKICAgICAgICB3b3JsZEExLmNvcHkoYSk7CiAgICAgICAgcXVhdEEudm11bHQod29ybGRBMSwgd29ybGRBMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIGNvbnN0IG90aGVyRmFjZSA9IHBvbHlBLmNvbm5lY3RlZEZhY2VzW2ldOwogICAgICAgIGxvY2FsUGxhbmVOb3JtYWwuY29weSh0aGlzLmZhY2VOb3JtYWxzW290aGVyRmFjZV0pOwogICAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShvdGhlckZhY2UpOwogICAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgICBxdWF0QS52bXVsdChwbGFuZU5vcm1hbFdTLCBwbGFuZU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsgLy8gQ2xpcCBmYWNlIGFnYWluc3Qgb3VyIGNvbnN0cnVjdGVkIHBsYW5lCgogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0UGxhbmUocFZ0eEluLCBwVnR4T3V0LCBwbGFuZU5vcm1hbFdTLCBwbGFuZUVxV1MpOyAvLyBUaHJvdyBhd2F5IGFsbCBjbGlwcGVkIHBvaW50cywgYnV0IHNhdmUgdGhlIHJlbWFpbmluZyB1bnRpbCBuZXh0IGNsaXAKCiAgICAgICAgd2hpbGUgKHBWdHhJbi5sZW5ndGgpIHsKICAgICAgICAgIHBWdHhJbi5zaGlmdCgpOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKHBWdHhPdXQubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4ucHVzaChwVnR4T3V0LnNoaWZ0KCkpOwogICAgICAgIH0KICAgICAgfSAvLyBvbmx5IGtlZXAgY29udGFjdCBwb2ludHMgdGhhdCBhcmUgYmVoaW5kIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgY29uc3QgbG9jYWxQbGFuZUVxID0gdGhpcy5nZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGNsb3Nlc3RGYWNlQSk7CiAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgIGNvbnN0IHBsYW5lRXFXUyA9IGxvY2FsUGxhbmVFcSAtIHBsYW5lTm9ybWFsV1MuZG90KHBvc0EpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwVnR4SW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgZGVwdGggPSBwbGFuZU5vcm1hbFdTLmRvdChwVnR4SW5baV0pICsgcGxhbmVFcVdTOyAvLyA/Pz8KCiAgICAgICAgaWYgKGRlcHRoIDw9IG1pbkRpc3QpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBjbGFtcGVkOiBkZXB0aD0ke2RlcHRofSB0byBtaW5EaXN0PSR7bWluRGlzdH1gKTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0YXJnZXQudmFkZCh2ZXJ0c1tpXSwgdGFyZ2V0KTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNjYWxlKDEgLyB2ZXJ0cy5sZW5ndGgsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBhbGwgbG9jYWwgcG9pbnRzLiBXaWxsIGNoYW5nZSB0aGUgLnZlcnRpY2VzCiAgICAgKi8KCgogICAgdHJhbnNmb3JtQWxsUG9pbnRzKG9mZnNldCwgcXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsgLy8gQXBwbHkgcm90YXRpb24KCiAgICAgIGlmIChxdWF0KSB7CiAgICAgICAgLy8gUm90YXRlIHZlcnRpY2VzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfSAvLyBSb3RhdGUgZmFjZSBub3JtYWxzCgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmZhY2VOb3JtYWxzW2ldOwogICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAgICAgICAgICAvLyBSb3RhdGUgZWRnZXMKICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMudW5pcXVlRWRnZXNbaV07CiAgICAgICAgICAgICAgICAgIHF1YXQudm11bHQodix2KTsKICAgICAgICAgICAgICB9Ki8KCiAgICAgIH0gLy8gQXBwbHkgb2Zmc2V0CgoKICAgICAgaWYgKG9mZnNldCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICB2LnZhZGQob2Zmc2V0LCB2KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgcCBpcyBpbnNpZGUgdGhlIHBvbHloZWRyYS4gTXVzdCBiZSBpbiBsb2NhbCBjb29yZHMuCiAgICAgKiBUaGUgcG9pbnQgbGllcyBvdXRzaWRlIG9mIHRoZSBjb252ZXggaHVsbCBvZiB0aGUgb3RoZXIgcG9pbnRzIGlmIGFuZCBvbmx5IGlmIHRoZSBkaXJlY3Rpb24KICAgICAqIG9mIGFsbCB0aGUgdmVjdG9ycyBmcm9tIGl0IHRvIHRob3NlIG90aGVyIHBvaW50cyBhcmUgb24gbGVzcyB0aGFuIG9uZSBoYWxmIG9mIGEgc3BoZXJlIGFyb3VuZCBpdC4KICAgICAqIEBwYXJhbSBwIEEgcG9pbnQgZ2l2ZW4gaW4gbG9jYWwgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBwb2ludElzSW5zaWRlKHApIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCBmYWNlcyA9IHRoaXMuZmFjZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSB0aGlzLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBwb2ludEluc2lkZSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuZ2V0QXZlcmFnZVBvaW50TG9jYWwocG9pbnRJbnNpZGUpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IG4gPSBub3JtYWxzW2ldOwogICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tmYWNlc1tpXVswXV07IC8vIFdlIG9ubHkgbmVlZCBvbmUgcG9pbnQgaW4gdGhlIGZhY2UKICAgICAgICAvLyBUaGlzIGRvdCBwcm9kdWN0IGRldGVybWluZXMgd2hpY2ggc2lkZSBvZiB0aGUgZWRnZSB0aGUgcG9pbnQgaXMKCiAgICAgICAgY29uc3QgdlRvUCA9IG5ldyBWZWMzKCk7CiAgICAgICAgcC52c3ViKHYsIHZUb1ApOwogICAgICAgIGNvbnN0IHIxID0gbi5kb3QodlRvUCk7CiAgICAgICAgY29uc3QgdlRvUG9pbnRJbnNpZGUgPSBuZXcgVmVjMygpOwogICAgICAgIHBvaW50SW5zaWRlLnZzdWIodiwgdlRvUG9pbnRJbnNpZGUpOwogICAgICAgIGNvbnN0IHIyID0gbi5kb3QodlRvUG9pbnRJbnNpZGUpOwoKICAgICAgICBpZiAocjEgPCAwICYmIHIyID4gMCB8fCByMSA+IDAgJiYgcjIgPCAwKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEVuY291bnRlcmVkIHNvbWUgb3RoZXIgc2lnbi4gRXhpdC4KICAgICAgICB9CiAgICAgIH0gLy8gSWYgd2UgZ290IGhlcmUsIGFsbCBkb3QgcHJvZHVjdHMgd2VyZSBvZiB0aGUgc2FtZSBzaWduLgoKCiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IG1heCBhbmQgbWluIGRvdCBwcm9kdWN0IG9mIGEgY29udmV4IGh1bGwgYXQgcG9zaXRpb24gKHBvcyxxdWF0KSBwcm9qZWN0ZWQgb250byBhbiBheGlzLgogICAgICogUmVzdWx0cyBhcmUgc2F2ZWQgaW4gdGhlIGFycmF5IG1heG1pbi4KICAgICAqIEBwYXJhbSByZXN1bHQgcmVzdWx0WzBdIGFuZCByZXN1bHRbMV0gd2lsbCBiZSBzZXQgdG8gbWF4aW11bSBhbmQgbWluaW11bSwgcmVzcGVjdGl2ZWx5LgogICAgICovCgoKICAgIHN0YXRpYyBwcm9qZWN0KHNoYXBlLCBheGlzLCBwb3MsIHF1YXQsIHJlc3VsdCkgewogICAgICBjb25zdCBuID0gc2hhcGUudmVydGljZXMubGVuZ3RoOwogICAgICBjb25zdCBsb2NhbEF4aXMgPSBwcm9qZWN0X2xvY2FsQXhpczsKICAgICAgbGV0IG1heCA9IDA7CiAgICAgIGxldCBtaW4gPSAwOwogICAgICBjb25zdCBsb2NhbE9yaWdpbiA9IHByb2plY3RfbG9jYWxPcmlnaW47CiAgICAgIGNvbnN0IHZzID0gc2hhcGUudmVydGljZXM7CiAgICAgIGxvY2FsT3JpZ2luLnNldFplcm8oKTsgLy8gVHJhbnNmb3JtIHRoZSBheGlzIHRvIGxvY2FsCgogICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Mb2NhbEZyYW1lKHBvcywgcXVhdCwgYXhpcywgbG9jYWxBeGlzKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvcywgcXVhdCwgbG9jYWxPcmlnaW4sIGxvY2FsT3JpZ2luKTsKICAgICAgY29uc3QgYWRkID0gbG9jYWxPcmlnaW4uZG90KGxvY2FsQXhpcyk7CiAgICAgIG1pbiA9IG1heCA9IHZzWzBdLmRvdChsb2NhbEF4aXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBuOyBpKyspIHsKICAgICAgICBjb25zdCB2YWwgPSB2c1tpXS5kb3QobG9jYWxBeGlzKTsKCiAgICAgICAgaWYgKHZhbCA+IG1heCkgewogICAgICAgICAgbWF4ID0gdmFsOwogICAgICAgIH0KCiAgICAgICAgaWYgKHZhbCA8IG1pbikgewogICAgICAgICAgbWluID0gdmFsOwogICAgICAgIH0KICAgICAgfQoKICAgICAgbWluIC09IGFkZDsKICAgICAgbWF4IC09IGFkZDsKCiAgICAgIGlmIChtaW4gPiBtYXgpIHsKICAgICAgICAvLyBJbmNvbnNpc3RlbnQgLSBzd2FwCiAgICAgICAgY29uc3QgdGVtcCA9IG1pbjsKICAgICAgICBtaW4gPSBtYXg7CiAgICAgICAgbWF4ID0gdGVtcDsKICAgICAgfSAvLyBPdXRwdXQKCgogICAgICByZXN1bHRbMF0gPSBtYXg7CiAgICAgIHJlc3VsdFsxXSA9IG1pbjsKICAgIH0KCiAgfQogIGNvbnN0IG1heG1pbkEgPSBbXTsKICBjb25zdCBtYXhtaW5CID0gW107CiAgbmV3IFZlYzMoKTsKICBjb25zdCBwcm9qZWN0X2xvY2FsQXhpcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcHJvamVjdF9sb2NhbE9yaWdpbiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEEgM2QgYm94IHNoYXBlLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHNpemUgPSAxCiAgICogICAgIGNvbnN0IGhhbGZFeHRlbnRzID0gbmV3IENBTk5PTi5WZWMzKHNpemUsIHNpemUsIHNpemUpCiAgICogICAgIGNvbnN0IGJveFNoYXBlID0gbmV3IENBTk5PTi5Cb3goaGFsZkV4dGVudHMpCiAgICogICAgIGNvbnN0IGJveEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogYm94U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShib3hCb2R5KQogICAqLwogIGNsYXNzIEJveCBleHRlbmRzIFNoYXBlIHsKICAgIC8qKgogICAgICogVGhlIGhhbGYgZXh0ZW50cyBvZiB0aGUgYm94LgogICAgICovCgogICAgLyoqCiAgICAgKiBVc2VkIGJ5IHRoZSBjb250YWN0IGdlbmVyYXRvciB0byBtYWtlIGNvbnRhY3RzIHdpdGggb3RoZXIgY29udmV4IHBvbHloZWRyYSBmb3IgZXhhbXBsZS4KICAgICAqLwogICAgY29uc3RydWN0b3IoaGFsZkV4dGVudHMpIHsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLkJPWAogICAgICB9KTsKICAgICAgdGhpcy5oYWxmRXh0ZW50cyA9IGhhbGZFeHRlbnRzOwogICAgICB0aGlzLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiA9IG51bGw7CiAgICAgIHRoaXMudXBkYXRlQ29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgbG9jYWwgY29udmV4IHBvbHloZWRyb24gcmVwcmVzZW50YXRpb24gdXNlZCBmb3Igc29tZSBjb2xsaXNpb25zLgogICAgICovCgoKICAgIHVwZGF0ZUNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbigpIHsKICAgICAgY29uc3Qgc3ggPSB0aGlzLmhhbGZFeHRlbnRzLng7CiAgICAgIGNvbnN0IHN5ID0gdGhpcy5oYWxmRXh0ZW50cy55OwogICAgICBjb25zdCBzeiA9IHRoaXMuaGFsZkV4dGVudHMuejsKICAgICAgY29uc3QgViA9IFZlYzM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW25ldyBWKC1zeCwgLXN5LCAtc3opLCBuZXcgVihzeCwgLXN5LCAtc3opLCBuZXcgVihzeCwgc3ksIC1zeiksIG5ldyBWKC1zeCwgc3ksIC1zeiksIG5ldyBWKC1zeCwgLXN5LCBzeiksIG5ldyBWKHN4LCAtc3ksIHN6KSwgbmV3IFYoc3gsIHN5LCBzeiksIG5ldyBWKC1zeCwgc3ksIHN6KV07CiAgICAgIGNvbnN0IGZhY2VzID0gW1szLCAyLCAxLCAwXSwgLy8gLXoKICAgICAgWzQsIDUsIDYsIDddLCAvLyAregogICAgICBbNSwgNCwgMCwgMV0sIC8vIC15CiAgICAgIFsyLCAzLCA3LCA2XSwgLy8gK3kKICAgICAgWzAsIDQsIDcsIDNdLCAvLyAteAogICAgICBbMSwgMiwgNiwgNV0gLy8gK3gKICAgICAgXTsKICAgICAgY29uc3QgYXhlcyA9IFtuZXcgVigwLCAwLCAxKSwgbmV3IFYoMCwgMSwgMCksIG5ldyBWKDEsIDAsIDApXTsKICAgICAgY29uc3QgaCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKHsKICAgICAgICB2ZXJ0aWNlcywKICAgICAgICBmYWNlcywKICAgICAgICBheGVzCiAgICAgIH0pOwogICAgICB0aGlzLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiA9IGg7CiAgICAgIGgubWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsOwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgdGhlIGluZXJ0aWEgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICBjYWxjdWxhdGVMb2NhbEluZXJ0aWEobWFzcywgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKHRoaXMuaGFsZkV4dGVudHMsIG1hc3MsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogICAgc3RhdGljIGNhbGN1bGF0ZUluZXJ0aWEoaGFsZkV4dGVudHMsIG1hc3MsIHRhcmdldCkgewogICAgICBjb25zdCBlID0gaGFsZkV4dGVudHM7CiAgICAgIHRhcmdldC54ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIGUueSAqIDIgKiBlLnkgKyAyICogZS56ICogMiAqIGUueik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIGUueCAqIDIgKiBlLnggKyAyICogZS56ICogMiAqIGUueik7CiAgICAgIHRhcmdldC56ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIGUueSAqIDIgKiBlLnkgKyAyICogZS54ICogMiAqIGUueCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYm94IDYgc2lkZSBub3JtYWxzCiAgICAgKiBAcGFyYW0gc2l4VGFyZ2V0VmVjdG9ycyBBbiBhcnJheSBvZiA2IHZlY3RvcnMsIHRvIHN0b3JlIHRoZSByZXN1bHRpbmcgc2lkZSBub3JtYWxzIGluLgogICAgICogQHBhcmFtIHF1YXQgT3JpZW50YXRpb24gdG8gYXBwbHkgdG8gdGhlIG5vcm1hbCB2ZWN0b3JzLiBJZiBub3QgcHJvdmlkZWQsIHRoZSB2ZWN0b3JzIHdpbGwgYmUgaW4gcmVzcGVjdCB0byB0aGUgbG9jYWwgZnJhbWUuCiAgICAgKi8KCgogICAgZ2V0U2lkZU5vcm1hbHMoc2l4VGFyZ2V0VmVjdG9ycywgcXVhdCkgewogICAgICBjb25zdCBzaWRlcyA9IHNpeFRhcmdldFZlY3RvcnM7CiAgICAgIGNvbnN0IGV4ID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgc2lkZXNbMF0uc2V0KGV4LngsIDAsIDApOwogICAgICBzaWRlc1sxXS5zZXQoMCwgZXgueSwgMCk7CiAgICAgIHNpZGVzWzJdLnNldCgwLCAwLCBleC56KTsKICAgICAgc2lkZXNbM10uc2V0KC1leC54LCAwLCAwKTsKICAgICAgc2lkZXNbNF0uc2V0KDAsIC1leC55LCAwKTsKICAgICAgc2lkZXNbNV0uc2V0KDAsIDAsIC1leC56KTsKCiAgICAgIGlmIChxdWF0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gc2lkZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHF1YXQudm11bHQoc2lkZXNbaV0sIHNpZGVzW2ldKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBzaWRlczsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgdm9sdW1lIG9mIHRoZSBib3guCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gOC4wICogdGhpcy5oYWxmRXh0ZW50cy54ICogdGhpcy5oYWxmRXh0ZW50cy55ICogdGhpcy5oYWxmRXh0ZW50cy56OwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cwogICAgICovCgoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdGhpcy5oYWxmRXh0ZW50cy5sZW5ndGgoKTsKICAgIH0KICAgIC8qKgogICAgICogZm9yRWFjaFdvcmxkQ29ybmVyCiAgICAgKi8KCgogICAgZm9yRWFjaFdvcmxkQ29ybmVyKHBvcywgcXVhdCwgY2FsbGJhY2spIHsKICAgICAgY29uc3QgZSA9IHRoaXMuaGFsZkV4dGVudHM7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSBbW2UueCwgZS55LCBlLnpdLCBbLWUueCwgZS55LCBlLnpdLCBbLWUueCwgLWUueSwgZS56XSwgWy1lLngsIC1lLnksIC1lLnpdLCBbZS54LCAtZS55LCAtZS56XSwgW2UueCwgZS55LCAtZS56XSwgWy1lLngsIGUueSwgLWUuel0sIFtlLngsIC1lLnksIGUuel1dOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3JuZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgd29ybGRDb3JuZXJUZW1wUG9zLnNldChjb3JuZXJzW2ldWzBdLCBjb3JuZXJzW2ldWzFdLCBjb3JuZXJzW2ldWzJdKTsKICAgICAgICBxdWF0LnZtdWx0KHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBwb3MudmFkZCh3b3JsZENvcm5lclRlbXBQb3MsIHdvcmxkQ29ybmVyVGVtcFBvcyk7CiAgICAgICAgY2FsbGJhY2sod29ybGRDb3JuZXJUZW1wUG9zLngsIHdvcmxkQ29ybmVyVGVtcFBvcy55LCB3b3JsZENvcm5lclRlbXBQb3Mueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuaGFsZkV4dGVudHM7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMF0uc2V0KGUueCwgZS55LCBlLnopOwogICAgICB3b3JsZENvcm5lcnNUZW1wWzFdLnNldCgtZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMl0uc2V0KC1lLngsIC1lLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbM10uc2V0KC1lLngsIC1lLnksIC1lLnopOwogICAgICB3b3JsZENvcm5lcnNUZW1wWzRdLnNldChlLngsIC1lLnksIC1lLnopOwogICAgICB3b3JsZENvcm5lcnNUZW1wWzVdLnNldChlLngsIGUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNl0uc2V0KC1lLngsIGUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbN10uc2V0KGUueCwgLWUueSwgZS56KTsKICAgICAgY29uc3Qgd2MgPSB3b3JsZENvcm5lcnNUZW1wWzBdOwogICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgIHBvcy52YWRkKHdjLCB3Yyk7CiAgICAgIG1heC5jb3B5KHdjKTsKICAgICAgbWluLmNvcHkod2MpOwoKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCA4OyBpKyspIHsKICAgICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbaV07CiAgICAgICAgcXVhdC52bXVsdCh3Yywgd2MpOwogICAgICAgIHBvcy52YWRkKHdjLCB3Yyk7CiAgICAgICAgY29uc3QgeCA9IHdjLng7CiAgICAgICAgY29uc3QgeSA9IHdjLnk7CiAgICAgICAgY29uc3QgeiA9IHdjLno7CgogICAgICAgIGlmICh4ID4gbWF4LngpIHsKICAgICAgICAgIG1heC54ID0geDsKICAgICAgICB9CgogICAgICAgIGlmICh5ID4gbWF4LnkpIHsKICAgICAgICAgIG1heC55ID0geTsKICAgICAgICB9CgogICAgICAgIGlmICh6ID4gbWF4LnopIHsKICAgICAgICAgIG1heC56ID0gejsKICAgICAgICB9CgogICAgICAgIGlmICh4IDwgbWluLngpIHsKICAgICAgICAgIG1pbi54ID0geDsKICAgICAgICB9CgogICAgICAgIGlmICh5IDwgbWluLnkpIHsKICAgICAgICAgIG1pbi55ID0geTsKICAgICAgICB9CgogICAgICAgIGlmICh6IDwgbWluLnopIHsKICAgICAgICAgIG1pbi56ID0gejsKICAgICAgICB9CiAgICAgIH0gLy8gR2V0IGVhY2ggYXhpcyBtYXgKICAgICAgLy8gbWluLnNldChJbmZpbml0eSxJbmZpbml0eSxJbmZpbml0eSk7CiAgICAgIC8vIG1heC5zZXQoLUluZmluaXR5LC1JbmZpbml0eSwtSW5maW5pdHkpOwogICAgICAvLyB0aGlzLmZvckVhY2hXb3JsZENvcm5lcihwb3MscXVhdCxmdW5jdGlvbih4LHkseil7CiAgICAgIC8vICAgICBpZih4ID4gbWF4LngpewogICAgICAvLyAgICAgICAgIG1heC54ID0geDsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHkgPiBtYXgueSl7CiAgICAgIC8vICAgICAgICAgbWF4LnkgPSB5OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeiA+IG1heC56KXsKICAgICAgLy8gICAgICAgICBtYXgueiA9IHo7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih4IDwgbWluLngpewogICAgICAvLyAgICAgICAgIG1pbi54ID0geDsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHkgPCBtaW4ueSl7CiAgICAgIC8vICAgICAgICAgbWluLnkgPSB5OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeiA8IG1pbi56KXsKICAgICAgLy8gICAgICAgICBtaW4ueiA9IHo7CiAgICAgIC8vICAgICB9CiAgICAgIC8vIH0pOwoKICAgIH0KCiAgfQogIGNvbnN0IHdvcmxkQ29ybmVyVGVtcFBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgd29ybGRDb3JuZXJzVGVtcCA9IFtuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpXTsKCiAgLyoqCiAgICogQk9EWV9UWVBFUwogICAqLwogIGNvbnN0IEJPRFlfVFlQRVMgPSB7CiAgICAvKiogRFlOQU1JQyAqLwogICAgRFlOQU1JQzogMSwKCiAgICAvKiogU1RBVElDICovCiAgICBTVEFUSUM6IDIsCgogICAgLyoqIEtJTkVNQVRJQyAqLwogICAgS0lORU1BVElDOiA0CiAgfTsKICAvKioKICAgKiBCb2R5VHlwZQogICAqLwoKICAvKioKICAgKiBCT0RZX1NMRUVQX1NUQVRFUwogICAqLwogIGNvbnN0IEJPRFlfU0xFRVBfU1RBVEVTID0gewogICAgLyoqIEFXQUtFICovCiAgICBBV0FLRTogMCwKCiAgICAvKiogU0xFRVBZICovCiAgICBTTEVFUFk6IDEsCgogICAgLyoqIFNMRUVQSU5HICovCiAgICBTTEVFUElORzogMgogIH07CiAgLyoqCiAgICogQm9keVNsZWVwU3RhdGUKICAgKi8KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3IgYWxsIGJvZHkgdHlwZXMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc2hhcGUgPSBuZXcgQ0FOTk9OLlNwaGVyZSgxKQogICAqICAgICBjb25zdCBib2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsKICAgKiAgICAgICBtYXNzOiAxLAogICAqICAgICAgIHNoYXBlLAogICAqICAgICB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJvZHkpCiAgICovCiAgY2xhc3MgQm9keSBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciB0d28gYm9kaWVzIGNvbGxpZGUuIFRoaXMgZXZlbnQgaXMgZGlzcGF0Y2hlZCBvbiBlYWNoCiAgICAgKiBvZiB0aGUgdHdvIGJvZGllcyBpbnZvbHZlZCBpbiB0aGUgY29sbGlzaW9uLgogICAgICogQGV2ZW50IGNvbGxpZGUKICAgICAqIEBwYXJhbSBib2R5IFRoZSBib2R5IHRoYXQgd2FzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAcGFyYW0gY29udGFjdCBUaGUgZGV0YWlscyBvZiB0aGUgY29sbGlzaW9uLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGR5bmFtaWMgYm9keSBpcyBmdWxseSBzaW11bGF0ZWQuIENhbiBiZSBtb3ZlZCBtYW51YWxseSBieSB0aGUgdXNlciwgYnV0IG5vcm1hbGx5IHRoZXkgbW92ZSBhY2NvcmRpbmcgdG8gZm9yY2VzLiBBIGR5bmFtaWMgYm9keSBjYW4gY29sbGlkZSB3aXRoIGFsbCBib2R5IHR5cGVzLiBBIGR5bmFtaWMgYm9keSBhbHdheXMgaGFzIGZpbml0ZSwgbm9uLXplcm8gbWFzcy4KICAgICAqLwoKICAgIC8qKgogICAgICogQSBzdGF0aWMgYm9keSBkb2VzIG5vdCBtb3ZlIGR1cmluZyBzaW11bGF0aW9uIGFuZCBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBTdGF0aWMgYm9kaWVzIGNhbiBiZSBtb3ZlZCBtYW51YWxseSBieSBzZXR0aW5nIHRoZSBwb3NpdGlvbiBvZiB0aGUgYm9keS4gVGhlIHZlbG9jaXR5IG9mIGEgc3RhdGljIGJvZHkgaXMgYWx3YXlzIHplcm8uIFN0YXRpYyBib2RpZXMgZG8gbm90IGNvbGxpZGUgd2l0aCBvdGhlciBzdGF0aWMgb3Iga2luZW1hdGljIGJvZGllcy4KICAgICAqLwoKICAgIC8qKgogICAgICogQSBraW5lbWF0aWMgYm9keSBtb3ZlcyB1bmRlciBzaW11bGF0aW9uIGFjY29yZGluZyB0byBpdHMgdmVsb2NpdHkuIFRoZXkgZG8gbm90IHJlc3BvbmQgdG8gZm9yY2VzLiBUaGV5IGNhbiBiZSBtb3ZlZCBtYW51YWxseSwgYnV0IG5vcm1hbGx5IGEga2luZW1hdGljIGJvZHkgaXMgbW92ZWQgYnkgc2V0dGluZyBpdHMgdmVsb2NpdHkuIEEga2luZW1hdGljIGJvZHkgYmVoYXZlcyBhcyBpZiBpdCBoYXMgaW5maW5pdGUgbWFzcy4gS2luZW1hdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBV0FLRQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUFkKICAgICAqLwoKICAgIC8qKgogICAgICogU0xFRVBJTkcKICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIHNsZWVwaW5nIGJvZHkgaGFzIHdva2VuIHVwLgogICAgICogQGV2ZW50IHdha2V1cAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgYm9keSBoYXMgZ29uZSBpbiB0byB0aGUgc2xlZXB5IHN0YXRlLgogICAgICogQGV2ZW50IHNsZWVweQogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgYm9keSBoYXMgZmFsbGVuIGFzbGVlcC4KICAgICAqIEBldmVudCBzbGVlcAogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuaWQgPSBCb2R5LmlkQ291bnRlcisrOwogICAgICB0aGlzLmluZGV4ID0gLTE7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLnZsYW1iZGEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPT09ICdudW1iZXInID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA6IDE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgPT09ICdudW1iZXInID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrIDogLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA9PT0gJ2Jvb2xlYW4nID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludGVycG9sYXRlZFBvc2l0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5pbml0UG9zaXRpb24gPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRQb3NpdGlvbi5jb3B5KG9wdGlvbnMucG9zaXRpb24pOwogICAgICAgIHRoaXMuaW5pdFBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMudmVsb2NpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMudmVsb2NpdHkpIHsKICAgICAgICB0aGlzLnZlbG9jaXR5LmNvcHkob3B0aW9ucy52ZWxvY2l0eSk7CiAgICAgIH0KCiAgICAgIHRoaXMuaW5pdFZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5mb3JjZSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG1hc3MgPSB0eXBlb2Ygb3B0aW9ucy5tYXNzID09PSAnbnVtYmVyJyA/IG9wdGlvbnMubWFzcyA6IDA7CiAgICAgIHRoaXMubWFzcyA9IG1hc3M7CiAgICAgIHRoaXMuaW52TWFzcyA9IG1hc3MgPiAwID8gMS4wIC8gbWFzcyA6IDA7CiAgICAgIHRoaXMubWF0ZXJpYWwgPSBvcHRpb25zLm1hdGVyaWFsIHx8IG51bGw7CiAgICAgIHRoaXMubGluZWFyRGFtcGluZyA9IHR5cGVvZiBvcHRpb25zLmxpbmVhckRhbXBpbmcgPT09ICdudW1iZXInID8gb3B0aW9ucy5saW5lYXJEYW1waW5nIDogMC4wMTsKICAgICAgdGhpcy50eXBlID0gbWFzcyA8PSAwLjAgPyBCb2R5LlNUQVRJQyA6IEJvZHkuRFlOQU1JQzsKCiAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy50eXBlID09PSB0eXBlb2YgQm9keS5TVEFUSUMpIHsKICAgICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGU7CiAgICAgIH0KCiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9IHR5cGVvZiBvcHRpb25zLmFsbG93U2xlZXAgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5hbGxvd1NsZWVwIDogdHJ1ZTsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5BV0FLRTsKICAgICAgdGhpcy5zbGVlcFNwZWVkTGltaXQgPSB0eXBlb2Ygb3B0aW9ucy5zbGVlcFNwZWVkTGltaXQgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5zbGVlcFNwZWVkTGltaXQgOiAwLjE7CiAgICAgIHRoaXMuc2xlZXBUaW1lTGltaXQgPSB0eXBlb2Ygb3B0aW9ucy5zbGVlcFRpbWVMaW1pdCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnNsZWVwVGltZUxpbWl0IDogMTsKICAgICAgdGhpcy50aW1lTGFzdFNsZWVweSA9IDA7CiAgICAgIHRoaXMud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IGZhbHNlOwogICAgICB0aGlzLnRvcnF1ZSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMuaW5pdFF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB0aGlzLnByZXZpb3VzUXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgogICAgICBpZiAob3B0aW9ucy5xdWF0ZXJuaW9uKSB7CiAgICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLmluaXRRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLnByZXZpb3VzUXVhdGVybmlvbi5jb3B5KG9wdGlvbnMucXVhdGVybmlvbik7CiAgICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgfQoKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMuYW5ndWxhclZlbG9jaXR5KSB7CiAgICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY29weShvcHRpb25zLmFuZ3VsYXJWZWxvY2l0eSk7CiAgICAgIH0KCiAgICAgIHRoaXMuaW5pdEFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuc2hhcGVzID0gW107CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzID0gW107CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMgPSBbXTsKICAgICAgdGhpcy5pbmVydGlhID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5pbnZJbmVydGlhID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQgPSBuZXcgTWF0MygpOwogICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IDA7CiAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGRTb2x2ZSA9IG5ldyBNYXQzKCk7CiAgICAgIHRoaXMuZml4ZWRSb3RhdGlvbiA9IHR5cGVvZiBvcHRpb25zLmZpeGVkUm90YXRpb24gIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5maXhlZFJvdGF0aW9uIDogZmFsc2U7CiAgICAgIHRoaXMuYW5ndWxhckRhbXBpbmcgPSB0eXBlb2Ygb3B0aW9ucy5hbmd1bGFyRGFtcGluZyAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ3VsYXJEYW1waW5nIDogMC4wMTsKICAgICAgdGhpcy5saW5lYXJGYWN0b3IgPSBuZXcgVmVjMygxLCAxLCAxKTsKCiAgICAgIGlmIChvcHRpb25zLmxpbmVhckZhY3RvcikgewogICAgICAgIHRoaXMubGluZWFyRmFjdG9yLmNvcHkob3B0aW9ucy5saW5lYXJGYWN0b3IpOwogICAgICB9CgogICAgICB0aGlzLmFuZ3VsYXJGYWN0b3IgPSBuZXcgVmVjMygxLCAxLCAxKTsKCiAgICAgIGlmIChvcHRpb25zLmFuZ3VsYXJGYWN0b3IpIHsKICAgICAgICB0aGlzLmFuZ3VsYXJGYWN0b3IuY29weShvcHRpb25zLmFuZ3VsYXJGYWN0b3IpOwogICAgICB9CgogICAgICB0aGlzLmFhYmIgPSBuZXcgQUFCQigpOwogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMuYm91bmRpbmdSYWRpdXMgPSAwOwogICAgICB0aGlzLndsYW1iZGEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmlzVHJpZ2dlciA9IEJvb2xlYW4ob3B0aW9ucy5pc1RyaWdnZXIpOwoKICAgICAgaWYgKG9wdGlvbnMuc2hhcGUpIHsKICAgICAgICB0aGlzLmFkZFNoYXBlKG9wdGlvbnMuc2hhcGUpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICB9CiAgICAvKioKICAgICAqIFdha2UgdGhlIGJvZHkgdXAuCiAgICAgKi8KCgogICAgd2FrZVVwKCkgewogICAgICBjb25zdCBwcmV2U3RhdGUgPSB0aGlzLnNsZWVwU3RhdGU7CiAgICAgIHRoaXMuc2xlZXBTdGF0ZSA9IEJvZHkuQVdBS0U7CiAgICAgIHRoaXMud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IGZhbHNlOwoKICAgICAgaWYgKHByZXZTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5Lndha2V1cEV2ZW50KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBGb3JjZSBib2R5IHNsZWVwCiAgICAgKi8KCgogICAgc2xlZXAoKSB7CiAgICAgIHRoaXMuc2xlZXBTdGF0ZSA9IEJvZHkuU0xFRVBJTkc7CiAgICAgIHRoaXMudmVsb2NpdHkuc2V0KDAsIDAsIDApOwogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgIHRoaXMud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBDYWxsZWQgZXZlcnkgdGltZXN0ZXAgdG8gdXBkYXRlIGludGVybmFsIHNsZWVwIHRpbWVyIGFuZCBjaGFuZ2Ugc2xlZXAgc3RhdGUgaWYgbmVlZGVkLgogICAgICogQHBhcmFtIHRpbWUgVGhlIHdvcmxkIHRpbWUgaW4gc2Vjb25kcwogICAgICovCgoKICAgIHNsZWVwVGljayh0aW1lKSB7CiAgICAgIGlmICh0aGlzLmFsbG93U2xlZXApIHsKICAgICAgICBjb25zdCBzbGVlcFN0YXRlID0gdGhpcy5zbGVlcFN0YXRlOwogICAgICAgIGNvbnN0IHNwZWVkU3F1YXJlZCA9IHRoaXMudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgdGhpcy5hbmd1bGFyVmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpOwogICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkID0gdGhpcy5zbGVlcFNwZWVkTGltaXQgKiogMjsKCiAgICAgICAgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuQVdBS0UgJiYgc3BlZWRTcXVhcmVkIDwgc3BlZWRMaW1pdFNxdWFyZWQpIHsKICAgICAgICAgIHRoaXMuc2xlZXBTdGF0ZSA9IEJvZHkuU0xFRVBZOyAvLyBTbGVlcHkKCiAgICAgICAgICB0aGlzLnRpbWVMYXN0U2xlZXB5ID0gdGltZTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5LnNsZWVweUV2ZW50KTsKICAgICAgICB9IGVsc2UgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBZICYmIHNwZWVkU3F1YXJlZCA+IHNwZWVkTGltaXRTcXVhcmVkKSB7CiAgICAgICAgICB0aGlzLndha2VVcCgpOyAvLyBXYWtlIHVwCiAgICAgICAgfSBlbHNlIGlmIChzbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQWSAmJiB0aW1lIC0gdGhpcy50aW1lTGFzdFNsZWVweSA+IHRoaXMuc2xlZXBUaW1lTGltaXQpIHsKICAgICAgICAgIHRoaXMuc2xlZXAoKTsgLy8gU2xlZXBpbmcKCiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoQm9keS5zbGVlcEV2ZW50KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogSWYgdGhlIGJvZHkgaXMgc2xlZXBpbmcsIGl0IHNob3VsZCBiZSBpbW1vdmFibGUgLyBoYXZlIGluZmluaXRlIG1hc3MgZHVyaW5nIHNvbHZlLiBXZSBzb2x2ZSBpdCBieSBoYXZpbmcgYSBzZXBhcmF0ZSAic29sdmUgbWFzcyIuCiAgICAgKi8KCgogICAgdXBkYXRlU29sdmVNYXNzUHJvcGVydGllcygpIHsKICAgICAgaWYgKHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyB8fCB0aGlzLnR5cGUgPT09IEJvZHkuS0lORU1BVElDKSB7CiAgICAgICAgdGhpcy5pbnZNYXNzU29sdmUgPSAwOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlLnNldFplcm8oKTsKICAgICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlLnNldFplcm8oKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IHRoaXMuaW52TWFzczsKICAgICAgICB0aGlzLmludkluZXJ0aWFTb2x2ZS5jb3B5KHRoaXMuaW52SW5lcnRpYSk7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGRTb2x2ZS5jb3B5KHRoaXMuaW52SW5lcnRpYVdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgd29ybGQgcG9pbnQgdG8gbG9jYWwgYm9keSBmcmFtZS4KICAgICAqLwoKCiAgICBwb2ludFRvTG9jYWxGcmFtZSh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHRoaXMucG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHRoaXMucXVhdGVybmlvbi5jb25qdWdhdGUoKS52bXVsdChyZXN1bHQsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCB2ZWN0b3IgdG8gbG9jYWwgYm9keSBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb0xvY2FsRnJhbWUod29ybGRWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24uY29uanVnYXRlKCkudm11bHQod29ybGRWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSBsb2NhbCBib2R5IHBvaW50IHRvIHdvcmxkIGZyYW1lLgogICAgICovCgoKICAgIHBvaW50VG9Xb3JsZEZyYW1lKGxvY2FsUG9pbnQsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQodGhpcy5wb3NpdGlvbiwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIGxvY2FsIGJvZHkgcG9pbnQgdG8gd29ybGQgZnJhbWUuCiAgICAgKi8KCgogICAgdmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsVmVjdG9yLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGhpcy5xdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBzaGFwZSB0byB0aGUgYm9keSB3aXRoIGEgbG9jYWwgb2Zmc2V0IGFuZCBvcmllbnRhdGlvbi4KICAgICAqIEByZXR1cm4gVGhlIGJvZHkgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGFkZFNoYXBlKHNoYXBlLCBfb2Zmc2V0LCBfb3JpZW50YXRpb24pIHsKICAgICAgY29uc3Qgb2Zmc2V0ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgb3JpZW50YXRpb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKF9vZmZzZXQpIHsKICAgICAgICBvZmZzZXQuY29weShfb2Zmc2V0KTsKICAgICAgfQoKICAgICAgaWYgKF9vcmllbnRhdGlvbikgewogICAgICAgIG9yaWVudGF0aW9uLmNvcHkoX29yaWVudGF0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy5zaGFwZXMucHVzaChzaGFwZSk7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzLnB1c2gob2Zmc2V0KTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucy5wdXNoKG9yaWVudGF0aW9uKTsKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nUmFkaXVzKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgc2hhcGUuYm9keSA9IHRoaXM7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBzaGFwZSBmcm9tIHRoZSBib2R5LgogICAgICogQHJldHVybiBUaGUgYm9keSBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlU2hhcGUoc2hhcGUpIHsKICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnNoYXBlcy5pbmRleE9mKHNoYXBlKTsKCiAgICAgIGlmIChpbmRleCA9PT0gLTEpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ1NoYXBlIGRvZXMgbm90IGJlbG9uZyB0byB0aGUgYm9keScpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICB0aGlzLnNoYXBlcy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB0aGlzLnNoYXBlT2Zmc2V0cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1JhZGl1cygpOwogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHNoYXBlLmJvZHkgPSBudWxsOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBib3VuZGluZyByYWRpdXMgb2YgdGhlIGJvZHkuIFNob3VsZCBiZSBkb25lIGlmIGFueSBvZiB0aGUgc2hhcGVzIGFyZSBjaGFuZ2VkLgogICAgICovCgoKICAgIHVwZGF0ZUJvdW5kaW5nUmFkaXVzKCkgewogICAgICBjb25zdCBzaGFwZXMgPSB0aGlzLnNoYXBlczsKICAgICAgY29uc3Qgc2hhcGVPZmZzZXRzID0gdGhpcy5zaGFwZU9mZnNldHM7CiAgICAgIGNvbnN0IE4gPSBzaGFwZXMubGVuZ3RoOwogICAgICBsZXQgcmFkaXVzID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tpXTsKICAgICAgICBzaGFwZS51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICAgIGNvbnN0IG9mZnNldCA9IHNoYXBlT2Zmc2V0c1tpXS5sZW5ndGgoKTsKICAgICAgICBjb25zdCByID0gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXM7CgogICAgICAgIGlmIChvZmZzZXQgKyByID4gcmFkaXVzKSB7CiAgICAgICAgICByYWRpdXMgPSBvZmZzZXQgKyByOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IHJhZGl1czsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgLmFhYmIKICAgICAqLwoKCiAgICB1cGRhdGVBQUJCKCkgewogICAgICBjb25zdCBzaGFwZXMgPSB0aGlzLnNoYXBlczsKICAgICAgY29uc3Qgc2hhcGVPZmZzZXRzID0gdGhpcy5zaGFwZU9mZnNldHM7CiAgICAgIGNvbnN0IHNoYXBlT3JpZW50YXRpb25zID0gdGhpcy5zaGFwZU9yaWVudGF0aW9uczsKICAgICAgY29uc3QgTiA9IHNoYXBlcy5sZW5ndGg7CiAgICAgIGNvbnN0IG9mZnNldCA9IHRtcFZlYzsKICAgICAgY29uc3Qgb3JpZW50YXRpb24gPSB0bXBRdWF0OwogICAgICBjb25zdCBib2R5UXVhdCA9IHRoaXMucXVhdGVybmlvbjsKICAgICAgY29uc3QgYWFiYiA9IHRoaXMuYWFiYjsKICAgICAgY29uc3Qgc2hhcGVBQUJCID0gdXBkYXRlQUFCQl9zaGFwZUFBQkI7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGUgPSBzaGFwZXNbaV07IC8vIEdldCBzaGFwZSB3b3JsZCBwb3NpdGlvbgoKICAgICAgICBib2R5UXVhdC52bXVsdChzaGFwZU9mZnNldHNbaV0sIG9mZnNldCk7CiAgICAgICAgb2Zmc2V0LnZhZGQodGhpcy5wb3NpdGlvbiwgb2Zmc2V0KTsgLy8gR2V0IHNoYXBlIHdvcmxkIHF1YXRlcm5pb24KCiAgICAgICAgYm9keVF1YXQubXVsdChzaGFwZU9yaWVudGF0aW9uc1tpXSwgb3JpZW50YXRpb24pOyAvLyBHZXQgc2hhcGUgQUFCQgoKICAgICAgICBzaGFwZS5jYWxjdWxhdGVXb3JsZEFBQkIob2Zmc2V0LCBvcmllbnRhdGlvbiwgc2hhcGVBQUJCLmxvd2VyQm91bmQsIHNoYXBlQUFCQi51cHBlckJvdW5kKTsKCiAgICAgICAgaWYgKGkgPT09IDApIHsKICAgICAgICAgIGFhYmIuY29weShzaGFwZUFBQkIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhYWJiLmV4dGVuZChzaGFwZUFBQkIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIGAuaW5lcnRpYVdvcmxkYCBhbmQgYC5pbnZJbmVydGlhV29ybGRgCiAgICAgKi8KCgogICAgdXBkYXRlSW5lcnRpYVdvcmxkKGZvcmNlKSB7CiAgICAgIGNvbnN0IEkgPSB0aGlzLmludkluZXJ0aWE7CgogICAgICBpZiAoSS54ID09PSBJLnkgJiYgSS55ID09PSBJLnogJiYgIWZvcmNlKSA7IGVsc2UgewogICAgICAgIGNvbnN0IG0xID0gdWl3X20xOwogICAgICAgIGNvbnN0IG0yID0gdWl3X20yOwogICAgICAgIG0xLnNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24odGhpcy5xdWF0ZXJuaW9uKTsKICAgICAgICBtMS50cmFuc3Bvc2UobTIpOwogICAgICAgIG0xLnNjYWxlKEksIG0xKTsKICAgICAgICBtMS5tbXVsdChtMiwgdGhpcy5pbnZJbmVydGlhV29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGZvcmNlIHRvIGEgcG9pbnQgb2YgdGhlIGJvZHkuIFRoaXMgY291bGQgZm9yIGV4YW1wbGUgYmUgYSBwb2ludCBvbiB0aGUgQm9keSBzdXJmYWNlLgogICAgICogQXBwbHlpbmcgZm9yY2UgdGhpcyB3YXkgd2lsbCBhZGQgdG8gQm9keS5mb3JjZSBhbmQgQm9keS50b3JxdWUuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGFtb3VudCBvZiBmb3JjZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlGb3JjZShmb3JjZSwgcmVsYXRpdmVQb2ludCkgewogICAgICBpZiAocmVsYXRpdmVQb2ludCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVsYXRpdmVQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIE5lZWRlZD8KICAgICAgaWYgKHRoaXMudHlwZSAhPT0gQm9keS5EWU5BTUlDKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy53YWtlVXAoKTsKICAgICAgfSAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgZm9yY2UKCgogICAgICBjb25zdCByb3RGb3JjZSA9IEJvZHlfYXBwbHlGb3JjZV9yb3RGb3JjZTsKICAgICAgcmVsYXRpdmVQb2ludC5jcm9zcyhmb3JjZSwgcm90Rm9yY2UpOyAvLyBBZGQgbGluZWFyIGZvcmNlCgogICAgICB0aGlzLmZvcmNlLnZhZGQoZm9yY2UsIHRoaXMuZm9yY2UpOyAvLyBBZGQgcm90YXRpb25hbCBmb3JjZQoKICAgICAgdGhpcy50b3JxdWUudmFkZChyb3RGb3JjZSwgdGhpcy50b3JxdWUpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBmb3JjZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxGb3JjZShsb2NhbEZvcmNlLCBsb2NhbFBvaW50KSB7CiAgICAgIGlmIChsb2NhbFBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICBsb2NhbFBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMudHlwZSAhPT0gQm9keS5EWU5BTUlDKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCB3b3JsZEZvcmNlID0gQm9keV9hcHBseUxvY2FsRm9yY2Vfd29ybGRGb3JjZTsKICAgICAgY29uc3QgcmVsYXRpdmVQb2ludFdvcmxkID0gQm9keV9hcHBseUxvY2FsRm9yY2VfcmVsYXRpdmVQb2ludFdvcmxkOyAvLyBUcmFuc2Zvcm0gdGhlIGZvcmNlIHZlY3RvciB0byB3b3JsZCBzcGFjZQoKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxGb3JjZSwgd29ybGRGb3JjZSk7CiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsUG9pbnQsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuYXBwbHlGb3JjZSh3b3JsZEZvcmNlLCByZWxhdGl2ZVBvaW50V29ybGQpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSB0b3JxdWUgdG8gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gdG9ycXVlIFRoZSBhbW91bnQgb2YgdG9ycXVlIHRvIGFkZC4KICAgICAqLwoKCiAgICBhcHBseVRvcnF1ZSh0b3JxdWUpIHsKICAgICAgaWYgKHRoaXMudHlwZSAhPT0gQm9keS5EWU5BTUlDKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy53YWtlVXAoKTsKICAgICAgfSAvLyBBZGQgcm90YXRpb25hbCBmb3JjZQoKCiAgICAgIHRoaXMudG9ycXVlLnZhZGQodG9ycXVlLCB0aGlzLnRvcnF1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGltcHVsc2UgdG8gYSBwb2ludCBvZiB0aGUgYm9keS4gVGhpcyBjb3VsZCBmb3IgZXhhbXBsZSBiZSBhIHBvaW50IG9uIHRoZSBCb2R5IHN1cmZhY2UuCiAgICAgKiBBbiBpbXB1bHNlIGlzIGEgZm9yY2UgYWRkZWQgdG8gYSBib2R5IGR1cmluZyBhIHNob3J0IHBlcmlvZCBvZiB0aW1lIChpbXB1bHNlID0gZm9yY2UgKiB0aW1lKS4KICAgICAqIEltcHVsc2VzIHdpbGwgYmUgYWRkZWQgdG8gQm9keS52ZWxvY2l0eSBhbmQgQm9keS5hbmd1bGFyVmVsb2NpdHkuCiAgICAgKiBAcGFyYW0gaW1wdWxzZSBUaGUgYW1vdW50IG9mIGltcHVsc2UgdG8gYWRkLgogICAgICogQHBhcmFtIHJlbGF0aXZlUG9pbnQgQSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3MgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5SW1wdWxzZShpbXB1bHNlLCByZWxhdGl2ZVBvaW50KSB7CiAgICAgIGlmIChyZWxhdGl2ZVBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICByZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMudHlwZSAhPT0gQm9keS5EWU5BTUlDKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy53YWtlVXAoKTsKICAgICAgfSAvLyBDb21wdXRlIHBvaW50IHBvc2l0aW9uIHJlbGF0aXZlIHRvIHRoZSBib2R5IGNlbnRlcgoKCiAgICAgIGNvbnN0IHIgPSByZWxhdGl2ZVBvaW50OyAvLyBDb21wdXRlIHByb2R1Y2VkIGNlbnRyYWwgaW1wdWxzZSB2ZWxvY2l0eQoKICAgICAgY29uc3QgdmVsbyA9IEJvZHlfYXBwbHlJbXB1bHNlX3ZlbG87CiAgICAgIHZlbG8uY29weShpbXB1bHNlKTsKICAgICAgdmVsby5zY2FsZSh0aGlzLmludk1hc3MsIHZlbG8pOyAvLyBBZGQgbGluZWFyIGltcHVsc2UKCiAgICAgIHRoaXMudmVsb2NpdHkudmFkZCh2ZWxvLCB0aGlzLnZlbG9jaXR5KTsgLy8gQ29tcHV0ZSBwcm9kdWNlZCByb3RhdGlvbmFsIGltcHVsc2UgdmVsb2NpdHkKCiAgICAgIGNvbnN0IHJvdFZlbG8gPSBCb2R5X2FwcGx5SW1wdWxzZV9yb3RWZWxvOwogICAgICByLmNyb3NzKGltcHVsc2UsIHJvdFZlbG8pOwogICAgICAvKgogICAgICAgcm90VmVsby54ICo9IHRoaXMuaW52SW5lcnRpYS54OwogICAgICAgcm90VmVsby55ICo9IHRoaXMuaW52SW5lcnRpYS55OwogICAgICAgcm90VmVsby56ICo9IHRoaXMuaW52SW5lcnRpYS56OwogICAgICAgKi8KCiAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkLnZtdWx0KHJvdFZlbG8sIHJvdFZlbG8pOyAvLyBBZGQgcm90YXRpb25hbCBJbXB1bHNlCgogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS52YWRkKHJvdFZlbG8sIHRoaXMuYW5ndWxhclZlbG9jaXR5KTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgbG9jYWxseS1kZWZpbmVkIGltcHVsc2UgdG8gYSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keS4KICAgICAqIEBwYXJhbSBmb3JjZSBUaGUgZm9yY2UgdmVjdG9yIHRvIGFwcGx5LCBkZWZpbmVkIGxvY2FsbHkgaW4gdGhlIGJvZHkgZnJhbWUuCiAgICAgKiBAcGFyYW0gbG9jYWxQb2ludCBBIGxvY2FsIHBvaW50IGluIHRoZSBib2R5IHRvIGFwcGx5IHRoZSBmb3JjZSBvbi4KICAgICAqLwoKCiAgICBhcHBseUxvY2FsSW1wdWxzZShsb2NhbEltcHVsc2UsIGxvY2FsUG9pbnQpIHsKICAgICAgaWYgKGxvY2FsUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIGxvY2FsUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkSW1wdWxzZSA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2Vfd29ybGRJbXB1bHNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxJbXB1bHNlX3JlbGF0aXZlUG9pbnQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEltcHVsc2UsIHdvcmxkSW1wdWxzZSk7CiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsUG9pbnQsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuYXBwbHlJbXB1bHNlKHdvcmxkSW1wdWxzZSwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogU2hvdWxkIGJlIGNhbGxlZCB3aGVuZXZlciB5b3UgY2hhbmdlIHRoZSBib2R5IHNoYXBlIG9yIG1hc3MuCiAgICAgKi8KCgogICAgdXBkYXRlTWFzc1Byb3BlcnRpZXMoKSB7CiAgICAgIGNvbnN0IGhhbGZFeHRlbnRzID0gQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50czsKICAgICAgdGhpcy5pbnZNYXNzID0gdGhpcy5tYXNzID4gMCA/IDEuMCAvIHRoaXMubWFzcyA6IDA7CiAgICAgIGNvbnN0IEkgPSB0aGlzLmluZXJ0aWE7CiAgICAgIGNvbnN0IGZpeGVkID0gdGhpcy5maXhlZFJvdGF0aW9uOyAvLyBBcHByb3hpbWF0ZSB3aXRoIEFBQkIgYm94CgogICAgICB0aGlzLnVwZGF0ZUFBQkIoKTsKICAgICAgaGFsZkV4dGVudHMuc2V0KCh0aGlzLmFhYmIudXBwZXJCb3VuZC54IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueCkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueSAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnkpIC8gMiwgKHRoaXMuYWFiYi51cHBlckJvdW5kLnogLSB0aGlzLmFhYmIubG93ZXJCb3VuZC56KSAvIDIpOwogICAgICBCb3guY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgdGhpcy5tYXNzLCBJKTsKICAgICAgdGhpcy5pbnZJbmVydGlhLnNldChJLnggPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueCA6IDAsIEkueSA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS55IDogMCwgSS56ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnogOiAwKTsKICAgICAgdGhpcy51cGRhdGVJbmVydGlhV29ybGQodHJ1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB3b3JsZCB2ZWxvY2l0eSBvZiBhIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIHdvcmxkUG9pbnQKICAgICAqIEBwYXJhbSByZXN1bHQKICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCB2ZWN0b3IuCiAgICAgKi8KCgogICAgZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod29ybGRQb2ludCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IHIgPSBuZXcgVmVjMygpOwogICAgICB3b3JsZFBvaW50LnZzdWIodGhpcy5wb3NpdGlvbiwgcik7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LmNyb3NzKHIsIHJlc3VsdCk7CiAgICAgIHRoaXMudmVsb2NpdHkudmFkZChyZXN1bHQsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIE1vdmUgdGhlIGJvZHkgZm9yd2FyZCBpbiB0aW1lLgogICAgICogQHBhcmFtIGR0IFRpbWUgc3RlcAogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemUgU2V0IHRvIHRydWUgdG8gbm9ybWFsaXplIHRoZSBib2R5IHF1YXRlcm5pb24KICAgICAqIEBwYXJhbSBxdWF0Tm9ybWFsaXplRmFzdCBJZiB0aGUgcXVhdGVybmlvbiBzaG91bGQgYmUgbm9ybWFsaXplZCB1c2luZyAiZmFzdCIgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uCiAgICAgKi8KCgogICAgaW50ZWdyYXRlKGR0LCBxdWF0Tm9ybWFsaXplLCBxdWF0Tm9ybWFsaXplRmFzdCkgewogICAgICAvLyBTYXZlIHByZXZpb3VzIHBvc2l0aW9uCiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbi5jb3B5KHRoaXMucG9zaXRpb24pOwogICAgICB0aGlzLnByZXZpb3VzUXVhdGVybmlvbi5jb3B5KHRoaXMucXVhdGVybmlvbik7CgogICAgICBpZiAoISh0aGlzLnR5cGUgPT09IEJvZHkuRFlOQU1JQyB8fCB0aGlzLnR5cGUgPT09IEJvZHkuS0lORU1BVElDKSB8fCB0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCB2ZWxvID0gdGhpcy52ZWxvY2l0eTsKICAgICAgY29uc3QgYW5ndWxhclZlbG8gPSB0aGlzLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgY29uc3QgcG9zID0gdGhpcy5wb3NpdGlvbjsKICAgICAgY29uc3QgZm9yY2UgPSB0aGlzLmZvcmNlOwogICAgICBjb25zdCB0b3JxdWUgPSB0aGlzLnRvcnF1ZTsKICAgICAgY29uc3QgcXVhdCA9IHRoaXMucXVhdGVybmlvbjsKICAgICAgY29uc3QgaW52TWFzcyA9IHRoaXMuaW52TWFzczsKICAgICAgY29uc3QgaW52SW5lcnRpYSA9IHRoaXMuaW52SW5lcnRpYVdvcmxkOwogICAgICBjb25zdCBsaW5lYXJGYWN0b3IgPSB0aGlzLmxpbmVhckZhY3RvcjsKICAgICAgY29uc3QgaU1kdCA9IGludk1hc3MgKiBkdDsKICAgICAgdmVsby54ICs9IGZvcmNlLnggKiBpTWR0ICogbGluZWFyRmFjdG9yLng7CiAgICAgIHZlbG8ueSArPSBmb3JjZS55ICogaU1kdCAqIGxpbmVhckZhY3Rvci55OwogICAgICB2ZWxvLnogKz0gZm9yY2UueiAqIGlNZHQgKiBsaW5lYXJGYWN0b3IuejsKICAgICAgY29uc3QgZSA9IGludkluZXJ0aWEuZWxlbWVudHM7CiAgICAgIGNvbnN0IGFuZ3VsYXJGYWN0b3IgPSB0aGlzLmFuZ3VsYXJGYWN0b3I7CiAgICAgIGNvbnN0IHR4ID0gdG9ycXVlLnggKiBhbmd1bGFyRmFjdG9yLng7CiAgICAgIGNvbnN0IHR5ID0gdG9ycXVlLnkgKiBhbmd1bGFyRmFjdG9yLnk7CiAgICAgIGNvbnN0IHR6ID0gdG9ycXVlLnogKiBhbmd1bGFyRmFjdG9yLno7CiAgICAgIGFuZ3VsYXJWZWxvLnggKz0gZHQgKiAoZVswXSAqIHR4ICsgZVsxXSAqIHR5ICsgZVsyXSAqIHR6KTsKICAgICAgYW5ndWxhclZlbG8ueSArPSBkdCAqIChlWzNdICogdHggKyBlWzRdICogdHkgKyBlWzVdICogdHopOwogICAgICBhbmd1bGFyVmVsby56ICs9IGR0ICogKGVbNl0gKiB0eCArIGVbN10gKiB0eSArIGVbOF0gKiB0eik7IC8vIFVzZSBuZXcgdmVsb2NpdHkgIC0gbGVhcCBmcm9nCgogICAgICBwb3MueCArPSB2ZWxvLnggKiBkdDsKICAgICAgcG9zLnkgKz0gdmVsby55ICogZHQ7CiAgICAgIHBvcy56ICs9IHZlbG8ueiAqIGR0OwogICAgICBxdWF0LmludGVncmF0ZSh0aGlzLmFuZ3VsYXJWZWxvY2l0eSwgZHQsIHRoaXMuYW5ndWxhckZhY3RvciwgcXVhdCk7CgogICAgICBpZiAocXVhdE5vcm1hbGl6ZSkgewogICAgICAgIGlmIChxdWF0Tm9ybWFsaXplRmFzdCkgewogICAgICAgICAgcXVhdC5ub3JtYWxpemVGYXN0KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHF1YXQubm9ybWFsaXplKCk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IHRydWU7IC8vIFVwZGF0ZSB3b3JsZCBpbmVydGlhCgogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCgpOwogICAgfQoKICB9CiAgQm9keS5pZENvdW50ZXIgPSAwOwogIEJvZHkuQ09MTElERV9FVkVOVF9OQU1FID0gJ2NvbGxpZGUnOwogIEJvZHkuRFlOQU1JQyA9IEJPRFlfVFlQRVMuRFlOQU1JQzsKICBCb2R5LlNUQVRJQyA9IEJPRFlfVFlQRVMuU1RBVElDOwogIEJvZHkuS0lORU1BVElDID0gQk9EWV9UWVBFUy5LSU5FTUFUSUM7CiAgQm9keS5BV0FLRSA9IEJPRFlfU0xFRVBfU1RBVEVTLkFXQUtFOwogIEJvZHkuU0xFRVBZID0gQk9EWV9TTEVFUF9TVEFURVMuU0xFRVBZOwogIEJvZHkuU0xFRVBJTkcgPSBCT0RZX1NMRUVQX1NUQVRFUy5TTEVFUElORzsKICBCb2R5Lndha2V1cEV2ZW50ID0gewogICAgdHlwZTogJ3dha2V1cCcKICB9OwogIEJvZHkuc2xlZXB5RXZlbnQgPSB7CiAgICB0eXBlOiAnc2xlZXB5JwogIH07CiAgQm9keS5zbGVlcEV2ZW50ID0gewogICAgdHlwZTogJ3NsZWVwJwogIH07CiAgY29uc3QgdG1wVmVjID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBRdWF0ID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCB1cGRhdGVBQUJCX3NoYXBlQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgdWl3X20xID0gbmV3IE1hdDMoKTsKICBjb25zdCB1aXdfbTIgPSBuZXcgTWF0MygpOwogIG5ldyBNYXQzKCk7CiAgY29uc3QgQm9keV9hcHBseUZvcmNlX3JvdEZvcmNlID0gbmV3IFZlYzMoKTsKICBjb25zdCBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlID0gbmV3IFZlYzMoKTsKICBjb25zdCBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlJbXB1bHNlX3ZlbG8gPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlJbXB1bHNlX3JvdFZlbG8gPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEltcHVsc2Vfd29ybGRJbXB1bHNlID0gbmV3IFZlYzMoKTsKICBjb25zdCBCb2R5X2FwcGx5TG9jYWxJbXB1bHNlX3JlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfdXBkYXRlTWFzc1Byb3BlcnRpZXNfaGFsZkV4dGVudHMgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBicm9hZHBoYXNlIGltcGxlbWVudGF0aW9ucwogICAqIEBhdXRob3Igc2NodGVwcGUKICAgKi8KICBjbGFzcyBCcm9hZHBoYXNlIHsKICAgIC8qKgogICAgICogVGhlIHdvcmxkIHRvIHNlYXJjaCBmb3IgY29sbGlzaW9ucyBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIHRydWUsIHRoZSBicm9hZHBoYXNlIHVzZXMgYm91bmRpbmcgYm94ZXMgZm9yIGludGVyc2VjdGlvbiB0ZXN0cywgZWxzZSBpdCB1c2VzIGJvdW5kaW5nIHNwaGVyZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byB0cnVlIGlmIHRoZSBvYmplY3RzIGluIHRoZSB3b3JsZCBtb3ZlZC4KICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLnVzZUJvdW5kaW5nQm94ZXMgPSBmYWxzZTsKICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgY29sbGlzaW9uIHBhaXJzIGZyb20gdGhlIHdvcmxkCiAgICAgKiBAcGFyYW0gd29ybGQgVGhlIHdvcmxkIHRvIHNlYXJjaCBpbgogICAgICogQHBhcmFtIHAxIEVtcHR5IGFycmF5IHRvIGJlIGZpbGxlZCB3aXRoIGJvZHkgb2JqZWN0cwogICAgICogQHBhcmFtIHAyIEVtcHR5IGFycmF5IHRvIGJlIGZpbGxlZCB3aXRoIGJvZHkgb2JqZWN0cwogICAgICovCgoKICAgIGNvbGxpc2lvblBhaXJzKHdvcmxkLCBwMSwgcDIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb2xsaXNpb25QYWlycyBub3QgaW1wbGVtZW50ZWQgZm9yIHRoaXMgQnJvYWRQaGFzZSBjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSBib2R5IHBhaXIgbmVlZHMgdG8gYmUgaW50ZXJzZWN0aW9uIHRlc3RlZCBhdCBhbGwuCiAgICAgKi8KCgogICAgbmVlZEJyb2FkcGhhc2VDb2xsaXNpb24oYm9keUEsIGJvZHlCKSB7CiAgICAgIC8vIENoZWNrIGNvbGxpc2lvbiBmaWx0ZXIgbWFza3MKICAgICAgaWYgKChib2R5QS5jb2xsaXNpb25GaWx0ZXJHcm91cCAmIGJvZHlCLmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5Qi5jb2xsaXNpb25GaWx0ZXJHcm91cCAmIGJvZHlBLmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9IC8vIENoZWNrIHR5cGVzCgoKICAgICAgaWYgKCgoYm9keUEudHlwZSAmIEJvZHkuU1RBVElDKSAhPT0gMCB8fCBib2R5QS5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSAmJiAoKGJvZHlCLnR5cGUgJiBCb2R5LlNUQVRJQykgIT09IDAgfHwgYm9keUIuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykpIHsKICAgICAgICAvLyBCb3RoIGJvZGllcyBhcmUgc3RhdGljIG9yIHNsZWVwaW5nLiBTa2lwLgogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZGluZyB2b2x1bWVzIG9mIHR3byBib2RpZXMgaW50ZXJzZWN0LgogICAgICovCgoKICAgIGludGVyc2VjdGlvblRlc3QoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMikgewogICAgICBpZiAodGhpcy51c2VCb3VuZGluZ0JveGVzKSB7CiAgICAgICAgdGhpcy5kb0JvdW5kaW5nQm94QnJvYWRwaGFzZShib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmRvQm91bmRpbmdTcGhlcmVCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZGluZyBzcGhlcmVzIG9mIHR3byBib2RpZXMgYXJlIGludGVyc2VjdGluZy4KICAgICAqIEBwYXJhbSBwYWlyczEgYm9keUEgaXMgYXBwZW5kZWQgdG8gdGhpcyBhcnJheSBpZiBpbnRlcnNlY3Rpb24KICAgICAqIEBwYXJhbSBwYWlyczIgYm9keUIgaXMgYXBwZW5kZWQgdG8gdGhpcyBhcnJheSBpZiBpbnRlcnNlY3Rpb24KICAgICAqLwoKCiAgICBkb0JvdW5kaW5nU3BoZXJlQnJvYWRwaGFzZShib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IHIgPSBCcm9hZHBoYXNlX2NvbGxpc2lvblBhaXJzX3I7CiAgICAgIGJvZHlCLnBvc2l0aW9uLnZzdWIoYm9keUEucG9zaXRpb24sIHIpOwogICAgICBjb25zdCBib3VuZGluZ1JhZGl1c1N1bTIgPSAoYm9keUEuYm91bmRpbmdSYWRpdXMgKyBib2R5Qi5ib3VuZGluZ1JhZGl1cykgKiogMjsKICAgICAgY29uc3Qgbm9ybTIgPSByLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgIGlmIChub3JtMiA8IGJvdW5kaW5nUmFkaXVzU3VtMikgewogICAgICAgIHBhaXJzMS5wdXNoKGJvZHlBKTsKICAgICAgICBwYWlyczIucHVzaChib2R5Qik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIGJveGVzIG9mIHR3byBib2RpZXMgYXJlIGludGVyc2VjdGluZy4KICAgICAqLwoKCiAgICBkb0JvdW5kaW5nQm94QnJvYWRwaGFzZShib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGlmIChib2R5QS5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICBib2R5QS51cGRhdGVBQUJCKCk7CiAgICAgIH0KCiAgICAgIGlmIChib2R5Qi5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICBib2R5Qi51cGRhdGVBQUJCKCk7CiAgICAgIH0gLy8gQ2hlY2sgQUFCQiAvIEFBQkIKCgogICAgICBpZiAoYm9keUEuYWFiYi5vdmVybGFwcyhib2R5Qi5hYWJiKSkgewogICAgICAgIHBhaXJzMS5wdXNoKGJvZHlBKTsKICAgICAgICBwYWlyczIucHVzaChib2R5Qik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBkdXBsaWNhdGUgcGFpcnMgZnJvbSB0aGUgcGFpciBhcnJheXMuCiAgICAgKi8KCgogICAgbWFrZVBhaXJzVW5pcXVlKHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IHQgPSBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wOwogICAgICBjb25zdCBwMSA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxOwogICAgICBjb25zdCBwMiA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AyOwogICAgICBjb25zdCBOID0gcGFpcnMxLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBwMVtpXSA9IHBhaXJzMVtpXTsKICAgICAgICBwMltpXSA9IHBhaXJzMltpXTsKICAgICAgfQoKICAgICAgcGFpcnMxLmxlbmd0aCA9IDA7CiAgICAgIHBhaXJzMi5sZW5ndGggPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGlkMSA9IHAxW2ldLmlkOwogICAgICAgIGNvbnN0IGlkMiA9IHAyW2ldLmlkOwogICAgICAgIGNvbnN0IGtleSA9IGlkMSA8IGlkMiA/IGAke2lkMX0sJHtpZDJ9YCA6IGAke2lkMn0sJHtpZDF9YDsKICAgICAgICB0W2tleV0gPSBpOwogICAgICAgIHQua2V5cy5wdXNoKGtleSk7CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0LmtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBrZXkgPSB0LmtleXMucG9wKCk7CiAgICAgICAgY29uc3QgcGFpckluZGV4ID0gdFtrZXldOwogICAgICAgIHBhaXJzMS5wdXNoKHAxW3BhaXJJbmRleF0pOwogICAgICAgIHBhaXJzMi5wdXNoKHAyW3BhaXJJbmRleF0pOwogICAgICAgIGRlbGV0ZSB0W2tleV07CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVG8gYmUgaW1wbGVtZW50ZWQgYnkgc3ViY2Fzc2VzCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHt9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZGluZyBzcGhlcmVzIG9mIHR3byBib2RpZXMgb3ZlcmxhcC4KICAgICAqLwoKCiAgICBzdGF0aWMgYm91bmRpbmdTcGhlcmVDaGVjayhib2R5QSwgYm9keUIpIHsKICAgICAgY29uc3QgZGlzdCA9IG5ldyBWZWMzKCk7IC8vIGJzY19kaXN0OwoKICAgICAgYm9keUEucG9zaXRpb24udnN1Yihib2R5Qi5wb3NpdGlvbiwgZGlzdCk7CiAgICAgIGNvbnN0IHNhID0gYm9keUEuc2hhcGVzWzBdOwogICAgICBjb25zdCBzYiA9IGJvZHlCLnNoYXBlc1swXTsKICAgICAgcmV0dXJuIE1hdGgucG93KHNhLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2IuYm91bmRpbmdTcGhlcmVSYWRpdXMsIDIpID4gZGlzdC5sZW5ndGhTcXVhcmVkKCk7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYWxsIHRoZSBib2RpZXMgd2l0aGluIHRoZSBBQUJCLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGNvbnNvbGUud2FybignLmFhYmJRdWVyeSBpcyBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBCcm9hZHBoYXNlIHN1YmNsYXNzLicpOwogICAgICByZXR1cm4gW107CiAgICB9CgogIH0gLy8gVGVtcCBvYmplY3RzCgogIGNvbnN0IEJyb2FkcGhhc2VfY29sbGlzaW9uUGFpcnNfciA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgUXVhdGVybmlvbigpOwogIG5ldyBWZWMzKCk7CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfdGVtcCA9IHsKICAgIGtleXM6IFtdCiAgfTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV9wMSA9IFtdOwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AyID0gW107CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CgogIC8qKgogICAqIE5haXZlIGJyb2FkcGhhc2UgaW1wbGVtZW50YXRpb24sIHVzZWQgaW4gbGFjayBvZiBiZXR0ZXIgb25lcy4KICAgKgogICAqIFRoZSBuYWl2ZSBicm9hZHBoYXNlIGxvb2tzIGF0IGFsbCBwb3NzaWJsZSBwYWlycyB3aXRob3V0IHJlc3RyaWN0aW9uLCB0aGVyZWZvcmUgaXQgaGFzIGNvbXBsZXhpdHkgTl4yIF8od2hpY2ggaXMgYmFkKV8KICAgKi8KICBjbGFzcyBOYWl2ZUJyb2FkcGhhc2UgZXh0ZW5kcyBCcm9hZHBoYXNlIHsKICAgIC8qKgogICAgICogQHRvZG8gUmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbGwgdGhlIGNvbGxpc2lvbiBwYWlycyBpbiB0aGUgcGh5c2ljcyB3b3JsZAogICAgICovCgoKICAgIGNvbGxpc2lvblBhaXJzKHdvcmxkLCBwYWlyczEsIHBhaXJzMikgewogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IG4gPSBib2RpZXMubGVuZ3RoOwogICAgICBsZXQgYmk7CiAgICAgIGxldCBiajsgLy8gTmFpdmUgTl4yIGZ0dyEKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBuOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gaTsgaisrKSB7CiAgICAgICAgICBiaSA9IGJvZGllc1tpXTsKICAgICAgICAgIGJqID0gYm9kaWVzW2pdOwoKICAgICAgICAgIGlmICghdGhpcy5uZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihiaSwgYmopKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuaW50ZXJzZWN0aW9uVGVzdChiaSwgYmosIHBhaXJzMSwgcGFpcnMyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gYW4gQUFCQi4KICAgICAqIEBwYXJhbSByZXN1bHQgQW4gYXJyYXkgdG8gc3RvcmUgcmVzdWx0aW5nIGJvZGllcyBpbi4KICAgICAqLwoKCiAgICBhYWJiUXVlcnkod29ybGQsIGFhYmIsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3JsZC5ib2RpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gd29ybGQuYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYi5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIGIudXBkYXRlQUFCQigpOwogICAgICAgIH0gLy8gVWdseSBoYWNrIHVudGlsIEJvZHkgZ2V0cyBhYWJiCgoKICAgICAgICBpZiAoYi5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICByZXN1bHQucHVzaChiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogIH0KCiAgLyoqCiAgICogU3RvcmFnZSBmb3IgUmF5IGNhc3RpbmcgZGF0YQogICAqLwogIGNsYXNzIFJheWNhc3RSZXN1bHQgewogICAgLyoqCiAgICAgKiByYXlGcm9tV29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogcmF5VG9Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBoaXROb3JtYWxXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBoaXRQb2ludFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhhc0hpdAogICAgICovCgogICAgLyoqCiAgICAgKiBzaGFwZQogICAgICovCgogICAgLyoqCiAgICAgKiBib2R5CiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbmRleCBvZiB0aGUgaGl0IHRyaWFuZ2xlLCBpZiB0aGUgaGl0IHNoYXBlIHdhcyBhIHRyaW1lc2gKICAgICAqLwoKICAgIC8qKgogICAgICogRGlzdGFuY2UgdG8gdGhlIGhpdC4gV2lsbCBiZSBzZXQgdG8gLTEgaWYgdGhlcmUgd2FzIG5vIGhpdAogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgcmF5IHNob3VsZCBzdG9wIHRyYXZlcnNpbmcgdGhlIGJvZGllcwogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJheVRvV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhpdE5vcm1hbFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5oYXNIaXQgPSBmYWxzZTsKICAgICAgdGhpcy5zaGFwZSA9IG51bGw7CiAgICAgIHRoaXMuYm9keSA9IG51bGw7CiAgICAgIHRoaXMuaGl0RmFjZUluZGV4ID0gLTE7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSAtMTsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIFJlc2V0IGFsbCByZXN1bHQgZGF0YS4KICAgICAqLwoKCiAgICByZXNldCgpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLnJheVRvV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhpdE5vcm1hbFdvcmxkLnNldFplcm8oKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkLnNldFplcm8oKTsKICAgICAgdGhpcy5oYXNIaXQgPSBmYWxzZTsKICAgICAgdGhpcy5zaGFwZSA9IG51bGw7CiAgICAgIHRoaXMuYm9keSA9IG51bGw7CiAgICAgIHRoaXMuaGl0RmFjZUluZGV4ID0gLTE7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSAtMTsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIGFib3J0CiAgICAgKi8KCgogICAgYWJvcnQoKSB7CiAgICAgIHRoaXMuc2hvdWxkU3RvcCA9IHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFNldCByZXN1bHQgZGF0YS4KICAgICAqLwoKCiAgICBzZXQocmF5RnJvbVdvcmxkLCByYXlUb1dvcmxkLCBoaXROb3JtYWxXb3JsZCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKSB7CiAgICAgIHRoaXMucmF5RnJvbVdvcmxkLmNvcHkocmF5RnJvbVdvcmxkKTsKICAgICAgdGhpcy5yYXlUb1dvcmxkLmNvcHkocmF5VG9Xb3JsZCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQuY29weShoaXROb3JtYWxXb3JsZCk7CiAgICAgIHRoaXMuaGl0UG9pbnRXb3JsZC5jb3B5KGhpdFBvaW50V29ybGQpOwogICAgICB0aGlzLnNoYXBlID0gc2hhcGU7CiAgICAgIHRoaXMuYm9keSA9IGJvZHk7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgIH0KCiAgfQoKICBsZXQgX1NoYXBlJHR5cGVzJFNQSEVSRSwgX1NoYXBlJHR5cGVzJFBMQU5FLCBfU2hhcGUkdHlwZXMkQk9YLCBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIsIF9TaGFwZSR0eXBlcyRDT05WRVhQTywgX1NoYXBlJHR5cGVzJEhFSUdIVEZJLCBfU2hhcGUkdHlwZXMkVFJJTUVTSDsKCiAgLyoqCiAgICogUkFZX01PREVTCiAgICovCiAgY29uc3QgUkFZX01PREVTID0gewogICAgLyoqIENMT1NFU1QgKi8KICAgIENMT1NFU1Q6IDEsCgogICAgLyoqIEFOWSAqLwogICAgQU5ZOiAyLAoKICAgIC8qKiBBTEwgKi8KICAgIEFMTDogNAogIH07CiAgLyoqCiAgICogUmF5TW9kZQogICAqLwoKICBfU2hhcGUkdHlwZXMkU1BIRVJFID0gU2hhcGUudHlwZXMuU1BIRVJFOwogIF9TaGFwZSR0eXBlcyRQTEFORSA9IFNoYXBlLnR5cGVzLlBMQU5FOwogIF9TaGFwZSR0eXBlcyRCT1ggPSBTaGFwZS50eXBlcy5CT1g7CiAgX1NoYXBlJHR5cGVzJENZTElOREVSID0gU2hhcGUudHlwZXMuQ1lMSU5ERVI7CiAgX1NoYXBlJHR5cGVzJENPTlZFWFBPID0gU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTjsKICBfU2hhcGUkdHlwZXMkSEVJR0hURkkgPSBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRDsKICBfU2hhcGUkdHlwZXMkVFJJTUVTSCA9IFNoYXBlLnR5cGVzLlRSSU1FU0g7CgogIC8qKgogICAqIEEgbGluZSBpbiAzRCBzcGFjZSB0aGF0IGludGVyc2VjdHMgYm9kaWVzIGFuZCByZXR1cm4gcG9pbnRzLgogICAqLwogIGNsYXNzIFJheSB7CiAgICAvKioKICAgICAqIGZyb20KICAgICAqLwoKICAgIC8qKgogICAgICogdG8KICAgICAqLwoKICAgIC8qKgogICAgICogZGlyZWN0aW9uCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBwcmVjaXNpb24gb2YgdGhlIHJheS4gVXNlZCB3aGVuIGNoZWNraW5nIHBhcmFsbGVsaXR5IGV0Yy4KICAgICAqIEBkZWZhdWx0IDAuMDAwMQogICAgICovCgogICAgLyoqCiAgICAgKiBTZXQgdG8gYGZhbHNlYCBpZiB5b3UgZG9uJ3Qgd2FudCB0aGUgUmF5IHRvIHRha2UgYGNvbGxpc2lvblJlc3BvbnNlYCBmbGFncyBpbnRvIGFjY291bnQgb24gYm9kaWVzIGFuZCBzaGFwZXMuCiAgICAgKiBAZGVmYXVsdCB0cnVlCiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHNldCB0byBgdHJ1ZWAsIHRoZSByYXkgc2tpcHMgYW55IGhpdHMgd2l0aCBub3JtYWwuZG90KHJheURpcmVjdGlvbikgPCAwLgogICAgICogQGRlZmF1bHQgZmFsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogY29sbGlzaW9uRmlsdGVyTWFzawogICAgICogQGRlZmF1bHQgLTEKICAgICAqLwoKICAgIC8qKgogICAgICogY29sbGlzaW9uRmlsdGVyR3JvdXAKICAgICAqIEBkZWZhdWx0IC0xCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbnRlcnNlY3Rpb24gbW9kZS4gU2hvdWxkIGJlIFJheS5BTlksIFJheS5BTEwgb3IgUmF5LkNMT1NFU1QuCiAgICAgKiBAZGVmYXVsdCBSQVkuQU5ZCiAgICAgKi8KCiAgICAvKioKICAgICAqIEN1cnJlbnQgcmVzdWx0IG9iamVjdC4KICAgICAqLwoKICAgIC8qKgogICAgICogV2lsbCBiZSBzZXQgdG8gYHRydWVgIGR1cmluZyBpbnRlcnNlY3RXb3JsZCgpIGlmIHRoZSByYXkgaGl0IGFueXRoaW5nLgogICAgICovCgogICAgLyoqCiAgICAgKiBVc2VyLXByb3ZpZGVkIHJlc3VsdCBjYWxsYmFjay4gV2lsbCBiZSB1c2VkIGlmIG1vZGUgaXMgUmF5LkFMTC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ0xPU0VTVAogICAgICovCgogICAgLyoqCiAgICAgKiBBTlkKICAgICAqLwoKICAgIC8qKgogICAgICogQUxMCiAgICAgKi8KICAgIGdldCBbX1NoYXBlJHR5cGVzJFNQSEVSRV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RTcGhlcmU7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkUExBTkVdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0UGxhbmU7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkQk9YXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdEJveDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRDWUxJTkRFUl0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkQ09OVkVYUE9dKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Q29udmV4OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJEhFSUdIVEZJXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdEhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJFRSSU1FU0hdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0VHJpbWVzaDsKICAgIH0KCiAgICBjb25zdHJ1Y3Rvcihmcm9tLCB0bykgewogICAgICBpZiAoZnJvbSA9PT0gdm9pZCAwKSB7CiAgICAgICAgZnJvbSA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmICh0byA9PT0gdm9pZCAwKSB7CiAgICAgICAgdG8gPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLmZyb20gPSBmcm9tLmNsb25lKCk7CiAgICAgIHRoaXMudG8gPSB0by5jbG9uZSgpOwogICAgICB0aGlzLmRpcmVjdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucHJlY2lzaW9uID0gMC4wMDAxOwogICAgICB0aGlzLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgPSB0cnVlOwogICAgICB0aGlzLnNraXBCYWNrZmFjZXMgPSBmYWxzZTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSAtMTsKICAgICAgdGhpcy5tb2RlID0gUmF5LkFOWTsKICAgICAgdGhpcy5yZXN1bHQgPSBuZXcgUmF5Y2FzdFJlc3VsdCgpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwoKICAgICAgdGhpcy5jYWxsYmFjayA9IHJlc3VsdCA9PiB7fTsKICAgIH0KICAgIC8qKgogICAgICogRG8gaXRlcnNlY3Rpb24gYWdhaW5zdCBhbGwgYm9kaWVzIGluIHRoZSBnaXZlbiBXb3JsZC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgcmF5IGhpdCBhbnl0aGluZywgb3RoZXJ3aXNlIGZhbHNlLgogICAgICovCgoKICAgIGludGVyc2VjdFdvcmxkKHdvcmxkLCBvcHRpb25zKSB7CiAgICAgIHRoaXMubW9kZSA9IG9wdGlvbnMubW9kZSB8fCBSYXkuQU5ZOwogICAgICB0aGlzLnJlc3VsdCA9IG9wdGlvbnMucmVzdWx0IHx8IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9ICEhb3B0aW9ucy5za2lwQmFja2ZhY2VzOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA6IC0xOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyR3JvdXAgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA6IC0xOwogICAgICB0aGlzLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgPSB0eXBlb2Ygb3B0aW9ucy5jaGVja0NvbGxpc2lvblJlc3BvbnNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CgogICAgICBpZiAob3B0aW9ucy5mcm9tKSB7CiAgICAgICAgdGhpcy5mcm9tLmNvcHkob3B0aW9ucy5mcm9tKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMudG8pIHsKICAgICAgICB0aGlzLnRvLmNvcHkob3B0aW9ucy50byk7CiAgICAgIH0KCiAgICAgIHRoaXMuY2FsbGJhY2sgPSBvcHRpb25zLmNhbGxiYWNrIHx8ICgoKSA9PiB7fSk7CgogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnJlc3VsdC5yZXNldCgpOwogICAgICB0aGlzLnVwZGF0ZURpcmVjdGlvbigpOwogICAgICB0aGlzLmdldEFBQkIodG1wQUFCQiQxKTsKICAgICAgdG1wQXJyYXkubGVuZ3RoID0gMDsKICAgICAgd29ybGQuYnJvYWRwaGFzZS5hYWJiUXVlcnkod29ybGQsIHRtcEFBQkIkMSwgdG1wQXJyYXkpOwogICAgICB0aGlzLmludGVyc2VjdEJvZGllcyh0bXBBcnJheSk7CiAgICAgIHJldHVybiB0aGlzLmhhc0hpdDsKICAgIH0KICAgIC8qKgogICAgICogU2hvb3QgYSByYXkgYXQgYSBib2R5LCBnZXQgYmFjayBpbmZvcm1hdGlvbiBhYm91dCB0aGUgaGl0LgogICAgICogQGRlcHJlY2F0ZWQgQHBhcmFtIHJlc3VsdCBzZXQgdGhlIHJlc3VsdCBwcm9wZXJ0eSBvZiB0aGUgUmF5IGluc3RlYWQuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0Qm9keShib2R5LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgPSB0aGlzLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2U7CgogICAgICBpZiAoY2hlY2tDb2xsaXNpb25SZXNwb25zZSAmJiAhYm9keS5jb2xsaXNpb25SZXNwb25zZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCh0aGlzLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCB8fCAoYm9keS5jb2xsaXNpb25GaWx0ZXJHcm91cCAmIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHhpID0gaW50ZXJzZWN0Qm9keV94aTsKICAgICAgY29uc3QgcWkgPSBpbnRlcnNlY3RCb2R5X3FpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSBib2R5LnNoYXBlcy5sZW5ndGg7IGkgPCBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IGJvZHkuc2hhcGVzW2ldOwoKICAgICAgICBpZiAoY2hlY2tDb2xsaXNpb25SZXNwb25zZSAmJiAhc2hhcGUuY29sbGlzaW9uUmVzcG9uc2UpIHsKICAgICAgICAgIGNvbnRpbnVlOyAvLyBTa2lwCiAgICAgICAgfQoKICAgICAgICBib2R5LnF1YXRlcm5pb24ubXVsdChib2R5LnNoYXBlT3JpZW50YXRpb25zW2ldLCBxaSk7CiAgICAgICAgYm9keS5xdWF0ZXJuaW9uLnZtdWx0KGJvZHkuc2hhcGVPZmZzZXRzW2ldLCB4aSk7CiAgICAgICAgeGkudmFkZChib2R5LnBvc2l0aW9uLCB4aSk7CiAgICAgICAgdGhpcy5pbnRlcnNlY3RTaGFwZShzaGFwZSwgcWksIHhpLCBib2R5KTsKCiAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTaG9vdCBhIHJheSBhdCBhbiBhcnJheSBib2RpZXMsIGdldCBiYWNrIGluZm9ybWF0aW9uIGFib3V0IHRoZSBoaXQuCiAgICAgKiBAcGFyYW0gYm9kaWVzIEFuIGFycmF5IG9mIEJvZHkgb2JqZWN0cy4KICAgICAqIEBkZXByZWNhdGVkIEBwYXJhbSByZXN1bHQgc2V0IHRoZSByZXN1bHQgcHJvcGVydHkgb2YgdGhlIFJheSBpbnN0ZWFkLgogICAgICoKICAgICAqLwoKCiAgICBpbnRlcnNlY3RCb2RpZXMoYm9kaWVzLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gYm9kaWVzLmxlbmd0aDsgIXRoaXMucmVzdWx0LnNob3VsZFN0b3AgJiYgaSA8IGw7IGkrKykgewogICAgICAgIHRoaXMuaW50ZXJzZWN0Qm9keShib2RpZXNbaV0pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZXMgdGhlIGRpcmVjdGlvbiB2ZWN0b3IuCiAgICAgKi8KCgogICAgdXBkYXRlRGlyZWN0aW9uKCkgewogICAgICB0aGlzLnRvLnZzdWIodGhpcy5mcm9tLCB0aGlzLmRpcmVjdGlvbik7CiAgICAgIHRoaXMuZGlyZWN0aW9uLm5vcm1hbGl6ZSgpOwogICAgfQoKICAgIGludGVyc2VjdFNoYXBlKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOyAvLyBDaGVja2luZyBib3VuZGluZ1NwaGVyZQoKICAgICAgY29uc3QgZGlzdGFuY2UgPSBkaXN0YW5jZUZyb21JbnRlcnNlY3Rpb24oZnJvbSwgdGhpcy5kaXJlY3Rpb24sIHBvc2l0aW9uKTsKCiAgICAgIGlmIChkaXN0YW5jZSA+IHNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBpbnRlcnNlY3RNZXRob2QgPSB0aGlzW3NoYXBlLnR5cGVdOwoKICAgICAgaWYgKGludGVyc2VjdE1ldGhvZCkgewogICAgICAgIGludGVyc2VjdE1ldGhvZC5jYWxsKHRoaXMsIHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgc2hhcGUpOwogICAgICB9CiAgICB9CgogICAgX2ludGVyc2VjdEJveChib3gsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXgoYm94LmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpOwogICAgfQoKICAgIF9pbnRlcnNlY3RQbGFuZShzaGFwZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsgLy8gR2V0IHBsYW5lIG5vcm1hbAoKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBuZXcgVmVjMygwLCAwLCAxKTsKICAgICAgcXVhdC52bXVsdCh3b3JsZE5vcm1hbCwgd29ybGROb3JtYWwpOwogICAgICBjb25zdCBsZW4gPSBuZXcgVmVjMygpOwogICAgICBmcm9tLnZzdWIocG9zaXRpb24sIGxlbik7CiAgICAgIGNvbnN0IHBsYW5lVG9Gcm9tID0gbGVuLmRvdCh3b3JsZE5vcm1hbCk7CiAgICAgIHRvLnZzdWIocG9zaXRpb24sIGxlbik7CiAgICAgIGNvbnN0IHBsYW5lVG9UbyA9IGxlbi5kb3Qod29ybGROb3JtYWwpOwoKICAgICAgaWYgKHBsYW5lVG9Gcm9tICogcGxhbmVUb1RvID4gMCkgewogICAgICAgIC8vICJmcm9tIiBhbmQgInRvIiBhcmUgb24gdGhlIHNhbWUgc2lkZSBvZiB0aGUgcGxhbmUuLi4gYmFpbCBvdXQKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChmcm9tLmRpc3RhbmNlVG8odG8pIDwgcGxhbmVUb0Zyb20pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IG5fZG90X2RpciA9IHdvcmxkTm9ybWFsLmRvdChkaXJlY3Rpb24pOwoKICAgICAgaWYgKE1hdGguYWJzKG5fZG90X2RpcikgPCB0aGlzLnByZWNpc2lvbikgewogICAgICAgIC8vIE5vIGludGVyc2VjdGlvbgogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgcGxhbmVQb2ludFRvRnJvbSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGRpcl9zY2FsZWRfd2l0aF90ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaGl0UG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIGZyb20udnN1Yihwb3NpdGlvbiwgcGxhbmVQb2ludFRvRnJvbSk7CiAgICAgIGNvbnN0IHQgPSAtd29ybGROb3JtYWwuZG90KHBsYW5lUG9pbnRUb0Zyb20pIC8gbl9kb3RfZGlyOwogICAgICBkaXJlY3Rpb24uc2NhbGUodCwgZGlyX3NjYWxlZF93aXRoX3QpOwogICAgICBmcm9tLnZhZGQoZGlyX3NjYWxlZF93aXRoX3QsIGhpdFBvaW50V29ybGQpOwogICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbih3b3JsZE5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgLTEpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHdvcmxkIEFBQkIgb2YgdGhlIHJheS4KICAgICAqLwoKCiAgICBnZXRBQUJCKGFhYmIpIHsKICAgICAgY29uc3QgewogICAgICAgIGxvd2VyQm91bmQsCiAgICAgICAgdXBwZXJCb3VuZAogICAgICB9ID0gYWFiYjsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBsb3dlckJvdW5kLnggPSBNYXRoLm1pbih0by54LCBmcm9tLngpOwogICAgICBsb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0by55LCBmcm9tLnkpOwogICAgICBsb3dlckJvdW5kLnogPSBNYXRoLm1pbih0by56LCBmcm9tLnopOwogICAgICB1cHBlckJvdW5kLnggPSBNYXRoLm1heCh0by54LCBmcm9tLngpOwogICAgICB1cHBlckJvdW5kLnkgPSBNYXRoLm1heCh0by55LCBmcm9tLnkpOwogICAgICB1cHBlckJvdW5kLnogPSBNYXRoLm1heCh0by56LCBmcm9tLnopOwogICAgfQoKICAgIF9pbnRlcnNlY3RIZWlnaHRmaWVsZChzaGFwZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgc2hhcGUuZGF0YTsKICAgICAgc2hhcGUuZWxlbWVudFNpemU7IC8vIENvbnZlcnQgdGhlIHJheSB0byBsb2NhbCBoZWlnaHRmaWVsZCBjb29yZGluYXRlcwoKICAgICAgY29uc3QgbG9jYWxSYXkgPSBpbnRlcnNlY3RIZWlnaHRmaWVsZF9sb2NhbFJheTsgLy9uZXcgUmF5KHRoaXMuZnJvbSwgdGhpcy50byk7CgogICAgICBsb2NhbFJheS5mcm9tLmNvcHkodGhpcy5mcm9tKTsKICAgICAgbG9jYWxSYXkudG8uY29weSh0aGlzLnRvKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBsb2NhbFJheS5mcm9tLCBsb2NhbFJheS5mcm9tKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBsb2NhbFJheS50bywgbG9jYWxSYXkudG8pOwogICAgICBsb2NhbFJheS51cGRhdGVEaXJlY3Rpb24oKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBjb25zdCBpbmRleCA9IGludGVyc2VjdEhlaWdodGZpZWxkX2luZGV4OwogICAgICBsZXQgaU1pblg7CiAgICAgIGxldCBpTWluWTsKICAgICAgbGV0IGlNYXhYOwogICAgICBsZXQgaU1heFk7IC8vIFNldCB0byBtYXgKCiAgICAgIGlNaW5YID0gaU1pblkgPSAwOwogICAgICBpTWF4WCA9IGlNYXhZID0gc2hhcGUuZGF0YS5sZW5ndGggLSAxOwogICAgICBjb25zdCBhYWJiID0gbmV3IEFBQkIoKTsKICAgICAgbG9jYWxSYXkuZ2V0QUFCQihhYWJiKTsKICAgICAgc2hhcGUuZ2V0SW5kZXhPZlBvc2l0aW9uKGFhYmIubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueSwgaW5kZXgsIHRydWUpOwogICAgICBpTWluWCA9IE1hdGgubWF4KGlNaW5YLCBpbmRleFswXSk7CiAgICAgIGlNaW5ZID0gTWF0aC5tYXgoaU1pblksIGluZGV4WzFdKTsKICAgICAgc2hhcGUuZ2V0SW5kZXhPZlBvc2l0aW9uKGFhYmIudXBwZXJCb3VuZC54LCBhYWJiLnVwcGVyQm91bmQueSwgaW5kZXgsIHRydWUpOwogICAgICBpTWF4WCA9IE1hdGgubWluKGlNYXhYLCBpbmRleFswXSArIDEpOwogICAgICBpTWF4WSA9IE1hdGgubWluKGlNYXhZLCBpbmRleFsxXSArIDEpOwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBzaGFwZS5nZXRBYWJiQXRJbmRleChpLCBqLCBhYWJiKTsKCiAgICAgICAgICBpZiAoIWFhYmIub3ZlcmxhcHNSYXkobG9jYWxSYXkpKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfSAvLyBMb3dlciB0cmlhbmdsZQoKCiAgICAgICAgICBzaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCBmYWxzZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIHNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIHRoaXMuX2ludGVyc2VjdENvbnZleChzaGFwZS5waWxsYXJDb252ZXgsIHF1YXQsIHdvcmxkUGlsbGFyT2Zmc2V0LCBib2R5LCByZXBvcnRlZFNoYXBlLCBpbnRlcnNlY3RDb252ZXhPcHRpb25zKTsKCiAgICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9IC8vIFVwcGVyIHRyaWFuZ2xlCgoKICAgICAgICAgIHNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIHRydWUpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBzaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICB0aGlzLl9pbnRlcnNlY3RDb252ZXgoc2hhcGUucGlsbGFyQ29udmV4LCBxdWF0LCB3b3JsZFBpbGxhck9mZnNldCwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgaW50ZXJzZWN0Q29udmV4T3B0aW9ucyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgX2ludGVyc2VjdFNwaGVyZShzcGhlcmUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlKSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgciA9IHNwaGVyZS5yYWRpdXM7CiAgICAgIGNvbnN0IGEgPSAodG8ueCAtIGZyb20ueCkgKiogMiArICh0by55IC0gZnJvbS55KSAqKiAyICsgKHRvLnogLSBmcm9tLnopICoqIDI7CiAgICAgIGNvbnN0IGIgPSAyICogKCh0by54IC0gZnJvbS54KSAqIChmcm9tLnggLSBwb3NpdGlvbi54KSArICh0by55IC0gZnJvbS55KSAqIChmcm9tLnkgLSBwb3NpdGlvbi55KSArICh0by56IC0gZnJvbS56KSAqIChmcm9tLnogLSBwb3NpdGlvbi56KSk7CiAgICAgIGNvbnN0IGMgPSAoZnJvbS54IC0gcG9zaXRpb24ueCkgKiogMiArIChmcm9tLnkgLSBwb3NpdGlvbi55KSAqKiAyICsgKGZyb20ueiAtIHBvc2l0aW9uLnopICoqIDIgLSByICoqIDI7CiAgICAgIGNvbnN0IGRlbHRhID0gYiAqKiAyIC0gNCAqIGEgKiBjOwogICAgICBjb25zdCBpbnRlcnNlY3Rpb25Qb2ludCA9IFJheV9pbnRlcnNlY3RTcGhlcmVfaW50ZXJzZWN0aW9uUG9pbnQ7CiAgICAgIGNvbnN0IG5vcm1hbCA9IFJheV9pbnRlcnNlY3RTcGhlcmVfbm9ybWFsOwoKICAgICAgaWYgKGRlbHRhIDwgMCkgewogICAgICAgIC8vIE5vIGludGVyc2VjdGlvbgogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIGlmIChkZWx0YSA9PT0gMCkgewogICAgICAgIC8vIHNpbmdsZSBpbnRlcnNlY3Rpb24gcG9pbnQKICAgICAgICBmcm9tLmxlcnAodG8sIGRlbHRhLCBpbnRlcnNlY3Rpb25Qb2ludCk7CiAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgdGhpcy5yZXBvcnRJbnRlcnNlY3Rpb24obm9ybWFsLCBpbnRlcnNlY3Rpb25Qb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgLTEpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGQxID0gKC1iIC0gTWF0aC5zcXJ0KGRlbHRhKSkgLyAoMiAqIGEpOwogICAgICAgIGNvbnN0IGQyID0gKC1iICsgTWF0aC5zcXJ0KGRlbHRhKSkgLyAoMiAqIGEpOwoKICAgICAgICBpZiAoZDEgPj0gMCAmJiBkMSA8PSAxKSB7CiAgICAgICAgICBmcm9tLmxlcnAodG8sIGQxLCBpbnRlcnNlY3Rpb25Qb2ludCk7CiAgICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICAgICAgdGhpcy5yZXBvcnRJbnRlcnNlY3Rpb24obm9ybWFsLCBpbnRlcnNlY3Rpb25Qb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgLTEpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChkMiA+PSAwICYmIGQyIDw9IDEpIHsKICAgICAgICAgIGZyb20ubGVycCh0bywgZDIsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgX2ludGVyc2VjdENvbnZleChzaGFwZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUsIG9wdGlvbnMpIHsKICAgICAgY29uc3Qgbm9ybWFsID0gaW50ZXJzZWN0Q29udmV4X25vcm1hbDsKICAgICAgY29uc3QgdmVjdG9yID0gaW50ZXJzZWN0Q29udmV4X3ZlY3RvcjsKICAgICAgY29uc3QgZmFjZUxpc3QgPSBvcHRpb25zICYmIG9wdGlvbnMuZmFjZUxpc3QgfHwgbnVsbDsgLy8gQ2hlY2tpbmcgZmFjZXMKCiAgICAgIGNvbnN0IGZhY2VzID0gc2hhcGUuZmFjZXM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gc2hhcGUudmVydGljZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSBzaGFwZS5mYWNlTm9ybWFsczsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZnJvbVRvRGlzdGFuY2UgPSBmcm9tLmRpc3RhbmNlVG8odG8pOwogICAgICBjb25zdCBOZmFjZXMgPSBmYWNlTGlzdCA/IGZhY2VMaXN0Lmxlbmd0aCA6IGZhY2VzLmxlbmd0aDsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7CgogICAgICBmb3IgKGxldCBqID0gMDsgIXJlc3VsdC5zaG91bGRTdG9wICYmIGogPCBOZmFjZXM7IGorKykgewogICAgICAgIGNvbnN0IGZpID0gZmFjZUxpc3QgPyBmYWNlTGlzdFtqXSA6IGo7CiAgICAgICAgY29uc3QgZmFjZSA9IGZhY2VzW2ZpXTsKICAgICAgICBjb25zdCBmYWNlTm9ybWFsID0gbm9ybWFsc1tmaV07CiAgICAgICAgY29uc3QgcSA9IHF1YXQ7CiAgICAgICAgY29uc3QgeCA9IHBvc2l0aW9uOyAvLyBkZXRlcm1pbmUgaWYgcmF5IGludGVyc2VjdHMgdGhlIHBsYW5lIG9mIHRoZSBmYWNlCiAgICAgICAgLy8gbm90ZTogdGhpcyB3b3JrcyByZWdhcmRsZXNzIG9mIHRoZSBkaXJlY3Rpb24gb2YgdGhlIGZhY2Ugbm9ybWFsCiAgICAgICAgLy8gR2V0IHBsYW5lIHBvaW50IGluIHdvcmxkIGNvb3JkaW5hdGVzLi4uCgogICAgICAgIHZlY3Rvci5jb3B5KHZlcnRpY2VzW2ZhY2VbMF1dKTsKICAgICAgICBxLnZtdWx0KHZlY3RvciwgdmVjdG9yKTsKICAgICAgICB2ZWN0b3IudmFkZCh4LCB2ZWN0b3IpOyAvLyAuLi5idXQgbWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgcmF5IGZyb20uIFdlJ2xsIGZpeCB0aGlzIGxhdGVyLgoKICAgICAgICB2ZWN0b3IudnN1Yihmcm9tLCB2ZWN0b3IpOyAvLyBHZXQgcGxhbmUgbm9ybWFsCgogICAgICAgIHEudm11bHQoZmFjZU5vcm1hbCwgbm9ybWFsKTsgLy8gSWYgdGhpcyBkb3QgcHJvZHVjdCBpcyBuZWdhdGl2ZSwgd2UgaGF2ZSBzb21ldGhpbmcgaW50ZXJlc3RpbmcKCiAgICAgICAgY29uc3QgZG90ID0gZGlyZWN0aW9uLmRvdChub3JtYWwpOyAvLyBCYWlsIG91dCBpZiByYXkgYW5kIHBsYW5lIGFyZSBwYXJhbGxlbAoKICAgICAgICBpZiAoTWF0aC5hYnMoZG90KSA8IHRoaXMucHJlY2lzaW9uKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIGNhbGMgZGlzdGFuY2UgdG8gcGxhbmUKCgogICAgICAgIGNvbnN0IHNjYWxhciA9IG5vcm1hbC5kb3QodmVjdG9yKSAvIGRvdDsgLy8gaWYgbmVnYXRpdmUgZGlzdGFuY2UsIHRoZW4gcGxhbmUgaXMgYmVoaW5kIHJheQoKICAgICAgICBpZiAoc2NhbGFyIDwgMCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyBpZiAoZG90IDwgMCkgewogICAgICAgIC8vIEludGVyc2VjdGlvbiBwb2ludCBpcyBmcm9tICsgZGlyZWN0aW9uICogc2NhbGFyCgoKICAgICAgICBkaXJlY3Rpb24uc2NhbGUoc2NhbGFyLCBpbnRlcnNlY3RQb2ludCk7CiAgICAgICAgaW50ZXJzZWN0UG9pbnQudmFkZChmcm9tLCBpbnRlcnNlY3RQb2ludCk7IC8vIGEgaXMgdGhlIHBvaW50IHdlIGNvbXBhcmUgcG9pbnRzIGIgYW5kIGMgd2l0aC4KCiAgICAgICAgYS5jb3B5KHZlcnRpY2VzW2ZhY2VbMF1dKTsKICAgICAgICBxLnZtdWx0KGEsIGEpOwogICAgICAgIHgudmFkZChhLCBhKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDE7ICFyZXN1bHQuc2hvdWxkU3RvcCAmJiBpIDwgZmFjZS5sZW5ndGggLSAxOyBpKyspIHsKICAgICAgICAgIC8vIFRyYW5zZm9ybSAzIHZlcnRpY2VzIHRvIHdvcmxkIGNvb3JkcwogICAgICAgICAgYi5jb3B5KHZlcnRpY2VzW2ZhY2VbaV1dKTsKICAgICAgICAgIGMuY29weSh2ZXJ0aWNlc1tmYWNlW2kgKyAxXV0pOwogICAgICAgICAgcS52bXVsdChiLCBiKTsKICAgICAgICAgIHEudm11bHQoYywgYyk7CiAgICAgICAgICB4LnZhZGQoYiwgYik7CiAgICAgICAgICB4LnZhZGQoYywgYyk7CiAgICAgICAgICBjb25zdCBkaXN0YW5jZSA9IGludGVyc2VjdFBvaW50LmRpc3RhbmNlVG8oZnJvbSk7CgogICAgICAgICAgaWYgKCEoUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYSwgYiwgYykgfHwgUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYiwgYSwgYykpIHx8IGRpc3RhbmNlID4gZnJvbVRvRGlzdGFuY2UpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5yZXBvcnRJbnRlcnNlY3Rpb24obm9ybWFsLCBpbnRlcnNlY3RQb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgZmkpOwogICAgICAgIH0gLy8gfQoKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAdG9kbyBPcHRpbWl6ZSBieSB0cmFuc2Zvcm1pbmcgdGhlIHdvcmxkIHRvIGxvY2FsIHNwYWNlIGZpcnN0LgogICAgICogQHRvZG8gVXNlIE9jdHJlZSBsb29rdXAKICAgICAqLwoKCiAgICBfaW50ZXJzZWN0VHJpbWVzaChtZXNoLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgb3B0aW9ucykgewogICAgICBjb25zdCBub3JtYWwgPSBpbnRlcnNlY3RUcmltZXNoX25vcm1hbDsKICAgICAgY29uc3QgdHJpYW5nbGVzID0gaW50ZXJzZWN0VHJpbWVzaF90cmlhbmdsZXM7CiAgICAgIGNvbnN0IHRyZWVUcmFuc2Zvcm0gPSBpbnRlcnNlY3RUcmltZXNoX3RyZWVUcmFuc2Zvcm07CiAgICAgIGNvbnN0IHZlY3RvciA9IGludGVyc2VjdENvbnZleF92ZWN0b3I7CiAgICAgIGNvbnN0IGxvY2FsRGlyZWN0aW9uID0gaW50ZXJzZWN0VHJpbWVzaF9sb2NhbERpcmVjdGlvbjsKICAgICAgY29uc3QgbG9jYWxGcm9tID0gaW50ZXJzZWN0VHJpbWVzaF9sb2NhbEZyb207CiAgICAgIGNvbnN0IGxvY2FsVG8gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsVG87CiAgICAgIGNvbnN0IHdvcmxkSW50ZXJzZWN0UG9pbnQgPSBpbnRlcnNlY3RUcmltZXNoX3dvcmxkSW50ZXJzZWN0UG9pbnQ7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gaW50ZXJzZWN0VHJpbWVzaF93b3JsZE5vcm1hbDsgLy8gQ2hlY2tpbmcgZmFjZXMKCiAgICAgIGNvbnN0IGluZGljZXMgPSBtZXNoLmluZGljZXM7CiAgICAgIG1lc2gudmVydGljZXM7IC8vIGNvbnN0IG5vcm1hbHMgPSBtZXNoLmZhY2VOb3JtYWxzCgogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOwogICAgICB0cmVlVHJhbnNmb3JtLnBvc2l0aW9uLmNvcHkocG9zaXRpb24pOwogICAgICB0cmVlVHJhbnNmb3JtLnF1YXRlcm5pb24uY29weShxdWF0KTsgLy8gVHJhbnNmb3JtIHJheSB0byBsb2NhbCBzcGFjZSEKCiAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGRpcmVjdGlvbiwgbG9jYWxEaXJlY3Rpb24pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGZyb20sIGxvY2FsRnJvbSk7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgdG8sIGxvY2FsVG8pOwogICAgICBsb2NhbFRvLnggKj0gbWVzaC5zY2FsZS54OwogICAgICBsb2NhbFRvLnkgKj0gbWVzaC5zY2FsZS55OwogICAgICBsb2NhbFRvLnogKj0gbWVzaC5zY2FsZS56OwogICAgICBsb2NhbEZyb20ueCAqPSBtZXNoLnNjYWxlLng7CiAgICAgIGxvY2FsRnJvbS55ICo9IG1lc2guc2NhbGUueTsKICAgICAgbG9jYWxGcm9tLnogKj0gbWVzaC5zY2FsZS56OwogICAgICBsb2NhbFRvLnZzdWIobG9jYWxGcm9tLCBsb2NhbERpcmVjdGlvbik7CiAgICAgIGxvY2FsRGlyZWN0aW9uLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBmcm9tVG9EaXN0YW5jZVNxdWFyZWQgPSBsb2NhbEZyb20uZGlzdGFuY2VTcXVhcmVkKGxvY2FsVG8pOwogICAgICBtZXNoLnRyZWUucmF5UXVlcnkodGhpcywgdHJlZVRyYW5zZm9ybSwgdHJpYW5nbGVzKTsKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOID0gdHJpYW5nbGVzLmxlbmd0aDsgIXRoaXMucmVzdWx0LnNob3VsZFN0b3AgJiYgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgdHJpYW5nbGVzSW5kZXggPSB0cmlhbmdsZXNbaV07CiAgICAgICAgbWVzaC5nZXROb3JtYWwodHJpYW5nbGVzSW5kZXgsIG5vcm1hbCk7IC8vIGRldGVybWluZSBpZiByYXkgaW50ZXJzZWN0cyB0aGUgcGxhbmUgb2YgdGhlIGZhY2UKICAgICAgICAvLyBub3RlOiB0aGlzIHdvcmtzIHJlZ2FyZGxlc3Mgb2YgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZmFjZSBub3JtYWwKICAgICAgICAvLyBHZXQgcGxhbmUgcG9pbnQgaW4gd29ybGQgY29vcmRpbmF0ZXMuLi4KCiAgICAgICAgbWVzaC5nZXRWZXJ0ZXgoaW5kaWNlc1t0cmlhbmdsZXNJbmRleCAqIDNdLCBhKTsgLy8gLi4uYnV0IG1ha2UgaXQgcmVsYXRpdmUgdG8gdGhlIHJheSBmcm9tLiBXZSdsbCBmaXggdGhpcyBsYXRlci4KCiAgICAgICAgYS52c3ViKGxvY2FsRnJvbSwgdmVjdG9yKTsgLy8gSWYgdGhpcyBkb3QgcHJvZHVjdCBpcyBuZWdhdGl2ZSwgd2UgaGF2ZSBzb21ldGhpbmcgaW50ZXJlc3RpbmcKCiAgICAgICAgY29uc3QgZG90ID0gbG9jYWxEaXJlY3Rpb24uZG90KG5vcm1hbCk7IC8vIEJhaWwgb3V0IGlmIHJheSBhbmQgcGxhbmUgYXJlIHBhcmFsbGVsCiAgICAgICAgLy8gaWYgKE1hdGguYWJzKCBkb3QgKSA8IHRoaXMucHJlY2lzaW9uKXsKICAgICAgICAvLyAgICAgY29udGludWU7CiAgICAgICAgLy8gfQogICAgICAgIC8vIGNhbGMgZGlzdGFuY2UgdG8gcGxhbmUKCiAgICAgICAgY29uc3Qgc2NhbGFyID0gbm9ybWFsLmRvdCh2ZWN0b3IpIC8gZG90OyAvLyBpZiBuZWdhdGl2ZSBkaXN0YW5jZSwgdGhlbiBwbGFuZSBpcyBiZWhpbmQgcmF5CgogICAgICAgIGlmIChzY2FsYXIgPCAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIEludGVyc2VjdGlvbiBwb2ludCBpcyBmcm9tICsgZGlyZWN0aW9uICogc2NhbGFyCgoKICAgICAgICBsb2NhbERpcmVjdGlvbi5zY2FsZShzY2FsYXIsIGludGVyc2VjdFBvaW50KTsKICAgICAgICBpbnRlcnNlY3RQb2ludC52YWRkKGxvY2FsRnJvbSwgaW50ZXJzZWN0UG9pbnQpOyAvLyBHZXQgdHJpYW5nbGUgdmVydGljZXMKCiAgICAgICAgbWVzaC5nZXRWZXJ0ZXgoaW5kaWNlc1t0cmlhbmdsZXNJbmRleCAqIDMgKyAxXSwgYik7CiAgICAgICAgbWVzaC5nZXRWZXJ0ZXgoaW5kaWNlc1t0cmlhbmdsZXNJbmRleCAqIDMgKyAyXSwgYyk7CiAgICAgICAgY29uc3Qgc3F1YXJlZERpc3RhbmNlID0gaW50ZXJzZWN0UG9pbnQuZGlzdGFuY2VTcXVhcmVkKGxvY2FsRnJvbSk7CgogICAgICAgIGlmICghKFJheS5wb2ludEluVHJpYW5nbGUoaW50ZXJzZWN0UG9pbnQsIGIsIGEsIGMpIHx8IFJheS5wb2ludEluVHJpYW5nbGUoaW50ZXJzZWN0UG9pbnQsIGEsIGIsIGMpKSB8fCBzcXVhcmVkRGlzdGFuY2UgPiBmcm9tVG9EaXN0YW5jZVNxdWFyZWQpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gdHJhbnNmb3JtIGludGVyc2VjdHBvaW50IGFuZCBub3JtYWwgdG8gd29ybGQKCgogICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUocXVhdCwgbm9ybWFsLCB3b3JsZE5vcm1hbCk7CiAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBpbnRlcnNlY3RQb2ludCwgd29ybGRJbnRlcnNlY3RQb2ludCk7CiAgICAgICAgdGhpcy5yZXBvcnRJbnRlcnNlY3Rpb24od29ybGROb3JtYWwsIHdvcmxkSW50ZXJzZWN0UG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIHRyaWFuZ2xlc0luZGV4KTsKICAgICAgfQoKICAgICAgdHJpYW5nbGVzLmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgaW50ZXJzZWN0aW9ucyBzaG91bGQgY29udGludWUKICAgICAqLwoKCiAgICByZXBvcnRJbnRlcnNlY3Rpb24obm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgaGl0RmFjZUluZGV4KSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlzdGFuY2UgPSBmcm9tLmRpc3RhbmNlVG8oaGl0UG9pbnRXb3JsZCk7CiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0OyAvLyBTa2lwIGJhY2sgZmFjZXM/CgogICAgICBpZiAodGhpcy5za2lwQmFja2ZhY2VzICYmIG5vcm1hbC5kb3QodGhpcy5kaXJlY3Rpb24pID4gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgcmVzdWx0LmhpdEZhY2VJbmRleCA9IHR5cGVvZiBoaXRGYWNlSW5kZXggIT09ICd1bmRlZmluZWQnID8gaGl0RmFjZUluZGV4IDogLTE7CgogICAgICBzd2l0Y2ggKHRoaXMubW9kZSkgewogICAgICAgIGNhc2UgUmF5LkFMTDoKICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIHJlc3VsdC5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgdGhpcy5jYWxsYmFjayhyZXN1bHQpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgUmF5LkNMT1NFU1Q6CiAgICAgICAgICAvLyBTdG9yZSBpZiBjbG9zZXIgdGhhbiBjdXJyZW50IGNsb3Nlc3QKICAgICAgICAgIGlmIChkaXN0YW5jZSA8IHJlc3VsdC5kaXN0YW5jZSB8fCAhcmVzdWx0Lmhhc0hpdCkgewogICAgICAgICAgICB0aGlzLmhhc0hpdCA9IHRydWU7CiAgICAgICAgICAgIHJlc3VsdC5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgUmF5LkFOWToKICAgICAgICAgIC8vIFJlcG9ydCBhbmQgc3RvcC4KICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgIHJlc3VsdC5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgcmVzdWx0LnNob3VsZFN0b3AgPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQXMgcGVyICJCYXJ5Y2VudHJpYyBUZWNobmlxdWUiIGFzIG5hbWVkCiAgICAgKiB7QGxpbmsgaHR0cHM6Ly93d3cuYmxhY2twYXduLmNvbS90ZXh0cy9wb2ludGlucG9seS9kZWZhdWx0Lmh0bWwgaGVyZX0gYnV0IHdpdGhvdXQgdGhlIGRpdmlzaW9uCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50SW5UcmlhbmdsZShwLCBhLCBiLCBjKSB7CiAgICAgIGMudnN1YihhLCB2MCk7CiAgICAgIGIudnN1YihhLCB2MSk7CiAgICAgIHAudnN1YihhLCB2Mik7CiAgICAgIGNvbnN0IGRvdDAwID0gdjAuZG90KHYwKTsKICAgICAgY29uc3QgZG90MDEgPSB2MC5kb3QodjEpOwogICAgICBjb25zdCBkb3QwMiA9IHYwLmRvdCh2Mik7CiAgICAgIGNvbnN0IGRvdDExID0gdjEuZG90KHYxKTsKICAgICAgY29uc3QgZG90MTIgPSB2MS5kb3QodjIpOwogICAgICBsZXQgdTsKICAgICAgbGV0IHY7CiAgICAgIHJldHVybiAodSA9IGRvdDExICogZG90MDIgLSBkb3QwMSAqIGRvdDEyKSA+PSAwICYmICh2ID0gZG90MDAgKiBkb3QxMiAtIGRvdDAxICogZG90MDIpID49IDAgJiYgdSArIHYgPCBkb3QwMCAqIGRvdDExIC0gZG90MDEgKiBkb3QwMTsKICAgIH0KCiAgfQogIFJheS5DTE9TRVNUID0gUkFZX01PREVTLkNMT1NFU1Q7CiAgUmF5LkFOWSA9IFJBWV9NT0RFUy5BTlk7CiAgUmF5LkFMTCA9IFJBWV9NT0RFUy5BTEw7CiAgY29uc3QgdG1wQUFCQiQxID0gbmV3IEFBQkIoKTsKICBjb25zdCB0bXBBcnJheSA9IFtdOwogIGNvbnN0IHYxID0gbmV3IFZlYzMoKTsKICBjb25zdCB2MiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Qm9keV94aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Qm9keV9xaSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgaW50ZXJzZWN0UG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGMgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFJheWNhc3RSZXN1bHQoKTsKICBjb25zdCBpbnRlcnNlY3RDb252ZXhPcHRpb25zID0gewogICAgZmFjZUxpc3Q6IFswXQogIH07CiAgY29uc3Qgd29ybGRQaWxsYXJPZmZzZXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdEhlaWdodGZpZWxkX2xvY2FsUmF5ID0gbmV3IFJheSgpOwogIGNvbnN0IGludGVyc2VjdEhlaWdodGZpZWxkX2luZGV4ID0gW107CiAgY29uc3QgUmF5X2ludGVyc2VjdFNwaGVyZV9pbnRlcnNlY3Rpb25Qb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgUmF5X2ludGVyc2VjdFNwaGVyZV9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdENvbnZleF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RDb252ZXhfdmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbERpcmVjdGlvbiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbEZyb20gPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF93b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF93b3JsZEludGVyc2VjdFBvaW50ID0gbmV3IFZlYzMoKTsKICBuZXcgQUFCQigpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfdHJpYW5nbGVzID0gW107CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF90cmVlVHJhbnNmb3JtID0gbmV3IFRyYW5zZm9ybSgpOwogIGNvbnN0IHYwID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3QgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBkaXN0YW5jZUZyb21JbnRlcnNlY3Rpb24oZnJvbSwgZGlyZWN0aW9uLCBwb3NpdGlvbikgewogICAgLy8gdjAgaXMgdmVjdG9yIGZyb20gZnJvbSB0byBwb3NpdGlvbgogICAgcG9zaXRpb24udnN1Yihmcm9tLCB2MCk7CiAgICBjb25zdCBkb3QgPSB2MC5kb3QoZGlyZWN0aW9uKTsgLy8gaW50ZXJzZWN0ID0gZGlyZWN0aW9uKmRvdCArIGZyb20KCiAgICBkaXJlY3Rpb24uc2NhbGUoZG90LCBpbnRlcnNlY3QpOwogICAgaW50ZXJzZWN0LnZhZGQoZnJvbSwgaW50ZXJzZWN0KTsKICAgIGNvbnN0IGRpc3RhbmNlID0gcG9zaXRpb24uZGlzdGFuY2VUbyhpbnRlcnNlY3QpOwogICAgcmV0dXJuIGRpc3RhbmNlOwogIH0KCiAgLyoqCiAgICogU3dlZXAgYW5kIHBydW5lIGJyb2FkcGhhc2UgYWxvbmcgb25lIGF4aXMuCiAgICovCiAgY2xhc3MgU0FQQnJvYWRwaGFzZSBleHRlbmRzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBMaXN0IG9mIGJvZGllcyBjdXJyZW50bHkgaW4gdGhlIGJyb2FkcGhhc2UuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB3b3JsZCB0byBzZWFyY2ggaW4uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEF4aXMgdG8gc29ydCB0aGUgYm9kaWVzIGFsb25nLgogICAgICogU2V0IHRvIDAgZm9yIHggYXhpcywgYW5kIDEgZm9yIHkgYXhpcy4KICAgICAqIEZvciBiZXN0IHBlcmZvcm1hbmNlLCBwaWNrIHRoZSBheGlzIHdoZXJlIGJvZGllcyBhcmUgbW9zdCBkaXN0cmlidXRlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kcyBvZiB0d28gYm9kaWVzIG92ZXJsYXAsIGFsb25nIHRoZSBnaXZlbiBTQVAgYXhpcy4KICAgICAqLwogICAgc3RhdGljIGNoZWNrQm91bmRzKGJpLCBiaiwgYXhpc0luZGV4KSB7CiAgICAgIGxldCBiaVBvczsKICAgICAgbGV0IGJqUG9zOwoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMCkgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24ueDsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLng7CiAgICAgIH0gZWxzZSBpZiAoYXhpc0luZGV4ID09PSAxKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi55OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24ueTsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDIpIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLno7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi56OwogICAgICB9CgogICAgICBjb25zdCByaSA9IGJpLmJvdW5kaW5nUmFkaXVzLAogICAgICAgICAgICByaiA9IGJqLmJvdW5kaW5nUmFkaXVzLAogICAgICAgICAgICBib3VuZEEyID0gYmlQb3MgKyByaSwKICAgICAgICAgICAgYm91bmRCMSA9IGJqUG9zIC0gcmo7CiAgICAgIHJldHVybiBib3VuZEIxIDwgYm91bmRBMjsKICAgIH0gLy8gTm90ZTogdGhlc2UgYXJlIGlkZW50aWNhbCwgc2F2ZSBmb3IgeC95L3ogbG93ZXJib3VuZAoKICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFgKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFgoYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnggPD0gdi5hYWJiLmxvd2VyQm91bmQueCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WQogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WShhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueSA8PSB2LmFhYmIubG93ZXJCb3VuZC55KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRaCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRaKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC56IDw9IHYuYWFiYi5sb3dlckJvdW5kLnopIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KCiAgICBjb25zdHJ1Y3Rvcih3b3JsZCkgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLmF4aXNMaXN0ID0gW107CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLmF4aXNJbmRleCA9IDA7CiAgICAgIGNvbnN0IGF4aXNMaXN0ID0gdGhpcy5heGlzTGlzdDsKCiAgICAgIHRoaXMuX2FkZEJvZHlIYW5kbGVyID0gZXZlbnQgPT4gewogICAgICAgIGF4aXNMaXN0LnB1c2goZXZlbnQuYm9keSk7CiAgICAgIH07CgogICAgICB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlciA9IGV2ZW50ID0+IHsKICAgICAgICBjb25zdCBpZHggPSBheGlzTGlzdC5pbmRleE9mKGV2ZW50LmJvZHkpOwoKICAgICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgICAgYXhpc0xpc3Quc3BsaWNlKGlkeCwgMSk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgaWYgKHdvcmxkKSB7CiAgICAgICAgdGhpcy5zZXRXb3JsZCh3b3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hhbmdlIHRoZSB3b3JsZAogICAgICovCgoKICAgIHNldFdvcmxkKHdvcmxkKSB7CiAgICAgIC8vIENsZWFyIHRoZSBvbGQgYXhpcyBhcnJheQogICAgICB0aGlzLmF4aXNMaXN0Lmxlbmd0aCA9IDA7IC8vIEFkZCBhbGwgYm9kaWVzIGZyb20gdGhlIG5ldyB3b3JsZAoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3JsZC5ib2RpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0aGlzLmF4aXNMaXN0LnB1c2god29ybGQuYm9kaWVzW2ldKTsKICAgICAgfSAvLyBSZW1vdmUgb2xkIGhhbmRsZXJzLCBpZiBhbnkKCgogICAgICB3b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdhZGRCb2R5JywgdGhpcy5fYWRkQm9keUhhbmRsZXIpOwogICAgICB3b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdyZW1vdmVCb2R5JywgdGhpcy5fcmVtb3ZlQm9keUhhbmRsZXIpOyAvLyBBZGQgaGFuZGxlcnMgdG8gdXBkYXRlIHRoZSBsaXN0IG9mIGJvZGllcy4KCiAgICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ2FkZEJvZHknLCB0aGlzLl9hZGRCb2R5SGFuZGxlcik7CiAgICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3JlbW92ZUJvZHknLCB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlcik7CiAgICAgIHRoaXMud29ybGQgPSB3b3JsZDsKICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENvbGxlY3QgYWxsIGNvbGxpc2lvbiBwYWlycwogICAgICovCgoKICAgIGNvbGxpc2lvblBhaXJzKHdvcmxkLCBwMSwgcDIpIHsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5heGlzTGlzdDsKICAgICAgY29uc3QgTiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGNvbnN0IGF4aXNJbmRleCA9IHRoaXMuYXhpc0luZGV4OwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICAgIHRoaXMuc29ydExpc3QoKTsKICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgIH0gLy8gTG9vayB0aHJvdWdoIHRoZSBsaXN0CgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgTjsgaisrKSB7CiAgICAgICAgICBjb25zdCBiaiA9IGJvZGllc1tqXTsKCiAgICAgICAgICBpZiAoIXRoaXMubmVlZEJyb2FkcGhhc2VDb2xsaXNpb24oYmksIGJqKSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIVNBUEJyb2FkcGhhc2UuY2hlY2tCb3VuZHMoYmksIGJqLCBheGlzSW5kZXgpKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuaW50ZXJzZWN0aW9uVGVzdChiaSwgYmosIHAxLCBwMik7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc29ydExpc3QoKSB7CiAgICAgIGNvbnN0IGF4aXNMaXN0ID0gdGhpcy5heGlzTGlzdDsKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGNvbnN0IE4gPSBheGlzTGlzdC5sZW5ndGg7IC8vIFVwZGF0ZSBBQUJCcwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYXhpc0xpc3RbaV07CgogICAgICAgIGlmIChiaS5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIGJpLnVwZGF0ZUFBQkIoKTsKICAgICAgICB9CiAgICAgIH0gLy8gU29ydCB0aGUgbGlzdAoKCiAgICAgIGlmIChheGlzSW5kZXggPT09IDApIHsKICAgICAgICBTQVBCcm9hZHBoYXNlLmluc2VydGlvblNvcnRYKGF4aXNMaXN0KTsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBTQVBCcm9hZHBoYXNlLmluc2VydGlvblNvcnRZKGF4aXNMaXN0KTsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDIpIHsKICAgICAgICBTQVBCcm9hZHBoYXNlLmluc2VydGlvblNvcnRaKGF4aXNMaXN0KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgdmFyaWFuY2Ugb2YgdGhlIGJvZHkgcG9zaXRpb25zIGFuZCBlc3RpbWF0ZXMgdGhlIGJlc3QgYXhpcyB0byB1c2UuCiAgICAgKiBXaWxsIGF1dG9tYXRpY2FsbHkgc2V0IHByb3BlcnR5IGBheGlzSW5kZXhgLgogICAgICovCgoKICAgIGF1dG9EZXRlY3RBeGlzKCkgewogICAgICBsZXQgc3VtWCA9IDA7CiAgICAgIGxldCBzdW1YMiA9IDA7CiAgICAgIGxldCBzdW1ZID0gMDsKICAgICAgbGV0IHN1bVkyID0gMDsKICAgICAgbGV0IHN1bVogPSAwOwogICAgICBsZXQgc3VtWjIgPSAwOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgaW52TiA9IDEgLyBOOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBib2RpZXNbaV07CiAgICAgICAgY29uc3QgY2VudGVyWCA9IGIucG9zaXRpb24ueDsKICAgICAgICBzdW1YICs9IGNlbnRlclg7CiAgICAgICAgc3VtWDIgKz0gY2VudGVyWCAqIGNlbnRlclg7CiAgICAgICAgY29uc3QgY2VudGVyWSA9IGIucG9zaXRpb24ueTsKICAgICAgICBzdW1ZICs9IGNlbnRlclk7CiAgICAgICAgc3VtWTIgKz0gY2VudGVyWSAqIGNlbnRlclk7CiAgICAgICAgY29uc3QgY2VudGVyWiA9IGIucG9zaXRpb24uejsKICAgICAgICBzdW1aICs9IGNlbnRlclo7CiAgICAgICAgc3VtWjIgKz0gY2VudGVyWiAqIGNlbnRlclo7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZhcmlhbmNlWCA9IHN1bVgyIC0gc3VtWCAqIHN1bVggKiBpbnZOOwogICAgICBjb25zdCB2YXJpYW5jZVkgPSBzdW1ZMiAtIHN1bVkgKiBzdW1ZICogaW52TjsKICAgICAgY29uc3QgdmFyaWFuY2VaID0gc3VtWjIgLSBzdW1aICogc3VtWiAqIGludk47CgogICAgICBpZiAodmFyaWFuY2VYID4gdmFyaWFuY2VZKSB7CiAgICAgICAgaWYgKHZhcmlhbmNlWCA+IHZhcmlhbmNlWikgewogICAgICAgICAgdGhpcy5heGlzSW5kZXggPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDI7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHZhcmlhbmNlWSA+IHZhcmlhbmNlWikgewogICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDI7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gYW4gQUFCQi4KICAgICAqIEBwYXJhbSByZXN1bHQgQW4gYXJyYXkgdG8gc3RvcmUgcmVzdWx0aW5nIGJvZGllcyBpbi4KICAgICAqLwoKCiAgICBhYWJiUXVlcnkod29ybGQsIGFhYmIsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuZGlydHkpIHsKICAgICAgICB0aGlzLnNvcnRMaXN0KCk7CiAgICAgICAgdGhpcy5kaXJ0eSA9IGZhbHNlOwogICAgICB9CgogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgbGV0IGF4aXMgPSAneCc7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAxKSB7CiAgICAgICAgYXhpcyA9ICd5JzsKICAgICAgfQoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGF4aXMgPSAneic7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4aXNMaXN0ID0gdGhpcy5heGlzTGlzdDsKICAgICAgYWFiYi5sb3dlckJvdW5kW2F4aXNdOwogICAgICBhYWJiLnVwcGVyQm91bmRbYXhpc107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGF4aXNMaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGF4aXNMaXN0W2ldOwoKICAgICAgICBpZiAoYi5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIGIudXBkYXRlQUFCQigpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGIuYWFiYi5vdmVybGFwcyhhYWJiKSkgewogICAgICAgICAgcmVzdWx0LnB1c2goYik7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CgogIGNsYXNzIFV0aWxzIHsKICAgIC8qKgogICAgICogRXh0ZW5kIGFuIG9wdGlvbnMgb2JqZWN0IHdpdGggZGVmYXVsdCB2YWx1ZXMuCiAgICAgKiBAcGFyYW0gb3B0aW9ucyBUaGUgb3B0aW9ucyBvYmplY3QuIE1heSBiZSBmYWxzeTogaW4gdGhpcyBjYXNlLCBhIG5ldyBvYmplY3QgaXMgY3JlYXRlZCBhbmQgcmV0dXJuZWQuCiAgICAgKiBAcGFyYW0gZGVmYXVsdHMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgZGVmYXVsdCB2YWx1ZXMuCiAgICAgKiBAcmV0dXJuIFRoZSBtb2RpZmllZCBvcHRpb25zIG9iamVjdC4KICAgICAqLwogICAgc3RhdGljIGRlZmF1bHRzKG9wdGlvbnMsIGRlZmF1bHRzKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGtleSBpbiBkZWZhdWx0cykgewogICAgICAgIGlmICghKGtleSBpbiBvcHRpb25zKSkgewogICAgICAgICAgb3B0aW9uc1trZXldID0gZGVmYXVsdHNba2V5XTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBvcHRpb25zOwogICAgfQoKICB9CgogIC8qKgogICAqIENvbnN0cmFpbnQgYmFzZSBjbGFzcwogICAqLwogIGNsYXNzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBFcXVhdGlvbnMgdG8gYmUgc29sdmVkIGluIHRoaXMgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogQm9keSBBLgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEIuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBmYWxzZSBpZiB5b3UgZG9uJ3Qgd2FudCB0aGUgYm9kaWVzIHRvIGNvbGxpZGUgd2hlbiB0aGV5IGFyZSBjb25uZWN0ZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNvbGxpZGVDb25uZWN0ZWQ6IHRydWUsCiAgICAgICAgd2FrZVVwQm9kaWVzOiB0cnVlCiAgICAgIH0pOwogICAgICB0aGlzLmVxdWF0aW9ucyA9IFtdOwogICAgICB0aGlzLmJvZHlBID0gYm9keUE7CiAgICAgIHRoaXMuYm9keUIgPSBib2R5QjsKICAgICAgdGhpcy5pZCA9IENvbnN0cmFpbnQuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuY29sbGlkZUNvbm5lY3RlZCA9IG9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKCiAgICAgIGlmIChvcHRpb25zLndha2VVcEJvZGllcykgewogICAgICAgIGlmIChib2R5QSkgewogICAgICAgICAgYm9keUEud2FrZVVwKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYm9keUIpIHsKICAgICAgICAgIGJvZHlCLndha2VVcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgYWxsIHRoZSBlcXVhdGlvbnMgd2l0aCBkYXRhLgogICAgICovCgoKICAgIHVwZGF0ZSgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdtZXRob2QgdXBkYXRlKCkgbm90IGltcGxtZW1lbnRlZCBpbiB0aGlzIENvbnN0cmFpbnQgc3ViY2xhc3MhJyk7CiAgICB9CiAgICAvKioKICAgICAqIEVuYWJsZXMgYWxsIGVxdWF0aW9ucyBpbiB0aGUgY29uc3RyYWludC4KICAgICAqLwoKCiAgICBlbmFibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IHRydWU7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRGlzYWJsZXMgYWxsIGVxdWF0aW9ucyBpbiB0aGUgY29uc3RyYWludC4KICAgICAqLwoKCiAgICBkaXNhYmxlKCkgewogICAgICBjb25zdCBlcXMgPSB0aGlzLmVxdWF0aW9uczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZXFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZXFzW2ldLmVuYWJsZWQgPSBmYWxzZTsKICAgICAgfQogICAgfQoKICB9CiAgQ29uc3RyYWludC5pZENvdW50ZXIgPSAwOwoKICAvKioKICAgKiBBbiBlbGVtZW50IGNvbnRhaW5pbmcgNiBlbnRyaWVzLCAzIHNwYXRpYWwgYW5kIDMgcm90YXRpb25hbCBkZWdyZWVzIG9mIGZyZWVkb20uCiAgICovCgogIGNsYXNzIEphY29iaWFuRWxlbWVudCB7CiAgICAvKioKICAgICAqIHNwYXRpYWwKICAgICAqLwoKICAgIC8qKgogICAgICogcm90YXRpb25hbAogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5zcGF0aWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5yb3RhdGlvbmFsID0gbmV3IFZlYzMoKTsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgd2l0aCBvdGhlciBKYWNvYmlhbkVsZW1lbnQKICAgICAqLwoKCiAgICBtdWx0aXBseUVsZW1lbnQoZWxlbWVudCkgewogICAgICByZXR1cm4gZWxlbWVudC5zcGF0aWFsLmRvdCh0aGlzLnNwYXRpYWwpICsgZWxlbWVudC5yb3RhdGlvbmFsLmRvdCh0aGlzLnJvdGF0aW9uYWwpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIHR3byB2ZWN0b3JzCiAgICAgKi8KCgogICAgbXVsdGlwbHlWZWN0b3JzKHNwYXRpYWwsIHJvdGF0aW9uYWwpIHsKICAgICAgcmV0dXJuIHNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyByb3RhdGlvbmFsLmRvdCh0aGlzLnJvdGF0aW9uYWwpOwogICAgfQoKICB9CgogIC8qKgogICAqIEVxdWF0aW9uIGJhc2UgY2xhc3MuCiAgICoKICAgKiBgYWAsIGBiYCBhbmQgYGVwc2AgYXJlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci81RFYwNTgvVlQxNS9sZWN0dXJlcy9TUE9PS2xhYm5vdGVzLnBkZiBTUE9PS30gcGFyYW1ldGVycyB0aGF0IGRlZmF1bHQgdG8gYDAuMGAuIFNlZSB7QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL3NjaHRlcHBlL2Nhbm5vbi5qcy9pc3N1ZXMvMjM4I2lzc3VlY29tbWVudC0xNDcxNzIzMjcgdGhpcyBleGNoYW5nZX0gZm9yIG1vcmUgZGV0YWlscyBvbiBDYW5ub24ncyBwaHlzaWNzIGltcGxlbWVudGF0aW9uLgogICAqLwogIGNsYXNzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogTWluaW11bSAocmVhZDogbmVnYXRpdmUgbWF4KSBmb3JjZSB0byBiZSBhcHBsaWVkIGJ5IHRoZSBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBNYXhpbXVtIChyZWFkOiBwb3NpdGl2ZSBtYXgpIGZvcmNlIHRvIGJlIGFwcGxpZWQgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIEEgbnVtYmVyLCBwcm9wb3J0aW9uYWwgdG8gdGhlIGZvcmNlIGFkZGVkIHRvIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJpLCBiaiwgbWluRm9yY2UsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtaW5Gb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWluRm9yY2UgPSAtMWU2OwogICAgICB9CgogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICB0aGlzLmlkID0gRXF1YXRpb24uaWRDb3VudGVyKys7CiAgICAgIHRoaXMubWluRm9yY2UgPSBtaW5Gb3JjZTsKICAgICAgdGhpcy5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgICB0aGlzLmJpID0gYmk7CiAgICAgIHRoaXMuYmogPSBiajsKICAgICAgdGhpcy5hID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuYiA9IDAuMDsgLy8gU1BPT0sgcGFyYW1ldGVyCgogICAgICB0aGlzLmVwcyA9IDAuMDsgLy8gU1BPT0sgcGFyYW1ldGVyCgogICAgICB0aGlzLmphY29iaWFuRWxlbWVudEEgPSBuZXcgSmFjb2JpYW5FbGVtZW50KCk7CiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QiA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5lbmFibGVkID0gdHJ1ZTsKICAgICAgdGhpcy5tdWx0aXBsaWVyID0gMDsKICAgICAgdGhpcy5zZXRTcG9va1BhcmFtcygxZTcsIDQsIDEgLyA2MCk7IC8vIFNldCB0eXBpY2FsIHNwb29rIHBhcmFtcwogICAgfQogICAgLyoqCiAgICAgKiBSZWNhbGN1bGF0ZXMgYSwgYiwgYW5kIGVwcy4KICAgICAqCiAgICAgKiBUaGUgRXF1YXRpb24gY29uc3RydWN0b3Igc2V0cyB0eXBpY2FsIFNQT09LIHBhcmFtZXRlcnMgYXMgc3VjaDoKICAgICAqICogYHN0aWZmbmVzc2AgPSAxZTcKICAgICAqICogYHJlbGF4YXRpb25gID0gNAogICAgICogKiBgdGltZVN0ZXBgPSAxIC8gNjAsIF9ub3RlIHRoZSBoYXJkY29kZWQgcmVmcmVzaCByYXRlLl8KICAgICAqLwoKCiAgICBzZXRTcG9va1BhcmFtcyhzdGlmZm5lc3MsIHJlbGF4YXRpb24sIHRpbWVTdGVwKSB7CiAgICAgIGNvbnN0IGQgPSByZWxheGF0aW9uOwogICAgICBjb25zdCBrID0gc3RpZmZuZXNzOwogICAgICBjb25zdCBoID0gdGltZVN0ZXA7CiAgICAgIHRoaXMuYSA9IDQuMCAvIChoICogKDEgKyA0ICogZCkpOwogICAgICB0aGlzLmIgPSA0LjAgKiBkIC8gKDEgKyA0ICogZCk7CiAgICAgIHRoaXMuZXBzID0gNC4wIC8gKGggKiBoICogayAqICgxICsgNCAqIGQpKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIHJpZ2h0IGhhbmQgc2lkZSBvZiB0aGUgU1BPT0sgZXF1YXRpb24KICAgICAqLwoKCiAgICBjb21wdXRlQihhLCBiLCBoKSB7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR3EgPSB0aGlzLmNvbXB1dGVHcSgpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICByZXR1cm4gLUdxICogYSAtIEdXICogYiAtIEdpTWYgKiBoOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKnEsIHdoZXJlIHEgYXJlIHRoZSBnZW5lcmFsaXplZCBib2R5IGNvb3JkaW5hdGVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdxKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB4aSA9IGJpLnBvc2l0aW9uOwogICAgICBjb25zdCB4aiA9IGJqLnBvc2l0aW9uOwogICAgICByZXR1cm4gR0Euc3BhdGlhbC5kb3QoeGkpICsgR0Iuc3BhdGlhbC5kb3QoeGopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKlcsIHdoZXJlIFcgYXJlIHRoZSBib2R5IHZlbG9jaXRpZXMKICAgICAqLwoKCiAgICBjb21wdXRlR1coKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHZpID0gYmkudmVsb2NpdHk7CiAgICAgIGNvbnN0IHZqID0gYmoudmVsb2NpdHk7CiAgICAgIGNvbnN0IHdpID0gYmkuYW5ndWxhclZlbG9jaXR5OwogICAgICBjb25zdCB3aiA9IGJqLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgcmV0dXJuIEdBLm11bHRpcGx5VmVjdG9ycyh2aSwgd2kpICsgR0IubXVsdGlwbHlWZWN0b3JzKHZqLCB3aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqV2xhbWJkYSwgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHV2xhbWJkYSgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52bGFtYmRhOwogICAgICBjb25zdCB2aiA9IGJqLnZsYW1iZGE7CiAgICAgIGNvbnN0IHdpID0gYmkud2xhbWJkYTsKICAgICAgY29uc3Qgd2ogPSBiai53bGFtYmRhOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRyppbnYoTSkqZiwgd2hlcmUgTSBpcyB0aGUgbWFzcyBtYXRyaXggd2l0aCBkaWFnb25hbCBibG9ja3MgZm9yIGVhY2ggYm9keSwgYW5kIGYgYXJlIHRoZSBmb3JjZXMgb24gdGhlIGJvZGllcy4KICAgICAqLwoKCiAgICBjb21wdXRlR2lNZigpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgZmkgPSBiaS5mb3JjZTsKICAgICAgY29uc3QgdGkgPSBiaS50b3JxdWU7CiAgICAgIGNvbnN0IGZqID0gYmouZm9yY2U7CiAgICAgIGNvbnN0IHRqID0gYmoudG9ycXVlOwogICAgICBjb25zdCBpbnZNYXNzaSA9IGJpLmludk1hc3NTb2x2ZTsKICAgICAgY29uc3QgaW52TWFzc2ogPSBiai5pbnZNYXNzU29sdmU7CiAgICAgIGZpLnNjYWxlKGludk1hc3NpLCBpTWZpKTsKICAgICAgZmouc2NhbGUoaW52TWFzc2osIGlNZmopOwogICAgICBiaS5pbnZJbmVydGlhV29ybGRTb2x2ZS52bXVsdCh0aSwgaW52SWlfdm11bHRfdGF1aSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRqLCBpbnZJal92bXVsdF90YXVqKTsKICAgICAgcmV0dXJuIEdBLm11bHRpcGx5VmVjdG9ycyhpTWZpLCBpbnZJaV92bXVsdF90YXVpKSArIEdCLm11bHRpcGx5VmVjdG9ycyhpTWZqLCBpbnZJal92bXVsdF90YXVqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRyppbnYoTSkqRycKICAgICAqLwoKCiAgICBjb21wdXRlR2lNR3QoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgY29uc3QgaW52SWkgPSBiaS5pbnZJbmVydGlhV29ybGRTb2x2ZTsKICAgICAgY29uc3QgaW52SWogPSBiai5pbnZJbmVydGlhV29ybGRTb2x2ZTsKICAgICAgbGV0IHJlc3VsdCA9IGludk1hc3NpICsgaW52TWFzc2o7CiAgICAgIGludklpLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdBLnJvdGF0aW9uYWwpOwogICAgICBpbnZJai52bXVsdChHQi5yb3RhdGlvbmFsLCB0bXApOwogICAgICByZXN1bHQgKz0gdG1wLmRvdChHQi5yb3RhdGlvbmFsKTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQWRkIGNvbnN0cmFpbnQgdmVsb2NpdHkgdG8gdGhlIGJvZGllcy4KICAgICAqLwoKCiAgICBhZGRUb1dsYW1iZGEoZGVsdGFsYW1iZGEpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdGVtcCA9IGFkZFRvV2xhbWJkYV90ZW1wOyAvLyBBZGQgdG8gbGluZWFyIHZlbG9jaXR5CiAgICAgIC8vIHZfbGFtYmRhICs9IGludihNKSAqIGRlbHRhX2xhbWJhICogRwoKICAgICAgYmkudmxhbWJkYS5hZGRTY2FsZWRWZWN0b3IoYmkuaW52TWFzc1NvbHZlICogZGVsdGFsYW1iZGEsIEdBLnNwYXRpYWwsIGJpLnZsYW1iZGEpOwogICAgICBiai52bGFtYmRhLmFkZFNjYWxlZFZlY3Rvcihiai5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Iuc3BhdGlhbCwgYmoudmxhbWJkYSk7IC8vIEFkZCB0byBhbmd1bGFyIHZlbG9jaXR5CgogICAgICBiaS5pbnZJbmVydGlhV29ybGRTb2x2ZS52bXVsdChHQS5yb3RhdGlvbmFsLCB0ZW1wKTsKICAgICAgYmkud2xhbWJkYS5hZGRTY2FsZWRWZWN0b3IoZGVsdGFsYW1iZGEsIHRlbXAsIGJpLndsYW1iZGEpOwogICAgICBiai5pbnZJbmVydGlhV29ybGRTb2x2ZS52bXVsdChHQi5yb3RhdGlvbmFsLCB0ZW1wKTsKICAgICAgYmoud2xhbWJkYS5hZGRTY2FsZWRWZWN0b3IoZGVsdGFsYW1iZGEsIHRlbXAsIGJqLndsYW1iZGEpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBkZW5vbWluYXRvciBwYXJ0IG9mIHRoZSBTUE9PSyBlcXVhdGlvbjogQyA9IEcqaW52KE0pKkcnICsgZXBzCiAgICAgKi8KCgogICAgY29tcHV0ZUMoKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbXB1dGVHaU1HdCgpICsgdGhpcy5lcHM7CiAgICB9CgogIH0KICBFcXVhdGlvbi5pZENvdW50ZXIgPSAwOwogIGNvbnN0IGlNZmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGlNZmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGludklpX3ZtdWx0X3RhdWkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludklqX3ZtdWx0X3RhdWogPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYWRkVG9XbGFtYmRhX3RlbXAgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb250YWN0L25vbi1wZW5ldHJhdGlvbiBjb25zdHJhaW50IGVxdWF0aW9uCiAgICovCiAgY2xhc3MgQ29udGFjdEVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiAiYm91bmNpbmVzcyI6IHUxID0gLWUqdTAKICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgZ29lcyBmcm9tIHRoZSBjZW50ZXIgb2YgYmkgdG8gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkLW9yaWVudGVkIHZlY3RvciB0aGF0IHN0YXJ0cyBpbiBib2R5IGogcG9zaXRpb24gYW5kIGdvZXMgdG8gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIENvbnRhY3Qgbm9ybWFsLCBwb2ludGluZyBvdXQgb2YgYm9keSBpLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgMCwgbWF4Rm9yY2UpOwogICAgICB0aGlzLnJlc3RpdHV0aW9uID0gMC4wOwogICAgICB0aGlzLnJpID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5yaiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMubmkgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHJpID0gdGhpcy5yaTsKICAgICAgY29uc3QgcmogPSB0aGlzLnJqOwogICAgICBjb25zdCByaXhuID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxOwogICAgICBjb25zdCByanhuID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB2aSA9IGJpLnZlbG9jaXR5OwogICAgICBjb25zdCB3aSA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmkuZm9yY2U7CiAgICAgIGJpLnRvcnF1ZTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2ogPSBiai5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGJqLmZvcmNlOwogICAgICBiai50b3JxdWU7CiAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAzOwogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IG4gPSB0aGlzLm5pOyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKG4sIHJpeG4pOwogICAgICByai5jcm9zcyhuLCByanhuKTsgLy8gZyA9IHhqK3JqIC0oeGkrcmkpCiAgICAgIC8vIEcgPSBbIC1uaSAgLXJpeG4gIG5pICByanhuIF0KCiAgICAgIG4ubmVnYXRlKEdBLnNwYXRpYWwpOwogICAgICByaXhuLm5lZ2F0ZShHQS5yb3RhdGlvbmFsKTsKICAgICAgR0Iuc3BhdGlhbC5jb3B5KG4pOwogICAgICBHQi5yb3RhdGlvbmFsLmNvcHkocmp4bik7IC8vIENhbGN1bGF0ZSB0aGUgcGVuZXRyYXRpb24gdmVjdG9yCgogICAgICBwZW5ldHJhdGlvblZlYy5jb3B5KGJqLnBvc2l0aW9uKTsKICAgICAgcGVuZXRyYXRpb25WZWMudmFkZChyaiwgcGVuZXRyYXRpb25WZWMpOwogICAgICBwZW5ldHJhdGlvblZlYy52c3ViKGJpLnBvc2l0aW9uLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIocmksIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgY29uc3QgZyA9IG4uZG90KHBlbmV0cmF0aW9uVmVjKTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgIGNvbnN0IGVQbHVzT25lID0gdGhpcy5yZXN0aXR1dGlvbiArIDE7CiAgICAgIGNvbnN0IEdXID0gZVBsdXNPbmUgKiB2ai5kb3QobikgLSBlUGx1c09uZSAqIHZpLmRvdChuKSArIHdqLmRvdChyanhuKSAtIHdpLmRvdChyaXhuKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjdXJyZW50IHJlbGF0aXZlIHZlbG9jaXR5IGluIHRoZSBjb250YWN0IHBvaW50LgogICAgICovCgoKICAgIGdldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWwoKSB7CiAgICAgIGNvbnN0IHZpID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmk7CiAgICAgIGNvbnN0IHZqID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmo7CiAgICAgIGNvbnN0IHhpID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGk7CiAgICAgIGNvbnN0IHhqID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGo7CiAgICAgIGNvbnN0IHJlbFZlbCA9IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3JlbFZlbDsKICAgICAgdGhpcy5iaS5wb3NpdGlvbi52YWRkKHRoaXMucmksIHhpKTsKICAgICAgdGhpcy5iai5wb3NpdGlvbi52YWRkKHRoaXMucmosIHhqKTsKICAgICAgdGhpcy5iaS5nZXRWZWxvY2l0eUF0V29ybGRQb2ludCh4aSwgdmkpOwogICAgICB0aGlzLmJqLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhqLCB2aik7CiAgICAgIHZpLnZzdWIodmosIHJlbFZlbCk7CiAgICAgIHJldHVybiB0aGlzLm5pLmRvdChyZWxWZWwpOwogICAgfQoKICB9CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxID0gbmV3IFZlYzMoKTsgLy8gVGVtcCB2ZWN0b3JzCgogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9jb21wdXRlQl90ZW1wMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAzID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmogPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3hpID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfcmVsVmVsID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ29ubmVjdHMgdHdvIGJvZGllcyBhdCBnaXZlbiBvZmZzZXQgcG9pbnRzLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGJvZHlBID0gbmV3IEJvZHkoeyBtYXNzOiAxIH0pCiAgICogICAgIGNvbnN0IGJvZHlCID0gbmV3IEJvZHkoeyBtYXNzOiAxIH0pCiAgICogICAgIGJvZHlBLnBvc2l0aW9uLnNldCgtMSwgMCwgMCkKICAgKiAgICAgYm9keUIucG9zaXRpb24uc2V0KDEsIDAsIDApCiAgICogICAgIGJvZHlBLmFkZFNoYXBlKHNoYXBlQSkKICAgKiAgICAgYm9keUIuYWRkU2hhcGUoc2hhcGVCKQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJvZHlBKQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJvZHlCKQogICAqICAgICBjb25zdCBsb2NhbFBpdm90QSA9IG5ldyBWZWMzKDEsIDAsIDApCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RCID0gbmV3IFZlYzMoLTEsIDAsIDApCiAgICogICAgIGNvbnN0IGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChib2R5QSwgbG9jYWxQaXZvdEEsIGJvZHlCLCBsb2NhbFBpdm90QikKICAgKiAgICAgd29ybGQuYWRkQ29uc3RyYWludChjb25zdHJhaW50KQogICAqLwogIGNsYXNzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgZXh0ZW5kcyBDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogUGl2b3QsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5QS4KICAgICAqLwoKICAgIC8qKgogICAgICogUGl2b3QsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5Qi4KICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHBpdm90QSBUaGUgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIG9mIGJvZHlBIHdoaWNoIGJvZHlBIGlzIGNvbnN0cmFpbmVkIHRvLgogICAgICogQHBhcmFtIGJvZHlCIEJvZHkgdGhhdCB3aWxsIGJlIGNvbnN0cmFpbmVkIGluIGEgc2ltaWxhciB3YXkgdG8gdGhlIHNhbWUgcG9pbnQgYXMgYm9keUEuIFdlIHdpbGwgdGhlcmVmb3JlIGdldCBhIGxpbmsgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIuIElmIG5vdCBzcGVjaWZpZWQsIGJvZHlBIHdpbGwgYmUgY29uc3RyYWluZWQgdG8gYSBzdGF0aWMgcG9pbnQuCiAgICAgKiBAcGFyYW0gcGl2b3RCIFRoZSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3Mgb2YgYm9keUIgd2hpY2ggYm9keUIgaXMgY29uc3RyYWluZWQgdG8uCiAgICAgKiBAcGFyYW0gbWF4Rm9yY2UgVGhlIG1heGltdW0gZm9yY2UgdGhhdCBzaG91bGQgYmUgYXBwbGllZCB0byBjb25zdHJhaW4gdGhlIGJvZGllcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKHBpdm90QSA9PT0gdm9pZCAwKSB7CiAgICAgICAgcGl2b3RBID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHBpdm90QiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcGl2b3RCID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCKTsKICAgICAgdGhpcy5waXZvdEEgPSBwaXZvdEEuY2xvbmUoKTsKICAgICAgdGhpcy5waXZvdEIgPSBwaXZvdEIuY2xvbmUoKTsKICAgICAgY29uc3QgeCA9IHRoaXMuZXF1YXRpb25YID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOwogICAgICBjb25zdCB5ID0gdGhpcy5lcXVhdGlvblkgPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHogPSB0aGlzLmVxdWF0aW9uWiA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsgLy8gRXF1YXRpb25zIHRvIGJlIGZlZCB0byB0aGUgc29sdmVyCgogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHgsIHksIHopOyAvLyBNYWtlIHRoZSBlcXVhdGlvbnMgYmlkaXJlY3Rpb25hbAoKICAgICAgeC5taW5Gb3JjZSA9IHkubWluRm9yY2UgPSB6Lm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICB4Lm1heEZvcmNlID0geS5tYXhGb3JjZSA9IHoubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgeC5uaS5zZXQoMSwgMCwgMCk7CiAgICAgIHkubmkuc2V0KDAsIDEsIDApOwogICAgICB6Lm5pLnNldCgwLCAwLCAxKTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblg7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aOyAvLyBSb3RhdGUgdGhlIHBpdm90cyB0byB3b3JsZCBzcGFjZQoKICAgICAgYm9keUEucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QSwgeC5yaSk7CiAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5waXZvdEIsIHgucmopOwogICAgICB5LnJpLmNvcHkoeC5yaSk7CiAgICAgIHkucmouY29weSh4LnJqKTsKICAgICAgei5yaS5jb3B5KHgucmkpOwogICAgICB6LnJqLmNvcHkoeC5yaik7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uZSBlcXVhdGlvbi4gV29ya3MgdG8ga2VlcCB0aGUgZ2l2ZW4gYm9keSB3b3JsZCB2ZWN0b3JzIGFsaWduZWQsIG9yIHRpbHRlZCB3aXRoaW4gYSBnaXZlbiBhbmdsZSBmcm9tIGVhY2ggb3RoZXIuCiAgICovCiAgY2xhc3MgQ29uZUVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBMb2NhbCBheGlzIGluIEEKICAgICAqLwoKICAgIC8qKgogICAgICogTG9jYWwgYXhpcyBpbiBCCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSAiY29uZSBhbmdsZSIgdG8ga2VlcAogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OwogICAgICBzdXBlcihib2R5QSwgYm9keUIsIC1tYXhGb3JjZSwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKDEsIDAsIDApOwogICAgICB0aGlzLmF4aXNCID0gb3B0aW9ucy5heGlzQiA/IG9wdGlvbnMuYXhpc0IuY2xvbmUoKSA6IG5ldyBWZWMzKDAsIDEsIDApOwogICAgICB0aGlzLmFuZ2xlID0gdHlwZW9mIG9wdGlvbnMuYW5nbGUgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5hbmdsZSA6IDA7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBuaSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IG5qID0gdGhpcy5heGlzQjsKICAgICAgY29uc3Qgbml4bmogPSB0bXBWZWMxJDI7CiAgICAgIGNvbnN0IG5qeG5pID0gdG1wVmVjMiQyOwogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgbmkuY3Jvc3MobmosIG5peG5qKTsKICAgICAgbmouY3Jvc3MobmksIG5qeG5pKTsgLy8gVGhlIGFuZ2xlIGJldHdlZW4gdHdvIHZlY3RvciBpczoKICAgICAgLy8gY29zKHRoZXRhKSA9IGEgKiBiIC8gKGxlbmd0aChhKSAqIGxlbmd0aChiKSA9IHsgbGVuKGEpID0gbGVuKGIpID0gMSB9ID0gYSAqIGIKICAgICAgLy8gZyA9IGEgKiBiCiAgICAgIC8vIGdkb3QgPSAoYiB4IGEpICogd2kgKyAoYSB4IGIpICogd2oKICAgICAgLy8gRyA9IFswIGJ4YSAwIGF4Yl0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLmFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IHRtcFZlYzEkMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiQyID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogUm90YXRpb25hbCBjb25zdHJhaW50LiBXb3JrcyB0byBrZWVwIHRoZSBsb2NhbCB2ZWN0b3JzIG9ydGhvZ29uYWwgdG8gZWFjaCBvdGhlciBpbiB3b3JsZCBzcGFjZS4KICAgKi8KICBjbGFzcyBSb3RhdGlvbmFsRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBtYXhBbmdsZQogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OwogICAgICBzdXBlcihib2R5QSwgYm9keUIsIC1tYXhGb3JjZSwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKDEsIDAsIDApOwogICAgICB0aGlzLmF4aXNCID0gb3B0aW9ucy5heGlzQiA/IG9wdGlvbnMuYXhpc0IuY2xvbmUoKSA6IG5ldyBWZWMzKDAsIDEsIDApOwogICAgICB0aGlzLm1heEFuZ2xlID0gTWF0aC5QSSAvIDI7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBuaSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IG5qID0gdGhpcy5heGlzQjsKICAgICAgY29uc3Qgbml4bmogPSB0bXBWZWMxJDE7CiAgICAgIGNvbnN0IG5qeG5pID0gdG1wVmVjMiQxOwogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgbmkuY3Jvc3MobmosIG5peG5qKTsKICAgICAgbmouY3Jvc3MobmksIG5qeG5pKTsgLy8gZyA9IG5pICogbmoKICAgICAgLy8gZ2RvdCA9IChuaiB4IG5pKSAqIHdpICsgKG5pIHggbmopICogd2oKICAgICAgLy8gRyA9IFswIG5qeG5pIDAgbml4bmpdCiAgICAgIC8vIFcgPSBbdmkgd2kgdmogd2pdCgogICAgICBHQS5yb3RhdGlvbmFsLmNvcHkobmp4bmkpOwogICAgICBHQi5yb3RhdGlvbmFsLmNvcHkobml4bmopOwogICAgICBjb25zdCBnID0gTWF0aC5jb3ModGhpcy5tYXhBbmdsZSkgLSBuaS5kb3QobmopOwogICAgICBjb25zdCBHVyA9IHRoaXMuY29tcHV0ZUdXKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIGNvbnN0IEIgPSAtZyAqIGEgLSBHVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KICBjb25zdCB0bXBWZWMxJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzIkMSA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEEgQ29uZSBUd2lzdCBjb25zdHJhaW50LCB1c2VmdWwgZm9yIHJhZ2RvbGxzLgogICAqLwogIGNsYXNzIENvbmVUd2lzdENvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGF4aXMgZGlyZWN0aW9uIGZvciB0aGUgY29uc3RyYWludCBvZiB0aGUgYm9keSBBLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEIuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBhcGVydHVyZSBhbmdsZSBvZiB0aGUgY29uZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHR3aXN0IGFuZ2xlIG9mIHRoZSBqb2ludC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsgLy8gU2V0IHBpdm90IHBvaW50IGluIGJldHdlZW4KCiAgICAgIGNvbnN0IHBpdm90QSA9IG9wdGlvbnMucGl2b3RBID8gb3B0aW9ucy5waXZvdEEuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBpdm90QiA9IG9wdGlvbnMucGl2b3RCID8gb3B0aW9ucy5waXZvdEIuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHN1cGVyKGJvZHlBLCBwaXZvdEEsIGJvZHlCLCBwaXZvdEIsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IG9wdGlvbnMuYXhpc0EgPyBvcHRpb25zLmF4aXNBLmNsb25lKCkgOiBuZXcgVmVjMygpOwogICAgICB0aGlzLmF4aXNCID0gb3B0aW9ucy5heGlzQiA/IG9wdGlvbnMuYXhpc0IuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29sbGlkZUNvbm5lY3RlZCA9ICEhb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwogICAgICB0aGlzLmFuZ2xlID0gdHlwZW9mIG9wdGlvbnMuYW5nbGUgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5hbmdsZSA6IDA7CiAgICAgIGNvbnN0IGMgPSB0aGlzLmNvbmVFcXVhdGlvbiA9IG5ldyBDb25lRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgdCA9IHRoaXMudHdpc3RFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgdGhpcy50d2lzdEFuZ2xlID0gdHlwZW9mIG9wdGlvbnMudHdpc3RBbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnR3aXN0QW5nbGUgOiAwOyAvLyBNYWtlIHRoZSBjb25lIGVxdWF0aW9uIHB1c2ggdGhlIGJvZGllcyB0b3dhcmQgdGhlIGNvbmUgYXhpcywgbm90IG91dHdhcmQKCiAgICAgIGMubWF4Rm9yY2UgPSAwOwogICAgICBjLm1pbkZvcmNlID0gLW1heEZvcmNlOyAvLyBNYWtlIHRoZSB0d2lzdCBlcXVhdGlvbiBhZGQgdG9ycXVlIHRvd2FyZCB0aGUgaW5pdGlhbCBwb3NpdGlvbgoKICAgICAgdC5tYXhGb3JjZSA9IDA7CiAgICAgIHQubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goYywgdCk7CiAgICB9CgogICAgdXBkYXRlKCkgewogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgY29uZSA9IHRoaXMuY29uZUVxdWF0aW9uOwogICAgICBjb25zdCB0d2lzdCA9IHRoaXMudHdpc3RFcXVhdGlvbjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIFVwZGF0ZSB0aGUgYXhlcyB0byB0aGUgY29uZSBjb25zdHJhaW50CgogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy5heGlzQSwgY29uZS5heGlzQSk7CiAgICAgIGJvZHlCLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLmF4aXNCLCBjb25lLmF4aXNCKTsgLy8gVXBkYXRlIHRoZSB3b3JsZCBheGVzIGluIHRoZSB0d2lzdCBjb25zdHJhaW50CgogICAgICB0aGlzLmF4aXNBLnRhbmdlbnRzKHR3aXN0LmF4aXNBLCB0d2lzdC5heGlzQSk7CiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0d2lzdC5heGlzQSwgdHdpc3QuYXhpc0EpOwogICAgICB0aGlzLmF4aXNCLnRhbmdlbnRzKHR3aXN0LmF4aXNCLCB0d2lzdC5heGlzQik7CiAgICAgIGJvZHlCLnZlY3RvclRvV29ybGRGcmFtZSh0d2lzdC5heGlzQiwgdHdpc3QuYXhpc0IpOwogICAgICBjb25lLmFuZ2xlID0gdGhpcy5hbmdsZTsKICAgICAgdHdpc3QubWF4QW5nbGUgPSB0aGlzLnR3aXN0QW5nbGU7CiAgICB9CgogIH0KICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnMgdHdvIGJvZGllcyB0byBiZSBhdCBhIGNvbnN0YW50IGRpc3RhbmNlIGZyb20gZWFjaCBvdGhlcnMgY2VudGVyIG9mIG1hc3MuCiAgICovCiAgY2xhc3MgRGlzdGFuY2VDb25zdHJhaW50IGV4dGVuZHMgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIFRoZSBkaXN0YW5jZSB0byBrZWVwLiBJZiB1bmRlZmluZWQsIGl0IHdpbGwgYmUgc2V0IHRvIHRoZSBjdXJyZW50IGRpc3RhbmNlIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBkaXN0YW5jZSBUaGUgZGlzdGFuY2UgdG8ga2VlcC4gSWYgdW5kZWZpbmVkLCBpdCB3aWxsIGJlIHNldCB0byB0aGUgY3VycmVudCBkaXN0YW5jZSBiZXR3ZWVuIGJvZHlBIGFuZCBib2R5Qi4KICAgICAqIEBwYXJhbSBtYXhGb3JjZSBUaGUgbWF4aW11bSBmb3JjZSB0aGF0IHNob3VsZCBiZSBhcHBsaWVkIHRvIGNvbnN0cmFpbiB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIGRpc3RhbmNlLCBtYXhGb3JjZSkgewogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICBzdXBlcihib2R5QSwgYm9keUIpOwoKICAgICAgaWYgKHR5cGVvZiBkaXN0YW5jZSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBkaXN0YW5jZSA9IGJvZHlBLnBvc2l0aW9uLmRpc3RhbmNlVG8oYm9keUIucG9zaXRpb24pOwogICAgICB9CgogICAgICB0aGlzLmRpc3RhbmNlID0gZGlzdGFuY2U7CiAgICAgIGNvbnN0IGVxID0gdGhpcy5kaXN0YW5jZUVxdWF0aW9uID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsgLy8gTWFrZSBpdCBiaWRpcmVjdGlvbmFsCgogICAgICBlcS5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgZXEubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgIH0KICAgIC8qKgogICAgICogdXBkYXRlCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgZXEgPSB0aGlzLmRpc3RhbmNlRXF1YXRpb247CiAgICAgIGNvbnN0IGhhbGZEaXN0ID0gdGhpcy5kaXN0YW5jZSAqIDAuNTsKICAgICAgY29uc3Qgbm9ybWFsID0gZXEubmk7CiAgICAgIGJvZHlCLnBvc2l0aW9uLnZzdWIoYm9keUEucG9zaXRpb24sIG5vcm1hbCk7CiAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgbm9ybWFsLnNjYWxlKGhhbGZEaXN0LCBlcS5yaSk7CiAgICAgIG5vcm1hbC5zY2FsZSgtaGFsZkRpc3QsIGVxLnJqKTsKICAgIH0KCiAgfQoKICAvKioKICAgKiBMb2NrIGNvbnN0cmFpbnQuIFdpbGwgcmVtb3ZlIGFsbCBkZWdyZWVzIG9mIGZyZWVkb20gYmV0d2VlbiB0aGUgYm9kaWVzLgogICAqLwogIGNsYXNzIExvY2tDb25zdHJhaW50IGV4dGVuZHMgUG9pbnRUb1BvaW50Q29uc3RyYWludCB7CiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaGFsZldheSA9IG5ldyBWZWMzKCk7CiAgICAgIGJvZHlBLnBvc2l0aW9uLnZhZGQoYm9keUIucG9zaXRpb24sIGhhbGZXYXkpOwogICAgICBoYWxmV2F5LnNjYWxlKDAuNSwgaGFsZldheSk7CiAgICAgIGJvZHlCLnBvaW50VG9Mb2NhbEZyYW1lKGhhbGZXYXksIHBpdm90Qik7CiAgICAgIGJvZHlBLnBvaW50VG9Mb2NhbEZyYW1lKGhhbGZXYXksIHBpdm90QSk7IC8vIFRoZSBwb2ludC10by1wb2ludCBjb25zdHJhaW50IHdpbGwga2VlcCBhIHBvaW50IHNoYXJlZCBiZXR3ZWVuIHRoZSBib2RpZXMKCiAgICAgIHN1cGVyKGJvZHlBLCBwaXZvdEEsIGJvZHlCLCBwaXZvdEIsIG1heEZvcmNlKTsgLy8gU3RvcmUgaW5pdGlhbCByb3RhdGlvbiBvZiB0aGUgYm9kaWVzIGFzIHVuaXQgdmVjdG9ycyBpbiB0aGUgbG9jYWwgYm9keSBzcGFjZXMKCiAgICAgIHRoaXMueEEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1gpOwogICAgICB0aGlzLnhCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9YKTsKICAgICAgdGhpcy55QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWSk7CiAgICAgIHRoaXMueUIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1kpOwogICAgICB0aGlzLnpBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9aKTsKICAgICAgdGhpcy56QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWik7IC8vIC4uLmFuZCB0aGUgZm9sbG93aW5nIHJvdGF0aW9uYWwgZXF1YXRpb25zIHdpbGwga2VlcCBhbGwgcm90YXRpb25hbCBET0YncyBpbiBwbGFjZQoKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCByMyA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMyA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyMSwgcjIsIHIzKTsKICAgIH0KICAgIC8qKgogICAgICogdXBkYXRlCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uOwogICAgICBjb25zdCByMSA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMTsKICAgICAgY29uc3QgcjIgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjI7CiAgICAgIGNvbnN0IHIzID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24zOwogICAgICBzdXBlci51cGRhdGUoKTsgLy8gVGhlc2UgdmVjdG9yIHBhaXJzIG11c3QgYmUgb3J0aG9nb25hbAoKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMueEEsIHIxLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMueUIsIHIxLmF4aXNCKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMueUEsIHIyLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuekIsIHIyLmF4aXNCKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuekEsIHIzLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMueEIsIHIzLmF4aXNCKTsKICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogUm90YXRpb25hbCBtb3RvciBjb25zdHJhaW50LiBUcmllcyB0byBrZWVwIHRoZSByZWxhdGl2ZSBhbmd1bGFyIHZlbG9jaXR5IG9mIHRoZSBib2RpZXMgdG8gYSBnaXZlbiB2YWx1ZS4KICAgKi8KICBjbGFzcyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1vdG9yIHZlbG9jaXR5LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmF4aXNCID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy50YXJnZXRWZWxvY2l0eSA9IDA7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIHRoaXMuYmk7CiAgICAgIHRoaXMuYmo7CiAgICAgIGNvbnN0IGF4aXNBID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgYXhpc0IgPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7IC8vIGcgPSAwCiAgICAgIC8vIGdkb3QgPSBheGlzQSAqIHdpIC0gYXhpc0IgKiB3agogICAgICAvLyBnZG90ID0gRyAqIFcgPSBHICogW3ZpIHdpIHZqIHdqXQogICAgICAvLyA9PgogICAgICAvLyBHID0gWzAgYXhpc0EgMCAtYXhpc0JdCgogICAgICBHQS5yb3RhdGlvbmFsLmNvcHkoYXhpc0EpOwogICAgICBheGlzQi5uZWdhdGUoR0Iucm90YXRpb25hbCk7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKSAtIHRoaXMudGFyZ2V0VmVsb2NpdHk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIGNvbnN0IEIgPSAtR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQoKICB9CgogIC8qKgogICAqIEhpbmdlIGNvbnN0cmFpbnQuIFRoaW5rIG9mIGl0IGFzIGEgZG9vciBoaW5nZS4gSXQgdHJpZXMgdG8ga2VlcCB0aGUgZG9vciBpbiB0aGUgY29ycmVjdCBwbGFjZSBhbmQgd2l0aCB0aGUgY29ycmVjdCBvcmllbnRhdGlvbi4KICAgKi8KICBjbGFzcyBIaW5nZUNvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogUm90YXRpb24gYXhpcywgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlBLgogICAgICovCgogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUIuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIGNvbnN0IHBpdm90QSA9IG9wdGlvbnMucGl2b3RBID8gb3B0aW9ucy5waXZvdEEuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBpdm90QiA9IG9wdGlvbnMucGl2b3RCID8gb3B0aW9ucy5waXZvdEIuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHN1cGVyKGJvZHlBLCBwaXZvdEEsIGJvZHlCLCBwaXZvdEIsIG1heEZvcmNlKTsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKDEsIDAsIDApOwogICAgICBheGlzQS5ub3JtYWxpemUoKTsKICAgICAgY29uc3QgYXhpc0IgPSB0aGlzLmF4aXNCID0gb3B0aW9ucy5heGlzQiA/IG9wdGlvbnMuYXhpc0IuY2xvbmUoKSA6IG5ldyBWZWMzKDEsIDAsIDApOwogICAgICBheGlzQi5ub3JtYWxpemUoKTsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gISFvcHRpb25zLmNvbGxpZGVDb25uZWN0ZWQ7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCByb3RhdGlvbmFsMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMiA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgbW90b3IgPSB0aGlzLm1vdG9yRXF1YXRpb24gPSBuZXcgUm90YXRpb25hbE1vdG9yRXF1YXRpb24oYm9keUEsIGJvZHlCLCBtYXhGb3JjZSk7CiAgICAgIG1vdG9yLmVuYWJsZWQgPSBmYWxzZTsgLy8gTm90IGVuYWJsZWQgYnkgZGVmYXVsdAogICAgICAvLyBFcXVhdGlvbnMgdG8gYmUgZmVkIHRvIHRoZSBzb2x2ZXIKCiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2gocm90YXRpb25hbDEsIHJvdGF0aW9uYWwyLCBtb3Rvcik7CiAgICB9CiAgICAvKioKICAgICAqIGVuYWJsZU1vdG9yCiAgICAgKi8KCgogICAgZW5hYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogZGlzYWJsZU1vdG9yCiAgICAgKi8KCgogICAgZGlzYWJsZU1vdG9yKCkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3RvclNwZWVkCiAgICAgKi8KCgogICAgc2V0TW90b3JTcGVlZChzcGVlZCkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24udGFyZ2V0VmVsb2NpdHkgPSBzcGVlZDsKICAgIH0KICAgIC8qKgogICAgICogc2V0TW90b3JNYXhGb3JjZQogICAgICovCgoKICAgIHNldE1vdG9yTWF4Rm9yY2UobWF4Rm9yY2UpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgIH0KICAgIC8qKgogICAgICogdXBkYXRlCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgbW90b3IgPSB0aGlzLm1vdG9yRXF1YXRpb247CiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMjsKICAgICAgY29uc3Qgd29ybGRBeGlzQSA9IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMTsKICAgICAgY29uc3Qgd29ybGRBeGlzQiA9IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMjsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0I7CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBHZXQgd29ybGQgYXhlcwoKICAgICAgYm9keUEucXVhdGVybmlvbi52bXVsdChheGlzQSwgd29ybGRBeGlzQSk7CiAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQoYXhpc0IsIHdvcmxkQXhpc0IpOwogICAgICB3b3JsZEF4aXNBLnRhbmdlbnRzKHIxLmF4aXNBLCByMi5heGlzQSk7CiAgICAgIHIxLmF4aXNCLmNvcHkod29ybGRBeGlzQik7CiAgICAgIHIyLmF4aXNCLmNvcHkod29ybGRBeGlzQik7CgogICAgICBpZiAodGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQpIHsKICAgICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMuYXhpc0EsIG1vdG9yLmF4aXNBKTsKICAgICAgICBib2R5Qi5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMuYXhpc0IsIG1vdG9yLmF4aXNCKTsKICAgICAgfQogICAgfQoKICB9CiAgY29uc3QgSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb25zdHJhaW5zIHRoZSBzbGlwcGluZyBpbiBhIGNvbnRhY3QgYWxvbmcgYSB0YW5nZW50CiAgICovCiAgY2xhc3MgRnJpY3Rpb25FcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8vIFRhbmdlbnQKCiAgICAvKioKICAgICAqIEBwYXJhbSBzbGlwRm9yY2Ugc2hvdWxkIGJlICstRl9mcmljdGlvbiA9ICstbXUgKiBGX25vcm1hbCA9ICstbXUgKiBtICogZwogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIHNsaXBGb3JjZSkgewogICAgICBzdXBlcihib2R5QSwgYm9keUIsIC1zbGlwRm9yY2UsIHNsaXBGb3JjZSk7CiAgICAgIHRoaXMucmkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJqID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy50ID0gbmV3IFZlYzMoKTsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgdGhpcy5iaTsKICAgICAgdGhpcy5iajsKICAgICAgY29uc3QgcmkgPSB0aGlzLnJpOwogICAgICBjb25zdCByaiA9IHRoaXMucmo7CiAgICAgIGNvbnN0IHJpeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxOwogICAgICBjb25zdCByanh0ID0gRnJpY3Rpb25FcXVhdGlvbl9jb21wdXRlQl90ZW1wMjsKICAgICAgY29uc3QgdCA9IHRoaXMudDsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICByaS5jcm9zcyh0LCByaXh0KTsKICAgICAgcmouY3Jvc3ModCwgcmp4dCk7IC8vIEcgPSBbLXQgLXJpeHQgdCByanh0XQogICAgICAvLyBBbmQgcmVtZW1iZXIsIHRoaXMgaXMgYSBwdXJlIHZlbG9jaXR5IGNvbnN0cmFpbnQsIGcgaXMgYWx3YXlzIHplcm8hCgogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIHQubmVnYXRlKEdBLnNwYXRpYWwpOwogICAgICByaXh0Lm5lZ2F0ZShHQS5yb3RhdGlvbmFsKTsKICAgICAgR0Iuc3BhdGlhbC5jb3B5KHQpOwogICAgICBHQi5yb3RhdGlvbmFsLmNvcHkocmp4dCk7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1HVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KICBjb25zdCBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxID0gbmV3IFZlYzMoKTsKICBjb25zdCBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogRGVmaW5lcyB3aGF0IGhhcHBlbnMgd2hlbiB0d28gbWF0ZXJpYWxzIG1lZXQuCiAgICogQHRvZG8gUmVmYWN0b3IgbWF0ZXJpYWxzIHRvIG1hdGVyaWFsQSBhbmQgbWF0ZXJpYWxCCiAgICovCiAgY2xhc3MgQ29udGFjdE1hdGVyaWFsIHsKICAgIC8qKgogICAgICogSWRlbnRpZmllciBvZiB0aGlzIG1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBQYXJ0aWNpcGF0aW5nIG1hdGVyaWFscy4KICAgICAqLwoKICAgIC8qKgogICAgICogRnJpY3Rpb24gY29lZmZpY2llbnQuCiAgICAgKiBAZGVmYXVsdCAwLjMKICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gY29lZmZpY2llbnQuCiAgICAgKiBAZGVmYXVsdCAwLjMKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBwcm9kdWNlZCBjb250YWN0IGVxdWF0aW9ucy4KICAgICAqIEBkZWZhdWx0IDFlNwogICAgICovCgogICAgLyoqCiAgICAgKiBSZWxheGF0aW9uIHRpbWUgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGZyaWN0aW9uIGVxdWF0aW9ucy4KICAgICAqIEBkZWZhdWx0IDFlNwogICAgICovCgogICAgLyoqCiAgICAgKiBSZWxheGF0aW9uIHRpbWUgb2YgdGhlIHByb2R1Y2VkIGZyaWN0aW9uIGVxdWF0aW9ucwogICAgICogQGRlZmF1bHQgMwogICAgICovCiAgICBjb25zdHJ1Y3RvcihtMSwgbTIsIG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IFV0aWxzLmRlZmF1bHRzKG9wdGlvbnMsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjMsCiAgICAgICAgY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOiAxZTcsCiAgICAgICAgY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbjogMywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uU3RpZmZuZXNzOiAxZTcsCiAgICAgICAgZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb246IDMKICAgICAgfSk7CiAgICAgIHRoaXMuaWQgPSBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyKys7CiAgICAgIHRoaXMubWF0ZXJpYWxzID0gW20xLCBtMl07CiAgICAgIHRoaXMuZnJpY3Rpb24gPSBvcHRpb25zLmZyaWN0aW9uOwogICAgICB0aGlzLnJlc3RpdHV0aW9uID0gb3B0aW9ucy5yZXN0aXR1dGlvbjsKICAgICAgdGhpcy5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MgPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uID0gb3B0aW9ucy5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MgPSBvcHRpb25zLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uOwogICAgfQoKICB9CiAgQ29udGFjdE1hdGVyaWFsLmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIERlZmluZXMgYSBwaHlzaWNzIG1hdGVyaWFsLgogICAqLwogIGNsYXNzIE1hdGVyaWFsIHsKICAgIC8qKgogICAgICogTWF0ZXJpYWwgbmFtZS4KICAgICAqIElmIG9wdGlvbnMgaXMgYSBzdHJpbmcsIG5hbWUgd2lsbCBiZSBzZXQgdG8gdGhhdCBzdHJpbmcuCiAgICAgKiBAdG9kbyBEZXByZWNhdGUgdGhpcwogICAgICovCgogICAgLyoqIE1hdGVyaWFsIGlkLiAqLwoKICAgIC8qKgogICAgICogRnJpY3Rpb24gZm9yIHRoaXMgbWF0ZXJpYWwuCiAgICAgKiBJZiBub24tbmVnYXRpdmUsIGl0IHdpbGwgYmUgdXNlZCBpbnN0ZWFkIG9mIHRoZSBmcmljdGlvbiBnaXZlbiBieSBDb250YWN0TWF0ZXJpYWxzLiBJZiB0aGVyZSdzIG5vIG1hdGNoaW5nIENvbnRhY3RNYXRlcmlhbCwgdGhlIHZhbHVlIGZyb20gYGRlZmF1bHRDb250YWN0TWF0ZXJpYWxgIGluIHRoZSBXb3JsZCB3aWxsIGJlIHVzZWQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlc3RpdHV0aW9uIGZvciB0aGlzIG1hdGVyaWFsLgogICAgICogSWYgbm9uLW5lZ2F0aXZlLCBpdCB3aWxsIGJlIHVzZWQgaW5zdGVhZCBvZiB0aGUgcmVzdGl0dXRpb24gZ2l2ZW4gYnkgQ29udGFjdE1hdGVyaWFscy4gSWYgdGhlcmUncyBubyBtYXRjaGluZyBDb250YWN0TWF0ZXJpYWwsIHRoZSB2YWx1ZSBmcm9tIGBkZWZhdWx0Q29udGFjdE1hdGVyaWFsYCBpbiB0aGUgV29ybGQgd2lsbCBiZSB1c2VkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGxldCBuYW1lID0gJyc7IC8vIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IGZpeAoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnc3RyaW5nJykgewogICAgICAgIC8vY29uc29sZS53YXJuKGBQYXNzaW5nIGEgc3RyaW5nIHRvIE1hdGVyaWFsT3B0aW9ucyBpcyBkZXByZWNhdGVkLCBhbmQgaGFzIG5vIGVmZmVjdGApCiAgICAgICAgbmFtZSA9IG9wdGlvbnM7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICB0aGlzLmlkID0gTWF0ZXJpYWwuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuZnJpY3Rpb24gPSB0eXBlb2Ygb3B0aW9ucy5mcmljdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZyaWN0aW9uIDogLTE7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSB0eXBlb2Ygb3B0aW9ucy5yZXN0aXR1dGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnJlc3RpdHV0aW9uIDogLTE7CiAgICB9CgogIH0KICBNYXRlcmlhbC5pZENvdW50ZXIgPSAwOwoKICAvKioKICAgKiBBIHNwcmluZywgY29ubmVjdGluZyB0d28gYm9kaWVzLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHNwcmluZyA9IG5ldyBTcHJpbmcoYm94Qm9keSwgc3BoZXJlQm9keSwgewogICAqICAgICAgIHJlc3RMZW5ndGg6IDAsCiAgICogICAgICAgc3RpZmZuZXNzOiA1MCwKICAgKiAgICAgICBkYW1waW5nOiAxLAogICAqICAgICB9KQogICAqCiAgICogICAgIC8vIENvbXB1dGUgdGhlIGZvcmNlIGFmdGVyIGVhY2ggc3RlcAogICAqICAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIChldmVudCkgPT4gewogICAqICAgICAgIHNwcmluZy5hcHBseUZvcmNlKCkKICAgKiAgICAgfSkKICAgKi8KICBjbGFzcyBTcHJpbmcgewogICAgLyoqCiAgICAgKiBSZXN0IGxlbmd0aCBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+IDAuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFN0aWZmbmVzcyBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+PSAwLgogICAgICogQGRlZmF1bHQgMTAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERhbXBpbmcgb2YgdGhlIHNwcmluZy4gQSBudW1iZXIgPj0gMC4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogRmlyc3QgY29ubmVjdGVkIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNlY29uZCBjb25uZWN0ZWQgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogQW5jaG9yIGZvciBib2R5QSBpbiBsb2NhbCBib2R5QSBjb29yZGluYXRlcy4KICAgICAqIFdoZXJlIHRvIGhvb2sgdGhlIHNwcmluZyB0byBib2R5IEEsIGluIGxvY2FsIGJvZHkgY29vcmRpbmF0ZXMuCiAgICAgKiBAZGVmYXVsdCBuZXcgVmVjMygpCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFuY2hvciBmb3IgYm9keUIgaW4gbG9jYWwgYm9keUIgY29vcmRpbmF0ZXMuCiAgICAgKiBXaGVyZSB0byBob29rIHRoZSBzcHJpbmcgdG8gYm9keSBCLCBpbiBsb2NhbCBib2R5IGNvb3JkaW5hdGVzLgogICAgICogQGRlZmF1bHQgbmV3IFZlYzMoKQogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5yZXN0TGVuZ3RoID0gdHlwZW9mIG9wdGlvbnMucmVzdExlbmd0aCA9PT0gJ251bWJlcicgPyBvcHRpb25zLnJlc3RMZW5ndGggOiAxOwogICAgICB0aGlzLnN0aWZmbmVzcyA9IG9wdGlvbnMuc3RpZmZuZXNzIHx8IDEwMDsKICAgICAgdGhpcy5kYW1waW5nID0gb3B0aW9ucy5kYW1waW5nIHx8IDE7CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmxvY2FsQW5jaG9yQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMubG9jYWxBbmNob3JCID0gbmV3IFZlYzMoKTsKCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQSkgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JBLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckEpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5sb2NhbEFuY2hvckIpIHsKICAgICAgICB0aGlzLmxvY2FsQW5jaG9yQi5jb3B5KG9wdGlvbnMubG9jYWxBbmNob3JCKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMud29ybGRBbmNob3JBKSB7CiAgICAgICAgdGhpcy5zZXRXb3JsZEFuY2hvckEob3B0aW9ucy53b3JsZEFuY2hvckEpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckIpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQihvcHRpb25zLndvcmxkQW5jaG9yQik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBBLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckEod29ybGRBbmNob3JBKSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JBLCB0aGlzLmxvY2FsQW5jaG9yQSk7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgdXNpbmcgd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgc2V0V29ybGRBbmNob3JCKHdvcmxkQW5jaG9yQikgewogICAgICB0aGlzLmJvZHlCLnBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkQW5jaG9yQiwgdGhpcy5sb2NhbEFuY2hvckIpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIGluIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgdmVjdG9yIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgZ2V0V29ybGRBbmNob3JBKHJlc3VsdCkgewogICAgICB0aGlzLmJvZHlBLnBvaW50VG9Xb3JsZEZyYW1lKHRoaXMubG9jYWxBbmNob3JBLCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEIsIGluIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgdmVjdG9yIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgZ2V0V29ybGRBbmNob3JCKHJlc3VsdCkgewogICAgICB0aGlzLmJvZHlCLnBvaW50VG9Xb3JsZEZyYW1lKHRoaXMubG9jYWxBbmNob3JCLCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSB0aGUgc3ByaW5nIGZvcmNlIHRvIHRoZSBjb25uZWN0ZWQgYm9kaWVzLgogICAgICovCgoKICAgIGFwcGx5Rm9yY2UoKSB7CiAgICAgIGNvbnN0IGsgPSB0aGlzLnN0aWZmbmVzczsKICAgICAgY29uc3QgZCA9IHRoaXMuZGFtcGluZzsKICAgICAgY29uc3QgbCA9IHRoaXMucmVzdExlbmd0aDsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHIgPSBhcHBseUZvcmNlX3I7CiAgICAgIGNvbnN0IHJfdW5pdCA9IGFwcGx5Rm9yY2Vfcl91bml0OwogICAgICBjb25zdCB1ID0gYXBwbHlGb3JjZV91OwogICAgICBjb25zdCBmID0gYXBwbHlGb3JjZV9mOwogICAgICBjb25zdCB0bXAgPSBhcHBseUZvcmNlX3RtcDsKICAgICAgY29uc3Qgd29ybGRBbmNob3JBID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckE7CiAgICAgIGNvbnN0IHdvcmxkQW5jaG9yQiA9IGFwcGx5Rm9yY2Vfd29ybGRBbmNob3JCOwogICAgICBjb25zdCByaSA9IGFwcGx5Rm9yY2Vfcmk7CiAgICAgIGNvbnN0IHJqID0gYXBwbHlGb3JjZV9yajsKICAgICAgY29uc3QgcmlfeF9mID0gYXBwbHlGb3JjZV9yaV94X2Y7CiAgICAgIGNvbnN0IHJqX3hfZiA9IGFwcGx5Rm9yY2VfcmpfeF9mOyAvLyBHZXQgd29ybGQgYW5jaG9ycwoKICAgICAgdGhpcy5nZXRXb3JsZEFuY2hvckEod29ybGRBbmNob3JBKTsKICAgICAgdGhpcy5nZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKTsgLy8gR2V0IG9mZnNldCBwb2ludHMKCiAgICAgIHdvcmxkQW5jaG9yQS52c3ViKGJvZHlBLnBvc2l0aW9uLCByaSk7CiAgICAgIHdvcmxkQW5jaG9yQi52c3ViKGJvZHlCLnBvc2l0aW9uLCByaik7IC8vIENvbXB1dGUgZGlzdGFuY2UgdmVjdG9yIGJldHdlZW4gd29ybGQgYW5jaG9yIHBvaW50cwoKICAgICAgd29ybGRBbmNob3JCLnZzdWIod29ybGRBbmNob3JBLCByKTsKICAgICAgY29uc3QgcmxlbiA9IHIubGVuZ3RoKCk7CiAgICAgIHJfdW5pdC5jb3B5KHIpOwogICAgICByX3VuaXQubm9ybWFsaXplKCk7IC8vIENvbXB1dGUgcmVsYXRpdmUgdmVsb2NpdHkgb2YgdGhlIGFuY2hvciBwb2ludHMsIHUKCiAgICAgIGJvZHlCLnZlbG9jaXR5LnZzdWIoYm9keUEudmVsb2NpdHksIHUpOyAvLyBBZGQgcm90YXRpb25hbCB2ZWxvY2l0eQoKICAgICAgYm9keUIuYW5ndWxhclZlbG9jaXR5LmNyb3NzKHJqLCB0bXApOwogICAgICB1LnZhZGQodG1wLCB1KTsKICAgICAgYm9keUEuYW5ndWxhclZlbG9jaXR5LmNyb3NzKHJpLCB0bXApOwogICAgICB1LnZzdWIodG1wLCB1KTsgLy8gRiA9IC0gayAqICggeCAtIEwgKSAtIEQgKiAoIHUgKQoKICAgICAgcl91bml0LnNjYWxlKC1rICogKHJsZW4gLSBsKSAtIGQgKiB1LmRvdChyX3VuaXQpLCBmKTsgLy8gQWRkIGZvcmNlcyB0byBib2RpZXMKCiAgICAgIGJvZHlBLmZvcmNlLnZzdWIoZiwgYm9keUEuZm9yY2UpOwogICAgICBib2R5Qi5mb3JjZS52YWRkKGYsIGJvZHlCLmZvcmNlKTsgLy8gQW5ndWxhciBmb3JjZQoKICAgICAgcmkuY3Jvc3MoZiwgcmlfeF9mKTsKICAgICAgcmouY3Jvc3MoZiwgcmpfeF9mKTsKICAgICAgYm9keUEudG9ycXVlLnZzdWIocmlfeF9mLCBib2R5QS50b3JxdWUpOwogICAgICBib2R5Qi50b3JxdWUudmFkZChyal94X2YsIGJvZHlCLnRvcnF1ZSk7CiAgICB9CgogIH0KICBjb25zdCBhcHBseUZvcmNlX3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2Vfcl91bml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3UgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV93b3JsZEFuY2hvckEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2Vfd29ybGRBbmNob3JCID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JpID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JqID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JpX3hfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yal94X2YgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfdG1wID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogV2hlZWxJbmZvCiAgICovCiAgY2xhc3MgV2hlZWxJbmZvIHsKICAgIC8qKgogICAgICogTWF4IHRyYXZlbCBkaXN0YW5jZSBvZiB0aGUgc3VzcGVuc2lvbiwgaW4gbWV0ZXJzLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBTcGVlZCB0byBhcHBseSB0byB0aGUgd2hlZWwgcm90YXRpb24gd2hlbiB0aGUgd2hlZWwgaXMgc2xpZGluZy4KICAgICAqIEBkZWZhdWx0IC0wLjEKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgdGhlIGN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgc2hvdWxkIGJlIHVzZWQuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBzbGlkaW5nCiAgICAgKi8KCiAgICAvKioKICAgICAqIENvbm5lY3Rpb24gcG9pbnQsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgY2hhc3NpcyBib2R5IGZyYW1lLgogICAgICovCgogICAgLyoqCiAgICAgKiBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogZGlyZWN0aW9uTG9jYWwKICAgICAqLwoKICAgIC8qKgogICAgICogZGlyZWN0aW9uV29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogYXhsZUxvY2FsCiAgICAgKi8KCiAgICAvKioKICAgICAqIGF4bGVXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uUmVzdExlbmd0aAogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uTWF4TGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAyCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJhZGl1cwogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uU3RpZmZuZXNzCiAgICAgKiBAZGVmYXVsdCAxMDAKICAgICAqLwoKICAgIC8qKgogICAgICogZGFtcGluZ0NvbXByZXNzaW9uCiAgICAgKiBAZGVmYXVsdCAxMAogICAgICovCgogICAgLyoqCiAgICAgKiBkYW1waW5nUmVsYXhhdGlvbgogICAgICogQGRlZmF1bHQgMTAKICAgICAqLwoKICAgIC8qKgogICAgICogZnJpY3Rpb25TbGlwCiAgICAgKiBAZGVmYXVsdCAxMC41CiAgICAgKi8KCiAgICAvKiogZm9yd2FyZEFjY2VsZXJhdGlvbiAqLwoKICAgIC8qKiBzaWRlQWNjZWxlcmF0aW9uICovCgogICAgLyoqCiAgICAgKiBzdGVlcmluZwogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBSb3RhdGlvbiB2YWx1ZSwgaW4gcmFkaWFucy4KICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogZGVsdGFSb3RhdGlvbgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiByb2xsSW5mbHVlbmNlCiAgICAgKiBAZGVmYXVsdCAwLjAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heFN1c3BlbnNpb25Gb3JjZQogICAgICovCgogICAgLyoqCiAgICAgKiBlbmdpbmVGb3JjZQogICAgICovCgogICAgLyoqCiAgICAgKiBicmFrZQogICAgICovCgogICAgLyoqCiAgICAgKiBpc0Zyb250V2hlZWwKICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5CiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25Gb3JjZQogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBzbGlwSW5mbwogICAgICovCgogICAgLyoqCiAgICAgKiBza2lkSW5mbwogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uTGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNpZGVJbXB1bHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGZvcndhcmRJbXB1bHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSByZXN1bHQgZnJvbSByYXljYXN0aW5nLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVlbCB3b3JsZCB0cmFuc2Zvcm0uCiAgICAgKi8KCiAgICAvKioKICAgICAqIGlzSW5Db250YWN0CiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgb3B0aW9ucyA9IFV0aWxzLmRlZmF1bHRzKG9wdGlvbnMsIHsKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkOiBuZXcgVmVjMygpLAogICAgICAgIGRpcmVjdGlvbkxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGRpcmVjdGlvbldvcmxkOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBheGxlV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgc3VzcGVuc2lvblJlc3RMZW5ndGg6IDEsCiAgICAgICAgc3VzcGVuc2lvbk1heExlbmd0aDogMiwKICAgICAgICByYWRpdXM6IDEsCiAgICAgICAgc3VzcGVuc2lvblN0aWZmbmVzczogMTAwLAogICAgICAgIGRhbXBpbmdDb21wcmVzc2lvbjogMTAsCiAgICAgICAgZGFtcGluZ1JlbGF4YXRpb246IDEwLAogICAgICAgIGZyaWN0aW9uU2xpcDogMTAuNSwKICAgICAgICBmb3J3YXJkQWNjZWxlcmF0aW9uOiAxLAogICAgICAgIHNpZGVBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc3RlZXJpbmc6IDAsCiAgICAgICAgcm90YXRpb246IDAsCiAgICAgICAgZGVsdGFSb3RhdGlvbjogMCwKICAgICAgICByb2xsSW5mbHVlbmNlOiAwLjAxLAogICAgICAgIG1heFN1c3BlbnNpb25Gb3JjZTogTnVtYmVyLk1BWF9WQUxVRSwKICAgICAgICBpc0Zyb250V2hlZWw6IHRydWUsCiAgICAgICAgY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uOiAxLAogICAgICAgIHN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5OiAwLAogICAgICAgIHN1c3BlbnNpb25Gb3JjZTogMCwKICAgICAgICBzbGlwSW5mbzogMCwKICAgICAgICBza2lkSW5mbzogMCwKICAgICAgICBzdXNwZW5zaW9uTGVuZ3RoOiAwLAogICAgICAgIG1heFN1c3BlbnNpb25UcmF2ZWw6IDEsCiAgICAgICAgdXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDogZmFsc2UsCiAgICAgICAgY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDogLTAuMQogICAgICB9KTsKICAgICAgdGhpcy5tYXhTdXNwZW5zaW9uVHJhdmVsID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICB0aGlzLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgPSBvcHRpb25zLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQ7CiAgICAgIHRoaXMudXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMudXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy5zbGlkaW5nID0gZmFsc2U7CiAgICAgIHRoaXMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsID0gb3B0aW9ucy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLmRpcmVjdGlvbkxvY2FsID0gb3B0aW9ucy5kaXJlY3Rpb25Mb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmRpcmVjdGlvbldvcmxkID0gb3B0aW9ucy5kaXJlY3Rpb25Xb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLmF4bGVMb2NhbCA9IG9wdGlvbnMuYXhsZUxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZVdvcmxkID0gb3B0aW9ucy5heGxlV29ybGQuY2xvbmUoKTsKICAgICAgdGhpcy5zdXNwZW5zaW9uUmVzdExlbmd0aCA9IG9wdGlvbnMuc3VzcGVuc2lvblJlc3RMZW5ndGg7CiAgICAgIHRoaXMuc3VzcGVuc2lvbk1heExlbmd0aCA9IG9wdGlvbnMuc3VzcGVuc2lvbk1heExlbmd0aDsKICAgICAgdGhpcy5yYWRpdXMgPSBvcHRpb25zLnJhZGl1czsKICAgICAgdGhpcy5zdXNwZW5zaW9uU3RpZmZuZXNzID0gb3B0aW9ucy5zdXNwZW5zaW9uU3RpZmZuZXNzOwogICAgICB0aGlzLmRhbXBpbmdDb21wcmVzc2lvbiA9IG9wdGlvbnMuZGFtcGluZ0NvbXByZXNzaW9uOwogICAgICB0aGlzLmRhbXBpbmdSZWxheGF0aW9uID0gb3B0aW9ucy5kYW1waW5nUmVsYXhhdGlvbjsKICAgICAgdGhpcy5mcmljdGlvblNsaXAgPSBvcHRpb25zLmZyaWN0aW9uU2xpcDsKICAgICAgdGhpcy5mb3J3YXJkQWNjZWxlcmF0aW9uID0gb3B0aW9ucy5mb3J3YXJkQWNjZWxlcmF0aW9uOwogICAgICB0aGlzLnNpZGVBY2NlbGVyYXRpb24gPSBvcHRpb25zLnNpZGVBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc3RlZXJpbmcgPSAwOwogICAgICB0aGlzLnJvdGF0aW9uID0gMDsKICAgICAgdGhpcy5kZWx0YVJvdGF0aW9uID0gMDsKICAgICAgdGhpcy5yb2xsSW5mbHVlbmNlID0gb3B0aW9ucy5yb2xsSW5mbHVlbmNlOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25Gb3JjZSA9IG9wdGlvbnMubWF4U3VzcGVuc2lvbkZvcmNlOwogICAgICB0aGlzLmVuZ2luZUZvcmNlID0gMDsKICAgICAgdGhpcy5icmFrZSA9IDA7CiAgICAgIHRoaXMuaXNGcm9udFdoZWVsID0gb3B0aW9ucy5pc0Zyb250V2hlZWw7CiAgICAgIHRoaXMuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gMTsKICAgICAgdGhpcy5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkZvcmNlID0gMDsKICAgICAgdGhpcy5zbGlwSW5mbyA9IDA7CiAgICAgIHRoaXMuc2tpZEluZm8gPSAwOwogICAgICB0aGlzLnN1c3BlbnNpb25MZW5ndGggPSAwOwogICAgICB0aGlzLnNpZGVJbXB1bHNlID0gMDsKICAgICAgdGhpcy5mb3J3YXJkSW1wdWxzZSA9IDA7CiAgICAgIHRoaXMucmF5Y2FzdFJlc3VsdCA9IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMud29ybGRUcmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKCk7CiAgICAgIHRoaXMuaXNJbkNvbnRhY3QgPSBmYWxzZTsKICAgIH0KCiAgICB1cGRhdGVXaGVlbChjaGFzc2lzKSB7CiAgICAgIGNvbnN0IHJheWNhc3RSZXN1bHQgPSB0aGlzLnJheWNhc3RSZXN1bHQ7CgogICAgICBpZiAodGhpcy5pc0luQ29udGFjdCkgewogICAgICAgIGNvbnN0IHByb2plY3QgPSByYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLmRvdChyYXljYXN0UmVzdWx0LmRpcmVjdGlvbldvcmxkKTsKICAgICAgICByYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQudnN1YihjaGFzc2lzLnBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNoYXNzaXMuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocmVscG9zLCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CiAgICAgICAgY29uc3QgcHJvalZlbCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKCiAgICAgICAgaWYgKHByb2plY3QgPj0gLTAuMSkgewogICAgICAgICAgdGhpcy5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IDAuMDsKICAgICAgICAgIHRoaXMuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gMS4wIC8gMC4xOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBpbnYgPSAtMSAvIHByb2plY3Q7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gcHJvalZlbCAqIGludjsKICAgICAgICAgIHRoaXMuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gaW52OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBOb3QgaW4gY29udGFjdCA6IHBvc2l0aW9uIHdoZWVsIGluIGEgbmljZSAocmVzdCBsZW5ndGgpIHBvc2l0aW9uCiAgICAgICAgcmF5Y2FzdFJlc3VsdC5zdXNwZW5zaW9uTGVuZ3RoID0gdGhpcy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgIHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQuc2NhbGUoLTEsIHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQpOwogICAgICAgIHRoaXMuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gMS4wOwogICAgICB9CiAgICB9CgogIH0KICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVscG9zID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogVmVoaWNsZSBoZWxwZXIgY2xhc3MgdGhhdCBjYXN0cyByYXlzIGZyb20gdGhlIHdoZWVsIHBvc2l0aW9ucyB0b3dhcmRzIHRoZSBncm91bmQgYW5kIGFwcGxpZXMgZm9yY2VzLgogICAqLwogIGNsYXNzIFJheWNhc3RWZWhpY2xlIHsKICAgIC8qKiBUaGUgY2FyIGNoYXNzaXMgYm9keS4gKi8KCiAgICAvKiogVGhlIHdoZWVscy4gKi8KCiAgICAvKiogV2lsbCBiZSBzZXQgdG8gdHJ1ZSBpZiB0aGUgY2FyIGlzIHNsaWRpbmcuICovCgogICAgLyoqIEluZGV4IG9mIHRoZSByaWdodCBheGlzLiB4PTAsIHk9MSwgej0yICovCgogICAgLyoqIEluZGV4IG9mIHRoZSBmb3J3YXJkIGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHVwIGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogVGhlIGNvbnN0cmFpbnRzLiAqLwoKICAgIC8qKiBPcHRpb25hbCBwcmUtc3RlcCBjYWxsYmFjay4gKi8KCiAgICAvKiogTnVtYmVyIG9mIHdoZWVscyBvbiB0aGUgZ3JvdW5kLiAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICB0aGlzLmNoYXNzaXNCb2R5ID0gb3B0aW9ucy5jaGFzc2lzQm9keTsKICAgICAgdGhpcy53aGVlbEluZm9zID0gW107CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwogICAgICB0aGlzLndvcmxkID0gbnVsbDsKICAgICAgdGhpcy5pbmRleFJpZ2h0QXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4UmlnaHRBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhSaWdodEF4aXMgOiAyOwogICAgICB0aGlzLmluZGV4Rm9yd2FyZEF4aXMgPSB0eXBlb2Ygb3B0aW9ucy5pbmRleEZvcndhcmRBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhGb3J3YXJkQXhpcyA6IDA7CiAgICAgIHRoaXMuaW5kZXhVcEF4aXMgPSB0eXBlb2Ygb3B0aW9ucy5pbmRleFVwQXhpcyAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmluZGV4VXBBeGlzIDogMTsKICAgICAgdGhpcy5jb25zdHJhaW50cyA9IFtdOwoKICAgICAgdGhpcy5wcmVTdGVwQ2FsbGJhY2sgPSAoKSA9PiB7fTsKCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDA7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSB3aGVlbC4gRm9yIGluZm9ybWF0aW9uIGFib3V0IHRoZSBvcHRpb25zLCBzZWUgYFdoZWVsSW5mb2AuCiAgICAgKi8KCgogICAgYWRkV2hlZWwob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBpbmZvID0gbmV3IFdoZWVsSW5mbyhvcHRpb25zKTsKICAgICAgY29uc3QgaW5kZXggPSB0aGlzLndoZWVsSW5mb3MubGVuZ3RoOwogICAgICB0aGlzLndoZWVsSW5mb3MucHVzaChpbmZvKTsKICAgICAgcmV0dXJuIGluZGV4OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHN0ZWVyaW5nIHZhbHVlIG9mIGEgd2hlZWwuCiAgICAgKi8KCgogICAgc2V0U3RlZXJpbmdWYWx1ZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICBjb25zdCB3aGVlbCA9IHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XTsKICAgICAgd2hlZWwuc3RlZXJpbmcgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSB3aGVlbCBmb3JjZSB0byBhcHBseSBvbiBvbmUgb2YgdGhlIHdoZWVscyBlYWNoIHRpbWUgc3RlcAogICAgICovCgoKICAgIGFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpIHsKICAgICAgdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdLmVuZ2luZUZvcmNlID0gdmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgYnJha2luZyBmb3JjZSBvZiBhIHdoZWVsCiAgICAgKi8KCgogICAgc2V0QnJha2UoYnJha2UsIHdoZWVsSW5kZXgpIHsKICAgICAgdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdLmJyYWtlID0gYnJha2U7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCB0aGUgdmVoaWNsZSBpbmNsdWRpbmcgaXRzIGNvbnN0cmFpbnRzIHRvIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICBhZGRUb1dvcmxkKHdvcmxkKSB7CiAgICAgIHdvcmxkLmFkZEJvZHkodGhpcy5jaGFzc2lzQm9keSk7CiAgICAgIGNvbnN0IHRoYXQgPSB0aGlzOwoKICAgICAgdGhpcy5wcmVTdGVwQ2FsbGJhY2sgPSAoKSA9PiB7CiAgICAgICAgdGhhdC51cGRhdGVWZWhpY2xlKHdvcmxkLmR0KTsKICAgICAgfTsKCiAgICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCB0aGlzLnByZVN0ZXBDYWxsYmFjayk7CiAgICAgIHRoaXMud29ybGQgPSB3b3JsZDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IG9uZSBvZiB0aGUgd2hlZWwgYXhsZXMsIHdvcmxkLW9yaWVudGVkLgogICAgICovCgoKICAgIGdldFZlaGljbGVBeGlzV29ybGQoYXhpc0luZGV4LCByZXN1bHQpIHsKICAgICAgcmVzdWx0LnNldChheGlzSW5kZXggPT09IDAgPyAxIDogMCwgYXhpc0luZGV4ID09PSAxID8gMSA6IDAsIGF4aXNJbmRleCA9PT0gMiA/IDEgOiAwKTsKICAgICAgdGhpcy5jaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUocmVzdWx0LCByZXN1bHQpOwogICAgfQoKICAgIHVwZGF0ZVZlaGljbGUodGltZVN0ZXApIHsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtKGkpOwogICAgICB9CgogICAgICB0aGlzLmN1cnJlbnRWZWhpY2xlU3BlZWRLbUhvdXIgPSAzLjYgKiBjaGFzc2lzQm9keS52ZWxvY2l0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZm9yd2FyZFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5nZXRWZWhpY2xlQXhpc1dvcmxkKHRoaXMuaW5kZXhGb3J3YXJkQXhpcywgZm9yd2FyZFdvcmxkKTsKCiAgICAgIGlmIChmb3J3YXJkV29ybGQuZG90KGNoYXNzaXNCb2R5LnZlbG9jaXR5KSA8IDApIHsKICAgICAgICB0aGlzLmN1cnJlbnRWZWhpY2xlU3BlZWRLbUhvdXIgKj0gLTE7CiAgICAgIH0gLy8gc2ltdWxhdGUgc3VzcGVuc2lvbgoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICB0aGlzLmNhc3RSYXkod2hlZWxJbmZvc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlU3VzcGVuc2lvbih0aW1lU3RlcCk7CiAgICAgIGNvbnN0IGltcHVsc2UgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIC8vYXBwbHkgc3VzcGVuc2lvbiBmb3JjZQogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBsZXQgc3VzcGVuc2lvbkZvcmNlID0gd2hlZWwuc3VzcGVuc2lvbkZvcmNlOwoKICAgICAgICBpZiAoc3VzcGVuc2lvbkZvcmNlID4gd2hlZWwubWF4U3VzcGVuc2lvbkZvcmNlKSB7CiAgICAgICAgICBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgICAgfQoKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLnNjYWxlKHN1c3BlbnNpb25Gb3JjZSAqIHRpbWVTdGVwLCBpbXB1bHNlKTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2UoaW1wdWxzZSwgcmVscG9zKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVGcmljdGlvbih0aW1lU3RlcCk7CiAgICAgIGNvbnN0IGhpdE5vcm1hbFdvcmxkU2NhbGVkV2l0aFByb2ogPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBmd2QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCB2ZWwgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsgLy9jb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwogICAgICAgIC8vd2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLnZzdWIoY2hhc3Npc0JvZHkucG9zaXRpb24sIHJlbHBvcyk7CgogICAgICAgIGNoYXNzaXNCb2R5LmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCwgdmVsKTsgLy8gSGFjayB0byBnZXQgdGhlIHJvdGF0aW9uIGluIHRoZSBjb3JyZWN0IGRpcmVjdGlvbgoKICAgICAgICBsZXQgbSA9IDE7CgogICAgICAgIHN3aXRjaCAodGhpcy5pbmRleFVwQXhpcykgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICBtID0gLTE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdoZWVsLmlzSW5Db250YWN0KSB7CiAgICAgICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvaiA9IGZ3ZC5kb3Qod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLnNjYWxlKHByb2osIGhpdE5vcm1hbFdvcmxkU2NhbGVkV2l0aFByb2opOwogICAgICAgICAgZndkLnZzdWIoaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiwgZndkKTsKICAgICAgICAgIGNvbnN0IHByb2oyID0gZndkLmRvdCh2ZWwpOwogICAgICAgICAgd2hlZWwuZGVsdGFSb3RhdGlvbiA9IG0gKiBwcm9qMiAqIHRpbWVTdGVwIC8gd2hlZWwucmFkaXVzOwogICAgICAgIH0KCiAgICAgICAgaWYgKCh3aGVlbC5zbGlkaW5nIHx8ICF3aGVlbC5pc0luQ29udGFjdCkgJiYgd2hlZWwuZW5naW5lRm9yY2UgIT09IDAgJiYgd2hlZWwudXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCkgewogICAgICAgICAgLy8gQXBwbHkgY3VzdG9tIHJvdGF0aW9uIHdoZW4gYWNjZWxlcmF0aW5nIGFuZCBzbGlkaW5nCiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gKHdoZWVsLmVuZ2luZUZvcmNlID4gMCA/IDEgOiAtMSkgKiB3aGVlbC5jdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkICogdGltZVN0ZXA7CiAgICAgICAgfSAvLyBMb2NrIHdoZWVscwoKCiAgICAgICAgaWYgKE1hdGguYWJzKHdoZWVsLmJyYWtlKSA+IE1hdGguYWJzKHdoZWVsLmVuZ2luZUZvcmNlKSkgewogICAgICAgICAgd2hlZWwuZGVsdGFSb3RhdGlvbiA9IDA7CiAgICAgICAgfQoKICAgICAgICB3aGVlbC5yb3RhdGlvbiArPSB3aGVlbC5kZWx0YVJvdGF0aW9uOyAvLyBVc2UgdGhlIG9sZCB2YWx1ZQoKICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uICo9IDAuOTk7IC8vIGRhbXBpbmcgb2Ygcm90YXRpb24gd2hlbiBub3QgaW4gY29udGFjdAogICAgICB9CiAgICB9CgogICAgdXBkYXRlU3VzcGVuc2lvbihkZWx0YVRpbWUpIHsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwogICAgICBjb25zdCBjaGFzc2lzTWFzcyA9IGNoYXNzaXNCb2R5Lm1hc3M7CiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgd19pdCA9IDA7IHdfaXQgPCBudW1XaGVlbHM7IHdfaXQrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1t3X2l0XTsKCiAgICAgICAgaWYgKHdoZWVsLmlzSW5Db250YWN0KSB7CiAgICAgICAgICBsZXQgZm9yY2U7IC8vIFNwcmluZwoKICAgICAgICAgIGNvbnN0IHN1c3BfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvblJlc3RMZW5ndGg7CiAgICAgICAgICBjb25zdCBjdXJyZW50X2xlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICBjb25zdCBsZW5ndGhfZGlmZiA9IHN1c3BfbGVuZ3RoIC0gY3VycmVudF9sZW5ndGg7CiAgICAgICAgICBmb3JjZSA9IHdoZWVsLnN1c3BlbnNpb25TdGlmZm5lc3MgKiBsZW5ndGhfZGlmZiAqIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbjsgLy8gRGFtcGVyCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkX3JlbF92ZWwgPSB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eTsKICAgICAgICAgIGxldCBzdXNwX2RhbXBpbmc7CgogICAgICAgICAgaWYgKHByb2plY3RlZF9yZWxfdmVsIDwgMCkgewogICAgICAgICAgICBzdXNwX2RhbXBpbmcgPSB3aGVlbC5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdXNwX2RhbXBpbmcgPSB3aGVlbC5kYW1waW5nUmVsYXhhdGlvbjsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3JjZSAtPSBzdXNwX2RhbXBpbmcgKiBwcm9qZWN0ZWRfcmVsX3ZlbDsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25Gb3JjZSA9IGZvcmNlICogY2hhc3Npc01hc3M7CgogICAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25Gb3JjZSA8IDApIHsKICAgICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gMDsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gMDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgZnJvbSB0aGUgd29ybGQuCiAgICAgKi8KCgogICAgcmVtb3ZlRnJvbVdvcmxkKHdvcmxkKSB7CiAgICAgIHRoaXMuY29uc3RyYWludHM7CiAgICAgIHdvcmxkLnJlbW92ZUJvZHkodGhpcy5jaGFzc2lzQm9keSk7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCB0aGlzLnByZVN0ZXBDYWxsYmFjayk7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgfQoKICAgIGNhc3RSYXkod2hlZWwpIHsKICAgICAgY29uc3QgcmF5dmVjdG9yID0gY2FzdFJheV9yYXl2ZWN0b3I7CiAgICAgIGNvbnN0IHRhcmdldCA9IGNhc3RSYXlfdGFyZ2V0OwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGxldCBkZXB0aCA9IC0xOwogICAgICBjb25zdCByYXlsZW4gPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIHdoZWVsLnJhZGl1czsKICAgICAgd2hlZWwuZGlyZWN0aW9uV29ybGQuc2NhbGUocmF5bGVuLCByYXl2ZWN0b3IpOwogICAgICBjb25zdCBzb3VyY2UgPSB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ7CiAgICAgIHNvdXJjZS52YWRkKHJheXZlY3RvciwgdGFyZ2V0KTsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQ7CiAgICAgIHJheWNhc3RSZXN1bHQucmVzZXQoKTsgLy8gVHVybiBvZmYgcmF5IGNvbGxpc2lvbiB3aXRoIHRoZSBjaGFzc2lzIHRlbXBvcmFyaWx5CgogICAgICBjb25zdCBvbGRTdGF0ZSA9IGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBjaGFzc2lzQm9keS5jb2xsaXNpb25SZXNwb25zZSA9IGZhbHNlOyAvLyBDYXN0IHJheSBhZ2FpbnN0IHdvcmxkCgogICAgICB0aGlzLndvcmxkLnJheVRlc3Qoc291cmNlLCB0YXJnZXQsIHJheWNhc3RSZXN1bHQpOwogICAgICBjaGFzc2lzQm9keS5jb2xsaXNpb25SZXNwb25zZSA9IG9sZFN0YXRlOwogICAgICBjb25zdCBvYmplY3QgPSByYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuZ3JvdW5kT2JqZWN0ID0gMDsKCiAgICAgIGlmIChvYmplY3QpIHsKICAgICAgICBkZXB0aCA9IHJheWNhc3RSZXN1bHQuZGlzdGFuY2U7CiAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQ7CiAgICAgICAgd2hlZWwuaXNJbkNvbnRhY3QgPSB0cnVlOwogICAgICAgIGNvbnN0IGhpdERpc3RhbmNlID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gaGl0RGlzdGFuY2UgLSB3aGVlbC5yYWRpdXM7IC8vIGNsYW1wIG9uIG1heCBzdXNwZW5zaW9uIHRyYXZlbAoKICAgICAgICBjb25zdCBtaW5TdXNwZW5zaW9uTGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvblJlc3RMZW5ndGggLSB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIGNvbnN0IG1heFN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoIDwgbWluU3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1pblN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA+IG1heFN1c3BlbnNpb25MZW5ndGgpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBtYXhTdXNwZW5zaW9uTGVuZ3RoOwogICAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5yZXNldCgpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZGVub21pbmF0b3IgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLmRvdCh3aGVlbC5kaXJlY3Rpb25Xb3JsZCk7CiAgICAgICAgY29uc3QgY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQgPSBuZXcgVmVjMygpOwogICAgICAgIGNoYXNzaXNCb2R5LmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwogICAgICAgIGNvbnN0IHByb2pWZWwgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLmRvdChjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CgogICAgICAgIGlmIChkZW5vbWluYXRvciA+PSAtMC4xKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IDA7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxIC8gMC4xOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBpbnYgPSAtMSAvIGRlbm9taW5hdG9yOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gaW52OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvL3B1dCB3aGVlbCBpbmZvIGFzIGluIHJlc3QgcG9zaXRpb24KICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvblJlc3RMZW5ndGggKyAwICogd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IDAuMDsKICAgICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gMS4wOwogICAgICB9CgogICAgICByZXR1cm4gZGVwdGg7CiAgICB9CgogICAgdXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCkgewogICAgICB3aGVlbC5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNoYXNzaXNCb2R5LnBvaW50VG9Xb3JsZEZyYW1lKHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCwgd2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmRpcmVjdGlvbkxvY2FsLCB3aGVlbC5kaXJlY3Rpb25Xb3JsZCk7CiAgICAgIGNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZSh3aGVlbC5heGxlTG9jYWwsIHdoZWVsLmF4bGVXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBvbmUgb2YgdGhlIHdoZWVsIHRyYW5zZm9ybS4KICAgICAqIE5vdGUgd2hlbiByZW5kZXJpbmcgd2hlZWxzOiBkdXJpbmcgZWFjaCBzdGVwLCB3aGVlbCB0cmFuc2Zvcm1zIGFyZSB1cGRhdGVkIEJFRk9SRSB0aGUgY2hhc3NpczsgaWUuIHRoZWlyIHBvc2l0aW9uIGJlY29tZXMgaW52YWxpZCBhZnRlciB0aGUgc3RlcC4gVGh1cyB3aGVuIHlvdSByZW5kZXIgd2hlZWxzLCB5b3UgbXVzdCB1cGRhdGUgd2hlZWwgdHJhbnNmb3JtcyBiZWZvcmUgcmVuZGVyaW5nIHRoZW0uIFNlZSByYXljYXN0VmVoaWNsZSBkZW1vIGZvciBhbiBleGFtcGxlLgogICAgICogQHBhcmFtIHdoZWVsSW5kZXggVGhlIHdoZWVsIGluZGV4IHRvIHVwZGF0ZS4KICAgICAqLwoKCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybSh3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHVwID0gdG1wVmVjNDsKICAgICAgY29uc3QgcmlnaHQgPSB0bXBWZWM1OwogICAgICBjb25zdCBmd2QgPSB0bXBWZWM2OwogICAgICBjb25zdCB3aGVlbCA9IHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XTsKICAgICAgdGhpcy51cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKTsKICAgICAgd2hlZWwuZGlyZWN0aW9uTG9jYWwuc2NhbGUoLTEsIHVwKTsKICAgICAgcmlnaHQuY29weSh3aGVlbC5heGxlTG9jYWwpOwogICAgICB1cC5jcm9zcyhyaWdodCwgZndkKTsKICAgICAgZndkLm5vcm1hbGl6ZSgpOwogICAgICByaWdodC5ub3JtYWxpemUoKTsgLy8gUm90YXRlIGFyb3VuZCBzdGVlcmluZyBvdmVyIHRoZSB3aGVlbEF4bGUKCiAgICAgIGNvbnN0IHN0ZWVyaW5nID0gd2hlZWwuc3RlZXJpbmc7CiAgICAgIGNvbnN0IHN0ZWVyaW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgc3RlZXJpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZSh1cCwgc3RlZXJpbmcpOwogICAgICBjb25zdCByb3RhdGluZ09ybiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHJvdGF0aW5nT3JuLnNldEZyb21BeGlzQW5nbGUocmlnaHQsIHdoZWVsLnJvdGF0aW9uKTsgLy8gV29ybGQgcm90YXRpb24gb2YgdGhlIHdoZWVsCgogICAgICBjb25zdCBxID0gd2hlZWwud29ybGRUcmFuc2Zvcm0ucXVhdGVybmlvbjsKICAgICAgdGhpcy5jaGFzc2lzQm9keS5xdWF0ZXJuaW9uLm11bHQoc3RlZXJpbmdPcm4sIHEpOwogICAgICBxLm11bHQocm90YXRpbmdPcm4sIHEpOwogICAgICBxLm5vcm1hbGl6ZSgpOyAvLyB3b3JsZCBwb3NpdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHAgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5wb3NpdGlvbjsKICAgICAgcC5jb3B5KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgcC5zY2FsZSh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoLCBwKTsKICAgICAgcC52YWRkKHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCwgcCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgdHJhbnNmb3JtIG9mIG9uZSBvZiB0aGUgd2hlZWxzCiAgICAgKi8KCgogICAgZ2V0V2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbEluZGV4KSB7CiAgICAgIHJldHVybiB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0ud29ybGRUcmFuc2Zvcm07CiAgICB9CgogICAgdXBkYXRlRnJpY3Rpb24odGltZVN0ZXApIHsKICAgICAgY29uc3Qgc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qID0gdXBkYXRlRnJpY3Rpb25fc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qOyAvL2NhbGN1bGF0ZSB0aGUgaW1wdWxzZSwgc28gdGhhdCB0aGUgd2hlZWxzIGRvbid0IG1vdmUgc2lkZXdhcmRzCgogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwogICAgICBjb25zdCBmb3J3YXJkV1MgPSB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1M7CiAgICAgIGNvbnN0IGF4bGUgPSB1cGRhdGVGcmljdGlvbl9heGxlOwogICAgICB0aGlzLm51bVdoZWVsc09uR3JvdW5kID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICB0aGlzLm51bVdoZWVsc09uR3JvdW5kKys7CiAgICAgICAgfQoKICAgICAgICB3aGVlbC5zaWRlSW1wdWxzZSA9IDA7CiAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSAwOwoKICAgICAgICBpZiAoIWZvcndhcmRXU1tpXSkgewogICAgICAgICAgZm9yd2FyZFdTW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CgogICAgICAgIGlmICghYXhsZVtpXSkgewogICAgICAgICAgYXhsZVtpXSA9IG5ldyBWZWMzKCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKCiAgICAgICAgaWYgKGdyb3VuZE9iamVjdCkgewogICAgICAgICAgY29uc3QgYXhsZWkgPSBheGxlW2ldOwogICAgICAgICAgY29uc3Qgd2hlZWxUcmFucyA9IHRoaXMuZ2V0V2hlZWxUcmFuc2Zvcm1Xb3JsZChpKTsgLy8gR2V0IHdvcmxkIGF4bGUKCiAgICAgICAgICB3aGVlbFRyYW5zLnZlY3RvclRvV29ybGRGcmFtZShkaXJlY3Rpb25zW3RoaXMuaW5kZXhSaWdodEF4aXNdLCBheGxlaSk7CiAgICAgICAgICBjb25zdCBzdXJmTm9ybWFsV1MgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkOwogICAgICAgICAgY29uc3QgcHJvaiA9IGF4bGVpLmRvdChzdXJmTm9ybWFsV1MpOwogICAgICAgICAgc3VyZk5vcm1hbFdTLnNjYWxlKHByb2osIHN1cmZOb3JtYWxXU19zY2FsZWRfcHJvaik7CiAgICAgICAgICBheGxlaS52c3ViKHN1cmZOb3JtYWxXU19zY2FsZWRfcHJvaiwgYXhsZWkpOwogICAgICAgICAgYXhsZWkubm9ybWFsaXplKCk7CiAgICAgICAgICBzdXJmTm9ybWFsV1MuY3Jvc3MoYXhsZWksIGZvcndhcmRXU1tpXSk7CiAgICAgICAgICBmb3J3YXJkV1NbaV0ubm9ybWFsaXplKCk7CiAgICAgICAgICB3aGVlbC5zaWRlSW1wdWxzZSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWwoY2hhc3Npc0JvZHksIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGF4bGVpKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHNpZGVGcmljdGlvblN0aWZmbmVzczI7CiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zdCBzaWRlRmFjdG9yID0gMTsKICAgICAgY29uc3QgZndkRmFjdG9yID0gMC41OwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwogICAgICAgIGxldCByb2xsaW5nRnJpY3Rpb24gPSAwOwogICAgICAgIHdoZWVsLnNsaXBJbmZvID0gMTsKCiAgICAgICAgaWYgKGdyb3VuZE9iamVjdCkgewogICAgICAgICAgY29uc3QgZGVmYXVsdFJvbGxpbmdGcmljdGlvbkltcHVsc2UgPSAwOwogICAgICAgICAgY29uc3QgbWF4SW1wdWxzZSA9IHdoZWVsLmJyYWtlID8gd2hlZWwuYnJha2UgOiBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZTsgLy8gYnRXaGVlbENvbnRhY3RQb2ludCBjb250YWN0UHQoY2hhc3Npc0JvZHksZ3JvdW5kT2JqZWN0LHdoZWVsSW5mcmF5Y2FzdEluZm8uaGl0UG9pbnRXb3JsZCxmb3J3YXJkV1Nbd2hlZWxdLG1heEltcHVsc2UpOwogICAgICAgICAgLy8gcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjb250YWN0UHQpOwoKICAgICAgICAgIHJvbGxpbmdGcmljdGlvbiA9IGNhbGNSb2xsaW5nRnJpY3Rpb24oY2hhc3Npc0JvZHksIGdyb3VuZE9iamVjdCwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBmb3J3YXJkV1NbaV0sIG1heEltcHVsc2UpOwogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uICs9IHdoZWVsLmVuZ2luZUZvcmNlICogdGltZVN0ZXA7IC8vIHJvbGxpbmdGcmljdGlvbiA9IDA7CgogICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4SW1wdWxzZSAvIHJvbGxpbmdGcmljdGlvbjsKICAgICAgICAgIHdoZWVsLnNsaXBJbmZvICo9IGZhY3RvcjsKICAgICAgICB9IC8vc3dpdGNoIGJldHdlZW4gYWN0aXZlIHJvbGxpbmcgKHRocm90dGxlKSwgYnJha2luZyBhbmQgbm9uLWFjdGl2ZSByb2xsaW5nIGZyaWN0aW9uIChudGhyb3R0bGUvYnJlYWspCgoKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CiAgICAgICAgd2hlZWwuc2tpZEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CiAgICAgICAgICBjb25zdCBtYXhpbXAgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgKiB0aW1lU3RlcCAqIHdoZWVsLmZyaWN0aW9uU2xpcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNpZGUgPSBtYXhpbXA7CiAgICAgICAgICBjb25zdCBtYXhpbXBTcXVhcmVkID0gbWF4aW1wICogbWF4aW1wU2lkZTsKICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gcm9sbGluZ0ZyaWN0aW9uOyAvL3doZWVsSW5mby5lbmdpbmVGb3JjZSogdGltZVN0ZXA7CgogICAgICAgICAgY29uc3QgeCA9IHdoZWVsLmZvcndhcmRJbXB1bHNlICogZndkRmFjdG9yIC8gd2hlZWwuZm9yd2FyZEFjY2VsZXJhdGlvbjsKICAgICAgICAgIGNvbnN0IHkgPSB3aGVlbC5zaWRlSW1wdWxzZSAqIHNpZGVGYWN0b3IgLyB3aGVlbC5zaWRlQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgaW1wdWxzZVNxdWFyZWQgPSB4ICogeCArIHkgKiB5OwogICAgICAgICAgd2hlZWwuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgICAgIGlmIChpbXB1bHNlU3F1YXJlZCA+IG1heGltcFNxdWFyZWQpIHsKICAgICAgICAgICAgdGhpcy5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgd2hlZWwuc2xpZGluZyA9IHRydWU7CiAgICAgICAgICAgIGNvbnN0IGZhY3RvciA9IG1heGltcCAvIE1hdGguc3FydChpbXB1bHNlU3F1YXJlZCk7CiAgICAgICAgICAgIHdoZWVsLnNraWRJbmZvICo9IGZhY3RvcjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsaWRpbmcpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CgogICAgICAgICAgaWYgKHdoZWVsLnNpZGVJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICAgIGlmICh3aGVlbC5za2lkSW5mbyA8IDEpIHsKICAgICAgICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSAqPSB3aGVlbC5za2lkSW5mbzsKICAgICAgICAgICAgICB3aGVlbC5zaWRlSW1wdWxzZSAqPSB3aGVlbC5za2lkSW5mbzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBhcHBseSB0aGUgaW1wdWxzZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGNvbnN0IHJlbF9wb3MgPSBuZXcgVmVjMygpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxfcG9zKTsgLy8gY2Fubm9ucyBhcHBseWltcHVsc2UgaXMgdXNpbmcgd29ybGQgY29vcmQgZm9yIHRoZSBwb3NpdGlvbgogICAgICAgIC8vcmVsX3Bvcy5jb3B5KHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCk7CgogICAgICAgIGlmICh3aGVlbC5mb3J3YXJkSW1wdWxzZSAhPT0gMCkgewogICAgICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgICAgICBmb3J3YXJkV1NbaV0uc2NhbGUod2hlZWwuZm9yd2FyZEltcHVsc2UsIGltcHVsc2UpOwogICAgICAgICAgY2hhc3Npc0JvZHkuYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbF9wb3MpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdoZWVsLnNpZGVJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgICBjb25zdCByZWxfcG9zMiA9IG5ldyBWZWMzKCk7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQudnN1Yihncm91bmRPYmplY3QucG9zaXRpb24sIHJlbF9wb3MyKTsgLy9yZWxfcG9zMi5jb3B5KHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCk7CgogICAgICAgICAgY29uc3Qgc2lkZUltcCA9IG5ldyBWZWMzKCk7CiAgICAgICAgICBheGxlW2ldLnNjYWxlKHdoZWVsLnNpZGVJbXB1bHNlLCBzaWRlSW1wKTsgLy8gU2NhbGUgdGhlIHJlbGF0aXZlIHBvc2l0aW9uIGluIHRoZSB1cCBkaXJlY3Rpb24gd2l0aCByb2xsSW5mbHVlbmNlLgogICAgICAgICAgLy8gSWYgcm9sbEluZmx1ZW5jZSBpcyAxLCB0aGUgaW1wdWxzZSB3aWxsIGJlIGFwcGxpZWQgb24gdGhlIGhpdFBvaW50IChlYXN5IHRvIHJvbGwgb3ZlciksIGlmIGl0IGlzIHplcm8gaXQgd2lsbCBiZSBhcHBsaWVkIGluIHRoZSBzYW1lIHBsYW5lIGFzIHRoZSBjZW50ZXIgb2YgbWFzcyAobm90IGVhc3kgdG8gcm9sbCBvdmVyKS4KCiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb0xvY2FsRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICByZWxfcG9zWyd4eXonW3RoaXMuaW5kZXhVcEF4aXNdXSAqPSB3aGVlbC5yb2xsSW5mbHVlbmNlOwogICAgICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHJlbF9wb3MsIHJlbF9wb3MpOwogICAgICAgICAgY2hhc3Npc0JvZHkuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MpOyAvL2FwcGx5IGZyaWN0aW9uIGltcHVsc2Ugb24gdGhlIGdyb3VuZAoKICAgICAgICAgIHNpZGVJbXAuc2NhbGUoLTEsIHNpZGVJbXApOwogICAgICAgICAgZ3JvdW5kT2JqZWN0LmFwcGx5SW1wdWxzZShzaWRlSW1wLCByZWxfcG9zMik7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogIH0KICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWM0ID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWM1ID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWM2ID0gbmV3IFZlYzMoKTsKICBuZXcgUmF5KCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBjYXN0UmF5X3JheXZlY3RvciA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FzdFJheV90YXJnZXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGRpcmVjdGlvbnMgPSBbbmV3IFZlYzMoMSwgMCwgMCksIG5ldyBWZWMzKDAsIDEsIDApLCBuZXcgVmVjMygwLCAwLCAxKV07CiAgY29uc3QgdXBkYXRlRnJpY3Rpb25fc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qID0gbmV3IFZlYzMoKTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9heGxlID0gW107CiAgY29uc3QgdXBkYXRlRnJpY3Rpb25fZm9yd2FyZFdTID0gW107CiAgY29uc3Qgc2lkZUZyaWN0aW9uU3RpZmZuZXNzMiA9IDE7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwxID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gY2FsY1JvbGxpbmdGcmljdGlvbihib2R5MCwgYm9keTEsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQsIG1heEltcHVsc2UpIHsKICAgIGxldCBqMSA9IDA7CiAgICBjb25zdCBjb250YWN0UG9zV29ybGQgPSBmcmljdGlvblBvc1dvcmxkOyAvLyBjb25zdCByZWxfcG9zMSA9IG5ldyBWZWMzKCk7CiAgICAvLyBjb25zdCByZWxfcG9zMiA9IG5ldyBWZWMzKCk7CgogICAgY29uc3QgdmVsMSA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMTsKICAgIGNvbnN0IHZlbDIgPSBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDI7CiAgICBjb25zdCB2ZWwgPSBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDsgLy8gY29udGFjdFBvc1dvcmxkLnZzdWIoYm9keTAucG9zaXRpb24sIHJlbF9wb3MxKTsKICAgIC8vIGNvbnRhY3RQb3NXb3JsZC52c3ViKGJvZHkxLnBvc2l0aW9uLCByZWxfcG9zMik7CgogICAgYm9keTAuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoY29udGFjdFBvc1dvcmxkLCB2ZWwxKTsKICAgIGJvZHkxLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KGNvbnRhY3RQb3NXb3JsZCwgdmVsMik7CiAgICB2ZWwxLnZzdWIodmVsMiwgdmVsKTsKICAgIGNvbnN0IHZyZWwgPSBmcmljdGlvbkRpcmVjdGlvbldvcmxkLmRvdCh2ZWwpOwogICAgY29uc3QgZGVub20wID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5MCwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCk7CiAgICBjb25zdCBkZW5vbTEgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHkxLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkKTsKICAgIGNvbnN0IHJlbGF4YXRpb24gPSAxOwogICAgY29uc3QgamFjRGlhZ0FCSW52ID0gcmVsYXhhdGlvbiAvIChkZW5vbTAgKyBkZW5vbTEpOyAvLyBjYWxjdWxhdGUgaiB0aGF0IG1vdmVzIHVzIHRvIHplcm8gcmVsYXRpdmUgdmVsb2NpdHkKCiAgICBqMSA9IC12cmVsICogamFjRGlhZ0FCSW52OwoKICAgIGlmIChtYXhJbXB1bHNlIDwgajEpIHsKICAgICAgajEgPSBtYXhJbXB1bHNlOwogICAgfQoKICAgIGlmIChqMSA8IC1tYXhJbXB1bHNlKSB7CiAgICAgIGoxID0gLW1heEltcHVsc2U7CiAgICB9CgogICAgcmV0dXJuIGoxOwogIH0KCiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9yMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9jMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl92ZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3JfbSA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keSwgcG9zLCBub3JtYWwpIHsKICAgIGNvbnN0IHIwID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9yMDsKICAgIGNvbnN0IGMwID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9jMDsKICAgIGNvbnN0IHZlYyA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3JfdmVjOwogICAgY29uc3QgbSA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3JfbTsKICAgIHBvcy52c3ViKGJvZHkucG9zaXRpb24sIHIwKTsKICAgIHIwLmNyb3NzKG5vcm1hbCwgYzApOwogICAgYm9keS5pbnZJbmVydGlhV29ybGQudm11bHQoYzAsIG0pOwogICAgbS5jcm9zcyhyMCwgdmVjKTsKICAgIHJldHVybiBib2R5Lmludk1hc3MgKyBub3JtYWwuZG90KHZlYyk7CiAgfQoKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwgPSBuZXcgVmVjMygpOyAvLyBiaWxhdGVyYWwgY29uc3RyYWludCBiZXR3ZWVuIHR3byBkeW5hbWljIG9iamVjdHMKCiAgZnVuY3Rpb24gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbChib2R5MSwgcG9zMSwgYm9keTIsIHBvczIsIG5vcm1hbCkgewogICAgY29uc3Qgbm9ybWFsTGVuU3FyID0gbm9ybWFsLmxlbmd0aFNxdWFyZWQoKTsKCiAgICBpZiAobm9ybWFsTGVuU3FyID4gMS4xKSB7CiAgICAgIHJldHVybiAwOyAvLyBubyBpbXB1bHNlCiAgICB9IC8vIGNvbnN0IHJlbF9wb3MxID0gbmV3IFZlYzMoKTsKICAgIC8vIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKICAgIC8vIHBvczEudnN1Yihib2R5MS5wb3NpdGlvbiwgcmVsX3BvczEpOwogICAgLy8gcG9zMi52c3ViKGJvZHkyLnBvc2l0aW9uLCByZWxfcG9zMik7CgoKICAgIGNvbnN0IHZlbDEgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDE7CiAgICBjb25zdCB2ZWwyID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwyOwogICAgY29uc3QgdmVsID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWw7CiAgICBib2R5MS5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChwb3MxLCB2ZWwxKTsKICAgIGJvZHkyLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHBvczIsIHZlbDIpOwogICAgdmVsMS52c3ViKHZlbDIsIHZlbCk7CiAgICBjb25zdCByZWxfdmVsID0gbm9ybWFsLmRvdCh2ZWwpOwogICAgY29uc3QgY29udGFjdERhbXBpbmcgPSAwLjI7CiAgICBjb25zdCBtYXNzVGVybSA9IDEgLyAoYm9keTEuaW52TWFzcyArIGJvZHkyLmludk1hc3MpOwogICAgY29uc3QgaW1wdWxzZSA9IC1jb250YWN0RGFtcGluZyAqIHJlbF92ZWwgKiBtYXNzVGVybTsKICAgIHJldHVybiBpbXB1bHNlOwogIH0KCiAgLyoqCiAgICogU3BoZXJpY2FsIHNoYXBlCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzID0gMQogICAqICAgICBjb25zdCBzcGhlcmVTaGFwZSA9IG5ldyBDQU5OT04uU3BoZXJlKHJhZGl1cykKICAgKiAgICAgY29uc3Qgc3BoZXJlQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBzcGhlcmVTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KHNwaGVyZUJvZHkpCiAgICovCiAgY2xhc3MgU3BoZXJlIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgcmFkaXVzIG9mIHRoZSBzcGhlcmUuCiAgICAgKi8KCiAgICAvKioKICAgICAqCiAgICAgKiBAcGFyYW0gcmFkaXVzIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZSwgYSBub24tbmVnYXRpdmUgbnVtYmVyLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihyYWRpdXMpIHsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLlNQSEVSRQogICAgICB9KTsKICAgICAgdGhpcy5yYWRpdXMgPSByYWRpdXMgIT09IHVuZGVmaW5lZCA/IHJhZGl1cyA6IDEuMDsKCiAgICAgIGlmICh0aGlzLnJhZGl1cyA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBzcGhlcmUgcmFkaXVzIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYSAqLwoKCiAgICBjYWxjdWxhdGVMb2NhbEluZXJ0aWEobWFzcywgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IEkgPSAyLjAgKiBtYXNzICogdGhpcy5yYWRpdXMgKiB0aGlzLnJhZGl1cyAvIDUuMDsKICAgICAgdGFyZ2V0LnggPSBJOwogICAgICB0YXJnZXQueSA9IEk7CiAgICAgIHRhcmdldC56ID0gSTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKiB2b2x1bWUgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIE1hdGgucG93KHRoaXMucmFkaXVzLCAzKSAvIDMuMDsKICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IHRoaXMucmFkaXVzOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIGNvbnN0IHIgPSB0aGlzLnJhZGl1czsKICAgICAgY29uc3QgYXhlcyA9IFsneCcsICd5JywgJ3onXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGF4ID0gYXhlc1tpXTsKICAgICAgICBtaW5bYXhdID0gcG9zW2F4XSAtIHI7CiAgICAgICAgbWF4W2F4XSA9IHBvc1theF0gKyByOwogICAgICB9CiAgICB9CgogIH0KICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsgLy8gVGVtcCB2ZWN0b3JzIGZvciBjYWxjdWxhdGlvbgoKICBuZXcgVmVjMygpOyAvLyBSZWxhdGl2ZSB2ZWxvY2l0eQoKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEN5bGluZGVyIGNsYXNzLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHJhZGl1c1RvcCA9IDAuNQogICAqICAgICBjb25zdCByYWRpdXNCb3R0b20gPSAwLjUKICAgKiAgICAgY29uc3QgaGVpZ2h0ID0gMgogICAqICAgICBjb25zdCBudW1TZWdtZW50cyA9IDEyCiAgICogICAgIGNvbnN0IGN5bGluZGVyU2hhcGUgPSBuZXcgQ0FOTk9OLkN5bGluZGVyKHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzKQogICAqICAgICBjb25zdCBjeWxpbmRlckJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY3lsaW5kZXJTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGN5bGluZGVyQm9keSkKICAgKi8KCiAgY2xhc3MgQ3lsaW5kZXIgZXh0ZW5kcyBDb252ZXhQb2x5aGVkcm9uIHsKICAgIC8qKiBUaGUgcmFkaXVzIG9mIHRoZSB0b3Agb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgcmFkaXVzIG9mIHRoZSBib3R0b20gb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgaGVpZ2h0IG9mIHRoZSBDeWxpbmRlci4gKi8KCiAgICAvKiogVGhlIG51bWJlciBvZiBzZWdtZW50cyB0byBidWlsZCB0aGUgY3lsaW5kZXIgb3V0IG9mLiAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHJhZGl1c1RvcCBUaGUgcmFkaXVzIG9mIHRoZSB0b3Agb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIHJhZGl1c0JvdHRvbSBUaGUgcmFkaXVzIG9mIHRoZSBib3R0b20gb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIGhlaWdodCBUaGUgaGVpZ2h0IG9mIHRoZSBDeWxpbmRlci4KICAgICAqIEBwYXJhbSBudW1TZWdtZW50cyBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzKSB7CiAgICAgIGlmIChyYWRpdXNUb3AgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1c1RvcCA9IDE7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNCb3R0b20gPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1c0JvdHRvbSA9IDE7CiAgICAgIH0KCiAgICAgIGlmIChoZWlnaHQgPT09IHZvaWQgMCkgewogICAgICAgIGhlaWdodCA9IDE7CiAgICAgIH0KCiAgICAgIGlmIChudW1TZWdtZW50cyA9PT0gdm9pZCAwKSB7CiAgICAgICAgbnVtU2VnbWVudHMgPSA4OwogICAgICB9CgogICAgICBpZiAocmFkaXVzVG9wIDwgMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIGN5bGluZGVyIHJhZGl1c1RvcCBjYW5ub3QgYmUgbmVnYXRpdmUuJyk7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNCb3R0b20gPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzQm90dG9tIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgY29uc3QgTiA9IG51bVNlZ21lbnRzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IFtdOwogICAgICBjb25zdCBheGVzID0gW107CiAgICAgIGNvbnN0IGZhY2VzID0gW107CiAgICAgIGNvbnN0IGJvdHRvbWZhY2UgPSBbXTsKICAgICAgY29uc3QgdG9wZmFjZSA9IFtdOwogICAgICBjb25zdCBjb3MgPSBNYXRoLmNvczsKICAgICAgY29uc3Qgc2luID0gTWF0aC5zaW47IC8vIEZpcnN0IGJvdHRvbSBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKDApLCAtaGVpZ2h0ICogMC41LCByYWRpdXNCb3R0b20gKiBjb3MoMCkpKTsKICAgICAgYm90dG9tZmFjZS5wdXNoKDApOyAvLyBGaXJzdCB0b3AgcG9pbnQKCiAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbigwKSwgaGVpZ2h0ICogMC41LCByYWRpdXNUb3AgKiBjb3MoMCkpKTsKICAgICAgdG9wZmFjZS5wdXNoKDEpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBOOyBpKyspIHsKICAgICAgICBjb25zdCB0aGV0YSA9IDIgKiBNYXRoLlBJIC8gTiAqIChpICsgMSk7CiAgICAgICAgY29uc3QgdGhldGFOID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAwLjUpOwoKICAgICAgICBpZiAoaSA8IE4gLSAxKSB7CiAgICAgICAgICAvLyBCb3R0b20KICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c0JvdHRvbSAqIHNpbih0aGV0YSksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcyh0aGV0YSkpKTsKICAgICAgICAgIGJvdHRvbWZhY2UucHVzaCgyICogaSArIDIpOyAvLyBUb3AKCiAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNUb3AgKiBzaW4odGhldGEpLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcyh0aGV0YSkpKTsKICAgICAgICAgIHRvcGZhY2UucHVzaCgyICogaSArIDMpOyAvLyBGYWNlCgogICAgICAgICAgZmFjZXMucHVzaChbMiAqIGksIDIgKiBpICsgMSwgMiAqIGkgKyAzLCAyICogaSArIDJdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZmFjZXMucHVzaChbMiAqIGksIDIgKiBpICsgMSwgMSwgMF0pOyAvLyBDb25uZWN0CiAgICAgICAgfSAvLyBBeGlzOiB3ZSBjYW4gY3V0IG9mZiBoYWxmIG9mIHRoZW0gaWYgd2UgaGF2ZSBldmVuIG51bWJlciBvZiBzZWdtZW50cwoKCiAgICAgICAgaWYgKE4gJSAyID09PSAxIHx8IGkgPCBOIC8gMikgewogICAgICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKC1zaW4odGhldGFOKSwgMCwgY29zKHRoZXRhTikpKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZhY2VzLnB1c2goYm90dG9tZmFjZSk7CiAgICAgIGF4ZXMucHVzaChuZXcgVmVjMygwLCAxLCAwKSk7IC8vIFJlb3JkZXIgdG9wIGZhY2UKCiAgICAgIGNvbnN0IHRlbXAgPSBbXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdG9wZmFjZS5sZW5ndGg7IGkrKykgewogICAgICAgIHRlbXAucHVzaCh0b3BmYWNlW3RvcGZhY2UubGVuZ3RoIC0gaSAtIDFdKTsKICAgICAgfQoKICAgICAgZmFjZXMucHVzaCh0ZW1wKTsKICAgICAgc3VwZXIoewogICAgICAgIHZlcnRpY2VzLAogICAgICAgIGZhY2VzLAogICAgICAgIGF4ZXMKICAgICAgfSk7CiAgICAgIHRoaXMudHlwZSA9IFNoYXBlLnR5cGVzLkNZTElOREVSOwogICAgICB0aGlzLnJhZGl1c1RvcCA9IHJhZGl1c1RvcDsKICAgICAgdGhpcy5yYWRpdXNCb3R0b20gPSByYWRpdXNCb3R0b207CiAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICB0aGlzLm51bVNlZ21lbnRzID0gbnVtU2VnbWVudHM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogUGFydGljbGUgc2hhcGUuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcGFydGljbGVTaGFwZSA9IG5ldyBDQU5OT04uUGFydGljbGUoKQogICAqICAgICBjb25zdCBwYXJ0aWNsZUJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogcGFydGljbGVTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KHBhcnRpY2xlQm9keSkKICAgKi8KICBjbGFzcyBQYXJ0aWNsZSBleHRlbmRzIFNoYXBlIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuUEFSVElDTEUKICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYQogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNldCgwLCAwLCAwKTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiAwOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gMDsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICBtaW4uY29weShwb3MpOwogICAgICBtYXguY29weShwb3MpOwogICAgfQoKICB9CgogIC8qKgogICAqIEEgcGxhbmUsIGZhY2luZyBpbiB0aGUgWiBkaXJlY3Rpb24uIFRoZSBwbGFuZSBoYXMgaXRzIHN1cmZhY2UgYXQgej0wIGFuZCBldmVyeXRoaW5nIGJlbG93IHo9MCBpcyBhc3N1bWVkIHRvIGJlIHNvbGlkIHBsYW5lLiBUbyBtYWtlIHRoZSBwbGFuZSBmYWNlIGluIHNvbWUgb3RoZXIgZGlyZWN0aW9uIHRoYW4geiwgeW91IG11c3QgcHV0IGl0IGluc2lkZSBhIEJvZHkgYW5kIHJvdGF0ZSB0aGF0IGJvZHkuIFNlZSB0aGUgZGVtb3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcGxhbmVTaGFwZSA9IG5ldyBDQU5OT04uUGxhbmUoKQogICAqICAgICBjb25zdCBwbGFuZUJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAwLCBzaGFwZTogIHBsYW5lU2hhcGUgfSkKICAgKiAgICAgcGxhbmVCb2R5LnF1YXRlcm5pb24uc2V0RnJvbUV1bGVyKC1NYXRoLlBJIC8gMiwgMCwgMCkgLy8gbWFrZSBpdCBmYWNlIHVwCiAgICogICAgIHdvcmxkLmFkZEJvZHkocGxhbmVCb2R5KQogICAqLwogIGNsYXNzIFBsYW5lIGV4dGVuZHMgU2hhcGUgewogICAgLyoqIHdvcmxkTm9ybWFsICovCgogICAgLyoqIHdvcmxkTm9ybWFsTmVlZHNVcGRhdGUgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuUExBTkUKICAgICAgfSk7IC8vIFdvcmxkIG9yaWVudGVkIG5vcm1hbAoKICAgICAgdGhpcy53b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMud29ybGROb3JtYWxOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgfQogICAgLyoqIGNvbXB1dGVXb3JsZE5vcm1hbCAqLwoKCiAgICBjb21wdXRlV29ybGROb3JtYWwocXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy53b3JsZE5vcm1hbDsKICAgICAgbi5zZXQoMCwgMCwgMSk7CiAgICAgIHF1YXQudm11bHQobiwgbik7CiAgICAgIHRoaXMud29ybGROb3JtYWxOZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgfQoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiAoLy8gVGhlIHBsYW5lIGlzIGluZmluaXRlLi4uCiAgICAgICAgTnVtYmVyLk1BWF9WQUxVRQogICAgICApOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIFRoZSBwbGFuZSBBQUJCIGlzIGluZmluaXRlLCBleGNlcHQgaWYgdGhlIG5vcm1hbCBpcyBwb2ludGluZyBhbG9uZyBhbnkgYXhpcwogICAgICB0ZW1wTm9ybWFsLnNldCgwLCAwLCAxKTsgLy8gRGVmYXVsdCBwbGFuZSBub3JtYWwgaXMgegoKICAgICAgcXVhdC52bXVsdCh0ZW1wTm9ybWFsLCB0ZW1wTm9ybWFsKTsKICAgICAgY29uc3QgbWF4VmFsID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgbWluLnNldCgtbWF4VmFsLCAtbWF4VmFsLCAtbWF4VmFsKTsKICAgICAgbWF4LnNldChtYXhWYWwsIG1heFZhbCwgbWF4VmFsKTsKCiAgICAgIGlmICh0ZW1wTm9ybWFsLnggPT09IDEpIHsKICAgICAgICBtYXgueCA9IHBvcy54OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueCA9PT0gLTEpIHsKICAgICAgICBtaW4ueCA9IHBvcy54OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC55ID09PSAxKSB7CiAgICAgICAgbWF4LnkgPSBwb3MueTsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnkgPT09IC0xKSB7CiAgICAgICAgbWluLnkgPSBwb3MueTsKICAgICAgfQoKICAgICAgaWYgKHRlbXBOb3JtYWwueiA9PT0gMSkgewogICAgICAgIG1heC56ID0gcG9zLno7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC56ID09PSAtMSkgewogICAgICAgIG1pbi56ID0gcG9zLno7CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CgogIH0KICBjb25zdCB0ZW1wTm9ybWFsID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogSGVpZ2h0ZmllbGQgc2hhcGUgY2xhc3MuIEhlaWdodCBkYXRhIGlzIGdpdmVuIGFzIGFuIGFycmF5LiBUaGVzZSBkYXRhIHBvaW50cyBhcmUgc3ByZWFkIG91dCBldmVubHkgd2l0aCBhIGdpdmVuIGRpc3RhbmNlLgogICAqIEB0b2RvIFNob3VsZCBiZSBwb3NzaWJsZSB0byB1c2UgYWxvbmcgYWxsIGF4ZXMsIG5vdCBqdXN0IHkKICAgKiBAdG9kbyBzaG91bGQgYmUgcG9zc2libGUgdG8gc2NhbGUgYWxvbmcgYWxsIGF4ZXMKICAgKiBAdG9kbyBSZWZhY3RvciBlbGVtZW50U2l6ZSB0byBlbGVtZW50U2l6ZVggYW5kIGVsZW1lbnRTaXplWQogICAqCiAgICogQGV4YW1wbGUKICAgKiAgICAgLy8gR2VuZXJhdGUgc29tZSBoZWlnaHQgZGF0YSAoeS12YWx1ZXMpLgogICAqICAgICBjb25zdCBkYXRhID0gW10KICAgKiAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDAwOyBpKyspIHsKICAgKiAgICAgICAgIGNvbnN0IHkgPSAwLjUgKiBNYXRoLmNvcygwLjIgKiBpKQogICAqICAgICAgICAgZGF0YS5wdXNoKHkpCiAgICogICAgIH0KICAgKgogICAqICAgICAvLyBDcmVhdGUgdGhlIGhlaWdodGZpZWxkIHNoYXBlCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkU2hhcGUgPSBuZXcgQ0FOTk9OLkhlaWdodGZpZWxkKGRhdGEsIHsKICAgKiAgICAgICAgIGVsZW1lbnRTaXplOiAxIC8vIERpc3RhbmNlIGJldHdlZW4gdGhlIGRhdGEgcG9pbnRzIGluIFggYW5kIFkgZGlyZWN0aW9ucwogICAqICAgICB9KQogICAqICAgICBjb25zdCBoZWlnaHRmaWVsZEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBzaGFwZTogaGVpZ2h0ZmllbGRTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGhlaWdodGZpZWxkQm9keSkKICAgKi8KICBjbGFzcyBIZWlnaHRmaWVsZCBleHRlbmRzIFNoYXBlIHsKICAgIC8qKgogICAgICogQW4gYXJyYXkgb2YgbnVtYmVycywgb3IgaGVpZ2h0IHZhbHVlcywgdGhhdCBhcmUgc3ByZWFkIG91dCBhbG9uZyB0aGUgeCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYXggdmFsdWUgb2YgdGhlIGRhdGEgcG9pbnRzIGluIHRoZSBkYXRhIGFycmF5LgogICAgICovCgogICAgLyoqCiAgICAgKiBNaW5pbXVtIHZhbHVlIG9mIHRoZSBkYXRhIHBvaW50cyBpbiB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQgc3BhY2luZyBiZXR3ZWVuIHRoZSBkYXRhIHBvaW50cyBpbiBYIGFuZCBZIGRpcmVjdGlvbi4KICAgICAqIEB0b2RvIGVsZW1lbnRTaXplWCBhbmQgWQogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCB0cnVlCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBkYXRhIEFuIGFycmF5IG9mIG51bWJlcnMsIG9yIGhlaWdodCB2YWx1ZXMsIHRoYXQgYXJlIHNwcmVhZCBvdXQgYWxvbmcgdGhlIHggYXhpcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoZGF0YSwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIG1heFZhbHVlOiBudWxsLAogICAgICAgIG1pblZhbHVlOiBudWxsLAogICAgICAgIGVsZW1lbnRTaXplOiAxCiAgICAgIH0pOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuSEVJR0hURklFTEQKICAgICAgfSk7CiAgICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICAgIHRoaXMubWF4VmFsdWUgPSBvcHRpb25zLm1heFZhbHVlOwogICAgICB0aGlzLm1pblZhbHVlID0gb3B0aW9ucy5taW5WYWx1ZTsKICAgICAgdGhpcy5lbGVtZW50U2l6ZSA9IG9wdGlvbnMuZWxlbWVudFNpemU7CgogICAgICBpZiAob3B0aW9ucy5taW5WYWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudXBkYXRlTWluVmFsdWUoKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMubWF4VmFsdWUgPT09IG51bGwpIHsKICAgICAgICB0aGlzLnVwZGF0ZU1heFZhbHVlKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuY2FjaGVFbmFibGVkID0gdHJ1ZTsKICAgICAgdGhpcy5waWxsYXJDb252ZXggPSBuZXcgQ29udmV4UG9seWhlZHJvbigpOwogICAgICB0aGlzLnBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsgLy8gImlfal9pc1VwcGVyIiA9PiB7IGNvbnZleDogLi4uLCBvZmZzZXQ6IC4uLiB9CiAgICAgIC8vIGZvciBleGFtcGxlOgogICAgICAvLyBfY2FjaGVkUGlsbGFyc1siMF8yXzEiXQoKICAgICAgdGhpcy5fY2FjaGVkUGlsbGFycyA9IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxsIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0ge307CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYG1pblZhbHVlYCBwcm9wZXJ0eQogICAgICovCgoKICAgIHVwZGF0ZU1pblZhbHVlKCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgbWluVmFsdWUgPSBkYXRhWzBdWzBdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGRhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gZGF0YVtpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgY29uc3QgdiA9IGRhdGFbaV1bal07CgogICAgICAgICAgaWYgKHYgPCBtaW5WYWx1ZSkgewogICAgICAgICAgICBtaW5WYWx1ZSA9IHY7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLm1pblZhbHVlID0gbWluVmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYG1heFZhbHVlYCBwcm9wZXJ0eQogICAgICovCgoKICAgIHVwZGF0ZU1heFZhbHVlKCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgbWF4VmFsdWUgPSBkYXRhWzBdWzBdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGRhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gZGF0YVtpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgY29uc3QgdiA9IGRhdGFbaV1bal07CgogICAgICAgICAgaWYgKHYgPiBtYXhWYWx1ZSkgewogICAgICAgICAgICBtYXhWYWx1ZSA9IHY7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLm1heFZhbHVlID0gbWF4VmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgaGVpZ2h0IHZhbHVlIGF0IGFuIGluZGV4LiBEb24ndCBmb3JnZXQgdG8gdXBkYXRlIG1heFZhbHVlIGFuZCBtaW5WYWx1ZSBhZnRlciB5b3UncmUgZG9uZS4KICAgICAqLwoKCiAgICBzZXRIZWlnaHRWYWx1ZUF0SW5kZXgoeGksIHlpLCB2YWx1ZSkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBkYXRhW3hpXVt5aV0gPSB2YWx1ZTsgLy8gSW52YWxpZGF0ZSBjYWNoZQoKICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZmFsc2UpOwoKICAgICAgaWYgKHhpID4gMCkgewogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpLCB0cnVlKTsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSwgZmFsc2UpOwogICAgICB9CgogICAgICBpZiAoeWkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSAtIDEsIHRydWUpOwogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWkgLSAxLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGlmICh5aSA+IDAgJiYgeGkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWkgLSAxLCB0cnVlKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgbWF4L21pbiBpbiBhIHJlY3RhbmdsZSBpbiB0aGUgbWF0cml4IGRhdGEKICAgICAqIEBwYXJhbSByZXN1bHQgQW4gYXJyYXkgdG8gc3RvcmUgdGhlIHJlc3VsdHMgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSByZXN1bHQgYXJyYXksIGlmIGl0IHdhcyBwYXNzZWQgaW4uIE1pbmltdW0gd2lsbCBiZSBhdCBwb3NpdGlvbiAwIGFuZCBtYXggYXQgMS4KICAgICAqLwoKCiAgICBnZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gW107CiAgICAgIH0KCiAgICAgIC8vIEdldCBtYXggYW5kIG1pbiBvZiB0aGUgZGF0YQogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOyAvLyBTZXQgZmlyc3QgdmFsdWUKCiAgICAgIGxldCBtYXggPSB0aGlzLm1pblZhbHVlOwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDw9IGlNYXhYOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gaU1pblk7IGogPD0gaU1heFk7IGorKykgewogICAgICAgICAgY29uc3QgaGVpZ2h0ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAoaGVpZ2h0ID4gbWF4KSB7CiAgICAgICAgICAgIG1heCA9IGhlaWdodDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJlc3VsdFswXSA9IHRoaXMubWluVmFsdWU7CiAgICAgIHJlc3VsdFsxXSA9IG1heDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBpbmRleCBvZiBhIGxvY2FsIHBvc2l0aW9uIG9uIHRoZSBoZWlnaHRmaWVsZC4gVGhlIGluZGV4ZXMgaW5kaWNhdGUgdGhlIHJlY3RhbmdsZXMsIHNvIGlmIHlvdXIgdGVycmFpbiBpcyBtYWRlIG9mIE4geCBOIGhlaWdodCBkYXRhIHBvaW50cywgeW91IHdpbGwgaGF2ZSByZWN0YW5nbGUgaW5kZXhlcyByYW5naW5nIGZyb20gMCB0byBOLTEuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFR3by1lbGVtZW50IGFycmF5CiAgICAgKiBAcGFyYW0gY2xhbXAgSWYgdGhlIHBvc2l0aW9uIHNob3VsZCBiZSBjbGFtcGVkIHRvIHRoZSBoZWlnaHRmaWVsZCBlZGdlLgogICAgICovCgoKICAgIGdldEluZGV4T2ZQb3NpdGlvbih4LCB5LCByZXN1bHQsIGNsYW1wKSB7CiAgICAgIC8vIEdldCB0aGUgaW5kZXggb2YgdGhlIGRhdGEgcG9pbnRzIHRvIHRlc3QgYWdhaW5zdAogICAgICBjb25zdCB3ID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgbGV0IHhpID0gTWF0aC5mbG9vcih4IC8gdyk7CiAgICAgIGxldCB5aSA9IE1hdGguZmxvb3IoeSAvIHcpOwogICAgICByZXN1bHRbMF0gPSB4aTsKICAgICAgcmVzdWx0WzFdID0geWk7CgogICAgICBpZiAoY2xhbXApIHsKICAgICAgICAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwogICAgICAgIGlmICh4aSA8IDApIHsKICAgICAgICAgIHhpID0gMDsKICAgICAgICB9CgogICAgICAgIGlmICh5aSA8IDApIHsKICAgICAgICAgIHlpID0gMDsKICAgICAgICB9CgogICAgICAgIGlmICh4aSA+PSBkYXRhLmxlbmd0aCAtIDEpIHsKICAgICAgICAgIHhpID0gZGF0YS5sZW5ndGggLSAxOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpID49IGRhdGFbMF0ubGVuZ3RoIC0gMSkgewogICAgICAgICAgeWkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgICAgfQogICAgICB9IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCgogICAgICBpZiAoeGkgPCAwIHx8IHlpIDwgMCB8fCB4aSA+PSBkYXRhLmxlbmd0aCAtIDEgfHwgeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBnZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYykgewogICAgICBjb25zdCBpZHggPSBnZXRIZWlnaHRBdF9pZHg7CiAgICAgIHRoaXMuZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIGlkeCwgZWRnZUNsYW1wKTsKICAgICAgbGV0IHhpID0gaWR4WzBdOwogICAgICBsZXQgeWkgPSBpZHhbMV07CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CgogICAgICBpZiAoZWRnZUNsYW1wKSB7CiAgICAgICAgeGkgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHhpKSk7CiAgICAgICAgeWkgPSBNYXRoLm1pbihkYXRhWzBdLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHlpKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgbG93ZXJEaXN0MiA9ICh4IC8gZWxlbWVudFNpemUgLSB4aSkgKiogMiArICh5IC8gZWxlbWVudFNpemUgLSB5aSkgKiogMjsKICAgICAgY29uc3QgdXBwZXJEaXN0MiA9ICh4IC8gZWxlbWVudFNpemUgLSAoeGkgKyAxKSkgKiogMiArICh5IC8gZWxlbWVudFNpemUgLSAoeWkgKyAxKSkgKiogMjsKICAgICAgY29uc3QgdXBwZXIgPSBsb3dlckRpc3QyID4gdXBwZXJEaXN0MjsKICAgICAgdGhpcy5nZXRUcmlhbmdsZSh4aSwgeWksIHVwcGVyLCBhLCBiLCBjKTsKICAgICAgcmV0dXJuIHVwcGVyOwogICAgfQoKICAgIGdldE5vcm1hbEF0KHgsIHksIGVkZ2VDbGFtcCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IGEgPSBnZXROb3JtYWxBdF9hOwogICAgICBjb25zdCBiID0gZ2V0Tm9ybWFsQXRfYjsKICAgICAgY29uc3QgYyA9IGdldE5vcm1hbEF0X2M7CiAgICAgIGNvbnN0IGUwID0gZ2V0Tm9ybWFsQXRfZTA7CiAgICAgIGNvbnN0IGUxID0gZ2V0Tm9ybWFsQXRfZTE7CiAgICAgIHRoaXMuZ2V0VHJpYW5nbGVBdCh4LCB5LCBlZGdlQ2xhbXAsIGEsIGIsIGMpOwogICAgICBiLnZzdWIoYSwgZTApOwogICAgICBjLnZzdWIoYSwgZTEpOwogICAgICBlMC5jcm9zcyhlMSwgcmVzdWx0KTsKICAgICAgcmVzdWx0Lm5vcm1hbGl6ZSgpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYW4gQUFCQiBvZiBhIHNxdWFyZSBpbiB0aGUgaGVpZ2h0ZmllbGQKICAgICAqIEBwYXJhbSB4aQogICAgICogQHBhcmFtIHlpCiAgICAgKiBAcGFyYW0gcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0QWFiYkF0SW5kZXgoeGksIHlpLCBfcmVmKSB7CiAgICAgIGxldCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBfcmVmOwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CiAgICAgIGxvd2VyQm91bmQuc2V0KHhpICogZWxlbWVudFNpemUsIHlpICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSk7CiAgICAgIHVwcGVyQm91bmQuc2V0KCh4aSArIDEpICogZWxlbWVudFNpemUsICh5aSArIDEpICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBoZWlnaHQgaW4gdGhlIGhlaWdodGZpZWxkIGF0IGEgZ2l2ZW4gcG9zaXRpb24KICAgICAqLwoKCiAgICBnZXRIZWlnaHRBdCh4LCB5LCBlZGdlQ2xhbXApIHsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgYSA9IGdldEhlaWdodEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXRIZWlnaHRBdF9iOwogICAgICBjb25zdCBjID0gZ2V0SGVpZ2h0QXRfYzsKICAgICAgY29uc3QgaWR4ID0gZ2V0SGVpZ2h0QXRfaWR4OwogICAgICB0aGlzLmdldEluZGV4T2ZQb3NpdGlvbih4LCB5LCBpZHgsIGVkZ2VDbGFtcCk7CiAgICAgIGxldCB4aSA9IGlkeFswXTsKICAgICAgbGV0IHlpID0gaWR4WzFdOwoKICAgICAgaWYgKGVkZ2VDbGFtcCkgewogICAgICAgIHhpID0gTWF0aC5taW4oZGF0YS5sZW5ndGggLSAyLCBNYXRoLm1heCgwLCB4aSkpOwogICAgICAgIHlpID0gTWF0aC5taW4oZGF0YVswXS5sZW5ndGggLSAyLCBNYXRoLm1heCgwLCB5aSkpOwogICAgICB9CgogICAgICBjb25zdCB1cHBlciA9IHRoaXMuZ2V0VHJpYW5nbGVBdCh4LCB5LCBlZGdlQ2xhbXAsIGEsIGIsIGMpOwogICAgICBiYXJ5Y2VudHJpY1dlaWdodHMoeCwgeSwgYS54LCBhLnksIGIueCwgYi55LCBjLngsIGMueSwgZ2V0SGVpZ2h0QXRfd2VpZ2h0cyk7CiAgICAgIGNvbnN0IHcgPSBnZXRIZWlnaHRBdF93ZWlnaHRzOwoKICAgICAgaWYgKHVwcGVyKSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgcmV0dXJuIGRhdGFbeGkgKyAxXVt5aSArIDFdICogdy54ICsgZGF0YVt4aV1beWkgKyAxXSAqIHcueSArIGRhdGFbeGkgKyAxXVt5aV0gKiB3Lno7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgcmV0dXJuIGRhdGFbeGldW3lpXSAqIHcueCArIGRhdGFbeGkgKyAxXVt5aV0gKiB3LnkgKyBkYXRhW3hpXVt5aSArIDFdICogdy56OwogICAgICB9CiAgICB9CgogICAgZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpIHsKICAgICAgcmV0dXJuIGAke3hpfV8ke3lpfV8ke2dldFVwcGVyVHJpYW5nbGUgPyAxIDogMH1gOwogICAgfQoKICAgIGdldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICByZXR1cm4gdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV07CiAgICB9CgogICAgc2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlLCBjb252ZXgsIG9mZnNldCkgewogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXSA9IHsKICAgICAgICBjb252ZXgsCiAgICAgICAgb2Zmc2V0CiAgICAgIH07CiAgICB9CgogICAgY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpIHsKICAgICAgZGVsZXRlIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB0cmlhbmdsZSBmcm9tIHRoZSBoZWlnaHRmaWVsZAogICAgICovCgoKICAgIGdldFRyaWFuZ2xlKHhpLCB5aSwgdXBwZXIsIGEsIGIsIGMpIHsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwoKICAgICAgaWYgKHVwcGVyKSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgYS5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpICsgMV0pOwogICAgICAgIGIuc2V0KHhpICogZWxlbWVudFNpemUsICh5aSArIDEpICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpICsgMV0pOwogICAgICAgIGMuc2V0KCh4aSArIDEpICogZWxlbWVudFNpemUsIHlpICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0pOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwogICAgICAgIGEuc2V0KHhpICogZWxlbWVudFNpemUsIHlpICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSk7CiAgICAgICAgYi5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSk7CiAgICAgICAgYy5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgdHJpYW5nbGUgaW4gdGhlIHRlcnJhaW4gaW4gdGhlIGZvcm0gb2YgYSB0cmlhbmd1bGFyIGNvbnZleCBzaGFwZS4KICAgICAqLwoKCiAgICBnZXRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpIHsKICAgICAgbGV0IHJlc3VsdCA9IHRoaXMucGlsbGFyQ29udmV4OwogICAgICBsZXQgb2Zmc2V0UmVzdWx0ID0gdGhpcy5waWxsYXJPZmZzZXQ7CgogICAgICBpZiAodGhpcy5jYWNoZUVuYWJsZWQpIHsKICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5nZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpOwoKICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgdGhpcy5waWxsYXJDb252ZXggPSBkYXRhLmNvbnZleDsKICAgICAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gZGF0YS5vZmZzZXQ7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICByZXN1bHQgPSBuZXcgQ29udmV4UG9seWhlZHJvbigpOwogICAgICAgIG9mZnNldFJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5waWxsYXJDb252ZXggPSByZXN1bHQ7CiAgICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSBvZmZzZXRSZXN1bHQ7CiAgICAgIH0KCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgZmFjZXMgPSByZXN1bHQuZmFjZXM7IC8vIFJldXNlIHZlcnRzIGlmIHBvc3NpYmxlCgogICAgICByZXN1bHQudmVydGljZXMubGVuZ3RoID0gNjsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNjsgaSsrKSB7CiAgICAgICAgaWYgKCFyZXN1bHQudmVydGljZXNbaV0pIHsKICAgICAgICAgIHJlc3VsdC52ZXJ0aWNlc1tpXSA9IG5ldyBWZWMzKCk7CiAgICAgICAgfQogICAgICB9IC8vIFJldXNlIGZhY2VzIGlmIHBvc3NpYmxlCgoKICAgICAgZmFjZXMubGVuZ3RoID0gNTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTsgaSsrKSB7CiAgICAgICAgaWYgKCFmYWNlc1tpXSkgewogICAgICAgICAgZmFjZXNbaV0gPSBbXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gcmVzdWx0LnZlcnRpY2VzOwogICAgICBjb25zdCBoID0gKE1hdGgubWluKGRhdGFbeGldW3lpXSwgZGF0YVt4aSArIDFdW3lpXSwgZGF0YVt4aV1beWkgKyAxXSwgZGF0YVt4aSArIDFdW3lpICsgMV0pIC0gdGhpcy5taW5WYWx1ZSkgLyAyICsgdGhpcy5taW5WYWx1ZTsKCiAgICAgIGlmICghZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICAgIC8vIENlbnRlciBvZiB0aGUgdHJpYW5nbGUgcGlsbGFyIC0gYWxsIHBvbHlnb25zIGFyZSBnaXZlbiByZWxhdGl2ZSB0byB0aGlzIG9uZQogICAgICAgIG9mZnNldFJlc3VsdC5zZXQoKHhpICsgMC4yNSkgKiBlbGVtZW50U2l6ZSwgLy8gc29ydCBvZiBjZW50ZXIgb2YgYSB0cmlhbmdsZQogICAgICAgICh5aSArIDAuMjUpICogZWxlbWVudFNpemUsIGggLy8gdmVydGljYWwgY2VudGVyCiAgICAgICAgKTsgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzBdLnNldCgtMC4yNSAqIGVsZW1lbnRTaXplLCAtMC4yNSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aV0gLSBoKTsKICAgICAgICB2ZXJ0c1sxXS5zZXQoMC43NSAqIGVsZW1lbnRTaXplLCAtMC4yNSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldIC0gaCk7CiAgICAgICAgdmVydHNbMl0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIDAuNzUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSAtIGgpOyAvLyBib3R0b20gdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbM10uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOwogICAgICAgIHZlcnRzWzRdLnNldCgwLjc1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOwogICAgICAgIHZlcnRzWzVdLnNldCgtMC4yNSAqIGVsZW1lbnRTaXplLCAwLjc1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOyAvLyB0b3AgdHJpYW5nbGUKCiAgICAgICAgZmFjZXNbMF1bMF0gPSAwOwogICAgICAgIGZhY2VzWzBdWzFdID0gMTsKICAgICAgICBmYWNlc1swXVsyXSA9IDI7IC8vIGJvdHRvbSB0cmlhbmdsZQoKICAgICAgICBmYWNlc1sxXVswXSA9IDU7CiAgICAgICAgZmFjZXNbMV1bMV0gPSA0OwogICAgICAgIGZhY2VzWzFdWzJdID0gMzsgLy8gLXggZmFjaW5nIHF1YWQKCiAgICAgICAgZmFjZXNbMl1bMF0gPSAwOwogICAgICAgIGZhY2VzWzJdWzFdID0gMjsKICAgICAgICBmYWNlc1syXVsyXSA9IDU7CiAgICAgICAgZmFjZXNbMl1bM10gPSAzOyAvLyAteSBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1szXVswXSA9IDE7CiAgICAgICAgZmFjZXNbM11bMV0gPSAwOwogICAgICAgIGZhY2VzWzNdWzJdID0gMzsKICAgICAgICBmYWNlc1szXVszXSA9IDQ7IC8vICt4eSBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1s0XVswXSA9IDQ7CiAgICAgICAgZmFjZXNbNF1bMV0gPSA1OwogICAgICAgIGZhY2VzWzRdWzJdID0gMjsKICAgICAgICBmYWNlc1s0XVszXSA9IDE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gQ2VudGVyIG9mIHRoZSB0cmlhbmdsZSBwaWxsYXIgLSBhbGwgcG9seWdvbnMgYXJlIGdpdmVuIHJlbGF0aXZlIHRvIHRoaXMgb25lCiAgICAgICAgb2Zmc2V0UmVzdWx0LnNldCgoeGkgKyAwLjc1KSAqIGVsZW1lbnRTaXplLCAvLyBzb3J0IG9mIGNlbnRlciBvZiBhIHRyaWFuZ2xlCiAgICAgICAgKHlpICsgMC43NSkgKiBlbGVtZW50U2l6ZSwgaCAvLyB2ZXJ0aWNhbCBjZW50ZXIKICAgICAgICApOyAvLyBUb3AgdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbMF0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgMC4yNSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWkgKyAxXSAtIGgpOwogICAgICAgIHZlcnRzWzFdLnNldCgtMC43NSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpICsgMV0gLSBoKTsKICAgICAgICB2ZXJ0c1syXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAtMC43NSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldIC0gaCk7IC8vIGJvdHRvbSB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1szXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOwogICAgICAgIHZlcnRzWzRdLnNldCgtMC43NSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOwogICAgICAgIHZlcnRzWzVdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIC0wLjc1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOyAvLyBUb3AgdHJpYW5nbGUKCiAgICAgICAgZmFjZXNbMF1bMF0gPSAwOwogICAgICAgIGZhY2VzWzBdWzFdID0gMTsKICAgICAgICBmYWNlc1swXVsyXSA9IDI7IC8vIGJvdHRvbSB0cmlhbmdsZQoKICAgICAgICBmYWNlc1sxXVswXSA9IDU7CiAgICAgICAgZmFjZXNbMV1bMV0gPSA0OwogICAgICAgIGZhY2VzWzFdWzJdID0gMzsgLy8gK3ggZmFjaW5nIHF1YWQKCiAgICAgICAgZmFjZXNbMl1bMF0gPSAyOwogICAgICAgIGZhY2VzWzJdWzFdID0gNTsKICAgICAgICBmYWNlc1syXVsyXSA9IDM7CiAgICAgICAgZmFjZXNbMl1bM10gPSAwOyAvLyAreSBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1szXVswXSA9IDM7CiAgICAgICAgZmFjZXNbM11bMV0gPSA0OwogICAgICAgIGZhY2VzWzNdWzJdID0gMTsKICAgICAgICBmYWNlc1szXVszXSA9IDA7IC8vIC14eSBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1s0XVswXSA9IDE7CiAgICAgICAgZmFjZXNbNF1bMV0gPSA0OwogICAgICAgIGZhY2VzWzRdWzJdID0gNTsKICAgICAgICBmYWNlc1s0XVszXSA9IDI7CiAgICAgIH0KCiAgICAgIHJlc3VsdC5jb21wdXRlTm9ybWFscygpOwogICAgICByZXN1bHQuY29tcHV0ZUVkZ2VzKCk7CiAgICAgIHJlc3VsdC51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB0aGlzLnNldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSwgcmVzdWx0LCBvZmZzZXRSZXN1bHQpOwogICAgfQoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNldCgwLCAwLCAwKTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiAoLy8gVGhlIHRlcnJhaW4gaXMgaW5maW5pdGUKICAgICAgICBOdW1iZXIuTUFYX1ZBTFVFCiAgICAgICk7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLyoqIEBUT0RPIGRvIGl0IHByb3Blcmx5ICovCiAgICAgIG1pbi5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CiAgICAgIG1heC5zZXQoTnVtYmVyLk1BWF9WQUxVRSwgTnVtYmVyLk1BWF9WQUxVRSwgTnVtYmVyLk1BWF9WQUxVRSk7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIFVzZSB0aGUgYm91bmRpbmcgYm94IG9mIHRoZSBtaW4vbWF4IHZhbHVlcwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBzID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IG5ldyBWZWMzKGRhdGEubGVuZ3RoICogcywgZGF0YVswXS5sZW5ndGggKiBzLCBNYXRoLm1heChNYXRoLmFicyh0aGlzLm1heFZhbHVlKSwgTWF0aC5hYnModGhpcy5taW5WYWx1ZSkpKS5sZW5ndGgoKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgaGVpZ2h0IHZhbHVlcyBmcm9tIGFuIGltYWdlLiBDdXJyZW50bHkgb25seSBzdXBwb3J0ZWQgaW4gYnJvd3Nlci4KICAgICAqLwoKCiAgICBzZXRIZWlnaHRzRnJvbUltYWdlKGltYWdlLCBzY2FsZSkgewogICAgICBjb25zdCB7CiAgICAgICAgeCwKICAgICAgICB6LAogICAgICAgIHkKICAgICAgfSA9IHNjYWxlOwogICAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgY2FudmFzLndpZHRoID0gaW1hZ2Uud2lkdGg7CiAgICAgIGNhbnZhcy5oZWlnaHQgPSBpbWFnZS5oZWlnaHQ7CiAgICAgIGNvbnN0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIDApOwogICAgICBjb25zdCBpbWFnZURhdGEgPSBjb250ZXh0LmdldEltYWdlRGF0YSgwLCAwLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0KTsKICAgICAgY29uc3QgbWF0cml4ID0gdGhpcy5kYXRhOwogICAgICBtYXRyaXgubGVuZ3RoID0gMDsKICAgICAgdGhpcy5lbGVtZW50U2l6ZSA9IE1hdGguYWJzKHgpIC8gaW1hZ2VEYXRhLndpZHRoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbWFnZURhdGEuaGVpZ2h0OyBpKyspIHsKICAgICAgICBjb25zdCByb3cgPSBbXTsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBpbWFnZURhdGEud2lkdGg7IGorKykgewogICAgICAgICAgY29uc3QgYSA9IGltYWdlRGF0YS5kYXRhWyhpICogaW1hZ2VEYXRhLmhlaWdodCArIGopICogNF07CiAgICAgICAgICBjb25zdCBiID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0ICsgMV07CiAgICAgICAgICBjb25zdCBjID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0ICsgMl07CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSAoYSArIGIgKyBjKSAvIDQgLyAyNTUgKiB6OwoKICAgICAgICAgIGlmICh4IDwgMCkgewogICAgICAgICAgICByb3cucHVzaChoZWlnaHQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcm93LnVuc2hpZnQoaGVpZ2h0KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh5IDwgMCkgewogICAgICAgICAgbWF0cml4LnVuc2hpZnQocm93KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbWF0cml4LnB1c2gocm93KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlTWF4VmFsdWUoKTsKICAgICAgdGhpcy51cGRhdGVNaW5WYWx1ZSgpOwogICAgICB0aGlzLnVwZGF0ZSgpOwogICAgfQoKICB9CiAgY29uc3QgZ2V0SGVpZ2h0QXRfaWR4ID0gW107CiAgY29uc3QgZ2V0SGVpZ2h0QXRfd2VpZ2h0cyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0SGVpZ2h0QXRfYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0SGVpZ2h0QXRfYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0SGVpZ2h0QXRfYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfZTAgPSBuZXcgVmVjMygpOwogIGNvbnN0IGdldE5vcm1hbEF0X2UxID0gbmV3IFZlYzMoKTsgLy8gZnJvbSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9CYXJ5Y2VudHJpY19jb29yZGluYXRlX3N5c3RlbQoKICBmdW5jdGlvbiBiYXJ5Y2VudHJpY1dlaWdodHMoeCwgeSwgYXgsIGF5LCBieCwgYnksIGN4LCBjeSwgcmVzdWx0KSB7CiAgICByZXN1bHQueCA9ICgoYnkgLSBjeSkgKiAoeCAtIGN4KSArIChjeCAtIGJ4KSAqICh5IC0gY3kpKSAvICgoYnkgLSBjeSkgKiAoYXggLSBjeCkgKyAoY3ggLSBieCkgKiAoYXkgLSBjeSkpOwogICAgcmVzdWx0LnkgPSAoKGN5IC0gYXkpICogKHggLSBjeCkgKyAoYXggLSBjeCkgKiAoeSAtIGN5KSkgLyAoKGJ5IC0gY3kpICogKGF4IC0gY3gpICsgKGN4IC0gYngpICogKGF5IC0gY3kpKTsKICAgIHJlc3VsdC56ID0gMSAtIHJlc3VsdC54IC0gcmVzdWx0Lnk7CiAgfQoKICAvKioKICAgKiBPY3RyZWVOb2RlCiAgICovCiAgY2xhc3MgT2N0cmVlTm9kZSB7CiAgICAvKiogVGhlIHJvb3Qgbm9kZSAqLwoKICAgIC8qKiBCb3VuZGFyeSBvZiB0aGlzIG5vZGUgKi8KCiAgICAvKiogQ29udGFpbmVkIGRhdGEgYXQgdGhlIGN1cnJlbnQgbm9kZSBsZXZlbCAqLwoKICAgIC8qKiBDaGlsZHJlbiB0byB0aGlzIG5vZGUgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5yb290ID0gb3B0aW9ucy5yb290IHx8IG51bGw7CiAgICAgIHRoaXMuYWFiYiA9IG9wdGlvbnMuYWFiYiA/IG9wdGlvbnMuYWFiYi5jbG9uZSgpIDogbmV3IEFBQkIoKTsKICAgICAgdGhpcy5kYXRhID0gW107CiAgICAgIHRoaXMuY2hpbGRyZW4gPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogcmVzZXQKICAgICAqLwoKCiAgICByZXNldCgpIHsKICAgICAgdGhpcy5jaGlsZHJlbi5sZW5ndGggPSB0aGlzLmRhdGEubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogSW5zZXJ0IGRhdGEgaW50byB0aGlzIG5vZGUKICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBzdWNjZXNzZnVsLCBvdGhlcndpc2UgZmFsc2UKICAgICAqLwoKCiAgICBpbnNlcnQoYWFiYiwgZWxlbWVudERhdGEsIGxldmVsKSB7CiAgICAgIGlmIChsZXZlbCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbGV2ZWwgPSAwOwogICAgICB9CgogICAgICBjb25zdCBub2RlRGF0YSA9IHRoaXMuZGF0YTsgLy8gSWdub3JlIG9iamVjdHMgdGhhdCBkbyBub3QgYmVsb25nIGluIHRoaXMgbm9kZQoKICAgICAgaWYgKCF0aGlzLmFhYmIuY29udGFpbnMoYWFiYikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIG9iamVjdCBjYW5ub3QgYmUgYWRkZWQKICAgICAgfQoKICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICBjb25zdCBtYXhEZXB0aCA9IHRoaXMubWF4RGVwdGggfHwgdGhpcy5yb290Lm1heERlcHRoOwoKICAgICAgaWYgKGxldmVsIDwgbWF4RGVwdGgpIHsKICAgICAgICAvLyBTdWJkaXZpZGUgaWYgdGhlcmUgYXJlIG5vIGNoaWxkcmVuIHlldAogICAgICAgIGxldCBzdWJkaXZpZGVkID0gZmFsc2U7CgogICAgICAgIGlmICghY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLnN1YmRpdmlkZSgpOwogICAgICAgICAgc3ViZGl2aWRlZCA9IHRydWU7CiAgICAgICAgfSAvLyBhZGQgdG8gd2hpY2hldmVyIG5vZGUgd2lsbCBhY2NlcHQgaXQKCgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSA4OyBpKyspIHsKICAgICAgICAgIGlmIChjaGlsZHJlbltpXS5pbnNlcnQoYWFiYiwgZWxlbWVudERhdGEsIGxldmVsICsgMSkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoc3ViZGl2aWRlZCkgewogICAgICAgICAgLy8gTm8gY2hpbGRyZW4gYWNjZXB0ZWQhIE1pZ2h0IGFzIHdlbGwganVzdCByZW1vdmUgZW0gc2luY2UgdGhleSBjb250YWluIG5vbmUKICAgICAgICAgIGNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgfQogICAgICB9IC8vIFRvbyBkZWVwLCBvciBjaGlsZHJlbiBkaWRudCB3YW50IGl0LiBhZGQgaXQgaW4gY3VycmVudCBub2RlCgoKICAgICAgbm9kZURhdGEucHVzaChlbGVtZW50RGF0YSk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBDcmVhdGUgOCBlcXVhbGx5IHNpemVkIGNoaWxkcmVuIG5vZGVzIGFuZCBwdXQgdGhlbSBpbiB0aGUgYGNoaWxkcmVuYCBhcnJheS4KICAgICAqLwoKCiAgICBzdWJkaXZpZGUoKSB7CiAgICAgIGNvbnN0IGFhYmIgPSB0aGlzLmFhYmI7CiAgICAgIGNvbnN0IGwgPSBhYWJiLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSBhYWJiLnVwcGVyQm91bmQ7CiAgICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKICAgICAgY2hpbGRyZW4ucHVzaChuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMCwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDAsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAxLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMSwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDEsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAwLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMCwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDEsIDApCiAgICAgICAgfSkKICAgICAgfSkpOwogICAgICB1LnZzdWIobCwgaGFsZkRpYWdvbmFsKTsKICAgICAgaGFsZkRpYWdvbmFsLnNjYWxlKDAuNSwgaGFsZkRpYWdvbmFsKTsKICAgICAgY29uc3Qgcm9vdCA9IHRoaXMucm9vdCB8fCB0aGlzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNoaWxkID0gY2hpbGRyZW5baV07IC8vIFNldCBjdXJyZW50IG5vZGUgYXMgcm9vdAoKICAgICAgICBjaGlsZC5yb290ID0gcm9vdDsgLy8gQ29tcHV0ZSBib3VuZHMKCiAgICAgICAgY29uc3QgbG93ZXJCb3VuZCA9IGNoaWxkLmFhYmIubG93ZXJCb3VuZDsKICAgICAgICBsb3dlckJvdW5kLnggKj0gaGFsZkRpYWdvbmFsLng7CiAgICAgICAgbG93ZXJCb3VuZC55ICo9IGhhbGZEaWFnb25hbC55OwogICAgICAgIGxvd2VyQm91bmQueiAqPSBoYWxmRGlhZ29uYWwuejsKICAgICAgICBsb3dlckJvdW5kLnZhZGQobCwgbG93ZXJCb3VuZCk7IC8vIFVwcGVyIGJvdW5kIGlzIGFsd2F5cyBsb3dlciBib3VuZCArIGhhbGZEaWFnb25hbAoKICAgICAgICBsb3dlckJvdW5kLnZhZGQoaGFsZkRpYWdvbmFsLCBjaGlsZC5hYWJiLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbGwgZGF0YSwgcG90ZW50aWFsbHkgd2l0aGluIGFuIEFBQkIKICAgICAqIEByZXR1cm4gVGhlICJyZXN1bHQiIG9iamVjdAogICAgICovCgoKICAgIGFhYmJRdWVyeShhYWJiLCByZXN1bHQpIHsKICAgICAgdGhpcy5kYXRhOyAvLyBhYm9ydCBpZiB0aGUgcmFuZ2UgZG9lcyBub3QgaW50ZXJzZWN0IHRoaXMgbm9kZQogICAgICAvLyBpZiAoIXRoaXMuYWFiYi5vdmVybGFwcyhhYWJiKSl7CiAgICAgIC8vICAgICByZXR1cm4gcmVzdWx0OwogICAgICAvLyB9CiAgICAgIC8vIEFkZCBvYmplY3RzIGF0IHRoaXMgbGV2ZWwKICAgICAgLy8gQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkocmVzdWx0LCBub2RlRGF0YSk7CiAgICAgIC8vIEFkZCBjaGlsZCBkYXRhCiAgICAgIC8vIEB0b2RvIHVud3JhcCByZWN1cnNpb24gaW50byBhIHF1ZXVlIC8gbG9vcCwgdGhhdCdzIGZhc3RlciBpbiBKUwoKICAgICAgdGhpcy5jaGlsZHJlbjsgLy8gZm9yIChsZXQgaSA9IDAsIE4gPSB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgIC8vICAgICBjaGlsZHJlbltpXS5hYWJiUXVlcnkoYWFiYiwgcmVzdWx0KTsKICAgICAgLy8gfQoKICAgICAgY29uc3QgcXVldWUgPSBbdGhpc107CgogICAgICB3aGlsZSAocXVldWUubGVuZ3RoKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IHF1ZXVlLnBvcCgpOwoKICAgICAgICBpZiAobm9kZS5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShyZXN1bHQsIG5vZGUuZGF0YSk7CiAgICAgICAgfQoKICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShxdWV1ZSwgbm9kZS5jaGlsZHJlbik7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbGwgZGF0YSwgcG90ZW50aWFsbHkgaW50ZXJzZWN0ZWQgYnkgYSByYXkuCiAgICAgKiBAcmV0dXJuIFRoZSAicmVzdWx0IiBvYmplY3QKICAgICAqLwoKCiAgICByYXlRdWVyeShyYXksIHRyZWVUcmFuc2Zvcm0sIHJlc3VsdCkgewogICAgICAvLyBVc2UgYWFiYiBxdWVyeSBmb3Igbm93LgoKICAgICAgLyoqIEB0b2RvIGltcGxlbWVudCByZWFsIHJheSBxdWVyeSB3aGljaCBuZWVkcyBsZXNzIGxvb2t1cHMgKi8KICAgICAgcmF5LmdldEFBQkIodG1wQUFCQik7CiAgICAgIHRtcEFBQkIudG9Mb2NhbEZyYW1lKHRyZWVUcmFuc2Zvcm0sIHRtcEFBQkIpOwogICAgICB0aGlzLmFhYmJRdWVyeSh0bXBBQUJCLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiByZW1vdmVFbXB0eU5vZGVzCiAgICAgKi8KCgogICAgcmVtb3ZlRW1wdHlOb2RlcygpIHsKICAgICAgZm9yIChsZXQgaSA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICB0aGlzLmNoaWxkcmVuW2ldLnJlbW92ZUVtcHR5Tm9kZXMoKTsKCiAgICAgICAgaWYgKCF0aGlzLmNoaWxkcmVuW2ldLmNoaWxkcmVuLmxlbmd0aCAmJiAhdGhpcy5jaGlsZHJlbltpXS5kYXRhLmxlbmd0aCkgewogICAgICAgICAgdGhpcy5jaGlsZHJlbi5zcGxpY2UoaSwgMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogIH0KICAvKioKICAgKiBPY3RyZWUKICAgKi8KCgogIGNsYXNzIE9jdHJlZSBleHRlbmRzIE9jdHJlZU5vZGUgewogICAgLyoqCiAgICAgKiBNYXhpbXVtIHN1YmRpdmlzaW9uIGRlcHRoCiAgICAgKiBAZGVmYXVsdCA4CiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBhYWJiIFRoZSB0b3RhbCBBQUJCIG9mIHRoZSB0cmVlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGFhYmIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoewogICAgICAgIHJvb3Q6IG51bGwsCiAgICAgICAgYWFiYgogICAgICB9KTsKICAgICAgdGhpcy5tYXhEZXB0aCA9IHR5cGVvZiBvcHRpb25zLm1heERlcHRoICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4RGVwdGggOiA4OwogICAgfQoKICB9CiAgY29uc3QgaGFsZkRpYWdvbmFsID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBBQUJCID0gbmV3IEFBQkIoKTsKCiAgLyoqCiAgICogVHJpbWVzaC4KICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBIb3cgdG8gbWFrZSBhIG1lc2ggd2l0aCBhIHNpbmdsZSB0cmlhbmdsZQogICAqICAgICBjb25zdCB2ZXJ0aWNlcyA9IFsKICAgKiAgICAgICAgIDAsIDAsIDAsIC8vIHZlcnRleCAwCiAgICogICAgICAgICAxLCAwLCAwLCAvLyB2ZXJ0ZXggMQogICAqICAgICAgICAgMCwgMSwgMCAgLy8gdmVydGV4IDIKICAgKiAgICAgXQogICAqICAgICBjb25zdCBpbmRpY2VzID0gWwogICAqICAgICAgICAgMCwgMSwgMiAgLy8gdHJpYW5nbGUgMAogICAqICAgICBdCiAgICogICAgIGNvbnN0IHRyaW1lc2hTaGFwZSA9IG5ldyBDQU5OT04uVHJpbWVzaCh2ZXJ0aWNlcywgaW5kaWNlcykKICAgKi8KICBjbGFzcyBUcmltZXNoIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiB2ZXJ0aWNlcwogICAgICovCgogICAgLyoqCiAgICAgKiBBcnJheSBvZiBpbnRlZ2VycywgaW5kaWNhdGluZyB3aGljaCB2ZXJ0aWNlcyBlYWNoIHRyaWFuZ2xlIGNvbnNpc3RzIG9mLiBUaGUgbGVuZ3RoIG9mIHRoaXMgYXJyYXkgaXMgdGh1cyAzIHRpbWVzIHRoZSBudW1iZXIgb2YgdHJpYW5nbGVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgbm9ybWFscyBkYXRhLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgbG9jYWwgQUFCQiBvZiB0aGUgbWVzaC4KICAgICAqLwoKICAgIC8qKgogICAgICogUmVmZXJlbmNlcyB0byB2ZXJ0ZXggcGFpcnMsIG1ha2luZyB1cCBhbGwgdW5pcXVlIGVkZ2VzIGluIHRoZSB0cmltZXNoLgogICAgICovCgogICAgLyoqCiAgICAgKiBMb2NhbCBzY2FsaW5nIG9mIHRoZSBtZXNoLiBVc2UgLnNldFNjYWxlKCkgdG8gc2V0IGl0LgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgaW5kZXhlZCB0cmlhbmdsZXMuIFVzZSAudXBkYXRlVHJlZSgpIHRvIHVwZGF0ZSBpdC4KICAgICAqLwogICAgY29uc3RydWN0b3IodmVydGljZXMsIGluZGljZXMpIHsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLlRSSU1FU0gKICAgICAgfSk7CiAgICAgIHRoaXMudmVydGljZXMgPSBuZXcgRmxvYXQzMkFycmF5KHZlcnRpY2VzKTsKICAgICAgdGhpcy5pbmRpY2VzID0gbmV3IEludDE2QXJyYXkoaW5kaWNlcyk7CiAgICAgIHRoaXMubm9ybWFscyA9IG5ldyBGbG9hdDMyQXJyYXkoaW5kaWNlcy5sZW5ndGgpOwogICAgICB0aGlzLmFhYmIgPSBuZXcgQUFCQigpOwogICAgICB0aGlzLmVkZ2VzID0gbnVsbDsKICAgICAgdGhpcy5zY2FsZSA9IG5ldyBWZWMzKDEsIDEsIDEpOwogICAgICB0aGlzLnRyZWUgPSBuZXcgT2N0cmVlKCk7CiAgICAgIHRoaXMudXBkYXRlRWRnZXMoKTsKICAgICAgdGhpcy51cGRhdGVOb3JtYWxzKCk7CiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMudXBkYXRlVHJlZSgpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGVUcmVlCiAgICAgKi8KCgogICAgdXBkYXRlVHJlZSgpIHsKICAgICAgY29uc3QgdHJlZSA9IHRoaXMudHJlZTsKICAgICAgdHJlZS5yZXNldCgpOwogICAgICB0cmVlLmFhYmIuY29weSh0aGlzLmFhYmIpOwogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7IC8vIFRoZSBsb2NhbCBtZXNoIEFBQkIgaXMgc2NhbGVkLCBidXQgdGhlIG9jdHJlZSBBQUJCIHNob3VsZCBiZSB1bnNjYWxlZAoKICAgICAgdHJlZS5hYWJiLmxvd2VyQm91bmQueCAqPSAxIC8gc2NhbGUueDsKICAgICAgdHJlZS5hYWJiLmxvd2VyQm91bmQueSAqPSAxIC8gc2NhbGUueTsKICAgICAgdHJlZS5hYWJiLmxvd2VyQm91bmQueiAqPSAxIC8gc2NhbGUuejsKICAgICAgdHJlZS5hYWJiLnVwcGVyQm91bmQueCAqPSAxIC8gc2NhbGUueDsKICAgICAgdHJlZS5hYWJiLnVwcGVyQm91bmQueSAqPSAxIC8gc2NhbGUueTsKICAgICAgdHJlZS5hYWJiLnVwcGVyQm91bmQueiAqPSAxIC8gc2NhbGUuejsgLy8gSW5zZXJ0IGFsbCB0cmlhbmdsZXMKCiAgICAgIGNvbnN0IHRyaWFuZ2xlQUFCQiA9IG5ldyBBQUJCKCk7CiAgICAgIGNvbnN0IGEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBvaW50cyA9IFthLCBiLCBjXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIC8vdGhpcy5nZXRUcmlhbmdsZVZlcnRpY2VzKGksIGEsIGIsIGMpOwogICAgICAgIC8vIEdldCB1bnNjYWxlZCB0cmlhbmdsZSB2ZXJ0cwogICAgICAgIGNvbnN0IGkzID0gaSAqIDM7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwoKICAgICAgICB0aGlzLl9nZXRVbnNjYWxlZFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKCiAgICAgICAgdHJpYW5nbGVBQUJCLnNldEZyb21Qb2ludHMocG9pbnRzKTsKICAgICAgICB0cmVlLmluc2VydCh0cmlhbmdsZUFBQkIsIGkpOwogICAgICB9CgogICAgICB0cmVlLnJlbW92ZUVtcHR5Tm9kZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRyaWFuZ2xlcyBpbiBhIGxvY2FsIEFBQkIgZnJvbSB0aGUgdHJpbWVzaC4KICAgICAqIEBwYXJhbSByZXN1bHQgQW4gYXJyYXkgb2YgaW50ZWdlcnMsIHJlZmVyZW5jaW5nIHRoZSBxdWVyaWVkIHRyaWFuZ2xlcy4KICAgICAqLwoKCiAgICBnZXRUcmlhbmdsZXNJbkFBQkIoYWFiYiwgcmVzdWx0KSB7CiAgICAgIHVuc2NhbGVkQUFCQi5jb3B5KGFhYmIpOyAvLyBTY2FsZSBpdCB0byBsb2NhbAoKICAgICAgY29uc3Qgc2NhbGUgPSB0aGlzLnNjYWxlOwogICAgICBjb25zdCBpc3ggPSBzY2FsZS54OwogICAgICBjb25zdCBpc3kgPSBzY2FsZS55OwogICAgICBjb25zdCBpc3ogPSBzY2FsZS56OwogICAgICBjb25zdCBsID0gdW5zY2FsZWRBQUJCLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB1bnNjYWxlZEFBQkIudXBwZXJCb3VuZDsKICAgICAgbC54IC89IGlzeDsKICAgICAgbC55IC89IGlzeTsKICAgICAgbC56IC89IGlzejsKICAgICAgdS54IC89IGlzeDsKICAgICAgdS55IC89IGlzeTsKICAgICAgdS56IC89IGlzejsKICAgICAgcmV0dXJuIHRoaXMudHJlZS5hYWJiUXVlcnkodW5zY2FsZWRBQUJCLCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRTY2FsZQogICAgICovCgoKICAgIHNldFNjYWxlKHNjYWxlKSB7CiAgICAgIGNvbnN0IHdhc1VuaWZvcm0gPSB0aGlzLnNjYWxlLnggPT09IHRoaXMuc2NhbGUueSAmJiB0aGlzLnNjYWxlLnkgPT09IHRoaXMuc2NhbGUuejsKICAgICAgY29uc3QgaXNVbmlmb3JtID0gc2NhbGUueCA9PT0gc2NhbGUueSAmJiBzY2FsZS55ID09PSBzY2FsZS56OwoKICAgICAgaWYgKCEod2FzVW5pZm9ybSAmJiBpc1VuaWZvcm0pKSB7CiAgICAgICAgLy8gTm9uLXVuaWZvcm0gc2NhbGluZy4gTmVlZCB0byB1cGRhdGUgbm9ybWFscy4KICAgICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgfQoKICAgICAgdGhpcy5zY2FsZS5jb3B5KHNjYWxlKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuIFdpbGwgc2F2ZSBpbiB0aGUgYC5ub3JtYWxzYCBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGVOb3JtYWxzKCkgewogICAgICBjb25zdCBuID0gY29tcHV0ZU5vcm1hbHNfbjsgLy8gR2VuZXJhdGUgbm9ybWFscwoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMubm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuaW5kaWNlc1tpM107CiAgICAgICAgY29uc3QgYiA9IHRoaXMuaW5kaWNlc1tpMyArIDFdOwogICAgICAgIGNvbnN0IGMgPSB0aGlzLmluZGljZXNbaTMgKyAyXTsKICAgICAgICB0aGlzLmdldFZlcnRleChhLCB2YSk7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYiwgdmIpOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGMsIHZjKTsKICAgICAgICBUcmltZXNoLmNvbXB1dGVOb3JtYWwodmIsIHZhLCB2Yywgbik7CiAgICAgICAgbm9ybWFsc1tpM10gPSBuLng7CiAgICAgICAgbm9ybWFsc1tpMyArIDFdID0gbi55OwogICAgICAgIG5vcm1hbHNbaTMgKyAyXSA9IG4uejsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuZWRnZXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlRWRnZXMoKSB7CiAgICAgIGNvbnN0IGVkZ2VzID0ge307CgogICAgICBjb25zdCBhZGQgPSAoYSwgYikgPT4gewogICAgICAgIGNvbnN0IGtleSA9IGEgPCBiID8gYCR7YX1fJHtifWAgOiBgJHtifV8ke2F9YDsKICAgICAgICBlZGdlc1trZXldID0gdHJ1ZTsKICAgICAgfTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuaW5kaWNlc1tpM107CiAgICAgICAgY29uc3QgYiA9IHRoaXMuaW5kaWNlc1tpMyArIDFdOwogICAgICAgIGNvbnN0IGMgPSB0aGlzLmluZGljZXNbaTMgKyAyXTsKICAgICAgICBhZGQoYSwgYik7CiAgICAgICAgYWRkKGIsIGMpOwogICAgICAgIGFkZChjLCBhKTsKICAgICAgfQoKICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGVkZ2VzKTsKICAgICAgdGhpcy5lZGdlcyA9IG5ldyBJbnQxNkFycmF5KGtleXMubGVuZ3RoICogMik7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBpbmRpY2VzID0ga2V5c1tpXS5zcGxpdCgnXycpOwogICAgICAgIHRoaXMuZWRnZXNbMiAqIGldID0gcGFyc2VJbnQoaW5kaWNlc1swXSwgMTApOwogICAgICAgIHRoaXMuZWRnZXNbMiAqIGkgKyAxXSA9IHBhcnNlSW50KGluZGljZXNbMV0sIDEwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYW4gZWRnZSB2ZXJ0ZXgKICAgICAqIEBwYXJhbSBmaXJzdE9yU2Vjb25kIDAgb3IgMSwgZGVwZW5kaW5nIG9uIHdoaWNoIG9uZSBvZiB0aGUgdmVydGljZXMgeW91IG5lZWQuCiAgICAgKiBAcGFyYW0gdmVydGV4U3RvcmUgV2hlcmUgdG8gc3RvcmUgdGhlIHJlc3VsdAogICAgICovCgoKICAgIGdldEVkZ2VWZXJ0ZXgoZWRnZUluZGV4LCBmaXJzdE9yU2Vjb25kLCB2ZXJ0ZXhTdG9yZSkgewogICAgICBjb25zdCB2ZXJ0ZXhJbmRleCA9IHRoaXMuZWRnZXNbZWRnZUluZGV4ICogMiArIChmaXJzdE9yU2Vjb25kID8gMSA6IDApXTsKICAgICAgdGhpcy5nZXRWZXJ0ZXgodmVydGV4SW5kZXgsIHZlcnRleFN0b3JlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgdmVjdG9yIGFsb25nIGFuIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0RWRnZVZlY3RvcihlZGdlSW5kZXgsIHZlY3RvclN0b3JlKSB7CiAgICAgIGNvbnN0IHZhID0gZ2V0RWRnZVZlY3Rvcl92YTsKICAgICAgY29uc3QgdmIgPSBnZXRFZGdlVmVjdG9yX3ZiOwogICAgICB0aGlzLmdldEVkZ2VWZXJ0ZXgoZWRnZUluZGV4LCAwLCB2YSk7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDEsIHZiKTsKICAgICAgdmIudnN1Yih2YSwgdmVjdG9yU3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgZmFjZSBub3JtYWwgZ2l2ZW4gMyB2ZXJ0aWNlcwogICAgICovCgoKICAgIHN0YXRpYyBjb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCkgewogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdmVydGV4IGkuCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0VmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CgogICAgICB0aGlzLl9nZXRVbnNjYWxlZFZlcnRleChpLCBvdXQpOwoKICAgICAgb3V0LnggKj0gc2NhbGUueDsKICAgICAgb3V0LnkgKj0gc2NhbGUueTsKICAgICAgb3V0LnogKj0gc2NhbGUuejsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHJhdyB2ZXJ0ZXggaQogICAgICogQHJldHVybiBUaGUgIm91dCIgdmVjdG9yIG9iamVjdAogICAgICovCgoKICAgIF9nZXRVbnNjYWxlZFZlcnRleChpLCBvdXQpIHsKICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICByZXR1cm4gb3V0LnNldCh2ZXJ0aWNlc1tpM10sIHZlcnRpY2VzW2kzICsgMV0sIHZlcnRpY2VzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZXJ0ZXggZnJvbSB0aGUgdHJpbWVzaCx0cmFuc2Zvcm1lZCBieSB0aGUgZ2l2ZW4gcG9zaXRpb24gYW5kIHF1YXRlcm5pb24uCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0V29ybGRWZXJ0ZXgoaSwgcG9zLCBxdWF0LCBvdXQpIHsKICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgb3V0KTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHBvcywgcXVhdCwgb3V0LCBvdXQpOwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHRocmVlIHZlcnRpY2VzIGZvciB0cmlhbmdsZSBpLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYykgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTNdLCBhKTsKICAgICAgdGhpcy5nZXRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMV0sIGIpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAyXSwgYyk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiB0cmlhbmdsZSBpLgogICAgICogQHJldHVybiBUaGUgInRhcmdldCIgdmVjdG9yIG9iamVjdAogICAgICovCgoKICAgIGdldE5vcm1hbChpLCB0YXJnZXQpIHsKICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgcmV0dXJuIHRhcmdldC5zZXQodGhpcy5ub3JtYWxzW2kzXSwgdGhpcy5ub3JtYWxzW2kzICsgMV0sIHRoaXMubm9ybWFsc1tpMyArIDJdKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUaGUgInRhcmdldCIgdmVjdG9yIG9iamVjdAogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgLy8gQXBwcm94aW1hdGUgd2l0aCBib3ggaW5lcnRpYQogICAgICAvLyBFeGFjdCBpbmVydGlhIGNhbGN1bGF0aW9uIGlzIG92ZXJraWxsLCBidXQgc2VlIGh0dHA6Ly9nZW9tZXRyaWN0b29scy5jb20vRG9jdW1lbnRhdGlvbi9Qb2x5aGVkcmFsTWFzc1Byb3BlcnRpZXMucGRmIGZvciB0aGUgY29ycmVjdCB3YXkgdG8gZG8gaXQKICAgICAgdGhpcy5jb21wdXRlTG9jYWxBQUJCKGNsaV9hYWJiKTsKICAgICAgY29uc3QgeCA9IGNsaV9hYWJiLnVwcGVyQm91bmQueCAtIGNsaV9hYWJiLmxvd2VyQm91bmQueDsKICAgICAgY29uc3QgeSA9IGNsaV9hYWJiLnVwcGVyQm91bmQueSAtIGNsaV9hYWJiLmxvd2VyQm91bmQueTsKICAgICAgY29uc3QgeiA9IGNsaV9hYWJiLnVwcGVyQm91bmQueiAtIGNsaV9hYWJiLmxvd2VyQm91bmQuejsKICAgICAgcmV0dXJuIHRhcmdldC5zZXQoMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB6ICogMiAqIHopLCAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeCAqIDIgKiB4ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGxvY2FsIEFBQkIgZm9yIHRoZSB0cmltZXNoCiAgICAgKi8KCgogICAgY29tcHV0ZUxvY2FsQUFCQihhYWJiKSB7CiAgICAgIGNvbnN0IGwgPSBhYWJiLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSBhYWJiLnVwcGVyQm91bmQ7CiAgICAgIGNvbnN0IG4gPSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsKICAgICAgdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3QgdiA9IGNvbXB1dGVMb2NhbEFBQkJfd29ybGRWZXJ0OwogICAgICB0aGlzLmdldFZlcnRleCgwLCB2KTsKICAgICAgbC5jb3B5KHYpOwogICAgICB1LmNvcHkodik7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbjsgaSsrKSB7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgdik7CgogICAgICAgIGlmICh2LnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IHUueCkgewogICAgICAgICAgdS54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGwueSkgewogICAgICAgICAgbC55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gdS55KSB7CiAgICAgICAgICB1LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgbC56KSB7CiAgICAgICAgICBsLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgLmFhYmJgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQUFCQigpIHsKICAgICAgdGhpcy5jb21wdXRlTG9jYWxBQUJCKHRoaXMuYWFiYik7CiAgICB9CiAgICAvKioKICAgICAqIFdpbGwgdXBkYXRlIHRoZSBgLmJvdW5kaW5nU3BoZXJlUmFkaXVzYCBwcm9wZXJ0eQogICAgICovCgoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICAvLyBBc3N1bWUgcG9pbnRzIGFyZSBkaXN0cmlidXRlZCB3aXRoIGxvY2FsICgwLDAsMCkgYXMgY2VudGVyCiAgICAgIGxldCBtYXgyID0gMDsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOID0gdmVydGljZXMubGVuZ3RoIC8gMzsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgdik7CiAgICAgICAgY29uc3Qgbm9ybTIgPSB2Lmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLyoKICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLnZlcnRpY2VzLmxlbmd0aCAvIDMsCiAgICAgICAgICAgICAgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICAgICAgY29uc3QgbWlueCxtaW55LG1pbnosbWF4eCxtYXh5LG1heHo7CiAgICAgICAgICAgY29uc3QgdiA9IHRlbXBXb3JsZFZlcnRleDsKICAgICAgICAgIGZvcihsZXQgaT0wOyBpPG47IGkrKyl7CiAgICAgICAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgdik7CiAgICAgICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICAgICAgICBwb3MudmFkZCh2LCB2KTsKICAgICAgICAgICAgICBpZiAodi54IDwgbWlueCB8fCBtaW54PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi54ID4gbWF4eCB8fCBtYXh4PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIGlmICh2LnkgPCBtaW55IHx8IG1pbnk9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW55ID0gdi55OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnkgPiBtYXh5IHx8IG1heHk9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh5ID0gdi55OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueiA8IG1pbnogfHwgbWluej09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnogPSB2Lno7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueiA+IG1heHogfHwgbWF4ej09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHogPSB2Lno7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgbWluLnNldChtaW54LG1pbnksbWlueik7CiAgICAgICAgICBtYXguc2V0KG1heHgsbWF4eSxtYXh6KTsKICAgICAgICAgICovCiAgICAgIC8vIEZhc3RlciBhcHByb3hpbWF0aW9uIHVzaW5nIGxvY2FsIEFBQkIKICAgICAgY29uc3QgZnJhbWUgPSBjYWxjdWxhdGVXb3JsZEFBQkJfZnJhbWU7CiAgICAgIGNvbnN0IHJlc3VsdCA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9hYWJiOwogICAgICBmcmFtZS5wb3NpdGlvbiA9IHBvczsKICAgICAgZnJhbWUucXVhdGVybmlvbiA9IHF1YXQ7CiAgICAgIHRoaXMuYWFiYi50b1dvcmxkRnJhbWUoZnJhbWUsIHJlc3VsdCk7CiAgICAgIG1pbi5jb3B5KHJlc3VsdC5sb3dlckJvdW5kKTsKICAgICAgbWF4LmNvcHkocmVzdWx0LnVwcGVyQm91bmQpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYXBwcm94aW1hdGUgdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSBhIFRyaW1lc2ggaW5zdGFuY2UsIHNoYXBlZCBhcyBhIHRvcnVzLgogICAgICovCgoKICAgIHN0YXRpYyBjcmVhdGVUb3J1cyhyYWRpdXMsIHR1YmUsIHJhZGlhbFNlZ21lbnRzLCB0dWJ1bGFyU2VnbWVudHMsIGFyYykgewogICAgICBpZiAocmFkaXVzID09PSB2b2lkIDApIHsKICAgICAgICByYWRpdXMgPSAxOwogICAgICB9CgogICAgICBpZiAodHViZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgdHViZSA9IDAuNTsKICAgICAgfQoKICAgICAgaWYgKHJhZGlhbFNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICByYWRpYWxTZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmICh0dWJ1bGFyU2VnbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIHR1YnVsYXJTZWdtZW50cyA9IDY7CiAgICAgIH0KCiAgICAgIGlmIChhcmMgPT09IHZvaWQgMCkgewogICAgICAgIGFyYyA9IE1hdGguUEkgKiAyOwogICAgICB9CgogICAgICBjb25zdCB2ZXJ0aWNlcyA9IFtdOwogICAgICBjb25zdCBpbmRpY2VzID0gW107CgogICAgICBmb3IgKGxldCBqID0gMDsgaiA8PSByYWRpYWxTZWdtZW50czsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHUgPSBpIC8gdHVidWxhclNlZ21lbnRzICogYXJjOwogICAgICAgICAgY29uc3QgdiA9IGogLyByYWRpYWxTZWdtZW50cyAqIE1hdGguUEkgKiAyOwogICAgICAgICAgY29uc3QgeCA9IChyYWRpdXMgKyB0dWJlICogTWF0aC5jb3ModikpICogTWF0aC5jb3ModSk7CiAgICAgICAgICBjb25zdCB5ID0gKHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyh2KSkgKiBNYXRoLnNpbih1KTsKICAgICAgICAgIGNvbnN0IHogPSB0dWJlICogTWF0aC5zaW4odik7CiAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKHgsIHksIHopOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IDE7IGogPD0gcmFkaWFsU2VnbWVudHM7IGorKykgewogICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHR1YnVsYXJTZWdtZW50czsgaSsrKSB7CiAgICAgICAgICBjb25zdCBhID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogaiArIGkgLSAxOwogICAgICAgICAgY29uc3QgYiA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIChqIC0gMSkgKyBpIC0gMTsKICAgICAgICAgIGNvbnN0IGMgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiAoaiAtIDEpICsgaTsKICAgICAgICAgIGNvbnN0IGQgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiBqICsgaTsKICAgICAgICAgIGluZGljZXMucHVzaChhLCBiLCBkKTsKICAgICAgICAgIGluZGljZXMucHVzaChiLCBjLCBkKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBuZXcgVHJpbWVzaCh2ZXJ0aWNlcywgaW5kaWNlcyk7CiAgICB9CgogIH0KICBjb25zdCBjb21wdXRlTm9ybWFsc19uID0gbmV3IFZlYzMoKTsKICBjb25zdCB1bnNjYWxlZEFBQkIgPSBuZXcgQUFCQigpOwogIGNvbnN0IGdldEVkZ2VWZWN0b3JfdmEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGdldEVkZ2VWZWN0b3JfdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICBjb25zdCBhYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2xpX2FhYmIgPSBuZXcgQUFCQigpOwogIGNvbnN0IGNvbXB1dGVMb2NhbEFBQkJfd29ybGRWZXJ0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYWxjdWxhdGVXb3JsZEFBQkJfZnJhbWUgPSBuZXcgVHJhbnNmb3JtKCk7CiAgY29uc3QgY2FsY3VsYXRlV29ybGRBQUJCX2FhYmIgPSBuZXcgQUFCQigpOwoKICAvKioKICAgKiBDb25zdHJhaW50IGVxdWF0aW9uIHNvbHZlciBiYXNlIGNsYXNzLgogICAqLwogIGNsYXNzIFNvbHZlciB7CiAgICAvKioKICAgICAqIEFsbCBlcXVhdGlvbnMgdG8gYmUgc29sdmVkCiAgICAgKi8KCiAgICAvKioKICAgICAqIEB0b2RvIHJlbW92ZSB1c2VsZXNzIGNvbnN0cnVjdG9yCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLmVxdWF0aW9ucyA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiBTaG91bGQgYmUgaW1wbGVtZW50ZWQgaW4gc3ViY2xhc3NlcyEKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdAogICAgICogQHJldHVybiBudW1iZXIgb2YgaXRlcmF0aW9ucyBwZXJmb3JtZWQKICAgICAqLwoKCiAgICBzb2x2ZShkdCwgd29ybGQpIHsKICAgICAgcmV0dXJuICgvLyBTaG91bGQgcmV0dXJuIHRoZSBudW1iZXIgb2YgaXRlcmF0aW9ucyBkb25lIQogICAgICAgIDAKICAgICAgKTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIGFuIGVxdWF0aW9uCiAgICAgKi8KCgogICAgYWRkRXF1YXRpb24oZXEpIHsKICAgICAgaWYgKGVxLmVuYWJsZWQgJiYgIWVxLmJpLmlzVHJpZ2dlciAmJiAhZXEuYmouaXNUcmlnZ2VyKSB7CiAgICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChlcSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGFuIGVxdWF0aW9uCiAgICAgKi8KCgogICAgcmVtb3ZlRXF1YXRpb24oZXEpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IGkgPSBlcXMuaW5kZXhPZihlcSk7CgogICAgICBpZiAoaSAhPT0gLTEpIHsKICAgICAgICBlcXMuc3BsaWNlKGksIDEpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhbGwgZXF1YXRpb25zCiAgICAgKi8KCgogICAgcmVtb3ZlQWxsRXF1YXRpb25zKCkgewogICAgICB0aGlzLmVxdWF0aW9ucy5sZW5ndGggPSAwOwogICAgfQoKICB9CgogIC8qKgogICAqIENvbnN0cmFpbnQgZXF1YXRpb24gR2F1c3MtU2VpZGVsIHNvbHZlci4KICAgKiBAdG9kbyBUaGUgc3Bvb2sgcGFyYW1ldGVycyBzaG91bGQgYmUgc3BlY2lmaWVkIGZvciBlYWNoIGNvbnN0cmFpbnQsIG5vdCBnbG9iYWxseS4KICAgKiBAc2VlIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDA5L2xlY3R1cmVzL3Nwb29rbm90ZXMucGRmCiAgICovCiAgY2xhc3MgR1NTb2x2ZXIgZXh0ZW5kcyBTb2x2ZXIgewogICAgLyoqCiAgICAgKiBUaGUgbnVtYmVyIG9mIHNvbHZlciBpdGVyYXRpb25zIGRldGVybWluZXMgcXVhbGl0eSBvZiB0aGUgY29uc3RyYWludHMgaW4gdGhlIHdvcmxkLgogICAgICogVGhlIG1vcmUgaXRlcmF0aW9ucywgdGhlIG1vcmUgY29ycmVjdCBzaW11bGF0aW9uLiBNb3JlIGl0ZXJhdGlvbnMgbmVlZCBtb3JlIGNvbXB1dGF0aW9ucyB0aG91Z2guIElmIHlvdSBoYXZlIGEgbGFyZ2UgZ3Jhdml0eSBmb3JjZSBpbiB5b3VyIHdvcmxkLCB5b3Ugd2lsbCBuZWVkIG1vcmUgaXRlcmF0aW9ucy4KICAgICAqLwoKICAgIC8qKgogICAgICogV2hlbiB0b2xlcmFuY2UgaXMgcmVhY2hlZCwgdGhlIHN5c3RlbSBpcyBhc3N1bWVkIHRvIGJlIGNvbnZlcmdlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogQHRvZG8gcmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuaXRlcmF0aW9ucyA9IDEwOwogICAgICB0aGlzLnRvbGVyYW5jZSA9IDFlLTc7CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBsZXQgaXRlciA9IDA7CiAgICAgIGNvbnN0IG1heEl0ZXIgPSB0aGlzLml0ZXJhdGlvbnM7CiAgICAgIGNvbnN0IHRvbFNxdWFyZWQgPSB0aGlzLnRvbGVyYW5jZSAqIHRoaXMudG9sZXJhbmNlOwogICAgICBjb25zdCBlcXVhdGlvbnMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgTmVxID0gZXF1YXRpb25zLmxlbmd0aDsKICAgICAgY29uc3QgYm9kaWVzID0gd29ybGQuYm9kaWVzOwogICAgICBjb25zdCBOYm9kaWVzID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgaCA9IGR0OwogICAgICBsZXQgQjsKICAgICAgbGV0IGludkM7CiAgICAgIGxldCBkZWx0YWxhbWJkYTsKICAgICAgbGV0IGRlbHRhbGFtYmRhVG90OwogICAgICBsZXQgR1dsYW1iZGE7CiAgICAgIGxldCBsYW1iZGFqOyAvLyBVcGRhdGUgc29sdmUgbWFzcwoKICAgICAgaWYgKE5lcSAhPT0gMCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOYm9kaWVzOyBpKyspIHsKICAgICAgICAgIGJvZGllc1tpXS51cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgICAgfQogICAgICB9IC8vIFRoaW5ncyB0aGF0IGRvIG5vdCBjaGFuZ2UgZHVyaW5nIGl0ZXJhdGlvbiBjYW4gYmUgY29tcHV0ZWQgb25jZQoKCiAgICAgIGNvbnN0IGludkNzID0gR1NTb2x2ZXJfc29sdmVfaW52Q3M7CiAgICAgIGNvbnN0IEJzID0gR1NTb2x2ZXJfc29sdmVfQnM7CiAgICAgIGNvbnN0IGxhbWJkYSA9IEdTU29sdmVyX3NvbHZlX2xhbWJkYTsKICAgICAgaW52Q3MubGVuZ3RoID0gTmVxOwogICAgICBCcy5sZW5ndGggPSBOZXE7CiAgICAgIGxhbWJkYS5sZW5ndGggPSBOZXE7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmVxOyBpKyspIHsKICAgICAgICBjb25zdCBjID0gZXF1YXRpb25zW2ldOwogICAgICAgIGxhbWJkYVtpXSA9IDAuMDsKICAgICAgICBCc1tpXSA9IGMuY29tcHV0ZUIoaCk7CiAgICAgICAgaW52Q3NbaV0gPSAxLjAgLyBjLmNvbXB1dGVDKCk7CiAgICAgIH0KCiAgICAgIGlmIChOZXEgIT09IDApIHsKICAgICAgICAvLyBSZXNldCB2bGFtYmRhCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICAgIGNvbnN0IHZsYW1iZGEgPSBiLnZsYW1iZGE7CiAgICAgICAgICBjb25zdCB3bGFtYmRhID0gYi53bGFtYmRhOwogICAgICAgICAgdmxhbWJkYS5zZXQoMCwgMCwgMCk7CiAgICAgICAgICB3bGFtYmRhLnNldCgwLCAwLCAwKTsKICAgICAgICB9IC8vIEl0ZXJhdGUgb3ZlciBlcXVhdGlvbnMKCgogICAgICAgIGZvciAoaXRlciA9IDA7IGl0ZXIgIT09IG1heEl0ZXI7IGl0ZXIrKykgewogICAgICAgICAgLy8gQWNjdW11bGF0ZSB0aGUgdG90YWwgZXJyb3IgZm9yIGVhY2ggaXRlcmF0aW9uLgogICAgICAgICAgZGVsdGFsYW1iZGFUb3QgPSAwLjA7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IE5lcTsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IGMgPSBlcXVhdGlvbnNbal07IC8vIENvbXB1dGUgaXRlcmF0aW9uCgogICAgICAgICAgICBCID0gQnNbal07CiAgICAgICAgICAgIGludkMgPSBpbnZDc1tqXTsKICAgICAgICAgICAgbGFtYmRhaiA9IGxhbWJkYVtqXTsKICAgICAgICAgICAgR1dsYW1iZGEgPSBjLmNvbXB1dGVHV2xhbWJkYSgpOwogICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGludkMgKiAoQiAtIEdXbGFtYmRhIC0gYy5lcHMgKiBsYW1iZGFqKTsgLy8gQ2xhbXAgaWYgd2UgYXJlIG5vdCB3aXRoaW4gdGhlIG1pbi9tYXggaW50ZXJ2YWwKCiAgICAgICAgICAgIGlmIChsYW1iZGFqICsgZGVsdGFsYW1iZGEgPCBjLm1pbkZvcmNlKSB7CiAgICAgICAgICAgICAgZGVsdGFsYW1iZGEgPSBjLm1pbkZvcmNlIC0gbGFtYmRhajsKICAgICAgICAgICAgfSBlbHNlIGlmIChsYW1iZGFqICsgZGVsdGFsYW1iZGEgPiBjLm1heEZvcmNlKSB7CiAgICAgICAgICAgICAgZGVsdGFsYW1iZGEgPSBjLm1heEZvcmNlIC0gbGFtYmRhajsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGFtYmRhW2pdICs9IGRlbHRhbGFtYmRhOwogICAgICAgICAgICBkZWx0YWxhbWJkYVRvdCArPSBkZWx0YWxhbWJkYSA+IDAuMCA/IGRlbHRhbGFtYmRhIDogLWRlbHRhbGFtYmRhOyAvLyBhYnMoZGVsdGFsYW1iZGEpCgogICAgICAgICAgICBjLmFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSk7CiAgICAgICAgICB9IC8vIElmIHRoZSB0b3RhbCBlcnJvciBpcyBzbWFsbCBlbm91Z2ggLSBzdG9wIGl0ZXJhdGUKCgogICAgICAgICAgaWYgKGRlbHRhbGFtYmRhVG90ICogZGVsdGFsYW1iZGFUb3QgPCB0b2xTcXVhcmVkKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0gLy8gQWRkIHJlc3VsdCB0byB2ZWxvY2l0eQoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICAgIGNvbnN0IHYgPSBiLnZlbG9jaXR5OwogICAgICAgICAgY29uc3QgdyA9IGIuYW5ndWxhclZlbG9jaXR5OwogICAgICAgICAgYi52bGFtYmRhLnZtdWwoYi5saW5lYXJGYWN0b3IsIGIudmxhbWJkYSk7CiAgICAgICAgICB2LnZhZGQoYi52bGFtYmRhLCB2KTsKICAgICAgICAgIGIud2xhbWJkYS52bXVsKGIuYW5ndWxhckZhY3RvciwgYi53bGFtYmRhKTsKICAgICAgICAgIHcudmFkZChiLndsYW1iZGEsIHcpOwogICAgICAgIH0gLy8gU2V0IHRoZSBgLm11bHRpcGxpZXJgIHByb3BlcnR5IG9mIGVhY2ggZXF1YXRpb24KCgogICAgICAgIGxldCBsID0gZXF1YXRpb25zLmxlbmd0aDsKICAgICAgICBjb25zdCBpbnZEdCA9IDEgLyBoOwoKICAgICAgICB3aGlsZSAobC0tKSB7CiAgICAgICAgICBlcXVhdGlvbnNbbF0ubXVsdGlwbGllciA9IGxhbWJkYVtsXSAqIGludkR0OwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGl0ZXI7CiAgICB9CgogIH0gLy8gSnVzdCB0ZW1wb3JhcnkgbnVtYmVyIGhvbGRlcnMgdGhhdCB3ZSB3YW50IHRvIHJldXNlIGVhY2ggaXRlcmF0aW9uLgoKICBjb25zdCBHU1NvbHZlcl9zb2x2ZV9sYW1iZGEgPSBbXTsKICBjb25zdCBHU1NvbHZlcl9zb2x2ZV9pbnZDcyA9IFtdOwogIGNvbnN0IEdTU29sdmVyX3NvbHZlX0JzID0gW107CgogIC8qKgogICAqIFNwbGl0cyB0aGUgZXF1YXRpb25zIGludG8gaXNsYW5kcyBhbmQgc29sdmVzIHRoZW0gaW5kZXBlbmRlbnRseS4gQ2FuIGltcHJvdmUgcGVyZm9ybWFuY2UuCiAgICovCiAgY2xhc3MgU3BsaXRTb2x2ZXIgZXh0ZW5kcyBTb2x2ZXIgewogICAgLyoqCiAgICAgKiBUaGUgbnVtYmVyIG9mIHNvbHZlciBpdGVyYXRpb25zIGRldGVybWluZXMgcXVhbGl0eSBvZiB0aGUgY29uc3RyYWludHMgaW4gdGhlIHdvcmxkLiBUaGUgbW9yZSBpdGVyYXRpb25zLCB0aGUgbW9yZSBjb3JyZWN0IHNpbXVsYXRpb24uIE1vcmUgaXRlcmF0aW9ucyBuZWVkIG1vcmUgY29tcHV0YXRpb25zIHRob3VnaC4gSWYgeW91IGhhdmUgYSBsYXJnZSBncmF2aXR5IGZvcmNlIGluIHlvdXIgd29ybGQsIHlvdSB3aWxsIG5lZWQgbW9yZSBpdGVyYXRpb25zLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVuIHRvbGVyYW5jZSBpcyByZWFjaGVkLCB0aGUgc3lzdGVtIGlzIGFzc3VtZWQgdG8gYmUgY29udmVyZ2VkLgogICAgICovCgogICAgLyoqIHN1YnNvbHZlciAqLwogICAgY29uc3RydWN0b3Ioc3Vic29sdmVyKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuaXRlcmF0aW9ucyA9IDEwOwogICAgICB0aGlzLnRvbGVyYW5jZSA9IDFlLTc7CiAgICAgIHRoaXMuc3Vic29sdmVyID0gc3Vic29sdmVyOwogICAgICB0aGlzLm5vZGVzID0gW107CiAgICAgIHRoaXMubm9kZVBvb2wgPSBbXTsgLy8gQ3JlYXRlIG5lZWRlZCBub2RlcywgcmV1c2UgaWYgcG9zc2libGUKCiAgICAgIHdoaWxlICh0aGlzLm5vZGVQb29sLmxlbmd0aCA8IDEyOCkgewogICAgICAgIHRoaXMubm9kZVBvb2wucHVzaCh0aGlzLmNyZWF0ZU5vZGUoKSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogY3JlYXRlTm9kZQogICAgICovCgoKICAgIGNyZWF0ZU5vZGUoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgYm9keTogbnVsbCwKICAgICAgICBjaGlsZHJlbjogW10sCiAgICAgICAgZXFzOiBbXSwKICAgICAgICB2aXNpdGVkOiBmYWxzZQogICAgICB9OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSB0aGUgc3Vic3lzdGVtcwogICAgICogQHJldHVybiBudW1iZXIgb2YgaXRlcmF0aW9ucyBwZXJmb3JtZWQKICAgICAqLwoKCiAgICBzb2x2ZShkdCwgd29ybGQpIHsKICAgICAgY29uc3Qgbm9kZXMgPSBTcGxpdFNvbHZlcl9zb2x2ZV9ub2RlczsKICAgICAgY29uc3Qgbm9kZVBvb2wgPSB0aGlzLm5vZGVQb29sOwogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IGVxdWF0aW9ucyA9IHRoaXMuZXF1YXRpb25zOwogICAgICBjb25zdCBOZXEgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICBjb25zdCBOYm9kaWVzID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3Qgc3Vic29sdmVyID0gdGhpcy5zdWJzb2x2ZXI7IC8vIENyZWF0ZSBuZWVkZWQgbm9kZXMsIHJldXNlIGlmIHBvc3NpYmxlCgogICAgICB3aGlsZSAobm9kZVBvb2wubGVuZ3RoIDwgTmJvZGllcykgewogICAgICAgIG5vZGVQb29sLnB1c2godGhpcy5jcmVhdGVOb2RlKCkpOwogICAgICB9CgogICAgICBub2Rlcy5sZW5ndGggPSBOYm9kaWVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBOYm9kaWVzOyBpKyspIHsKICAgICAgICBub2Rlc1tpXSA9IG5vZGVQb29sW2ldOwogICAgICB9IC8vIFJlc2V0IG5vZGUgdmFsdWVzCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgIGNvbnN0IG5vZGUgPSBub2Rlc1tpXTsKICAgICAgICBub2RlLmJvZHkgPSBib2RpZXNbaV07CiAgICAgICAgbm9kZS5jaGlsZHJlbi5sZW5ndGggPSAwOwogICAgICAgIG5vZGUuZXFzLmxlbmd0aCA9IDA7CiAgICAgICAgbm9kZS52aXNpdGVkID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBOZXE7IGsrKykgewogICAgICAgIGNvbnN0IGVxID0gZXF1YXRpb25zW2tdOwogICAgICAgIGNvbnN0IGkgPSBib2RpZXMuaW5kZXhPZihlcS5iaSk7CiAgICAgICAgY29uc3QgaiA9IGJvZGllcy5pbmRleE9mKGVxLmJqKTsKICAgICAgICBjb25zdCBuaSA9IG5vZGVzW2ldOwogICAgICAgIGNvbnN0IG5qID0gbm9kZXNbal07CiAgICAgICAgbmkuY2hpbGRyZW4ucHVzaChuaik7CiAgICAgICAgbmkuZXFzLnB1c2goZXEpOwogICAgICAgIG5qLmNoaWxkcmVuLnB1c2gobmkpOwogICAgICAgIG5qLmVxcy5wdXNoKGVxKTsKICAgICAgfQoKICAgICAgbGV0IGNoaWxkOwogICAgICBsZXQgbiA9IDA7CiAgICAgIGxldCBlcXMgPSBTcGxpdFNvbHZlcl9zb2x2ZV9lcXM7CiAgICAgIHN1YnNvbHZlci50b2xlcmFuY2UgPSB0aGlzLnRvbGVyYW5jZTsKICAgICAgc3Vic29sdmVyLml0ZXJhdGlvbnMgPSB0aGlzLml0ZXJhdGlvbnM7CiAgICAgIGNvbnN0IGR1bW15V29ybGQgPSBTcGxpdFNvbHZlcl9zb2x2ZV9kdW1teVdvcmxkOwoKICAgICAgd2hpbGUgKGNoaWxkID0gZ2V0VW52aXNpdGVkTm9kZShub2RlcykpIHsKICAgICAgICBlcXMubGVuZ3RoID0gMDsKICAgICAgICBkdW1teVdvcmxkLmJvZGllcy5sZW5ndGggPSAwOwogICAgICAgIGJmcyhjaGlsZCwgdmlzaXRGdW5jLCBkdW1teVdvcmxkLmJvZGllcywgZXFzKTsKICAgICAgICBjb25zdCBOZXFzID0gZXFzLmxlbmd0aDsKICAgICAgICBlcXMgPSBlcXMuc29ydChzb3J0QnlJZCk7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOZXFzOyBpKyspIHsKICAgICAgICAgIHN1YnNvbHZlci5hZGRFcXVhdGlvbihlcXNbaV0pOwogICAgICAgIH0KCiAgICAgICAgc3Vic29sdmVyLnNvbHZlKGR0LCBkdW1teVdvcmxkKTsKICAgICAgICBzdWJzb2x2ZXIucmVtb3ZlQWxsRXF1YXRpb25zKCk7CiAgICAgICAgbisrOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KCiAgfSAvLyBSZXR1cm5zIHRoZSBudW1iZXIgb2Ygc3Vic3lzdGVtcwoKICBjb25zdCBTcGxpdFNvbHZlcl9zb2x2ZV9ub2RlcyA9IFtdOyAvLyBBbGwgYWxsb2NhdGVkIG5vZGUgb2JqZWN0cwoKICBjb25zdCBTcGxpdFNvbHZlcl9zb2x2ZV9lcXMgPSBbXTsgLy8gVGVtcCBhcnJheQoKICBjb25zdCBTcGxpdFNvbHZlcl9zb2x2ZV9kdW1teVdvcmxkID0gewogICAgYm9kaWVzOiBbXQogIH07IC8vIFRlbXAgb2JqZWN0CgogIGNvbnN0IFNUQVRJQyA9IEJvZHkuU1RBVElDOwoKICBmdW5jdGlvbiBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSB7CiAgICBjb25zdCBObm9kZXMgPSBub2Rlcy5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ub2RlczsgaSsrKSB7CiAgICAgIGNvbnN0IG5vZGUgPSBub2Rlc1tpXTsKCiAgICAgIGlmICghbm9kZS52aXNpdGVkICYmICEobm9kZS5ib2R5LnR5cGUgJiBTVEFUSUMpKSB7CiAgICAgICAgcmV0dXJuIG5vZGU7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICBjb25zdCBxdWV1ZSA9IFtdOwoKICBmdW5jdGlvbiBiZnMocm9vdCwgdmlzaXRGdW5jLCBiZHMsIGVxcykgewogICAgcXVldWUucHVzaChyb290KTsKICAgIHJvb3QudmlzaXRlZCA9IHRydWU7CiAgICB2aXNpdEZ1bmMocm9vdCwgYmRzLCBlcXMpOwoKICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgY29uc3Qgbm9kZSA9IHF1ZXVlLnBvcCgpOyAvLyBMb29wIG92ZXIgdW52aXNpdGVkIGNoaWxkIG5vZGVzCgogICAgICBsZXQgY2hpbGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGUuY2hpbGRyZW4pKSB7CiAgICAgICAgY2hpbGQudmlzaXRlZCA9IHRydWU7CiAgICAgICAgdmlzaXRGdW5jKGNoaWxkLCBiZHMsIGVxcyk7CiAgICAgICAgcXVldWUucHVzaChjaGlsZCk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHZpc2l0RnVuYyhub2RlLCBiZHMsIGVxcykgewogICAgYmRzLnB1c2gobm9kZS5ib2R5KTsKICAgIGNvbnN0IE5lcXMgPSBub2RlLmVxcy5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICBjb25zdCBlcSA9IG5vZGUuZXFzW2ldOwoKICAgICAgaWYgKCFlcXMuaW5jbHVkZXMoZXEpKSB7CiAgICAgICAgZXFzLnB1c2goZXEpOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzb3J0QnlJZChhLCBiKSB7CiAgICByZXR1cm4gYi5pZCAtIGEuaWQ7CiAgfQoKICAvKioKICAgKiBGb3IgcG9vbGluZyBvYmplY3RzIHRoYXQgY2FuIGJlIHJldXNlZC4KICAgKi8KICBjbGFzcyBQb29sIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLm9iamVjdHMgPSBbXTsKICAgICAgdGhpcy50eXBlID0gT2JqZWN0OwogICAgfQoKICAgIC8qKgogICAgICogUmVsZWFzZSBhbiBvYmplY3QgYWZ0ZXIgdXNlCiAgICAgKi8KICAgIHJlbGVhc2UoKSB7CiAgICAgIGNvbnN0IE5hcmdzID0gYXJndW1lbnRzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOYXJnczsgaSsrKSB7CiAgICAgICAgdGhpcy5vYmplY3RzLnB1c2goaSA8IDAgfHwgYXJndW1lbnRzLmxlbmd0aCA8PSBpID8gdW5kZWZpbmVkIDogYXJndW1lbnRzW2ldKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBvYmplY3QKICAgICAqLwoKCiAgICBnZXQoKSB7CiAgICAgIGlmICh0aGlzLm9iamVjdHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0T2JqZWN0KCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRoaXMub2JqZWN0cy5wb3AoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3QgYW4gb2JqZWN0LiBTaG91bGQgYmUgaW1wbGVtZW50ZWQgaW4gZWFjaCBzdWJjbGFzcy4KICAgICAqLwoKCiAgICBjb25zdHJ1Y3RPYmplY3QoKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignY29uc3RydWN0T2JqZWN0KCkgbm90IGltcGxlbWVudGVkIGluIHRoaXMgUG9vbCBzdWJjbGFzcyB5ZXQhJyk7CiAgICB9CiAgICAvKioKICAgICAqIEByZXR1cm4gU2VsZiwgZm9yIGNoYWluaW5nCiAgICAgKi8KCgogICAgcmVzaXplKHNpemUpIHsKICAgICAgY29uc3Qgb2JqZWN0cyA9IHRoaXMub2JqZWN0czsKCiAgICAgIHdoaWxlIChvYmplY3RzLmxlbmd0aCA+IHNpemUpIHsKICAgICAgICBvYmplY3RzLnBvcCgpOwogICAgICB9CgogICAgICB3aGlsZSAob2JqZWN0cy5sZW5ndGggPCBzaXplKSB7CiAgICAgICAgb2JqZWN0cy5wdXNoKHRoaXMuY29uc3RydWN0T2JqZWN0KCkpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgfQoKICAvKioKICAgKiBWZWMzUG9vbAogICAqLwoKICBjbGFzcyBWZWMzUG9vbCBleHRlbmRzIFBvb2wgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7CiAgICAgIHRoaXMudHlwZSA9IFZlYzM7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3QgYSB2ZWN0b3IKICAgICAqLwogICAgY29uc3RydWN0T2JqZWN0KCkgewogICAgICByZXR1cm4gbmV3IFZlYzMoKTsKICAgIH0KCiAgfQoKICAvLyBOYW1pbmcgcnVsZTogYmFzZWQgb2YgdGhlIG9yZGVyIGluIFNIQVBFX1RZUEVTLAogIC8vIHRoZSBmaXJzdCBwYXJ0IG9mIHRoZSBtZXRob2QgaXMgZm9ybWVkIGJ5IHRoZQogIC8vIHNoYXBlIHR5cGUgdGhhdCBjb21lcyBiZWZvcmUsIGluIHRoZSBzZWNvbmQgcGFydAogIC8vIHRoZXJlIGlzIHRoZSBzaGFwZSB0eXBlIHRoYXQgY29tZXMgYWZ0ZXIgaW4gdGhlIFNIQVBFX1RZUEVTIGxpc3QKICBjb25zdCBDT0xMSVNJT05fVFlQRVMgPSB7CiAgICBzcGhlcmVTcGhlcmU6IFNoYXBlLnR5cGVzLlNQSEVSRSwKICAgIHNwaGVyZVBsYW5lOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5QTEFORSwKICAgIGJveEJveDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQk9YLAogICAgc3BoZXJlQm94OiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5CT1gsCiAgICBwbGFuZUJveDogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5CT1gsCiAgICBjb252ZXhDb252ZXg6IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVDb252ZXg6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBwbGFuZUNvbnZleDogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OLAogICAgYm94Q29udmV4OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OLAogICAgc3BoZXJlSGVpZ2h0ZmllbGQ6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgYm94SGVpZ2h0ZmllbGQ6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgY29udmV4SGVpZ2h0ZmllbGQ6IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04gfCBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRCwKICAgIHNwaGVyZVBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLlNQSEVSRSwKICAgIHBsYW5lUGFydGljbGU6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuUEFSVElDTEUsCiAgICBib3hQYXJ0aWNsZTogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuUEFSVElDTEUsCiAgICBjb252ZXhQYXJ0aWNsZTogU2hhcGUudHlwZXMuUEFSVElDTEUgfCBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OLAogICAgY3lsaW5kZXJDeWxpbmRlcjogU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVDeWxpbmRlcjogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBwbGFuZUN5bGluZGVyOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgYm94Q3lsaW5kZXI6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgY29udmV4Q3lsaW5kZXI6IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04gfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIGhlaWdodGZpZWxkQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxEIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBwYXJ0aWNsZUN5bGluZGVyOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgc3BoZXJlVHJpbWVzaDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuVFJJTUVTSCwKICAgIHBsYW5lVHJpbWVzaDogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5UUklNRVNICiAgfTsKCiAgLyoqCiAgICogSGVscGVyIGNsYXNzIGZvciB0aGUgV29ybGQuIEdlbmVyYXRlcyBDb250YWN0RXF1YXRpb25zLgogICAqIEB0b2RvIFNwaGVyZS1Db252ZXhQb2x5aGVkcm9uIGNvbnRhY3RzCiAgICogQHRvZG8gQ29udGFjdCByZWR1Y3Rpb24KICAgKiBAdG9kbyBzaG91bGQgbW92ZSBtZXRob2RzIHRvIHByb3RvdHlwZQogICAqLwogIGNsYXNzIE5hcnJvd3BoYXNlIHsKICAgIC8qKgogICAgICogSW50ZXJuYWwgc3RvcmFnZSBvZiBwb29sZWQgY29udGFjdCBwb2ludHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBvb2xlZCB2ZWN0b3JzLgogICAgICovCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVTcGhlcmVdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVTcGhlcmU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlUGxhbmVdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVQbGFuZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5ib3hCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQm94XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQm94OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQm94XSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4Q29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUNvbnZleF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZUNvbnZleDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5wbGFuZUNvbnZleF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveENvbnZleF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveENvbnZleDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVIZWlnaHRmaWVsZF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZUhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEhlaWdodGZpZWxkXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4SGVpZ2h0ZmllbGRdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lUGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZVBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveFBhcnRpY2xlXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94UGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4UGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jeWxpbmRlckN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUNvbnZleDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5ib3hDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveENvbnZleDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5oZWlnaHRmaWVsZEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuaGVpZ2h0ZmllbGRDeWxpbmRlcjsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5wYXJ0aWNsZUN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGFydGljbGVDeWxpbmRlcjsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVUcmltZXNoXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlVHJpbWVzaDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5wbGFuZVRyaW1lc2hdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZVRyaW1lc2g7CiAgICB9IC8vIGdldCBbQ09MTElTSU9OX1RZUEVTLmNvbnZleFRyaW1lc2hdKCkgewogICAgLy8gICByZXR1cm4gdGhpcy5jb252ZXhUcmltZXNoCiAgICAvLyB9CgoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHRoaXMuY29udGFjdFBvaW50UG9vbCA9IFtdOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sID0gW107CiAgICAgIHRoaXMucmVzdWx0ID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25SZXN1bHQgPSBbXTsKICAgICAgdGhpcy52M3Bvb2wgPSBuZXcgVmVjM1Bvb2woKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWwgPSB3b3JsZC5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICB0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgYSBjb250YWN0IG9iamVjdCwgYnkgdXNpbmcgdGhlIGludGVybmFsIHBvb2wgb3IgY3JlYXRpbmcgYSBuZXcgb25lLgogICAgICovCgoKICAgIGNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgb3ZlcnJpZGVTaGFwZUEsIG92ZXJyaWRlU2hhcGVCKSB7CiAgICAgIGxldCBjOwoKICAgICAgaWYgKHRoaXMuY29udGFjdFBvaW50UG9vbC5sZW5ndGgpIHsKICAgICAgICBjID0gdGhpcy5jb250YWN0UG9pbnRQb29sLnBvcCgpOwogICAgICAgIGMuYmkgPSBiaTsKICAgICAgICBjLmJqID0gYmo7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYyA9IG5ldyBDb250YWN0RXF1YXRpb24oYmksIGJqKTsKICAgICAgfQoKICAgICAgYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNvbnN0IGNtID0gdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsOwogICAgICBjLnJlc3RpdHV0aW9uID0gY20ucmVzdGl0dXRpb247CiAgICAgIGMuc2V0U3Bvb2tQYXJhbXMoY20uY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzLCBjbS5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uLCB0aGlzLndvcmxkLmR0KTsKICAgICAgY29uc3QgbWF0QSA9IHNpLm1hdGVyaWFsIHx8IGJpLm1hdGVyaWFsOwogICAgICBjb25zdCBtYXRCID0gc2oubWF0ZXJpYWwgfHwgYmoubWF0ZXJpYWw7CgogICAgICBpZiAobWF0QSAmJiBtYXRCICYmIG1hdEEucmVzdGl0dXRpb24gPj0gMCAmJiBtYXRCLnJlc3RpdHV0aW9uID49IDApIHsKICAgICAgICBjLnJlc3RpdHV0aW9uID0gbWF0QS5yZXN0aXR1dGlvbiAqIG1hdEIucmVzdGl0dXRpb247CiAgICAgIH0KCiAgICAgIGMuc2kgPSBvdmVycmlkZVNoYXBlQSB8fCBzaTsKICAgICAgYy5zaiA9IG92ZXJyaWRlU2hhcGVCIHx8IHNqOwogICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBjcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KGNvbnRhY3RFcXVhdGlvbiwgb3V0QXJyYXkpIHsKICAgICAgY29uc3QgYm9keUEgPSBjb250YWN0RXF1YXRpb24uYmk7CiAgICAgIGNvbnN0IGJvZHlCID0gY29udGFjdEVxdWF0aW9uLmJqOwogICAgICBjb25zdCBzaGFwZUEgPSBjb250YWN0RXF1YXRpb24uc2k7CiAgICAgIGNvbnN0IHNoYXBlQiA9IGNvbnRhY3RFcXVhdGlvbi5zajsKICAgICAgY29uc3Qgd29ybGQgPSB0aGlzLndvcmxkOwogICAgICBjb25zdCBjbSA9IHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbDsgLy8gSWYgZnJpY3Rpb24gb3IgcmVzdGl0dXRpb24gd2VyZSBzcGVjaWZpZWQgaW4gdGhlIG1hdGVyaWFsLCB1c2UgdGhlbQoKICAgICAgbGV0IGZyaWN0aW9uID0gY20uZnJpY3Rpb247CiAgICAgIGNvbnN0IG1hdEEgPSBzaGFwZUEubWF0ZXJpYWwgfHwgYm9keUEubWF0ZXJpYWw7CiAgICAgIGNvbnN0IG1hdEIgPSBzaGFwZUIubWF0ZXJpYWwgfHwgYm9keUIubWF0ZXJpYWw7CgogICAgICBpZiAobWF0QSAmJiBtYXRCICYmIG1hdEEuZnJpY3Rpb24gPj0gMCAmJiBtYXRCLmZyaWN0aW9uID49IDApIHsKICAgICAgICBmcmljdGlvbiA9IG1hdEEuZnJpY3Rpb24gKiBtYXRCLmZyaWN0aW9uOwogICAgICB9CgogICAgICBpZiAoZnJpY3Rpb24gPiAwKSB7CiAgICAgICAgLy8gQ3JlYXRlIDIgdGFuZ2VudCBlcXVhdGlvbnMKICAgICAgICAvLyBVc2VycyBtYXkgcHJvdmlkZSBhIGZvcmNlIGRpZmZlcmVudCBmcm9tIGdsb2JhbCBncmF2aXR5IHRvIHVzZSB3aGVuIGNvbXB1dGluZyBjb250YWN0IGZyaWN0aW9uLgogICAgICAgIGNvbnN0IG11ZyA9IGZyaWN0aW9uICogKHdvcmxkLmZyaWN0aW9uR3Jhdml0eSB8fCB3b3JsZC5ncmF2aXR5KS5sZW5ndGgoKTsKICAgICAgICBsZXQgcmVkdWNlZE1hc3MgPSBib2R5QS5pbnZNYXNzICsgYm9keUIuaW52TWFzczsKCiAgICAgICAgaWYgKHJlZHVjZWRNYXNzID4gMCkgewogICAgICAgICAgcmVkdWNlZE1hc3MgPSAxIC8gcmVkdWNlZE1hc3M7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBwb29sID0gdGhpcy5mcmljdGlvbkVxdWF0aW9uUG9vbDsKICAgICAgICBjb25zdCBjMSA9IHBvb2wubGVuZ3RoID8gcG9vbC5wb3AoKSA6IG5ldyBGcmljdGlvbkVxdWF0aW9uKGJvZHlBLCBib2R5QiwgbXVnICogcmVkdWNlZE1hc3MpOwogICAgICAgIGNvbnN0IGMyID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYm9keUEsIGJvZHlCLCBtdWcgKiByZWR1Y2VkTWFzcyk7CiAgICAgICAgYzEuYmkgPSBjMi5iaSA9IGJvZHlBOwogICAgICAgIGMxLmJqID0gYzIuYmogPSBib2R5QjsKICAgICAgICBjMS5taW5Gb3JjZSA9IGMyLm1pbkZvcmNlID0gLW11ZyAqIHJlZHVjZWRNYXNzOwogICAgICAgIGMxLm1heEZvcmNlID0gYzIubWF4Rm9yY2UgPSBtdWcgKiByZWR1Y2VkTWFzczsgLy8gQ29weSBvdmVyIHRoZSByZWxhdGl2ZSB2ZWN0b3JzCgogICAgICAgIGMxLnJpLmNvcHkoY29udGFjdEVxdWF0aW9uLnJpKTsKICAgICAgICBjMS5yai5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaik7CiAgICAgICAgYzIucmkuY29weShjb250YWN0RXF1YXRpb24ucmkpOwogICAgICAgIGMyLnJqLmNvcHkoY29udGFjdEVxdWF0aW9uLnJqKTsgLy8gQ29uc3RydWN0IHRhbmdlbnRzCgogICAgICAgIGNvbnRhY3RFcXVhdGlvbi5uaS50YW5nZW50cyhjMS50LCBjMi50KTsgLy8gU2V0IHNwb29rIHBhcmFtcwoKICAgICAgICBjMS5zZXRTcG9va1BhcmFtcyhjbS5mcmljdGlvbkVxdWF0aW9uU3RpZmZuZXNzLCBjbS5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiwgd29ybGQuZHQpOwogICAgICAgIGMyLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCB3b3JsZC5kdCk7CiAgICAgICAgYzEuZW5hYmxlZCA9IGMyLmVuYWJsZWQgPSBjb250YWN0RXF1YXRpb24uZW5hYmxlZDsKICAgICAgICBvdXRBcnJheS5wdXNoKGMxLCBjMik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogVGFrZSB0aGUgYXZlcmFnZSBOIGxhdGVzdCBjb250YWN0IHBvaW50IG9uIHRoZSBwbGFuZS4KICAgICAqLwoKCiAgICBjcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKSB7CiAgICAgIC8vIFRoZSBsYXN0IGNvbnRhY3RFcXVhdGlvbgogICAgICBsZXQgYyA9IHRoaXMucmVzdWx0W3RoaXMucmVzdWx0Lmxlbmd0aCAtIDFdOyAvLyBDcmVhdGUgdGhlIHJlc3VsdDogdHdvICJhdmVyYWdlIiBmcmljdGlvbiBlcXVhdGlvbnMKCiAgICAgIGlmICghdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KGMsIHRoaXMuZnJpY3Rpb25SZXN1bHQpIHx8IG51bUNvbnRhY3RzID09PSAxKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBmMSA9IHRoaXMuZnJpY3Rpb25SZXN1bHRbdGhpcy5mcmljdGlvblJlc3VsdC5sZW5ndGggLSAyXTsKICAgICAgY29uc3QgZjIgPSB0aGlzLmZyaWN0aW9uUmVzdWx0W3RoaXMuZnJpY3Rpb25SZXN1bHQubGVuZ3RoIC0gMV07CiAgICAgIGF2ZXJhZ2VOb3JtYWwuc2V0WmVybygpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS5zZXRaZXJvKCk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRCLnNldFplcm8oKTsKICAgICAgY29uc3QgYm9keUEgPSBjLmJpOwogICAgICBjLmJqOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG51bUNvbnRhY3RzOyBpKyspIHsKICAgICAgICBjID0gdGhpcy5yZXN1bHRbdGhpcy5yZXN1bHQubGVuZ3RoIC0gMSAtIGldOwoKICAgICAgICBpZiAoYy5iaSAhPT0gYm9keUEpIHsKICAgICAgICAgIGF2ZXJhZ2VOb3JtYWwudmFkZChjLm5pLCBhdmVyYWdlTm9ybWFsKTsKICAgICAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnZhZGQoYy5yaSwgYXZlcmFnZUNvbnRhY3RQb2ludEEpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEIudmFkZChjLnJqLCBhdmVyYWdlQ29udGFjdFBvaW50Qik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGF2ZXJhZ2VOb3JtYWwudnN1YihjLm5pLCBhdmVyYWdlTm9ybWFsKTsKICAgICAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnZhZGQoYy5yaiwgYXZlcmFnZUNvbnRhY3RQb2ludEEpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEIudmFkZChjLnJpLCBhdmVyYWdlQ29udGFjdFBvaW50Qik7CiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zdCBpbnZOdW1Db250YWN0cyA9IDEgLyBudW1Db250YWN0czsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEuc2NhbGUoaW52TnVtQ29udGFjdHMsIGYxLnJpKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEIuc2NhbGUoaW52TnVtQ29udGFjdHMsIGYxLnJqKTsKICAgICAgZjIucmkuY29weShmMS5yaSk7IC8vIFNob3VsZCBiZSB0aGUgc2FtZQoKICAgICAgZjIucmouY29weShmMS5yaik7CiAgICAgIGF2ZXJhZ2VOb3JtYWwubm9ybWFsaXplKCk7CiAgICAgIGF2ZXJhZ2VOb3JtYWwudGFuZ2VudHMoZjEudCwgZjIudCk7IC8vIHJldHVybiBlcTsKICAgIH0KICAgIC8qKgogICAgICogR2VuZXJhdGUgYWxsIGNvbnRhY3RzIGJldHdlZW4gYSBsaXN0IG9mIGJvZHkgcGFpcnMKICAgICAqIEBwYXJhbSBwMSBBcnJheSBvZiBib2R5IGluZGljZXMKICAgICAqIEBwYXJhbSBwMiBBcnJheSBvZiBib2R5IGluZGljZXMKICAgICAqIEBwYXJhbSByZXN1bHQgQXJyYXkgdG8gc3RvcmUgZ2VuZXJhdGVkIGNvbnRhY3RzCiAgICAgKiBAcGFyYW0gb2xkY29udGFjdHMgT3B0aW9uYWwuIEFycmF5IG9mIHJldXNhYmxlIGNvbnRhY3Qgb2JqZWN0cwogICAgICovCgoKICAgIGdldENvbnRhY3RzKHAxLCBwMiwgd29ybGQsIHJlc3VsdCwgb2xkY29udGFjdHMsIGZyaWN0aW9uUmVzdWx0LCBmcmljdGlvblBvb2wpIHsKICAgICAgLy8gU2F2ZSBvbGQgY29udGFjdCBvYmplY3RzCiAgICAgIHRoaXMuY29udGFjdFBvaW50UG9vbCA9IG9sZGNvbnRhY3RzOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sID0gZnJpY3Rpb25Qb29sOwogICAgICB0aGlzLnJlc3VsdCA9IHJlc3VsdDsKICAgICAgdGhpcy5mcmljdGlvblJlc3VsdCA9IGZyaWN0aW9uUmVzdWx0OwogICAgICBjb25zdCBxaSA9IHRtcFF1YXQxOwogICAgICBjb25zdCBxaiA9IHRtcFF1YXQyOwogICAgICBjb25zdCB4aSA9IHRtcFZlYzE7CiAgICAgIGNvbnN0IHhqID0gdG1wVmVjMjsKCiAgICAgIGZvciAobGV0IGsgPSAwLCBOID0gcDEubGVuZ3RoOyBrICE9PSBOOyBrKyspIHsKICAgICAgICAvLyBHZXQgY3VycmVudCBjb2xsaXNpb24gYm9kaWVzCiAgICAgICAgY29uc3QgYmkgPSBwMVtrXTsKICAgICAgICBjb25zdCBiaiA9IHAyW2tdOyAvLyBHZXQgY29udGFjdCBtYXRlcmlhbAoKICAgICAgICBsZXQgYm9keUNvbnRhY3RNYXRlcmlhbCA9IG51bGw7CgogICAgICAgIGlmIChiaS5tYXRlcmlhbCAmJiBiai5tYXRlcmlhbCkgewogICAgICAgICAgYm9keUNvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmdldENvbnRhY3RNYXRlcmlhbChiaS5tYXRlcmlhbCwgYmoubWF0ZXJpYWwpIHx8IG51bGw7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBqdXN0VGVzdCA9IGJpLnR5cGUgJiBCb2R5LktJTkVNQVRJQyAmJiBiai50eXBlICYgQm9keS5TVEFUSUMgfHwgYmkudHlwZSAmIEJvZHkuU1RBVElDICYmIGJqLnR5cGUgJiBCb2R5LktJTkVNQVRJQyB8fCBiaS50eXBlICYgQm9keS5LSU5FTUFUSUMgJiYgYmoudHlwZSAmIEJvZHkuS0lORU1BVElDOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJpLnNoYXBlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgYmkucXVhdGVybmlvbi5tdWx0KGJpLnNoYXBlT3JpZW50YXRpb25zW2ldLCBxaSk7CiAgICAgICAgICBiaS5xdWF0ZXJuaW9uLnZtdWx0KGJpLnNoYXBlT2Zmc2V0c1tpXSwgeGkpOwogICAgICAgICAgeGkudmFkZChiaS5wb3NpdGlvbiwgeGkpOwogICAgICAgICAgY29uc3Qgc2kgPSBiaS5zaGFwZXNbaV07CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBiai5zaGFwZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgLy8gQ29tcHV0ZSB3b3JsZCB0cmFuc2Zvcm0gb2Ygc2hhcGVzCiAgICAgICAgICAgIGJqLnF1YXRlcm5pb24ubXVsdChiai5zaGFwZU9yaWVudGF0aW9uc1tqXSwgcWopOwogICAgICAgICAgICBiai5xdWF0ZXJuaW9uLnZtdWx0KGJqLnNoYXBlT2Zmc2V0c1tqXSwgeGopOwogICAgICAgICAgICB4ai52YWRkKGJqLnBvc2l0aW9uLCB4aik7CiAgICAgICAgICAgIGNvbnN0IHNqID0gYmouc2hhcGVzW2pdOwoKICAgICAgICAgICAgaWYgKCEoc2kuY29sbGlzaW9uRmlsdGVyTWFzayAmIHNqLmNvbGxpc2lvbkZpbHRlckdyb3VwICYmIHNqLmNvbGxpc2lvbkZpbHRlck1hc2sgJiBzaS5jb2xsaXNpb25GaWx0ZXJHcm91cCkpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHhpLmRpc3RhbmNlVG8oeGopID4gc2kuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzai5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9IC8vIEdldCBjb2xsaXNpb24gbWF0ZXJpYWwKCgogICAgICAgICAgICBsZXQgc2hhcGVDb250YWN0TWF0ZXJpYWwgPSBudWxsOwoKICAgICAgICAgICAgaWYgKHNpLm1hdGVyaWFsICYmIHNqLm1hdGVyaWFsKSB7CiAgICAgICAgICAgICAgc2hhcGVDb250YWN0TWF0ZXJpYWwgPSB3b3JsZC5nZXRDb250YWN0TWF0ZXJpYWwoc2kubWF0ZXJpYWwsIHNqLm1hdGVyaWFsKSB8fCBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWwgPSBzaGFwZUNvbnRhY3RNYXRlcmlhbCB8fCBib2R5Q29udGFjdE1hdGVyaWFsIHx8IHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7IC8vIEdldCBjb250YWN0cwoKICAgICAgICAgICAgY29uc3QgcmVzb2x2ZXJJbmRleCA9IHNpLnR5cGUgfCBzai50eXBlOwogICAgICAgICAgICBjb25zdCByZXNvbHZlciA9IHRoaXNbcmVzb2x2ZXJJbmRleF07CgogICAgICAgICAgICBpZiAocmVzb2x2ZXIpIHsKICAgICAgICAgICAgICBsZXQgcmV0dmFsID0gZmFsc2U7IC8vIFRPIERPOiBpbnZlc3RpZ2F0ZSB3aHkgc3BoZXJlUGFydGljbGUgYW5kIGNvbnZleFBhcnRpY2xlCiAgICAgICAgICAgICAgLy8gcmVzb2x2ZXJzIGV4cGVjdCBzaSBhbmQgc2ogc2hhcGVzIHRvIGJlIGluIHJldmVyc2Ugb3JkZXIKICAgICAgICAgICAgICAvLyAoaS5lLiBsYXJnZXIgaW50ZWdlciB2YWx1ZSB0eXBlIGZpcnN0IGluc3RlYWQgb2Ygc21hbGxlciBmaXJzdCkKCiAgICAgICAgICAgICAgaWYgKHNpLnR5cGUgPCBzai50eXBlKSB7CiAgICAgICAgICAgICAgICByZXR2YWwgPSByZXNvbHZlci5jYWxsKHRoaXMsIHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHZhbCA9IHJlc29sdmVyLmNhbGwodGhpcywgc2osIHNpLCB4aiwgeGksIHFqLCBxaSwgYmosIGJpLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChyZXR2YWwgJiYganVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIC8vIFJlZ2lzdGVyIG92ZXJsYXAKICAgICAgICAgICAgICAgIHdvcmxkLnNoYXBlT3ZlcmxhcEtlZXBlci5zZXQoc2kuaWQsIHNqLmlkKTsKICAgICAgICAgICAgICAgIHdvcmxkLmJvZHlPdmVybGFwS2VlcGVyLnNldChiaS5pZCwgYmouaWQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHNwaGVyZVNwaGVyZShzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICByZXR1cm4geGkuZGlzdGFuY2VTcXVhcmVkKHhqKSA8IChzaS5yYWRpdXMgKyBzai5yYWRpdXMpICoqIDI7CiAgICAgIH0gLy8gV2Ugd2lsbCBoYXZlIG9ubHkgb25lIGNvbnRhY3QgaW4gdGhpcyBjYXNlCgoKICAgICAgY29uc3QgY29udGFjdEVxID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsgLy8gQ29udGFjdCBub3JtYWwKCiAgICAgIHhqLnZzdWIoeGksIGNvbnRhY3RFcS5uaSk7CiAgICAgIGNvbnRhY3RFcS5uaS5ub3JtYWxpemUoKTsgLy8gQ29udGFjdCBwb2ludCBsb2NhdGlvbnMKCiAgICAgIGNvbnRhY3RFcS5yaS5jb3B5KGNvbnRhY3RFcS5uaSk7CiAgICAgIGNvbnRhY3RFcS5yai5jb3B5KGNvbnRhY3RFcS5uaSk7CiAgICAgIGNvbnRhY3RFcS5yaS5zY2FsZShzaS5yYWRpdXMsIGNvbnRhY3RFcS5yaSk7CiAgICAgIGNvbnRhY3RFcS5yai5zY2FsZSgtc2oucmFkaXVzLCBjb250YWN0RXEucmopOwogICAgICBjb250YWN0RXEucmkudmFkZCh4aSwgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJpLnZzdWIoYmkucG9zaXRpb24sIGNvbnRhY3RFcS5yaSk7CiAgICAgIGNvbnRhY3RFcS5yai52YWRkKHhqLCBjb250YWN0RXEucmopOwogICAgICBjb250YWN0RXEucmoudnN1Yihiai5wb3NpdGlvbiwgY29udGFjdEVxLnJqKTsKICAgICAgdGhpcy5yZXN1bHQucHVzaChjb250YWN0RXEpOwogICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoY29udGFjdEVxLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgIH0KCiAgICBzcGhlcmVQbGFuZShzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICAvLyBXZSB3aWxsIGhhdmUgb25lIGNvbnRhY3QgaW4gdGhpcyBjYXNlCiAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgci5uaS5zZXQoMCwgMCwgMSk7CiAgICAgIHFqLnZtdWx0KHIubmksIHIubmkpOwogICAgICByLm5pLm5lZ2F0ZShyLm5pKTsgLy8gYm9keSBpIGlzIHRoZSBzcGhlcmUsIGZsaXAgbm9ybWFsCgogICAgICByLm5pLm5vcm1hbGl6ZSgpOyAvLyBOZWVkZWQ/CiAgICAgIC8vIFZlY3RvciBmcm9tIHNwaGVyZSBjZW50ZXIgdG8gY29udGFjdCBwb2ludAoKICAgICAgci5uaS5zY2FsZShzaS5yYWRpdXMsIHIucmkpOyAvLyBQcm9qZWN0IGRvd24gc3BoZXJlIG9uIHBsYW5lCgogICAgICB4aS52c3ViKHhqLCBwb2ludF9vbl9wbGFuZV90b19zcGhlcmUpOwogICAgICByLm5pLnNjYWxlKHIubmkuZG90KHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSksIHBsYW5lX3RvX3NwaGVyZV9vcnRobyk7CiAgICAgIHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZS52c3ViKHBsYW5lX3RvX3NwaGVyZV9vcnRobywgci5yaik7IC8vIFRoZSBzcGhlcmUgcG9zaXRpb24gcHJvamVjdGVkIHRvIHBsYW5lCgogICAgICBpZiAoLXBvaW50X29uX3BsYW5lX3RvX3NwaGVyZS5kb3Qoci5uaSkgPD0gc2kucmFkaXVzKSB7CiAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IC8vIE1ha2UgaXQgcmVsYXRpdmUgdG8gdGhlIGJvZHkKCgogICAgICAgIGNvbnN0IHJpID0gci5yaTsKICAgICAgICBjb25zdCByaiA9IHIucmo7CiAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgIHJpLnZzdWIoYmkucG9zaXRpb24sIHJpKTsKICAgICAgICByai52YWRkKHhqLCByaik7CiAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgYm94Qm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNpLm1hdGVyaWFsOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzai5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNqLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXgoc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHNpLCBzaiwganVzdFRlc3QpOwogICAgfQoKICAgIHNwaGVyZUJveChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCB2M3Bvb2wgPSB0aGlzLnYzcG9vbDsgLy8gd2UgcmVmZXIgdG8gdGhlIGJveCBhcyBib2R5IGoKCiAgICAgIGNvbnN0IHNpZGVzID0gc3BoZXJlQm94X3NpZGVzOwogICAgICB4aS52c3ViKHhqLCBib3hfdG9fc3BoZXJlKTsKICAgICAgc2ouZ2V0U2lkZU5vcm1hbHMoc2lkZXMsIHFqKTsKICAgICAgY29uc3QgUiA9IHNpLnJhZGl1czsKCiAgICAgIGxldCBmb3VuZCA9IGZhbHNlOyAvLyBTdG9yZSB0aGUgcmVzdWx0aW5nIHNpZGUgcGVuZXRyYXRpb24gaW5mbwoKICAgICAgY29uc3Qgc2lkZV9ucyA9IHNwaGVyZUJveF9zaWRlX25zOwogICAgICBjb25zdCBzaWRlX25zMSA9IHNwaGVyZUJveF9zaWRlX25zMTsKICAgICAgY29uc3Qgc2lkZV9uczIgPSBzcGhlcmVCb3hfc2lkZV9uczI7CiAgICAgIGxldCBzaWRlX2ggPSBudWxsOwogICAgICBsZXQgc2lkZV9wZW5ldHJhdGlvbnMgPSAwOwogICAgICBsZXQgc2lkZV9kb3QxID0gMDsKICAgICAgbGV0IHNpZGVfZG90MiA9IDA7CiAgICAgIGxldCBzaWRlX2Rpc3RhbmNlID0gbnVsbDsKCiAgICAgIGZvciAobGV0IGlkeCA9IDAsIG5zaWRlcyA9IHNpZGVzLmxlbmd0aDsgaWR4ICE9PSBuc2lkZXMgJiYgZm91bmQgPT09IGZhbHNlOyBpZHgrKykgewogICAgICAgIC8vIEdldCB0aGUgcGxhbmUgc2lkZSBub3JtYWwgKG5zKQogICAgICAgIGNvbnN0IG5zID0gc3BoZXJlQm94X25zOwogICAgICAgIG5zLmNvcHkoc2lkZXNbaWR4XSk7CiAgICAgICAgY29uc3QgaCA9IG5zLmxlbmd0aCgpOwogICAgICAgIG5zLm5vcm1hbGl6ZSgpOyAvLyBUaGUgbm9ybWFsL2Rpc3RhbmNlIGRvdCBwcm9kdWN0IHRlbGxzIHdoaWNoIHNpZGUgb2YgdGhlIHBsYW5lIHdlIGFyZQoKICAgICAgICBjb25zdCBkb3QgPSBib3hfdG9fc3BoZXJlLmRvdChucyk7CgogICAgICAgIGlmIChkb3QgPCBoICsgUiAmJiBkb3QgPiAwKSB7CiAgICAgICAgICAvLyBJbnRlcnNlY3RzIHBsYW5lLiBOb3cgY2hlY2sgdGhlIG90aGVyIHR3byBkaW1lbnNpb25zCiAgICAgICAgICBjb25zdCBuczEgPSBzcGhlcmVCb3hfbnMxOwogICAgICAgICAgY29uc3QgbnMyID0gc3BoZXJlQm94X25zMjsKICAgICAgICAgIG5zMS5jb3B5KHNpZGVzWyhpZHggKyAxKSAlIDNdKTsKICAgICAgICAgIG5zMi5jb3B5KHNpZGVzWyhpZHggKyAyKSAlIDNdKTsKICAgICAgICAgIGNvbnN0IGgxID0gbnMxLmxlbmd0aCgpOwogICAgICAgICAgY29uc3QgaDIgPSBuczIubGVuZ3RoKCk7CiAgICAgICAgICBuczEubm9ybWFsaXplKCk7CiAgICAgICAgICBuczIubm9ybWFsaXplKCk7CiAgICAgICAgICBjb25zdCBkb3QxID0gYm94X3RvX3NwaGVyZS5kb3QobnMxKTsKICAgICAgICAgIGNvbnN0IGRvdDIgPSBib3hfdG9fc3BoZXJlLmRvdChuczIpOwoKICAgICAgICAgIGlmIChkb3QxIDwgaDEgJiYgZG90MSA+IC1oMSAmJiBkb3QyIDwgaDIgJiYgZG90MiA+IC1oMikgewogICAgICAgICAgICBjb25zdCBkaXN0ID0gTWF0aC5hYnMoZG90IC0gaCAtIFIpOwoKICAgICAgICAgICAgaWYgKHNpZGVfZGlzdGFuY2UgPT09IG51bGwgfHwgZGlzdCA8IHNpZGVfZGlzdGFuY2UpIHsKICAgICAgICAgICAgICBzaWRlX2Rpc3RhbmNlID0gZGlzdDsKICAgICAgICAgICAgICBzaWRlX2RvdDEgPSBkb3QxOwogICAgICAgICAgICAgIHNpZGVfZG90MiA9IGRvdDI7CiAgICAgICAgICAgICAgc2lkZV9oID0gaDsKICAgICAgICAgICAgICBzaWRlX25zLmNvcHkobnMpOwogICAgICAgICAgICAgIHNpZGVfbnMxLmNvcHkobnMxKTsKICAgICAgICAgICAgICBzaWRlX25zMi5jb3B5KG5zMik7CiAgICAgICAgICAgICAgc2lkZV9wZW5ldHJhdGlvbnMrKzsKCiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChzaWRlX3BlbmV0cmF0aW9ucykgewogICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICBzaWRlX25zLnNjYWxlKC1SLCByLnJpKTsgLy8gU3BoZXJlIHIKCiAgICAgICAgci5uaS5jb3B5KHNpZGVfbnMpOwogICAgICAgIHIubmkubmVnYXRlKHIubmkpOyAvLyBOb3JtYWwgc2hvdWxkIGJlIG91dCBvZiBzcGhlcmUKCiAgICAgICAgc2lkZV9ucy5zY2FsZShzaWRlX2gsIHNpZGVfbnMpOwogICAgICAgIHNpZGVfbnMxLnNjYWxlKHNpZGVfZG90MSwgc2lkZV9uczEpOwogICAgICAgIHNpZGVfbnMudmFkZChzaWRlX25zMSwgc2lkZV9ucyk7CiAgICAgICAgc2lkZV9uczIuc2NhbGUoc2lkZV9kb3QyLCBzaWRlX25zMik7CiAgICAgICAgc2lkZV9ucy52YWRkKHNpZGVfbnMyLCByLnJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgfSAvLyBDaGVjayBjb3JuZXJzCgoKICAgICAgbGV0IHJqID0gdjNwb29sLmdldCgpOwogICAgICBjb25zdCBzcGhlcmVfdG9fY29ybmVyID0gc3BoZXJlQm94X3NwaGVyZV90b19jb3JuZXI7CgogICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gMiAmJiAhZm91bmQ7IGorKykgewogICAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSAyICYmICFmb3VuZDsgaysrKSB7CiAgICAgICAgICBmb3IgKGxldCBsID0gMDsgbCAhPT0gMiAmJiAhZm91bmQ7IGwrKykgewogICAgICAgICAgICByai5zZXQoMCwgMCwgMCk7CgogICAgICAgICAgICBpZiAoaikgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMF0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzBdLCByaik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChrKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1sxXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMV0sIHJqKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGwpIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzJdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1syXSwgcmopOwogICAgICAgICAgICB9IC8vIFdvcmxkIHBvc2l0aW9uIG9mIGNvcm5lcgoKCiAgICAgICAgICAgIHhqLnZhZGQocmosIHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgICBzcGhlcmVfdG9fY29ybmVyLnZzdWIoeGksIHNwaGVyZV90b19jb3JuZXIpOwoKICAgICAgICAgICAgaWYgKHNwaGVyZV90b19jb3JuZXIubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgIHIucmkuY29weShzcGhlcmVfdG9fY29ybmVyKTsKICAgICAgICAgICAgICByLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuY29weShyLnJpKTsKICAgICAgICAgICAgICByLnJpLnNjYWxlKFIsIHIucmkpOwogICAgICAgICAgICAgIHIucmouY29weShyaik7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgICAgci5yaS52c3ViKGJpLnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHYzcG9vbC5yZWxlYXNlKHJqKTsKICAgICAgcmogPSBudWxsOyAvLyBDaGVjayBlZGdlcwoKICAgICAgY29uc3QgZWRnZVRhbmdlbnQgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IGVkZ2VDZW50ZXIgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IHIgPSB2M3Bvb2wuZ2V0KCk7IC8vIHIgPSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyCgogICAgICBjb25zdCBvcnRob2dvbmFsID0gdjNwb29sLmdldCgpOwogICAgICBjb25zdCBkaXN0ID0gdjNwb29sLmdldCgpOwogICAgICBjb25zdCBOc2lkZXMgPSBzaWRlcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gTnNpZGVzICYmICFmb3VuZDsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IE5zaWRlcyAmJiAhZm91bmQ7IGsrKykgewogICAgICAgICAgaWYgKGogJSAzICE9PSBrICUgMykgewogICAgICAgICAgICAvLyBHZXQgZWRnZSB0YW5nZW50CiAgICAgICAgICAgIHNpZGVzW2tdLmNyb3NzKHNpZGVzW2pdLCBlZGdlVGFuZ2VudCk7CiAgICAgICAgICAgIGVkZ2VUYW5nZW50Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBzaWRlc1tqXS52YWRkKHNpZGVzW2tdLCBlZGdlQ2VudGVyKTsKICAgICAgICAgICAgci5jb3B5KHhpKTsKICAgICAgICAgICAgci52c3ViKGVkZ2VDZW50ZXIsIHIpOwogICAgICAgICAgICByLnZzdWIoeGosIHIpOwogICAgICAgICAgICBjb25zdCBvcnRob25vcm0gPSByLmRvdChlZGdlVGFuZ2VudCk7IC8vIGRpc3RhbmNlIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlciBpbiB0aGUgdGFuZ2VudCBkaXJlY3Rpb24KCiAgICAgICAgICAgIGVkZ2VUYW5nZW50LnNjYWxlKG9ydGhvbm9ybSwgb3J0aG9nb25hbCk7IC8vIFZlY3RvciBmcm9tIGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIgaW4gdGhlIHRhbmdlbnQgZGlyZWN0aW9uCiAgICAgICAgICAgIC8vIEZpbmQgdGhlIHRoaXJkIHNpZGUgb3J0aG9nb25hbCB0byB0aGlzIG9uZQoKICAgICAgICAgICAgbGV0IGwgPSAwOwoKICAgICAgICAgICAgd2hpbGUgKGwgPT09IGogJSAzIHx8IGwgPT09IGsgJSAzKSB7CiAgICAgICAgICAgICAgbCsrOwogICAgICAgICAgICB9IC8vIHZlYyBmcm9tIGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBwcm9qZWN0ZWQgdG8gdGhlIHBsYW5lIG9ydGhvZ29uYWwgdG8gdGhlIGVkZ2UgdGFuZ2VudAoKCiAgICAgICAgICAgIGRpc3QuY29weSh4aSk7CiAgICAgICAgICAgIGRpc3QudnN1YihvcnRob2dvbmFsLCBkaXN0KTsKICAgICAgICAgICAgZGlzdC52c3ViKGVkZ2VDZW50ZXIsIGRpc3QpOwogICAgICAgICAgICBkaXN0LnZzdWIoeGosIGRpc3QpOyAvLyBEaXN0YW5jZXMgaW4gdGFuZ2VudCBkaXJlY3Rpb24gYW5kIGRpc3RhbmNlIGluIHRoZSBwbGFuZSBvcnRob2dvbmFsIHRvIGl0CgogICAgICAgICAgICBjb25zdCB0ZGlzdCA9IE1hdGguYWJzKG9ydGhvbm9ybSk7CiAgICAgICAgICAgIGNvbnN0IG5kaXN0ID0gZGlzdC5sZW5ndGgoKTsKCiAgICAgICAgICAgIGlmICh0ZGlzdCA8IHNpZGVzW2xdLmxlbmd0aCgpICYmIG5kaXN0IDwgUikgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgY29uc3QgcmVzID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICBlZGdlQ2VudGVyLnZhZGQob3J0aG9nb25hbCwgcmVzLnJqKTsgLy8gYm94IHJqCgogICAgICAgICAgICAgIHJlcy5yai5jb3B5KHJlcy5yaik7CiAgICAgICAgICAgICAgZGlzdC5uZWdhdGUocmVzLm5pKTsKICAgICAgICAgICAgICByZXMubmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgcmVzLnJpLmNvcHkocmVzLnJqKTsKICAgICAgICAgICAgICByZXMucmkudmFkZCh4aiwgcmVzLnJpKTsKICAgICAgICAgICAgICByZXMucmkudnN1Yih4aSwgcmVzLnJpKTsKICAgICAgICAgICAgICByZXMucmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgcmVzLnJpLnNjYWxlKFIsIHJlcy5yaSk7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgICAgIHJlcy5yaS52YWRkKHhpLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS52c3ViKGJpLnBvc2l0aW9uLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yai52YWRkKHhqLCByZXMucmopOwogICAgICAgICAgICAgIHJlcy5yai52c3ViKGJqLnBvc2l0aW9uLCByZXMucmopOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocmVzKTsKICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QocmVzLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdjNwb29sLnJlbGVhc2UoZWRnZVRhbmdlbnQsIGVkZ2VDZW50ZXIsIHIsIG9ydGhvZ29uYWwsIGRpc3QpOwogICAgfQoKICAgIHBsYW5lQm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNqLm1hdGVyaWFsOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmlkID0gc2ouaWQ7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4KHNpLCBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHNpLCBzaiwganVzdFRlc3QpOwogICAgfQoKICAgIGNvbnZleENvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCwgZmFjZUxpc3RBLCBmYWNlTGlzdEIpIHsKICAgICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwoKICAgICAgaWYgKHhpLmRpc3RhbmNlVG8oeGopID4gc2kuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzai5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHNpLmZpbmRTZXBhcmF0aW5nQXhpcyhzaiwgeGksIHFpLCB4aiwgcWosIHNlcEF4aXMsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSkgewogICAgICAgIGNvbnN0IHJlcyA9IFtdOwogICAgICAgIGNvbnN0IHEgPSBjb252ZXhDb252ZXhfcTsKICAgICAgICBzaS5jbGlwQWdhaW5zdEh1bGwoeGksIHFpLCBzaiwgeGosIHFqLCBzZXBBeGlzLCAtMTAwLCAxMDAsIHJlcyk7CiAgICAgICAgbGV0IG51bUNvbnRhY3RzID0gMDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IHJlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgICAgY29uc3QgcmogPSByLnJqOwogICAgICAgICAgc2VwQXhpcy5uZWdhdGUoci5uaSk7CiAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgICAgICAgIHEuc2NhbGUocmVzW2pdLmRlcHRoLCBxKTsKICAgICAgICAgIHJlc1tqXS5wb2ludC52YWRkKHEsIHJpKTsKICAgICAgICAgIHJqLmNvcHkocmVzW2pdLnBvaW50KTsgLy8gQ29udGFjdCBwb2ludHMgYXJlIGluIHdvcmxkIGNvb3JkaW5hdGVzLiBUcmFuc2Zvcm0gYmFjayB0byByZWxhdGl2ZQoKICAgICAgICAgIHJpLnZzdWIoeGksIHJpKTsKICAgICAgICAgIHJqLnZzdWIoeGosIHJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAgICAgICByai52YWRkKHhqLCByaik7CiAgICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgbnVtQ29udGFjdHMrKzsKCiAgICAgICAgICBpZiAoIXRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24pIHsKICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gJiYgbnVtQ29udGFjdHMpIHsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25Gcm9tQXZlcmFnZShudW1Db250YWN0cyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlQ29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IHYzcG9vbCA9IHRoaXMudjNwb29sOwogICAgICB4aS52c3ViKHhqLCBjb252ZXhfdG9fc3BoZXJlKTsKICAgICAgY29uc3Qgbm9ybWFscyA9IHNqLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBmYWNlcyA9IHNqLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0cyA9IHNqLnZlcnRpY2VzOwogICAgICBjb25zdCBSID0gc2kucmFkaXVzOwogICAgICAvLyAgICAgcmV0dXJuOwogICAgICAvLyB9CgogICAgICBsZXQgZm91bmQgPSBmYWxzZTsgLy8gQ2hlY2sgY29ybmVycwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IHZlcnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IHZlcnRzW2ldOyAvLyBXb3JsZCBwb3NpdGlvbiBvZiBjb3JuZXIKCiAgICAgICAgY29uc3Qgd29ybGRDb3JuZXIgPSBzcGhlcmVDb252ZXhfd29ybGRDb3JuZXI7CiAgICAgICAgcWoudm11bHQodiwgd29ybGRDb3JuZXIpOwogICAgICAgIHhqLnZhZGQod29ybGRDb3JuZXIsIHdvcmxkQ29ybmVyKTsKICAgICAgICBjb25zdCBzcGhlcmVfdG9fY29ybmVyID0gc3BoZXJlQ29udmV4X3NwaGVyZVRvQ29ybmVyOwogICAgICAgIHdvcmxkQ29ybmVyLnZzdWIoeGksIHNwaGVyZV90b19jb3JuZXIpOwoKICAgICAgICBpZiAoc3BoZXJlX3RvX2Nvcm5lci5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgci5yaS5jb3B5KHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgci5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuY29weShyLnJpKTsKICAgICAgICAgIHIucmkuc2NhbGUoUiwgci5yaSk7CiAgICAgICAgICB3b3JsZENvcm5lci52c3ViKHhqLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfSAvLyBDaGVjayBzaWRlIChwbGFuZSkgaW50ZXJzZWN0aW9ucwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBmYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlcyAmJiBmb3VuZCA9PT0gZmFsc2U7IGkrKykgewogICAgICAgIGNvbnN0IG5vcm1hbCA9IG5vcm1hbHNbaV07CiAgICAgICAgY29uc3QgZmFjZSA9IGZhY2VzW2ldOyAvLyBHZXQgd29ybGQtdHJhbnNmb3JtZWQgbm9ybWFsIG9mIHRoZSBmYWNlCgogICAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gc3BoZXJlQ29udmV4X3dvcmxkTm9ybWFsOwogICAgICAgIHFqLnZtdWx0KG5vcm1hbCwgd29ybGROb3JtYWwpOyAvLyBHZXQgYSB3b3JsZCB2ZXJ0ZXggZnJvbSB0aGUgZmFjZQoKICAgICAgICBjb25zdCB3b3JsZFBvaW50ID0gc3BoZXJlQ29udmV4X3dvcmxkUG9pbnQ7CiAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVswXV0sIHdvcmxkUG9pbnQpOwogICAgICAgIHdvcmxkUG9pbnQudmFkZCh4aiwgd29ybGRQb2ludCk7IC8vIEdldCBhIHBvaW50IG9uIHRoZSBzcGhlcmUsIGNsb3Nlc3QgdG8gdGhlIGZhY2Ugbm9ybWFsCgogICAgICAgIGNvbnN0IHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSA9IHNwaGVyZUNvbnZleF93b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmU7CiAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSk7CiAgICAgICAgeGkudmFkZCh3b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUsIHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSk7IC8vIFZlY3RvciBmcm9tIGEgZmFjZSBwb2ludCB0byB0aGUgY2xvc2VzdCBwb2ludCBvbiB0aGUgc3BoZXJlCgogICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjID0gc3BoZXJlQ29udmV4X3BlbmV0cmF0aW9uVmVjOwogICAgICAgIHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZS52c3ViKHdvcmxkUG9pbnQsIHBlbmV0cmF0aW9uVmVjKTsgLy8gVGhlIHBlbmV0cmF0aW9uLiBOZWdhdGl2ZSB2YWx1ZSBtZWFucyBvdmVybGFwLgoKICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IHBlbmV0cmF0aW9uVmVjLmRvdCh3b3JsZE5vcm1hbCk7CiAgICAgICAgY29uc3Qgd29ybGRQb2ludFRvU3BoZXJlID0gc3BoZXJlQ29udmV4X3NwaGVyZVRvV29ybGRQb2ludDsKICAgICAgICB4aS52c3ViKHdvcmxkUG9pbnQsIHdvcmxkUG9pbnRUb1NwaGVyZSk7CgogICAgICAgIGlmIChwZW5ldHJhdGlvbiA8IDAgJiYgd29ybGRQb2ludFRvU3BoZXJlLmRvdCh3b3JsZE5vcm1hbCkgPiAwKSB7CiAgICAgICAgICAvLyBJbnRlcnNlY3RzIHBsYW5lLiBOb3cgY2hlY2sgaWYgdGhlIHNwaGVyZSBpcyBpbnNpZGUgdGhlIGZhY2UgcG9seWdvbgogICAgICAgICAgY29uc3QgZmFjZVZlcnRzID0gW107IC8vIEZhY2UgdmVydGljZXMsIGluIHdvcmxkIGNvb3JkcwoKICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOdmVydHMgPSBmYWNlLmxlbmd0aDsgaiAhPT0gTnZlcnRzOyBqKyspIHsKICAgICAgICAgICAgY29uc3Qgd29ybGRWZXJ0ZXggPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2Vbal1dLCB3b3JsZFZlcnRleCk7CiAgICAgICAgICAgIHhqLnZhZGQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICAgICAgZmFjZVZlcnRzLnB1c2god29ybGRWZXJ0ZXgpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChwb2ludEluUG9seWdvbihmYWNlVmVydHMsIHdvcmxkTm9ybWFsLCB4aSkpIHsKICAgICAgICAgICAgLy8gSXMgdGhlIHNwaGVyZSBjZW50ZXIgaW4gdGhlIGZhY2UgcG9seWdvbj8KICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgIHdvcmxkTm9ybWFsLnNjYWxlKC1SLCByLnJpKTsgLy8gQ29udGFjdCBvZmZzZXQsIGZyb20gc3BoZXJlIGNlbnRlciB0byBjb250YWN0CgogICAgICAgICAgICB3b3JsZE5vcm1hbC5uZWdhdGUoci5uaSk7IC8vIE5vcm1hbCBwb2ludGluZyBvdXQgb2Ygc3BoZXJlCgogICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvblZlYzIgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgIHdvcmxkTm9ybWFsLnNjYWxlKC1wZW5ldHJhdGlvbiwgcGVuZXRyYXRpb25WZWMyKTsKICAgICAgICAgICAgY29uc3QgcGVuZXRyYXRpb25TcGhlcmVQb2ludCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpOyAvL3hpLnZzdWIoeGopLnZhZGQocGVuZXRyYXRpb25TcGhlcmVQb2ludCkudmFkZChwZW5ldHJhdGlvblZlYzIgLCByLnJqKTsKCiAgICAgICAgICAgIHhpLnZzdWIoeGosIHIucmopOwogICAgICAgICAgICByLnJqLnZhZGQocGVuZXRyYXRpb25TcGhlcmVQb2ludCwgci5yaik7CiAgICAgICAgICAgIHIucmoudmFkZChwZW5ldHJhdGlvblZlYzIsIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShwZW5ldHJhdGlvblZlYzIpOwogICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShwZW5ldHJhdGlvblNwaGVyZVBvaW50KTsKICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOyAvLyBSZWxlYXNlIHdvcmxkIHZlcnRpY2VzCgogICAgICAgICAgICBmb3IgKGxldCBqID0gMCwgTmZhY2V2ZXJ0cyA9IGZhY2VWZXJ0cy5sZW5ndGg7IGogIT09IE5mYWNldmVydHM7IGorKykgewogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybjsgLy8gV2Ugb25seSBleHBlY3QgKm9uZSogZmFjZSBjb250YWN0CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBFZGdlPwogICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gZmFjZS5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgIC8vIEdldCB0d28gd29ybGQgdHJhbnNmb3JtZWQgdmVydGljZXMKICAgICAgICAgICAgICBjb25zdCB2MSA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICBjb25zdCB2MiA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWyhqICsgMSkgJSBmYWNlLmxlbmd0aF1dLCB2MSk7CiAgICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVsoaiArIDIpICUgZmFjZS5sZW5ndGhdXSwgdjIpOwogICAgICAgICAgICAgIHhqLnZhZGQodjEsIHYxKTsKICAgICAgICAgICAgICB4ai52YWRkKHYyLCB2Mik7IC8vIENvbnN0cnVjdCBlZGdlIHZlY3RvcgoKICAgICAgICAgICAgICBjb25zdCBlZGdlID0gc3BoZXJlQ29udmV4X2VkZ2U7CiAgICAgICAgICAgICAgdjIudnN1Yih2MSwgZWRnZSk7IC8vIENvbnN0cnVjdCB0aGUgc2FtZSB2ZWN0b3IsIGJ1dCBub3JtYWxpemVkCgogICAgICAgICAgICAgIGNvbnN0IGVkZ2VVbml0ID0gc3BoZXJlQ29udmV4X2VkZ2VVbml0OwogICAgICAgICAgICAgIGVkZ2UudW5pdChlZGdlVW5pdCk7IC8vIHAgaXMgeGkgcHJvamVjdGVkIG9udG8gdGhlIGVkZ2UKCiAgICAgICAgICAgICAgY29uc3QgcCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICBjb25zdCB2MV90b194aSA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICB4aS52c3ViKHYxLCB2MV90b194aSk7CiAgICAgICAgICAgICAgY29uc3QgZG90ID0gdjFfdG9feGkuZG90KGVkZ2VVbml0KTsKICAgICAgICAgICAgICBlZGdlVW5pdC5zY2FsZShkb3QsIHApOwogICAgICAgICAgICAgIHAudmFkZCh2MSwgcCk7IC8vIENvbXB1dGUgYSB2ZWN0b3IgZnJvbSBwIHRvIHRoZSBjZW50ZXIgb2YgdGhlIHNwaGVyZQoKICAgICAgICAgICAgICBjb25zdCB4aV90b19wID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHAudnN1Yih4aSwgeGlfdG9fcCk7IC8vIENvbGxpc2lvbiBpZiB0aGUgZWRnZS1zcGhlcmUgZGlzdGFuY2UgaXMgbGVzcyB0aGFuIHRoZSByYWRpdXMKICAgICAgICAgICAgICAvLyBBTkQgaWYgcCBpcyBpbiBiZXR3ZWVuIHYxIGFuZCB2MgoKICAgICAgICAgICAgICBpZiAoZG90ID4gMCAmJiBkb3QgKiBkb3QgPCBlZGdlLmxlbmd0aFNxdWFyZWQoKSAmJiB4aV90b19wLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICAgICAgICAvLyBDb2xsaXNpb24gaWYgdGhlIGVkZ2Utc3BoZXJlIGRpc3RhbmNlIGlzIGxlc3MgdGhhbiB0aGUgcmFkaXVzCiAgICAgICAgICAgICAgICAvLyBFZGdlIGNvbnRhY3QhCiAgICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgICBwLnZzdWIoeGosIHIucmopOwogICAgICAgICAgICAgICAgcC52c3ViKHhpLCByLm5pKTsKICAgICAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICByLm5pLnNjYWxlKFIsIHIucmkpOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgICAgICAgICAgci5yaS52c3ViKGJpLnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMCwgTmZhY2V2ZXJ0cyA9IGZhY2VWZXJ0cy5sZW5ndGg7IGogIT09IE5mYWNldmVydHM7IGorKykgewogICAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShmYWNlVmVydHNbal0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYyKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHApOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoeGlfdG9fcCk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2MV90b194aSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2MSk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjIpOwogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHApOwogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHhpX3RvX3ApOwogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxX3RvX3hpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSAvLyBSZWxlYXNlIHdvcmxkIHZlcnRpY2VzCgoKICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcGxhbmVDb252ZXgocGxhbmVTaGFwZSwgY29udmV4U2hhcGUsIHBsYW5lUG9zaXRpb24sIGNvbnZleFBvc2l0aW9uLCBwbGFuZVF1YXQsIGNvbnZleFF1YXQsIHBsYW5lQm9keSwgY29udmV4Qm9keSwgc2ksIHNqLCBqdXN0VGVzdCkgewogICAgICAvLyBTaW1wbHkgcmV0dXJuIHRoZSBwb2ludHMgYmVoaW5kIHRoZSBwbGFuZS4KICAgICAgY29uc3Qgd29ybGRWZXJ0ZXggPSBwbGFuZUNvbnZleF92OwogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IHBsYW5lQ29udmV4X25vcm1hbDsKICAgICAgd29ybGROb3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICBwbGFuZVF1YXQudm11bHQod29ybGROb3JtYWwsIHdvcmxkTm9ybWFsKTsgLy8gVHVybiBub3JtYWwgYWNjb3JkaW5nIHRvIHBsYW5lIG9yaWVudGF0aW9uCgogICAgICBsZXQgbnVtQ29udGFjdHMgPSAwOwogICAgICBjb25zdCByZWxwb3MgPSBwbGFuZUNvbnZleF9yZWxwb3M7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gY29udmV4U2hhcGUudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgY29udmV4IHZlcnRleAogICAgICAgIHdvcmxkVmVydGV4LmNvcHkoY29udmV4U2hhcGUudmVydGljZXNbaV0pOwogICAgICAgIGNvbnZleFF1YXQudm11bHQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICBjb252ZXhQb3NpdGlvbi52YWRkKHdvcmxkVmVydGV4LCB3b3JsZFZlcnRleCk7CiAgICAgICAgd29ybGRWZXJ0ZXgudnN1YihwbGFuZVBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IHdvcmxkTm9ybWFsLmRvdChyZWxwb3MpOwoKICAgICAgICBpZiAoZG90IDw9IDAuMCkgewogICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihwbGFuZUJvZHksIGNvbnZleEJvZHksIHBsYW5lU2hhcGUsIGNvbnZleFNoYXBlLCBzaSwgc2opOyAvLyBHZXQgdmVydGV4IHBvc2l0aW9uIHByb2plY3RlZCBvbiBwbGFuZQoKICAgICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHBsYW5lQ29udmV4X3Byb2plY3RlZDsKICAgICAgICAgIHdvcmxkTm9ybWFsLnNjYWxlKHdvcmxkTm9ybWFsLmRvdChyZWxwb3MpLCBwcm9qZWN0ZWQpOwogICAgICAgICAgd29ybGRWZXJ0ZXgudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7CiAgICAgICAgICBwcm9qZWN0ZWQudnN1YihwbGFuZVBvc2l0aW9uLCByLnJpKTsgLy8gRnJvbSBwbGFuZSB0byB2ZXJ0ZXggcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgci5uaS5jb3B5KHdvcmxkTm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbCBvdXQgZnJvbSBwbGFuZQogICAgICAgICAgLy8gcmogaXMgbm93IGp1c3QgdGhlIHZlY3RvciBmcm9tIHRoZSBjb252ZXggY2VudGVyIHRvIHRoZSB2ZXJ0ZXgKCiAgICAgICAgICB3b3JsZFZlcnRleC52c3ViKGNvbnZleFBvc2l0aW9uLCByLnJqKTsgLy8gTWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgYm9keQoKICAgICAgICAgIHIucmkudmFkZChwbGFuZVBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai52YWRkKGNvbnZleFBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHIucmoudnN1Yihjb252ZXhCb2R5LnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICBudW1Db250YWN0cysrOwoKICAgICAgICAgIGlmICghdGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbikgewogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbiAmJiBudW1Db250YWN0cykgewogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25Gcm9tQXZlcmFnZShudW1Db250YWN0cyk7CiAgICAgIH0KICAgIH0KCiAgICBib3hDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXgoc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlSGVpZ2h0ZmllbGQoc3BoZXJlU2hhcGUsIGhmU2hhcGUsIHNwaGVyZVBvcywgaGZQb3MsIHNwaGVyZVF1YXQsIGhmUXVhdCwgc3BoZXJlQm9keSwgaGZCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgZGF0YSA9IGhmU2hhcGUuZGF0YTsKICAgICAgY29uc3QgcmFkaXVzID0gc3BoZXJlU2hhcGUucmFkaXVzOwogICAgICBjb25zdCB3ID0gaGZTaGFwZS5lbGVtZW50U2l6ZTsKICAgICAgY29uc3Qgd29ybGRQaWxsYXJPZmZzZXQgPSBzcGhlcmVIZWlnaHRmaWVsZF90bXAyOyAvLyBHZXQgc3BoZXJlIHBvc2l0aW9uIHRvIGhlaWdodGZpZWxkIGxvY2FsIQoKICAgICAgY29uc3QgbG9jYWxTcGhlcmVQb3MgPSBzcGhlcmVIZWlnaHRmaWVsZF90bXAxOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUoaGZQb3MsIGhmUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgaW5kZXggb2YgdGhlIGRhdGEgcG9pbnRzIHRvIHRlc3QgYWdhaW5zdAoKICAgICAgbGV0IGlNaW5YID0gTWF0aC5mbG9vcigobG9jYWxTcGhlcmVQb3MueCAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WCA9IE1hdGguY2VpbCgobG9jYWxTcGhlcmVQb3MueCArIHJhZGl1cykgLyB3KSArIDE7CiAgICAgIGxldCBpTWluWSA9IE1hdGguZmxvb3IoKGxvY2FsU3BoZXJlUG9zLnkgLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFkgPSBNYXRoLmNlaWwoKGxvY2FsU3BoZXJlUG9zLnkgKyByYWRpdXMpIC8gdykgKyAxOyAvLyBCYWlsIG91dCBpZiB3ZSBhcmUgb3V0IG9mIHRoZSB0ZXJyYWluCgogICAgICBpZiAoaU1heFggPCAwIHx8IGlNYXhZIDwgMCB8fCBpTWluWCA+IGRhdGEubGVuZ3RoIHx8IGlNaW5ZID4gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gQ2xhbXAgaW5kZXggdG8gZWRnZXMKCgogICAgICBpZiAoaU1pblggPCAwKSB7CiAgICAgICAgaU1pblggPSAwOwogICAgICB9CgogICAgICBpZiAoaU1heFggPCAwKSB7CiAgICAgICAgaU1heFggPSAwOwogICAgICB9CgogICAgICBpZiAoaU1pblkgPCAwKSB7CiAgICAgICAgaU1pblkgPSAwOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPCAwKSB7CiAgICAgICAgaU1heFkgPSAwOwogICAgICB9CgogICAgICBpZiAoaU1pblggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWluWCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1heFggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNYXhZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1pblkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWluWSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgY29uc3QgbWluTWF4ID0gW107CiAgICAgIGhmU2hhcGUuZ2V0UmVjdE1pbk1heChpTWluWCwgaU1pblksIGlNYXhYLCBpTWF4WSwgbWluTWF4KTsKICAgICAgY29uc3QgbWluID0gbWluTWF4WzBdOwogICAgICBjb25zdCBtYXggPSBtaW5NYXhbMV07IC8vIEJhaWwgb3V0IGlmIHdlIGNhbid0IHRvdWNoIHRoZSBib3VuZGluZyBoZWlnaHQgYm94CgogICAgICBpZiAobG9jYWxTcGhlcmVQb3MueiAtIHJhZGl1cyA+IG1heCB8fCBsb2NhbFNwaGVyZVBvcy56ICsgcmFkaXVzIDwgbWluKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsKCiAgICAgIGZvciAobGV0IGkgPSBpTWluWDsgaSA8IGlNYXhYOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gaU1pblk7IGogPCBpTWF4WTsgaisrKSB7CiAgICAgICAgICBjb25zdCBudW1Db250YWN0c0JlZm9yZSA9IHJlc3VsdC5sZW5ndGg7CiAgICAgICAgICBsZXQgaW50ZXJzZWN0aW5nID0gZmFsc2U7IC8vIExvd2VyIHRyaWFuZ2xlCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCBmYWxzZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUoaGZQb3MsIGhmUXVhdCwgaGZTaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICBpZiAoc3BoZXJlUG9zLmRpc3RhbmNlVG8od29ybGRQaWxsYXJPZmZzZXQpIDwgaGZTaGFwZS5waWxsYXJDb252ZXguYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzcGhlcmVTaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgICAgICBpbnRlcnNlY3RpbmcgPSB0aGlzLnNwaGVyZUNvbnZleChzcGhlcmVTaGFwZSwgaGZTaGFwZS5waWxsYXJDb252ZXgsIHNwaGVyZVBvcywgd29ybGRQaWxsYXJPZmZzZXQsIHNwaGVyZVF1YXQsIGhmUXVhdCwgc3BoZXJlQm9keSwgaGZCb2R5LCBzcGhlcmVTaGFwZSwgaGZTaGFwZSwganVzdFRlc3QpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChqdXN0VGVzdCAmJiBpbnRlcnNlY3RpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9IC8vIFVwcGVyIHRyaWFuZ2xlCgoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUoaGZQb3MsIGhmUXVhdCwgaGZTaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICBpZiAoc3BoZXJlUG9zLmRpc3RhbmNlVG8od29ybGRQaWxsYXJPZmZzZXQpIDwgaGZTaGFwZS5waWxsYXJDb252ZXguYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzcGhlcmVTaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgICAgICBpbnRlcnNlY3RpbmcgPSB0aGlzLnNwaGVyZUNvbnZleChzcGhlcmVTaGFwZSwgaGZTaGFwZS5waWxsYXJDb252ZXgsIHNwaGVyZVBvcywgd29ybGRQaWxsYXJPZmZzZXQsIHNwaGVyZVF1YXQsIGhmUXVhdCwgc3BoZXJlQm9keSwgaGZCb2R5LCBzcGhlcmVTaGFwZSwgaGZTaGFwZSwganVzdFRlc3QpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChqdXN0VGVzdCAmJiBpbnRlcnNlY3RpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgbnVtQ29udGFjdHMgPSByZXN1bHQubGVuZ3RoIC0gbnVtQ29udGFjdHNCZWZvcmU7CgogICAgICAgICAgaWYgKG51bUNvbnRhY3RzID4gMikgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICAvKgogICAgICAgICAgICAvLyBTa2lwIGFsbCBidXQgMQogICAgICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IG51bUNvbnRhY3RzIC0gMTsgaysrKSB7CiAgICAgICAgICAgICAgICByZXN1bHQucG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICovCgogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGJveEhlaWdodGZpZWxkKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNpLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4SGVpZ2h0ZmllbGQoc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4SGVpZ2h0ZmllbGQoY29udmV4U2hhcGUsIGhmU2hhcGUsIGNvbnZleFBvcywgaGZQb3MsIGNvbnZleFF1YXQsIGhmUXVhdCwgY29udmV4Qm9keSwgaGZCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgZGF0YSA9IGhmU2hhcGUuZGF0YTsKICAgICAgY29uc3QgdyA9IGhmU2hhcGUuZWxlbWVudFNpemU7CiAgICAgIGNvbnN0IHJhZGl1cyA9IGNvbnZleFNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzOwogICAgICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IGNvbnZleEhlaWdodGZpZWxkX3RtcDI7CiAgICAgIGNvbnN0IGZhY2VMaXN0ID0gY29udmV4SGVpZ2h0ZmllbGRfZmFjZUxpc3Q7IC8vIEdldCBzcGhlcmUgcG9zaXRpb24gdG8gaGVpZ2h0ZmllbGQgbG9jYWwhCgogICAgICBjb25zdCBsb2NhbENvbnZleFBvcyA9IGNvbnZleEhlaWdodGZpZWxkX3RtcDE7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShoZlBvcywgaGZRdWF0LCBjb252ZXhQb3MsIGxvY2FsQ29udmV4UG9zKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBsZXQgaU1pblggPSBNYXRoLmZsb29yKChsb2NhbENvbnZleFBvcy54IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhYID0gTWF0aC5jZWlsKChsb2NhbENvbnZleFBvcy54ICsgcmFkaXVzKSAvIHcpICsgMTsKICAgICAgbGV0IGlNaW5ZID0gTWF0aC5mbG9vcigobG9jYWxDb252ZXhQb3MueSAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WSA9IE1hdGguY2VpbCgobG9jYWxDb252ZXhQb3MueSArIHJhZGl1cykgLyB3KSArIDE7IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCiAgICAgIGlmIChpTWF4WCA8IDAgfHwgaU1heFkgPCAwIHx8IGlNaW5YID4gZGF0YS5sZW5ndGggfHwgaU1pblkgPiBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwoKCiAgICAgIGlmIChpTWluWCA8IDApIHsKICAgICAgICBpTWluWCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA8IDApIHsKICAgICAgICBpTWF4WCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA8IDApIHsKICAgICAgICBpTWluWSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA8IDApIHsKICAgICAgICBpTWF4WSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNaW5YID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWF4WCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1heFkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNaW5ZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBjb25zdCBtaW5NYXggPSBbXTsKICAgICAgaGZTaGFwZS5nZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCBtaW5NYXgpOwogICAgICBjb25zdCBtaW4gPSBtaW5NYXhbMF07CiAgICAgIGNvbnN0IG1heCA9IG1pbk1heFsxXTsgLy8gQmFpbCBvdXQgaWYgd2UncmUgY2FudCB0b3VjaCB0aGUgYm91bmRpbmcgaGVpZ2h0IGJveAoKICAgICAgaWYgKGxvY2FsQ29udmV4UG9zLnogLSByYWRpdXMgPiBtYXggfHwgbG9jYWxDb252ZXhQb3MueiArIHJhZGl1cyA8IG1pbikgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGxldCBpbnRlcnNlY3RpbmcgPSBmYWxzZTsgLy8gTG93ZXIgdHJpYW5nbGUKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChjb252ZXhQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIGNvbnZleFNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuY29udmV4Q29udmV4KGNvbnZleFNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgY29udmV4UG9zLCB3b3JsZFBpbGxhck9mZnNldCwgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIG51bGwsIG51bGwsIGp1c3RUZXN0LCBmYWNlTGlzdCwgbnVsbCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCB0cnVlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChjb252ZXhQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIGNvbnZleFNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuY29udmV4Q29udmV4KGNvbnZleFNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgY29udmV4UG9zLCB3b3JsZFBpbGxhck9mZnNldCwgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIG51bGwsIG51bGwsIGp1c3RUZXN0LCBmYWNlTGlzdCwgbnVsbCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICAvLyBUaGUgbm9ybWFsIGlzIHRoZSB1bml0IHZlY3RvciBmcm9tIHNwaGVyZSBjZW50ZXIgdG8gcGFydGljbGUgY2VudGVyCiAgICAgIGNvbnN0IG5vcm1hbCA9IHBhcnRpY2xlU3BoZXJlX25vcm1hbDsKICAgICAgbm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgeGkudnN1Yih4aiwgbm9ybWFsKTsKICAgICAgY29uc3QgbGVuZ3RoU3F1YXJlZCA9IG5vcm1hbC5sZW5ndGhTcXVhcmVkKCk7CgogICAgICBpZiAobGVuZ3RoU3F1YXJlZCA8PSBzai5yYWRpdXMgKiBzai5yYWRpdXMpIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICAgIHIucmouY29weShub3JtYWwpOwogICAgICAgIHIucmouc2NhbGUoc2oucmFkaXVzLCByLnJqKTsKICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwKCiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7CiAgICAgICAgci5yaS5zZXQoMCwgMCwgMCk7IC8vIENlbnRlciBvZiBwYXJ0aWNsZQoKICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgfQogICAgfQoKICAgIHBsYW5lUGFydGljbGUoc2osIHNpLCB4aiwgeGksIHFqLCBxaSwgYmosIGJpLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3Qgbm9ybWFsID0gcGFydGljbGVQbGFuZV9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIGJqLnF1YXRlcm5pb24udm11bHQobm9ybWFsLCBub3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUgb3JpZW50YXRpb24KCiAgICAgIGNvbnN0IHJlbHBvcyA9IHBhcnRpY2xlUGxhbmVfcmVscG9zOwogICAgICB4aS52c3ViKGJqLnBvc2l0aW9uLCByZWxwb3MpOwogICAgICBjb25zdCBkb3QgPSBub3JtYWwuZG90KHJlbHBvcyk7CgogICAgICBpZiAoZG90IDw9IDAuMCkgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAoKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCiAgICAgICAgLy8gR2V0IHBhcnRpY2xlIHBvc2l0aW9uIHByb2plY3RlZCBvbiBwbGFuZQoKICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZDsKICAgICAgICBub3JtYWwuc2NhbGUobm9ybWFsLmRvdCh4aSksIHByb2plY3RlZCk7CiAgICAgICAgeGkudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vcHJvamVjdGVkLnZhZGQoYmoucG9zaXRpb24scHJvamVjdGVkKTsKICAgICAgICAvLyByaiBpcyBub3cgdGhlIHByb2plY3RlZCB3b3JsZCBwb3NpdGlvbiBtaW51cyBwbGFuZSBwb3NpdGlvbgoKICAgICAgICByLnJqLmNvcHkocHJvamVjdGVkKTsKICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgfQogICAgfQoKICAgIGJveFBhcnRpY2xlKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNpLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4UGFydGljbGUoc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4UGFydGljbGUoc2osIHNpLCB4aiwgeGksIHFqLCBxaSwgYmosIGJpLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgbGV0IHBlbmV0cmF0ZWRGYWNlSW5kZXggPSAtMTsKICAgICAgY29uc3QgcGVuZXRyYXRlZEZhY2VOb3JtYWwgPSBjb252ZXhQYXJ0aWNsZV9wZW5ldHJhdGVkRmFjZU5vcm1hbDsKICAgICAgY29uc3Qgd29ybGRQZW5ldHJhdGlvblZlYyA9IGNvbnZleFBhcnRpY2xlX3dvcmxkUGVuZXRyYXRpb25WZWM7CiAgICAgIGxldCBtaW5QZW5ldHJhdGlvbiA9IG51bGw7CgogICAgICBjb25zdCBsb2NhbCA9IGNvbnZleFBhcnRpY2xlX2xvY2FsOwogICAgICBsb2NhbC5jb3B5KHhpKTsKICAgICAgbG9jYWwudnN1Yih4aiwgbG9jYWwpOyAvLyBDb252ZXJ0IHBvc2l0aW9uIHRvIHJlbGF0aXZlIHRoZSBjb252ZXggb3JpZ2luCgogICAgICBxai5jb25qdWdhdGUoY3FqKTsKICAgICAgY3FqLnZtdWx0KGxvY2FsLCBsb2NhbCk7CgogICAgICBpZiAoc2oucG9pbnRJc0luc2lkZShsb2NhbCkpIHsKICAgICAgICBpZiAoc2oud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlKSB7CiAgICAgICAgICBzai5jb21wdXRlV29ybGRWZXJ0aWNlcyh4aiwgcWopOwogICAgICAgIH0KCiAgICAgICAgaWYgKHNqLndvcmxkRmFjZU5vcm1hbHNOZWVkc1VwZGF0ZSkgewogICAgICAgICAgc2ouY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocWopOwogICAgICAgIH0gLy8gRm9yIGVhY2ggd29ybGQgcG9seWdvbiBpbiB0aGUgcG9seWhlZHJhCgoKICAgICAgICBmb3IgKGxldCBpID0gMCwgbmZhY2VzID0gc2ouZmFjZXMubGVuZ3RoOyBpICE9PSBuZmFjZXM7IGkrKykgewogICAgICAgICAgLy8gQ29uc3RydWN0IHdvcmxkIGZhY2UgdmVydGljZXMKICAgICAgICAgIGNvbnN0IHZlcnRzID0gW3NqLndvcmxkVmVydGljZXNbc2ouZmFjZXNbaV1bMF1dXTsKICAgICAgICAgIGNvbnN0IG5vcm1hbCA9IHNqLndvcmxkRmFjZU5vcm1hbHNbaV07IC8vIENoZWNrIGhvdyBtdWNoIHRoZSBwYXJ0aWNsZSBwZW5ldHJhdGVzIHRoZSBwb2x5Z29uIHBsYW5lLgoKICAgICAgICAgIHhpLnZzdWIodmVydHNbMF0sIGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUpOwogICAgICAgICAgY29uc3QgcGVuZXRyYXRpb24gPSAtbm9ybWFsLmRvdChjb252ZXhQYXJ0aWNsZV92ZXJ0ZXhUb1BhcnRpY2xlKTsKCiAgICAgICAgICBpZiAobWluUGVuZXRyYXRpb24gPT09IG51bGwgfHwgTWF0aC5hYnMocGVuZXRyYXRpb24pIDwgTWF0aC5hYnMobWluUGVuZXRyYXRpb24pKSB7CiAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBtaW5QZW5ldHJhdGlvbiA9IHBlbmV0cmF0aW9uOwogICAgICAgICAgICBwZW5ldHJhdGVkRmFjZUluZGV4ID0gaTsKICAgICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwuY29weShub3JtYWwpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHBlbmV0cmF0ZWRGYWNlSW5kZXggIT09IC0xKSB7CiAgICAgICAgICAvLyBTZXR1cCBjb250YWN0CiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlTm9ybWFsLnNjYWxlKG1pblBlbmV0cmF0aW9uLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsgLy8gcmogaXMgdGhlIHBhcnRpY2xlIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgZmFjZQoKICAgICAgICAgIHdvcmxkUGVuZXRyYXRpb25WZWMudmFkZCh4aSwgd29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICB3b3JsZFBlbmV0cmF0aW9uVmVjLnZzdWIoeGosIHdvcmxkUGVuZXRyYXRpb25WZWMpOwogICAgICAgICAgci5yai5jb3B5KHdvcmxkUGVuZXRyYXRpb25WZWMpOyAvL2NvbnN0IHByb2plY3RlZFRvRmFjZSA9IHhpLnZzdWIoeGopLnZhZGQod29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICAvL3Byb2plY3RlZFRvRmFjZS5jb3B5KHIucmopOwogICAgICAgICAgLy9xai52bXVsdChyLnJqLHIucmopOwoKICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlTm9ybWFsLm5lZ2F0ZShyLm5pKTsgLy8gQ29udGFjdCBub3JtYWwKCiAgICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCgogICAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgICAgY29uc3QgcmogPSByLnJqOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICAgIHJpLnZzdWIoYmkucG9zaXRpb24sIHJpKTsKICAgICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUud2FybignUG9pbnQgZm91bmQgaW5zaWRlIGNvbnZleCwgYnV0IGRpZCBub3QgZmluZCBwZW5ldHJhdGluZyBmYWNlIScpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGhlaWdodGZpZWxkQ3lsaW5kZXIoaGZTaGFwZSwgY29udmV4U2hhcGUsIGhmUG9zLCBjb252ZXhQb3MsIGhmUXVhdCwgY29udmV4UXVhdCwgaGZCb2R5LCBjb252ZXhCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4SGVpZ2h0ZmllbGQoY29udmV4U2hhcGUsIGhmU2hhcGUsIGNvbnZleFBvcywgaGZQb3MsIGNvbnZleFF1YXQsIGhmUXVhdCwgY29udmV4Qm9keSwgaGZCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpOwogICAgfQoKICAgIHBhcnRpY2xlQ3lsaW5kZXIoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4UGFydGljbGUoc2osIHNpLCB4aiwgeGksIHFqLCBxaSwgYmosIGJpLCByc2ksIHJzaiwganVzdFRlc3QpOwogICAgfQoKICAgIHNwaGVyZVRyaW1lc2goc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgc3BoZXJlUG9zLCB0cmltZXNoUG9zLCBzcGhlcmVRdWF0LCB0cmltZXNoUXVhdCwgc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBlZGdlVmVydGV4QSA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlcnRleEE7CiAgICAgIGNvbnN0IGVkZ2VWZXJ0ZXhCID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QjsKICAgICAgY29uc3QgZWRnZVZlY3RvciA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvcjsKICAgICAgY29uc3QgZWRnZVZlY3RvclVuaXQgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3JVbml0OwogICAgICBjb25zdCBsb2NhbFNwaGVyZVBvcyA9IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVQb3M7CiAgICAgIGNvbnN0IHRtcCA9IHNwaGVyZVRyaW1lc2hfdG1wOwogICAgICBjb25zdCBsb2NhbFNwaGVyZUFBQkIgPSBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlQUFCQjsKICAgICAgY29uc3QgdjIgPSBzcGhlcmVUcmltZXNoX3YyOwogICAgICBjb25zdCByZWxwb3MgPSBzcGhlcmVUcmltZXNoX3JlbHBvczsKICAgICAgY29uc3QgdHJpYW5nbGVzID0gc3BoZXJlVHJpbWVzaF90cmlhbmdsZXM7IC8vIENvbnZlcnQgc3BoZXJlIHBvc2l0aW9uIHRvIGxvY2FsIGluIHRoZSB0cmltZXNoCgogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUodHJpbWVzaFBvcywgdHJpbWVzaFF1YXQsIHNwaGVyZVBvcywgbG9jYWxTcGhlcmVQb3MpOyAvLyBHZXQgdGhlIGFhYmIgb2YgdGhlIHNwaGVyZSBsb2NhbGx5IGluIHRoZSB0cmltZXNoCgogICAgICBjb25zdCBzcGhlcmVSYWRpdXMgPSBzcGhlcmVTaGFwZS5yYWRpdXM7CiAgICAgIGxvY2FsU3BoZXJlQUFCQi5sb3dlckJvdW5kLnNldChsb2NhbFNwaGVyZVBvcy54IC0gc3BoZXJlUmFkaXVzLCBsb2NhbFNwaGVyZVBvcy55IC0gc3BoZXJlUmFkaXVzLCBsb2NhbFNwaGVyZVBvcy56IC0gc3BoZXJlUmFkaXVzKTsKICAgICAgbG9jYWxTcGhlcmVBQUJCLnVwcGVyQm91bmQuc2V0KGxvY2FsU3BoZXJlUG9zLnggKyBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnkgKyBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnogKyBzcGhlcmVSYWRpdXMpOwogICAgICB0cmltZXNoU2hhcGUuZ2V0VHJpYW5nbGVzSW5BQUJCKGxvY2FsU3BoZXJlQUFCQiwgdHJpYW5nbGVzKTsgLy9mb3IgKGxldCBpID0gMDsgaSA8IHRyaW1lc2hTaGFwZS5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgdHJpYW5nbGVzLnB1c2goaSk7IC8vIEFsbAogICAgICAvLyBWZXJ0aWNlcwoKICAgICAgY29uc3QgdiA9IHNwaGVyZVRyaW1lc2hfdjsKICAgICAgY29uc3QgcmFkaXVzU3F1YXJlZCA9IHNwaGVyZVNoYXBlLnJhZGl1cyAqIHNwaGVyZVNoYXBlLnJhZGl1czsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIGpdLCB2KTsgLy8gQ2hlY2sgdmVydGV4IG92ZXJsYXAgaW4gc3BoZXJlCgogICAgICAgICAgdi52c3ViKGxvY2FsU3BoZXJlUG9zLCByZWxwb3MpOwoKICAgICAgICAgIGlmIChyZWxwb3MubGVuZ3RoU3F1YXJlZCgpIDw9IHJhZGl1c1NxdWFyZWQpIHsKICAgICAgICAgICAgLy8gU2FmZSB1cAogICAgICAgICAgICB2Mi5jb3B5KHYpOwogICAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodHJpbWVzaFBvcywgdHJpbWVzaFF1YXQsIHYyLCB2KTsKICAgICAgICAgICAgdi52c3ViKHNwaGVyZVBvcywgcmVscG9zKTsKCiAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsZXQgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHNwaGVyZUJvZHksIHRyaW1lc2hCb2R5LCBzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICAgIHIubmkuY29weShyZWxwb3MpOwogICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOyAvLyByaSBpcyB0aGUgdmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byB0aGUgc3BoZXJlIHN1cmZhY2UKCiAgICAgICAgICAgIHIucmkuY29weShyLm5pKTsKICAgICAgICAgICAgci5yaS5zY2FsZShzcGhlcmVTaGFwZS5yYWRpdXMsIHIucmkpOwogICAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICByLnJqLmNvcHkodik7CiAgICAgICAgICAgIHIucmoudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7IC8vIFN0b3JlIHJlc3VsdAoKICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDaGVjayBhbGwgZWRnZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRyaWFuZ2xlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMzsgaisrKSB7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyBqXSwgZWRnZVZlcnRleEEpOwogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgKGogKyAxKSAlIDNdLCBlZGdlVmVydGV4Qik7CiAgICAgICAgICBlZGdlVmVydGV4Qi52c3ViKGVkZ2VWZXJ0ZXhBLCBlZGdlVmVjdG9yKTsgLy8gUHJvamVjdCBzcGhlcmUgcG9zaXRpb24gdG8gdGhlIGVkZ2UKCiAgICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKGVkZ2VWZXJ0ZXhCLCB0bXApOwogICAgICAgICAgY29uc3QgcG9zaXRpb25BbG9uZ0VkZ2VCID0gdG1wLmRvdChlZGdlVmVjdG9yKTsKICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEEsIHRtcCk7CiAgICAgICAgICBsZXQgcG9zaXRpb25BbG9uZ0VkZ2VBID0gdG1wLmRvdChlZGdlVmVjdG9yKTsKCiAgICAgICAgICBpZiAocG9zaXRpb25BbG9uZ0VkZ2VBID4gMCAmJiBwb3NpdGlvbkFsb25nRWRnZUIgPCAwKSB7CiAgICAgICAgICAgIC8vIE5vdyBjaGVjayB0aGUgb3J0aG9nb25hbCBkaXN0YW5jZSBmcm9tIGVkZ2UgdG8gc3BoZXJlIGNlbnRlcgogICAgICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKGVkZ2VWZXJ0ZXhBLCB0bXApOwogICAgICAgICAgICBlZGdlVmVjdG9yVW5pdC5jb3B5KGVkZ2VWZWN0b3IpOwogICAgICAgICAgICBlZGdlVmVjdG9yVW5pdC5ub3JtYWxpemUoKTsKICAgICAgICAgICAgcG9zaXRpb25BbG9uZ0VkZ2VBID0gdG1wLmRvdChlZGdlVmVjdG9yVW5pdCk7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0LnNjYWxlKHBvc2l0aW9uQWxvbmdFZGdlQSwgdG1wKTsKICAgICAgICAgICAgdG1wLnZhZGQoZWRnZVZlcnRleEEsIHRtcCk7IC8vIHRtcCBpcyBub3cgdGhlIHNwaGVyZSBjZW50ZXIgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSBlZGdlLCBkZWZpbmVkIGxvY2FsbHkgaW4gdGhlIHRyaW1lc2ggZnJhbWUKCiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSB0bXAuZGlzdGFuY2VUbyhsb2NhbFNwaGVyZVBvcyk7CgogICAgICAgICAgICBpZiAoZGlzdCA8IHNwaGVyZVNoYXBlLnJhZGl1cykgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgICAgICB0bXAudnN1Yihsb2NhbFNwaGVyZVBvcywgci5uaSk7CiAgICAgICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByLm5pLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICAgICAgci5yaS52YWRkKHNwaGVyZVBvcywgci5yaSk7CiAgICAgICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdG1wLCB0bXApOwogICAgICAgICAgICAgIHRtcC52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLm5pLCByLm5pKTsKICAgICAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLnJpLCByLnJpKTsKICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBUcmlhbmdsZSBmYWNlcwoKCiAgICAgIGNvbnN0IHZhID0gc3BoZXJlVHJpbWVzaF92YTsKICAgICAgY29uc3QgdmIgPSBzcGhlcmVUcmltZXNoX3ZiOwogICAgICBjb25zdCB2YyA9IHNwaGVyZVRyaW1lc2hfdmM7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHNwaGVyZVRyaW1lc2hfbm9ybWFsOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB0cmlhbmdsZXMubGVuZ3RoOyBpICE9PSBOOyBpKyspIHsKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VHJpYW5nbGVWZXJ0aWNlcyh0cmlhbmdsZXNbaV0sIHZhLCB2YiwgdmMpOwogICAgICAgIHRyaW1lc2hTaGFwZS5nZXROb3JtYWwodHJpYW5nbGVzW2ldLCBub3JtYWwpOwogICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIodmEsIHRtcCk7CiAgICAgICAgbGV0IGRpc3QgPSB0bXAuZG90KG5vcm1hbCk7CiAgICAgICAgbm9ybWFsLnNjYWxlKGRpc3QsIHRtcCk7CiAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1Yih0bXAsIHRtcCk7IC8vIHRtcCBpcyBub3cgdGhlIHNwaGVyZSBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIHRyaWFuZ2xlIHBsYW5lCgogICAgICAgIGRpc3QgPSB0bXAuZGlzdGFuY2VUbyhsb2NhbFNwaGVyZVBvcyk7CgogICAgICAgIGlmIChSYXkucG9pbnRJblRyaWFuZ2xlKHRtcCwgdmEsIHZiLCB2YykgJiYgZGlzdCA8IHNwaGVyZVNoYXBlLnJhZGl1cykgewogICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGxldCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgIHRtcC52c3ViKGxvY2FsU3BoZXJlUG9zLCByLm5pKTsKICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7CiAgICAgICAgICByLm5pLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihzcGhlcmVCb2R5LnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdG1wLCB0bXApOwogICAgICAgICAgdG1wLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZSh0cmltZXNoUXVhdCwgci5uaSwgci5uaSk7CiAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLnJpLCByLnJpKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0cmlhbmdsZXMubGVuZ3RoID0gMDsKICAgIH0KCiAgICBwbGFuZVRyaW1lc2gocGxhbmVTaGFwZSwgdHJpbWVzaFNoYXBlLCBwbGFuZVBvcywgdHJpbWVzaFBvcywgcGxhbmVRdWF0LCB0cmltZXNoUXVhdCwgcGxhbmVCb2R5LCB0cmltZXNoQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIE1ha2UgY29udGFjdHMhCiAgICAgIGNvbnN0IHYgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBub3JtYWwgPSBwbGFuZVRyaW1lc2hfbm9ybWFsOwogICAgICBub3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICBwbGFuZVF1YXQudm11bHQobm9ybWFsLCBub3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpbWVzaFNoYXBlLnZlcnRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIC8vIEdldCB3b3JsZCB2ZXJ0ZXggZnJvbSB0cmltZXNoCiAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleChpLCB2KTsgLy8gU2FmZSB1cAoKICAgICAgICBjb25zdCB2MiA9IG5ldyBWZWMzKCk7CiAgICAgICAgdjIuY29weSh2KTsKICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodHJpbWVzaFBvcywgdHJpbWVzaFF1YXQsIHYyLCB2KTsgLy8gQ2hlY2sgcGxhbmUgc2lkZQoKICAgICAgICBjb25zdCByZWxwb3MgPSBwbGFuZVRyaW1lc2hfcmVscG9zOwogICAgICAgIHYudnN1YihwbGFuZVBvcywgcmVscG9zKTsKICAgICAgICBjb25zdCBkb3QgPSBub3JtYWwuZG90KHJlbHBvcyk7CgogICAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHBsYW5lQm9keSwgdHJpbWVzaEJvZHksIHBsYW5lU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgci5uaS5jb3B5KG5vcm1hbCk7IC8vIENvbnRhY3Qgbm9ybWFsIGlzIHRoZSBwbGFuZSBub3JtYWwKICAgICAgICAgIC8vIEdldCB2ZXJ0ZXggcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkID0gcGxhbmVUcmltZXNoX3Byb2plY3RlZDsKICAgICAgICAgIG5vcm1hbC5zY2FsZShyZWxwb3MuZG90KG5vcm1hbCksIHByb2plY3RlZCk7CiAgICAgICAgICB2LnZzdWIocHJvamVjdGVkLCBwcm9qZWN0ZWQpOyAvLyByaSBpcyB0aGUgcHJvamVjdGVkIHdvcmxkIHBvc2l0aW9uIG1pbnVzIHBsYW5lIHBvc2l0aW9uCgogICAgICAgICAgci5yaS5jb3B5KHByb2plY3RlZCk7CiAgICAgICAgICByLnJpLnZzdWIocGxhbmVCb2R5LnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgIHIucmouY29weSh2KTsKICAgICAgICAgIHIucmoudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7IC8vIFN0b3JlIHJlc3VsdAoKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgfQogICAgICB9CiAgICB9IC8vIGNvbnZleFRyaW1lc2goCiAgICAvLyAgIHNpOiBDb252ZXhQb2x5aGVkcm9uLCBzajogVHJpbWVzaCwgeGk6IFZlYzMsIHhqOiBWZWMzLCBxaTogUXVhdGVybmlvbiwgcWo6IFF1YXRlcm5pb24sCiAgICAvLyAgIGJpOiBCb2R5LCBiajogQm9keSwgcnNpPzogU2hhcGUgfCBudWxsLCByc2o/OiBTaGFwZSB8IG51bGwsCiAgICAvLyAgIGZhY2VMaXN0QT86IG51bWJlcltdIHwgbnVsbCwgZmFjZUxpc3RCPzogbnVtYmVyW10gfCBudWxsLAogICAgLy8gKSB7CiAgICAvLyAgIGNvbnN0IHNlcEF4aXMgPSBjb252ZXhDb252ZXhfc2VwQXhpczsKICAgIC8vICAgaWYoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKXsKICAgIC8vICAgICAgIHJldHVybjsKICAgIC8vICAgfQogICAgLy8gICAvLyBDb25zdHJ1Y3QgYSB0ZW1wIGh1bGwgZm9yIGVhY2ggdHJpYW5nbGUKICAgIC8vICAgY29uc3QgaHVsbEIgPSBuZXcgQ29udmV4UG9seWhlZHJvbigpOwogICAgLy8gICBodWxsQi5mYWNlcyA9IFtbMCwxLDJdXTsKICAgIC8vICAgY29uc3QgdmEgPSBuZXcgVmVjMygpOwogICAgLy8gICBjb25zdCB2YiA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGNvbnN0IHZjID0gbmV3IFZlYzMoKTsKICAgIC8vICAgaHVsbEIudmVydGljZXMgPSBbCiAgICAvLyAgICAgICB2YSwKICAgIC8vICAgICAgIHZiLAogICAgLy8gICAgICAgdmMKICAgIC8vICAgXTsKICAgIC8vICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzai5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgLy8gICAgICAgY29uc3QgdHJpYW5nbGVOb3JtYWwgPSBuZXcgVmVjMygpOwogICAgLy8gICAgICAgc2ouZ2V0Tm9ybWFsKGksIHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgIGh1bGxCLmZhY2VOb3JtYWxzID0gW3RyaWFuZ2xlTm9ybWFsXTsKICAgIC8vICAgICAgIHNqLmdldFRyaWFuZ2xlVmVydGljZXMoaSwgdmEsIHZiLCB2Yyk7CiAgICAvLyAgICAgICBsZXQgZCA9IHNpLnRlc3RTZXBBeGlzKHRyaWFuZ2xlTm9ybWFsLCBodWxsQiwgeGksIHFpLCB4aiwgcWopOwogICAgLy8gICAgICAgaWYoIWQpewogICAgLy8gICAgICAgICAgIHRyaWFuZ2xlTm9ybWFsLnNjYWxlKC0xLCB0cmlhbmdsZU5vcm1hbCk7CiAgICAvLyAgICAgICAgICAgZCA9IHNpLnRlc3RTZXBBeGlzKHRyaWFuZ2xlTm9ybWFsLCBodWxsQiwgeGksIHFpLCB4aiwgcWopOwogICAgLy8gICAgICAgICAgIGlmKCFkKXsKICAgIC8vICAgICAgICAgICAgICAgY29udGludWU7CiAgICAvLyAgICAgICAgICAgfQogICAgLy8gICAgICAgfQogICAgLy8gICAgICAgY29uc3QgcmVzOiBDb252ZXhQb2x5aGVkcm9uQ29udGFjdFBvaW50W10gPSBbXTsKICAgIC8vICAgICAgIGNvbnN0IHEgPSBjb252ZXhDb252ZXhfcTsKICAgIC8vICAgICAgIHNpLmNsaXBBZ2FpbnN0SHVsbCh4aSxxaSxodWxsQix4aixxaix0cmlhbmdsZU5vcm1hbCwtMTAwLDEwMCxyZXMpOwogICAgLy8gICAgICAgZm9yKGxldCBqID0gMDsgaiAhPT0gcmVzLmxlbmd0aDsgaisrKXsKICAgIC8vICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksYmosc2ksc2oscnNpLHJzaiksCiAgICAvLyAgICAgICAgICAgICAgIHJpID0gci5yaSwKICAgIC8vICAgICAgICAgICAgICAgcmogPSByLnJqOwogICAgLy8gICAgICAgICAgIHIubmkuY29weSh0cmlhbmdsZU5vcm1hbCk7CiAgICAvLyAgICAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7CiAgICAvLyAgICAgICAgICAgcmVzW2pdLm5vcm1hbC5uZWdhdGUocSk7CiAgICAvLyAgICAgICAgICAgcS5tdWx0KHJlc1tqXS5kZXB0aCwgcSk7CiAgICAvLyAgICAgICAgICAgcmVzW2pdLnBvaW50LnZhZGQocSwgcmkpOwogICAgLy8gICAgICAgICAgIHJqLmNvcHkocmVzW2pdLnBvaW50KTsKICAgIC8vICAgICAgICAgICAvLyBDb250YWN0IHBvaW50cyBhcmUgaW4gd29ybGQgY29vcmRpbmF0ZXMuIFRyYW5zZm9ybSBiYWNrIHRvIHJlbGF0aXZlCiAgICAvLyAgICAgICAgICAgcmkudnN1Yih4aSxyaSk7CiAgICAvLyAgICAgICAgICAgcmoudnN1Yih4aixyaik7CiAgICAvLyAgICAgICAgICAgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKICAgIC8vICAgICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAvLyAgICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgLy8gICAgICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgIC8vICAgICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAvLyAgICAgICAgICAgcmVzdWx0LnB1c2gocik7CiAgICAvLyAgICAgICB9CiAgICAvLyAgIH0KICAgIC8vIH0KCgogIH0KICBjb25zdCBhdmVyYWdlTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBhdmVyYWdlQ29udGFjdFBvaW50QSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXZlcmFnZUNvbnRhY3RQb2ludEIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFF1YXQxID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCB0bXBRdWF0MiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgogIGNvbnN0IHBsYW5lVHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lVHJpbWVzaF9yZWxwb3MgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lVHJpbWVzaF9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdjIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfZWRnZVZlcnRleEEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfZWRnZVZlcnRleEIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvciA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yVW5pdCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF90bXAgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdmEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdmMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCID0gbmV3IEFBQkIoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlcyA9IFtdOwogIGNvbnN0IHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVfdG9fc3BoZXJlX29ydGhvID0gbmV3IFZlYzMoKTsgLy8gU2VlIGh0dHA6Ly9idWxsZXRwaHlzaWNzLmNvbS9CdWxsZXQvQnVsbGV0RnVsbC9TcGhlcmVUcmlhbmdsZURldGVjdG9yXzhjcHBfc291cmNlLmh0bWwKCiAgY29uc3QgcG9pbnRJblBvbHlnb25fZWRnZSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcG9pbnRJblBvbHlnb25fZWRnZV94X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcG9pbnRJblBvbHlnb25fdnRwID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gcG9pbnRJblBvbHlnb24odmVydHMsIG5vcm1hbCwgcCkgewogICAgbGV0IHBvc2l0aXZlUmVzdWx0ID0gbnVsbDsKICAgIGNvbnN0IE4gPSB2ZXJ0cy5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICBjb25zdCB2ID0gdmVydHNbaV07IC8vIEdldCBlZGdlIHRvIHRoZSBuZXh0IHZlcnRleAoKICAgICAgY29uc3QgZWRnZSA9IHBvaW50SW5Qb2x5Z29uX2VkZ2U7CiAgICAgIHZlcnRzWyhpICsgMSkgJSBOXS52c3ViKHYsIGVkZ2UpOyAvLyBHZXQgY3Jvc3MgcHJvZHVjdCBiZXR3ZWVuIHBvbHlnb24gbm9ybWFsIGFuZCB0aGUgZWRnZQoKICAgICAgY29uc3QgZWRnZV94X25vcm1hbCA9IHBvaW50SW5Qb2x5Z29uX2VkZ2VfeF9ub3JtYWw7IC8vY29uc3QgZWRnZV94X25vcm1hbCA9IG5ldyBWZWMzKCk7CgogICAgICBlZGdlLmNyb3NzKG5vcm1hbCwgZWRnZV94X25vcm1hbCk7IC8vIEdldCB2ZWN0b3IgYmV0d2VlbiBwb2ludCBhbmQgY3VycmVudCB2ZXJ0ZXgKCiAgICAgIGNvbnN0IHZlcnRleF90b19wID0gcG9pbnRJblBvbHlnb25fdnRwOwogICAgICBwLnZzdWIodiwgdmVydGV4X3RvX3ApOyAvLyBUaGlzIGRvdCBwcm9kdWN0IGRldGVybWluZXMgd2hpY2ggc2lkZSBvZiB0aGUgZWRnZSB0aGUgcG9pbnQgaXMKCiAgICAgIGNvbnN0IHIgPSBlZGdlX3hfbm9ybWFsLmRvdCh2ZXJ0ZXhfdG9fcCk7IC8vIElmIGFsbCBzdWNoIGRvdCBwcm9kdWN0cyBoYXZlIHNhbWUgc2lnbiwgd2UgYXJlIGluc2lkZSB0aGUgcG9seWdvbi4KCiAgICAgIGlmIChwb3NpdGl2ZVJlc3VsdCA9PT0gbnVsbCB8fCByID4gMCAmJiBwb3NpdGl2ZVJlc3VsdCA9PT0gdHJ1ZSB8fCByIDw9IDAgJiYgcG9zaXRpdmVSZXN1bHQgPT09IGZhbHNlKSB7CiAgICAgICAgaWYgKHBvc2l0aXZlUmVzdWx0ID09PSBudWxsKSB7CiAgICAgICAgICBwb3NpdGl2ZVJlc3VsdCA9IHIgPiAwOwogICAgICAgIH0KCiAgICAgICAgY29udGludWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBFbmNvdW50ZXJlZCBzb21lIG90aGVyIHNpZ24uIEV4aXQuCiAgICAgIH0KICAgIH0gLy8gSWYgd2UgZ290IGhlcmUsIGFsbCBkb3QgcHJvZHVjdHMgd2VyZSBvZiB0aGUgc2FtZSBzaWduLgoKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGNvbnN0IGJveF90b19zcGhlcmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9ucyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zMSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zMiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X3NpZGVzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwogIGNvbnN0IHNwaGVyZUJveF9zcGhlcmVfdG9fY29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9ucyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X3NpZGVfbnMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9uczIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleF90b19zcGhlcmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9lZGdlID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfZWRnZVVuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9zcGhlcmVUb0Nvcm5lciA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkQ29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZFBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfcGVuZXRyYXRpb25WZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9zcGhlcmVUb1dvcmxkUG9pbnQgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF92ID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfcHJvamVjdGVkID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhDb252ZXhfc2VwQXhpcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4Q29udmV4X3EgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlU3BoZXJlX25vcm1hbCA9IG5ldyBWZWMzKCk7IC8vIFdJUAoKICBjb25zdCBjcWogPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX2xvY2FsID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3BlbmV0cmF0ZWRGYWNlTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhQYXJ0aWNsZV92ZXJ0ZXhUb1BhcnRpY2xlID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhQYXJ0aWNsZV93b3JsZFBlbmV0cmF0aW9uVmVjID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhIZWlnaHRmaWVsZF90bXAxID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhIZWlnaHRmaWVsZF90bXAyID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhIZWlnaHRmaWVsZF9mYWNlTGlzdCA9IFswXTsKICBjb25zdCBzcGhlcmVIZWlnaHRmaWVsZF90bXAxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVIZWlnaHRmaWVsZF90bXAyID0gbmV3IFZlYzMoKTsKCiAgY2xhc3MgT3ZlcmxhcEtlZXBlciB7CiAgICAvKioKICAgICAqIEB0b2RvIFJlbW92ZSB1c2VsZXNzIGNvbnN0cnVjdG9yCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLmN1cnJlbnQgPSBbXTsKICAgICAgdGhpcy5wcmV2aW91cyA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiBnZXRLZXkKICAgICAqLwoKCiAgICBnZXRLZXkoaSwgaikgewogICAgICBpZiAoaiA8IGkpIHsKICAgICAgICBjb25zdCB0ZW1wID0gajsKICAgICAgICBqID0gaTsKICAgICAgICBpID0gdGVtcDsKICAgICAgfQoKICAgICAgcmV0dXJuIGkgPDwgMTYgfCBqOwogICAgfQogICAgLyoqCiAgICAgKiBzZXQKICAgICAqLwoKCiAgICBzZXQoaSwgaikgewogICAgICAvLyBJbnNlcnRpb24gc29ydC4gVGhpcyB3YXkgdGhlIGRpZmYgd2lsbCBoYXZlIGxpbmVhciBjb21wbGV4aXR5LgogICAgICBjb25zdCBrZXkgPSB0aGlzLmdldEtleShpLCBqKTsKICAgICAgY29uc3QgY3VycmVudCA9IHRoaXMuY3VycmVudDsKICAgICAgbGV0IGluZGV4ID0gMDsKCiAgICAgIHdoaWxlIChrZXkgPiBjdXJyZW50W2luZGV4XSkgewogICAgICAgIGluZGV4Kys7CiAgICAgIH0KCiAgICAgIGlmIChrZXkgPT09IGN1cnJlbnRbaW5kZXhdKSB7CiAgICAgICAgcmV0dXJuOyAvLyBQYWlyIHdhcyBhbHJlYWR5IGFkZGVkCiAgICAgIH0KCiAgICAgIGZvciAobGV0IGogPSBjdXJyZW50Lmxlbmd0aCAtIDE7IGogPj0gaW5kZXg7IGotLSkgewogICAgICAgIGN1cnJlbnRbaiArIDFdID0gY3VycmVudFtqXTsKICAgICAgfQoKICAgICAgY3VycmVudFtpbmRleF0gPSBrZXk7CiAgICB9CiAgICAvKioKICAgICAqIHRpY2sKICAgICAqLwoKCiAgICB0aWNrKCkgewogICAgICBjb25zdCB0bXAgPSB0aGlzLmN1cnJlbnQ7CiAgICAgIHRoaXMuY3VycmVudCA9IHRoaXMucHJldmlvdXM7CiAgICAgIHRoaXMucHJldmlvdXMgPSB0bXA7CiAgICAgIHRoaXMuY3VycmVudC5sZW5ndGggPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBnZXREaWZmCiAgICAgKi8KCgogICAgZ2V0RGlmZihhZGRpdGlvbnMsIHJlbW92YWxzKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmN1cnJlbnQ7CiAgICAgIGNvbnN0IGIgPSB0aGlzLnByZXZpb3VzOwogICAgICBjb25zdCBhbCA9IGEubGVuZ3RoOwogICAgICBjb25zdCBibCA9IGIubGVuZ3RoOwogICAgICBsZXQgaiA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFsOyBpKyspIHsKICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICBjb25zdCBrZXlBID0gYVtpXTsKCiAgICAgICAgd2hpbGUgKGtleUEgPiBiW2pdKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQoKICAgICAgICBmb3VuZCA9IGtleUEgPT09IGJbal07CgogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHVucGFja0FuZFB1c2goYWRkaXRpb25zLCBrZXlBKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGogPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBibDsgaSsrKSB7CiAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7CiAgICAgICAgY29uc3Qga2V5QiA9IGJbaV07CgogICAgICAgIHdoaWxlIChrZXlCID4gYVtqXSkgewogICAgICAgICAgaisrOwogICAgICAgIH0KCiAgICAgICAgZm91bmQgPSBhW2pdID09PSBrZXlCOwoKICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICB1bnBhY2tBbmRQdXNoKHJlbW92YWxzLCBrZXlCKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQoKICBmdW5jdGlvbiB1bnBhY2tBbmRQdXNoKGFycmF5LCBrZXkpIHsKICAgIGFycmF5LnB1c2goKGtleSAmIDB4ZmZmZjAwMDApID4+IDE2LCBrZXkgJiAweDAwMDBmZmZmKTsKICB9CgogIGNvbnN0IGdldEtleSA9IChpLCBqKSA9PiBpIDwgaiA/IGAke2l9LSR7an1gIDogYCR7an0tJHtpfWA7CiAgLyoqCiAgICogVHVwbGVEaWN0aW9uYXJ5CiAgICovCgoKICBjbGFzcyBUdXBsZURpY3Rpb25hcnkgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuZGF0YSA9IHsKICAgICAgICBrZXlzOiBbXQogICAgICB9OwogICAgfQoKICAgIC8qKiBnZXQgKi8KICAgIGdldChpLCBqKSB7CiAgICAgIGNvbnN0IGtleSA9IGdldEtleShpLCBqKTsKICAgICAgcmV0dXJuIHRoaXMuZGF0YVtrZXldOwogICAgfQogICAgLyoqIHNldCAqLwoKCiAgICBzZXQoaSwgaiwgdmFsdWUpIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOyAvLyBDaGVjayBpZiBrZXkgYWxyZWFkeSBleGlzdHMKCiAgICAgIGlmICghdGhpcy5nZXQoaSwgaikpIHsKICAgICAgICB0aGlzLmRhdGEua2V5cy5wdXNoKGtleSk7CiAgICAgIH0KCiAgICAgIHRoaXMuZGF0YVtrZXldID0gdmFsdWU7CiAgICB9CiAgICAvKiogZGVsZXRlICovCgoKICAgIGRlbGV0ZShpLCBqKSB7CiAgICAgIGNvbnN0IGtleSA9IGdldEtleShpLCBqKTsKICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmRhdGEua2V5cy5pbmRleE9mKGtleSk7CgogICAgICBpZiAoaW5kZXggIT09IC0xKSB7CiAgICAgICAgdGhpcy5kYXRhLmtleXMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgfQoKICAgICAgZGVsZXRlIHRoaXMuZGF0YVtrZXldOwogICAgfQogICAgLyoqIHJlc2V0ICovCgoKICAgIHJlc2V0KCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBrZXlzID0gZGF0YS5rZXlzOwoKICAgICAgd2hpbGUgKGtleXMubGVuZ3RoID4gMCkgewogICAgICAgIGNvbnN0IGtleSA9IGtleXMucG9wKCk7CiAgICAgICAgZGVsZXRlIGRhdGFba2V5XTsKICAgICAgfQogICAgfQoKICB9CgogIC8qKgogICAqIFRoZSBwaHlzaWNzIHdvcmxkCiAgICovCiAgY2xhc3MgV29ybGQgZXh0ZW5kcyBFdmVudFRhcmdldCB7CiAgICAvKioKICAgICAqIEN1cnJlbnRseSAvIGxhc3QgdXNlZCB0aW1lc3RlcC4gSXMgc2V0IHRvIC0xIGlmIG5vdCBhdmFpbGFibGUuIFRoaXMgdmFsdWUgaXMgdXBkYXRlZCBiZWZvcmUgZWFjaCBpbnRlcm5hbCBzdGVwLCB3aGljaCBtZWFucyB0aGF0IGl0IGlzICJmcmVzaCIgaW5zaWRlIGV2ZW50IGNhbGxiYWNrcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTWFrZXMgYm9kaWVzIGdvIHRvIHNsZWVwIHdoZW4gdGhleSd2ZSBiZWVuIGluYWN0aXZlLgogICAgICogQGRlZmF1bHQgZmFsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIHRoZSBjdXJyZW50IGNvbnRhY3RzIChpbnN0YW5jZXMgb2YgQ29udGFjdEVxdWF0aW9uKSBpbiB0aGUgd29ybGQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEhvdyBvZnRlbiB0byBub3JtYWxpemUgcXVhdGVybmlvbnMuIFNldCB0byAwIGZvciBldmVyeSBzdGVwLCAxIGZvciBldmVyeSBzZWNvbmQgZXRjLi4gQSBsYXJnZXIgdmFsdWUgaW5jcmVhc2VzIHBlcmZvcm1hbmNlLiBJZiBib2RpZXMgdGVuZCB0byBleHBsb2RlLCBzZXQgdG8gYSBzbWFsbGVyIHZhbHVlICh6ZXJvIHRvIGJlIHN1cmUgbm90aGluZyBjYW4gZ28gd3JvbmcpLgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBTZXQgdG8gdHJ1ZSB0byB1c2UgZmFzdCBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24uIEl0IGlzIG9mdGVuIGVub3VnaCBhY2N1cmF0ZSB0byB1c2UuCiAgICAgKiBJZiBib2RpZXMgdGVuZCB0byBleHBsb2RlLCBzZXQgdG8gZmFsc2UuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgd2FsbC1jbG9jayB0aW1lIHNpbmNlIHNpbXVsYXRpb24gc3RhcnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE51bWJlciBvZiB0aW1lc3RlcHMgdGFrZW4gc2luY2Ugc3RhcnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIERlZmF1bHQgYW5kIGxhc3QgdGltZXN0ZXAgc2l6ZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBncmF2aXR5IG9mIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogR3Jhdml0eSB0byB1c2Ugd2hlbiBhcHByb3hpbWF0aW5nIHRoZSBmcmljdGlvbiBtYXggZm9yY2UgKG11Km1hc3MqZ3Jhdml0eSkuCiAgICAgKiBJZiB1bmRlZmluZWQsIGdsb2JhbCBncmF2aXR5IHdpbGwgYmUgdXNlZC4KICAgICAqIFVzZSB0byBlbmFibGUgZnJpY3Rpb24gaW4gYSBXb3JsZCB3aXRoIGEgbnVsbCBncmF2aXR5IHZlY3RvciAobm8gZ3Jhdml0eSkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBicm9hZHBoYXNlIGFsZ29yaXRobSB0byB1c2UuCiAgICAgKiBAZGVmYXVsdCBOYWl2ZUJyb2FkcGhhc2UKICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIGJvZGllcyBpbiB0aGlzIHdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRydWUgaWYgYW55IGJvZGllcyBhcmUgbm90IHNsZWVwaW5nLCBmYWxzZSBpZiBldmVyeSBib2R5IGlzIHNsZWVwaW5nLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgc29sdmVyIGFsZ29yaXRobSB0byB1c2UuCiAgICAgKiBAZGVmYXVsdCBHU1NvbHZlcgogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25NYXRyaXgKICAgICAqLwoKICAgIC8qKgogICAgICogQ29sbGlzaW9uTWF0cml4IGZyb20gdGhlIHByZXZpb3VzIHN0ZXAuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCBhZGRlZCBjb250YWN0bWF0ZXJpYWxzLgogICAgICovCgogICAgLyoqCiAgICAgKiBVc2VkIHRvIGxvb2sgdXAgYSBDb250YWN0TWF0ZXJpYWwgZ2l2ZW4gdHdvIGluc3RhbmNlcyBvZiBNYXRlcmlhbC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGRlZmF1bHQgbWF0ZXJpYWwgb2YgdGhlIGJvZGllcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhpcyBjb250YWN0IG1hdGVyaWFsIGlzIHVzZWQgaWYgbm8gc3VpdGFibGUgY29udGFjdG1hdGVyaWFsIGlzIGZvdW5kIGZvciBhIGNvbnRhY3QuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRpbWUgYWNjdW11bGF0b3IgZm9yIGludGVycG9sYXRpb24uCiAgICAgKiBAc2VlIGh0dHBzOi8vZ2FmZmVyb25nYW1lcy5jb20vZ2FtZS1waHlzaWNzL2ZpeC15b3VyLXRpbWVzdGVwLwogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgYm9keSBoYXMgYmVlbiBhZGRlZCB0byB0aGUgd29ybGQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBiZWVuIHJlbW92ZWQgZnJvbSB0aGUgd29ybGQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5kdCA9IC0xOwogICAgICB0aGlzLmFsbG93U2xlZXAgPSAhIW9wdGlvbnMuYWxsb3dTbGVlcDsKICAgICAgdGhpcy5jb250YWN0cyA9IFtdOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zID0gW107CiAgICAgIHRoaXMucXVhdE5vcm1hbGl6ZVNraXAgPSBvcHRpb25zLnF1YXROb3JtYWxpemVTa2lwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLnF1YXROb3JtYWxpemVTa2lwIDogMDsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplRmFzdCA9IG9wdGlvbnMucXVhdE5vcm1hbGl6ZUZhc3QgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucXVhdE5vcm1hbGl6ZUZhc3QgOiBmYWxzZTsKICAgICAgdGhpcy50aW1lID0gMC4wOwogICAgICB0aGlzLnN0ZXBudW1iZXIgPSAwOwogICAgICB0aGlzLmRlZmF1bHRfZHQgPSAxIC8gNjA7CiAgICAgIHRoaXMubmV4dElkID0gMDsKICAgICAgdGhpcy5ncmF2aXR5ID0gbmV3IFZlYzMoKTsKCiAgICAgIGlmIChvcHRpb25zLmdyYXZpdHkpIHsKICAgICAgICB0aGlzLmdyYXZpdHkuY29weShvcHRpb25zLmdyYXZpdHkpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5mcmljdGlvbkdyYXZpdHkpIHsKICAgICAgICB0aGlzLmZyaWN0aW9uR3Jhdml0eSA9IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5mcmljdGlvbkdyYXZpdHkuY29weShvcHRpb25zLmZyaWN0aW9uR3Jhdml0eSk7CiAgICAgIH0KCiAgICAgIHRoaXMuYnJvYWRwaGFzZSA9IG9wdGlvbnMuYnJvYWRwaGFzZSAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5icm9hZHBoYXNlIDogbmV3IE5haXZlQnJvYWRwaGFzZSgpOwogICAgICB0aGlzLmJvZGllcyA9IFtdOwogICAgICB0aGlzLmhhc0FjdGl2ZUJvZGllcyA9IGZhbHNlOwogICAgICB0aGlzLnNvbHZlciA9IG9wdGlvbnMuc29sdmVyICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLnNvbHZlciA6IG5ldyBHU1NvbHZlcigpOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gW107CiAgICAgIHRoaXMubmFycm93cGhhc2UgPSBuZXcgTmFycm93cGhhc2UodGhpcyk7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4ID0gbmV3IEFycmF5Q29sbGlzaW9uTWF0cml4KCk7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXMgPSBuZXcgQXJyYXlDb2xsaXNpb25NYXRyaXgoKTsKICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlciA9IG5ldyBPdmVybGFwS2VlcGVyKCk7CiAgICAgIHRoaXMuc2hhcGVPdmVybGFwS2VlcGVyID0gbmV3IE92ZXJsYXBLZWVwZXIoKTsKICAgICAgdGhpcy5jb250YWN0bWF0ZXJpYWxzID0gW107CiAgICAgIHRoaXMuY29udGFjdE1hdGVyaWFsVGFibGUgPSBuZXcgVHVwbGVEaWN0aW9uYXJ5KCk7CiAgICAgIHRoaXMuZGVmYXVsdE1hdGVyaWFsID0gbmV3IE1hdGVyaWFsKCdkZWZhdWx0Jyk7CiAgICAgIHRoaXMuZGVmYXVsdENvbnRhY3RNYXRlcmlhbCA9IG5ldyBDb250YWN0TWF0ZXJpYWwodGhpcy5kZWZhdWx0TWF0ZXJpYWwsIHRoaXMuZGVmYXVsdE1hdGVyaWFsLCB7CiAgICAgICAgZnJpY3Rpb246IDAuMywKICAgICAgICByZXN0aXR1dGlvbjogMC4wCiAgICAgIH0pOwogICAgICB0aGlzLmRvUHJvZmlsaW5nID0gZmFsc2U7CiAgICAgIHRoaXMucHJvZmlsZSA9IHsKICAgICAgICBzb2x2ZTogMCwKICAgICAgICBtYWtlQ29udGFjdENvbnN0cmFpbnRzOiAwLAogICAgICAgIGJyb2FkcGhhc2U6IDAsCiAgICAgICAgaW50ZWdyYXRlOiAwLAogICAgICAgIG5hcnJvd3BoYXNlOiAwCiAgICAgIH07CiAgICAgIHRoaXMuYWNjdW11bGF0b3IgPSAwOwogICAgICB0aGlzLnN1YnN5c3RlbXMgPSBbXTsKICAgICAgdGhpcy5hZGRCb2R5RXZlbnQgPSB7CiAgICAgICAgdHlwZTogJ2FkZEJvZHknLAogICAgICAgIGJvZHk6IG51bGwKICAgICAgfTsKICAgICAgdGhpcy5yZW1vdmVCb2R5RXZlbnQgPSB7CiAgICAgICAgdHlwZTogJ3JlbW92ZUJvZHknLAogICAgICAgIGJvZHk6IG51bGwKICAgICAgfTsKICAgICAgdGhpcy5pZFRvQm9keU1hcCA9IHt9OwogICAgICB0aGlzLmJyb2FkcGhhc2Uuc2V0V29ybGQodGhpcyk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgY29udGFjdCBtYXRlcmlhbCBiZXR3ZWVuIG1hdGVyaWFscyBtMSBhbmQgbTIKICAgICAqIEByZXR1cm4gVGhlIGNvbnRhY3QgbWF0ZXJpYWwgaWYgaXQgd2FzIGZvdW5kLgogICAgICovCgoKICAgIGdldENvbnRhY3RNYXRlcmlhbChtMSwgbTIpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udGFjdE1hdGVyaWFsVGFibGUuZ2V0KG0xLmlkLCBtMi5pZCk7CiAgICB9CiAgICAvKioKICAgICAqIFN0b3JlIG9sZCBjb2xsaXNpb24gc3RhdGUgaW5mbwogICAgICovCgoKICAgIGNvbGxpc2lvbk1hdHJpeFRpY2soKSB7CiAgICAgIGNvbnN0IHRlbXAgPSB0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzID0gdGhpcy5jb2xsaXNpb25NYXRyaXg7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4ID0gdGVtcDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXgucmVzZXQoKTsKICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci50aWNrKCk7CiAgICAgIHRoaXMuc2hhcGVPdmVybGFwS2VlcGVyLnRpY2soKTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIGEgY29uc3RyYWludCB0byB0aGUgc2ltdWxhdGlvbi4KICAgICAqLwoKCiAgICBhZGRDb25zdHJhaW50KGMpIHsKICAgICAgdGhpcy5jb25zdHJhaW50cy5wdXNoKGMpOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmVzIGEgY29uc3RyYWludAogICAgICovCgoKICAgIHJlbW92ZUNvbnN0cmFpbnQoYykgewogICAgICBjb25zdCBpZHggPSB0aGlzLmNvbnN0cmFpbnRzLmluZGV4T2YoYyk7CgogICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgIHRoaXMuY29uc3RyYWludHMuc3BsaWNlKGlkeCwgMSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmF5Y2FzdCB0ZXN0CiAgICAgKiBAZGVwcmVjYXRlZCBVc2UgLnJheWNhc3RBbGwsIC5yYXljYXN0Q2xvc2VzdCBvciAucmF5Y2FzdEFueSBpbnN0ZWFkLgogICAgICovCgoKICAgIHJheVRlc3QoZnJvbSwgdG8sIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0IGluc3RhbmNlb2YgUmF5Y2FzdFJlc3VsdCkgewogICAgICAgIC8vIERvIHJheWNhc3RDbG9zZXN0CiAgICAgICAgdGhpcy5yYXljYXN0Q2xvc2VzdChmcm9tLCB0bywgewogICAgICAgICAgc2tpcEJhY2tmYWNlczogdHJ1ZQogICAgICAgIH0sIHJlc3VsdCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gRG8gcmF5Y2FzdEFsbAogICAgICAgIHRoaXMucmF5Y2FzdEFsbChmcm9tLCB0bywgewogICAgICAgICAgc2tpcEJhY2tmYWNlczogdHJ1ZQogICAgICAgIH0sIHJlc3VsdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmF5IGNhc3QgYWdhaW5zdCBhbGwgYm9kaWVzLiBUaGUgcHJvdmlkZWQgY2FsbGJhY2sgd2lsbCBiZSBleGVjdXRlZCBmb3IgZWFjaCBoaXQgd2l0aCBhIFJheWNhc3RSZXN1bHQgYXMgc2luZ2xlIGFyZ3VtZW50LgogICAgICogQHJldHVybiBUcnVlIGlmIGFueSBib2R5IHdhcyBoaXQuCiAgICAgKi8KCgogICAgcmF5Y2FzdEFsbChmcm9tLCB0bywgb3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgb3B0aW9ucy5tb2RlID0gUmF5LkFMTDsKICAgICAgb3B0aW9ucy5mcm9tID0gZnJvbTsKICAgICAgb3B0aW9ucy50byA9IHRvOwogICAgICBvcHRpb25zLmNhbGxiYWNrID0gY2FsbGJhY2s7CiAgICAgIHJldHVybiB0bXBSYXkuaW50ZXJzZWN0V29ybGQodGhpcywgb3B0aW9ucyk7CiAgICB9CiAgICAvKioKICAgICAqIFJheSBjYXN0LCBhbmQgc3RvcCBhdCB0aGUgZmlyc3QgcmVzdWx0LiBOb3RlIHRoYXQgdGhlIG9yZGVyIGlzIHJhbmRvbSAtIGJ1dCB0aGUgbWV0aG9kIGlzIGZhc3QuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0QW55KGZyb20sIHRvLCBvcHRpb25zLCByZXN1bHQpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgb3B0aW9ucy5tb2RlID0gUmF5LkFOWTsKICAgICAgb3B0aW9ucy5mcm9tID0gZnJvbTsKICAgICAgb3B0aW9ucy50byA9IHRvOwogICAgICBvcHRpb25zLnJlc3VsdCA9IHJlc3VsdDsKICAgICAgcmV0dXJuIHRtcFJheS5pbnRlcnNlY3RXb3JsZCh0aGlzLCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogUmF5IGNhc3QsIGFuZCByZXR1cm4gaW5mb3JtYXRpb24gb2YgdGhlIGNsb3Nlc3QgaGl0LgogICAgICogQHJldHVybiBUcnVlIGlmIGFueSBib2R5IHdhcyBoaXQuCiAgICAgKi8KCgogICAgcmF5Y2FzdENsb3Nlc3QoZnJvbSwgdG8sIG9wdGlvbnMsIHJlc3VsdCkgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQ0xPU0VTVDsKICAgICAgb3B0aW9ucy5mcm9tID0gZnJvbTsKICAgICAgb3B0aW9ucy50byA9IHRvOwogICAgICBvcHRpb25zLnJlc3VsdCA9IHJlc3VsdDsKICAgICAgcmV0dXJuIHRtcFJheS5pbnRlcnNlY3RXb3JsZCh0aGlzLCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIGEgcmlnaWQgYm9keSB0byB0aGUgc2ltdWxhdGlvbi4KICAgICAqIEB0b2RvIElmIHRoZSBzaW11bGF0aW9uIGhhcyBub3QgeWV0IHN0YXJ0ZWQsIHdoeSByZWNyZXRlIGFuZCBjb3B5IGFycmF5cyBmb3IgZWFjaCBib2R5PyBBY2N1bXVsYXRlIGluIGR5bmFtaWMgYXJyYXlzIGluIHRoaXMgY2FzZS4KICAgICAqIEB0b2RvIEFkZGluZyBhbiBhcnJheSBvZiBib2RpZXMgc2hvdWxkIGJlIHBvc3NpYmxlLiBUaGlzIHdvdWxkIHNhdmUgc29tZSBsb29wcyB0b28KICAgICAqLwoKCiAgICBhZGRCb2R5KGJvZHkpIHsKICAgICAgaWYgKHRoaXMuYm9kaWVzLmluY2x1ZGVzKGJvZHkpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBib2R5LmluZGV4ID0gdGhpcy5ib2RpZXMubGVuZ3RoOwogICAgICB0aGlzLmJvZGllcy5wdXNoKGJvZHkpOwogICAgICBib2R5LndvcmxkID0gdGhpczsKICAgICAgYm9keS5pbml0UG9zaXRpb24uY29weShib2R5LnBvc2l0aW9uKTsKICAgICAgYm9keS5pbml0VmVsb2NpdHkuY29weShib2R5LnZlbG9jaXR5KTsKICAgICAgYm9keS50aW1lTGFzdFNsZWVweSA9IHRoaXMudGltZTsKCiAgICAgIGlmIChib2R5IGluc3RhbmNlb2YgQm9keSkgewogICAgICAgIGJvZHkuaW5pdEFuZ3VsYXJWZWxvY2l0eS5jb3B5KGJvZHkuYW5ndWxhclZlbG9jaXR5KTsKICAgICAgICBib2R5LmluaXRRdWF0ZXJuaW9uLmNvcHkoYm9keS5xdWF0ZXJuaW9uKTsKICAgICAgfQoKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0TnVtT2JqZWN0cyh0aGlzLmJvZGllcy5sZW5ndGgpOwogICAgICB0aGlzLmFkZEJvZHlFdmVudC5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5pZFRvQm9keU1hcFtib2R5LmlkXSA9IGJvZHk7CiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudCh0aGlzLmFkZEJvZHlFdmVudCk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhIHJpZ2lkIGJvZHkgZnJvbSB0aGUgc2ltdWxhdGlvbi4KICAgICAqLwoKCiAgICByZW1vdmVCb2R5KGJvZHkpIHsKICAgICAgYm9keS53b3JsZCA9IG51bGw7CiAgICAgIGNvbnN0IG4gPSB0aGlzLmJvZGllcy5sZW5ndGggLSAxOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3QgaWR4ID0gYm9kaWVzLmluZGV4T2YoYm9keSk7CgogICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgIGJvZGllcy5zcGxpY2UoaWR4LCAxKTsgLy8gVG9kbzogc2hvdWxkIHVzZSBhIGdhcmJhZ2UgZnJlZSBtZXRob2QKICAgICAgICAvLyBSZWNvbXB1dGUgaW5kZXgKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgYm9kaWVzW2ldLmluZGV4ID0gaTsKICAgICAgICB9CgogICAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4LnNldE51bU9iamVjdHMobik7CiAgICAgICAgdGhpcy5yZW1vdmVCb2R5RXZlbnQuYm9keSA9IGJvZHk7CiAgICAgICAgZGVsZXRlIHRoaXMuaWRUb0JvZHlNYXBbYm9keS5pZF07CiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMucmVtb3ZlQm9keUV2ZW50KTsKICAgICAgfQogICAgfQoKICAgIGdldEJvZHlCeUlkKGlkKSB7CiAgICAgIHJldHVybiB0aGlzLmlkVG9Cb2R5TWFwW2lkXTsKICAgIH0KICAgIC8qKgogICAgICogQHRvZG8gTWFrZSBhIGZhc3RlciBtYXAKICAgICAqLwoKCiAgICBnZXRTaGFwZUJ5SWQoaWQpIHsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlcyA9IGJvZGllc1tpXS5zaGFwZXM7CgogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgc2hhcGVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tqXTsKCiAgICAgICAgICBpZiAoc2hhcGUuaWQgPT09IGlkKSB7CiAgICAgICAgICAgIHJldHVybiBzaGFwZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgLyoqCiAgICAgKiBBZGRzIGEgY29udGFjdCBtYXRlcmlhbCB0byB0aGUgV29ybGQKICAgICAqLwoKCiAgICBhZGRDb250YWN0TWF0ZXJpYWwoY21hdCkgewogICAgICAvLyBBZGQgY29udGFjdCBtYXRlcmlhbAogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMucHVzaChjbWF0KTsgLy8gQWRkIGN1cnJlbnQgY29udGFjdCBtYXRlcmlhbCB0byB0aGUgbWF0ZXJpYWwgdGFibGUKCiAgICAgIHRoaXMuY29udGFjdE1hdGVyaWFsVGFibGUuc2V0KGNtYXQubWF0ZXJpYWxzWzBdLmlkLCBjbWF0Lm1hdGVyaWFsc1sxXS5pZCwgY21hdCk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBjb250YWN0IG1hdGVyaWFsIGZyb20gdGhlIFdvcmxkLgogICAgICovCgoKICAgIHJlbW92ZUNvbnRhY3RNYXRlcmlhbChjbWF0KSB7CiAgICAgIGNvbnN0IGlkeCA9IHRoaXMuY29udGFjdG1hdGVyaWFscy5pbmRleE9mKGNtYXQpOwoKICAgICAgaWYgKGlkeCA9PT0gLTEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuY29udGFjdG1hdGVyaWFscy5zcGxpY2UoaWR4LCAxKTsKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5kZWxldGUoY21hdC5tYXRlcmlhbHNbMF0uaWQsIGNtYXQubWF0ZXJpYWxzWzFdLmlkKTsKICAgIH0KICAgIC8qKgogICAgICogU3RlcCB0aGUgc2ltdWxhdGlvbiBmb3J3YXJkIGtlZXBpbmcgdHJhY2sgb2YgbGFzdCBjYWxsZWQgdGltZQogICAgICogdG8gYmUgYWJsZSB0byBzdGVwIHRoZSB3b3JsZCBhdCBhIGZpeGVkIHJhdGUsIGluZGVwZW5kZW50bHkgb2YgZnJhbWVyYXRlLgogICAgICoKICAgICAqIEBwYXJhbSBkdCBUaGUgZml4ZWQgdGltZSBzdGVwIHNpemUgdG8gdXNlIChkZWZhdWx0OiAxIC8gNjApLgogICAgICogQHBhcmFtIG1heFN1YlN0ZXBzIE1heGltdW0gbnVtYmVyIG9mIGZpeGVkIHN0ZXBzIHRvIHRha2UgcGVyIGZ1bmN0aW9uIGNhbGwgKGRlZmF1bHQ6IDEwKS4KICAgICAqIEBzZWUgaHR0cHM6Ly9nYWZmZXJvbmdhbWVzLmNvbS9wb3N0L2ZpeF95b3VyX3RpbWVzdGVwLwogICAgICogQGV4YW1wbGUKICAgICAqICAgICAvLyBSdW4gdGhlIHNpbXVsYXRpb24gaW5kZXBlbmRlbnRseSBvZiBmcmFtZXJhdGUgZXZlcnkgMSAvIDYwIG1zCiAgICAgKiAgICAgd29ybGQuZml4ZWRTdGVwKCkKICAgICAqLwoKCiAgICBmaXhlZFN0ZXAoZHQsIG1heFN1YlN0ZXBzKSB7CiAgICAgIGlmIChkdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgZHQgPSAxIC8gNjA7CiAgICAgIH0KCiAgICAgIGlmIChtYXhTdWJTdGVwcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4U3ViU3RlcHMgPSAxMDsKICAgICAgfQoKICAgICAgY29uc3QgdGltZSA9IHBlcmZvcm1hbmNlLm5vdygpIC8gMTAwMDsgLy8gc2Vjb25kcwoKICAgICAgaWYgKCF0aGlzLmxhc3RDYWxsVGltZSkgewogICAgICAgIHRoaXMuc3RlcChkdCwgdW5kZWZpbmVkLCBtYXhTdWJTdGVwcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgdGltZVNpbmNlTGFzdENhbGxlZCA9IHRpbWUgLSB0aGlzLmxhc3RDYWxsVGltZTsKICAgICAgICB0aGlzLnN0ZXAoZHQsIHRpbWVTaW5jZUxhc3RDYWxsZWQsIG1heFN1YlN0ZXBzKTsKICAgICAgfQoKICAgICAgdGhpcy5sYXN0Q2FsbFRpbWUgPSB0aW1lOwogICAgfQogICAgLyoqCiAgICAgKiBTdGVwIHRoZSBwaHlzaWNzIHdvcmxkIGZvcndhcmQgaW4gdGltZS4KICAgICAqCiAgICAgKiBUaGVyZSBhcmUgdHdvIG1vZGVzLiBUaGUgc2ltcGxlIG1vZGUgaXMgZml4ZWQgdGltZXN0ZXBwaW5nIHdpdGhvdXQgaW50ZXJwb2xhdGlvbi4gSW4gdGhpcyBjYXNlIHlvdSBvbmx5IHVzZSB0aGUgZmlyc3QgYXJndW1lbnQuIFRoZSBzZWNvbmQgY2FzZSB1c2VzIGludGVycG9sYXRpb24uIEluIHRoYXQgeW91IGFsc28gcHJvdmlkZSB0aGUgdGltZSBzaW5jZSB0aGUgZnVuY3Rpb24gd2FzIGxhc3QgdXNlZCwgYXMgd2VsbCBhcyB0aGUgbWF4aW11bSBmaXhlZCB0aW1lc3RlcHMgdG8gdGFrZS4KICAgICAqCiAgICAgKiBAcGFyYW0gZHQgVGhlIGZpeGVkIHRpbWUgc3RlcCBzaXplIHRvIHVzZS4KICAgICAqIEBwYXJhbSB0aW1lU2luY2VMYXN0Q2FsbGVkIFRoZSB0aW1lIGVsYXBzZWQgc2luY2UgdGhlIGZ1bmN0aW9uIHdhcyBsYXN0IGNhbGxlZC4KICAgICAqIEBwYXJhbSBtYXhTdWJTdGVwcyBNYXhpbXVtIG51bWJlciBvZiBmaXhlZCBzdGVwcyB0byB0YWtlIHBlciBmdW5jdGlvbiBjYWxsIChkZWZhdWx0OiAxMCkuCiAgICAgKiBAc2VlIGh0dHBzOi8vd2ViLmFyY2hpdmUub3JnL3dlYi8yMDE4MDQyNjE1NDUzMS9odHRwOi8vYnVsbGV0cGh5c2ljcy5vcmcvbWVkaWF3aWtpLTEuNS44L2luZGV4LnBocC9TdGVwcGluZ19UaGVfV29ybGQjV2hhdF9kb190aGVfcGFyYW1ldGVyc190b19idER5bmFtaWNzV29ybGQ6OnN0ZXBTaW11bGF0aW9uX21lYW4uM0YKICAgICAqIEBleGFtcGxlCiAgICAgKiAgICAgLy8gZml4ZWQgdGltZXN0ZXBwaW5nIHdpdGhvdXQgaW50ZXJwb2xhdGlvbgogICAgICogICAgIHdvcmxkLnN0ZXAoMSAvIDYwKQogICAgICovCgoKICAgIHN0ZXAoZHQsIHRpbWVTaW5jZUxhc3RDYWxsZWQsIG1heFN1YlN0ZXBzKSB7CiAgICAgIGlmIChtYXhTdWJTdGVwcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4U3ViU3RlcHMgPSAxMDsKICAgICAgfQoKICAgICAgaWYgKHRpbWVTaW5jZUxhc3RDYWxsZWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgIC8vIEZpeGVkLCBzaW1wbGUgc3RlcHBpbmcKICAgICAgICB0aGlzLmludGVybmFsU3RlcChkdCk7IC8vIEluY3JlbWVudCB0aW1lCgogICAgICAgIHRoaXMudGltZSArPSBkdDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFjY3VtdWxhdG9yICs9IHRpbWVTaW5jZUxhc3RDYWxsZWQ7CiAgICAgICAgY29uc3QgdDAgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgICBsZXQgc3Vic3RlcHMgPSAwOwoKICAgICAgICB3aGlsZSAodGhpcy5hY2N1bXVsYXRvciA+PSBkdCAmJiBzdWJzdGVwcyA8IG1heFN1YlN0ZXBzKSB7CiAgICAgICAgICAvLyBEbyBmaXhlZCBzdGVwcyB0byBjYXRjaCB1cAogICAgICAgICAgdGhpcy5pbnRlcm5hbFN0ZXAoZHQpOwogICAgICAgICAgdGhpcy5hY2N1bXVsYXRvciAtPSBkdDsKICAgICAgICAgIHN1YnN0ZXBzKys7CgogICAgICAgICAgaWYgKHBlcmZvcm1hbmNlLm5vdygpIC0gdDAgPiBkdCAqIDEwMDApIHsKICAgICAgICAgICAgLy8gVGhlIGZyYW1lcmF0ZSBpcyBub3QgaW50ZXJhY3RpdmUgYW55bW9yZS4KICAgICAgICAgICAgLy8gV2UgYXJlIGJlbG93IHRoZSB0YXJnZXQgZnJhbWVyYXRlLgogICAgICAgICAgICAvLyBCZXR0ZXIgYmFpbCBvdXQuCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0gLy8gUmVtb3ZlIHRoZSBleGNlc3MgYWNjdW11bGF0b3IsIHNpbmNlIHdlIG1heSBub3QKICAgICAgICAvLyBoYXZlIGhhZCBlbm91Z2ggc3Vic3RlcHMgYXZhaWxhYmxlIHRvIGNhdGNoIHVwCgoKICAgICAgICB0aGlzLmFjY3VtdWxhdG9yID0gdGhpcy5hY2N1bXVsYXRvciAlIGR0OwogICAgICAgIGNvbnN0IHQgPSB0aGlzLmFjY3VtdWxhdG9yIC8gZHQ7CgogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSB0aGlzLmJvZGllcy5sZW5ndGg7IGorKykgewogICAgICAgICAgY29uc3QgYiA9IHRoaXMuYm9kaWVzW2pdOwogICAgICAgICAgYi5wcmV2aW91c1Bvc2l0aW9uLmxlcnAoYi5wb3NpdGlvbiwgdCwgYi5pbnRlcnBvbGF0ZWRQb3NpdGlvbik7CiAgICAgICAgICBiLnByZXZpb3VzUXVhdGVybmlvbi5zbGVycChiLnF1YXRlcm5pb24sIHQsIGIuaW50ZXJwb2xhdGVkUXVhdGVybmlvbik7CiAgICAgICAgICBiLnByZXZpb3VzUXVhdGVybmlvbi5ub3JtYWxpemUoKTsKICAgICAgICB9CgogICAgICAgIHRoaXMudGltZSArPSB0aW1lU2luY2VMYXN0Q2FsbGVkOwogICAgICB9CiAgICB9CgogICAgaW50ZXJuYWxTdGVwKGR0KSB7CiAgICAgIHRoaXMuZHQgPSBkdDsKICAgICAgY29uc3QgY29udGFjdHMgPSB0aGlzLmNvbnRhY3RzOwogICAgICBjb25zdCBwMSA9IFdvcmxkX3N0ZXBfcDE7CiAgICAgIGNvbnN0IHAyID0gV29ybGRfc3RlcF9wMjsKICAgICAgY29uc3QgTiA9IHRoaXMuYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CiAgICAgIGNvbnN0IHNvbHZlciA9IHRoaXMuc29sdmVyOwogICAgICBjb25zdCBncmF2aXR5ID0gdGhpcy5ncmF2aXR5OwogICAgICBjb25zdCBkb1Byb2ZpbGluZyA9IHRoaXMuZG9Qcm9maWxpbmc7CiAgICAgIGNvbnN0IHByb2ZpbGUgPSB0aGlzLnByb2ZpbGU7CiAgICAgIGNvbnN0IERZTkFNSUMgPSBCb2R5LkRZTkFNSUM7CiAgICAgIGxldCBwcm9maWxpbmdTdGFydCA9IC1JbmZpbml0eTsKICAgICAgY29uc3QgY29uc3RyYWludHMgPSB0aGlzLmNvbnN0cmFpbnRzOwogICAgICBjb25zdCBmcmljdGlvbkVxdWF0aW9uUG9vbCA9IFdvcmxkX3N0ZXBfZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgIGdyYXZpdHkubGVuZ3RoKCk7CiAgICAgIGNvbnN0IGd4ID0gZ3Jhdml0eS54OwogICAgICBjb25zdCBneSA9IGdyYXZpdHkueTsKICAgICAgY29uc3QgZ3ogPSBncmF2aXR5Lno7CiAgICAgIGxldCBpID0gMDsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0gLy8gQWRkIGdyYXZpdHkgdG8gYWxsIG9iamVjdHMKCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLnR5cGUgPT09IERZTkFNSUMpIHsKICAgICAgICAgIC8vIE9ubHkgZm9yIGR5bmFtaWMgYm9kaWVzCiAgICAgICAgICBjb25zdCBmID0gYmkuZm9yY2U7CiAgICAgICAgICBjb25zdCBtID0gYmkubWFzczsKICAgICAgICAgIGYueCArPSBtICogZ3g7CiAgICAgICAgICBmLnkgKz0gbSAqIGd5OwogICAgICAgICAgZi56ICs9IG0gKiBnejsKICAgICAgICB9CiAgICAgIH0gLy8gVXBkYXRlIHN1YnN5c3RlbXMKCgogICAgICBmb3IgKGxldCBpID0gMCwgTnN1YnN5c3RlbXMgPSB0aGlzLnN1YnN5c3RlbXMubGVuZ3RoOyBpICE9PSBOc3Vic3lzdGVtczsgaSsrKSB7CiAgICAgICAgdGhpcy5zdWJzeXN0ZW1zW2ldLnVwZGF0ZSgpOwogICAgICB9IC8vIENvbGxpc2lvbiBkZXRlY3Rpb24KCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9CgogICAgICBwMS5sZW5ndGggPSAwOyAvLyBDbGVhbiB1cCBwYWlyIGFycmF5cyBmcm9tIGxhc3Qgc3RlcAoKICAgICAgcDIubGVuZ3RoID0gMDsKICAgICAgdGhpcy5icm9hZHBoYXNlLmNvbGxpc2lvblBhaXJzKHRoaXMsIHAxLCBwMik7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLmJyb2FkcGhhc2UgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFJlbW92ZSBjb25zdHJhaW5lZCBwYWlycyB3aXRoIGNvbGxpZGVDb25uZWN0ZWQgPT0gZmFsc2UKCgogICAgICBsZXQgTmNvbnN0cmFpbnRzID0gY29uc3RyYWludHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTmNvbnN0cmFpbnRzOyBpKyspIHsKICAgICAgICBjb25zdCBjID0gY29uc3RyYWludHNbaV07CgogICAgICAgIGlmICghYy5jb2xsaWRlQ29ubmVjdGVkKSB7CiAgICAgICAgICBmb3IgKGxldCBqID0gcDEubGVuZ3RoIC0gMTsgaiA+PSAwOyBqIC09IDEpIHsKICAgICAgICAgICAgaWYgKGMuYm9keUEgPT09IHAxW2pdICYmIGMuYm9keUIgPT09IHAyW2pdIHx8IGMuYm9keUIgPT09IHAxW2pdICYmIGMuYm9keUEgPT09IHAyW2pdKSB7CiAgICAgICAgICAgICAgcDEuc3BsaWNlKGosIDEpOwogICAgICAgICAgICAgIHAyLnNwbGljZShqLCAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhUaWNrKCk7IC8vIEdlbmVyYXRlIGNvbnRhY3RzCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9CgogICAgICBjb25zdCBvbGRjb250YWN0cyA9IFdvcmxkX3N0ZXBfb2xkQ29udGFjdHM7CiAgICAgIGNvbnN0IE5vbGRDb250YWN0cyA9IGNvbnRhY3RzLmxlbmd0aDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE5vbGRDb250YWN0czsgaSsrKSB7CiAgICAgICAgb2xkY29udGFjdHMucHVzaChjb250YWN0c1tpXSk7CiAgICAgIH0KCiAgICAgIGNvbnRhY3RzLmxlbmd0aCA9IDA7IC8vIFRyYW5zZmVyIEZyaWN0aW9uRXF1YXRpb24gZnJvbSBjdXJyZW50IGxpc3QgdG8gdGhlIHBvb2wgZm9yIHJldXNlCgogICAgICBjb25zdCBOb2xkRnJpY3Rpb25FcXVhdGlvbnMgPSB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE5vbGRGcmljdGlvbkVxdWF0aW9uczsgaSsrKSB7CiAgICAgICAgZnJpY3Rpb25FcXVhdGlvblBvb2wucHVzaCh0aGlzLmZyaWN0aW9uRXF1YXRpb25zW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9ucy5sZW5ndGggPSAwOwogICAgICB0aGlzLm5hcnJvd3BoYXNlLmdldENvbnRhY3RzKHAxLCBwMiwgdGhpcywgY29udGFjdHMsIG9sZGNvbnRhY3RzLCAvLyBUbyBiZSByZXVzZWQKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9ucywgZnJpY3Rpb25FcXVhdGlvblBvb2wpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5uYXJyb3dwaGFzZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gTG9vcCBvdmVyIGFsbCBjb2xsaXNpb25zCgoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfSAvLyBBZGQgYWxsIGZyaWN0aW9uIGVxcwoKCiAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKHRoaXMuZnJpY3Rpb25FcXVhdGlvbnNbaV0pOwogICAgICB9CgogICAgICBjb25zdCBuY29udGFjdHMgPSBjb250YWN0cy5sZW5ndGg7CgogICAgICBmb3IgKGxldCBrID0gMDsgayAhPT0gbmNvbnRhY3RzOyBrKyspIHsKICAgICAgICAvLyBDdXJyZW50IGNvbnRhY3QKICAgICAgICBjb25zdCBjID0gY29udGFjdHNba107IC8vIEdldCBjdXJyZW50IGNvbGxpc2lvbiBpbmRlY2VzCgogICAgICAgIGNvbnN0IGJpID0gYy5iaTsKICAgICAgICBjb25zdCBiaiA9IGMuYmo7CiAgICAgICAgY29uc3Qgc2kgPSBjLnNpOwogICAgICAgIGNvbnN0IHNqID0gYy5zajsgLy8gR2V0IGNvbGxpc2lvbiBwcm9wZXJ0aWVzCgogICAgICAgIGxldCBjbTsKCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBjbSA9IHRoaXMuZ2V0Q29udGFjdE1hdGVyaWFsKGJpLm1hdGVyaWFsLCBiai5tYXRlcmlhbCkgfHwgdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjbSA9IHRoaXMuZGVmYXVsdENvbnRhY3RNYXRlcmlhbDsKICAgICAgICB9IC8vIGMuZW5hYmxlZCA9IGJpLmNvbGxpc2lvblJlc3BvbnNlICYmIGJqLmNvbGxpc2lvblJlc3BvbnNlICYmIHNpLmNvbGxpc2lvblJlc3BvbnNlICYmIHNqLmNvbGxpc2lvblJlc3BvbnNlOwoKCiAgICAgICAgY20uZnJpY3Rpb247IC8vIGMucmVzdGl0dXRpb24gPSBjbS5yZXN0aXR1dGlvbjsKICAgICAgICAvLyBJZiBmcmljdGlvbiBvciByZXN0aXR1dGlvbiB3ZXJlIHNwZWNpZmllZCBpbiB0aGUgbWF0ZXJpYWwsIHVzZSB0aGVtCgogICAgICAgIGlmIChiaS5tYXRlcmlhbCAmJiBiai5tYXRlcmlhbCkgewogICAgICAgICAgaWYgKGJpLm1hdGVyaWFsLmZyaWN0aW9uID49IDAgJiYgYmoubWF0ZXJpYWwuZnJpY3Rpb24gPj0gMCkgewogICAgICAgICAgICBiaS5tYXRlcmlhbC5mcmljdGlvbiAqIGJqLm1hdGVyaWFsLmZyaWN0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChiaS5tYXRlcmlhbC5yZXN0aXR1dGlvbiA+PSAwICYmIGJqLm1hdGVyaWFsLnJlc3RpdHV0aW9uID49IDApIHsKICAgICAgICAgICAgYy5yZXN0aXR1dGlvbiA9IGJpLm1hdGVyaWFsLnJlc3RpdHV0aW9uICogYmoubWF0ZXJpYWwucmVzdGl0dXRpb247CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBjLnNldFNwb29rUGFyYW1zKAogICAgICAgIC8vICAgICAgICAgICBjbS5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MsCiAgICAgICAgLy8gICAgICAgICAgIGNtLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24sCiAgICAgICAgLy8gICAgICAgICAgIGR0CiAgICAgICAgLy8gICAgICAgKTsKCgogICAgICAgIHNvbHZlci5hZGRFcXVhdGlvbihjKTsgLy8gLy8gQWRkIGZyaWN0aW9uIGNvbnN0cmFpbnQgZXF1YXRpb24KICAgICAgICAvLyBpZihtdSA+IDApewogICAgICAgIC8vIAkvLyBDcmVhdGUgMiB0YW5nZW50IGVxdWF0aW9ucwogICAgICAgIC8vIAljb25zdCBtdWcgPSBtdSAqIGdub3JtOwogICAgICAgIC8vIAljb25zdCByZWR1Y2VkTWFzcyA9IChiaS5pbnZNYXNzICsgYmouaW52TWFzcyk7CiAgICAgICAgLy8gCWlmKHJlZHVjZWRNYXNzID4gMCl7CiAgICAgICAgLy8gCQlyZWR1Y2VkTWFzcyA9IDEvcmVkdWNlZE1hc3M7CiAgICAgICAgLy8gCX0KICAgICAgICAvLyAJY29uc3QgcG9vbCA9IGZyaWN0aW9uRXF1YXRpb25Qb29sOwogICAgICAgIC8vIAljb25zdCBjMSA9IHBvb2wubGVuZ3RoID8gcG9vbC5wb3AoKSA6IG5ldyBGcmljdGlvbkVxdWF0aW9uKGJpLGJqLG11ZypyZWR1Y2VkTWFzcyk7CiAgICAgICAgLy8gCWNvbnN0IGMyID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYmksYmosbXVnKnJlZHVjZWRNYXNzKTsKICAgICAgICAvLyAJdGhpcy5mcmljdGlvbkVxdWF0aW9ucy5wdXNoKGMxLCBjMik7CiAgICAgICAgLy8gCWMxLmJpID0gYzIuYmkgPSBiaTsKICAgICAgICAvLyAJYzEuYmogPSBjMi5iaiA9IGJqOwogICAgICAgIC8vIAljMS5taW5Gb3JjZSA9IGMyLm1pbkZvcmNlID0gLW11ZypyZWR1Y2VkTWFzczsKICAgICAgICAvLyAJYzEubWF4Rm9yY2UgPSBjMi5tYXhGb3JjZSA9IG11ZypyZWR1Y2VkTWFzczsKICAgICAgICAvLyAJLy8gQ29weSBvdmVyIHRoZSByZWxhdGl2ZSB2ZWN0b3JzCiAgICAgICAgLy8gCWMxLnJpLmNvcHkoYy5yaSk7CiAgICAgICAgLy8gCWMxLnJqLmNvcHkoYy5yaik7CiAgICAgICAgLy8gCWMyLnJpLmNvcHkoYy5yaSk7CiAgICAgICAgLy8gCWMyLnJqLmNvcHkoYy5yaik7CiAgICAgICAgLy8gCS8vIENvbnN0cnVjdCB0YW5nZW50cwogICAgICAgIC8vIAljLm5pLnRhbmdlbnRzKGMxLnQsIGMyLnQpOwogICAgICAgIC8vICAgICAgICAgICAvLyBTZXQgc3Bvb2sgcGFyYW1zCiAgICAgICAgLy8gICAgICAgICAgIGMxLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCBkdCk7CiAgICAgICAgLy8gICAgICAgICAgIGMyLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCBkdCk7CiAgICAgICAgLy8gICAgICAgICAgIGMxLmVuYWJsZWQgPSBjMi5lbmFibGVkID0gYy5lbmFibGVkOwogICAgICAgIC8vIAkvLyBBZGQgZXF1YXRpb25zIHRvIHNvbHZlcgogICAgICAgIC8vIAlzb2x2ZXIuYWRkRXF1YXRpb24oYzEpOwogICAgICAgIC8vIAlzb2x2ZXIuYWRkRXF1YXRpb24oYzIpOwogICAgICAgIC8vIH0KCiAgICAgICAgaWYgKGJpLmFsbG93U2xlZXAgJiYgYmkudHlwZSA9PT0gQm9keS5EWU5BTUlDICYmIGJpLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcgJiYgYmouc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBiai50eXBlICE9PSBCb2R5LlNUQVRJQykgewogICAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkQiA9IGJqLnZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKSArIGJqLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgICBjb25zdCBzcGVlZExpbWl0U3F1YXJlZEIgPSBiai5zbGVlcFNwZWVkTGltaXQgKiogMjsKCiAgICAgICAgICBpZiAoc3BlZWRTcXVhcmVkQiA+PSBzcGVlZExpbWl0U3F1YXJlZEIgKiAyKSB7CiAgICAgICAgICAgIGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGJqLmFsbG93U2xlZXAgJiYgYmoudHlwZSA9PT0gQm9keS5EWU5BTUlDICYmIGJqLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcgJiYgYmkuc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBiaS50eXBlICE9PSBCb2R5LlNUQVRJQykgewogICAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkQSA9IGJpLnZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKSArIGJpLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgICBjb25zdCBzcGVlZExpbWl0U3F1YXJlZEEgPSBiaS5zbGVlcFNwZWVkTGltaXQgKiogMjsKCiAgICAgICAgICBpZiAoc3BlZWRTcXVhcmVkQSA+PSBzcGVlZExpbWl0U3F1YXJlZEEgKiAyKSB7CiAgICAgICAgICAgIGJqLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0gLy8gTm93IHdlIGtub3cgdGhhdCBpIGFuZCBqIGFyZSBpbiBjb250YWN0LiBTZXQgY29sbGlzaW9uIG1hdHJpeCBzdGF0ZQoKCiAgICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0KGJpLCBiaiwgdHJ1ZSk7CgogICAgICAgIGlmICghdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cy5nZXQoYmksIGJqKSkgewogICAgICAgICAgLy8gRmlyc3QgY29udGFjdCEKICAgICAgICAgIC8vIFdlIHJldXNlIHRoZSBjb2xsaWRlRXZlbnQgb2JqZWN0LCBvdGhlcndpc2Ugd2Ugd2lsbCBlbmQgdXAgY3JlYXRpbmcgbmV3IG9iamVjdHMgZm9yIGVhY2ggbmV3IGNvbnRhY3QsIGV2ZW4gaWYgdGhlcmUncyBubyBldmVudCBsaXN0ZW5lciBhdHRhY2hlZC4KICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmJvZHkgPSBiajsKICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmNvbnRhY3QgPSBjOwogICAgICAgICAgYmkuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX2NvbGxpZGVFdmVudCk7CiAgICAgICAgICBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudC5ib2R5ID0gYmk7CiAgICAgICAgICBiai5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50KTsKICAgICAgICB9CgogICAgICAgIHRoaXMuYm9keU92ZXJsYXBLZWVwZXIuc2V0KGJpLmlkLCBiai5pZCk7CiAgICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIuc2V0KHNpLmlkLCBzai5pZCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZW1pdENvbnRhY3RFdmVudHMoKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUubWFrZUNvbnRhY3RDb25zdHJhaW50cyA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfSAvLyBXYWtlIHVwIGJvZGllcwoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSkgewogICAgICAgICAgYmkud2FrZVVwKCk7CiAgICAgICAgICBiaS53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9IC8vIEFkZCB1c2VyLWFkZGVkIGNvbnN0cmFpbnRzCgoKICAgICAgTmNvbnN0cmFpbnRzID0gY29uc3RyYWludHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTmNvbnN0cmFpbnRzOyBpKyspIHsKICAgICAgICBjb25zdCBjID0gY29uc3RyYWludHNbaV07CiAgICAgICAgYy51cGRhdGUoKTsKCiAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5lcSA9IGMuZXF1YXRpb25zLmxlbmd0aDsgaiAhPT0gTmVxOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGVxID0gYy5lcXVhdGlvbnNbal07CiAgICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24oZXEpOwogICAgICAgIH0KICAgICAgfSAvLyBTb2x2ZSB0aGUgY29uc3RyYWluZWQgc3lzdGVtCgoKICAgICAgc29sdmVyLnNvbHZlKGR0LCB0aGlzKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUuc29sdmUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFJlbW92ZSBhbGwgY29udGFjdHMgZnJvbSBzb2x2ZXIKCgogICAgICBzb2x2ZXIucmVtb3ZlQWxsRXF1YXRpb25zKCk7IC8vIEFwcGx5IGRhbXBpbmcsIHNlZSBodHRwOi8vY29kZS5nb29nbGUuY29tL3AvYnVsbGV0L2lzc3Vlcy9kZXRhaWw/aWQ9NzQgZm9yIGRldGFpbHMKCiAgICAgIGNvbnN0IHBvdyA9IE1hdGgucG93OwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS50eXBlICYgRFlOQU1JQykgewogICAgICAgICAgLy8gT25seSBmb3IgZHluYW1pYyBib2RpZXMKICAgICAgICAgIGNvbnN0IGxkID0gcG93KDEuMCAtIGJpLmxpbmVhckRhbXBpbmcsIGR0KTsKICAgICAgICAgIGNvbnN0IHYgPSBiaS52ZWxvY2l0eTsKICAgICAgICAgIHYuc2NhbGUobGQsIHYpOwogICAgICAgICAgY29uc3QgYXYgPSBiaS5hbmd1bGFyVmVsb2NpdHk7CgogICAgICAgICAgaWYgKGF2KSB7CiAgICAgICAgICAgIGNvbnN0IGFkID0gcG93KDEuMCAtIGJpLmFuZ3VsYXJEYW1waW5nLCBkdCk7CiAgICAgICAgICAgIGF2LnNjYWxlKGFkLCBhdik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9wcmVTdGVwRXZlbnQpOyAvLyBMZWFwIGZyb2cKICAgICAgLy8gdm5ldyA9IHYgKyBoKmYvbQogICAgICAvLyB4bmV3ID0geCArIGgqdm5ldwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfQoKICAgICAgY29uc3Qgc3RlcG51bWJlciA9IHRoaXMuc3RlcG51bWJlcjsKICAgICAgY29uc3QgcXVhdE5vcm1hbGl6ZSA9IHN0ZXBudW1iZXIgJSAodGhpcy5xdWF0Tm9ybWFsaXplU2tpcCArIDEpID09PSAwOwogICAgICBjb25zdCBxdWF0Tm9ybWFsaXplRmFzdCA9IHRoaXMucXVhdE5vcm1hbGl6ZUZhc3Q7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBib2RpZXNbaV0uaW50ZWdyYXRlKGR0LCBxdWF0Tm9ybWFsaXplLCBxdWF0Tm9ybWFsaXplRmFzdCk7CiAgICAgIH0KCiAgICAgIHRoaXMuY2xlYXJGb3JjZXMoKTsKICAgICAgdGhpcy5icm9hZHBoYXNlLmRpcnR5ID0gdHJ1ZTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUuaW50ZWdyYXRlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBVcGRhdGUgc3RlcCBudW1iZXIKCgogICAgICB0aGlzLnN0ZXBudW1iZXIgKz0gMTsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfcG9zdFN0ZXBFdmVudCk7IC8vIFNsZWVwaW5nIHVwZGF0ZQoKICAgICAgbGV0IGhhc0FjdGl2ZUJvZGllcyA9IHRydWU7CgogICAgICBpZiAodGhpcy5hbGxvd1NsZWVwKSB7CiAgICAgICAgaGFzQWN0aXZlQm9kaWVzID0gZmFsc2U7CgogICAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CiAgICAgICAgICBiaS5zbGVlcFRpY2sodGhpcy50aW1lKTsKCiAgICAgICAgICBpZiAoYmkuc2xlZXBTdGF0ZSAhPT0gQm9keS5TTEVFUElORykgewogICAgICAgICAgICBoYXNBY3RpdmVCb2RpZXMgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5oYXNBY3RpdmVCb2RpZXMgPSBoYXNBY3RpdmVCb2RpZXM7CiAgICB9CgogICAgZW1pdENvbnRhY3RFdmVudHMoKSB7CiAgICAgIGNvbnN0IGhhc0JlZ2luQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignYmVnaW5Db250YWN0Jyk7CiAgICAgIGNvbnN0IGhhc0VuZENvbnRhY3QgPSB0aGlzLmhhc0FueUV2ZW50TGlzdGVuZXIoJ2VuZENvbnRhY3QnKTsKCiAgICAgIGlmIChoYXNCZWdpbkNvbnRhY3QgfHwgaGFzRW5kQ29udGFjdCkgewogICAgICAgIHRoaXMuYm9keU92ZXJsYXBLZWVwZXIuZ2V0RGlmZihhZGRpdGlvbnMsIHJlbW92YWxzKTsKICAgICAgfQoKICAgICAgaWYgKGhhc0JlZ2luQ29udGFjdCkgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gYWRkaXRpb25zLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgYmVnaW5Db250YWN0RXZlbnQuYm9keUEgPSB0aGlzLmdldEJvZHlCeUlkKGFkZGl0aW9uc1tpXSk7CiAgICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QiA9IHRoaXMuZ2V0Qm9keUJ5SWQoYWRkaXRpb25zW2kgKyAxXSk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoYmVnaW5Db250YWN0RXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgYmVnaW5Db250YWN0RXZlbnQuYm9keUEgPSBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGlmIChoYXNFbmRDb250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSByZW1vdmFscy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QSA9IHRoaXMuZ2V0Qm9keUJ5SWQocmVtb3ZhbHNbaV0pOwogICAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlCID0gdGhpcy5nZXRCb2R5QnlJZChyZW1vdmFsc1tpICsgMV0pOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGVuZENvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUEgPSBlbmRDb250YWN0RXZlbnQuYm9keUIgPSBudWxsOwogICAgICB9CgogICAgICBhZGRpdGlvbnMubGVuZ3RoID0gcmVtb3ZhbHMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgaGFzQmVnaW5TaGFwZUNvbnRhY3QgPSB0aGlzLmhhc0FueUV2ZW50TGlzdGVuZXIoJ2JlZ2luU2hhcGVDb250YWN0Jyk7CiAgICAgIGNvbnN0IGhhc0VuZFNoYXBlQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignZW5kU2hhcGVDb250YWN0Jyk7CgogICAgICBpZiAoaGFzQmVnaW5TaGFwZUNvbnRhY3QgfHwgaGFzRW5kU2hhcGVDb250YWN0KSB7CiAgICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIuZ2V0RGlmZihhZGRpdGlvbnMsIHJlbW92YWxzKTsKICAgICAgfQoKICAgICAgaWYgKGhhc0JlZ2luU2hhcGVDb250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBhZGRpdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBjb25zdCBzaGFwZUEgPSB0aGlzLmdldFNoYXBlQnlJZChhZGRpdGlvbnNbaV0pOwogICAgICAgICAgY29uc3Qgc2hhcGVCID0gdGhpcy5nZXRTaGFwZUJ5SWQoYWRkaXRpb25zW2kgKyAxXSk7CiAgICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQSA9IHNoYXBlQTsKICAgICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gc2hhcGVCOwogICAgICAgICAgaWYgKHNoYXBlQSkgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IHNoYXBlQS5ib2R5OwogICAgICAgICAgaWYgKHNoYXBlQikgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IHNoYXBlQi5ib2R5OwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGJlZ2luU2hhcGVDb250YWN0RXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IGJlZ2luU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQSA9IGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKGhhc0VuZFNoYXBlQ29udGFjdCkgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gcmVtb3ZhbHMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBjb25zdCBzaGFwZUEgPSB0aGlzLmdldFNoYXBlQnlJZChyZW1vdmFsc1tpXSk7CiAgICAgICAgICBjb25zdCBzaGFwZUIgPSB0aGlzLmdldFNoYXBlQnlJZChyZW1vdmFsc1tpICsgMV0pOwogICAgICAgICAgZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gc2hhcGVBOwogICAgICAgICAgZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gc2hhcGVCOwogICAgICAgICAgaWYgKHNoYXBlQSkgZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUEgPSBzaGFwZUEuYm9keTsKICAgICAgICAgIGlmIChzaGFwZUIpIGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gc2hhcGVCLmJvZHk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZW5kU2hhcGVDb250YWN0RXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUEgPSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IGVuZFNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQSA9IGVuZFNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQiA9IG51bGw7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyBhbGwgYm9keSBmb3JjZXMgaW4gdGhlIHdvcmxkIHRvIHplcm8uCiAgICAgKi8KCgogICAgY2xlYXJGb3JjZXMoKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgIGIuZm9yY2U7CiAgICAgICAgYi50b3JxdWU7CiAgICAgICAgYi5mb3JjZS5zZXQoMCwgMCwgMCk7CiAgICAgICAgYi50b3JxdWUuc2V0KDAsIDAsIDApOwogICAgICB9CiAgICB9CgogIH0gLy8gVGVtcCBzdHVmZgoKICBuZXcgQUFCQigpOwogIGNvbnN0IHRtcFJheSA9IG5ldyBSYXkoKTsgLy8gcGVyZm9ybWFuY2Uubm93KCkgZmFsbGJhY2sgb24gRGF0ZS5ub3coKQoKICBjb25zdCBwZXJmb3JtYW5jZSA9IGdsb2JhbFRoaXMucGVyZm9ybWFuY2UgfHwge307CgogIGlmICghcGVyZm9ybWFuY2Uubm93KSB7CiAgICBsZXQgbm93T2Zmc2V0ID0gRGF0ZS5ub3coKTsKCiAgICBpZiAocGVyZm9ybWFuY2UudGltaW5nICYmIHBlcmZvcm1hbmNlLnRpbWluZy5uYXZpZ2F0aW9uU3RhcnQpIHsKICAgICAgbm93T2Zmc2V0ID0gcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydDsKICAgIH0KCiAgICBwZXJmb3JtYW5jZS5ub3cgPSAoKSA9PiBEYXRlLm5vdygpIC0gbm93T2Zmc2V0OwogIH0KCiAgbmV3IFZlYzMoKTsgLy8gRGlzcGF0Y2hlZCBhZnRlciB0aGUgd29ybGQgaGFzIHN0ZXBwZWQgZm9yd2FyZCBpbiB0aW1lLgogIC8vIFJldXNhYmxlIGV2ZW50IG9iamVjdHMgdG8gc2F2ZSBtZW1vcnkuCgogIGNvbnN0IFdvcmxkX3N0ZXBfcG9zdFN0ZXBFdmVudCA9IHsKICAgIHR5cGU6ICdwb3N0U3RlcCcKICB9OyAvLyBEaXNwYXRjaGVkIGJlZm9yZSB0aGUgd29ybGQgc3RlcHMgZm9yd2FyZCBpbiB0aW1lLgoKICBjb25zdCBXb3JsZF9zdGVwX3ByZVN0ZXBFdmVudCA9IHsKICAgIHR5cGU6ICdwcmVTdGVwJwogIH07CiAgY29uc3QgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQgPSB7CiAgICB0eXBlOiBCb2R5LkNPTExJREVfRVZFTlRfTkFNRSwKICAgIGJvZHk6IG51bGwsCiAgICBjb250YWN0OiBudWxsCiAgfTsgLy8gUG9vbHMgZm9yIHVudXNlZCBvYmplY3RzCgogIGNvbnN0IFdvcmxkX3N0ZXBfb2xkQ29udGFjdHMgPSBbXTsKICBjb25zdCBXb3JsZF9zdGVwX2ZyaWN0aW9uRXF1YXRpb25Qb29sID0gW107IC8vIFJldXNhYmxlIGFycmF5cyBmb3IgY29sbGlzaW9uIHBhaXJzCgogIGNvbnN0IFdvcmxkX3N0ZXBfcDEgPSBbXTsKICBjb25zdCBXb3JsZF9zdGVwX3AyID0gW107IC8vIFN0dWZmIGZvciBlbWl0Q29udGFjdEV2ZW50cwoKICBjb25zdCBhZGRpdGlvbnMgPSBbXTsKICBjb25zdCByZW1vdmFscyA9IFtdOwogIGNvbnN0IGJlZ2luQ29udGFjdEV2ZW50ID0gewogICAgdHlwZTogJ2JlZ2luQ29udGFjdCcsCiAgICBib2R5QTogbnVsbCwKICAgIGJvZHlCOiBudWxsCiAgfTsKICBjb25zdCBlbmRDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnZW5kQ29udGFjdCcsCiAgICBib2R5QTogbnVsbCwKICAgIGJvZHlCOiBudWxsCiAgfTsKICBjb25zdCBiZWdpblNoYXBlQ29udGFjdEV2ZW50ID0gewogICAgdHlwZTogJ2JlZ2luU2hhcGVDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwsCiAgICBzaGFwZUE6IG51bGwsCiAgICBzaGFwZUI6IG51bGwKICB9OwogIGNvbnN0IGVuZFNoYXBlQ29udGFjdEV2ZW50ID0gewogICAgdHlwZTogJ2VuZFNoYXBlQ29udGFjdCcsCiAgICBib2R5QTogbnVsbCwKICAgIGJvZHlCOiBudWxsLAogICAgc2hhcGVBOiBudWxsLAogICAgc2hhcGVCOiBudWxsCiAgfTsKCiAgY29uc3QgYWRkQ29udGFjdE1hdGVyaWFsID0gKHdvcmxkLCBjcmVhdGVNYXRlcmlhbCwgX3JlZiwgdXVpZCkgPT4gewogICAgbGV0IFttYXRlcmlhbEEsIG1hdGVyaWFsQiwgb3B0aW9uc10gPSBfcmVmOwogICAgY29uc3QgbWF0QSA9IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsQSk7CiAgICBjb25zdCBtYXRCID0gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWxCKTsKICAgIGNvbnN0IGNvbnRhY3RNYXRlcmlhbCA9IG5ldyBDb250YWN0TWF0ZXJpYWwobWF0QSwgbWF0Qiwgb3B0aW9ucyk7CiAgICBjb250YWN0TWF0ZXJpYWwudXVpZCA9IHV1aWQ7CiAgICB3b3JsZC5hZGRDb250YWN0TWF0ZXJpYWwoY29udGFjdE1hdGVyaWFsKTsKICB9OwogIGNvbnN0IHJlbW92ZUNvbnRhY3RNYXRlcmlhbCA9ICh3b3JsZCwgY21VVUlEKSA9PiB7CiAgICBjb25zdCBpbmRleCA9IHdvcmxkLmNvbnRhY3RtYXRlcmlhbHMuZmluZEluZGV4KF9yZWYyID0+IHsKICAgICAgbGV0IHsKICAgICAgICB1dWlkCiAgICAgIH0gPSBfcmVmMjsKICAgICAgcmV0dXJuIHV1aWQgPT09IGNtVVVJRDsKICAgIH0pOwogICAgY29uc3QgW3sKICAgICAgaWQ6IGkKICAgIH0sIHsKICAgICAgaWQ6IGoKICAgIH1dID0gd29ybGQuY29udGFjdG1hdGVyaWFsc1tpbmRleF0ubWF0ZXJpYWxzOwogICAgd29ybGQuY29udGFjdG1hdGVyaWFscy5zcGxpY2UoaW5kZXgsIDEpOwogICAgZGVsZXRlIHdvcmxkLmNvbnRhY3RNYXRlcmlhbFRhYmxlLmRhdGFbaSA8IGogPyBgJHtpfS0ke2p9YCA6IGAke2p9LSR7aX1gXTsKICB9OwoKICBsZXQgbWF0ZXJpYWxJZCA9IDA7CiAgY29uc3QgY3JlYXRlTWF0ZXJpYWxGYWN0b3J5ID0gbWF0ZXJpYWxzID0+IGZ1bmN0aW9uIChuYW1lT3JPcHRpb25zKSB7CiAgICBpZiAobmFtZU9yT3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgIG5hbWVPck9wdGlvbnMgPSB7fTsKICAgIH0KCiAgICBjb25zdCBtYXRlcmlhbE9wdGlvbnMgPSB0eXBlb2YgbmFtZU9yT3B0aW9ucyA9PT0gJ3N0cmluZycgPyB7CiAgICAgIG5hbWU6IG5hbWVPck9wdGlvbnMKICAgIH0gOiB7CiAgICAgIG5hbWU6IFN5bWJvbC5mb3IoYE1hdGVyaWFsJHttYXRlcmlhbElkKyt9YCksCiAgICAgIC4uLm5hbWVPck9wdGlvbnMKICAgIH07CiAgICBjb25zdCB7CiAgICAgIG5hbWUKICAgIH0gPSBtYXRlcmlhbE9wdGlvbnM7CiAgICBtYXRlcmlhbHNbbmFtZV0gPSBtYXRlcmlhbHNbbmFtZV0gfHwgbmV3IE1hdGVyaWFsKG1hdGVyaWFsT3B0aW9ucyk7CiAgICByZXR1cm4gbWF0ZXJpYWxzW25hbWVdOwogIH07CgogIC8qKgogICAqIEB0eXBlZGVmIHsgaW1wb3J0KCdjYW5ub24tZXMnKS5NYXRlcmlhbE9wdGlvbnMgfSBNYXRlcmlhbE9wdGlvbnMKICAgKi8KCiAgY29uc3QgbWFrZVZlYzMgPSBfcmVmID0+IHsKICAgIGxldCBbeCwgeSwgel0gPSBfcmVmOwogICAgcmV0dXJuIG5ldyBWZWMzKHgsIHksIHopOwogIH07CgogIGNvbnN0IHByZXBhcmVTcGhlcmUgPSBhcmdzID0+IEFycmF5LmlzQXJyYXkoYXJncykgPyBhcmdzIDogW2FyZ3NdOwoKICBjb25zdCBwcmVwYXJlQ29udmV4UG9seWhlZHJvbiA9IF9yZWYyID0+IHsKICAgIGxldCBbdiwgZmFjZXMsIG4sIGEsIGJvdW5kaW5nU3BoZXJlUmFkaXVzXSA9IF9yZWYyOwogICAgcmV0dXJuIFt7CiAgICAgIGF4ZXM6IGEgPyBhLm1hcChtYWtlVmVjMykgOiB1bmRlZmluZWQsCiAgICAgIGJvdW5kaW5nU3BoZXJlUmFkaXVzLAogICAgICBmYWNlcywKICAgICAgbm9ybWFsczogbiA/IG4ubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZCwKICAgICAgdmVydGljZXM6IHYgPyB2Lm1hcChtYWtlVmVjMykgOiB1bmRlZmluZWQKICAgIH1dOwogIH07CgogIGZ1bmN0aW9uIGNyZWF0ZVNoYXBlKHR5cGUsIGFyZ3MpIHsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlICdCb3gnOgogICAgICAgIHJldHVybiBuZXcgQm94KG5ldyBWZWMzKC4uLmFyZ3MubWFwKHYgPT4gdiAvIDIpKSk7CiAgICAgIC8vIGV4dGVudHMgPT4gaGFsZkV4dGVudHMKCiAgICAgIGNhc2UgJ0NvbnZleFBvbHloZWRyb24nOgogICAgICAgIHJldHVybiBuZXcgQ29udmV4UG9seWhlZHJvbiguLi5wcmVwYXJlQ29udmV4UG9seWhlZHJvbihhcmdzKSk7CgogICAgICBjYXNlICdDeWxpbmRlcic6CiAgICAgICAgcmV0dXJuIG5ldyBDeWxpbmRlciguLi5hcmdzKTsKICAgICAgLy8gWyByYWRpdXNUb3AsIHJhZGl1c0JvdHRvbSwgaGVpZ2h0LCBudW1TZWdtZW50cyBdID0gYXJncwoKICAgICAgY2FzZSAnSGVpZ2h0ZmllbGQnOgogICAgICAgIHJldHVybiBuZXcgSGVpZ2h0ZmllbGQoLi4uYXJncyk7CiAgICAgIC8vIFsgQXJyYXkgZGF0YSwgb3B0aW9uczoge21pblZhbHVlLCBtYXhWYWx1ZSwgZWxlbWVudFNpemV9ICBdID0gYXJncwoKICAgICAgY2FzZSAnUGFydGljbGUnOgogICAgICAgIHJldHVybiBuZXcgUGFydGljbGUoKTsKICAgICAgLy8gbm8gYXJncwoKICAgICAgY2FzZSAnUGxhbmUnOgogICAgICAgIHJldHVybiBuZXcgUGxhbmUoKTsKICAgICAgLy8gbm8gYXJncywgaW5maW5pdGUgeCBhbmQgeQoKICAgICAgY2FzZSAnU3BoZXJlJzoKICAgICAgICByZXR1cm4gbmV3IFNwaGVyZSguLi5wcmVwYXJlU3BoZXJlKGFyZ3MpKTsKICAgICAgLy8gcmFkaXVzID0gYXJncwoKICAgICAgY2FzZSAnVHJpbWVzaCc6CiAgICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKC4uLmFyZ3MpOwogICAgICAvLyBbdmVydGljZXMsIGluZGljZXNdID0gYXJncwogICAgfQogIH0KICAvKioKICAgKiBAZnVuY3Rpb24KICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnV1aWQKICAgKiBAcGFyYW0ge0JvZHlQcm9wc30gb3B0aW9ucy5wcm9wcwogICAqIEBwYXJhbSB7Qm9keVNoYXBlVHlwZX0gb3B0aW9ucy50eXBlCiAgICogQHBhcmFtIHsobWF0ZXJpYWxPcHRpb25zOiBNYXRlcmlhbE9wdGlvbnMpID0+IE1hdGVyaWFsID19IG9wdGlvbnMuY3JlYXRlTWF0ZXJpYWwKICAgKiBAcmV0dXJucyB7Qm9keX0KICAgKi8KCgogIGNvbnN0IHByb3BzVG9Cb2R5ID0gb3B0aW9ucyA9PiB7CiAgICBjb25zdCB7CiAgICAgIHV1aWQsCiAgICAgIHByb3BzLAogICAgICB0eXBlLAogICAgICBjcmVhdGVNYXRlcmlhbCA9IG1hdGVyaWFsT3B0aW9ucyA9PiBuZXcgTWF0ZXJpYWwobWF0ZXJpYWxPcHRpb25zKQogICAgfSA9IG9wdGlvbnM7CiAgICBjb25zdCB7CiAgICAgIGFuZ3VsYXJGYWN0b3IgPSBbMSwgMSwgMV0sCiAgICAgIGFuZ3VsYXJWZWxvY2l0eSA9IFswLCAwLCAwXSwKICAgICAgYXJncyA9IFtdLAogICAgICBjb2xsaXNpb25SZXNwb25zZSwKICAgICAgbGluZWFyRmFjdG9yID0gWzEsIDEsIDFdLAogICAgICBtYXNzLAogICAgICBtYXRlcmlhbCwKICAgICAgb25Db2xsaWRlLAogICAgICBwb3NpdGlvbiA9IFswLCAwLCAwXSwKICAgICAgcm90YXRpb24gPSBbMCwgMCwgMF0sCiAgICAgIHNoYXBlcywKICAgICAgdHlwZTogYm9keVR5cGUsCiAgICAgIHZlbG9jaXR5ID0gWzAsIDAsIDBdLAogICAgICAuLi5leHRyYQogICAgfSA9IHByb3BzOwogICAgY29uc3QgYm9keSA9IG5ldyBCb2R5KHsgLi4uZXh0cmEsCiAgICAgIG1hc3M6IGJvZHlUeXBlID09PSAnU3RhdGljJyA/IDAgOiBtYXNzLAogICAgICBtYXRlcmlhbDogbWF0ZXJpYWwgPyBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbCkgOiB1bmRlZmluZWQsCiAgICAgIHR5cGU6IGJvZHlUeXBlID8gQm9keVtib2R5VHlwZS50b1VwcGVyQ2FzZSgpXSA6IHVuZGVmaW5lZAogICAgfSk7CiAgICBib2R5LnV1aWQgPSB1dWlkOwoKICAgIGlmIChjb2xsaXNpb25SZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGJvZHkuY29sbGlzaW9uUmVzcG9uc2UgPSBjb2xsaXNpb25SZXNwb25zZTsKICAgIH0KCiAgICBpZiAodHlwZSA9PT0gJ0NvbXBvdW5kJykgewogICAgICBzaGFwZXMuZm9yRWFjaChfcmVmMyA9PiB7CiAgICAgICAgbGV0IHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBhcmdzLAogICAgICAgICAgcG9zaXRpb24sCiAgICAgICAgICByb3RhdGlvbiwKICAgICAgICAgIG1hdGVyaWFsLAogICAgICAgICAgLi4uZXh0cmEKICAgICAgICB9ID0gX3JlZjM7CiAgICAgICAgY29uc3Qgc2hhcGVCb2R5ID0gYm9keS5hZGRTaGFwZShjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSwgcG9zaXRpb24gPyBuZXcgVmVjMyguLi5wb3NpdGlvbikgOiB1bmRlZmluZWQsIHJvdGF0aW9uID8gbmV3IFF1YXRlcm5pb24oKS5zZXRGcm9tRXVsZXIoLi4ucm90YXRpb24pIDogdW5kZWZpbmVkKTsKICAgICAgICBpZiAobWF0ZXJpYWwpIHNoYXBlQm9keS5tYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsKTsKICAgICAgICBPYmplY3QuYXNzaWduKHNoYXBlQm9keSwgZXh0cmEpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGJvZHkuYWRkU2hhcGUoY3JlYXRlU2hhcGUodHlwZSwgYXJncykpOwogICAgfQoKICAgIGJvZHkucG9zaXRpb24uc2V0KHBvc2l0aW9uWzBdLCBwb3NpdGlvblsxXSwgcG9zaXRpb25bMl0pOwogICAgYm9keS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcihyb3RhdGlvblswXSwgcm90YXRpb25bMV0sIHJvdGF0aW9uWzJdKTsKICAgIGJvZHkudmVsb2NpdHkuc2V0KHZlbG9jaXR5WzBdLCB2ZWxvY2l0eVsxXSwgdmVsb2NpdHlbMl0pOwogICAgYm9keS5hbmd1bGFyVmVsb2NpdHkuc2V0KGFuZ3VsYXJWZWxvY2l0eVswXSwgYW5ndWxhclZlbG9jaXR5WzFdLCBhbmd1bGFyVmVsb2NpdHlbMl0pOwogICAgYm9keS5saW5lYXJGYWN0b3Iuc2V0KGxpbmVhckZhY3RvclswXSwgbGluZWFyRmFjdG9yWzFdLCBsaW5lYXJGYWN0b3JbMl0pOwogICAgYm9keS5hbmd1bGFyRmFjdG9yLnNldChhbmd1bGFyRmFjdG9yWzBdLCBhbmd1bGFyRmFjdG9yWzFdLCBhbmd1bGFyRmFjdG9yWzJdKTsKICAgIHJldHVybiBib2R5OwogIH07CgogIGNvbnN0IGFkZEJvZGllcyA9IChzdGF0ZSwgY3JlYXRlTWF0ZXJpYWwsIF9yZWYpID0+IHsKICAgIGxldCB7CiAgICAgIHByb3BzLAogICAgICB0eXBlLAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgYm9keSA9IHByb3BzVG9Cb2R5KHsKICAgICAgICBjcmVhdGVNYXRlcmlhbCwKICAgICAgICBwcm9wczogcHJvcHNbaV0sCiAgICAgICAgdHlwZSwKICAgICAgICB1dWlkOiB1dWlkW2ldCiAgICAgIH0pOwogICAgICBzdGF0ZS53b3JsZC5hZGRCb2R5KGJvZHkpOwogICAgICBpZiAocHJvcHNbaV0ub25Db2xsaWRlKSBib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbGxpZGUnLCBfcmVmMiA9PiB7CiAgICAgICAgbGV0IHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBib2R5LAogICAgICAgICAgdGFyZ2V0LAogICAgICAgICAgY29udGFjdAogICAgICAgIH0gPSBfcmVmMjsKICAgICAgICBpZiAoIWJvZHkudXVpZCB8fCAhdGFyZ2V0LnV1aWQpIHJldHVybjsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBuaSwKICAgICAgICAgIHJpLAogICAgICAgICAgcmosCiAgICAgICAgICBiaSwKICAgICAgICAgIGJqLAogICAgICAgICAgaWQKICAgICAgICB9ID0gY29udGFjdDsKICAgICAgICBjb25zdCBjb250YWN0UG9pbnQgPSBiaS5wb3NpdGlvbi52YWRkKHJpKTsKICAgICAgICBjb25zdCBjb250YWN0Tm9ybWFsID0gYmkgPT09IGJvZHkgPyBuaSA6IG5pLnNjYWxlKC0xKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIGJvZHk6IGJvZHkudXVpZCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlcnM6IHsKICAgICAgICAgICAgYm9keUZpbHRlckdyb3VwOiBib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICBib2R5RmlsdGVyTWFzazogYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJHcm91cDogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJNYXNrOiB0YXJnZXQuY29sbGlzaW9uRmlsdGVyTWFzawogICAgICAgICAgfSwKICAgICAgICAgIGNvbnRhY3Q6IHsKICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiB1c2UgaWQgaW5zdGVhZCBvZiB1dWlkCiAgICAgICAgICAgIGJpOiBiaS51dWlkLAogICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IHVzZSBpZCBpbnN0ZWFkIG9mIHV1aWQKICAgICAgICAgICAgYmo6IGJqLnV1aWQsCiAgICAgICAgICAgIC8vIE5vcm1hbCBvZiB0aGUgY29udGFjdCwgcmVsYXRpdmUgdG8gdGhlIGNvbGxpZGluZyBib2R5CiAgICAgICAgICAgIGNvbnRhY3ROb3JtYWw6IGNvbnRhY3ROb3JtYWwudG9BcnJheSgpLAogICAgICAgICAgICAvLyBXb3JsZCBwb3NpdGlvbiBvZiB0aGUgY29udGFjdAogICAgICAgICAgICBjb250YWN0UG9pbnQ6IGNvbnRhY3RQb2ludC50b0FycmF5KCksCiAgICAgICAgICAgIGlkLAogICAgICAgICAgICBpbXBhY3RWZWxvY2l0eTogY29udGFjdC5nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsKCksCiAgICAgICAgICAgIG5pOiBuaS50b0FycmF5KCksCiAgICAgICAgICAgIHJpOiByaS50b0FycmF5KCksCiAgICAgICAgICAgIHJqOiByai50b0FycmF5KCkKICAgICAgICAgIH0sCiAgICAgICAgICBvcDogJ2V2ZW50JywKICAgICAgICAgIHRhcmdldDogdGFyZ2V0LnV1aWQsCiAgICAgICAgICB0eXBlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH07CgogIGNvbnN0IHRyaXBsZXRUb1ZlYzMgPSB0ID0+IHQgPyBuZXcgVmVjMyguLi50KSA6IHVuZGVmaW5lZDsKCiAgY29uc3QgYWRkQ29uc3RyYWludCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IFtib2R5QSwgYm9keUIsIHsKICAgICAgICBhbmdsZSwKICAgICAgICBheGlzQSwKICAgICAgICBheGlzQiwKICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgIGRpc3RhbmNlLAogICAgICAgIG1heEZvcmNlLAogICAgICAgIG1heE11bHRpcGxpZXIsCiAgICAgICAgcGl2b3RBLAogICAgICAgIHBpdm90QiwKICAgICAgICB0d2lzdEFuZ2xlLAogICAgICAgIHdha2VVcEJvZGllcwogICAgICB9XSwKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBsZXQgY29uc3RyYWludDsKCiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnUG9pbnRUb1BvaW50JzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IFBvaW50VG9Qb2ludENvbnN0cmFpbnQoc3RhdGUuYm9kaWVzW2JvZHlBXSwgdHJpcGxldFRvVmVjMyhwaXZvdEEpLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB0cmlwbGV0VG9WZWMzKHBpdm90QiksIG1heEZvcmNlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ0NvbmVUd2lzdCc6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBDb25lVHdpc3RDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIGFuZ2xlLAogICAgICAgICAgYXhpc0E6IHRyaXBsZXRUb1ZlYzMoYXhpc0EpLAogICAgICAgICAgYXhpc0I6IHRyaXBsZXRUb1ZlYzMoYXhpc0IpLAogICAgICAgICAgY29sbGlkZUNvbm5lY3RlZCwKICAgICAgICAgIG1heEZvcmNlLAogICAgICAgICAgcGl2b3RBOiB0cmlwbGV0VG9WZWMzKHBpdm90QSksCiAgICAgICAgICBwaXZvdEI6IHRyaXBsZXRUb1ZlYzMocGl2b3RCKSwKICAgICAgICAgIHR3aXN0QW5nbGUKICAgICAgICB9KTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ0hpbmdlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IEhpbmdlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBheGlzQTogdHJpcGxldFRvVmVjMyhheGlzQSksCiAgICAgICAgICBheGlzQjogdHJpcGxldFRvVmVjMyhheGlzQiksCiAgICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgICAgbWF4Rm9yY2UsCiAgICAgICAgICBwaXZvdEE6IHRyaXBsZXRUb1ZlYzMocGl2b3RBKSwKICAgICAgICAgIHBpdm90QjogdHJpcGxldFRvVmVjMyhwaXZvdEIpCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdEaXN0YW5jZSc6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBEaXN0YW5jZUNvbnN0cmFpbnQoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgZGlzdGFuY2UsIG1heEZvcmNlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ0xvY2snOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgTG9ja0NvbnN0cmFpbnQoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICAgICAgbWF4Rm9yY2UKICAgICAgICB9KTsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICB3YWtlVXBCb2RpZXMKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgIH0KCiAgICBjb25zdHJhaW50LnV1aWQgPSB1dWlkOwogICAgc3RhdGUud29ybGQuYWRkQ29uc3RyYWludChjb25zdHJhaW50KTsKCiAgICBpZiAobWF4TXVsdGlwbGllciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGNvbnN0IHBvc3RTdGVwQ29uc3RyYWludCA9ICgpID0+IHsKICAgICAgICAvLyBUaGUgbXVsdGlwbGllciBpcyBwcm9wb3J0aW9uYWwgdG8gaG93IG11Y2ggZm9yY2UgaXMgYWRkZWQgdG8gdGhlIGJvZGllcyBieSB0aGUgY29uc3RyYWludC4KICAgICAgICAvLyBJZiB0aGlzIGV4Y2VlZHMgYSBsaW1pdCB0aGUgY29uc3RyYWludCBpcyBkaXNhYmxlZC4KICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gTWF0aC5hYnMoY29uc3RyYWludC5lcXVhdGlvbnNbMF0ubXVsdGlwbGllcik7CgogICAgICAgIGlmIChtdWx0aXBsaWVyID4gbWF4TXVsdGlwbGllcikgewogICAgICAgICAgY29uc3RyYWludC5kaXNhYmxlKCk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgc3RhdGUuY29uc3RyYWludHNbdXVpZF0gPSBwb3N0U3RlcENvbnN0cmFpbnQ7CiAgICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuY29uc3RyYWludHNbdXVpZF0pOwogICAgfQogIH07CgogIGZ1bmN0aW9uIHRvVXBwZXJjYXNlKHN0cikgewogICAgcmV0dXJuIHN0ci50b1VwcGVyQ2FzZSgpOwogIH0KCiAgY29uc3QgYWRkUmF5ID0gKHN0YXRlLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wczogewogICAgICAgIGZyb20sCiAgICAgICAgbW9kZSwKICAgICAgICB0bywKICAgICAgICAuLi5yYXlPcHRpb25zCiAgICAgIH0sCiAgICAgIHV1aWQKICAgIH0gPSBfcmVmOwogICAgY29uc3QgcmF5ID0gbmV3IFJheSh0cmlwbGV0VG9WZWMzKGZyb20pLCB0cmlwbGV0VG9WZWMzKHRvKSk7CiAgICBjb25zdCBvcHRpb25zID0gewogICAgICBtb2RlOiBSQVlfTU9ERVNbdG9VcHBlcmNhc2UobW9kZSldLAogICAgICByZXN1bHQ6IG5ldyBSYXljYXN0UmVzdWx0KCksCiAgICAgIC4uLnJheU9wdGlvbnMKICAgIH07CgogICAgc3RhdGUucmF5c1t1dWlkXSA9ICgpID0+IHsKICAgICAgcmF5LmludGVyc2VjdFdvcmxkKHN0YXRlLndvcmxkLCBvcHRpb25zKTsKICAgICAgaWYgKCFvcHRpb25zLnJlc3VsdCB8fCAhb3B0aW9ucy5yZXN1bHQuYm9keSkgcmV0dXJuOwogICAgICBjb25zdCB7CiAgICAgICAgYm9keSwKICAgICAgICBzaGFwZSwKICAgICAgICByYXlGcm9tV29ybGQsCiAgICAgICAgcmF5VG9Xb3JsZCwKICAgICAgICBoaXROb3JtYWxXb3JsZCwKICAgICAgICBoaXRQb2ludFdvcmxkLAogICAgICAgIC4uLnJlc3QKICAgICAgfSA9IG9wdGlvbnMucmVzdWx0OwogICAgICBjb25zdCBib2R5VVVJRCA9IGJvZHkudXVpZDsKICAgICAgaWYgKCFib2R5VVVJRCkgcmV0dXJuOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBib2R5OiBib2R5VVVJRCwKICAgICAgICBoaXROb3JtYWxXb3JsZDogaGl0Tm9ybWFsV29ybGQudG9BcnJheSgpLAogICAgICAgIGhpdFBvaW50V29ybGQ6IGhpdFBvaW50V29ybGQudG9BcnJheSgpLAogICAgICAgIG9wOiAnZXZlbnQnLAogICAgICAgIHJheTogewogICAgICAgICAgY29sbGlzaW9uRmlsdGVyR3JvdXA6IHJheS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlck1hc2s6IHJheS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgZGlyZWN0aW9uOiByYXkuZGlyZWN0aW9uLnRvQXJyYXkoKSwKICAgICAgICAgIGZyb20sCiAgICAgICAgICB0bywKICAgICAgICAgIHV1aWQKICAgICAgICB9LAogICAgICAgIHJheUZyb21Xb3JsZDogcmF5RnJvbVdvcmxkLnRvQXJyYXkoKSwKICAgICAgICByYXlUb1dvcmxkOiByYXlUb1dvcmxkLnRvQXJyYXkoKSwKICAgICAgICBzaGFwZTogc2hhcGUgPyB7IC4uLnNoYXBlLAogICAgICAgICAgYm9keTogYm9keVVVSUQKICAgICAgICB9IDogbnVsbCwKICAgICAgICB0eXBlOiAncmF5aGl0JywKICAgICAgICAuLi5yZXN0CiAgICAgIH0pOwogICAgfTsKCiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgc3RhdGUucmF5c1t1dWlkXSk7CiAgfTsKCiAgY29uc3QgYWRkUmF5Y2FzdFZlaGljbGUgPSAoc3RhdGUsIGRhdGEpID0+IHsKICAgIGNvbnN0IFtjaGFzc2lzQm9keSwgd2hlZWxzLCB3aGVlbEluZm9zLCBpbmRleEZvcndhcmRBeGlzLCBpbmRleFJpZ2h0QXhpcywgaW5kZXhVcEF4aXNdID0gZGF0YS5wcm9wczsKICAgIGNvbnN0IHZlaGljbGUgPSBuZXcgUmF5Y2FzdFZlaGljbGUoewogICAgICBjaGFzc2lzQm9keTogc3RhdGUuYm9kaWVzW2NoYXNzaXNCb2R5XSwKICAgICAgaW5kZXhGb3J3YXJkQXhpcywKICAgICAgaW5kZXhSaWdodEF4aXMsCiAgICAgIGluZGV4VXBBeGlzCiAgICB9KTsKICAgIHZlaGljbGUud29ybGQgPSBzdGF0ZS53b3JsZDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdoZWVsSW5mb3MubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgewogICAgICAgIGF4bGVMb2NhbCwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwsCiAgICAgICAgZGlyZWN0aW9uTG9jYWwsCiAgICAgICAgLi4ucmVzdAogICAgICB9ID0gd2hlZWxJbmZvc1tpXTsKICAgICAgdmVoaWNsZS5hZGRXaGVlbCh7CiAgICAgICAgYXhsZUxvY2FsOiB0cmlwbGV0VG9WZWMzKGF4bGVMb2NhbCksCiAgICAgICAgY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsOiB0cmlwbGV0VG9WZWMzKGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCksCiAgICAgICAgZGlyZWN0aW9uTG9jYWw6IHRyaXBsZXRUb1ZlYzMoZGlyZWN0aW9uTG9jYWwpLAogICAgICAgIC4uLnJlc3QKICAgICAgfSk7CiAgICB9CgogICAgY29uc3QgcHJlU3RlcCA9ICgpID0+IHsKICAgICAgdmVoaWNsZS51cGRhdGVWZWhpY2xlKHN0YXRlLndvcmxkLmR0KTsKICAgIH07CgogICAgY29uc3QgcG9zdFN0ZXAgPSAoKSA9PiB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVoaWNsZS53aGVlbEluZm9zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmVoaWNsZS51cGRhdGVXaGVlbFRyYW5zZm9ybShpKTsKICAgICAgICBjb25zdCB0ID0gdmVoaWNsZS53aGVlbEluZm9zW2ldLndvcmxkVHJhbnNmb3JtOwogICAgICAgIGNvbnN0IHdoZWVsQm9keSA9IHN0YXRlLmJvZGllc1t3aGVlbHNbaV1dOwogICAgICAgIHdoZWVsQm9keS5wb3NpdGlvbi5jb3B5KHQucG9zaXRpb24pOwogICAgICAgIHdoZWVsQm9keS5xdWF0ZXJuaW9uLmNvcHkodC5xdWF0ZXJuaW9uKTsKICAgICAgfQogICAgfTsKCiAgICBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdID0gewogICAgICBwb3N0U3RlcCwKICAgICAgcHJlU3RlcCwKICAgICAgdmVoaWNsZQogICAgfTsKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBwcmVTdGVwKTsKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgcG9zdFN0ZXApOwogIH07CgogIGNvbnN0IGFkZFNwcmluZyA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IFtib2R5QSwgYm9keUIsIHsKICAgICAgICBkYW1waW5nLAogICAgICAgIGxvY2FsQW5jaG9yQSwKICAgICAgICBsb2NhbEFuY2hvckIsCiAgICAgICAgcmVzdExlbmd0aCwKICAgICAgICBzdGlmZm5lc3MsCiAgICAgICAgd29ybGRBbmNob3JBLAogICAgICAgIHdvcmxkQW5jaG9yQgogICAgICB9XSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBjb25zdCBzcHJpbmcgPSBuZXcgU3ByaW5nKHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgZGFtcGluZywKICAgICAgbG9jYWxBbmNob3JBOiB0cmlwbGV0VG9WZWMzKGxvY2FsQW5jaG9yQSksCiAgICAgIGxvY2FsQW5jaG9yQjogdHJpcGxldFRvVmVjMyhsb2NhbEFuY2hvckIpLAogICAgICByZXN0TGVuZ3RoLAogICAgICBzdGlmZm5lc3MsCiAgICAgIHdvcmxkQW5jaG9yQTogdHJpcGxldFRvVmVjMyh3b3JsZEFuY2hvckEpLAogICAgICB3b3JsZEFuY2hvckI6IHRyaXBsZXRUb1ZlYzMod29ybGRBbmNob3JCKQogICAgfSk7CiAgICBzcHJpbmcudXVpZCA9IHV1aWQ7CgogICAgY29uc3QgcG9zdFN0ZXBTcHJpbmcgPSAoKSA9PiBzcHJpbmcuYXBwbHlGb3JjZSgpOwoKICAgIHN0YXRlLnNwcmluZ3NbdXVpZF0gPSBwb3N0U3RlcFNwcmluZzsKICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1t1dWlkXSA9IHNwcmluZzsgLy8gQ29tcHV0ZSB0aGUgZm9yY2UgYWZ0ZXIgZWFjaCBzdGVwCgogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5zcHJpbmdzW3V1aWRdKTsKICB9OwoKICBmdW5jdGlvbiBlbWl0QmVnaW5Db250YWN0KF9yZWYpIHsKICAgIGxldCB7CiAgICAgIGJvZHlBLAogICAgICBib2R5QgogICAgfSA9IF9yZWY7CiAgICBpZiAoIShib2R5QSAhPSBudWxsICYmIGJvZHlBLnV1aWQpIHx8ICEoYm9keUIgIT0gbnVsbCAmJiBib2R5Qi51dWlkKSkgcmV0dXJuOwogICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgIGJvZHlBOiBib2R5QS51dWlkLAogICAgICBib2R5QjogYm9keUIudXVpZCwKICAgICAgb3A6ICdldmVudCcsCiAgICAgIHR5cGU6ICdjb2xsaWRlQmVnaW4nCiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGVtaXRFbmRDb250YWN0KF9yZWYyKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmMjsKICAgIGlmICghKGJvZHlBICE9IG51bGwgJiYgYm9keUEudXVpZCkgfHwgIShib2R5QiAhPSBudWxsICYmIGJvZHlCLnV1aWQpKSByZXR1cm47CiAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgYm9keUE6IGJvZHlBLnV1aWQsCiAgICAgIGJvZHlCOiBib2R5Qi51dWlkLAogICAgICBvcDogJ2V2ZW50JywKICAgICAgdHlwZTogJ2NvbGxpZGVFbmQnCiAgICB9KTsKICB9CgogIGNvbnN0IGluaXQgPSAod29ybGQsIF9yZWYzKSA9PiB7CiAgICBsZXQgewogICAgICBhbGxvd1NsZWVwLAogICAgICBheGlzSW5kZXggPSAwLAogICAgICBicm9hZHBoYXNlLAogICAgICBkZWZhdWx0Q29udGFjdE1hdGVyaWFsLAogICAgICBmcmljdGlvbkdyYXZpdHksCiAgICAgIGdyYXZpdHksCiAgICAgIGl0ZXJhdGlvbnMsCiAgICAgIHF1YXROb3JtYWxpemVGYXN0LAogICAgICBxdWF0Tm9ybWFsaXplU2tpcCwKICAgICAgc29sdmVyLAogICAgICB0b2xlcmFuY2UKICAgIH0gPSBfcmVmMzsKICAgIHdvcmxkLmFsbG93U2xlZXAgPSBhbGxvd1NsZWVwOwogICAgd29ybGQuZ3Jhdml0eS5zZXQoLi4uZ3Jhdml0eSk7CiAgICB3b3JsZC5mcmljdGlvbkdyYXZpdHkgPSBmcmljdGlvbkdyYXZpdHkgPyBuZXcgVmVjMyguLi5mcmljdGlvbkdyYXZpdHkpIDogdW5kZWZpbmVkOwogICAgd29ybGQucXVhdE5vcm1hbGl6ZUZhc3QgPSBxdWF0Tm9ybWFsaXplRmFzdDsKICAgIHdvcmxkLnF1YXROb3JtYWxpemVTa2lwID0gcXVhdE5vcm1hbGl6ZVNraXA7CgogICAgaWYgKHNvbHZlciA9PT0gJ1NwbGl0JykgewogICAgICB3b3JsZC5zb2x2ZXIgPSBuZXcgU3BsaXRTb2x2ZXIobmV3IEdTU29sdmVyKCkpOwogICAgfQoKICAgIGlmICh3b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICB3b3JsZC5zb2x2ZXIudG9sZXJhbmNlID0gdG9sZXJhbmNlOwogICAgICB3b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGl0ZXJhdGlvbnM7CiAgICB9CgogICAgd29ybGQuYnJvYWRwaGFzZSA9IGJyb2FkcGhhc2UgPT09ICdTQVAnID8gbmV3IFNBUEJyb2FkcGhhc2Uod29ybGQpIDogbmV3IE5haXZlQnJvYWRwaGFzZSgpOwoKICAgIGlmICh3b3JsZC5icm9hZHBoYXNlIGluc3RhbmNlb2YgU0FQQnJvYWRwaGFzZSkgewogICAgICB3b3JsZC5icm9hZHBoYXNlLmF4aXNJbmRleCA9IGF4aXNJbmRleDsKICAgIH0KCiAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnLCBlbWl0QmVnaW5Db250YWN0KTsKICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZENvbnRhY3QnLCBlbWl0RW5kQ29udGFjdCk7CiAgICBPYmplY3QuYXNzaWduKHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwsIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwpOwogIH07CgogIGNvbnN0IGlzUW9yViA9IHYgPT4gdiBpbnN0YW5jZW9mIFF1YXRlcm5pb24gfHwgdiBpbnN0YW5jZW9mIFZlYzM7CgogIGNvbnN0IHN0ZXAgPSAoc3RhdGUsIF9yZWYpID0+IHsKICAgIGxldCB7CiAgICAgIHBvc2l0aW9ucywKICAgICAgcHJvcHM6IHsKICAgICAgICBtYXhTdWJTdGVwcywKICAgICAgICBzdGVwU2l6ZSwKICAgICAgICB0aW1lU2luY2VMYXN0Q2FsbGVkCiAgICAgIH0sCiAgICAgIHF1YXRlcm5pb25zCiAgICB9ID0gX3JlZjsKICAgIHN0YXRlLndvcmxkLnN0ZXAoc3RlcFNpemUsIHRpbWVTaW5jZUxhc3RDYWxsZWQsIG1heFN1YlN0ZXBzKTsKCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0YXRlLndvcmxkLmJvZGllcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICBjb25zdCBwID0gc3RhdGUud29ybGQuYm9kaWVzW2ldLnBvc2l0aW9uOwogICAgICBjb25zdCBxID0gc3RhdGUud29ybGQuYm9kaWVzW2ldLnF1YXRlcm5pb247CiAgICAgIHBvc2l0aW9uc1szICogaSArIDBdID0gcC54OwogICAgICBwb3NpdGlvbnNbMyAqIGkgKyAxXSA9IHAueTsKICAgICAgcG9zaXRpb25zWzMgKiBpICsgMl0gPSBwLno7CiAgICAgIHF1YXRlcm5pb25zWzQgKiBpICsgMF0gPSBxLng7CiAgICAgIHF1YXRlcm5pb25zWzQgKiBpICsgMV0gPSBxLnk7CiAgICAgIHF1YXRlcm5pb25zWzQgKiBpICsgMl0gPSBxLno7CiAgICAgIHF1YXRlcm5pb25zWzQgKiBpICsgM10gPSBxLnc7CiAgICB9CgogICAgY29uc3Qgb2JzZXJ2YXRpb25zID0gW107CgogICAgZm9yIChjb25zdCBpZCBvZiBPYmplY3Qua2V5cyhzdGF0ZS5zdWJzY3JpcHRpb25zKSkgewogICAgICBjb25zdCBbdXVpZCwgdHlwZSwgdGFyZ2V0ID0gJ2JvZGllcyddID0gc3RhdGUuc3Vic2NyaXB0aW9uc1tpZF07CiAgICAgIGNvbnN0IHsKICAgICAgICBib2RpZXMsCiAgICAgICAgdmVoaWNsZXMKICAgICAgfSA9IHN0YXRlOwogICAgICBjb25zdCB2YWx1ZSA9IHRhcmdldCA9PT0gJ3ZlaGljbGVzJyA/IC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogRGlmZmVyZW50aWF0ZSB0aGVzZSAidHlwZXMiCiAgICAgIHZlaGljbGVzW3V1aWRdLnZlaGljbGVbdHlwZV0gOiAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IERpZmZlcmVudGlhdGUgdGhlc2UgInR5cGVzIgogICAgICBib2RpZXNbdXVpZF1bdHlwZV07CiAgICAgIGNvbnN0IHNlcmlhbGl6YWJsZVZhbHVlID0gaXNRb3JWKHZhbHVlKSA/IHZhbHVlLnRvQXJyYXkoKSA6IHZhbHVlOwogICAgICBvYnNlcnZhdGlvbnMucHVzaChbTnVtYmVyKGlkKSwgc2VyaWFsaXphYmxlVmFsdWUsIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogRGlmZmVyZW50aWF0ZSB0aGVzZSAidHlwZXMiCiAgICAgIHR5cGVdKTsKICAgIH0KCiAgICBjb25zdCBtZXNzYWdlID0gewogICAgICBhY3RpdmU6IHN0YXRlLndvcmxkLmhhc0FjdGl2ZUJvZGllcywKICAgICAgb2JzZXJ2YXRpb25zLAogICAgICBvcDogJ2ZyYW1lJywKICAgICAgcG9zaXRpb25zLAogICAgICBxdWF0ZXJuaW9ucwogICAgfTsKCiAgICBpZiAoc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcpIHsKICAgICAgbWVzc2FnZS5ib2RpZXMgPSBzdGF0ZS53b3JsZC5ib2RpZXMucmVkdWNlKChib2RpZXMsIGJvZHkpID0+IHsKICAgICAgICBpZiAoYm9keS51dWlkKSBib2RpZXMucHVzaChib2R5LnV1aWQpOwogICAgICAgIHJldHVybiBib2RpZXM7CiAgICAgIH0sIFtdKTsKICAgICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSBmYWxzZTsKICAgIH0KCiAgICBzZWxmLnBvc3RNZXNzYWdlKG1lc3NhZ2UsIFtwb3NpdGlvbnMuYnVmZmVyLCBxdWF0ZXJuaW9ucy5idWZmZXJdKTsKICB9OwoKICBjb25zdCBzdGF0ZSA9IHsKICAgIGJvZGllczoge30sCiAgICBib2RpZXNOZWVkU3luY2luZzogZmFsc2UsCiAgICBjb25zdHJhaW50czoge30sCiAgICBtYXRlcmlhbHM6IHt9LAogICAgcmF5czoge30sCiAgICBzcHJpbmdJbnN0YW5jZXM6IHt9LAogICAgc3ByaW5nczoge30sCiAgICBzdWJzY3JpcHRpb25zOiB7fSwKICAgIHZlaGljbGVzOiB7fSwKICAgIHdvcmxkOiBuZXcgV29ybGQoKQogIH07CgogIC8vLyA8cmVmZXJlbmNlIG5vLWRlZmF1bHQtbGliPSJ0cnVlIi8+CgogIGNvbnN0IGlzSGluZ2VDb25zdHJhaW50ID0gYyA9PiBjIGluc3RhbmNlb2YgSGluZ2VDb25zdHJhaW50OwoKICBmdW5jdGlvbiBzeW5jQm9kaWVzKCkgewogICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSB0cnVlOwogICAgc3RhdGUuYm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLnJlZHVjZSgoYm9kaWVzLCBib2R5KSA9PiBib2R5LnV1aWQgPyB7IC4uLmJvZGllcywKICAgICAgW2JvZHkudXVpZF06IGJvZHkKICAgIH0gOiBib2RpZXMsIHt9KTsKICB9CgogIGNvbnN0IGJyb2FkcGhhc2VzID0gewogICAgTmFpdmVCcm9hZHBoYXNlLAogICAgU0FQQnJvYWRwaGFzZQogIH07CiAgY29uc3QgY3JlYXRlTWF0ZXJpYWwgPSBjcmVhdGVNYXRlcmlhbEZhY3Rvcnkoc3RhdGUubWF0ZXJpYWxzKTsKCiAgc2VsZi5vbm1lc3NhZ2UgPSBfcmVmID0+IHsKICAgIGxldCB7CiAgICAgIGRhdGEKICAgIH0gPSBfcmVmOwoKICAgIHN3aXRjaCAoZGF0YS5vcCkgewogICAgICBjYXNlICdpbml0JzoKICAgICAgICB7CiAgICAgICAgICBpbml0KHN0YXRlLndvcmxkLCBkYXRhLnByb3BzKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3N0ZXAnOgogICAgICAgIHsKICAgICAgICAgIHN0ZXAoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnYWRkQm9kaWVzJzoKICAgICAgICB7CiAgICAgICAgICBhZGRCb2RpZXMoc3RhdGUsIGNyZWF0ZU1hdGVyaWFsLCBkYXRhKTsKICAgICAgICAgIHN5bmNCb2RpZXMoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3JlbW92ZUJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLnV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlQm9keShzdGF0ZS5ib2RpZXNbZGF0YS51dWlkW2ldXSk7CiAgICAgICAgICB9CgogICAgICAgICAgc3luY0JvZGllcygpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc3Vic2NyaWJlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIGlkLAogICAgICAgICAgICB0YXJnZXQsCiAgICAgICAgICAgIHR5cGUKICAgICAgICAgIH0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUuc3Vic2NyaXB0aW9uc1tpZF0gPSBbZGF0YS51dWlkLCB0eXBlLCB0YXJnZXRdOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAndW5zdWJzY3JpYmUnOgogICAgICAgIHsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5zdWJzY3JpcHRpb25zW2RhdGEucHJvcHNdOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2V0UG9zaXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnBvc2l0aW9uLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldFF1YXRlcm5pb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnF1YXRlcm5pb24uc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0sIGRhdGEucHJvcHNbM10pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0Um90YXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnF1YXRlcm5pb24uc2V0RnJvbUV1bGVyKGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0VmVsb2NpdHknOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnZlbG9jaXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJWZWxvY2l0eSc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYW5ndWxhclZlbG9jaXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldExpbmVhckZhY3Rvcic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubGluZWFyRmFjdG9yLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJGYWN0b3Iuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0TWFzcyc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubWFzcyA9IGRhdGEucHJvcHM7CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0udXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldE1hdGVyaWFsJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5tYXRlcmlhbCA9IGRhdGEucHJvcHMgPyBjcmVhdGVNYXRlcmlhbChkYXRhLnByb3BzKSA6IG51bGw7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRMaW5lYXJEYW1waW5nJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5saW5lYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJEYW1waW5nJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbmd1bGFyRGFtcGluZyA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRBbGxvd1NsZWVwJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbGxvd1NsZWVwID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldFNsZWVwU3BlZWRMaW1pdCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXBTcGVlZExpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldFNsZWVwVGltZUxpbWl0JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5zbGVlcFRpbWVMaW1pdCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRDb2xsaXNpb25GaWx0ZXJHcm91cCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyTWFzayc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uY29sbGlzaW9uRmlsdGVyTWFzayA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRDb2xsaXNpb25SZXNwb25zZSc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uY29sbGlzaW9uUmVzcG9uc2UgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0Rml4ZWRSb3RhdGlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uZml4ZWRSb3RhdGlvbiA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRGcmljdGlvbkdyYXZpdHknOgogICAgICAgIHN0YXRlLndvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGRhdGEucHJvcHMgPyBuZXcgVmVjMyguLi5kYXRhLnByb3BzKSA6IHVuZGVmaW5lZDsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldElzVHJpZ2dlcic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uaXNUcmlnZ2VyID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEdyYXZpdHknOgogICAgICAgIHN0YXRlLndvcmxkLmdyYXZpdHkuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0VG9sZXJhbmNlJzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci50b2xlcmFuY2UgPSBkYXRhLnByb3BzOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRJdGVyYXRpb25zJzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci5pdGVyYXRpb25zID0gZGF0YS5wcm9wczsKICAgICAgICB9CgogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0QnJvYWRwaGFzZSc6CiAgICAgICAgc3RhdGUud29ybGQuYnJvYWRwaGFzZSA9IG5ldyAoYnJvYWRwaGFzZXNbYCR7ZGF0YS5wcm9wc31Ccm9hZHBoYXNlYF0gfHwgTmFpdmVCcm9hZHBoYXNlKShzdGF0ZS53b3JsZCk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRBeGlzSW5kZXgnOgogICAgICAgIGlmIChzdGF0ZS53b3JsZC5icm9hZHBoYXNlIGluc3RhbmNlb2YgU0FQQnJvYWRwaGFzZSkgewogICAgICAgICAgc3RhdGUud29ybGQuYnJvYWRwaGFzZS5heGlzSW5kZXggPSBkYXRhLnByb3BzID09PSB1bmRlZmluZWQgfHwgZGF0YS5wcm9wcyA9PT0gbnVsbCA/IDAgOiBkYXRhLnByb3BzOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdhcHBseUZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUZvcmNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdhcHBseUltcHVsc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5SW1wdWxzZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSwgbmV3IFZlYzMoLi4uZGF0YS5wcm9wc1sxXSkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYXBwbHlMb2NhbEZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUxvY2FsRm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2FwcGx5TG9jYWxJbXB1bHNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUxvY2FsSW1wdWxzZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSwgbmV3IFZlYzMoLi4uZGF0YS5wcm9wc1sxXSkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYXBwbHlUb3JxdWUnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5VG9ycXVlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2FkZENvbnN0cmFpbnQnOgogICAgICAgIHsKICAgICAgICAgIGFkZENvbnN0cmFpbnQoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAncmVtb3ZlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKF9yZWYyID0+IHsKICAgICAgICAgIGxldCB7CiAgICAgICAgICAgIHV1aWQKICAgICAgICAgIH0gPSBfcmVmMjsKICAgICAgICAgIHJldHVybiB1dWlkID09PSBkYXRhLnV1aWQ7CiAgICAgICAgfSkubWFwKGMgPT4gc3RhdGUud29ybGQucmVtb3ZlQ29uc3RyYWludChjKSk7CgogICAgICAgIGlmIChzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdKSB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIHN0YXRlLmNvbnN0cmFpbnRzW2RhdGEudXVpZF0pOwogICAgICAgICAgZGVsZXRlIHN0YXRlLmNvbnN0cmFpbnRzW2RhdGEudXVpZF07CiAgICAgICAgfQoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2VuYWJsZUNvbnN0cmFpbnQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5tYXAoYyA9PiBjLmVuYWJsZSgpKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2Rpc2FibGVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkubWFwKGMgPT4gYy5kaXNhYmxlKCkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmVuYWJsZU1vdG9yKCkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnZGlzYWJsZUNvbnN0cmFpbnRNb3Rvcic6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLmZpbHRlcihpc0hpbmdlQ29uc3RyYWludCkubWFwKGMgPT4gYy5kaXNhYmxlTW90b3IoKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRDb25zdHJhaW50TW90b3JTcGVlZCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLmZpbHRlcihpc0hpbmdlQ29uc3RyYWludCkubWFwKGMgPT4gYy5zZXRNb3RvclNwZWVkKGRhdGEucHJvcHMpKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldENvbnN0cmFpbnRNb3Rvck1heEZvcmNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLnNldE1vdG9yTWF4Rm9yY2UoZGF0YS5wcm9wcykpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYWRkU3ByaW5nJzoKICAgICAgICB7CiAgICAgICAgICBhZGRTcHJpbmcoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2V0U3ByaW5nU3RpZmZuZXNzJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5zcHJpbmdJbnN0YW5jZXNbZGF0YS51dWlkXS5zdGlmZm5lc3MgPSBkYXRhLnByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2V0U3ByaW5nUmVzdExlbmd0aCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0ucmVzdExlbmd0aCA9IGRhdGEucHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzZXRTcHJpbmdEYW1waW5nJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5zcHJpbmdJbnN0YW5jZXNbZGF0YS51dWlkXS5kYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3JlbW92ZVNwcmluZyc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5zcHJpbmdzW2RhdGEudXVpZF0pOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnYWRkUmF5JzoKICAgICAgICB7CiAgICAgICAgICBhZGRSYXkoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAncmVtb3ZlUmF5JzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgc3RhdGUucmF5c1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5yYXlzW2RhdGEudXVpZF07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdhZGRSYXljYXN0VmVoaWNsZSc6CiAgICAgICAgewogICAgICAgICAgYWRkUmF5Y2FzdFZlaGljbGUoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAncmVtb3ZlUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnByZVN0ZXApOwogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnBvc3RTdGVwKTsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS53b3JsZCA9IG51bGw7CiAgICAgICAgICBkZWxldGUgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3NldFJheWNhc3RWZWhpY2xlU3RlZXJpbmdWYWx1ZSc6CiAgICAgICAgewogICAgICAgICAgY29uc3QgW3ZhbHVlLCB3aGVlbEluZGV4XSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnZlaGljbGUuc2V0U3RlZXJpbmdWYWx1ZSh2YWx1ZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdhcHBseVJheWNhc3RWZWhpY2xlRW5naW5lRm9yY2UnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLmFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2V0UmF5Y2FzdFZlaGljbGVCcmFrZSc6CiAgICAgICAgewogICAgICAgICAgY29uc3QgW2JyYWtlLCB3aGVlbEluZGV4XSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnZlaGljbGUuc2V0QnJha2UoYnJha2UsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnYWRkQ29udGFjdE1hdGVyaWFsJzoKICAgICAgICB7CiAgICAgICAgICBhZGRDb250YWN0TWF0ZXJpYWwoc3RhdGUud29ybGQsIGNyZWF0ZU1hdGVyaWFsLCBkYXRhLnByb3BzLCBkYXRhLnV1aWQpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAncmVtb3ZlQ29udGFjdE1hdGVyaWFsJzoKICAgICAgICB7CiAgICAgICAgICByZW1vdmVDb250YWN0TWF0ZXJpYWwoc3RhdGUud29ybGQsIGRhdGEudXVpZCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICd3YWtlVXAnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLndha2VVcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2xlZXAnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnNsZWVwKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9CiAgfTsKCn0pKCk7Cgo=",null,!1);class xEe extends vEe{get axisIndex(){return this.config.axisIndex}set axisIndex(e){this.config.axisIndex=e,this.postMessage({op:"setAxisIndex",props:e})}get broadphase(){return this.config.broadphase}set broadphase(e){this.config.broadphase=e,this.postMessage({op:"setBroadphase",props:e})}get frictionGravity(){return this.config.frictionGravity}set frictionGravity(e){this.config.frictionGravity=e,this.postMessage({op:"setFrictionGravity",props:e})}get gravity(){return this.config.gravity}set gravity(e){this.config.gravity=e,this.postMessage({op:"setGravity",props:e})}get iterations(){return this.config.iterations}set iterations(e){this.config.iterations=e,this.postMessage({op:"setIterations",props:e})}get tolerance(){return this.config.tolerance}set tolerance(e){this.config.tolerance=e,this.postMessage({op:"setTolerance",props:e})}constructor(e){let{allowSleep:t=!1,axisIndex:i=0,broadphase:r="Naive",defaultContactMaterial:s={contactEquationStiffness:1e6},frictionGravity:o=null,gravity:a=[0,-9.81,0],iterations:l=5,quatNormalizeFast:c=!1,quatNormalizeSkip:g=0,size:u=1e3,solver:d="GS",tolerance:h=.001}=e;super(),this.messageQueue=[],this.worker=null,this.config={allowSleep:t,axisIndex:i,broadphase:r,defaultContactMaterial:s,frictionGravity:o,gravity:a,iterations:l,quatNormalizeFast:c,quatNormalizeSkip:g,size:u,solver:d,tolerance:h},this.buffers={positions:new Float32Array(u*3),quaternions:new Float32Array(u*4)}}addBodies(e){let{props:t,type:i,uuid:r}=e;this.postMessage({op:"addBodies",props:t,type:i,uuid:r})}addConstraint(e){let{props:[t,i,r],type:s,uuid:o}=e;this.postMessage({op:"addConstraint",props:[t,i,r],type:s,uuid:o})}addContactMaterial(e){let{props:t,uuid:i}=e;this.postMessage({op:"addContactMaterial",props:t,uuid:i})}addRay(e){let{props:t,uuid:i}=e;this.postMessage({op:"addRay",props:t,uuid:i})}addRaycastVehicle(e){let{props:[t,i,r,s,o,a],uuid:l}=e;this.postMessage({op:"addRaycastVehicle",props:[t,i,r,s,o,a],uuid:l})}addSpring(e){let{props:[t,i,r],uuid:s}=e;this.postMessage({op:"addSpring",props:[t,i,r],uuid:s})}applyForce(e){let{props:t,uuid:i}=e;this.postMessage({op:"applyForce",props:t,uuid:i})}applyImpulse(e){let{props:t,uuid:i}=e;this.postMessage({op:"applyImpulse",props:t,uuid:i})}applyLocalForce(e){let{props:t,uuid:i}=e;this.postMessage({op:"applyLocalForce",props:t,uuid:i})}applyLocalImpulse(e){let{props:t,uuid:i}=e;this.postMessage({op:"applyLocalImpulse",props:t,uuid:i})}applyRaycastVehicleEngineForce(e){let{props:t,uuid:i}=e;this.postMessage({op:"applyRaycastVehicleEngineForce",props:t,uuid:i})}applyTorque(e){let{props:t,uuid:i}=e;this.postMessage({op:"applyTorque",props:t,uuid:i})}connect(){this.worker=new wEe,this.worker.onmessage=e=>{if(e.data.op==="frame"){this.buffers.positions=e.data.positions,this.buffers.quaternions=e.data.quaternions,this.emit(e.data.op,e.data);return}this.emit(e.data.type,e.data)};for(const e of this.messageQueue)this.worker.postMessage(e);this.messageQueue.length=0}disableConstraint(e){let{uuid:t}=e;this.postMessage({op:"disableConstraint",uuid:t})}disableConstraintMotor(e){let{uuid:t}=e;this.postMessage({op:"disableConstraintMotor",uuid:t})}disconnect(){this.worker&&(this.worker.onmessage=null)}enableConstraint(e){let{uuid:t}=e;this.postMessage({op:"enableConstraint",uuid:t})}enableConstraintMotor(e){let{uuid:t}=e;this.postMessage({op:"enableConstraintMotor",uuid:t})}init(){const{allowSleep:e,axisIndex:t,broadphase:i,defaultContactMaterial:r,frictionGravity:s,gravity:o,iterations:a,quatNormalizeFast:l,quatNormalizeSkip:c,solver:g,tolerance:u}=this.config;this.postMessage({op:"init",props:{allowSleep:e,axisIndex:t,broadphase:i,defaultContactMaterial:r,frictionGravity:s,gravity:o,iterations:a,quatNormalizeFast:l,quatNormalizeSkip:c,solver:g,tolerance:u}})}removeBodies(e){let{uuid:t}=e;this.postMessage({op:"removeBodies",uuid:t})}removeConstraint(e){let{uuid:t}=e;this.postMessage({op:"removeConstraint",uuid:t})}removeContactMaterial(e){let{uuid:t}=e;this.postMessage({op:"removeContactMaterial",uuid:t})}removeRay(e){let{uuid:t}=e;this.postMessage({op:"removeRay",uuid:t})}removeRaycastVehicle(e){let{uuid:t}=e;this.postMessage({op:"removeRaycastVehicle",uuid:t})}removeSpring(e){let{uuid:t}=e;this.postMessage({op:"removeSpring",uuid:t})}setAllowSleep(e){let{props:t,uuid:i}=e;this.postMessage({op:"setAllowSleep",props:t,uuid:i})}setAngularDamping(e){let{props:t,uuid:i}=e;this.postMessage({op:"setAngularDamping",props:t,uuid:i})}setAngularFactor(e){let{props:t,uuid:i}=e;this.postMessage({op:"setAngularFactor",props:t,uuid:i})}setAngularVelocity(e){let{props:t,uuid:i}=e;this.postMessage({op:"setAngularVelocity",props:t,uuid:i})}setCollisionFilterGroup(e){let{props:t,uuid:i}=e;this.postMessage({op:"setCollisionFilterGroup",props:t,uuid:i})}setCollisionFilterMask(e){let{props:t,uuid:i}=e;this.postMessage({op:"setCollisionFilterMask",props:t,uuid:i})}setCollisionResponse(e){let{props:t,uuid:i}=e;this.postMessage({op:"setCollisionResponse",props:t,uuid:i})}setConstraintMotorMaxForce(e){let{props:t,uuid:i}=e;this.postMessage({op:"setConstraintMotorMaxForce",props:t,uuid:i})}setConstraintMotorSpeed(e){let{props:t,uuid:i}=e;this.postMessage({op:"setConstraintMotorSpeed",props:t,uuid:i})}setFixedRotation(e){let{props:t,uuid:i}=e;this.postMessage({op:"setFixedRotation",props:t,uuid:i})}setIsTrigger(e){let{props:t,uuid:i}=e;this.postMessage({op:"setIsTrigger",props:t,uuid:i})}setLinearDamping(e){let{props:t,uuid:i}=e;this.postMessage({op:"setLinearDamping",props:t,uuid:i})}setLinearFactor(e){let{props:t,uuid:i}=e;this.postMessage({op:"setLinearFactor",props:t,uuid:i})}setMass(e){let{props:t,uuid:i}=e;this.postMessage({op:"setMass",props:t,uuid:i})}setMaterial(e){let{props:t,uuid:i}=e;this.postMessage({op:"setMaterial",props:t,uuid:i})}setPosition(e){let{props:t,uuid:i}=e;this.postMessage({op:"setPosition",props:t,uuid:i})}setQuaternion(e){let{props:[t,i,r,s],uuid:o}=e;this.postMessage({op:"setQuaternion",props:[t,i,r,s],uuid:o})}setRaycastVehicleBrake(e){let{props:t,uuid:i}=e;this.postMessage({op:"setRaycastVehicleBrake",props:t,uuid:i})}setRaycastVehicleSteeringValue(e){let{props:t,uuid:i}=e;this.postMessage({op:"setRaycastVehicleSteeringValue",props:t,uuid:i})}setRotation(e){let{props:t,uuid:i}=e;this.postMessage({op:"setRotation",props:t,uuid:i})}setSleepSpeedLimit(e){let{props:t,uuid:i}=e;this.postMessage({op:"setSleepSpeedLimit",props:t,uuid:i})}setSleepTimeLimit(e){let{props:t,uuid:i}=e;this.postMessage({op:"setSleepTimeLimit",props:t,uuid:i})}setSpringDamping(e){let{props:t,uuid:i}=e;this.postMessage({op:"setSpringDamping",props:t,uuid:i})}setSpringRestLength(e){let{props:t,uuid:i}=e;this.postMessage({op:"setSpringRestLength",props:t,uuid:i})}setSpringStiffness(e){let{props:t,uuid:i}=e;this.postMessage({op:"setSpringStiffness",props:t,uuid:i})}setUserData(e){let{props:t,uuid:i}=e;this.postMessage({op:"setUserData",props:t,uuid:i})}setVelocity(e){let{props:t,uuid:i}=e;this.postMessage({op:"setVelocity",props:t,uuid:i})}sleep(e){let{uuid:t}=e;this.postMessage({op:"sleep",uuid:t})}step(e){var t;const{buffers:{positions:i,quaternions:r}}=this;!i.byteLength&&!r.byteLength||(t=this.worker)==null||t.postMessage({op:"step",positions:i,props:e,quaternions:r},[i.buffer,r.buffer])}subscribe(e){let{props:{id:t,target:i,type:r},uuid:s}=e;this.postMessage({op:"subscribe",props:{id:t,target:i,type:r},uuid:s})}terminate(){var e;(e=this.worker)==null||e.terminate(),this.worker=null}unsubscribe(e){let{props:t}=e;this.postMessage({op:"unsubscribe",props:t})}wakeUp(e){let{uuid:t}=e;this.postMessage({op:"wakeUp",uuid:t})}postMessage(e){if(this.worker)return this.worker.postMessage(e);this.messageQueue.push(e)}}class Zg{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new ie);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new ie);const i=this.elements,r=e.x,s=e.y,o=e.z;return t.x=i[0]*r+i[1]*s+i[2]*o,t.y=i[3]*r+i[4]*s+i[5]*o,t.z=i[6]*r+i[7]*s+i[8]*o,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new Zg);const i=this.elements,r=e.elements,s=t.elements,o=i[0],a=i[1],l=i[2],c=i[3],g=i[4],u=i[5],d=i[6],h=i[7],f=i[8],I=r[0],A=r[1],p=r[2],y=r[3],v=r[4],b=r[5],w=r[6],G=r[7],x=r[8];return s[0]=o*I+a*y+l*w,s[1]=o*A+a*v+l*G,s[2]=o*p+a*b+l*x,s[3]=c*I+g*y+u*w,s[4]=c*A+g*v+u*G,s[5]=c*p+g*b+u*x,s[6]=d*I+h*y+f*w,s[7]=d*A+h*v+f*G,s[8]=d*p+h*b+f*x,t}scale(e,t){t===void 0&&(t=new Zg);const i=this.elements,r=t.elements;for(let s=0;s!==3;s++)r[3*s+0]=e.x*i[3*s+0],r[3*s+1]=e.y*i[3*s+1],r[3*s+2]=e.z*i[3*s+2];return t}solve(e,t){t===void 0&&(t=new ie);const i=3,r=4,s=[];let o,a;for(o=0;o<i*r;o++)s.push(0);for(o=0;o<3;o++)for(a=0;a<3;a++)s[o+r*a]=this.elements[o+3*a];s[3+4*0]=e.x,s[3+4*1]=e.y,s[3+4*2]=e.z;let l=3;const c=l;let g;const u=4;let d;do{if(o=c-l,s[o+r*o]===0){for(a=o+1;a<c;a++)if(s[o+r*a]!==0){g=u;do d=u-g,s[d+r*o]+=s[d+r*a];while(--g);break}}if(s[o+r*o]!==0)for(a=o+1;a<c;a++){const h=s[o+r*a]/s[o+r*o];g=u;do d=u-g,s[d+r*a]=d<=o?0:s[d+r*a]-s[d+r*o]*h;while(--g)}}while(--l);if(t.z=s[2*r+3]/s[2*r+2],t.y=(s[1*r+3]-s[1*r+2]*t.z)/s[1*r+1],t.x=(s[0*r+3]-s[0*r+2]*t.z-s[0*r+1]*t.y)/s[0*r+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,i){if(i===void 0)return this.elements[t+3*e];this.elements[t+3*e]=i}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";const t=",";for(let i=0;i<9;i++)e+=this.elements[i]+t;return e}reverse(e){e===void 0&&(e=new Zg);const t=3,i=6,r=SEe;let s,o;for(s=0;s<3;s++)for(o=0;o<3;o++)r[s+i*o]=this.elements[s+3*o];r[3+6*0]=1,r[3+6*1]=0,r[3+6*2]=0,r[4+6*0]=0,r[4+6*1]=1,r[4+6*2]=0,r[5+6*0]=0,r[5+6*1]=0,r[5+6*2]=1;let a=3;const l=a;let c;const g=i;let u;do{if(s=l-a,r[s+i*s]===0){for(o=s+1;o<l;o++)if(r[s+i*o]!==0){c=g;do u=g-c,r[u+i*s]+=r[u+i*o];while(--c);break}}if(r[s+i*s]!==0)for(o=s+1;o<l;o++){const d=r[s+i*o]/r[s+i*s];c=g;do u=g-c,r[u+i*o]=u<=s?0:r[u+i*o]-r[u+i*s]*d;while(--c)}}while(--a);s=2;do{o=s-1;do{const d=r[s+i*o]/r[s+i*s];c=i;do u=i-c,r[u+i*o]=r[u+i*o]-r[u+i*s]*d;while(--c)}while(o--)}while(--s);s=2;do{const d=1/r[s+i*s];c=i;do u=i-c,r[u+i*s]=r[u+i*s]*d;while(--c)}while(s--);s=2;do{o=2;do{if(u=r[t+o+i*s],isNaN(u)||u===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(s,o,u)}while(o--)}while(s--);return e}setRotationFromQuaternion(e){const t=e.x,i=e.y,r=e.z,s=e.w,o=t+t,a=i+i,l=r+r,c=t*o,g=t*a,u=t*l,d=i*a,h=i*l,f=r*l,I=s*o,A=s*a,p=s*l,y=this.elements;return y[3*0+0]=1-(d+f),y[3*0+1]=g-p,y[3*0+2]=u+A,y[3*1+0]=g+p,y[3*1+1]=1-(c+f),y[3*1+2]=h-I,y[3*2+0]=u-A,y[3*2+1]=h+I,y[3*2+2]=1-(c+d),this}transpose(e){e===void 0&&(e=new Zg);const t=this.elements,i=e.elements;let r;return i[0]=t[0],i[4]=t[4],i[8]=t[8],r=t[1],i[1]=t[3],i[3]=r,r=t[2],i[2]=t[6],i[6]=r,r=t[5],i[5]=t[7],i[7]=r,e}}const SEe=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class ie{constructor(e,t,i){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),this.x=e,this.y=t,this.z=i}cross(e,t){t===void 0&&(t=new ie);const i=e.x,r=e.y,s=e.z,o=this.x,a=this.y,l=this.z;return t.x=a*s-l*r,t.y=l*i-o*s,t.z=o*r-a*i,t}set(e,t,i){return this.x=e,this.y=t,this.z=i,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new ie(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new ie(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new Zg([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,i=this.z,r=Math.sqrt(e*e+t*t+i*i);if(r>0){const s=1/r;this.x*=s,this.y*=s,this.z*=s}else this.x=0,this.y=0,this.z=0;return r}unit(e){e===void 0&&(e=new ie);const t=this.x,i=this.y,r=this.z;let s=Math.sqrt(t*t+i*i+r*r);return s>0?(s=1/s,e.x=t*s,e.y=i*s,e.z=r*s):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,i=this.z;return Math.sqrt(e*e+t*t+i*i)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z;return Math.sqrt((s-t)*(s-t)+(o-i)*(o-i)+(a-r)*(a-r))}distanceSquared(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z;return(s-t)*(s-t)+(o-i)*(o-i)+(a-r)*(a-r)}scale(e,t){t===void 0&&(t=new ie);const i=this.x,r=this.y,s=this.z;return t.x=e*i,t.y=e*r,t.z=e*s,t}vmul(e,t){return t===void 0&&(t=new ie),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,i){return i===void 0&&(i=new ie),i.x=this.x+e*t.x,i.y=this.y+e*t.y,i.z=this.z+e*t.z,i}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new ie),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const i=this.length();if(i>0){const r=REe,s=1/i;r.set(this.x*s,this.y*s,this.z*s);const o=ZEe;Math.abs(r.x)<.9?(o.set(1,0,0),r.cross(o,e)):(o.set(0,1,0),r.cross(o,e)),r.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,i){const r=this.x,s=this.y,o=this.z;i.x=r+(e.x-r)*t,i.y=s+(e.y-s)*t,i.z=o+(e.z-o)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(lD),lD.almostEquals(e,t)}clone(){return new ie(this.x,this.y,this.z)}}ie.ZERO=new ie(0,0,0);ie.UNIT_X=new ie(1,0,0);ie.UNIT_Y=new ie(0,1,0);ie.UNIT_Z=new ie(0,0,1);const REe=new ie,ZEe=new ie,lD=new ie;class Ua{constructor(e){e===void 0&&(e={}),this.lowerBound=new ie,this.upperBound=new ie,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,i,r){const s=this.lowerBound,o=this.upperBound,a=i;s.copy(e[0]),a&&a.vmult(s,s),o.copy(s);for(let l=1;l<e.length;l++){let c=e[l];a&&(a.vmult(c,cD),c=cD),c.x>o.x&&(o.x=c.x),c.x<s.x&&(s.x=c.x),c.y>o.y&&(o.y=c.y),c.y<s.y&&(s.y=c.y),c.z>o.z&&(o.z=c.z),c.z<s.z&&(s.z=c.z)}return t&&(t.vadd(s,s),t.vadd(o,o)),r&&(s.x-=r,s.y-=r,s.z-=r,o.x+=r,o.y+=r,o.z+=r),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new Ua().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,i=this.upperBound,r=e.lowerBound,s=e.upperBound,o=r.x<=i.x&&i.x<=s.x||t.x<=s.x&&s.x<=i.x,a=r.y<=i.y&&i.y<=s.y||t.y<=s.y&&s.y<=i.y,l=r.z<=i.z&&i.z<=s.z||t.z<=s.z&&s.z<=i.z;return o&&a&&l}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,i=this.upperBound,r=e.lowerBound,s=e.upperBound;return t.x<=r.x&&i.x>=s.x&&t.y<=r.y&&i.y>=s.y&&t.z<=r.z&&i.z>=s.z}getCorners(e,t,i,r,s,o,a,l){const c=this.lowerBound,g=this.upperBound;e.copy(c),t.set(g.x,c.y,c.z),i.set(g.x,g.y,c.z),r.set(c.x,g.y,g.z),s.set(g.x,c.y,g.z),o.set(c.x,g.y,c.z),a.set(c.x,c.y,g.z),l.copy(g)}toLocalFrame(e,t){const i=gD,r=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],g=i[6],u=i[7];this.getCorners(r,s,o,a,l,c,g,u);for(let d=0;d!==8;d++){const h=i[d];e.pointToLocal(h,h)}return t.setFromPoints(i)}toWorldFrame(e,t){const i=gD,r=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],g=i[6],u=i[7];this.getCorners(r,s,o,a,l,c,g,u);for(let d=0;d!==8;d++){const h=i[d];e.pointToWorld(h,h)}return t.setFromPoints(i)}overlapsRay(e){const{direction:t,from:i}=e,r=1/t.x,s=1/t.y,o=1/t.z,a=(this.lowerBound.x-i.x)*r,l=(this.upperBound.x-i.x)*r,c=(this.lowerBound.y-i.y)*s,g=(this.upperBound.y-i.y)*s,u=(this.lowerBound.z-i.z)*o,d=(this.upperBound.z-i.z)*o,h=Math.max(Math.max(Math.min(a,l),Math.min(c,g)),Math.min(u,d)),f=Math.min(Math.min(Math.max(a,l),Math.max(c,g)),Math.max(u,d));return!(f<0||h>f)}}const cD=new ie,gD=[new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie];class _s{constructor(e,t,i,r){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),r===void 0&&(r=1),this.x=e,this.y=t,this.z=i,this.w=r}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const i=Math.sin(t*.5);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new ie),this.normalize();const t=2*Math.acos(this.w),i=Math.sqrt(1-this.w*this.w);return i<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/i,e.y=this.y/i,e.z=this.z/i),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const i=MEe,r=EEe;e.tangents(i,r),this.setFromAxisAngle(i,Math.PI)}else{const i=e.cross(t);this.x=i.x,this.y=i.y,this.z=i.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new _s);const i=this.x,r=this.y,s=this.z,o=this.w,a=e.x,l=e.y,c=e.z,g=e.w;return t.x=i*g+o*a+r*c-s*l,t.y=r*g+o*l+s*a-i*c,t.z=s*g+o*c+i*l-r*a,t.w=o*g-i*a-r*l-s*c,t}inverse(e){e===void 0&&(e=new _s);const t=this.x,i=this.y,r=this.z,s=this.w;this.conjugate(e);const o=1/(t*t+i*i+r*r+s*s);return e.x*=o,e.y*=o,e.z*=o,e.w*=o,e}conjugate(e){return e===void 0&&(e=new _s),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new ie);const i=e.x,r=e.y,s=e.z,o=this.x,a=this.y,l=this.z,c=this.w,g=c*i+a*s-l*r,u=c*r+l*i-o*s,d=c*s+o*r-a*i,h=-o*i-a*r-l*s;return t.x=g*c+h*-o+u*-l-d*-a,t.y=u*c+h*-a+d*-o-g*-l,t.z=d*c+h*-l+g*-a-u*-o,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let i,r,s;const o=this.x,a=this.y,l=this.z,c=this.w;switch(t){case"YZX":const g=o*a+l*c;if(g>.499&&(i=2*Math.atan2(o,c),r=Math.PI/2,s=0),g<-.499&&(i=-2*Math.atan2(o,c),r=-Math.PI/2,s=0),i===void 0){const u=o*o,d=a*a,h=l*l;i=Math.atan2(2*a*c-2*o*l,1-2*d-2*h),r=Math.asin(2*g),s=Math.atan2(2*o*c-2*a*l,1-2*u-2*h)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=i,e.z=r,e.x=s}setFromEuler(e,t,i,r){r===void 0&&(r="XYZ");const s=Math.cos(e/2),o=Math.cos(t/2),a=Math.cos(i/2),l=Math.sin(e/2),c=Math.sin(t/2),g=Math.sin(i/2);return r==="XYZ"?(this.x=l*o*a+s*c*g,this.y=s*c*a-l*o*g,this.z=s*o*g+l*c*a,this.w=s*o*a-l*c*g):r==="YXZ"?(this.x=l*o*a+s*c*g,this.y=s*c*a-l*o*g,this.z=s*o*g-l*c*a,this.w=s*o*a+l*c*g):r==="ZXY"?(this.x=l*o*a-s*c*g,this.y=s*c*a+l*o*g,this.z=s*o*g+l*c*a,this.w=s*o*a-l*c*g):r==="ZYX"?(this.x=l*o*a-s*c*g,this.y=s*c*a+l*o*g,this.z=s*o*g-l*c*a,this.w=s*o*a+l*c*g):r==="YZX"?(this.x=l*o*a+s*c*g,this.y=s*c*a+l*o*g,this.z=s*o*g-l*c*a,this.w=s*o*a-l*c*g):r==="XZY"&&(this.x=l*o*a-s*c*g,this.y=s*c*a-l*o*g,this.z=s*o*g+l*c*a,this.w=s*o*a+l*c*g),this}clone(){return new _s(this.x,this.y,this.z,this.w)}slerp(e,t,i){i===void 0&&(i=new _s);const r=this.x,s=this.y,o=this.z,a=this.w;let l=e.x,c=e.y,g=e.z,u=e.w,d,h,f,I,A;return h=r*l+s*c+o*g+a*u,h<0&&(h=-h,l=-l,c=-c,g=-g,u=-u),1-h>1e-6?(d=Math.acos(h),f=Math.sin(d),I=Math.sin((1-t)*d)/f,A=Math.sin(t*d)/f):(I=1-t,A=t),i.x=I*r+A*l,i.y=I*s+A*c,i.z=I*o+A*g,i.w=I*a+A*u,i}integrate(e,t,i,r){r===void 0&&(r=new _s);const s=e.x*i.x,o=e.y*i.y,a=e.z*i.z,l=this.x,c=this.y,g=this.z,u=this.w,d=t*.5;return r.x+=d*(s*u+o*g-a*c),r.y+=d*(o*u+a*l-s*g),r.z+=d*(a*u+s*c-o*l),r.w+=d*(-s*l-o*c-a*g),r}}const MEe=new ie,EEe=new ie,WEe={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class At{constructor(e){e===void 0&&(e={}),this.id=At.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,i,r){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}At.idCounter=0;At.types=WEe;class oo{constructor(e){e===void 0&&(e={}),this.position=new ie,this.quaternion=new _s,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return oo.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return oo.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new ie),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,i,r){return r===void 0&&(r=new ie),i.vsub(e,r),t.conjugate(uD),uD.vmult(r,r),r}static pointToWorldFrame(e,t,i,r){return r===void 0&&(r=new ie),t.vmult(i,r),r.vadd(e,r),r}static vectorToWorldFrame(e,t,i){return i===void 0&&(i=new ie),e.vmult(t,i),i}static vectorToLocalFrame(e,t,i,r){return r===void 0&&(r=new ie),t.w*=-1,t.vmult(i,r),t.w*=-1,r}}const uD=new _s;new ie;new ie;new ie;new ie;new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie;new ie;new _s;new Ua;new Zg;new Zg;new Zg;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new _s;new ie;new ie;new ie;new ie;class nF{constructor(){this.rayFromWorld=new ie,this.rayToWorld=new ie,this.hitNormalWorld=new ie,this.hitPointWorld=new ie,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,i,r,s,o,a){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(i),this.hitPointWorld.copy(r),this.shape=s,this.body=o,this.distance=a}}let Mq,Eq,Wq,Fq,_q,Vq,Tq;const n5={CLOSEST:1,ANY:2,ALL:4};Mq=At.types.SPHERE;Eq=At.types.PLANE;Wq=At.types.BOX;Fq=At.types.CYLINDER;_q=At.types.CONVEXPOLYHEDRON;Vq=At.types.HEIGHTFIELD;Tq=At.types.TRIMESH;class ns{get[Mq](){return this._intersectSphere}get[Eq](){return this._intersectPlane}get[Wq](){return this._intersectBox}get[Fq](){return this._intersectConvex}get[_q](){return this._intersectConvex}get[Vq](){return this._intersectHeightfield}get[Tq](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new ie),t===void 0&&(t=new ie),this.from=e.clone(),this.to=t.clone(),this.direction=new ie,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=ns.ANY,this.result=new nF,this.hasHit=!1,this.callback=i=>{}}intersectWorld(e,t){return this.mode=t.mode||ns.ANY,this.result=t.result||new nF,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(dD),WM.length=0,e.broadphase.aabbQuery(e,dD,WM),this.intersectBodies(WM),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const i=this.checkCollisionResponse;if(i&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const r=FEe,s=_Ee;for(let o=0,a=e.shapes.length;o<a;o++){const l=e.shapes[o];if(!(i&&!l.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[o],s),e.quaternion.vmult(e.shapeOffsets[o],r),r.vadd(e.position,r),this.intersectShape(l,s,r,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let i=0,r=e.length;!this.result.shouldStop&&i<r;i++)this.intersectBody(e[i])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,i,r){const s=this.from;if(QEe(s,this.direction,i)>e.boundingSphereRadius)return;const a=this[e.type];a&&a.call(this,e,t,i,r,e)}_intersectBox(e,t,i,r,s){return this._intersectConvex(e.convexPolyhedronRepresentation,t,i,r,s)}_intersectPlane(e,t,i,r,s){const o=this.from,a=this.to,l=this.direction,c=new ie(0,0,1);t.vmult(c,c);const g=new ie;o.vsub(i,g);const u=g.dot(c);a.vsub(i,g);const d=g.dot(c);if(u*d>0||o.distanceTo(a)<u)return;const h=c.dot(l);if(Math.abs(h)<this.precision)return;const f=new ie,I=new ie,A=new ie;o.vsub(i,f);const p=-c.dot(f)/h;l.scale(p,I),o.vadd(I,A),this.reportIntersection(c,A,s,r,-1)}getAABB(e){const{lowerBound:t,upperBound:i}=e,r=this.to,s=this.from;t.x=Math.min(r.x,s.x),t.y=Math.min(r.y,s.y),t.z=Math.min(r.z,s.z),i.x=Math.max(r.x,s.x),i.y=Math.max(r.y,s.y),i.z=Math.max(r.z,s.z)}_intersectHeightfield(e,t,i,r,s){e.data,e.elementSize;const o=VEe;o.from.copy(this.from),o.to.copy(this.to),oo.pointToLocalFrame(i,t,o.from,o.from),oo.pointToLocalFrame(i,t,o.to,o.to),o.updateDirection();const a=TEe;let l,c,g,u;l=c=0,g=u=e.data.length-1;const d=new Ua;o.getAABB(d),e.getIndexOfPosition(d.lowerBound.x,d.lowerBound.y,a,!0),l=Math.max(l,a[0]),c=Math.max(c,a[1]),e.getIndexOfPosition(d.upperBound.x,d.upperBound.y,a,!0),g=Math.min(g,a[0]+1),u=Math.min(u,a[1]+1);for(let h=l;h<g;h++)for(let f=c;f<u;f++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(h,f,d),!!d.overlapsRay(o)){if(e.getConvexTrianglePillar(h,f,!1),oo.pointToWorldFrame(i,t,e.pillarOffset,TG),this._intersectConvex(e.pillarConvex,t,TG,r,s,hD),this.result.shouldStop)return;e.getConvexTrianglePillar(h,f,!0),oo.pointToWorldFrame(i,t,e.pillarOffset,TG),this._intersectConvex(e.pillarConvex,t,TG,r,s,hD)}}}_intersectSphere(e,t,i,r,s){const o=this.from,a=this.to,l=e.radius,c=(a.x-o.x)**2+(a.y-o.y)**2+(a.z-o.z)**2,g=2*((a.x-o.x)*(o.x-i.x)+(a.y-o.y)*(o.y-i.y)+(a.z-o.z)*(o.z-i.z)),u=(o.x-i.x)**2+(o.y-i.y)**2+(o.z-i.z)**2-l**2,d=g**2-4*c*u,h=NEe,f=kEe;if(!(d<0))if(d===0)o.lerp(a,d,h),h.vsub(i,f),f.normalize(),this.reportIntersection(f,h,s,r,-1);else{const I=(-g-Math.sqrt(d))/(2*c),A=(-g+Math.sqrt(d))/(2*c);if(I>=0&&I<=1&&(o.lerp(a,I,h),h.vsub(i,f),f.normalize(),this.reportIntersection(f,h,s,r,-1)),this.result.shouldStop)return;A>=0&&A<=1&&(o.lerp(a,A,h),h.vsub(i,f),f.normalize(),this.reportIntersection(f,h,s,r,-1))}}_intersectConvex(e,t,i,r,s,o){const a=LEe,l=fD,c=o&&o.faceList||null,g=e.faces,u=e.vertices,d=e.faceNormals,h=this.direction,f=this.from,I=this.to,A=f.distanceTo(I),p=c?c.length:g.length,y=this.result;for(let v=0;!y.shouldStop&&v<p;v++){const b=c?c[v]:v,w=g[b],G=d[b],x=t,B=i;l.copy(u[w[0]]),x.vmult(l,l),l.vadd(B,l),l.vsub(f,l),x.vmult(G,a);const R=h.dot(a);if(Math.abs(R)<this.precision)continue;const Z=a.dot(l)/R;if(!(Z<0)){h.scale(Z,eo),eo.vadd(f,eo),cl.copy(u[w[0]]),x.vmult(cl,cl),B.vadd(cl,cl);for(let W=1;!y.shouldStop&&W<w.length-1;W++){Ol.copy(u[w[W]]),Jl.copy(u[w[W+1]]),x.vmult(Ol,Ol),x.vmult(Jl,Jl),B.vadd(Ol,Ol),B.vadd(Jl,Jl);const F=eo.distanceTo(f);!(ns.pointInTriangle(eo,cl,Ol,Jl)||ns.pointInTriangle(eo,Ol,cl,Jl))||F>A||this.reportIntersection(a,eo,s,r,b)}}}}_intersectTrimesh(e,t,i,r,s,o){const a=HEe,l=PEe,c=UEe,g=fD,u=zEe,d=XEe,h=YEe,f=DEe,I=KEe,A=e.indices;e.vertices;const p=this.from,y=this.to,v=this.direction;c.position.copy(i),c.quaternion.copy(t),oo.vectorToLocalFrame(i,t,v,u),oo.pointToLocalFrame(i,t,p,d),oo.pointToLocalFrame(i,t,y,h),h.x*=e.scale.x,h.y*=e.scale.y,h.z*=e.scale.z,d.x*=e.scale.x,d.y*=e.scale.y,d.z*=e.scale.z,h.vsub(d,u),u.normalize();const b=d.distanceSquared(h);e.tree.rayQuery(this,c,l);for(let w=0,G=l.length;!this.result.shouldStop&&w!==G;w++){const x=l[w];e.getNormal(x,a),e.getVertex(A[x*3],cl),cl.vsub(d,g);const B=u.dot(a),R=a.dot(g)/B;if(R<0)continue;u.scale(R,eo),eo.vadd(d,eo),e.getVertex(A[x*3+1],Ol),e.getVertex(A[x*3+2],Jl);const Z=eo.distanceSquared(d);!(ns.pointInTriangle(eo,Ol,cl,Jl)||ns.pointInTriangle(eo,cl,Ol,Jl))||Z>b||(oo.vectorToWorldFrame(t,a,I),oo.pointToWorldFrame(i,t,eo,f),this.reportIntersection(I,f,s,r,x))}l.length=0}reportIntersection(e,t,i,r,s){const o=this.from,a=this.to,l=o.distanceTo(t),c=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(c.hitFaceIndex=typeof s<"u"?s:-1,this.mode){case ns.ALL:this.hasHit=!0,c.set(o,a,e,t,i,r,l),c.hasHit=!0,this.callback(c);break;case ns.CLOSEST:(l<c.distance||!c.hasHit)&&(this.hasHit=!0,c.hasHit=!0,c.set(o,a,e,t,i,r,l));break;case ns.ANY:this.hasHit=!0,c.hasHit=!0,c.set(o,a,e,t,i,r,l),c.shouldStop=!0;break}}static pointInTriangle(e,t,i,r){r.vsub(t,Zh),i.vsub(t,km),e.vsub(t,FM);const s=Zh.dot(Zh),o=Zh.dot(km),a=Zh.dot(FM),l=km.dot(km),c=km.dot(FM);let g,u;return(g=l*a-o*c)>=0&&(u=s*c-o*a)>=0&&g+u<s*l-o*o}}ns.CLOSEST=n5.CLOSEST;ns.ANY=n5.ANY;ns.ALL=n5.ALL;const dD=new Ua,WM=[],km=new ie,FM=new ie,FEe=new ie,_Ee=new _s,eo=new ie,cl=new ie,Ol=new ie,Jl=new ie;new ie;new nF;const hD={faceList:[0]},TG=new ie,VEe=new ns,TEe=[],NEe=new ie,kEe=new ie,LEe=new ie;new ie;new ie;const fD=new ie,HEe=new ie,zEe=new ie,XEe=new ie,YEe=new ie,KEe=new ie,DEe=new ie;new Ua;const PEe=[],UEe=new oo,Zh=new ie,NG=new ie;function QEe(n,e,t){t.vsub(n,Zh);const i=Zh.dot(e);return e.scale(i,NG),NG.vadd(n,NG),t.distanceTo(NG)}new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ns;new ie;new ie;new ie;new ie(1,0,0),new ie(0,1,0),new ie(0,0,1);new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new Ua;new ie;new Ua;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new Ua;new ie;new oo;new Ua;At.types.SPHERE,At.types.SPHERE|At.types.PLANE,At.types.BOX|At.types.BOX,At.types.SPHERE|At.types.BOX,At.types.PLANE|At.types.BOX,At.types.CONVEXPOLYHEDRON,At.types.SPHERE|At.types.CONVEXPOLYHEDRON,At.types.PLANE|At.types.CONVEXPOLYHEDRON,At.types.BOX|At.types.CONVEXPOLYHEDRON,At.types.SPHERE|At.types.HEIGHTFIELD,At.types.BOX|At.types.HEIGHTFIELD,At.types.CONVEXPOLYHEDRON|At.types.HEIGHTFIELD,At.types.PARTICLE|At.types.SPHERE,At.types.PLANE|At.types.PARTICLE,At.types.BOX|At.types.PARTICLE,At.types.PARTICLE|At.types.CONVEXPOLYHEDRON,At.types.CYLINDER,At.types.SPHERE|At.types.CYLINDER,At.types.PLANE|At.types.CYLINDER,At.types.BOX|At.types.CYLINDER,At.types.CONVEXPOLYHEDRON|At.types.CYLINDER,At.types.HEIGHTFIELD|At.types.CYLINDER,At.types.PARTICLE|At.types.CYLINDER,At.types.SPHERE|At.types.TRIMESH,At.types.PLANE|At.types.TRIMESH;new ie;new ie;new ie;new ie;new ie;new _s;new _s;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new Ua;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie,new ie,new ie,new ie,new ie,new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new _s;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new ie;new Ua;new ns;const Lm=globalThis.performance||{};if(!Lm.now){let n=Date.now();Lm.timing&&Lm.timing.navigationStart&&(n=Lm.timing.navigationStart),Lm.now=()=>Date.now()-n}new ie;class Mg{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new re);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new re);const i=this.elements,r=e.x,s=e.y,o=e.z;return t.x=i[0]*r+i[1]*s+i[2]*o,t.y=i[3]*r+i[4]*s+i[5]*o,t.z=i[6]*r+i[7]*s+i[8]*o,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new Mg);const i=this.elements,r=e.elements,s=t.elements,o=i[0],a=i[1],l=i[2],c=i[3],g=i[4],u=i[5],d=i[6],h=i[7],f=i[8],I=r[0],A=r[1],p=r[2],y=r[3],v=r[4],b=r[5],w=r[6],G=r[7],x=r[8];return s[0]=o*I+a*y+l*w,s[1]=o*A+a*v+l*G,s[2]=o*p+a*b+l*x,s[3]=c*I+g*y+u*w,s[4]=c*A+g*v+u*G,s[5]=c*p+g*b+u*x,s[6]=d*I+h*y+f*w,s[7]=d*A+h*v+f*G,s[8]=d*p+h*b+f*x,t}scale(e,t){t===void 0&&(t=new Mg);const i=this.elements,r=t.elements;for(let s=0;s!==3;s++)r[3*s+0]=e.x*i[3*s+0],r[3*s+1]=e.y*i[3*s+1],r[3*s+2]=e.z*i[3*s+2];return t}solve(e,t){t===void 0&&(t=new re);const i=3,r=4,s=[];let o,a;for(o=0;o<i*r;o++)s.push(0);for(o=0;o<3;o++)for(a=0;a<3;a++)s[o+r*a]=this.elements[o+3*a];s[3+4*0]=e.x,s[3+4*1]=e.y,s[3+4*2]=e.z;let l=3;const c=l;let g;const u=4;let d;do{if(o=c-l,s[o+r*o]===0){for(a=o+1;a<c;a++)if(s[o+r*a]!==0){g=u;do d=u-g,s[d+r*o]+=s[d+r*a];while(--g);break}}if(s[o+r*o]!==0)for(a=o+1;a<c;a++){const h=s[o+r*a]/s[o+r*o];g=u;do d=u-g,s[d+r*a]=d<=o?0:s[d+r*a]-s[d+r*o]*h;while(--g)}}while(--l);if(t.z=s[2*r+3]/s[2*r+2],t.y=(s[1*r+3]-s[1*r+2]*t.z)/s[1*r+1],t.x=(s[0*r+3]-s[0*r+2]*t.z-s[0*r+1]*t.y)/s[0*r+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,i){if(i===void 0)return this.elements[t+3*e];this.elements[t+3*e]=i}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";const t=",";for(let i=0;i<9;i++)e+=this.elements[i]+t;return e}reverse(e){e===void 0&&(e=new Mg);const t=3,i=6,r=OEe;let s,o;for(s=0;s<3;s++)for(o=0;o<3;o++)r[s+i*o]=this.elements[s+3*o];r[3+6*0]=1,r[3+6*1]=0,r[3+6*2]=0,r[4+6*0]=0,r[4+6*1]=1,r[4+6*2]=0,r[5+6*0]=0,r[5+6*1]=0,r[5+6*2]=1;let a=3;const l=a;let c;const g=i;let u;do{if(s=l-a,r[s+i*s]===0){for(o=s+1;o<l;o++)if(r[s+i*o]!==0){c=g;do u=g-c,r[u+i*s]+=r[u+i*o];while(--c);break}}if(r[s+i*s]!==0)for(o=s+1;o<l;o++){const d=r[s+i*o]/r[s+i*s];c=g;do u=g-c,r[u+i*o]=u<=s?0:r[u+i*o]-r[u+i*s]*d;while(--c)}}while(--a);s=2;do{o=s-1;do{const d=r[s+i*o]/r[s+i*s];c=i;do u=i-c,r[u+i*o]=r[u+i*o]-r[u+i*s]*d;while(--c)}while(o--)}while(--s);s=2;do{const d=1/r[s+i*s];c=i;do u=i-c,r[u+i*s]=r[u+i*s]*d;while(--c)}while(s--);s=2;do{o=2;do{if(u=r[t+o+i*s],isNaN(u)||u===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(s,o,u)}while(o--)}while(s--);return e}setRotationFromQuaternion(e){const t=e.x,i=e.y,r=e.z,s=e.w,o=t+t,a=i+i,l=r+r,c=t*o,g=t*a,u=t*l,d=i*a,h=i*l,f=r*l,I=s*o,A=s*a,p=s*l,y=this.elements;return y[3*0+0]=1-(d+f),y[3*0+1]=g-p,y[3*0+2]=u+A,y[3*1+0]=g+p,y[3*1+1]=1-(c+f),y[3*1+2]=h-I,y[3*2+0]=u-A,y[3*2+1]=h+I,y[3*2+2]=1-(c+d),this}transpose(e){e===void 0&&(e=new Mg);const t=this.elements,i=e.elements;let r;return i[0]=t[0],i[4]=t[4],i[8]=t[8],r=t[1],i[1]=t[3],i[3]=r,r=t[2],i[2]=t[6],i[6]=r,r=t[5],i[5]=t[7],i[7]=r,e}}const OEe=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class re{constructor(e,t,i){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),this.x=e,this.y=t,this.z=i}cross(e,t){t===void 0&&(t=new re);const i=e.x,r=e.y,s=e.z,o=this.x,a=this.y,l=this.z;return t.x=a*s-l*r,t.y=l*i-o*s,t.z=o*r-a*i,t}set(e,t,i){return this.x=e,this.y=t,this.z=i,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new re(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new re(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new Mg([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,i=this.z,r=Math.sqrt(e*e+t*t+i*i);if(r>0){const s=1/r;this.x*=s,this.y*=s,this.z*=s}else this.x=0,this.y=0,this.z=0;return r}unit(e){e===void 0&&(e=new re);const t=this.x,i=this.y,r=this.z;let s=Math.sqrt(t*t+i*i+r*r);return s>0?(s=1/s,e.x=t*s,e.y=i*s,e.z=r*s):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,i=this.z;return Math.sqrt(e*e+t*t+i*i)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z;return Math.sqrt((s-t)*(s-t)+(o-i)*(o-i)+(a-r)*(a-r))}distanceSquared(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z;return(s-t)*(s-t)+(o-i)*(o-i)+(a-r)*(a-r)}scale(e,t){t===void 0&&(t=new re);const i=this.x,r=this.y,s=this.z;return t.x=e*i,t.y=e*r,t.z=e*s,t}vmul(e,t){return t===void 0&&(t=new re),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,i){return i===void 0&&(i=new re),i.x=this.x+e*t.x,i.y=this.y+e*t.y,i.z=this.z+e*t.z,i}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new re),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const i=this.length();if(i>0){const r=JEe,s=1/i;r.set(this.x*s,this.y*s,this.z*s);const o=jEe;Math.abs(r.x)<.9?(o.set(1,0,0),r.cross(o,e)):(o.set(0,1,0),r.cross(o,e)),r.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,i){const r=this.x,s=this.y,o=this.z;i.x=r+(e.x-r)*t,i.y=s+(e.y-s)*t,i.z=o+(e.z-o)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(ID),ID.almostEquals(e,t)}clone(){return new re(this.x,this.y,this.z)}}re.ZERO=new re(0,0,0);re.UNIT_X=new re(1,0,0);re.UNIT_Y=new re(0,1,0);re.UNIT_Z=new re(0,0,1);const JEe=new re,jEe=new re,ID=new re;class Qa{constructor(e){e===void 0&&(e={}),this.lowerBound=new re,this.upperBound=new re,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,i,r){const s=this.lowerBound,o=this.upperBound,a=i;s.copy(e[0]),a&&a.vmult(s,s),o.copy(s);for(let l=1;l<e.length;l++){let c=e[l];a&&(a.vmult(c,AD),c=AD),c.x>o.x&&(o.x=c.x),c.x<s.x&&(s.x=c.x),c.y>o.y&&(o.y=c.y),c.y<s.y&&(s.y=c.y),c.z>o.z&&(o.z=c.z),c.z<s.z&&(s.z=c.z)}return t&&(t.vadd(s,s),t.vadd(o,o)),r&&(s.x-=r,s.y-=r,s.z-=r,o.x+=r,o.y+=r,o.z+=r),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new Qa().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,i=this.upperBound,r=e.lowerBound,s=e.upperBound,o=r.x<=i.x&&i.x<=s.x||t.x<=s.x&&s.x<=i.x,a=r.y<=i.y&&i.y<=s.y||t.y<=s.y&&s.y<=i.y,l=r.z<=i.z&&i.z<=s.z||t.z<=s.z&&s.z<=i.z;return o&&a&&l}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,i=this.upperBound,r=e.lowerBound,s=e.upperBound;return t.x<=r.x&&i.x>=s.x&&t.y<=r.y&&i.y>=s.y&&t.z<=r.z&&i.z>=s.z}getCorners(e,t,i,r,s,o,a,l){const c=this.lowerBound,g=this.upperBound;e.copy(c),t.set(g.x,c.y,c.z),i.set(g.x,g.y,c.z),r.set(c.x,g.y,g.z),s.set(g.x,c.y,g.z),o.set(c.x,g.y,c.z),a.set(c.x,c.y,g.z),l.copy(g)}toLocalFrame(e,t){const i=CD,r=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],g=i[6],u=i[7];this.getCorners(r,s,o,a,l,c,g,u);for(let d=0;d!==8;d++){const h=i[d];e.pointToLocal(h,h)}return t.setFromPoints(i)}toWorldFrame(e,t){const i=CD,r=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],g=i[6],u=i[7];this.getCorners(r,s,o,a,l,c,g,u);for(let d=0;d!==8;d++){const h=i[d];e.pointToWorld(h,h)}return t.setFromPoints(i)}overlapsRay(e){const{direction:t,from:i}=e,r=1/t.x,s=1/t.y,o=1/t.z,a=(this.lowerBound.x-i.x)*r,l=(this.upperBound.x-i.x)*r,c=(this.lowerBound.y-i.y)*s,g=(this.upperBound.y-i.y)*s,u=(this.lowerBound.z-i.z)*o,d=(this.upperBound.z-i.z)*o,h=Math.max(Math.max(Math.min(a,l),Math.min(c,g)),Math.min(u,d)),f=Math.min(Math.min(Math.max(a,l),Math.max(c,g)),Math.max(u,d));return!(f<0||h>f)}}const AD=new re,CD=[new re,new re,new re,new re,new re,new re,new re,new re];class Vs{constructor(e,t,i,r){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),r===void 0&&(r=1),this.x=e,this.y=t,this.z=i,this.w=r}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const i=Math.sin(t*.5);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new re),this.normalize();const t=2*Math.acos(this.w),i=Math.sqrt(1-this.w*this.w);return i<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/i,e.y=this.y/i,e.z=this.z/i),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const i=qEe,r=$Ee;e.tangents(i,r),this.setFromAxisAngle(i,Math.PI)}else{const i=e.cross(t);this.x=i.x,this.y=i.y,this.z=i.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new Vs);const i=this.x,r=this.y,s=this.z,o=this.w,a=e.x,l=e.y,c=e.z,g=e.w;return t.x=i*g+o*a+r*c-s*l,t.y=r*g+o*l+s*a-i*c,t.z=s*g+o*c+i*l-r*a,t.w=o*g-i*a-r*l-s*c,t}inverse(e){e===void 0&&(e=new Vs);const t=this.x,i=this.y,r=this.z,s=this.w;this.conjugate(e);const o=1/(t*t+i*i+r*r+s*s);return e.x*=o,e.y*=o,e.z*=o,e.w*=o,e}conjugate(e){return e===void 0&&(e=new Vs),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new re);const i=e.x,r=e.y,s=e.z,o=this.x,a=this.y,l=this.z,c=this.w,g=c*i+a*s-l*r,u=c*r+l*i-o*s,d=c*s+o*r-a*i,h=-o*i-a*r-l*s;return t.x=g*c+h*-o+u*-l-d*-a,t.y=u*c+h*-a+d*-o-g*-l,t.z=d*c+h*-l+g*-a-u*-o,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let i,r,s;const o=this.x,a=this.y,l=this.z,c=this.w;switch(t){case"YZX":const g=o*a+l*c;if(g>.499&&(i=2*Math.atan2(o,c),r=Math.PI/2,s=0),g<-.499&&(i=-2*Math.atan2(o,c),r=-Math.PI/2,s=0),i===void 0){const u=o*o,d=a*a,h=l*l;i=Math.atan2(2*a*c-2*o*l,1-2*d-2*h),r=Math.asin(2*g),s=Math.atan2(2*o*c-2*a*l,1-2*u-2*h)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=i,e.z=r,e.x=s}setFromEuler(e,t,i,r){r===void 0&&(r="XYZ");const s=Math.cos(e/2),o=Math.cos(t/2),a=Math.cos(i/2),l=Math.sin(e/2),c=Math.sin(t/2),g=Math.sin(i/2);return r==="XYZ"?(this.x=l*o*a+s*c*g,this.y=s*c*a-l*o*g,this.z=s*o*g+l*c*a,this.w=s*o*a-l*c*g):r==="YXZ"?(this.x=l*o*a+s*c*g,this.y=s*c*a-l*o*g,this.z=s*o*g-l*c*a,this.w=s*o*a+l*c*g):r==="ZXY"?(this.x=l*o*a-s*c*g,this.y=s*c*a+l*o*g,this.z=s*o*g+l*c*a,this.w=s*o*a-l*c*g):r==="ZYX"?(this.x=l*o*a-s*c*g,this.y=s*c*a+l*o*g,this.z=s*o*g-l*c*a,this.w=s*o*a+l*c*g):r==="YZX"?(this.x=l*o*a+s*c*g,this.y=s*c*a+l*o*g,this.z=s*o*g-l*c*a,this.w=s*o*a-l*c*g):r==="XZY"&&(this.x=l*o*a-s*c*g,this.y=s*c*a-l*o*g,this.z=s*o*g+l*c*a,this.w=s*o*a+l*c*g),this}clone(){return new Vs(this.x,this.y,this.z,this.w)}slerp(e,t,i){i===void 0&&(i=new Vs);const r=this.x,s=this.y,o=this.z,a=this.w;let l=e.x,c=e.y,g=e.z,u=e.w,d,h,f,I,A;return h=r*l+s*c+o*g+a*u,h<0&&(h=-h,l=-l,c=-c,g=-g,u=-u),1-h>1e-6?(d=Math.acos(h),f=Math.sin(d),I=Math.sin((1-t)*d)/f,A=Math.sin(t*d)/f):(I=1-t,A=t),i.x=I*r+A*l,i.y=I*s+A*c,i.z=I*o+A*g,i.w=I*a+A*u,i}integrate(e,t,i,r){r===void 0&&(r=new Vs);const s=e.x*i.x,o=e.y*i.y,a=e.z*i.z,l=this.x,c=this.y,g=this.z,u=this.w,d=t*.5;return r.x+=d*(s*u+o*g-a*c),r.y+=d*(o*u+a*l-s*g),r.z+=d*(a*u+s*c-o*l),r.w+=d*(-s*l-o*c-a*g),r}}const qEe=new re,$Ee=new re,e3e={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class Ct{constructor(e){e===void 0&&(e={}),this.id=Ct.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,i,r){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Ct.idCounter=0;Ct.types=e3e;class ao{constructor(e){e===void 0&&(e={}),this.position=new re,this.quaternion=new Vs,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return ao.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return ao.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new re),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,i,r){return r===void 0&&(r=new re),i.vsub(e,r),t.conjugate(pD),pD.vmult(r,r),r}static pointToWorldFrame(e,t,i,r){return r===void 0&&(r=new re),t.vmult(i,r),r.vadd(e,r),r}static vectorToWorldFrame(e,t,i){return i===void 0&&(i=new re),e.vmult(t,i),i}static vectorToLocalFrame(e,t,i,r){return r===void 0&&(r=new re),t.w*=-1,t.vmult(i,r),t.w*=-1,r}}const pD=new Vs;new re;new re;new re;new re;new re,new re,new re,new re,new re,new re,new re,new re;new re;new Vs;new Qa;new Mg;new Mg;new Mg;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new Vs;new re;new re;new re;new re;class iF{constructor(){this.rayFromWorld=new re,this.rayToWorld=new re,this.hitNormalWorld=new re,this.hitPointWorld=new re,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,i,r,s,o,a){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(i),this.hitPointWorld.copy(r),this.shape=s,this.body=o,this.distance=a}}let Nq,kq,Lq,Hq,zq,Xq,Yq;const i5={CLOSEST:1,ANY:2,ALL:4};Nq=Ct.types.SPHERE;kq=Ct.types.PLANE;Lq=Ct.types.BOX;Hq=Ct.types.CYLINDER;zq=Ct.types.CONVEXPOLYHEDRON;Xq=Ct.types.HEIGHTFIELD;Yq=Ct.types.TRIMESH;let cp=class ec{get[Nq](){return this._intersectSphere}get[kq](){return this._intersectPlane}get[Lq](){return this._intersectBox}get[Hq](){return this._intersectConvex}get[zq](){return this._intersectConvex}get[Xq](){return this._intersectHeightfield}get[Yq](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new re),t===void 0&&(t=new re),this.from=e.clone(),this.to=t.clone(),this.direction=new re,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=ec.ANY,this.result=new iF,this.hasHit=!1,this.callback=i=>{}}intersectWorld(e,t){return this.mode=t.mode||ec.ANY,this.result=t.result||new iF,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(mD),_M.length=0,e.broadphase.aabbQuery(e,mD,_M),this.intersectBodies(_M),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const i=this.checkCollisionResponse;if(i&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const r=t3e,s=n3e;for(let o=0,a=e.shapes.length;o<a;o++){const l=e.shapes[o];if(!(i&&!l.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[o],s),e.quaternion.vmult(e.shapeOffsets[o],r),r.vadd(e.position,r),this.intersectShape(l,s,r,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let i=0,r=e.length;!this.result.shouldStop&&i<r;i++)this.intersectBody(e[i])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,i,r){const s=this.from;if(A3e(s,this.direction,i)>e.boundingSphereRadius)return;const a=this[e.type];a&&a.call(this,e,t,i,r,e)}_intersectBox(e,t,i,r,s){return this._intersectConvex(e.convexPolyhedronRepresentation,t,i,r,s)}_intersectPlane(e,t,i,r,s){const o=this.from,a=this.to,l=this.direction,c=new re(0,0,1);t.vmult(c,c);const g=new re;o.vsub(i,g);const u=g.dot(c);a.vsub(i,g);const d=g.dot(c);if(u*d>0||o.distanceTo(a)<u)return;const h=c.dot(l);if(Math.abs(h)<this.precision)return;const f=new re,I=new re,A=new re;o.vsub(i,f);const p=-c.dot(f)/h;l.scale(p,I),o.vadd(I,A),this.reportIntersection(c,A,s,r,-1)}getAABB(e){const{lowerBound:t,upperBound:i}=e,r=this.to,s=this.from;t.x=Math.min(r.x,s.x),t.y=Math.min(r.y,s.y),t.z=Math.min(r.z,s.z),i.x=Math.max(r.x,s.x),i.y=Math.max(r.y,s.y),i.z=Math.max(r.z,s.z)}_intersectHeightfield(e,t,i,r,s){e.data,e.elementSize;const o=i3e;o.from.copy(this.from),o.to.copy(this.to),ao.pointToLocalFrame(i,t,o.from,o.from),ao.pointToLocalFrame(i,t,o.to,o.to),o.updateDirection();const a=r3e;let l,c,g,u;l=c=0,g=u=e.data.length-1;const d=new Qa;o.getAABB(d),e.getIndexOfPosition(d.lowerBound.x,d.lowerBound.y,a,!0),l=Math.max(l,a[0]),c=Math.max(c,a[1]),e.getIndexOfPosition(d.upperBound.x,d.upperBound.y,a,!0),g=Math.min(g,a[0]+1),u=Math.min(u,a[1]+1);for(let h=l;h<g;h++)for(let f=c;f<u;f++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(h,f,d),!!d.overlapsRay(o)){if(e.getConvexTrianglePillar(h,f,!1),ao.pointToWorldFrame(i,t,e.pillarOffset,kG),this._intersectConvex(e.pillarConvex,t,kG,r,s,yD),this.result.shouldStop)return;e.getConvexTrianglePillar(h,f,!0),ao.pointToWorldFrame(i,t,e.pillarOffset,kG),this._intersectConvex(e.pillarConvex,t,kG,r,s,yD)}}}_intersectSphere(e,t,i,r,s){const o=this.from,a=this.to,l=e.radius,c=(a.x-o.x)**2+(a.y-o.y)**2+(a.z-o.z)**2,g=2*((a.x-o.x)*(o.x-i.x)+(a.y-o.y)*(o.y-i.y)+(a.z-o.z)*(o.z-i.z)),u=(o.x-i.x)**2+(o.y-i.y)**2+(o.z-i.z)**2-l**2,d=g**2-4*c*u,h=s3e,f=o3e;if(!(d<0))if(d===0)o.lerp(a,d,h),h.vsub(i,f),f.normalize(),this.reportIntersection(f,h,s,r,-1);else{const I=(-g-Math.sqrt(d))/(2*c),A=(-g+Math.sqrt(d))/(2*c);if(I>=0&&I<=1&&(o.lerp(a,I,h),h.vsub(i,f),f.normalize(),this.reportIntersection(f,h,s,r,-1)),this.result.shouldStop)return;A>=0&&A<=1&&(o.lerp(a,A,h),h.vsub(i,f),f.normalize(),this.reportIntersection(f,h,s,r,-1))}}_intersectConvex(e,t,i,r,s,o){const a=a3e,l=vD,c=o&&o.faceList||null,g=e.faces,u=e.vertices,d=e.faceNormals,h=this.direction,f=this.from,I=this.to,A=f.distanceTo(I),p=c?c.length:g.length,y=this.result;for(let v=0;!y.shouldStop&&v<p;v++){const b=c?c[v]:v,w=g[b],G=d[b],x=t,B=i;l.copy(u[w[0]]),x.vmult(l,l),l.vadd(B,l),l.vsub(f,l),x.vmult(G,a);const R=h.dot(a);if(Math.abs(R)<this.precision)continue;const Z=a.dot(l)/R;if(!(Z<0)){h.scale(Z,to),to.vadd(f,to),gl.copy(u[w[0]]),x.vmult(gl,gl),B.vadd(gl,gl);for(let W=1;!y.shouldStop&&W<w.length-1;W++){jl.copy(u[w[W]]),ql.copy(u[w[W+1]]),x.vmult(jl,jl),x.vmult(ql,ql),B.vadd(jl,jl),B.vadd(ql,ql);const F=to.distanceTo(f);!(ec.pointInTriangle(to,gl,jl,ql)||ec.pointInTriangle(to,jl,gl,ql))||F>A||this.reportIntersection(a,to,s,r,b)}}}}_intersectTrimesh(e,t,i,r,s,o){const a=l3e,l=f3e,c=I3e,g=vD,u=c3e,d=g3e,h=u3e,f=h3e,I=d3e,A=e.indices;e.vertices;const p=this.from,y=this.to,v=this.direction;c.position.copy(i),c.quaternion.copy(t),ao.vectorToLocalFrame(i,t,v,u),ao.pointToLocalFrame(i,t,p,d),ao.pointToLocalFrame(i,t,y,h),h.x*=e.scale.x,h.y*=e.scale.y,h.z*=e.scale.z,d.x*=e.scale.x,d.y*=e.scale.y,d.z*=e.scale.z,h.vsub(d,u),u.normalize();const b=d.distanceSquared(h);e.tree.rayQuery(this,c,l);for(let w=0,G=l.length;!this.result.shouldStop&&w!==G;w++){const x=l[w];e.getNormal(x,a),e.getVertex(A[x*3],gl),gl.vsub(d,g);const B=u.dot(a),R=a.dot(g)/B;if(R<0)continue;u.scale(R,to),to.vadd(d,to),e.getVertex(A[x*3+1],jl),e.getVertex(A[x*3+2],ql);const Z=to.distanceSquared(d);!(ec.pointInTriangle(to,jl,gl,ql)||ec.pointInTriangle(to,gl,jl,ql))||Z>b||(ao.vectorToWorldFrame(t,a,I),ao.pointToWorldFrame(i,t,to,f),this.reportIntersection(I,f,s,r,x))}l.length=0}reportIntersection(e,t,i,r,s){const o=this.from,a=this.to,l=o.distanceTo(t),c=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(c.hitFaceIndex=typeof s<"u"?s:-1,this.mode){case ec.ALL:this.hasHit=!0,c.set(o,a,e,t,i,r,l),c.hasHit=!0,this.callback(c);break;case ec.CLOSEST:(l<c.distance||!c.hasHit)&&(this.hasHit=!0,c.hasHit=!0,c.set(o,a,e,t,i,r,l));break;case ec.ANY:this.hasHit=!0,c.hasHit=!0,c.set(o,a,e,t,i,r,l),c.shouldStop=!0;break}}static pointInTriangle(e,t,i,r){r.vsub(t,Mh),i.vsub(t,Hm),e.vsub(t,VM);const s=Mh.dot(Mh),o=Mh.dot(Hm),a=Mh.dot(VM),l=Hm.dot(Hm),c=Hm.dot(VM);let g,u;return(g=l*a-o*c)>=0&&(u=s*c-o*a)>=0&&g+u<s*l-o*o}};cp.CLOSEST=i5.CLOSEST;cp.ANY=i5.ANY;cp.ALL=i5.ALL;const mD=new Qa,_M=[],Hm=new re,VM=new re,t3e=new re,n3e=new Vs,to=new re,gl=new re,jl=new re,ql=new re;new re;new iF;const yD={faceList:[0]},kG=new re,i3e=new cp,r3e=[],s3e=new re,o3e=new re,a3e=new re;new re;new re;const vD=new re,l3e=new re,c3e=new re,g3e=new re,u3e=new re,d3e=new re,h3e=new re;new Qa;const f3e=[],I3e=new ao,Mh=new re,LG=new re;function A3e(n,e,t){t.vsub(n,Mh);const i=Mh.dot(e);return e.scale(i,LG),LG.vadd(n,LG),t.distanceTo(LG)}new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new cp;new re;new re;new re;new re(1,0,0),new re(0,1,0),new re(0,0,1);new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new Qa;new re;new Qa;new re;new re;new re;new re;new re;new re;new re;new Qa;new re;new ao;new Qa;Ct.types.SPHERE,Ct.types.SPHERE|Ct.types.PLANE,Ct.types.BOX|Ct.types.BOX,Ct.types.SPHERE|Ct.types.BOX,Ct.types.PLANE|Ct.types.BOX,Ct.types.CONVEXPOLYHEDRON,Ct.types.SPHERE|Ct.types.CONVEXPOLYHEDRON,Ct.types.PLANE|Ct.types.CONVEXPOLYHEDRON,Ct.types.BOX|Ct.types.CONVEXPOLYHEDRON,Ct.types.SPHERE|Ct.types.HEIGHTFIELD,Ct.types.BOX|Ct.types.HEIGHTFIELD,Ct.types.CONVEXPOLYHEDRON|Ct.types.HEIGHTFIELD,Ct.types.PARTICLE|Ct.types.SPHERE,Ct.types.PLANE|Ct.types.PARTICLE,Ct.types.BOX|Ct.types.PARTICLE,Ct.types.PARTICLE|Ct.types.CONVEXPOLYHEDRON,Ct.types.CYLINDER,Ct.types.SPHERE|Ct.types.CYLINDER,Ct.types.PLANE|Ct.types.CYLINDER,Ct.types.BOX|Ct.types.CYLINDER,Ct.types.CONVEXPOLYHEDRON|Ct.types.CYLINDER,Ct.types.HEIGHTFIELD|Ct.types.CYLINDER,Ct.types.PARTICLE|Ct.types.CYLINDER,Ct.types.SPHERE|Ct.types.TRIMESH,Ct.types.PLANE|Ct.types.TRIMESH;new re;new re;new re;new re;new re;new Vs;new Vs;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new Qa;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re,new re,new re,new re,new re,new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new Vs;new re;new re;new re;new re;new re;new re;new re;new re;new re;new Qa;new cp;const zm=globalThis.performance||{};if(!zm.now){let n=Date.now();zm.timing&&zm.timing.navigationStart&&(n=zm.timing.navigationStart),zm.now=()=>Date.now()-n}new re;const C3e=M.createContext(null),p3e=()=>M.useContext(C3e),Kq=M.createContext(null),m3e=()=>{const n=M.useContext(Kq);if(!n)throw new Error("Physics context not found. @react-three/cannon & components can only be used within a Physics provider");return n};new D(1,1,1);new D;new qe;const bD=new In;function y3e(n){const e=M.useRef(null);return n&&typeof n!="function"?n:e}function BD(n){return n.charAt(0).toUpperCase()+n.slice(1)}function wr(n,e){const t=e===void 0?"":`/${e}`;return typeof n=="function"?null:n&&n.current&&`${n.current.uuid}${t}`}const v3e=new Hi,b3e=new xn,B3e=n=>e=>n(v3e.setFromQuaternion(b3e.fromArray(e)).toArray());let Dq=0;function TM(n,e,t,i,r,s){return s===void 0&&(s="bodies"),o=>{const a=Dq++;t[a]={[i]:o};const l=wr(n,r);return l&&e.subscribe({props:{id:a,target:s,type:i},uuid:l}),()=>{delete t[a],e.unsubscribe({props:a})}}}function GD(n,e){let{position:t=[0,0,0],rotation:i=[0,0,0],userData:r={}}=e;n.userData=r,n.position.set(...t),n.rotation.set(...i),n.updateMatrix()}function wD(n,e,t){let{onCollide:i,onCollideBegin:r,onCollideEnd:s}=e;n[t]={collide:i,collideBegin:r,collideEnd:s}}function Pq(n,e,t,i,r){i===void 0&&(i=null),r===void 0&&(r=[]);const s=y3e(i),{events:o,refs:a,scaleOverrides:l,subscriptions:c,worker:g}=m3e(),u=p3e();M.useLayoutEffect(()=>{s.current||(s.current=new In);const h=s.current,f=g,I=h instanceof NA?(h.instanceMatrix.setUsage(d2),h.count):1,A=h instanceof NA?new Array(I).fill(0).map((y,v)=>`${h.uuid}/${v}`):[h.uuid],p=h instanceof NA?A.map((y,v)=>{const b=e(v);return GD(bD,b),h.setMatrixAt(v,bD.matrix),h.instanceMatrix.needsUpdate=!0,a[y]=h,u==null||u.add(y,b,n),wD(o,b,y),{...b,args:t(b.args)}}):A.map((y,v)=>{const b=e(v);return GD(h,b),a[y]=h,u==null||u.add(y,b,n),wD(o,b,y),{...b,args:t(b.args)}});return f.addBodies({props:p.map(y=>{let{onCollide:v,onCollideBegin:b,onCollideEnd:w,...G}=y;return{onCollide:!!v,...G}}),type:n,uuid:A}),()=>{A.forEach(y=>{delete a[y],u==null||u.remove(y),delete o[y]}),f.removeBodies({uuid:A})}},r);const d=M.useMemo(()=>{const h=(v,b)=>{const w=`set${BD(v)}`;return{set:G=>{const x=wr(s,b);x&&g[w]({props:G,uuid:x})},subscribe:TM(s,g,c,v,b)}},f=v=>({copy:w=>{let{w:G,x,y:B,z:R}=w;const Z=wr(s,v);Z&&g.setQuaternion({props:[x,B,R,G],uuid:Z})},set:(w,G,x,B)=>{const R=wr(s,v);R&&g.setQuaternion({props:[w,G,x,B],uuid:R})},subscribe:TM(s,g,c,"quaternion",v)}),I=v=>({copy:b=>{let{x:w,y:G,z:x}=b;const B=wr(s,v);B&&g.setRotation({props:[w,G,x],uuid:B})},set:(b,w,G)=>{const x=wr(s,v);x&&g.setRotation({props:[b,w,G],uuid:x})},subscribe:b=>{const w=Dq++,G="bodies",x="quaternion",B=wr(s,v);return c[w]={[x]:B3e(b)},B&&g.subscribe({props:{id:w,target:G,type:x},uuid:B}),()=>{delete c[w],g.unsubscribe({props:w})}}}),A=(v,b)=>{const w=`set${BD(v)}`;return{copy:G=>{let{x,y:B,z:R}=G;const Z=wr(s,b);Z&&g[w]({props:[x,B,R],uuid:Z})},set:(G,x,B)=>{const R=wr(s,b);R&&g[w]({props:[G,x,B],uuid:R})},subscribe:TM(s,g,c,v,b)}};function p(v){return{allowSleep:h("allowSleep",v),angularDamping:h("angularDamping",v),angularFactor:A("angularFactor",v),angularVelocity:A("angularVelocity",v),applyForce(b,w){const G=wr(s,v);G&&g.applyForce({props:[b,w],uuid:G})},applyImpulse(b,w){const G=wr(s,v);G&&g.applyImpulse({props:[b,w],uuid:G})},applyLocalForce(b,w){const G=wr(s,v);G&&g.applyLocalForce({props:[b,w],uuid:G})},applyLocalImpulse(b,w){const G=wr(s,v);G&&g.applyLocalImpulse({props:[b,w],uuid:G})},applyTorque(b){const w=wr(s,v);w&&g.applyTorque({props:[b],uuid:w})},collisionFilterGroup:h("collisionFilterGroup",v),collisionFilterMask:h("collisionFilterMask",v),collisionResponse:h("collisionResponse",v),fixedRotation:h("fixedRotation",v),isTrigger:h("isTrigger",v),linearDamping:h("linearDamping",v),linearFactor:A("linearFactor",v),mass:h("mass",v),material:h("material",v),position:A("position",v),quaternion:f(v),rotation:I(v),scaleOverride(b){const w=wr(s,v);w&&(l[w]=new D(...b))},sleep(){const b=wr(s,v);b&&g.sleep({uuid:b})},sleepSpeedLimit:h("sleepSpeedLimit",v),sleepTimeLimit:h("sleepTimeLimit",v),userData:h("userData",v),velocity:A("velocity",v),wakeUp(){const b=wr(s,v);b&&g.wakeUp({uuid:b})}}}const y={};return{...p(void 0),at:v=>y[v]||(y[v]=p(v))}},[]);return[s,d]}function G3e(n,e,t){return Pq("Plane",n,()=>[],e,t)}function w3e(n,e,t){return Pq("Compound",n,i=>i,e,t)}const x3e=new D,S3e=new D(1,1,1),R3e=new xn,HG=new qe;function xD(n,e,t,i,r){return i===void 0&&(i=S3e),n!==void 0?(HG.compose(x3e.fromArray(e,n*3),R3e.fromArray(t,n*4),i),r&&(r.matrixAutoUpdate=!1,r.matrix.copy(HG)),HG):HG.identity()}function Z3e(n){let{allowSleep:e=!1,axisIndex:t=0,broadphase:i="Naive",children:r,defaultContactMaterial:s={contactEquationStiffness:1e6},frictionGravity:o=null,gravity:a=[0,-9.81,0],isPaused:l=!1,iterations:c=5,maxSubSteps:g=10,quatNormalizeFast:u=!1,quatNormalizeSkip:d=0,shouldInvalidate:h=!0,size:f=1e3,solver:I="GS",stepSize:A=1/60,tolerance:p=.001}=n;const{invalidate:y}=Bt(),[{bodies:v,events:b,refs:w,scaleOverrides:G,subscriptions:x,worker:B}]=M.useState(()=>({bodies:{},events:{},refs:{},scaleOverrides:{},subscriptions:{},worker:new xEe({allowSleep:e,axisIndex:t,broadphase:i,defaultContactMaterial:s,frictionGravity:o,gravity:a,iterations:c,quatNormalizeFast:u,quatNormalizeSkip:d,size:f,solver:I,tolerance:p})}));let R=0;const Z=M.useCallback((J,H)=>{l||(R+=H,B.step({maxSubSteps:g,stepSize:A,timeSinceLastCalled:R}),R=0)},[l,g,A]),W=J=>{var H;let{body:Y,contact:{bi:K,bj:Q,...P},target:ne,...oe}=J;const $=(H=b[ne])==null?void 0:H.collide;$&&$({body:w[Y],contact:{bi:w[K],bj:w[Q],...P},target:w[ne],...oe})},F=J=>{var H,Y;let{bodyA:K,bodyB:Q}=J;const P=(H=b[K])==null?void 0:H.collideBegin;P&&P({body:w[Q],op:"event",target:w[K],type:"collideBegin"});const ne=(Y=b[Q])==null?void 0:Y.collideBegin;ne&&ne({body:w[K],op:"event",target:w[Q],type:"collideBegin"})},T=J=>{var H,Y;let{bodyA:K,bodyB:Q}=J;const P=(H=b[K])==null?void 0:H.collideEnd;P&&P({body:w[Q],op:"event",target:w[K],type:"collideEnd"});const ne=(Y=b[Q])==null?void 0:Y.collideEnd;ne&&ne({body:w[K],op:"event",target:w[Q],type:"collideEnd"})},V=J=>{let{active:H,bodies:Y=[],observations:K,positions:Q,quaternions:P}=J;for(let ne=0;ne<Y.length;ne++)v[Y[ne]]=ne;if(K.forEach(ne=>{let[oe,$,de]=ne;const se=(x[oe]||{})[de];se&&se($)}),H){for(const ne of Object.values(w))if(ne instanceof NA)for(let oe=0;oe<ne.count;oe++){const $=`${ne.uuid}/${oe}`,de=v[$];de!==void 0&&(ne.setMatrixAt(oe,xD(de,Q,P,G[$])),ne.instanceMatrix.needsUpdate=!0)}else{const oe=G[ne.uuid]||ne.scale;xD(v[ne.uuid],Q,P,oe,ne)}h&&y()}},z=J=>{var H;let{body:Y,ray:{uuid:K,...Q},...P}=J;const ne=(H=b[K])==null?void 0:H.rayhit;ne&&ne({body:Y?w[Y]:null,ray:{uuid:K,...Q},...P})};yn(Z),M.useEffect(()=>(B.connect(),B.init(),B.on("collide",W),B.on("collideBegin",F),B.on("collideEnd",T),B.on("frame",V),B.on("rayhit",z),()=>{B.terminate(),B.removeAllListeners()}),[]),M.useEffect(()=>{B.axisIndex=t},[t]),M.useEffect(()=>{B.broadphase=i},[i]),M.useEffect(()=>{B.gravity=a},[a]),M.useEffect(()=>{B.iterations=c},[c]),M.useEffect(()=>{B.tolerance=p},[p]);const U=M.useMemo(()=>({bodies:v,events:b,refs:w,scaleOverrides:G,subscriptions:x,worker:B}),[v,b,w,x,B]);return We(Kq.Provider,{value:U,children:r})}function M3e(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return t(i)!==null},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const r=t(i);return r===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}class E3e{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const i=this.workersResolve[e];if(i&&i(t),this.queue.length){const{resolve:r,msg:s,transfer:o}=this.queue.shift();this.workersResolve[e]=r,this.workers[e].postMessage(s,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(i=>{const r=this._getIdleWorker();r!==-1?(this._initWorker(r),this.workerStatus|=1<<r,this.workersResolve[r]=i,this.workers[r].postMessage(e,t)):this.queue.push({resolve:i,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const W3e=0,F3e=2,_3e=1,V3e=2,T3e=0,Uq=9,r5=15,Qq=16,s5=22,Oq=37,o5=43,Jq=76,jq=83,qq=97,$q=100,e$=103,t$=109;class N3e{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Xm{constructor(e,t,i,r){this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=r,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const i=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==t&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,r)}}const Rs=[171,75,84,88,32,50,48,187,13,10,26,10];function SD(n){return typeof TextDecoder<"u"?new TextDecoder().decode(n):Buffer.from(n).toString("utf8")}function k3e(n){const e=new Uint8Array(n.buffer,n.byteOffset,Rs.length);if(e[0]!==Rs[0]||e[1]!==Rs[1]||e[2]!==Rs[2]||e[3]!==Rs[3]||e[4]!==Rs[4]||e[5]!==Rs[5]||e[6]!==Rs[6]||e[7]!==Rs[7]||e[8]!==Rs[8]||e[9]!==Rs[9]||e[10]!==Rs[10]||e[11]!==Rs[11])throw new Error("Missing KTX 2.0 identifier.");const t=new N3e,i=17*Uint32Array.BYTES_PER_ELEMENT,r=new Xm(n,Rs.length,i,!0);t.vkFormat=r._nextUint32(),t.typeSize=r._nextUint32(),t.pixelWidth=r._nextUint32(),t.pixelHeight=r._nextUint32(),t.pixelDepth=r._nextUint32(),t.layerCount=r._nextUint32(),t.faceCount=r._nextUint32();const s=r._nextUint32();t.supercompressionScheme=r._nextUint32();const o=r._nextUint32(),a=r._nextUint32(),l=r._nextUint32(),c=r._nextUint32(),g=r._nextUint64(),u=r._nextUint64(),d=new Xm(n,Rs.length+i,3*s*8,!0);for(let J=0;J<s;J++)t.levels.push({levelData:new Uint8Array(n.buffer,n.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});const h=new Xm(n,o,a,!0),f={vendorId:h._skip(4)._nextUint16(),descriptorType:h._nextUint16(),versionNumber:h._nextUint16(),descriptorBlockSize:h._nextUint16(),colorModel:h._nextUint8(),colorPrimaries:h._nextUint8(),transferFunction:h._nextUint8(),flags:h._nextUint8(),texelBlockDimension:[h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8()],bytesPlane:[h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8()],samples:[]},I=(f.descriptorBlockSize/4-6)/4;for(let J=0;J<I;J++){const H={bitOffset:h._nextUint16(),bitLength:h._nextUint8(),channelType:h._nextUint8(),samplePosition:[h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&H.channelType?(H.sampleLower=h._nextInt32(),H.sampleUpper=h._nextInt32()):(H.sampleLower=h._nextUint32(),H.sampleUpper=h._nextUint32()),f.samples[J]=H}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(f);const A=new Xm(n,l,c,!0);for(;A._offset<c;){const J=A._nextUint32(),H=A._scan(J),Y=SD(H),K=A._scan(J-H.byteLength);t.keyValue[Y]=Y.match(/^ktx/i)?SD(K):K,A._offset%4&&A._skip(4-A._offset%4)}if(u<=0)return t;const p=new Xm(n,g,u,!0),y=p._nextUint16(),v=p._nextUint16(),b=p._nextUint32(),w=p._nextUint32(),G=p._nextUint32(),x=p._nextUint32(),B=[];for(let J=0;J<s;J++)B.push({imageFlags:p._nextUint32(),rgbSliceByteOffset:p._nextUint32(),rgbSliceByteLength:p._nextUint32(),alphaSliceByteOffset:p._nextUint32(),alphaSliceByteLength:p._nextUint32()});const R=g+p._offset,Z=R+b,W=Z+w,F=W+G,T=new Uint8Array(n.buffer,n.byteOffset+R,b),V=new Uint8Array(n.buffer,n.byteOffset+Z,w),z=new Uint8Array(n.buffer,n.byteOffset+W,G),U=new Uint8Array(n.buffer,n.byteOffset+F,x);return t.globalData={endpointCount:y,selectorCount:v,imageDescs:B,endpointsData:T,selectorsData:V,tablesData:z,extendedData:U},t}let NM,dg,rF;const kM={env:{emscripten_notify_memory_growth:function(n){rF=new Uint8Array(dg.exports.memory.buffer)}}};class L3e{init(){return NM||(NM=typeof fetch<"u"?fetch("data:application/wasm;base64,"+RD).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,kM)).then(this._init):WebAssembly.instantiate(Buffer.from(RD,"base64"),kM).then(this._init),NM)}_init(e){dg=e.instance,kM.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!dg)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=e.byteLength,r=dg.exports.malloc(i);rF.set(e,r),t=t||Number(dg.exports.ZSTD_findDecompressedSize(r,i));const s=dg.exports.malloc(t),o=dg.exports.ZSTD_decompress(s,t,r,i),a=rF.slice(s,s+o);return dg.exports.free(r),dg.exports.free(s),a}}const RD="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",LM=new WeakMap;let HM=0,zM;class Ic extends Gx{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new E3e,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const e=new fM(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),i=new fM(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const r=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,r]).then(([s,o])=>{const a=Ic.BasisWorker.toString(),l=["/* constants */","let _EngineFormat = "+JSON.stringify(Ic.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Ic.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Ic.BasisFormat),"/* basis_transcoder.js */",s,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([l])),this.transcoderBinary=o,this.workerPool.setWorkerCreator(()=>{const c=new Worker(this.workerSourceURL),g=this.transcoderBinary.slice(0);return c.postMessage({type:"init",config:this.workerConfig,transcoderBinary:g},[g]),c})}),HM>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),HM++}return this.transcoderPending}load(e,t,i,r){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const s=new fM(this.manager);s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials),s.load(e,o=>{if(LM.has(o))return LM.get(o).promise.then(t).catch(r);this._createTexture(o).then(a=>t?t(a):null).catch(r)},i,r)}_createTextureFrom(e,t){const{mipmaps:i,width:r,height:s,format:o,type:a,error:l,dfdTransferFn:c,dfdFlags:g}=e;if(a==="error")return Promise.reject(l);const u=t.layerCount>1?new AZe(i,r,s,t.layerCount,o,oc):new X6(i,r,s,o,oc);return u.minFilter=i.length===1?BC:zT,u.magFilter=BC,u.generateMipmaps=!1,u.needsUpdate=!0,u.encoding=c===V3e?Z1:XT,u.premultiplyAlpha=!!(g&_3e),u}async _createTexture(e,t={}){const i=k3e(new Uint8Array(e));if(i.vkFormat!==T3e)return z3e(i);const r=t,s=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:r},[e])).then(o=>this._createTextureFrom(o.data,i));return LM.set(e,{promise:s}),s}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),HM--,this}}Ic.BasisFormat={ETC1S:0,UASTC_4x4:1};Ic.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16};Ic.EngineFormat={RGBAFormat:Yh,RGBA_ASTC_4x4_Format:pRe,RGBA_BPTC_Format:mRe,RGBA_ETC2_EAC_Format:CRe,RGBA_PVRTC_4BPPV1_Format:fRe,RGBA_S3TC_DXT5_Format:dRe,RGB_ETC1_Format:IRe,RGB_ETC2_Format:ARe,RGB_PVRTC_4BPPV1_Format:hRe,RGB_S3TC_DXT1_Format:uRe};Ic.BasisWorker=function(){let n,e,t;const i=_EngineFormat,r=_TranscoderFormat,s=_BasisFormat;self.addEventListener("message",function(f){const I=f.data;switch(I.type){case"init":n=I.config,o(I.transcoderBinary);break;case"transcode":e.then(()=>{try{const{width:A,height:p,hasAlpha:y,mipmaps:v,format:b,dfdTransferFn:w,dfdFlags:G}=a(I.buffer),x=[];for(let B=0;B<v.length;++B)x.push(v[B].data.buffer);self.postMessage({type:"transcode",id:I.id,width:A,height:p,hasAlpha:y,mipmaps:v,format:b,dfdTransferFn:w,dfdFlags:G},x)}catch(A){console.error(A),self.postMessage({type:"error",id:I.id,error:A.message})}});break}});function o(f){e=new Promise(I=>{t={wasmBinary:f,onRuntimeInitialized:I},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function a(f){const I=new t.KTX2File(new Uint8Array(f));function A(){I.close(),I.delete()}if(!I.isValid())throw A(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const p=I.isUASTC()?s.UASTC_4x4:s.ETC1S,y=I.getWidth(),v=I.getHeight(),b=I.getLayers()||1,w=I.getLevels(),G=I.getHasAlpha(),x=I.getDFDTransferFunc(),B=I.getDFDFlags(),{transcoderFormat:R,engineFormat:Z}=u(p,y,v,G);if(!y||!v||!w)throw A(),new Error("THREE.KTX2Loader:	Invalid texture");if(!I.startTranscoding())throw A(),new Error("THREE.KTX2Loader: .startTranscoding failed");const W=[];for(let F=0;F<w;F++){const T=[];let V,z;for(let U=0;U<b;U++){const J=I.getImageLevelInfo(F,U,0);V=J.origWidth<4?J.origWidth:J.width,z=J.origHeight<4?J.origHeight:J.height;const H=new Uint8Array(I.getImageTranscodedSizeInBytes(F,U,0,R));if(!I.transcodeImage(H,F,U,0,R,0,-1,-1))throw A(),new Error("THREE.KTX2Loader: .transcodeImage failed.");T.push(H)}W.push({data:h(T),width:V,height:z})}return A(),{width:y,height:v,hasAlpha:G,mipmaps:W,format:Z,dfdTransferFn:x,dfdFlags:B}}const l=[{if:"astcSupported",basisFormat:[s.UASTC_4x4],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.BC1,r.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],c=l.sort(function(f,I){return f.priorityETC1S-I.priorityETC1S}),g=l.sort(function(f,I){return f.priorityUASTC-I.priorityUASTC});function u(f,I,A,p){let y,v;const b=f===s.ETC1S?c:g;for(let w=0;w<b.length;w++){const G=b[w];if(n[G.if]&&G.basisFormat.includes(f)&&!(p&&G.transcoderFormat.length<2)&&!(G.needsPowerOfTwo&&!(d(I)&&d(A))))return y=G.transcoderFormat[p?1:0],v=G.engineFormat[p?1:0],{transcoderFormat:y,engineFormat:v}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),y=r.RGBA32,v=i.RGBAFormat,{transcoderFormat:y,engineFormat:v}}function d(f){return f<=2?!0:(f&f-1)===0&&f!==0}function h(f){let I=0;for(const y of f)I+=y.byteLength;const A=new Uint8Array(I);let p=0;for(const y of f)A.set(y,p),p+=y.byteLength;return A}};const ZD={[t$]:Yh,[qq]:Yh,[Oq]:Yh,[o5]:Yh,[e$]:CG,[jq]:CG,[Qq]:CG,[s5]:CG,[$q]:AG,[Jq]:AG,[r5]:AG,[Uq]:AG},XM={[t$]:S1,[qq]:R1,[Oq]:oc,[o5]:oc,[e$]:S1,[jq]:R1,[Qq]:oc,[s5]:oc,[$q]:S1,[Jq]:R1,[r5]:oc,[Uq]:oc},H3e={[o5]:Z1,[s5]:Z1,[r5]:Z1};async function z3e(n){const{vkFormat:e,pixelWidth:t,pixelHeight:i,pixelDepth:r}=n;if(ZD[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const s=n.levels[0];let o,a;if(n.supercompressionScheme===W3e)o=s.levelData;else if(n.supercompressionScheme===F3e)zM||(zM=new Promise(async c=>{const g=new L3e;await g.init(),c(g)})),o=(await zM).decode(s.levelData,s.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");XM[e]===S1?a=new Float32Array(o.buffer,o.byteOffset,o.byteLength/Float32Array.BYTES_PER_ELEMENT):XM[e]===R1?a=new Uint16Array(o.buffer,o.byteOffset,o.byteLength/Uint16Array.BYTES_PER_ELEMENT):a=o;const l=r===0?new IZe(a,t,i):new PRe(a,t,i,r);return l.type=XM[e],l.format=ZD[e],l.encoding=H3e[e]||XT,l.needsUpdate=!0,Promise.resolve(l)}function X3e(n,e=!1){const t=n[0].index!==null,i=new Set(Object.keys(n[0].attributes)),r=new Set(Object.keys(n[0].morphAttributes)),s={},o={},a=n[0].morphTargetsRelative,l=new tp;let c=0;for(let g=0;g<n.length;++g){const u=n[g];let d=0;if(t!==(u.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+g+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const h in u.attributes){if(!i.has(h))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+g+'. All geometries must have compatible attributes; make sure "'+h+'" attribute exists among all geometries, or in none of them.'),null;s[h]===void 0&&(s[h]=[]),s[h].push(u.attributes[h]),d++}if(d!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+g+". Make sure all geometries have the same number of attributes."),null;if(a!==u.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+g+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const h in u.morphAttributes){if(!r.has(h))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+g+".  .morphAttributes must be consistent throughout all geometries."),null;o[h]===void 0&&(o[h]=[]),o[h].push(u.morphAttributes[h])}if(e){let h;if(t)h=u.index.count;else if(u.attributes.position!==void 0)h=u.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+g+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,h,g),c+=h}}if(t){let g=0;const u=[];for(let d=0;d<n.length;++d){const h=n[d].index;for(let f=0;f<h.count;++f)u.push(h.getX(f)+g);g+=n[d].attributes.position.count}l.setIndex(u)}for(const g in s){const u=MD(s[g]);if(!u)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+g+" attribute."),null;l.setAttribute(g,u)}for(const g in o){const u=o[g][0].length;if(u===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[g]=[];for(let d=0;d<u;++d){const h=[];for(let I=0;I<o[g].length;++I)h.push(o[g][I][d]);const f=MD(h);if(!f)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+g+" morphAttribute."),null;l.morphAttributes[g].push(f)}}return l}function MD(n){let e,t,i,r=0;for(let a=0;a<n.length;++a){const l=n[a];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=l.array.constructor),e!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=l.itemSize),t!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(i===void 0&&(i=l.normalized),i!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;r+=l.array.length}const s=new e(r);let o=0;for(let a=0;a<n.length;++a)s.set(n[a].array,o),o+=n[a].array.length;return new sf(s,t,i)}function Y3e(n,e=!1){return console.warn("THREE.BufferGeometryUtils: mergeBufferGeometries() has been renamed to mergeGeometries()."),X3e(n,e)}function K3e(n){if(n.sheet)return n.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===n)return document.styleSheets[e]}function D3e(n){var e=document.createElement("style");return e.setAttribute("data-emotion",n.key),n.nonce!==void 0&&e.setAttribute("nonce",n.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var P3e=function(){function n(t){var i=this;this._insertTag=function(r){var s;i.tags.length===0?i.insertionPoint?s=i.insertionPoint.nextSibling:i.prepend?s=i.container.firstChild:s=i.before:s=i.tags[i.tags.length-1].nextSibling,i.container.insertBefore(r,s),i.tags.push(r)},this.isSpeedy=t.speedy===void 0?!0:t.speedy,this.tags=[],this.ctr=0,this.nonce=t.nonce,this.key=t.key,this.container=t.container,this.prepend=t.prepend,this.insertionPoint=t.insertionPoint,this.before=null}var e=n.prototype;return e.hydrate=function(i){i.forEach(this._insertTag)},e.insert=function(i){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(D3e(this));var r=this.tags[this.tags.length-1];if(this.isSpeedy){var s=K3e(r);try{s.insertRule(i,s.cssRules.length)}catch{}}else r.appendChild(document.createTextNode(i));this.ctr++},e.flush=function(){this.tags.forEach(function(i){return i.parentNode&&i.parentNode.removeChild(i)}),this.tags=[],this.ctr=0},n}(),ts="-ms-",ew="-moz-",Cn="-webkit-",n$="comm",a5="rule",l5="decl",U3e="@import",i$="@keyframes",Q3e="@layer",O3e=Math.abs,_x=String.fromCharCode,J3e=Object.assign;function j3e(n,e){return Sr(n,0)^45?(((e<<2^Sr(n,0))<<2^Sr(n,1))<<2^Sr(n,2))<<2^Sr(n,3):0}function r$(n){return n.trim()}function q3e(n,e){return(n=e.exec(n))?n[0]:n}function pn(n,e,t){return n.replace(e,t)}function sF(n,e){return n.indexOf(e)}function Sr(n,e){return n.charCodeAt(e)|0}function Uy(n,e,t){return n.slice(e,t)}function lc(n){return n.length}function c5(n){return n.length}function zG(n,e){return e.push(n),n}function $3e(n,e){return n.map(e).join("")}var Vx=1,SC=1,s$=0,Ro=0,Xi=0,gp="";function Tx(n,e,t,i,r,s,o){return{value:n,root:e,parent:t,type:i,props:r,children:s,line:Vx,column:SC,length:o,return:""}}function Ym(n,e){return J3e(Tx("",null,null,"",null,null,0),n,{length:-n.length},e)}function eWe(){return Xi}function tWe(){return Xi=Ro>0?Sr(gp,--Ro):0,SC--,Xi===10&&(SC=1,Vx--),Xi}function $o(){return Xi=Ro<s$?Sr(gp,Ro++):0,SC++,Xi===10&&(SC=1,Vx++),Xi}function Gc(){return Sr(gp,Ro)}function E1(){return Ro}function zv(n,e){return Uy(gp,n,e)}function Qy(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function o$(n){return Vx=SC=1,s$=lc(gp=n),Ro=0,[]}function a$(n){return gp="",n}function W1(n){return r$(zv(Ro-1,oF(n===91?n+2:n===40?n+1:n)))}function nWe(n){for(;(Xi=Gc())&&Xi<33;)$o();return Qy(n)>2||Qy(Xi)>3?"":" "}function iWe(n,e){for(;--e&&$o()&&!(Xi<48||Xi>102||Xi>57&&Xi<65||Xi>70&&Xi<97););return zv(n,E1()+(e<6&&Gc()==32&&$o()==32))}function oF(n){for(;$o();)switch(Xi){case n:return Ro;case 34:case 39:n!==34&&n!==39&&oF(Xi);break;case 40:n===41&&oF(n);break;case 92:$o();break}return Ro}function rWe(n,e){for(;$o()&&n+Xi!==47+10;)if(n+Xi===42+42&&Gc()===47)break;return"/*"+zv(e,Ro-1)+"*"+_x(n===47?n:$o())}function sWe(n){for(;!Qy(Gc());)$o();return zv(n,Ro)}function oWe(n){return a$(F1("",null,null,null,[""],n=o$(n),0,[0],n))}function F1(n,e,t,i,r,s,o,a,l){for(var c=0,g=0,u=o,d=0,h=0,f=0,I=1,A=1,p=1,y=0,v="",b=r,w=s,G=i,x=v;A;)switch(f=y,y=$o()){case 40:if(f!=108&&Sr(x,u-1)==58){sF(x+=pn(W1(y),"&","&\f"),"&\f")!=-1&&(p=-1);break}case 34:case 39:case 91:x+=W1(y);break;case 9:case 10:case 13:case 32:x+=nWe(f);break;case 92:x+=iWe(E1()-1,7);continue;case 47:switch(Gc()){case 42:case 47:zG(aWe(rWe($o(),E1()),e,t),l);break;default:x+="/"}break;case 123*I:a[c++]=lc(x)*p;case 125*I:case 59:case 0:switch(y){case 0:case 125:A=0;case 59+g:p==-1&&(x=pn(x,/\f/g,"")),h>0&&lc(x)-u&&zG(h>32?WD(x+";",i,t,u-1):WD(pn(x," ","")+";",i,t,u-2),l);break;case 59:x+=";";default:if(zG(G=ED(x,e,t,c,g,r,a,v,b=[],w=[],u),s),y===123)if(g===0)F1(x,e,G,G,b,s,u,a,w);else switch(d===99&&Sr(x,3)===110?100:d){case 100:case 108:case 109:case 115:F1(n,G,G,i&&zG(ED(n,G,G,0,0,r,a,v,r,b=[],u),w),r,w,u,a,i?b:w);break;default:F1(x,G,G,G,[""],w,0,a,w)}}c=g=h=0,I=p=1,v=x="",u=o;break;case 58:u=1+lc(x),h=f;default:if(I<1){if(y==123)--I;else if(y==125&&I++==0&&tWe()==125)continue}switch(x+=_x(y),y*I){case 38:p=g>0?1:(x+="\f",-1);break;case 44:a[c++]=(lc(x)-1)*p,p=1;break;case 64:Gc()===45&&(x+=W1($o())),d=Gc(),g=u=lc(v=x+=sWe(E1())),y++;break;case 45:f===45&&lc(x)==2&&(I=0)}}return s}function ED(n,e,t,i,r,s,o,a,l,c,g){for(var u=r-1,d=r===0?s:[""],h=c5(d),f=0,I=0,A=0;f<i;++f)for(var p=0,y=Uy(n,u+1,u=O3e(I=o[f])),v=n;p<h;++p)(v=r$(I>0?d[p]+" "+y:pn(y,/&\f/g,d[p])))&&(l[A++]=v);return Tx(n,e,t,r===0?a5:a,l,c,g)}function aWe(n,e,t){return Tx(n,e,t,n$,_x(eWe()),Uy(n,2,-2),0)}function WD(n,e,t,i){return Tx(n,e,t,l5,Uy(n,0,i),Uy(n,i+1,-1),i)}function OA(n,e){for(var t="",i=c5(n),r=0;r<i;r++)t+=e(n[r],r,n,e)||"";return t}function lWe(n,e,t,i){switch(n.type){case Q3e:if(n.children.length)break;case U3e:case l5:return n.return=n.return||n.value;case n$:return"";case i$:return n.return=n.value+"{"+OA(n.children,i)+"}";case a5:n.value=n.props.join(",")}return lc(t=OA(n.children,i))?n.return=n.value+"{"+t+"}":""}function cWe(n){var e=c5(n);return function(t,i,r,s){for(var o="",a=0;a<e;a++)o+=n[a](t,i,r,s)||"";return o}}function gWe(n){return function(e){e.root||(e=e.return)&&n(e)}}function l$(n){var e=Object.create(null);return function(t){return e[t]===void 0&&(e[t]=n(t)),e[t]}}var uWe=function(e,t,i){for(var r=0,s=0;r=s,s=Gc(),r===38&&s===12&&(t[i]=1),!Qy(s);)$o();return zv(e,Ro)},dWe=function(e,t){var i=-1,r=44;do switch(Qy(r)){case 0:r===38&&Gc()===12&&(t[i]=1),e[i]+=uWe(Ro-1,t,i);break;case 2:e[i]+=W1(r);break;case 4:if(r===44){e[++i]=Gc()===58?"&\f":"",t[i]=e[i].length;break}default:e[i]+=_x(r)}while(r=$o());return e},hWe=function(e,t){return a$(dWe(o$(e),t))},FD=new WeakMap,fWe=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var t=e.value,i=e.parent,r=e.column===i.column&&e.line===i.line;i.type!=="rule";)if(i=i.parent,!i)return;if(!(e.props.length===1&&t.charCodeAt(0)!==58&&!FD.get(i))&&!r){FD.set(e,!0);for(var s=[],o=hWe(t,s),a=i.props,l=0,c=0;l<o.length;l++)for(var g=0;g<a.length;g++,c++)e.props[c]=s[l]?o[l].replace(/&\f/g,a[g]):a[g]+" "+o[l]}}},IWe=function(e){if(e.type==="decl"){var t=e.value;t.charCodeAt(0)===108&&t.charCodeAt(2)===98&&(e.return="",e.value="")}};function c$(n,e){switch(j3e(n,e)){case 5103:return Cn+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Cn+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return Cn+n+ew+n+ts+n+n;case 6828:case 4268:return Cn+n+ts+n+n;case 6165:return Cn+n+ts+"flex-"+n+n;case 5187:return Cn+n+pn(n,/(\w+).+(:[^]+)/,Cn+"box-$1$2"+ts+"flex-$1$2")+n;case 5443:return Cn+n+ts+"flex-item-"+pn(n,/flex-|-self/,"")+n;case 4675:return Cn+n+ts+"flex-line-pack"+pn(n,/align-content|flex-|-self/,"")+n;case 5548:return Cn+n+ts+pn(n,"shrink","negative")+n;case 5292:return Cn+n+ts+pn(n,"basis","preferred-size")+n;case 6060:return Cn+"box-"+pn(n,"-grow","")+Cn+n+ts+pn(n,"grow","positive")+n;case 4554:return Cn+pn(n,/([^-])(transform)/g,"$1"+Cn+"$2")+n;case 6187:return pn(pn(pn(n,/(zoom-|grab)/,Cn+"$1"),/(image-set)/,Cn+"$1"),n,"")+n;case 5495:case 3959:return pn(n,/(image-set\([^]*)/,Cn+"$1$`$1");case 4968:return pn(pn(n,/(.+:)(flex-)?(.*)/,Cn+"box-pack:$3"+ts+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Cn+n+n;case 4095:case 3583:case 4068:case 2532:return pn(n,/(.+)-inline(.+)/,Cn+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(lc(n)-1-e>6)switch(Sr(n,e+1)){case 109:if(Sr(n,e+4)!==45)break;case 102:return pn(n,/(.+:)(.+)-([^]+)/,"$1"+Cn+"$2-$3$1"+ew+(Sr(n,e+3)==108?"$3":"$2-$3"))+n;case 115:return~sF(n,"stretch")?c$(pn(n,"stretch","fill-available"),e)+n:n}break;case 4949:if(Sr(n,e+1)!==115)break;case 6444:switch(Sr(n,lc(n)-3-(~sF(n,"!important")&&10))){case 107:return pn(n,":",":"+Cn)+n;case 101:return pn(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Cn+(Sr(n,14)===45?"inline-":"")+"box$3$1"+Cn+"$2$3$1"+ts+"$2box$3")+n}break;case 5936:switch(Sr(n,e+11)){case 114:return Cn+n+ts+pn(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return Cn+n+ts+pn(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return Cn+n+ts+pn(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return Cn+n+ts+n+n}return n}var AWe=function(e,t,i,r){if(e.length>-1&&!e.return)switch(e.type){case l5:e.return=c$(e.value,e.length);break;case i$:return OA([Ym(e,{value:pn(e.value,"@","@"+Cn)})],r);case a5:if(e.length)return $3e(e.props,function(s){switch(q3e(s,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return OA([Ym(e,{props:[pn(s,/:(read-\w+)/,":"+ew+"$1")]})],r);case"::placeholder":return OA([Ym(e,{props:[pn(s,/:(plac\w+)/,":"+Cn+"input-$1")]}),Ym(e,{props:[pn(s,/:(plac\w+)/,":"+ew+"$1")]}),Ym(e,{props:[pn(s,/:(plac\w+)/,ts+"input-$1")]})],r)}return""})}},CWe=[AWe],pWe=function(e){var t=e.key;if(t==="css"){var i=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(i,function(I){var A=I.getAttribute("data-emotion");A.indexOf(" ")!==-1&&(document.head.appendChild(I),I.setAttribute("data-s",""))})}var r=e.stylisPlugins||CWe,s={},o,a=[];o=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),function(I){for(var A=I.getAttribute("data-emotion").split(" "),p=1;p<A.length;p++)s[A[p]]=!0;a.push(I)});var l,c=[fWe,IWe];{var g,u=[lWe,gWe(function(I){g.insert(I)})],d=cWe(c.concat(r,u)),h=function(A){return OA(oWe(A),d)};l=function(A,p,y,v){g=y,h(A?A+"{"+p.styles+"}":p.styles),v&&(f.inserted[p.name]=!0)}}var f={key:t,sheet:new P3e({key:t,container:o,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:s,registered:{},insert:l};return f.sheet.hydrate(a),f},mWe=!0;function yWe(n,e,t){var i="";return t.split(" ").forEach(function(r){n[r]!==void 0?e.push(n[r]+";"):i+=r+" "}),i}var g$=function(e,t,i){var r=e.key+"-"+t.name;(i===!1||mWe===!1)&&e.registered[r]===void 0&&(e.registered[r]=t.styles)},u$=function(e,t,i){g$(e,t,i);var r=e.key+"-"+t.name;if(e.inserted[t.name]===void 0){var s=t;do e.insert(t===s?"."+r:"",s,e.sheet,!0),s=s.next;while(s!==void 0)}};function vWe(n){for(var e=0,t,i=0,r=n.length;r>=4;++i,r-=4)t=n.charCodeAt(i)&255|(n.charCodeAt(++i)&255)<<8|(n.charCodeAt(++i)&255)<<16|(n.charCodeAt(++i)&255)<<24,t=(t&65535)*1540483477+((t>>>16)*59797<<16),t^=t>>>24,e=(t&65535)*1540483477+((t>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(r){case 3:e^=(n.charCodeAt(i+2)&255)<<16;case 2:e^=(n.charCodeAt(i+1)&255)<<8;case 1:e^=n.charCodeAt(i)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var bWe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},BWe=/[A-Z]|^ms/g,GWe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,d$=function(e){return e.charCodeAt(1)===45},_D=function(e){return e!=null&&typeof e!="boolean"},YM=l$(function(n){return d$(n)?n:n.replace(BWe,"-$&").toLowerCase()}),VD=function(e,t){switch(e){case"animation":case"animationName":if(typeof t=="string")return t.replace(GWe,function(i,r,s){return cc={name:r,styles:s,next:cc},r})}return bWe[e]!==1&&!d$(e)&&typeof t=="number"&&t!==0?t+"px":t};function Oy(n,e,t){if(t==null)return"";if(t.__emotion_styles!==void 0)return t;switch(typeof t){case"boolean":return"";case"object":{if(t.anim===1)return cc={name:t.name,styles:t.styles,next:cc},t.name;if(t.styles!==void 0){var i=t.next;if(i!==void 0)for(;i!==void 0;)cc={name:i.name,styles:i.styles,next:cc},i=i.next;var r=t.styles+";";return r}return wWe(n,e,t)}case"function":{if(n!==void 0){var s=cc,o=t(n);return cc=s,Oy(n,e,o)}break}}if(e==null)return t;var a=e[t];return a!==void 0?a:t}function wWe(n,e,t){var i="";if(Array.isArray(t))for(var r=0;r<t.length;r++)i+=Oy(n,e,t[r])+";";else for(var s in t){var o=t[s];if(typeof o!="object")e!=null&&e[o]!==void 0?i+=s+"{"+e[o]+"}":_D(o)&&(i+=YM(s)+":"+VD(s,o)+";");else if(Array.isArray(o)&&typeof o[0]=="string"&&(e==null||e[o[0]]===void 0))for(var a=0;a<o.length;a++)_D(o[a])&&(i+=YM(s)+":"+VD(s,o[a])+";");else{var l=Oy(n,e,o);switch(s){case"animation":case"animationName":{i+=YM(s)+":"+l+";";break}default:i+=s+"{"+l+"}"}}}return i}var TD=/label:\s*([^\s;\n{]+)\s*(;|$)/g,cc,g5=function(e,t,i){if(e.length===1&&typeof e[0]=="object"&&e[0]!==null&&e[0].styles!==void 0)return e[0];var r=!0,s="";cc=void 0;var o=e[0];o==null||o.raw===void 0?(r=!1,s+=Oy(i,t,o)):s+=o[0];for(var a=1;a<e.length;a++)s+=Oy(i,t,e[a]),r&&(s+=o[a]);TD.lastIndex=0;for(var l="",c;(c=TD.exec(s))!==null;)l+="-"+c[1];var g=vWe(s)+l;return{name:g,styles:s,next:cc}},xWe=function(e){return e()},h$=UM["useInsertionEffect"]?UM["useInsertionEffect"]:!1,SWe=h$||xWe,ND=h$||M.useLayoutEffect,f$=M.createContext(typeof HTMLElement<"u"?pWe({key:"css"}):null);f$.Provider;var I$=function(e){return M.forwardRef(function(t,i){var r=M.useContext(f$);return e(t,r,i)})},A$=M.createContext({}),C$=I$(function(n,e){var t=n.styles,i=g5([t],void 0,M.useContext(A$)),r=M.useRef();return ND(function(){var s=e.key+"-global",o=new e.sheet.constructor({key:s,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),a=!1,l=document.querySelector('style[data-emotion="'+s+" "+i.name+'"]');return e.sheet.tags.length&&(o.before=e.sheet.tags[0]),l!==null&&(a=!0,l.setAttribute("data-emotion",s),o.hydrate([l])),r.current=[o,a],function(){o.flush()}},[e]),ND(function(){var s=r.current,o=s[0],a=s[1];if(a){s[1]=!1;return}if(i.next!==void 0&&u$(e,i.next,!0),o.tags.length){var l=o.tags[o.tags.length-1].nextElementSibling;o.before=l,o.flush()}e.insert("",i,o,!1)},[e,i.name]),null});function u5(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return g5(e)}var p$=function(){var e=u5.apply(void 0,arguments),t="animation-"+e.name;return{name:t,styles:"@keyframes "+t+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}};const m$=(n,e)=>{const t=e.x-n.x,i=e.y-n.y;return Math.sqrt(t*t+i*i)},RWe=(n,e)=>{const t=e.x-n.x,i=e.y-n.y;return MWe(Math.atan2(i,t))},ZWe=(n,e,t)=>{const i={x:0,y:0};return t=aF(t),i.x=n.x-e*Math.cos(t),i.y=n.y-e*Math.sin(t),i},aF=n=>n*(Math.PI/180),MWe=n=>n*(180/Math.PI),lF=(n,e,t)=>{const i=e.split(/[ ,]+/g);let r;for(let s=0;s<i.length;s+=1)r=i[s],n.addEventListener?n.addEventListener(r,t,!1):n.attachEvent&&n.attachEvent(r,t)},kD=(n,e,t)=>{const i=e.split(/[ ,]+/g);let r;for(let s=0;s<i.length;s+=1)r=i[s],n.removeEventListener?n.removeEventListener(r,t):n.detachEvent&&n.detachEvent(r,t)},y$=n=>(n.preventDefault(),n.type.match(/^touch/)?n.changedTouches:n),v$=()=>{const n=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,e=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:n,y:e}},cF=(n,e)=>{e.top||e.right||e.bottom||e.left?(n.style.top=e.top,n.style.right=e.right,n.style.bottom=e.bottom,n.style.left=e.left):(n.style.left=e.x+"px",n.style.top=e.y+"px")},d5=(n,e,t)=>{const i=b$(n);for(let r in i)if(i.hasOwnProperty(r))if(typeof e=="string")i[r]=e+" "+t;else{let s="";for(let o=0,a=e.length;o<a;o+=1)s+=e[o]+" "+t+", ";i[r]=s.slice(0,-2)}return i},EWe=(n,e)=>{const t=b$(n);for(let i in t)t.hasOwnProperty(i)&&(t[i]=e);return t},b$=n=>{const e={};return e[n]="",["webkit","Moz","o"].forEach(function(i){e[i+n.charAt(0).toUpperCase()+n.slice(1)]=""}),e},KM=(n,e)=>{for(let t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n},WWe=(n,e)=>{const t={};for(let i in n)n.hasOwnProperty(i)&&e.hasOwnProperty(i)?t[i]=e[i]:n.hasOwnProperty(i)&&(t[i]=n[i]);return t},gF=(n,e)=>{if(n.length)for(let t=0,i=n.length;t<i;t+=1)e(n[t]);else e(n)};var FWe="ontouchstart"in window,_We=!!window.PointerEvent,VWe=!!window.MSPointerEvent,Km={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},SA,Jy={};_We?SA=Km.pointer:VWe?SA=Km.MSPointer:FWe?(SA=Km.touch,Jy=Km.mouse):SA=Km.mouse;function ru(){}ru.prototype.on=function(n,e){var t=this,i=n.split(/[ ,]+/g),r;t._handlers_=t._handlers_||{};for(var s=0;s<i.length;s+=1)r=i[s],t._handlers_[r]=t._handlers_[r]||[],t._handlers_[r].push(e);return t};ru.prototype.off=function(n,e){var t=this;return t._handlers_=t._handlers_||{},n===void 0?t._handlers_={}:e===void 0?t._handlers_[n]=null:t._handlers_[n]&&t._handlers_[n].indexOf(e)>=0&&t._handlers_[n].splice(t._handlers_[n].indexOf(e),1),t};ru.prototype.trigger=function(n,e){var t=this,i=n.split(/[ ,]+/g),r;t._handlers_=t._handlers_||{};for(var s=0;s<i.length;s+=1)r=i[s],t._handlers_[r]&&t._handlers_[r].length&&t._handlers_[r].forEach(function(o){o.call(t,{type:r,target:t},e)})};ru.prototype.config=function(n){var e=this;e.options=e.defaults||{},n&&(e.options=WWe(e.options,n))};ru.prototype.bindEvt=function(n,e){var t=this;return t._domHandlers_=t._domHandlers_||{},t._domHandlers_[e]=function(){typeof t["on"+e]=="function"?t["on"+e].apply(t,arguments):console.warn('[WARNING] : Missing "on'+e+'" handler.')},lF(n,SA[e],t._domHandlers_[e]),Jy[e]&&lF(n,Jy[e],t._domHandlers_[e]),t};ru.prototype.unbindEvt=function(n,e){var t=this;return t._domHandlers_=t._domHandlers_||{},kD(n,SA[e],t._domHandlers_[e]),Jy[e]&&kD(n,Jy[e],t._domHandlers_[e]),delete t._domHandlers_[e],this};function rr(n,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=n,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1},this.config(e),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=rr.id,rr.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}rr.prototype=new ru;rr.constructor=rr;rr.id=0;rr.prototype.buildEl=function(n){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};rr.prototype.stylize=function(){if(this.options.dataOnly)return this;var n=this.options.fadeTime+"ms",e=EWe("borderRadius","50%"),t=d5("transition","opacity",n),i={};return i.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},i.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},i.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5"},KM(i.el,t),KM(i.back,e),KM(i.front,e),this.applyStyles(i),this};rr.prototype.applyStyles=function(n){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var t in n[e])this.ui[e].style[t]=n[e][t];return this};rr.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};rr.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};rr.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};rr.prototype.show=function(n){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout(function(){e.ui.el.style.opacity=1},0),e.showTimeout=setTimeout(function(){e.trigger("shown",e.instance),typeof n=="function"&&n.call(this)},e.options.fadeTime)),e};rr.prototype.hide=function(n){var e=this;return e.options.dataOnly||(e.ui.el.style.opacity=e.options.restOpacity,clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.removeTimeout=setTimeout(function(){var t=e.options.mode==="dynamic"?"none":"block";e.ui.el.style.display=t,typeof n=="function"&&n.call(e),e.trigger("hidden",e.instance)},e.options.fadeTime),e.options.restJoystick&&e.restPosition()),e};rr.prototype.restPosition=function(n){var e=this;e.frontPosition={x:0,y:0};var t=e.options.fadeTime+"ms",i={};i.front=d5("transition",["top","left"],t);var r={front:{}};r.front={left:e.frontPosition.x+"px",top:e.frontPosition.y+"px"},e.applyStyles(i),e.applyStyles(r),e.restTimeout=setTimeout(function(){typeof n=="function"&&n.call(e),e.restCallback()},e.options.fadeTime)};rr.prototype.restCallback=function(){var n=this,e={};e.front=d5("transition","none",""),n.applyStyles(e),n.trigger("rested",n.instance)};rr.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};rr.prototype.computeDirection=function(n){var e=n.angle.radian,t=Math.PI/4,i=Math.PI/2,r,s,o;if(e>t&&e<t*3&&!n.lockX?r="up":e>-t&&e<=t&&!n.lockY?r="left":e>-t*3&&e<=-t&&!n.lockX?r="down":n.lockY||(r="right"),n.lockY||(e>-i&&e<i?s="left":s="right"),n.lockX||(e>0?o="up":o="down"),n.force>this.options.threshold){var a={},l;for(l in this.direction)this.direction.hasOwnProperty(l)&&(a[l]=this.direction[l]);var c={};this.direction={x:s,y:o,angle:r},n.direction=this.direction;for(l in a)a[l]===this.direction[l]&&(c[l]=!0);if(c.x&&c.y&&c.angle)return n;(!c.x||!c.y)&&this.trigger("plain",n),c.x||this.trigger("plain:"+s,n),c.y||this.trigger("plain:"+o,n),c.angle||this.trigger("dir dir:"+r,n)}return n};function Fi(n,e){var t=this;return t.nipples=[],t.idles=[],t.actives=[],t.ids=[],t.pressureIntervals={},t.manager=n,t.id=Fi.id,Fi.id+=1,t.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1},t.config(e),(t.options.mode==="static"||t.options.mode==="semi")&&(t.options.multitouch=!1),t.options.multitouch||(t.options.maxNumberOfNipples=1),t.updateBox(),t.prepareNipples(),t.bindings(),t.begin(),t.nipples}Fi.prototype=new ru;Fi.constructor=Fi;Fi.id=0;Fi.prototype.prepareNipples=function(){var n=this,e=n.nipples;e.on=n.on.bind(n),e.off=n.off.bind(n),e.options=n.options,e.destroy=n.destroy.bind(n),e.ids=n.ids,e.id=n.id,e.processOnMove=n.processOnMove.bind(n),e.processOnEnd=n.processOnEnd.bind(n),e.get=function(t){if(t===void 0)return e[0];for(var i=0,r=e.length;i<r;i+=1)if(e[i].identifier===t)return e[i];return!1}};Fi.prototype.bindings=function(){var n=this;n.bindEvt(n.options.zone,"start"),n.options.zone.style.touchAction="none",n.options.zone.style.msTouchAction="none"};Fi.prototype.begin=function(){var n=this,e=n.options;if(e.mode==="static"){var t=n.createNipple(e.position,n.manager.getIdentifier());t.add(),n.idles.push(t)}};Fi.prototype.createNipple=function(n,e){var t=this,i=v$(),r={},s=t.options;if(n.x&&n.y)r={x:n.x-(i.x+t.box.left),y:n.y-(i.y+t.box.top)};else if(n.top||n.right||n.bottom||n.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=n.top,o.style.right=n.right,o.style.bottom=n.bottom,o.style.left=n.left,o.style.position="absolute",s.zone.appendChild(o);var a=o.getBoundingClientRect();s.zone.removeChild(o),r=n,n={x:a.left+i.x,y:a.top+i.y}}var l=new rr(t,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:e,position:n,zone:s.zone,frontPosition:{x:0,y:0}});return s.dataOnly||(cF(l.ui.el,r),cF(l.ui.front,l.frontPosition)),t.nipples.push(l),t.trigger("added "+l.identifier+":added",l),t.manager.trigger("added "+l.identifier+":added",l),t.bindNipple(l),l};Fi.prototype.updateBox=function(){var n=this;n.box=n.options.zone.getBoundingClientRect()};Fi.prototype.bindNipple=function(n){var e=this,t,i=function(r,s){t=r.type+" "+s.id+":"+r.type,e.trigger(t,s)};n.on("destroyed",e.onDestroyed.bind(e)),n.on("shown hidden rested dir plain",i),n.on("dir:up dir:right dir:down dir:left",i),n.on("plain:up plain:right plain:down plain:left",i)};Fi.prototype.pressureFn=function(n,e,t){var i=this,r=0;clearInterval(i.pressureIntervals[t]),i.pressureIntervals[t]=setInterval(function(){var s=n.force||n.pressure||n.webkitForce||0;s!==r&&(e.trigger("pressure",s),i.trigger("pressure "+e.identifier+":pressure",s),r=s)}.bind(i),100)};Fi.prototype.onstart=function(n){var e=this,t=e.options;n=y$(n),e.updateBox();var i=function(r){e.actives.length<t.maxNumberOfNipples&&e.processOnStart(r)};return gF(n,i),e.manager.bindDocument(),!1};Fi.prototype.processOnStart=function(n){var e=this,t=e.options,i,r=e.manager.getIdentifier(n),s=n.force||n.pressure||n.webkitForce||0,o={x:n.pageX,y:n.pageY},a=e.getOrCreate(r,o);a.identifier!==r&&e.manager.removeIdentifier(a.identifier),a.identifier=r;var l=function(g){g.trigger("start",g),e.trigger("start "+g.id+":start",g),g.show(),s>0&&e.pressureFn(n,g,g.identifier),e.processOnMove(n)};if((i=e.idles.indexOf(a))>=0&&e.idles.splice(i,1),e.actives.push(a),e.ids.push(a.identifier),t.mode!=="semi")l(a);else{var c=m$(o,a.position);if(c<=t.catchDistance)l(a);else{a.destroy(),e.processOnStart(n);return}}return a};Fi.prototype.getOrCreate=function(n,e){var t=this,i=t.options,r;return/(semi|static)/.test(i.mode)?(r=t.idles[0],r?(t.idles.splice(0,1),r):i.mode==="semi"?t.createNipple(e,n):(console.warn("Coudln't find the needed nipple."),!1)):(r=t.createNipple(e,n),r)};Fi.prototype.processOnMove=function(n){var e=this,t=e.options,i=e.manager.getIdentifier(n),r=e.nipples.get(i);if(!r){console.error("Found zombie joystick with ID "+i),e.manager.removeIdentifier(i);return}r.identifier=i;var s=r.options.size/2,o={x:n.pageX,y:n.pageY},a=m$(o,r.position),l=RWe(o,r.position),c=aF(l),g=a/s;a>s&&(a=s,o=ZWe(r.position,a,l));var u=o.x-r.position.x,d=o.y-r.position.y;t.lockX&&(d=0),t.lockY&&(u=0),r.frontPosition={x:u,y:d},t.dataOnly||cF(r.ui.front,r.frontPosition);var h={identifier:r.identifier,position:o,force:g,pressure:n.force||n.pressure||n.webkitForce||0,distance:a,angle:{radian:c,degree:l},instance:r,lockX:t.lockX,lockY:t.lockY};h=r.computeDirection(h),h.angle={radian:aF(180-l),degree:180-l},r.trigger("move",h),e.trigger("move "+r.id+":move",h)};Fi.prototype.processOnEnd=function(n){var e=this,t=e.options,i=e.manager.getIdentifier(n),r=e.nipples.get(i),s=e.manager.removeIdentifier(r.identifier);r&&(t.dataOnly||r.hide(function(){t.mode==="dynamic"&&(r.trigger("removed",r),e.trigger("removed "+r.id+":removed",r),e.manager.trigger("removed "+r.id+":removed",r),r.destroy())}),clearInterval(e.pressureIntervals[r.identifier]),r.resetDirection(),r.trigger("end",r),e.trigger("end "+r.id+":end",r),e.ids.indexOf(r.identifier)>=0&&e.ids.splice(e.ids.indexOf(r.identifier),1),e.actives.indexOf(r)>=0&&e.actives.splice(e.actives.indexOf(r),1),/(semi|static)/.test(t.mode)?e.idles.push(r):e.nipples.indexOf(r)>=0&&e.nipples.splice(e.nipples.indexOf(r),1),e.manager.unbindDocument(),/(semi|static)/.test(t.mode)&&(e.manager.ids[s.id]=s.identifier))};Fi.prototype.onDestroyed=function(n,e){var t=this;t.nipples.indexOf(e)>=0&&t.nipples.splice(t.nipples.indexOf(e),1),t.actives.indexOf(e)>=0&&t.actives.splice(t.actives.indexOf(e),1),t.idles.indexOf(e)>=0&&t.idles.splice(t.idles.indexOf(e),1),t.ids.indexOf(e.identifier)>=0&&t.ids.splice(t.ids.indexOf(e.identifier),1),t.manager.removeIdentifier(e.identifier),t.manager.unbindDocument()};Fi.prototype.destroy=function(){var n=this;n.unbindEvt(n.options.zone,"start"),n.nipples.forEach(function(t){t.destroy()});for(var e in n.pressureIntervals)n.pressureIntervals.hasOwnProperty(e)&&clearInterval(n.pressureIntervals[e]);n.trigger("destroyed",n.nipples),n.manager.unbindDocument(),n.off()};function yr(n){var e=this;e.ids={},e.index=0,e.collections=[],e.config(n),e.prepareCollections();var t;return lF(window,"resize",function(i){clearTimeout(t),t=setTimeout(function(){var r,s=v$();e.collections.forEach(function(o){o.forEach(function(a){r=a.el.getBoundingClientRect(),a.position={x:s.x+r.left,y:s.y+r.top}})})},100)}),e.collections}yr.prototype=new ru;yr.constructor=yr;yr.prototype.prepareCollections=function(){var n=this;n.collections.create=n.create.bind(n),n.collections.on=n.on.bind(n),n.collections.off=n.off.bind(n),n.collections.destroy=n.destroy.bind(n),n.collections.get=function(e){var t;return n.collections.every(function(i){return t=i.get(e),!t}),t}};yr.prototype.create=function(n){return this.createCollection(n)};yr.prototype.createCollection=function(n){var e=this,t=new Fi(e,n);return e.bindCollection(t),e.collections.push(t),t};yr.prototype.bindCollection=function(n){var e=this,t,i=function(r,s){t=r.type+" "+s.id+":"+r.type,e.trigger(t,s)};n.on("destroyed",e.onDestroyed.bind(e)),n.on("shown hidden rested dir plain",i),n.on("dir:up dir:right dir:down dir:left",i),n.on("plain:up plain:right plain:down plain:left",i)};yr.prototype.bindDocument=function(){var n=this;n.binded||(n.bindEvt(document,"move").bindEvt(document,"end"),n.binded=!0)};yr.prototype.unbindDocument=function(n){var e=this;(!Object.keys(e.ids).length||n===!0)&&(e.unbindEvt(document,"move").unbindEvt(document,"end"),e.binded=!1)};yr.prototype.getIdentifier=function(n){var e;return n?(e=n.identifier===void 0?n.pointerId:n.identifier,e===void 0&&(e=this.latest||0)):e=this.index,this.ids[e]===void 0&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]};yr.prototype.removeIdentifier=function(n){var e={};for(var t in this.ids)if(this.ids[t]===n){e.id=t,e.identifier=this.ids[t],delete this.ids[t];break}return e};yr.prototype.onmove=function(n){var e=this;return e.onAny("move",n),!1};yr.prototype.onend=function(n){var e=this;return e.onAny("end",n),!1};yr.prototype.oncancel=function(n){var e=this;return e.onAny("end",n),!1};yr.prototype.onAny=function(n,e){var t=this,i,r="processOn"+n.charAt(0).toUpperCase()+n.slice(1);e=y$(e);var s=function(a,l,c){c.ids.indexOf(l)>=0&&(c[r](a),a._found_=!0)},o=function(a){i=t.getIdentifier(a),gF(t.collections,s.bind(null,a,i)),a._found_||t.removeIdentifier(i)};return gF(e,o),!1};yr.prototype.destroy=function(){var n=this;n.unbindDocument(!0),n.ids={},n.index=0,n.collections.forEach(function(e){e.destroy()}),n.off()};yr.prototype.onDestroyed=function(n,e){var t=this;if(t.collections.indexOf(e)<0)return!1;t.collections.splice(t.collections.indexOf(e),1)};const LD=new yr,TWe={create:function(n){return LD.create(n)},factory:LD};var NWe=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,kWe=l$(function(n){return NWe.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),LWe=kWe,HWe=function(e){return e!=="theme"},HD=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?LWe:HWe},zD=function(e,t,i){var r;if(t){var s=t.shouldForwardProp;r=e.__emotion_forwardProp&&s?function(o){return e.__emotion_forwardProp(o)&&s(o)}:s}return typeof r!="function"&&i&&(r=e.__emotion_forwardProp),r},zWe=function(e){var t=e.cache,i=e.serialized,r=e.isStringTag;return g$(t,i,r),SWe(function(){return u$(t,i,r)}),null},XWe=function n(e,t){var i=e.__emotion_real===e,r=i&&e.__emotion_base||e,s,o;t!==void 0&&(s=t.label,o=t.target);var a=zD(e,t,i),l=a||HD(r),c=!l("as");return function(){var g=arguments,u=i&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(s!==void 0&&u.push("label:"+s+";"),g[0]==null||g[0].raw===void 0)u.push.apply(u,g);else{u.push(g[0][0]);for(var d=g.length,h=1;h<d;h++)u.push(g[h],g[0][h])}var f=I$(function(I,A,p){var y=c&&I.as||r,v="",b=[],w=I;if(I.theme==null){w={};for(var G in I)w[G]=I[G];w.theme=M.useContext(A$)}typeof I.className=="string"?v=yWe(A.registered,b,I.className):I.className!=null&&(v=I.className+" ");var x=g5(u.concat(b),A.registered,w);v+=A.key+"-"+x.name,o!==void 0&&(v+=" "+o);var B=c&&a===void 0?HD(y):l,R={};for(var Z in I)c&&Z==="as"||B(Z)&&(R[Z]=I[Z]);return R.className=v,R.ref=p,M.createElement(M.Fragment,null,M.createElement(zWe,{cache:A,serialized:x,isStringTag:typeof y=="string"}),M.createElement(y,R))});return f.displayName=s!==void 0?s:"Styled("+(typeof r=="string"?r:r.displayName||r.name||"Component")+")",f.defaultProps=e.defaultProps,f.__emotion_real=f,f.__emotion_base=r,f.__emotion_styles=u,f.__emotion_forwardProp=a,Object.defineProperty(f,"toString",{value:function(){return"."+o}}),f.withComponent=function(I,A){return n(I,pt({},t,A,{shouldForwardProp:zD(f,A,!0)})).apply(void 0,u)},f}},YWe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],Un=XWe.bind();YWe.forEach(function(n){Un[n]=Un(n)});var ft={},uF={exports:{}};(function(n,e){(function(t,i){var r="0.7.35",s="",o="?",a="function",l="undefined",c="object",g="string",u="major",d="model",h="name",f="type",I="vendor",A="version",p="architecture",y="console",v="mobile",b="tablet",w="smarttv",G="wearable",x="embedded",B=350,R="Amazon",Z="Apple",W="ASUS",F="BlackBerry",T="Browser",V="Chrome",z="Edge",U="Firefox",J="Google",H="Huawei",Y="LG",K="Microsoft",Q="Motorola",P="Opera",ne="Samsung",oe="Sharp",$="Sony",de="Xiaomi",ge="Zebra",se="Facebook",k="Chromium OS",O="Mac OS",q=function(fe,Ge){var me={};for(var Fe in fe)Ge[Fe]&&Ge[Fe].length%2===0?me[Fe]=Ge[Fe].concat(fe[Fe]):me[Fe]=fe[Fe];return me},ee=function(fe){for(var Ge={},me=0;me<fe.length;me++)Ge[fe[me].toUpperCase()]=fe[me];return Ge},le=function(fe,Ge){return typeof fe===g?he(Ge).indexOf(he(fe))!==-1:!1},he=function(fe){return fe.toLowerCase()},be=function(fe){return typeof fe===g?fe.replace(/[^\d\.]/g,s).split(".")[0]:i},xe=function(fe,Ge){if(typeof fe===g)return fe=fe.replace(/^\s\s*/,s),typeof Ge===l?fe:fe.substring(0,B)},ze=function(fe,Ge){for(var me=0,Fe,Le,Re,Xe,we,Ue;me<Ge.length&&!we;){var Pe=Ge[me],Ye=Ge[me+1];for(Fe=Le=0;Fe<Pe.length&&!we&&Pe[Fe];)if(we=Pe[Fe++].exec(fe),we)for(Re=0;Re<Ye.length;Re++)Ue=we[++Le],Xe=Ye[Re],typeof Xe===c&&Xe.length>0?Xe.length===2?typeof Xe[1]==a?this[Xe[0]]=Xe[1].call(this,Ue):this[Xe[0]]=Xe[1]:Xe.length===3?typeof Xe[1]===a&&!(Xe[1].exec&&Xe[1].test)?this[Xe[0]]=Ue?Xe[1].call(this,Ue,Xe[2]):i:this[Xe[0]]=Ue?Ue.replace(Xe[1],Xe[2]):i:Xe.length===4&&(this[Xe[0]]=Ue?Xe[3].call(this,Ue.replace(Xe[1],Xe[2])):i):this[Xe]=Ue||i;me+=2}},Se=function(fe,Ge){for(var me in Ge)if(typeof Ge[me]===c&&Ge[me].length>0){for(var Fe=0;Fe<Ge[me].length;Fe++)if(le(Ge[me][Fe],fe))return me===o?i:me}else if(le(Ge[me],fe))return me===o?i:me;return fe},ke={"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},He={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Be={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[A,[h,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[A,[h,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[h,A],[/opios[\/ ]+([\w\.]+)/i],[A,[h,P+" Mini"]],[/\bopr\/([\w\.]+)/i],[A,[h,P]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[h,A],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[A,[h,"UC"+T]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[A,[h,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[A,[h,"WeChat"]],[/konqueror\/([\w\.]+)/i],[A,[h,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[A,[h,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[A,[h,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[h,/(.+)/,"$1 Secure "+T],A],[/\bfocus\/([\w\.]+)/i],[A,[h,U+" Focus"]],[/\bopt\/([\w\.]+)/i],[A,[h,P+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[A,[h,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[A,[h,"Dolphin"]],[/coast\/([\w\.]+)/i],[A,[h,P+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[A,[h,"MIUI "+T]],[/fxios\/([-\w\.]+)/i],[A,[h,U]],[/\bqihu|(qi?ho?o?|360)browser/i],[[h,"360 "+T]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[h,/(.+)/,"$1 "+T],A],[/(comodo_dragon)\/([\w\.]+)/i],[[h,/_/g," "],A],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[h,A],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[h],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[h,se],A],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[h,A],[/\bgsa\/([\w\.]+) .*safari\//i],[A,[h,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[A,[h,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[A,[h,V+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[h,V+" WebView"],A],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[A,[h,"Android "+T]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[h,A],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[A,[h,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[A,h],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[h,[A,Se,ke]],[/(webkit|khtml)\/([\w\.]+)/i],[h,A],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[h,"Netscape"],A],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[A,[h,U+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[h,A],[/(cobalt)\/([\w\.]+)/i],[h,[A,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[p,"amd64"]],[/(ia32(?=;))/i],[[p,he]],[/((?:i[346]|x)86)[;\)]/i],[[p,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[p,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[p,"armhf"]],[/windows (ce|mobile); ppc;/i],[[p,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[p,/ower/,s,he]],[/(sun4\w)[;\)]/i],[[p,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[p,he]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[I,ne],[f,b]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[d,[I,ne],[f,v]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[d,[I,Z],[f,v]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[I,Z],[f,b]],[/(macintosh);/i],[d,[I,Z]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[I,oe],[f,v]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[I,H],[f,b]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[d,[I,H],[f,v]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[d,/_/g," "],[I,de],[f,v]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[I,de],[f,b]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[I,"OPPO"],[f,v]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[I,"Vivo"],[f,v]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[d,[I,"Realme"],[f,v]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[I,Q],[f,v]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[I,Q],[f,b]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[I,Y],[f,b]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[I,Y],[f,v]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[I,"Lenovo"],[f,b]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[I,"Nokia"],[f,v]],[/(pixel c)\b/i],[d,[I,J],[f,b]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[I,J],[f,v]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[I,$],[f,v]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[I,$],[f,b]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[I,"OnePlus"],[f,v]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[I,R],[f,b]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[I,R],[f,v]],[/(playbook);[-\w\),; ]+(rim)/i],[d,I,[f,b]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[I,F],[f,v]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[I,W],[f,b]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[I,W],[f,v]],[/(nexus 9)/i],[d,[I,"HTC"],[f,b]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[I,[d,/_/g," "],[f,v]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[I,"Acer"],[f,b]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[I,"Meizu"],[f,v]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[I,d,[f,v]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[I,d,[f,b]],[/(surface duo)/i],[d,[I,K],[f,b]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[I,"Fairphone"],[f,v]],[/(u304aa)/i],[d,[I,"AT&T"],[f,v]],[/\bsie-(\w*)/i],[d,[I,"Siemens"],[f,v]],[/\b(rct\w+) b/i],[d,[I,"RCA"],[f,b]],[/\b(venue[\d ]{2,7}) b/i],[d,[I,"Dell"],[f,b]],[/\b(q(?:mv|ta)\w+) b/i],[d,[I,"Verizon"],[f,b]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[I,"Barnes & Noble"],[f,b]],[/\b(tm\d{3}\w+) b/i],[d,[I,"NuVision"],[f,b]],[/\b(k88) b/i],[d,[I,"ZTE"],[f,b]],[/\b(nx\d{3}j) b/i],[d,[I,"ZTE"],[f,v]],[/\b(gen\d{3}) b.+49h/i],[d,[I,"Swiss"],[f,v]],[/\b(zur\d{3}) b/i],[d,[I,"Swiss"],[f,b]],[/\b((zeki)?tb.*\b) b/i],[d,[I,"Zeki"],[f,b]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[I,"Dragon Touch"],d,[f,b]],[/\b(ns-?\w{0,9}) b/i],[d,[I,"Insignia"],[f,b]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[I,"NextBook"],[f,b]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[I,"Voice"],d,[f,v]],[/\b(lvtel\-)?(v1[12]) b/i],[[I,"LvTel"],d,[f,v]],[/\b(ph-1) /i],[d,[I,"Essential"],[f,v]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[I,"Envizen"],[f,b]],[/\b(trio[-\w\. ]+) b/i],[d,[I,"MachSpeed"],[f,b]],[/\btu_(1491) b/i],[d,[I,"Rotor"],[f,b]],[/(shield[\w ]+) b/i],[d,[I,"Nvidia"],[f,b]],[/(sprint) (\w+)/i],[I,d,[f,v]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[I,K],[f,v]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[I,ge],[f,b]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[I,ge],[f,v]],[/smart-tv.+(samsung)/i],[I,[f,w]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[I,ne],[f,w]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[I,Y],[f,w]],[/(apple) ?tv/i],[I,[d,Z+" TV"],[f,w]],[/crkey/i],[[d,V+"cast"],[I,J],[f,w]],[/droid.+aft(\w)( bui|\))/i],[d,[I,R],[f,w]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[d,[I,oe],[f,w]],[/(bravia[\w ]+)( bui|\))/i],[d,[I,$],[f,w]],[/(mitv-\w{5}) bui/i],[d,[I,de],[f,w]],[/Hbbtv.*(technisat) (.*);/i],[I,d,[f,w]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[I,xe],[d,xe],[f,w]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[f,w]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[I,d,[f,y]],[/droid.+; (shield) bui/i],[d,[I,"Nvidia"],[f,y]],[/(playstation [345portablevi]+)/i],[d,[I,$],[f,y]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[I,K],[f,y]],[/((pebble))app/i],[I,d,[f,G]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[d,[I,Z],[f,G]],[/droid.+; (glass) \d/i],[d,[I,J],[f,G]],[/droid.+; (wt63?0{2,3})\)/i],[d,[I,ge],[f,G]],[/(quest( 2| pro)?)/i],[d,[I,se],[f,G]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[I,[f,x]],[/(aeobc)\b/i],[d,[I,R],[f,x]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[d,[f,v]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[f,b]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[f,b]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[f,v]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[I,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[A,[h,z+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[A,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[h,A],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[A,h]],os:[[/microsoft (windows) (vista|xp)/i],[h,A],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[h,[A,Se,He]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[h,"Windows"],[A,Se,He]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/ios;fbsv\/([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[A,/_/g,"."],[h,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[h,O],[A,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[A,h],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[h,A],[/\(bb(10);/i],[A,[h,F]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[A,[h,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[A,[h,U+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[A,[h,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[A,[h,"watchOS"]],[/crkey\/([\d\.]+)/i],[A,[h,V+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[h,k],A],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[h,A],[/(sunos) ?([\w\.\d]*)/i],[[h,"Solaris"],A],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[h,A]]},j=function(fe,Ge){if(typeof fe===c&&(Ge=fe,fe=i),!(this instanceof j))return new j(fe,Ge).getResult();var me=typeof t!==l&&t.navigator?t.navigator:i,Fe=fe||(me&&me.userAgent?me.userAgent:s),Le=me&&me.userAgentData?me.userAgentData:i,Re=Ge?q(Be,Ge):Be,Xe=me&&me.userAgent==Fe;return this.getBrowser=function(){var we={};return we[h]=i,we[A]=i,ze.call(we,Fe,Re.browser),we[u]=be(we[A]),Xe&&me&&me.brave&&typeof me.brave.isBrave==a&&(we[h]="Brave"),we},this.getCPU=function(){var we={};return we[p]=i,ze.call(we,Fe,Re.cpu),we},this.getDevice=function(){var we={};return we[I]=i,we[d]=i,we[f]=i,ze.call(we,Fe,Re.device),Xe&&!we[f]&&Le&&Le.mobile&&(we[f]=v),Xe&&we[d]=="Macintosh"&&me&&typeof me.standalone!==l&&me.maxTouchPoints&&me.maxTouchPoints>2&&(we[d]="iPad",we[f]=b),we},this.getEngine=function(){var we={};return we[h]=i,we[A]=i,ze.call(we,Fe,Re.engine),we},this.getOS=function(){var we={};return we[h]=i,we[A]=i,ze.call(we,Fe,Re.os),Xe&&!we[h]&&Le&&Le.platform!="Unknown"&&(we[h]=Le.platform.replace(/chrome os/i,k).replace(/macos/i,O)),we},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Fe},this.setUA=function(we){return Fe=typeof we===g&&we.length>B?xe(we,B):we,this},this.setUA(Fe),this};j.VERSION=r,j.BROWSER=ee([h,A,u]),j.CPU=ee([p]),j.DEVICE=ee([d,I,f,y,v,w,b,G,x]),j.ENGINE=j.OS=ee([h,A]),n.exports&&(e=n.exports=j),e.UAParser=j;var X=typeof t!==l&&(t.jQuery||t.Zepto);if(X&&!X.ua){var ce=new j;X.ua=ce.getResult(),X.ua.get=function(){return ce.getUA()},X.ua.set=function(fe){ce.setUA(fe);var Ge=ce.getResult();for(var me in Ge)X.ua[me]=Ge[me]}}})(typeof window=="object"?window:Ch)})(uF,uF.exports);var KWe=uF.exports;Object.defineProperty(ft,"__esModule",{value:!0});function DWe(n){return n&&typeof n=="object"&&"default"in n?n.default:n}var ca=M,Qn=DWe(ca),PWe=KWe,up=new PWe,Fr=up.getBrowser();up.getCPU();var ra=up.getDevice(),RA=up.getEngine(),Po=up.getOS(),vg=up.getUA(),Dt=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"none";return e||t},h5=function(){return typeof window<"u"&&(window.navigator||navigator)?window.navigator||navigator:!1},f5=function(e){var t=h5();return t&&t.platform&&(t.platform.indexOf(e)!==-1||t.platform==="MacIntel"&&t.maxTouchPoints>1&&!window.MSStream)};function _1(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_1=function(e){return typeof e}:_1=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_1(n)}function UWe(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function XD(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}function QWe(n,e,t){return e&&XD(n.prototype,e),t&&XD(n,t),n}function OWe(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Xs(){return Xs=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Xs.apply(this,arguments)}function YD(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function JWe(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?YD(t,!0).forEach(function(i){OWe(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):YD(t).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function jWe(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&hF(n,e)}function dF(n){return dF=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},dF(n)}function hF(n,e){return hF=Object.setPrototypeOf||function(i,r){return i.__proto__=r,i},hF(n,e)}function qWe(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}function Oa(n,e){if(n==null)return{};var t=qWe(n,e),i,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(n,i)&&(t[i]=n[i])}return t}function V1(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function $We(n,e){return e&&(typeof e=="object"||typeof e=="function")?e:V1(n)}var go={Mobile:"mobile",Tablet:"tablet",SmartTv:"smarttv",Console:"console",Wearable:"wearable",Browser:void 0},Zo={Chrome:"Chrome",Firefox:"Firefox",Opera:"Opera",Yandex:"Yandex",Safari:"Safari",InternetExplorer:"Internet Explorer",Edge:"Edge",Chromium:"Chromium",Ie:"IE",MobileSafari:"Mobile Safari",EdgeChromium:"Edge Chromium",MIUI:"MIUI Browser",SamsungBrowser:"Samsung Browser"},dp={IOS:"iOS",Android:"Android",WindowsPhone:"Windows Phone",Windows:"Windows",MAC_OS:"Mac OS"},eFe={isMobile:!1,isTablet:!1,isBrowser:!1,isSmartTV:!1,isConsole:!1,isWearable:!1},tFe=function(e){switch(e){case go.Mobile:return{isMobile:!0};case go.Tablet:return{isTablet:!0};case go.SmartTv:return{isSmartTV:!0};case go.Console:return{isConsole:!0};case go.Wearable:return{isWearable:!0};case go.Browser:return{isBrowser:!0};default:return eFe}},nFe=function(e,t,i,r,s){return{isBrowser:e,browserMajorVersion:Dt(t.major),browserFullVersion:Dt(t.version),browserName:Dt(t.name),engineName:Dt(i.name),engineVersion:Dt(i.version),osName:Dt(r.name),osVersion:Dt(r.version),userAgent:Dt(s)}},KD=function(e,t,i,r){return JWe({},e,{vendor:Dt(t.vendor),model:Dt(t.model),os:Dt(i.name),osVersion:Dt(i.version),ua:Dt(r)})},iFe=function(e,t,i,r){return{isSmartTV:e,engineName:Dt(t.name),engineVersion:Dt(t.version),osName:Dt(i.name),osVersion:Dt(i.version),userAgent:Dt(r)}},rFe=function(e,t,i,r){return{isConsole:e,engineName:Dt(t.name),engineVersion:Dt(t.version),osName:Dt(i.name),osVersion:Dt(i.version),userAgent:Dt(r)}},sFe=function(e,t,i,r){return{isWearable:e,engineName:Dt(t.name),engineVersion:Dt(t.version),osName:Dt(i.name),osVersion:Dt(i.version),userAgent:Dt(r)}},Fu=tFe(ra.type);function oFe(){var n=Fu.isBrowser,e=Fu.isMobile,t=Fu.isTablet,i=Fu.isSmartTV,r=Fu.isConsole,s=Fu.isWearable;if(n)return nFe(n,Fr,RA,Po,vg);if(i)return iFe(i,RA,Po,vg);if(r)return rFe(r,RA,Po,vg);if(e||t)return KD(Fu,ra,Po,vg);if(s)return sFe(s,RA,Po,vg)}var aFe=function(){return ra.type===go.Mobile},lFe=function(){return ra.type===go.Tablet},cFe=function(){switch(ra.type){case go.Mobile:case go.Tablet:return!0;default:return!1}},I5=function(){return typeof vg=="string"&&vg.indexOf("Edg/")!==-1},gFe=function(){return ra.type===go.SmartTv},B$=function(){return ra.type===go.Browser},uFe=function(){return ra.type===go.Wearable},dFe=function(){return ra.type===go.Console},hFe=function(){return Po.name===dp.Android},fFe=function(){return Po.name===dp.Windows},IFe=function(){return Po.name===dp.MAC_OS},AFe=function(){return Po.name===dp.WindowsPhone},CFe=function(){return Po.name===dp.IOS},pFe=function(){return Fr.name===Zo.Chrome},mFe=function(){return Fr.name===Zo.Firefox},yFe=function(){return Fr.name===Zo.Chromium},G$=function(){return Fr.name===Zo.Edge},vFe=function(){return Fr.name===Zo.Yandex},bFe=function(){return Fr.name===Zo.Safari||Fr.name===Zo.MobileSafari},BFe=function(){return Fr.name===Zo.MobileSafari},GFe=function(){return Fr.name===Zo.Opera},wFe=function(){return Fr.name===Zo.InternetExplorer||Fr.name===Zo.Ie},xFe=function(){return Fr.name===Zo.MIUI},SFe=function(){return Fr.name===Zo.SamsungBrowser},RFe=function(){var e=h5(),t=e&&e.userAgent&&e.userAgent.toLowerCase();return typeof t=="string"?/electron/.test(t):!1},ZFe=function(){var e=h5();return e&&(/iPad|iPhone|iPod/.test(e.platform)||e.platform==="MacIntel"&&e.maxTouchPoints>1)&&!window.MSStream},Xv=function(){return f5("iPad")},MFe=function(){return f5("iPhone")},EFe=function(){return f5("iPod")},WFe=function(){return Dt(Fr.version)},FFe=function(){return Dt(Fr.major)},_Fe=function(){return Dt(Po.version)},VFe=function(){return Dt(Po.name)},TFe=function(){return Dt(Fr.name)},NFe=function(){return Dt(ra.vendor)},kFe=function(){return Dt(ra.model)},LFe=function(){return Dt(RA.name)},HFe=function(){return Dt(RA.version)},zFe=function(){return Dt(vg)},XFe=function(){return Dt(ra.type,"browser")},w$=gFe(),x$=dFe(),S$=uFe(),YFe=BFe()||Xv(),KFe=yFe(),A5=cFe()||Xv(),R$=aFe(),Z$=lFe()||Xv(),M$=B$(),DFe=B$(),E$=hFe(),W$=AFe(),F$=CFe()||Xv(),PFe=pFe(),UFe=mFe(),QFe=bFe(),OFe=GFe(),_$=wFe(),JFe=_Fe(),jFe=VFe(),qFe=WFe(),$Fe=FFe(),e_e=TFe(),t_e=NFe(),n_e=kFe(),i_e=LFe(),r_e=HFe(),s_e=zFe(),o_e=G$()||I5(),a_e=vFe(),l_e=XFe(),c_e=ZFe(),g_e=Xv(),u_e=MFe(),d_e=EFe(),h_e=RFe(),f_e=I5(),I_e=G$()&&!I5(),A_e=fFe(),C_e=IFe(),p_e=xFe(),m_e=SFe(),y_e=function(e){var t=e.renderWithFragment,i=e.children,r=e.viewClassName,s=e.style,o=Oa(e,["renderWithFragment","children","viewClassName","style"]);return E$?t?Qn.createElement(ca.Fragment,null,i):Qn.createElement("div",Xs({className:r,style:s},o),i):null},v_e=function(e){var t=e.renderWithFragment,i=e.children,r=e.viewClassName,s=e.style,o=Oa(e,["renderWithFragment","children","viewClassName","style"]);return M$?t?Qn.createElement(ca.Fragment,null,i):Qn.createElement("div",Xs({className:r,style:s},o),i):null},b_e=function(e){var t=e.renderWithFragment,i=e.children,r=e.viewClassName,s=e.style,o=Oa(e,["renderWithFragment","children","viewClassName","style"]);return _$?t?Qn.createElement(ca.Fragment,null,i):Qn.createElement("div",Xs({className:r,style:s},o),i):null},B_e=function(e){var t=e.renderWithFragment,i=e.children,r=e.viewClassName,s=e.style,o=Oa(e,["renderWithFragment","children","viewClassName","style"]);return F$?t?Qn.createElement(ca.Fragment,null,i):Qn.createElement("div",Xs({className:r,style:s},o),i):null},G_e=function(e){var t=e.renderWithFragment,i=e.children,r=e.viewClassName,s=e.style,o=Oa(e,["renderWithFragment","children","viewClassName","style"]);return A5?t?Qn.createElement(ca.Fragment,null,i):Qn.createElement("div",Xs({className:r,style:s},o),i):null},w_e=function(e){var t=e.renderWithFragment,i=e.children,r=e.viewClassName,s=e.style,o=Oa(e,["renderWithFragment","children","viewClassName","style"]);return Z$?t?Qn.createElement(ca.Fragment,null,i):Qn.createElement("div",Xs({className:r,style:s},o),i):null},x_e=function(e){var t=e.renderWithFragment,i=e.children,r=e.viewClassName,s=e.style,o=Oa(e,["renderWithFragment","children","viewClassName","style"]);return W$?t?Qn.createElement(ca.Fragment,null,i):Qn.createElement("div",Xs({className:r,style:s},o),i):null},S_e=function(e){var t=e.renderWithFragment,i=e.children,r=e.viewClassName,s=e.style,o=Oa(e,["renderWithFragment","children","viewClassName","style"]);return R$?t?Qn.createElement(ca.Fragment,null,i):Qn.createElement("div",Xs({className:r,style:s},o),i):null},R_e=function(e){var t=e.renderWithFragment,i=e.children,r=e.viewClassName,s=e.style,o=Oa(e,["renderWithFragment","children","viewClassName","style"]);return w$?t?Qn.createElement(ca.Fragment,null,i):Qn.createElement("div",Xs({className:r,style:s},o),i):null},Z_e=function(e){var t=e.renderWithFragment,i=e.children,r=e.viewClassName,s=e.style,o=Oa(e,["renderWithFragment","children","viewClassName","style"]);return x$?t?Qn.createElement(ca.Fragment,null,i):Qn.createElement("div",Xs({className:r,style:s},o),i):null},M_e=function(e){var t=e.renderWithFragment,i=e.children,r=e.viewClassName,s=e.style,o=Oa(e,["renderWithFragment","children","viewClassName","style"]);return S$?t?Qn.createElement(ca.Fragment,null,i):Qn.createElement("div",Xs({className:r,style:s},o),i):null},E_e=function(e){var t=e.renderWithFragment,i=e.children,r=e.viewClassName,s=e.style,o=e.condition,a=Oa(e,["renderWithFragment","children","viewClassName","style","condition"]);return o?t?Qn.createElement(ca.Fragment,null,i):Qn.createElement("div",Xs({className:r,style:s},a),i):null};function W_e(n){return function(e){jWe(t,e);function t(i){var r;return UWe(this,t),r=$We(this,dF(t).call(this,i)),r.isEventListenerAdded=!1,r.handleOrientationChange=r.handleOrientationChange.bind(V1(r)),r.onOrientationChange=r.onOrientationChange.bind(V1(r)),r.onPageLoad=r.onPageLoad.bind(V1(r)),r.state={isLandscape:!1,isPortrait:!1},r}return QWe(t,[{key:"handleOrientationChange",value:function(){this.isEventListenerAdded||(this.isEventListenerAdded=!0);var r=window.innerWidth>window.innerHeight?90:0;this.setState({isPortrait:r===0,isLandscape:r===90})}},{key:"onOrientationChange",value:function(){this.handleOrientationChange()}},{key:"onPageLoad",value:function(){this.handleOrientationChange()}},{key:"componentDidMount",value:function(){(typeof window>"u"?"undefined":_1(window))!==void 0&&A5&&(this.isEventListenerAdded?window.removeEventListener("load",this.onPageLoad,!1):(this.handleOrientationChange(),window.addEventListener("load",this.onPageLoad,!1)),window.addEventListener("resize",this.onOrientationChange,!1))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onOrientationChange,!1)}},{key:"render",value:function(){return Qn.createElement(n,Xs({},this.props,{isLandscape:this.state.isLandscape,isPortrait:this.state.isPortrait}))}}]),t}(Qn.Component)}ft.AndroidView=y_e;ft.BrowserTypes=Zo;ft.BrowserView=v_e;ft.ConsoleView=Z_e;ft.CustomView=E_e;ft.IEView=b_e;ft.IOSView=B_e;ft.MobileOnlyView=S_e;ft.MobileView=G_e;ft.OsTypes=dp;ft.SmartTVView=R_e;ft.TabletView=w_e;ft.WearableView=M_e;ft.WinPhoneView=x_e;ft.browserName=e_e;ft.browserVersion=$Fe;ft.deviceDetect=oFe;ft.deviceType=l_e;ft.engineName=i_e;ft.engineVersion=r_e;ft.fullBrowserVersion=qFe;ft.getUA=s_e;ft.isAndroid=E$;ft.isBrowser=M$;ft.isChrome=PFe;ft.isChromium=KFe;ft.isConsole=x$;ft.isDesktop=DFe;ft.isEdge=o_e;ft.isEdgeChromium=f_e;ft.isElectron=h_e;ft.isFirefox=UFe;ft.isIE=_$;ft.isIOS=F$;ft.isIOS13=c_e;ft.isIPad13=g_e;ft.isIPhone13=u_e;ft.isIPod13=d_e;ft.isLegacyEdge=I_e;ft.isMIUI=p_e;ft.isMacOs=C_e;var C5=ft.isMobile=A5;ft.isMobileOnly=R$;ft.isMobileSafari=YFe;ft.isOpera=OFe;ft.isSafari=QFe;ft.isSamsungBrowser=m_e;ft.isSmartTV=w$;ft.isTablet=Z$;ft.isWearable=S$;ft.isWinPhone=W$;ft.isWindows=A_e;ft.isYandex=a_e;ft.mobileModel=n_e;ft.mobileVendor=t_e;ft.osName=jFe;ft.osVersion=JFe;ft.withOrientationChange=W_e;class F_e extends ho{constructor(e,t){super(),this.index=e,this.controller=t.xr.getController(e),this.grip=t.xr.getControllerGrip(e),this.hand=t.xr.getHand(e),this.grip.userData.name="grip",this.controller.userData.name="controller",this.hand.userData.name="hand",this.visible=!1,this.add(this.controller,this.grip,this.hand),this._onConnected=this._onConnected.bind(this),this._onDisconnected=this._onDisconnected.bind(this),this.controller.addEventListener("connected",this._onConnected),this.controller.addEventListener("disconnected",this._onDisconnected)}_onConnected(e){e.fake||(this.visible=!0,this.inputSource=e.data,this.dispatchEvent(e))}_onDisconnected(e){e.fake||(this.visible=!1,this.dispatchEvent(e))}dispose(){this.controller.removeEventListener("connected",this._onConnected),this.controller.removeEventListener("disconnected",this._onDisconnected)}}var DD,PD;const __e=n=>Array.from(new Set(n)),Ma=typeof window<"u"&&((DD=window.document)!=null&&DD.createElement||((PD=window.navigator)==null?void 0:PD.product)==="ReactNative")?M.useLayoutEffect:M.useEffect;function Kh(n){const e=M.useRef(n);return Ma(()=>void(e.current=n),[n]),e}function JI(n,e,{handedness:t}={}){const i=Kh(e),r=qi(s=>s.controllers);Ma(()=>{const s=r.map(o=>{if(t&&o.inputSource.handedness!==t)return;const a=l=>i.current({nativeEvent:l,target:o});return o.controller.addEventListener(n,a),()=>o.controller.removeEventListener(n,a)});return()=>s.forEach(o=>o==null?void 0:o())},[r,t,n])}const UD=new qe;function V_e({children:n}){const e=Bt(u=>u.events),t=Bt(u=>u.get),i=Bt(u=>u.raycaster),r=qi(u=>u.controllers),s=qi(u=>u.interactions),o=qi(u=>u.hoverState),a=qi(u=>u.hasInteraction),l=qi(u=>u.getInteraction),c=M.useCallback(u=>{const d=Array.from(s.keys());return UD.identity().extractRotation(u.matrixWorld),i.ray.origin.setFromMatrixPosition(u.matrixWorld),i.ray.direction.set(0,0,-1).applyMatrix4(UD),i.intersectObjects(d,!0)},[s,i]);yn(()=>{if(s.size!==0)for(const u of r){const d=o[u.inputSource.handedness],h=new Set;let f=c(u.controller);if(e.filter)f=e.filter(f,t());else{const I=f.find(A=>A==null?void 0:A.object);I&&(f=[I])}for(const I of f){let A=I.object;for(;A;){if(a(A,"onHover")&&!d.has(A)){const y=l(A,"onHover");for(const v of y)v({target:u,intersection:I,intersections:f})}const p=l(A,"onMove");p==null||p.forEach(y=>y({target:u,intersection:I,intersections:f})),d.set(A,I),h.add(A.id),A=A.parent}}for(const I of d.keys())if(!h.has(I.id)){d.delete(I);const A=l(I,"onBlur");if(!A)continue;for(const p of A)p({target:u,intersections:f})}}});const g=M.useCallback(u=>d=>{const h=o[d.target.inputSource.handedness],f=Array.from(new Set(h.values()));s.forEach((I,A)=>{var p,y,v;if(h.has(A)){if(!I[u])return;for(const b of I[u])(p=b.current)==null||p.call(b,{target:d.target,intersection:h.get(A),intersections:f})}else if(u==="onSelect"&&I.onSelectMissed)for(const b of I.onSelectMissed)(y=b.current)==null||y.call(b,{target:d.target,intersections:f});else if(u==="onSqueeze"&&I.onSqueezeMissed)for(const b of I.onSqueezeMissed)(v=b.current)==null||v.call(b,{target:d.target,intersections:f})})},[o,s]);return JI("select",g("onSelect")),JI("selectstart",g("onSelectStart")),JI("selectend",g("onSelectEnd")),JI("squeeze",g("onSqueeze")),JI("squeezeend",g("onSqueezeEnd")),JI("squeezestart",g("onSqueezeStart")),M.createElement(M.Fragment,null,n)}function ul(n,e,t){const i=qi(o=>o.addInteraction),r=qi(o=>o.removeInteraction),s=Kh(t);Ma(()=>{const o=n.current;if(!(!o||!s.current))return i(o,e,s),()=>r(o,e,s)},[n,e,i,r])}const V$=M.forwardRef(function({onHover:e,onBlur:t,onSelectStart:i,onSelectEnd:r,onSelectMissed:s,onSelect:o,onSqueezeStart:a,onSqueezeEnd:l,onSqueezeMissed:c,onSqueeze:g,onMove:u,children:d},h){const f=M.useRef(null);return M.useImperativeHandle(h,()=>f.current),ul(f,"onHover",e),ul(f,"onBlur",t),ul(f,"onSelectStart",i),ul(f,"onSelectEnd",r),ul(f,"onSelectMissed",s),ul(f,"onSelect",o),ul(f,"onSqueezeStart",a),ul(f,"onSqueezeEnd",l),ul(f,"onSqueezeMissed",c),ul(f,"onSqueeze",g),ul(f,"onMove",u),M.createElement("group",{ref:f},d)});M.forwardRef(function({onSelectStart:e,onSelectEnd:t,children:i,...r},s){const o=M.useRef(),a=M.useRef(null),l=M.useMemo(()=>new qe,[]);return M.useImperativeHandle(s,()=>a.current),yn(()=>{const c=o.current,g=a.current;c&&(g.applyMatrix4(l),g.applyMatrix4(c.matrixWorld),g.updateMatrixWorld(),l.copy(c.matrixWorld).invert())}),M.createElement(V$,{ref:a,onSelectStart:c=>{o.current=c.target.controller,l.copy(c.target.controller.matrixWorld).invert(),e==null||e(c)},onSelectEnd:c=>{c.target.controller===o.current&&(o.current=void 0),t==null||t(c)},...r},i)});const T$=M.createContext(null),af=HC((n,e)=>({set:n,get:e,session:null,referenceSpaceType:null}));function T_e({foveation:n=0,frameRate:e=void 0,referenceSpace:t="local-floor",onSessionStart:i,onSessionEnd:r,onVisibilityChange:s,onInputSourcesChange:o,children:a}){const l=Bt(v=>v.gl),c=Bt(v=>v.camera),g=qi(v=>v.player),u=qi(v=>v.get),d=qi(v=>v.set),h=qi(v=>v.session),f=qi(v=>v.controllers),I=Kh(i),A=Kh(r),p=Kh(s),y=Kh(o);return Ma(()=>{const v=[0,1].map(b=>{const w=new F_e(b,l),G=()=>d(B=>({controllers:[...B.controllers,w]})),x=()=>d(B=>({controllers:B.controllers.filter(R=>R!==w)}));return w.addEventListener("connected",G),w.addEventListener("disconnected",x),()=>{w.removeEventListener("connected",G),w.removeEventListener("disconnected",x)}});return()=>v.forEach(b=>b())},[l,d]),Ma(()=>af.subscribe(({session:v})=>d(()=>({session:v}))),[l.xr,d]),Ma(()=>{l.xr.setFoveation(n),d(()=>({foveation:n}))},[l.xr,n,d]),Ma(()=>{var v;try{e&&((v=h==null?void 0:h.updateTargetFrameRate)==null||v.call(h,e))}catch{}d(()=>({frameRate:e}))},[h,e,d]),Ma(()=>{const v=af.getState();l.xr.setReferenceSpaceType(t),d(()=>({referenceSpace:t})),v.set({referenceSpaceType:t})},[l.xr,t,d]),Ma(()=>{if(!h)return void l.xr.setSession(null);const v=x=>{var B;d(()=>({isPresenting:!0})),(B=I.current)==null||B.call(I,{nativeEvent:{...x,target:h},target:h})},b=x=>{var B;d(()=>({isPresenting:!1,session:null})),af.setState(()=>({session:null})),(B=A.current)==null||B.call(A,{nativeEvent:{...x,target:h},target:h})},w=x=>{var B;(B=p.current)==null||B.call(p,{nativeEvent:x,target:h})},G=x=>{var B;const R=Object.values(h.inputSources).some(Z=>Z.hand);d(()=>({isHandTracking:R})),(B=y.current)==null||B.call(y,{nativeEvent:x,target:h})};return l.xr.addEventListener("sessionstart",v),l.xr.addEventListener("sessionend",b),h.addEventListener("visibilitychange",w),h.addEventListener("inputsourceschange",G),l.xr.setSession(h).then(()=>{l.xr.setFoveation(u().foveation)}),()=>{l.xr.removeEventListener("sessionstart",v),l.xr.removeEventListener("sessionend",b),h.removeEventListener("visibilitychange",w),h.removeEventListener("inputsourceschange",G)}},[h,l.xr,d,u]),M.createElement(V_e,null,M.createElement("primitive",{object:g},M.createElement("primitive",{object:c}),f.map(v=>M.createElement("primitive",{key:v.index,object:v}))),a)}function N_e(n){const e=M.useMemo(()=>HC((t,i)=>({set:t,get:i,controllers:[],isPresenting:!1,isHandTracking:!1,player:new ho,session:null,foveation:0,referenceSpace:"local-floor",hoverState:{left:new Map,right:new Map,none:new Map},interactions:new Map,hasInteraction(r,s){var o;return!!((o=i().interactions.get(r))!=null&&o[s].some(a=>a.current))},getInteraction(r,s){var o;return(o=i().interactions.get(r))==null?void 0:o[s].reduce((a,l)=>(l.current&&a.push(l.current),a),[])},addInteraction(r,s,o){const a=i().interactions;a.has(r)||a.set(r,{onHover:[],onBlur:[],onSelect:[],onSelectEnd:[],onSelectStart:[],onSelectMissed:[],onSqueeze:[],onSqueezeEnd:[],onSqueezeStart:[],onSqueezeMissed:[],onMove:[]}),a.get(r)[s].push(o)},removeInteraction(r,s,o){const a=i().interactions.get(r);if(a){const l=a[s].indexOf(o);l!==-1&&a[s].splice(l,1)}}})),[]);return M.createElement(T$.Provider,{value:e},M.createElement(T_e,{...n}))}const k_e=(n,e)=>{var t;if(!(!n&&!e))return n&&!e?{optionalFeatures:[n]}:n&&e?{...e,optionalFeatures:__e([...(t=e.optionalFeatures)!=null?t:[],n])}:e},L_e=async(n,e)=>{const t=af.getState();if(t.session){console.warn("@react-three/xr: session already started, please stop it first");return}const i=k_e(t.referenceSpaceType,e),r=await navigator.xr.requestSession(n,i);return t.set(()=>({session:r})),r},H_e=async()=>{const n=af.getState();if(!n.session){console.warn("@react-three/xr: no session to stop, please start it first");return}await n.session.end(),n.set({session:null})},z_e=async(n,{sessionInit:e,enterOnly:t,exitOnly:i}={})=>{const r=af.getState();if(!(r.session&&t)&&!(!r.session&&i))return r.session?await H_e():await L_e(n,e)},X_e=(n,e,t)=>{switch(n){case"entered":return`Exit ${e}`;case"exited":return`Enter ${e}`;case"unsupported":default:switch(t){case"https":return"HTTPS needed";case"security":return`${e} blocked`;case"unknown":default:return`${e} unsupported`}}},N$=M.forwardRef(function({mode:e,sessionInit:t,enterOnly:i=!1,exitOnly:r=!1,onClick:s,onError:o,children:a,...l},c){const[g,u]=M.useState("exited"),[d,h]=M.useState("unknown"),f=X_e(g,e,d),I=e==="inline"?e:`immersive-${e.toLowerCase()}`,A=Kh(o);Ma(()=>{if(!(navigator!=null&&navigator.xr))return void u("unsupported");navigator.xr.isSessionSupported(I).then(y=>{if(y)u("exited");else{const v=location.protocol==="https:";u("unsupported"),h(v?"unknown":"https")}}).catch(y=>{u("unsupported"),"name"in y&&y.name==="SecurityError"?h("security"):h("unknown")})},[I]),Ma(()=>af.subscribe(y=>{y.session?u("entered"):g!=="unsupported"&&u("exited")}),[g]);const p=M.useCallback(async y=>{s==null||s(y);try{z_e(I,{sessionInit:t,enterOnly:i,exitOnly:r})}catch(v){const b=A.current;if(b&&v instanceof Error)b(v);else throw v}},[s,I,t,i,r,A]);return M.createElement("button",{...l,ref:c,onClick:g==="unsupported"?s:p},typeof a=="function"?a(g):a??f)}),k$={position:"absolute",bottom:"24px",left:"50%",transform:"translateX(-50%)",padding:"12px 24px",border:"1px solid white",borderRadius:"4px",background:"rgba(0, 0, 0, 0.1)",color:"white",font:"normal 0.8125rem sans-serif",outline:"none",zIndex:99999,cursor:"pointer"};M.forwardRef(({style:n=k$,sessionInit:e={domOverlay:typeof document<"u"?{root:document.body}:void 0,optionalFeatures:["hit-test","dom-overlay","dom-overlay-for-handheld-ar"]},children:t,...i},r)=>M.createElement(N$,{...i,ref:r,mode:"AR",style:n,sessionInit:e},t));M.forwardRef(({style:n=k$,sessionInit:e={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]},children:t,...i},r)=>M.createElement(N$,{...i,ref:r,mode:"VR",style:n,sessionInit:e},t));function qi(n=t=>t,e){const t=M.useContext(T$);if(!t)throw new Error("useXR must be used within an <XR /> component!");return t(n,e)}function p5(n){const e=qi(i=>i.controllers);return M.useMemo(()=>e.find(({inputSource:i})=>i.handedness===n),[n,e])}const Y_e="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",K_e="generic-trigger",L$=(n,e)=>{e.traverse(t=>{t instanceof Rn&&"envMap"in t.material&&(t.material.envMap=n,t.material.needsUpdate=!0)})};class D_e extends In{constructor(){super(),this.motionController=null,this.envMap=null,this.scene=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,L$(this.envMap,this),this)}connectModel(e){if(!this.motionController){console.warn("scene tried to add, but no motion controller");return}this.scene=e,U_e(this,e),this.dispatchEvent({type:"modelconnected",data:e})}connectMotionController(e){this.motionController=e,this.dispatchEvent({type:"motionconnected",data:e})}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(i=>{const{valueNode:r,minNode:s,maxNode:o,value:a,valueNodeProperty:l}=i;r&&(l===yi.VisualResponseProperty.VISIBILITY&&typeof a=="boolean"?r.visible=a:l===yi.VisualResponseProperty.TRANSFORM&&s&&o&&typeof a=="number"&&(r.quaternion.slerpQuaternions(s.quaternion,o.quaternion,a),r.position.lerpVectors(s.position,o.position,a)))})}))}disconnect(){this.dispatchEvent({type:"motiondisconnected",data:this.motionController}),this.dispatchEvent({type:"modeldisconnected",data:this.scene}),this.motionController=null,this.scene&&this.remove(this.scene),this.scene=null}dispose(){this.disconnect()}}function P_e(n,e){Object.values(n.components).forEach(t=>{const{type:i,touchPointNodeName:r,visualResponses:s}=t;if(i===yi.ComponentType.TOUCHPAD&&r)if(t.touchPointNode=e.getObjectByName(r),t.touchPointNode){const o=new xf(.001),a=new os({color:255}),l=new Rn(o,a);t.touchPointNode.add(l)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(s).forEach(o=>{const{valueNodeName:a,minNodeName:l,maxNodeName:c,valueNodeProperty:g}=o;if(g===yi.VisualResponseProperty.TRANSFORM&&l&&c){if(o.minNode=e.getObjectByName(l),o.maxNode=e.getObjectByName(c),!o.minNode){console.warn(`Could not find ${l} in the model`);return}if(!o.maxNode){console.warn(`Could not find ${c} in the model`);return}}o.valueNode=e.getObjectByName(a),o.valueNode||console.warn(`Could not find ${a} in the model`)})})}function U_e(n,e){P_e(n.motionController,e),n.envMap&&L$(n.envMap,e),n.add(e)}class Q_e{constructor(e=null,t=Y_e){this.gltfLoader=e??new tx,this.path=t,this._assetCache={}}initializeControllerModel(e,t){const i=t.data;i.targetRayMode!=="tracked-pointer"||!i.gamepad||OIe(i,this.path,K_e).then(({profile:r,assetPath:s})=>{if(!s)throw new Error("no asset path");const o=new eAe(i,r,s);e.connectMotionController(o);const a=o.assetUrl,l=this._assetCache[a];if(l){const c=l.scene.clone();e.connectModel(c)}else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(a,c=>{if(!e.motionController){console.warn("motionController gone while gltf load, bailing...");return}this._assetCache[a]=c;const g=c.scene.clone();e.connectModel(g)},void 0,()=>{throw new Error(`Asset ${a} missing or malformed.`)})}}).catch(r=>{console.warn(r)})}}const O_e=M.forwardRef(function({target:e,hideOnBlur:t=!1,...i},r){const s=qi(l=>l.hoverState),o=M.useRef(null),a=M.useMemo(()=>new Et().setFromPoints([new D(0,0,0),new D(0,0,-1)]),[]);return M.useImperativeHandle(r,()=>o.current),yn(()=>{let l=1;const c=s[e.inputSource.handedness].values().next().value;c&&e.inputSource.handedness!=="none"?(l=c.distance,t&&(o.current.visible=!1)):t&&(o.current.visible=!0);const g=-.01;o.current.scale.z=l+g}),M.createElement("line",{ref:o,geometry:a,"material-opacity":.8,"material-transparent":!0,...i})}),J_e=new Q_e;class j_e extends ho{constructor(e){super(),this.xrControllerModel=new D_e,this.target=e,this.add(this.xrControllerModel),this._onConnected=this._onConnected.bind(this),this._onDisconnected=this._onDisconnected.bind(this),this.target.controller.addEventListener("connected",this._onConnected),this.target.controller.addEventListener("disconnected",this._onDisconnected)}_onConnected(e){J_e.initializeControllerModel(this.xrControllerModel,e)}_onDisconnected(e){this.xrControllerModel.disconnect()}dispose(){this.target.controller.removeEventListener("connected",this._onConnected),this.target.controller.removeEventListener("disconnected",this._onDisconnected)}}function q_e({rayMaterial:n={},hideRaysOnBlur:e=!1}){const t=qi(s=>s.controllers),i=qi(s=>s.isHandTracking),r=M.useMemo(()=>Object.entries(n).reduce((s,[o,a])=>({...s,[`material-${o}`]:a}),{}),[JSON.stringify(n)]);return M.useMemo(()=>Zd({ControllerModel:j_e}),[]),Ma(()=>{for(const s of t)s.controller.dispatchEvent({type:"connected",data:s.inputSource,fake:!0})},[t]),M.createElement(M.Fragment,null,t.map((s,o)=>M.createElement(M.Fragment,{key:o},yd(M.createElement("controllerModel",{args:[s]}),s.grip),yd(M.createElement(O_e,{visible:!i,hideOnBlur:e,target:s,...r}),s.controller))))}const Dm=new Ve;function ba(n,e,t,i,r,s){const o=2*Math.PI*r/4,a=Math.max(s-2*r,0),l=Math.PI/4;Dm.copy(e),Dm[i]=0,Dm.normalize();const c=.5*o/(o+a),g=1-Dm.angleTo(n)/l;return Math.sign(Dm[t])===1?g*c:a/(o+a)+c+c*(1-g)}class $_e extends ac{constructor(e=1,t=1,i=1,r=2,s=.1){if(r=r*2+1,s=Math.min(e/2,t/2,i/2,s),super(1,1,1,r,r,r),r===1)return;const o=this.toNonIndexed();this.index=null,this.attributes.position=o.attributes.position,this.attributes.normal=o.attributes.normal,this.attributes.uv=o.attributes.uv;const a=new Ve,l=new Ve,c=new Ve(e,t,i).divideScalar(2).subScalar(s),g=this.attributes.position.array,u=this.attributes.normal.array,d=this.attributes.uv.array,h=g.length/6,f=new Ve,I=.5/r;for(let A=0,p=0;A<g.length;A+=3,p+=2)switch(a.fromArray(g,A),l.copy(a),l.x-=Math.sign(l.x)*I,l.y-=Math.sign(l.y)*I,l.z-=Math.sign(l.z)*I,l.normalize(),g[A+0]=c.x*Math.sign(a.x)+l.x*s,g[A+1]=c.y*Math.sign(a.y)+l.y*s,g[A+2]=c.z*Math.sign(a.z)+l.z*s,u[A+0]=l.x,u[A+1]=l.y,u[A+2]=l.z,Math.floor(A/h)){case 0:f.set(1,0,0),d[p+0]=ba(f,l,"z","y",s,i),d[p+1]=1-ba(f,l,"y","z",s,t);break;case 1:f.set(-1,0,0),d[p+0]=1-ba(f,l,"z","y",s,i),d[p+1]=1-ba(f,l,"y","z",s,t);break;case 2:f.set(0,1,0),d[p+0]=1-ba(f,l,"x","z",s,e),d[p+1]=ba(f,l,"z","x",s,i);break;case 3:f.set(0,-1,0),d[p+0]=1-ba(f,l,"x","z",s,e),d[p+1]=1-ba(f,l,"z","x",s,i);break;case 4:f.set(0,0,1),d[p+0]=1-ba(f,l,"x","y",s,e),d[p+1]=1-ba(f,l,"y","x",s,t);break;case 5:f.set(0,0,-1),d[p+0]=ba(f,l,"x","y",s,e),d[p+1]=1-ba(f,l,"y","x",s,t);break}}}var H$={},Nx={},Yv={};Object.defineProperty(Yv,"__esModule",{value:!0});Yv.Vault=void 0;class eVe{constructor(){this._vault=[],this._vaultSize=120}getById(e){var t;return(t=this._vault.filter(i=>i.id===e))===null||t===void 0?void 0:t[0]}clear(){this._vault=[]}get(e,t){var i;const r=this._vault.sort((s,o)=>o.time-s.time);if(typeof e>"u")return r[0];for(let s=0;s<r.length;s++)if(r[s].time<=e){const a={older:r[s],newer:r[s-1]};if(t){const l=Math.abs(e-a.older.time),c=Math.abs(e-((i=a.newer)===null||i===void 0?void 0:i.time));return isNaN(c)||c<=l?a.older:a.newer}return a}}add(e){this._vault.length>this._vaultSize-1&&this._vault.sort((t,i)=>t.time-i.time).shift(),this._vault.push(e)}get size(){return this._vault.length}setMaxSize(e){this._vaultSize=e}getMaxSize(){return this._vaultSize}}Yv.Vault=eVe;var z$={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.radianLerp=n.degreeLerp=n.lerp=void 0;const e=3.14159265359,t=6.28318530718,i=(o,a,l)=>o+(a-o)*l;n.lerp=i;const r=(o,a,l)=>{let c,g=a-o;return g<-180?(a+=360,c=(0,n.lerp)(o,a,l),c>=360&&(c-=360)):g>180?(a-=360,c=(0,n.lerp)(o,a,l),c<0&&(c+=360)):c=(0,n.lerp)(o,a,l),c};n.degreeLerp=r;const s=(o,a,l)=>{let c,g=a-o;return g<-e?(a+=t,c=(0,n.lerp)(o,a,l),c>=t&&(c-=t)):g>e?(a-=t,c=(0,n.lerp)(o,a,l),c<0&&(c+=t)):c=(0,n.lerp)(o,a,l),c};n.radianLerp=s})(z$);var kx={};/**
 * @author        three.js authors
 * @copyright     Copyright © 2010-2021 three.js authors
 * @license       {@link https://github.com/mrdoob/three.js/blob/dev/LICENSE|MIT}
 * @description   Copied and modified from: https://github.com/mrdoob/three.js/blob/464efc85ecfda5c03d786d15d8f8eff20d70f256/src/math/Quaternion.js
 */Object.defineProperty(kx,"__esModule",{value:!0});kx.quatSlerp=void 0;const tVe=(n,e,t)=>{if(t===0)return n;if(t===1)return e;let i=n.x,r=n.y,s=n.z,o=n.w;const a=e.x,l=e.y,c=e.z,g=e.w;if(o!==g||i!==a||r!==l||s!==c){let u=1-t;const d=i*a+r*l+s*c+o*g,h=d>=0?1:-1,f=1-d*d;if(f>.001){const A=Math.sqrt(f),p=Math.atan2(A,d*h);u=Math.sin(u*p)/A,t=Math.sin(t*p)/A}const I=t*h;if(i=i*u+a*I,r=r*u+l*I,s=s*u+c*I,o=o*u+g*I,u===1-t){const A=1/Math.sqrt(i*i+r*r+s*s+o*o);i*=A,r*=A,s*=A,o*=A}}return{x:i,y:r,z:s,w:o}};kx.quatSlerp=tVe;Object.defineProperty(Nx,"__esModule",{value:!0});Nx.SnapshotInterpolation=void 0;const nVe=Yv,XG=z$,iVe=kx;class Eh{constructor(e,t={}){this.vault=new nVe.Vault,this._interpolationBuffer=100,this._timeOffset=-1,this.serverTime=0,e&&(this._interpolationBuffer=1e3/e*3),this.config={autoCorrectTimeOffset:!0,...t}}get interpolationBuffer(){return{get:()=>this._interpolationBuffer,set:e=>{this._interpolationBuffer=e}}}static Now(){return Date.now()}get timeOffset(){return this._timeOffset}static NewId(){return Math.random().toString(36).substr(2,6)}get snapshot(){return{create:e=>Eh.CreateSnapshot(e),add:e=>this.addSnapshot(e)}}static CreateSnapshot(e){const t=i=>{if(!Array.isArray(i))throw new Error("You have to pass an Array to createSnapshot()");if(i.filter(s=>typeof s.id!="string"&&typeof s.id!="number").length>0)throw new Error("Each Entity needs to have a id")};return Array.isArray(e)?t(e):Object.keys(e).forEach(i=>{t(e[i])}),{id:Eh.NewId(),time:Eh.Now(),state:e}}addSnapshot(e){var t;const i=Eh.Now(),r=e.time;if(this._timeOffset===-1&&(this._timeOffset=i-r),((t=this.config)===null||t===void 0?void 0:t.autoCorrectTimeOffset)===!0){const s=i-r;Math.abs(this._timeOffset-s)>50&&(this._timeOffset=s)}this.vault.add(e)}interpolate(e,t,i,r,s=""){return this._interpolate(e,t,i,r,s)}_interpolate(e,t,i,r,s){const o=[e,t].sort((w,G)=>G.time-w.time),a=r.trim().replace(/\W+/," ").split(" "),l=o[0],c=o[1],g=l.time,u=c.time,h=i-u,f=g-u,I=i<=1?i:h/f;this.serverTime=(0,XG.lerp)(u,g,I);const A=(w,G,x,B)=>{if(!(typeof G>"u"||typeof x>"u")){if(typeof G=="string"||typeof x=="string")throw new Error("Can't interpolate string!");if(typeof G=="number"&&typeof x=="number"){if(w==="linear")return(0,XG.lerp)(G,x,B);if(w==="deg")return(0,XG.degreeLerp)(G,x,B);if(w==="rad")return(0,XG.radianLerp)(G,x,B)}if(typeof G=="object"&&typeof x=="object"&&w==="quat")return(0,iVe.quatSlerp)(G,x,B);throw new Error(`No lerp method "${w}" found!`)}};if(!Array.isArray(l.state)&&s==="")throw new Error('You forgot to add the "deep" parameter.');if(Array.isArray(l.state)&&s!=="")throw new Error('No "deep" needed it state is an array.');const p=Array.isArray(l.state)?l.state:l.state[s],y=Array.isArray(c.state)?c.state:c.state[s];let v=JSON.parse(JSON.stringify({...l,state:p}));return p.forEach((w,G)=>{const x=w.id,B=y.find(R=>R.id===x);B&&a.forEach(R=>{const Z=R.match(/\w\(([\w]+)\)/),W=Z?Z==null?void 0:Z[1]:"linear";Z&&(R=Z==null?void 0:Z[0].replace(/\([\S]+$/gm,""));const F=w==null?void 0:w[R],T=B==null?void 0:B[R],V=A(W,T,F,I);Array.isArray(v.state)&&(v.state[G][R]=V)})}),{state:v.state,percentage:I,newer:l.id,older:c.id}}calcInterpolation(e,t=""){const i=Eh.Now()-this._timeOffset-this._interpolationBuffer,r=this.vault.get(i);if(!r)return;const{older:s,newer:o}=r;if(!(!s||!o))return this._interpolate(o,s,i,e,t)}}Nx.SnapshotInterpolation=Eh;var X$={};Object.defineProperty(X$,"__esModule",{value:!0});(function(n){/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/geckosio/snapshot-interpolation
 * @license      {@link https://github.com/geckosio/snapshot-interpolation/blob/master/LICENSE|GNU GPLv3}
 */var e=Ch&&Ch.__createBinding||(Object.create?function(o,a,l,c){c===void 0&&(c=l),Object.defineProperty(o,c,{enumerable:!0,get:function(){return a[l]}})}:function(o,a,l,c){c===void 0&&(c=l),o[c]=a[l]}),t=Ch&&Ch.__setModuleDefault||(Object.create?function(o,a){Object.defineProperty(o,"default",{enumerable:!0,value:a})}:function(o,a){o.default=a}),i=Ch&&Ch.__importStar||function(o){if(o&&o.__esModule)return o;var a={};if(o!=null)for(var l in o)l!=="default"&&Object.prototype.hasOwnProperty.call(o,l)&&e(a,o,l);return t(a,o),a};Object.defineProperty(n,"__esModule",{value:!0}),n.Types=n.Vault=n.SnapshotInterpolation=void 0;var r=Nx;Object.defineProperty(n,"SnapshotInterpolation",{enumerable:!0,get:function(){return r.SnapshotInterpolation}});var s=Yv;Object.defineProperty(n,"Vault",{enumerable:!0,get:function(){return s.Vault}}),n.Types=i(X$)})(H$);var Y$={exports:{}};(function(n){var e={};e.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),e.useArrayBufferView=!e.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),n.exports.binaryFeatures=e;var t=n.exports.BlobBuilder;typeof window<"u"&&(t=n.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder);function i(){this._pieces=[],this._parts=[]}i.prototype.append=function(r){typeof r=="number"?this._pieces.push(r):(this.flush(),this._parts.push(r))},i.prototype.flush=function(){if(this._pieces.length>0){var r=new Uint8Array(this._pieces);e.useArrayBufferView||(r=r.buffer),this._parts.push(r),this._pieces=[]}},i.prototype.getBuffer=function(){if(this.flush(),e.useBlobBuilder){for(var r=new t,s=0,o=this._parts.length;s<o;s++)r.append(this._parts[s]);return r.getBlob()}else return new Blob(this._parts)},n.exports.BufferBuilder=i})(Y$);var K$=Y$.exports,rVe=K$.BufferBuilder,QD=K$.binaryFeatures,sVe={unpack:function(n){var e=new Vr(n);return e.unpack()},pack:function(n){var e=new Tr;e.pack(n);var t=e.getBuffer();return t}},oVe=sVe;function Vr(n){this.index=0,this.dataBuffer=n,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}Vr.prototype.unpack=function(){var n=this.unpack_uint8();if(n<128)return n;if((n^224)<32)return(n^224)-32;var e;if((e=n^160)<=15)return this.unpack_raw(e);if((e=n^176)<=15)return this.unpack_string(e);if((e=n^144)<=15)return this.unpack_array(e);if((e=n^128)<=15)return this.unpack_map(e);switch(n){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}};Vr.prototype.unpack_uint8=function(){var n=this.dataView[this.index]&255;return this.index++,n};Vr.prototype.unpack_uint16=function(){var n=this.read(2),e=(n[0]&255)*256+(n[1]&255);return this.index+=2,e};Vr.prototype.unpack_uint32=function(){var n=this.read(4),e=((n[0]*256+n[1])*256+n[2])*256+n[3];return this.index+=4,e};Vr.prototype.unpack_uint64=function(){var n=this.read(8),e=((((((n[0]*256+n[1])*256+n[2])*256+n[3])*256+n[4])*256+n[5])*256+n[6])*256+n[7];return this.index+=8,e};Vr.prototype.unpack_int8=function(){var n=this.unpack_uint8();return n<128?n:n-256};Vr.prototype.unpack_int16=function(){var n=this.unpack_uint16();return n<32768?n:n-65536};Vr.prototype.unpack_int32=function(){var n=this.unpack_uint32();return n<Math.pow(2,31)?n:n-Math.pow(2,32)};Vr.prototype.unpack_int64=function(){var n=this.unpack_uint64();return n<Math.pow(2,63)?n:n-Math.pow(2,64)};Vr.prototype.unpack_raw=function(n){if(this.length<this.index+n)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+n+" "+this.length);var e=this.dataBuffer.slice(this.index,this.index+n);return this.index+=n,e};Vr.prototype.unpack_string=function(n){for(var e=this.read(n),t=0,i="",r,s;t<n;)r=e[t],r<128?(i+=String.fromCharCode(r),t++):(r^192)<32?(s=(r^192)<<6|e[t+1]&63,i+=String.fromCharCode(s),t+=2):(s=(r&15)<<12|(e[t+1]&63)<<6|e[t+2]&63,i+=String.fromCharCode(s),t+=3);return this.index+=n,i};Vr.prototype.unpack_array=function(n){for(var e=new Array(n),t=0;t<n;t++)e[t]=this.unpack();return e};Vr.prototype.unpack_map=function(n){for(var e={},t=0;t<n;t++){var i=this.unpack(),r=this.unpack();e[i]=r}return e};Vr.prototype.unpack_float=function(){var n=this.unpack_uint32(),e=n>>31,t=(n>>23&255)-127,i=n&8388607|8388608;return(e===0?1:-1)*i*Math.pow(2,t-23)};Vr.prototype.unpack_double=function(){var n=this.unpack_uint32(),e=this.unpack_uint32(),t=n>>31,i=(n>>20&2047)-1023,r=n&1048575|1048576,s=r*Math.pow(2,i-20)+e*Math.pow(2,i-52);return(t===0?1:-1)*s};Vr.prototype.read=function(n){var e=this.index;if(e+n<=this.length)return this.dataView.subarray(e,e+n);throw new Error("BinaryPackFailure: read index out of range")};function Tr(){this.bufferBuilder=new rVe}Tr.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()};Tr.prototype.pack=function(n){var e=typeof n;if(e==="string")this.pack_string(n);else if(e==="number")Math.floor(n)===n?this.pack_integer(n):this.pack_double(n);else if(e==="boolean")n===!0?this.bufferBuilder.append(195):n===!1&&this.bufferBuilder.append(194);else if(e==="undefined")this.bufferBuilder.append(192);else if(e==="object")if(n===null)this.bufferBuilder.append(192);else{var t=n.constructor;if(t==Array)this.pack_array(n);else if(t==Blob||t==File||n instanceof Blob||n instanceof File)this.pack_bin(n);else if(t==ArrayBuffer)QD.useArrayBufferView?this.pack_bin(new Uint8Array(n)):this.pack_bin(n);else if("BYTES_PER_ELEMENT"in n)QD.useArrayBufferView?this.pack_bin(new Uint8Array(n.buffer)):this.pack_bin(n.buffer);else if(t==Object||t.toString().startsWith("class"))this.pack_object(n);else if(t==Date)this.pack_string(n.toString());else if(typeof n.toBinaryPack=="function")this.bufferBuilder.append(n.toBinaryPack());else throw new Error('Type "'+t.toString()+'" not yet supported')}else throw new Error('Type "'+e+'" not yet supported');this.bufferBuilder.flush()};Tr.prototype.pack_bin=function(n){var e=n.length||n.byteLength||n.size;if(e<=15)this.pack_uint8(160+e);else if(e<=65535)this.bufferBuilder.append(218),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(219),this.pack_uint32(e);else throw new Error("Invalid length");this.bufferBuilder.append(n)};Tr.prototype.pack_string=function(n){var e=lVe(n);if(e<=15)this.pack_uint8(176+e);else if(e<=65535)this.bufferBuilder.append(216),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(217),this.pack_uint32(e);else throw new Error("Invalid length");this.bufferBuilder.append(n)};Tr.prototype.pack_array=function(n){var e=n.length;if(e<=15)this.pack_uint8(144+e);else if(e<=65535)this.bufferBuilder.append(220),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(221),this.pack_uint32(e);else throw new Error("Invalid length");for(var t=0;t<e;t++)this.pack(n[t])};Tr.prototype.pack_integer=function(n){if(n>=-32&&n<=127)this.bufferBuilder.append(n&255);else if(n>=0&&n<=255)this.bufferBuilder.append(204),this.pack_uint8(n);else if(n>=-128&&n<=127)this.bufferBuilder.append(208),this.pack_int8(n);else if(n>=0&&n<=65535)this.bufferBuilder.append(205),this.pack_uint16(n);else if(n>=-32768&&n<=32767)this.bufferBuilder.append(209),this.pack_int16(n);else if(n>=0&&n<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(n);else if(n>=-2147483648&&n<=2147483647)this.bufferBuilder.append(210),this.pack_int32(n);else if(n>=-9223372036854776e3&&n<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(n);else if(n>=0&&n<=18446744073709552e3)this.bufferBuilder.append(207),this.pack_uint64(n);else throw new Error("Invalid integer")};Tr.prototype.pack_double=function(n){var e=0;n<0&&(e=1,n=-n);var t=Math.floor(Math.log(n)/Math.LN2),i=n/Math.pow(2,t)-1,r=Math.floor(i*Math.pow(2,52)),s=Math.pow(2,32),o=e<<31|t+1023<<20|r/s&1048575,a=r%s;this.bufferBuilder.append(203),this.pack_int32(o),this.pack_int32(a)};Tr.prototype.pack_object=function(n){var e=Object.keys(n),t=e.length;if(t<=15)this.pack_uint8(128+t);else if(t<=65535)this.bufferBuilder.append(222),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(223),this.pack_uint32(t);else throw new Error("Invalid length");for(var i in n)n.hasOwnProperty(i)&&(this.pack(i),this.pack(n[i]))};Tr.prototype.pack_uint8=function(n){this.bufferBuilder.append(n)};Tr.prototype.pack_uint16=function(n){this.bufferBuilder.append(n>>8),this.bufferBuilder.append(n&255)};Tr.prototype.pack_uint32=function(n){var e=n&4294967295;this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)};Tr.prototype.pack_uint64=function(n){var e=n/Math.pow(2,32),t=n%Math.pow(2,32);this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255),this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};Tr.prototype.pack_int8=function(n){this.bufferBuilder.append(n&255)};Tr.prototype.pack_int16=function(n){this.bufferBuilder.append((n&65280)>>8),this.bufferBuilder.append(n&255)};Tr.prototype.pack_int32=function(n){this.bufferBuilder.append(n>>>24&255),this.bufferBuilder.append((n&16711680)>>>16),this.bufferBuilder.append((n&65280)>>>8),this.bufferBuilder.append(n&255)};Tr.prototype.pack_int64=function(n){var e=Math.floor(n/Math.pow(2,32)),t=n%Math.pow(2,32);this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255),this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};function aVe(n){var e=n.charCodeAt(0);return e<=2047?"00":e<=65535?"000":e<=2097151?"0000":e<=67108863?"00000":"000000"}function lVe(n){return n.length>600?new Blob([n]).size:n.replace(/[^\u0000-\u007F]/g,aVe).length}const OD=Ks(oVe);let D$=!0,P$=!0;function g0(n,e,t){const i=n.match(e);return i&&i.length>=t&&parseInt(i[t],10)}function hp(n,e,t){if(!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(o,a){if(o!==e)return r.apply(this,arguments);const l=c=>{const g=t(c);g&&(a.handleEvent?a.handleEvent(g):a(g))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,l),r.apply(this,[o,l])};const s=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const l=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,l])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function cVe(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(D$=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function gVe(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(P$=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function m5(){if(typeof window=="object"){if(D$)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Lx(n,e){P$&&console.warn(n+" is deprecated, please use "+e+" instead.")}function uVe(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator)return e.browser="Not a browser.",e;const{navigator:t}=n;if(t.mozGetUserMedia)e.browser="firefox",e.version=g0(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection&&!n.RTCIceGatherer)e.browser="chrome",e.version=g0(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=g0(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(n.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=g0(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function JD(n){return Object.prototype.toString.call(n)==="[object Object]"}function U$(n){return JD(n)?Object.keys(n).reduce(function(e,t){const i=JD(n[t]),r=i?U$(n[t]):n[t],s=i&&!Object.keys(r).length;return r===void 0||s?e:Object.assign(e,{[t]:r})},{}):n}function fF(n,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?fF(n,n.get(e[i]),t):i.endsWith("Ids")&&e[i].forEach(r=>{fF(n,n.get(r),t)})}))}function jD(n,e,t){const i=t?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return n.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{n.forEach(a=>{a.type===i&&a.trackId===o.id&&fF(n,a,r)})}),r}const qD=m5;function Q$(n,e){const t=n&&n.navigator;if(!t.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const l={};return Object.keys(a).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const g=typeof a[c]=="object"?a[c]:{ideal:a[c]};g.exact!==void 0&&typeof g.exact=="number"&&(g.min=g.max=g.exact);const u=function(d,h){return d?d+h.charAt(0).toUpperCase()+h.slice(1):h==="deviceId"?"sourceId":h};if(g.ideal!==void 0){l.optional=l.optional||[];let d={};typeof g.ideal=="number"?(d[u("min",c)]=g.ideal,l.optional.push(d),d={},d[u("max",c)]=g.ideal,l.optional.push(d)):(d[u("",c)]=g.ideal,l.optional.push(d))}g.exact!==void 0&&typeof g.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[u("",c)]=g.exact):["min","max"].forEach(d=>{g[d]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[u(d,c)]=g[d])})}),a.advanced&&(l.optional=(l.optional||[]).concat(a.advanced)),l},r=function(a,l){if(e.version>=61)return l(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const c=function(g,u,d){u in g&&!(d in g)&&(g[d]=g[u],delete g[u])};a=JSON.parse(JSON.stringify(a)),c(a.audio,"autoGainControl","googAutoGainControl"),c(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let c=a.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const g=e.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!g)){delete a.video.facingMode;let u;if(c.exact==="environment"||c.ideal==="environment"?u=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(u=["front"]),u)return t.mediaDevices.enumerateDevices().then(d=>{d=d.filter(f=>f.kind==="videoinput");let h=d.find(f=>u.some(I=>f.label.toLowerCase().includes(I)));return!h&&d.length&&u.includes("back")&&(h=d[d.length-1]),h&&(a.video.deviceId=c.exact?{exact:h.deviceId}:{ideal:h.deviceId}),a.video=i(a.video),qD("chrome: "+JSON.stringify(a)),l(a)})}a.video=i(a.video)}return qD("chrome: "+JSON.stringify(a)),l(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,l,c){r(a,g=>{t.webkitGetUserMedia(g,l,u=>{c&&c(s(u))})})};if(t.getUserMedia=o.bind(t),t.mediaDevices.getUserMedia){const a=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(l){return r(l,c=>a(c).then(g=>{if(c.audio&&!g.getAudioTracks().length||c.video&&!g.getVideoTracks().length)throw g.getTracks().forEach(u=>{u.stop()}),new DOMException("","NotFoundError");return g},g=>Promise.reject(s(g))))}}}function dVe(n,e){if(!(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices)&&n.navigator.mediaDevices){if(typeof e!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}n.navigator.mediaDevices.getDisplayMedia=function(i){return e(i).then(r=>{const s=i.video&&i.video.width,o=i.video&&i.video.height,a=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:a||3}},s&&(i.video.mandatory.maxWidth=s),o&&(i.video.mandatory.maxHeight=o),n.navigator.mediaDevices.getUserMedia(i)})}}}function O$(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function J$(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let s;n.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):s={track:r.track};const o=new Event("track");o.track=r.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(r=>{let s;n.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.id):s={track:r};const o=new Event("track");o.track=r,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else hp(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function j$(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,l){let c=r.apply(this,arguments);return c||(c=e(this,a),this._senders.push(c)),c};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const l=this._senders.indexOf(a);l!==-1&&this._senders.splice(l,1)}}const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],t.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(l=>l.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function q$(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[i,r,s]=arguments;if(arguments.length>0&&typeof i=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof i!="function"))return e.apply(this,[]);const o=function(l){const c={};return l.result().forEach(u=>{const d={id:u.id,timestamp:u.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[u.type]||u.type};u.names().forEach(h=>{d[h]=u.stat(h)}),c[d.id]=d}),c},a=function(l){return new Map(Object.keys(l).map(c=>[c,l[c]]))};if(arguments.length>=2){const l=function(c){r(a(o(c)))};return e.apply(this,[l,i])}return new Promise((l,c)=>{e.apply(this,[function(g){l(a(o(g)))},c])}).then(r,s)}}function $$(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return s.forEach(o=>o._pc=this),s});const i=n.RTCPeerConnection.prototype.addTrack;i&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>jD(o,s.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(s=>s._pc=this),r}),hp(n,"track",i=>(i.receiver._pc=i.srcElement,i)),n.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>jD(s,r.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const i=arguments[0];let r,s,o;return this.getSenders().forEach(a=>{a.track===i&&(r?o=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===i&&(s?o=!0:s=a),a.track===i)),o||r&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function eee(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(l)===-1&&this._shimmedLocalStreams[a.id].push(l):this._shimmedLocalStreams[a.id]=[a,l],l};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(c=>{if(this.getSenders().find(u=>u.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();t.apply(this,arguments);const l=this.getSenders().filter(c=>a.indexOf(c)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const r=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const l=this._shimmedLocalStreams[a].indexOf(o);l!==-1&&this._shimmedLocalStreams[a].splice(l,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),r.apply(this,arguments)}}function tee(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return eee(n);const t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const g=t.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map(u=>this._reverseStreams[u.id])};const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach(u=>{if(this.getSenders().find(h=>h.track===u))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[g.id]){const u=new n.MediaStream(g.getTracks());this._streams[g.id]=u,this._reverseStreams[u.id]=g,g=u}i.apply(this,[g])};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},n.RTCPeerConnection.prototype.addTrack=function(g,u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const d=[].slice.call(arguments,1);if(d.length!==1||!d[0].getTracks().find(I=>I===g))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(I=>I.track===g))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const f=this._streams[u.id];if(f)f.addTrack(g),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const I=new n.MediaStream([g]);this._streams[u.id]=I,this._reverseStreams[I.id]=u,this.addStream(I)}return this.getSenders().find(I=>I.track===g)};function s(c,g){let u=g.sdp;return Object.keys(c._reverseStreams||[]).forEach(d=>{const h=c._reverseStreams[d],f=c._streams[h.id];u=u.replace(new RegExp(f.id,"g"),h.id)}),new RTCSessionDescription({type:g.type,sdp:u})}function o(c,g){let u=g.sdp;return Object.keys(c._reverseStreams||[]).forEach(d=>{const h=c._reverseStreams[d],f=c._streams[h.id];u=u.replace(new RegExp(h.id,"g"),f.id)}),new RTCSessionDescription({type:g.type,sdp:u})}["createOffer","createAnswer"].forEach(function(c){const g=n.RTCPeerConnection.prototype[c],u={[c](){const d=arguments;return arguments.length&&typeof arguments[0]=="function"?g.apply(this,[f=>{const I=s(this,f);d[0].apply(null,[I])},f=>{d[1]&&d[1].apply(null,f)},arguments[2]]):g.apply(this,arguments).then(f=>s(this,f))}};n.RTCPeerConnection.prototype[c]=u[c]});const a=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const c=l.get.apply(this);return c.type===""?c:s(this,c)}}),n.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(g._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let d;Object.keys(this._streams).forEach(h=>{this._streams[h].getTracks().find(I=>g.track===I)&&(d=this._streams[h])}),d&&(d.getTracks().length===1?this.removeStream(this._reverseStreams[d.id]):d.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function IF(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const i=n.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=r[t]})}function nee(n,e){hp(n,"negotiationneeded",t=>{const i=t.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return t})}const $D=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:nee,shimAddTrackRemoveTrack:tee,shimAddTrackRemoveTrackWithNative:eee,shimGetDisplayMedia:dVe,shimGetSendersWithDtmf:j$,shimGetStats:q$,shimGetUserMedia:Q$,shimMediaStream:O$,shimOnTrack:J$,shimPeerConnection:IF,shimSenderReceiverGetStats:$$},Symbol.toStringTag,{value:"Module"}));function hVe(n,e){let t=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(i=>{if(i&&(i.urls||i.url)){let r=i.urls||i.url;i.url&&!i.urls&&Lx("RTCIceServer.url","RTCIceServer.urls");const s=typeof r=="string";return s&&(r=[r]),r=r.filter(o=>{if(o.indexOf("stun:")===0)return!1;const a=o.startsWith("turn")&&!o.startsWith("turn:[")&&o.includes("transport=udp");return a&&!t?(t=!0,!0):a&&!t}),delete i.url,i.urls=s?r[0]:r,!!r.length}})}var iee={exports:{}};(function(n){var e={};e.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(function(i){return i.trim()})},e.splitSections=function(t){var i=t.split(`
m=`);return i.map(function(r,s){return(s>0?"m="+r:r).trim()+`\r
`})},e.getDescription=function(t){var i=e.splitSections(t);return i&&i[0]},e.getMediaSections=function(t){var i=e.splitSections(t);return i.shift(),i},e.matchPrefix=function(t,i){return e.splitLines(t).filter(function(r){return r.indexOf(i)===0})},e.parseCandidate=function(t){var i;t.indexOf("a=candidate:")===0?i=t.substring(12).split(" "):i=t.substring(10).split(" ");for(var r={foundation:i[0],component:parseInt(i[1],10),protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]},s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]=i[s+1];break}return r},e.writeCandidate=function(t){var i=[];i.push(t.foundation),i.push(t.component),i.push(t.protocol.toUpperCase()),i.push(t.priority),i.push(t.address||t.ip),i.push(t.port);var r=t.type;return i.push("typ"),i.push(r),r!=="host"&&t.relatedAddress&&t.relatedPort&&(i.push("raddr"),i.push(t.relatedAddress),i.push("rport"),i.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(i.push("ufrag"),i.push(t.usernameFragment||t.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(t){return t.substr(14).split(" ")},e.parseRtpMap=function(t){var i=t.substr(9).split(" "),r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(t){var i=t.payloadType;t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType);var r=t.channels||t.numChannels||1;return"a=rtpmap:"+i+" "+t.name+"/"+t.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(t){var i=t.substr(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1]}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+`\r
`},e.parseFmtp=function(t){for(var i={},r,s=t.substr(t.indexOf(" ")+1).split(";"),o=0;o<s.length;o++)r=s[o].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(t){var i="",r=t.payloadType;if(t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var s=[];Object.keys(t.parameters).forEach(function(o){t.parameters[o]?s.push(o+"="+t.parameters[o]):s.push(o)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(t){var i=t.substr(t.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(t){var i="",r=t.payloadType;return t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(function(s){i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(t){var i=t.indexOf(" "),r={ssrc:parseInt(t.substr(7,i-7),10)},s=t.indexOf(":",i);return s>-1?(r.attribute=t.substr(i+1,s-i-1),r.value=t.substr(s+1)):r.attribute=t.substr(i+1),r},e.parseSsrcGroup=function(t){var i=t.substr(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(function(r){return parseInt(r,10)})}},e.getMid=function(t){var i=e.matchPrefix(t,"a=mid:")[0];if(i)return i.substr(6)},e.parseFingerprint=function(t){var i=t.substr(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1]}},e.getDtlsParameters=function(t,i){var r=e.matchPrefix(t+i,"a=fingerprint:");return{role:"auto",fingerprints:r.map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,i){var r="a=setup:"+i+`\r
`;return t.fingerprints.forEach(function(s){r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(t){var i=t.substr(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;var i=t.substr(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,i){var r=e.matchPrefix(t+i,"a=crypto:");return r.map(e.parseCryptoLine)},e.getIceParameters=function(t,i){var r=e.matchPrefix(t+i,"a=ice-ufrag:")[0],s=e.matchPrefix(t+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substr(12),password:s.substr(10)}:null},e.writeIceParameters=function(t){return"a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`},e.parseRtpParameters=function(t){for(var i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=e.splitLines(t),s=r[0].split(" "),o=3;o<s.length;o++){var a=s[o],l=e.matchPrefix(t,"a=rtpmap:"+a+" ")[0];if(l){var c=e.parseRtpMap(l),g=e.matchPrefix(t,"a=fmtp:"+a+" ");switch(c.parameters=g.length?e.parseFmtp(g[0]):{},c.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+a+" ").map(e.parseRtcpFb),i.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(c.name.toUpperCase());break}}}return e.matchPrefix(t,"a=extmap:").forEach(function(u){i.headerExtensions.push(e.parseExtmap(u))}),i},e.writeRtpDescription=function(t,i){var r="";r+="m="+t+" ",r+=i.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=i.codecs.map(function(o){return o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType}).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(function(o){r+=e.writeRtpMap(o),r+=e.writeFmtp(o),r+=e.writeRtcpFb(o)});var s=0;return i.codecs.forEach(function(o){o.maxptime>s&&(s=o.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),r+=`a=rtcp-mux\r
`,i.headerExtensions&&i.headerExtensions.forEach(function(o){r+=e.writeExtmap(o)}),r},e.parseRtpEncodingParameters=function(t){var i=[],r=e.parseRtpParameters(t),s=r.fecMechanisms.indexOf("RED")!==-1,o=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(t,"a=ssrc:").map(function(d){return e.parseSsrcMedia(d)}).filter(function(d){return d.attribute==="cname"}),l=a.length>0&&a[0].ssrc,c,g=e.matchPrefix(t,"a=ssrc-group:FID").map(function(d){var h=d.substr(17).split(" ");return h.map(function(f){return parseInt(f,10)})});g.length>0&&g[0].length>1&&g[0][0]===l&&(c=g[0][1]),r.codecs.forEach(function(d){if(d.name.toUpperCase()==="RTX"&&d.parameters.apt){var h={ssrc:l,codecPayloadType:parseInt(d.parameters.apt,10)};l&&c&&(h.rtx={ssrc:c}),i.push(h),s&&(h=JSON.parse(JSON.stringify(h)),h.fec={ssrc:l,mechanism:o?"red+ulpfec":"red"},i.push(h))}}),i.length===0&&l&&i.push({ssrc:l});var u=e.matchPrefix(t,"b=");return u.length&&(u[0].indexOf("b=TIAS:")===0?u=parseInt(u[0].substr(7),10):u[0].indexOf("b=AS:")===0?u=parseInt(u[0].substr(5),10)*1e3*.95-50*40*8:u=void 0,i.forEach(function(d){d.maxBitrate=u})),i},e.parseRtcpParameters=function(t){var i={},r=e.matchPrefix(t,"a=ssrc:").map(function(a){return e.parseSsrcMedia(a)}).filter(function(a){return a.attribute==="cname"})[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);var s=e.matchPrefix(t,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;var o=e.matchPrefix(t,"a=rtcp-mux");return i.mux=o.length>0,i},e.parseMsid=function(t){var i,r=e.matchPrefix(t,"a=msid:");if(r.length===1)return i=r[0].substr(7).split(" "),{stream:i[0],track:i[1]};var s=e.matchPrefix(t,"a=ssrc:").map(function(o){return e.parseSsrcMedia(o)}).filter(function(o){return o.attribute==="msid"});if(s.length>0)return i=s[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(t){var i=e.parseMLine(t),r=e.matchPrefix(t,"a=max-message-size:"),s;r.length>0&&(s=parseInt(r[0].substr(19),10)),isNaN(s)&&(s=65536);var o=e.matchPrefix(t,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:i.fmt,maxMessageSize:s};var a=e.matchPrefix(t,"a=sctpmap:");if(a.length>0){var l=e.matchPrefix(t,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:s}}},e.writeSctpDescription=function(t,i){var r=[];return t.protocol!=="DTLS/SCTP"?r=["m="+t.kind+" 9 "+t.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+t.kind+" 9 "+t.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,21)},e.writeSessionBoilerplate=function(t,i,r){var s,o=i!==void 0?i:2;t?s=t:s=e.generateSessionId();var a=r||"thisisadapterortc";return`v=0\r
o=`+a+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.writeMediaSection=function(t,i,r,s){var o=e.writeRtpDescription(t.kind,i);if(o+=e.writeIceParameters(t.iceGatherer.getLocalParameters()),o+=e.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),r==="offer"?"actpass":"active"),o+="a=mid:"+t.mid+`\r
`,t.direction?o+="a="+t.direction+`\r
`:t.rtpSender&&t.rtpReceiver?o+=`a=sendrecv\r
`:t.rtpSender?o+=`a=sendonly\r
`:t.rtpReceiver?o+=`a=recvonly\r
`:o+=`a=inactive\r
`,t.rtpSender){var a="msid:"+s.id+" "+t.rtpSender.track.id+`\r
`;o+="a="+a,o+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+a,t.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return o+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+e.localCName+`\r
`,t.rtpSender&&t.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+e.localCName+`\r
`),o},e.getDirection=function(t,i){for(var r=e.splitLines(t),s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substr(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(t){var i=e.splitLines(t),r=i[0].split(" ");return r[0].substr(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){var i=e.splitLines(t),r=i[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(t){var i=e.matchPrefix(t,"o=")[0],r=i.substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;for(var i=e.splitLines(t),r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},n.exports=e})(iee);var ree=iee.exports;const T1=Ks(ree);var xt=ree;function fVe(n){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[n.type]||n.type}function eP(n,e,t,i,r){var s=xt.writeRtpDescription(n.kind,e);if(s+=xt.writeIceParameters(n.iceGatherer.getLocalParameters()),s+=xt.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),t==="offer"?"actpass":r||"active"),s+="a=mid:"+n.mid+`\r
`,n.rtpSender&&n.rtpReceiver?s+=`a=sendrecv\r
`:n.rtpSender?s+=`a=sendonly\r
`:n.rtpReceiver?s+=`a=recvonly\r
`:s+=`a=inactive\r
`,n.rtpSender){var o=n.rtpSender._initialTrackId||n.rtpSender.track.id;n.rtpSender._initialTrackId=o;var a="msid:"+(i?i.id:"-")+" "+o+`\r
`;s+="a="+a,s+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+a,n.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+a,s+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return s+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+xt.localCName+`\r
`,n.rtpSender&&n.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+xt.localCName+`\r
`),s}function IVe(n,e){var t=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(function(i){if(i&&(i.urls||i.url)){var r=i.urls||i.url;i.url&&!i.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var s=typeof r=="string";return s&&(r=[r]),r=r.filter(function(o){var a=o.indexOf("turn:")===0&&o.indexOf("transport=udp")!==-1&&o.indexOf("turn:[")===-1&&!t;return a?(t=!0,!0):o.indexOf("stun:")===0&&e>=14393&&o.indexOf("?transport=udp")===-1}),delete i.url,i.urls=s?r[0]:r,!!r.length}})}function YG(n,e){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(s,o){s=parseInt(s,10);for(var a=0;a<o.length;a++)if(o[a].payloadType===s||o[a].preferredPayloadType===s)return o[a]},r=function(s,o,a,l){var c=i(s.parameters.apt,a),g=i(o.parameters.apt,l);return c&&g&&c.name.toLowerCase()===g.name.toLowerCase()};return n.codecs.forEach(function(s){for(var o=0;o<e.codecs.length;o++){var a=e.codecs[o];if(s.name.toLowerCase()===a.name.toLowerCase()&&s.clockRate===a.clockRate){if(s.name.toLowerCase()==="rtx"&&s.parameters&&a.parameters.apt&&!r(s,a,n.codecs,e.codecs))continue;a=JSON.parse(JSON.stringify(a)),a.numChannels=Math.min(s.numChannels,a.numChannels),t.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(l){for(var c=0;c<s.rtcpFeedback.length;c++)if(s.rtcpFeedback[c].type===l.type&&s.rtcpFeedback[c].parameter===l.parameter)return!0;return!1});break}}}),n.headerExtensions.forEach(function(s){for(var o=0;o<e.headerExtensions.length;o++){var a=e.headerExtensions[o];if(s.uri===a.uri){t.headerExtensions.push(a);break}}}),t}function tP(n,e,t){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[e][n].indexOf(t)!==-1}function DM(n,e){var t=n.getRemoteCandidates().find(function(i){return e.foundation===i.foundation&&e.ip===i.ip&&e.port===i.port&&e.priority===i.priority&&e.protocol===i.protocol&&e.type===i.type});return t||n.addRemoteCandidate(e),!t}function $r(n,e){var t=new Error(e);return t.name=n,t.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[n],t}var AVe=function(n,e){function t(l,c){c.addTrack(l),c.dispatchEvent(new n.MediaStreamTrackEvent("addtrack",{track:l}))}function i(l,c){c.removeTrack(l),c.dispatchEvent(new n.MediaStreamTrackEvent("removetrack",{track:l}))}function r(l,c,g,u){var d=new Event("track");d.track=c,d.receiver=g,d.transceiver={receiver:g},d.streams=u,n.setTimeout(function(){l._dispatchEvent("track",d)})}var s=function(l){var c=this,g=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(d){c[d]=g[d].bind(g)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",l=JSON.parse(JSON.stringify(l||{})),this.usingBundle=l.bundlePolicy==="max-bundle",l.rtcpMuxPolicy==="negotiate")throw $r("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(l.rtcpMuxPolicy||(l.rtcpMuxPolicy="require"),l.iceTransportPolicy){case"all":case"relay":break;default:l.iceTransportPolicy="all";break}switch(l.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:l.bundlePolicy="balanced";break}if(l.iceServers=IVe(l.iceServers||[],e),this._iceGatherers=[],l.iceCandidatePoolSize)for(var u=l.iceCandidatePoolSize;u>0;u--)this._iceGatherers.push(new n.RTCIceGatherer({iceServers:l.iceServers,gatherPolicy:l.iceTransportPolicy}));else l.iceCandidatePoolSize=0;this._config=l,this.transceivers=[],this._sdpSessionId=xt.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(s.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(s.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),s.prototype.onicecandidate=null,s.prototype.onaddstream=null,s.prototype.ontrack=null,s.prototype.onremovestream=null,s.prototype.onsignalingstatechange=null,s.prototype.oniceconnectionstatechange=null,s.prototype.onconnectionstatechange=null,s.prototype.onicegatheringstatechange=null,s.prototype.onnegotiationneeded=null,s.prototype.ondatachannel=null,s.prototype._dispatchEvent=function(l,c){this._isClosed||(this.dispatchEvent(c),typeof this["on"+l]=="function"&&this["on"+l](c))},s.prototype._emitGatheringStateChange=function(){var l=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",l)},s.prototype.getConfiguration=function(){return this._config},s.prototype.getLocalStreams=function(){return this.localStreams},s.prototype.getRemoteStreams=function(){return this.remoteStreams},s.prototype._createTransceiver=function(l,c){var g=this.transceivers.length>0,u={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:l,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&g)u.iceTransport=this.transceivers[0].iceTransport,u.dtlsTransport=this.transceivers[0].dtlsTransport;else{var d=this._createIceAndDtlsTransports();u.iceTransport=d.iceTransport,u.dtlsTransport=d.dtlsTransport}return c||this.transceivers.push(u),u},s.prototype.addTrack=function(l,c){if(this._isClosed)throw $r("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var g=this.transceivers.find(function(h){return h.track===l});if(g)throw $r("InvalidAccessError","Track already exists.");for(var u,d=0;d<this.transceivers.length;d++)!this.transceivers[d].track&&this.transceivers[d].kind===l.kind&&(u=this.transceivers[d]);return u||(u=this._createTransceiver(l.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(c)===-1&&this.localStreams.push(c),u.track=l,u.stream=c,u.rtpSender=new n.RTCRtpSender(l,u.dtlsTransport),u.rtpSender},s.prototype.addStream=function(l){var c=this;if(e>=15025)l.getTracks().forEach(function(u){c.addTrack(u,l)});else{var g=l.clone();l.getTracks().forEach(function(u,d){var h=g.getTracks()[d];u.addEventListener("enabled",function(f){h.enabled=f.enabled})}),g.getTracks().forEach(function(u){c.addTrack(u,g)})}},s.prototype.removeTrack=function(l){if(this._isClosed)throw $r("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(l instanceof n.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var c=this.transceivers.find(function(d){return d.rtpSender===l});if(!c)throw $r("InvalidAccessError","Sender was not created by this connection.");var g=c.stream;c.rtpSender.stop(),c.rtpSender=null,c.track=null,c.stream=null;var u=this.transceivers.map(function(d){return d.stream});u.indexOf(g)===-1&&this.localStreams.indexOf(g)>-1&&this.localStreams.splice(this.localStreams.indexOf(g),1),this._maybeFireNegotiationNeeded()},s.prototype.removeStream=function(l){var c=this;l.getTracks().forEach(function(g){var u=c.getSenders().find(function(d){return d.track===g});u&&c.removeTrack(u)})},s.prototype.getSenders=function(){return this.transceivers.filter(function(l){return!!l.rtpSender}).map(function(l){return l.rtpSender})},s.prototype.getReceivers=function(){return this.transceivers.filter(function(l){return!!l.rtpReceiver}).map(function(l){return l.rtpReceiver})},s.prototype._createIceGatherer=function(l,c){var g=this;if(c&&l>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var u=new n.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(u,"state",{value:"new",writable:!0}),this.transceivers[l].bufferedCandidateEvents=[],this.transceivers[l].bufferCandidates=function(d){var h=!d.candidate||Object.keys(d.candidate).length===0;u.state=h?"completed":"gathering",g.transceivers[l].bufferedCandidateEvents!==null&&g.transceivers[l].bufferedCandidateEvents.push(d)},u.addEventListener("localcandidate",this.transceivers[l].bufferCandidates),u},s.prototype._gather=function(l,c){var g=this,u=this.transceivers[c].iceGatherer;if(!u.onlocalcandidate){var d=this.transceivers[c].bufferedCandidateEvents;this.transceivers[c].bufferedCandidateEvents=null,u.removeEventListener("localcandidate",this.transceivers[c].bufferCandidates),u.onlocalcandidate=function(h){if(!(g.usingBundle&&c>0)){var f=new Event("icecandidate");f.candidate={sdpMid:l,sdpMLineIndex:c};var I=h.candidate,A=!I||Object.keys(I).length===0;if(A)(u.state==="new"||u.state==="gathering")&&(u.state="completed");else{u.state==="new"&&(u.state="gathering"),I.component=1,I.ufrag=u.getLocalParameters().usernameFragment;var p=xt.writeCandidate(I);f.candidate=Object.assign(f.candidate,xt.parseCandidate(p)),f.candidate.candidate=p,f.candidate.toJSON=function(){return{candidate:f.candidate.candidate,sdpMid:f.candidate.sdpMid,sdpMLineIndex:f.candidate.sdpMLineIndex,usernameFragment:f.candidate.usernameFragment}}}var y=xt.getMediaSections(g._localDescription.sdp);A?y[f.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:y[f.candidate.sdpMLineIndex]+="a="+f.candidate.candidate+`\r
`,g._localDescription.sdp=xt.getDescription(g._localDescription.sdp)+y.join("");var v=g.transceivers.every(function(b){return b.iceGatherer&&b.iceGatherer.state==="completed"});g.iceGatheringState!=="gathering"&&(g.iceGatheringState="gathering",g._emitGatheringStateChange()),A||g._dispatchEvent("icecandidate",f),v&&(g._dispatchEvent("icecandidate",new Event("icecandidate")),g.iceGatheringState="complete",g._emitGatheringStateChange())}},n.setTimeout(function(){d.forEach(function(h){u.onlocalcandidate(h)})},0)}},s.prototype._createIceAndDtlsTransports=function(){var l=this,c=new n.RTCIceTransport(null);c.onicestatechange=function(){l._updateIceConnectionState(),l._updateConnectionState()};var g=new n.RTCDtlsTransport(c);return g.ondtlsstatechange=function(){l._updateConnectionState()},g.onerror=function(){Object.defineProperty(g,"state",{value:"failed",writable:!0}),l._updateConnectionState()},{iceTransport:c,dtlsTransport:g}},s.prototype._disposeIceAndDtlsTransports=function(l){var c=this.transceivers[l].iceGatherer;c&&(delete c.onlocalcandidate,delete this.transceivers[l].iceGatherer);var g=this.transceivers[l].iceTransport;g&&(delete g.onicestatechange,delete this.transceivers[l].iceTransport);var u=this.transceivers[l].dtlsTransport;u&&(delete u.ondtlsstatechange,delete u.onerror,delete this.transceivers[l].dtlsTransport)},s.prototype._transceive=function(l,c,g){var u=YG(l.localCapabilities,l.remoteCapabilities);c&&l.rtpSender&&(u.encodings=l.sendEncodingParameters,u.rtcp={cname:xt.localCName,compound:l.rtcpParameters.compound},l.recvEncodingParameters.length&&(u.rtcp.ssrc=l.recvEncodingParameters[0].ssrc),l.rtpSender.send(u)),g&&l.rtpReceiver&&u.codecs.length>0&&(l.kind==="video"&&l.recvEncodingParameters&&e<15019&&l.recvEncodingParameters.forEach(function(d){delete d.rtx}),l.recvEncodingParameters.length?u.encodings=l.recvEncodingParameters:u.encodings=[{}],u.rtcp={compound:l.rtcpParameters.compound},l.rtcpParameters.cname&&(u.rtcp.cname=l.rtcpParameters.cname),l.sendEncodingParameters.length&&(u.rtcp.ssrc=l.sendEncodingParameters[0].ssrc),l.rtpReceiver.receive(u))},s.prototype.setLocalDescription=function(l){var c=this;if(["offer","answer"].indexOf(l.type)===-1)return Promise.reject($r("TypeError",'Unsupported type "'+l.type+'"'));if(!tP("setLocalDescription",l.type,c.signalingState)||c._isClosed)return Promise.reject($r("InvalidStateError","Can not set local "+l.type+" in state "+c.signalingState));var g,u;if(l.type==="offer")g=xt.splitSections(l.sdp),u=g.shift(),g.forEach(function(h,f){var I=xt.parseRtpParameters(h);c.transceivers[f].localCapabilities=I}),c.transceivers.forEach(function(h,f){c._gather(h.mid,f)});else if(l.type==="answer"){g=xt.splitSections(c._remoteDescription.sdp),u=g.shift();var d=xt.matchPrefix(u,"a=ice-lite").length>0;g.forEach(function(h,f){var I=c.transceivers[f],A=I.iceGatherer,p=I.iceTransport,y=I.dtlsTransport,v=I.localCapabilities,b=I.remoteCapabilities,w=xt.isRejected(h)&&xt.matchPrefix(h,"a=bundle-only").length===0;if(!w&&!I.rejected){var G=xt.getIceParameters(h,u),x=xt.getDtlsParameters(h,u);d&&(x.role="server"),(!c.usingBundle||f===0)&&(c._gather(I.mid,f),p.state==="new"&&p.start(A,G,d?"controlling":"controlled"),y.state==="new"&&y.start(x));var B=YG(v,b);c._transceive(I,B.codecs.length>0,!1)}})}return c._localDescription={type:l.type,sdp:l.sdp},l.type==="offer"?c._updateSignalingState("have-local-offer"):c._updateSignalingState("stable"),Promise.resolve()},s.prototype.setRemoteDescription=function(l){var c=this;if(["offer","answer"].indexOf(l.type)===-1)return Promise.reject($r("TypeError",'Unsupported type "'+l.type+'"'));if(!tP("setRemoteDescription",l.type,c.signalingState)||c._isClosed)return Promise.reject($r("InvalidStateError","Can not set remote "+l.type+" in state "+c.signalingState));var g={};c.remoteStreams.forEach(function(p){g[p.id]=p});var u=[],d=xt.splitSections(l.sdp),h=d.shift(),f=xt.matchPrefix(h,"a=ice-lite").length>0,I=xt.matchPrefix(h,"a=group:BUNDLE ").length>0;c.usingBundle=I;var A=xt.matchPrefix(h,"a=ice-options:")[0];return A?c.canTrickleIceCandidates=A.substr(14).split(" ").indexOf("trickle")>=0:c.canTrickleIceCandidates=!1,d.forEach(function(p,y){var v=xt.splitLines(p),b=xt.getKind(p),w=xt.isRejected(p)&&xt.matchPrefix(p,"a=bundle-only").length===0,G=v[0].substr(2).split(" ")[2],x=xt.getDirection(p,h),B=xt.parseMsid(p),R=xt.getMid(p)||xt.generateIdentifier();if(w||b==="application"&&(G==="DTLS/SCTP"||G==="UDP/DTLS/SCTP")){c.transceivers[y]={mid:R,kind:b,protocol:G,rejected:!0};return}!w&&c.transceivers[y]&&c.transceivers[y].rejected&&(c.transceivers[y]=c._createTransceiver(b,!0));var Z,W,F,T,V,z,U,J,H,Y=xt.parseRtpParameters(p),K,Q;w||(K=xt.getIceParameters(p,h),Q=xt.getDtlsParameters(p,h),Q.role="client"),U=xt.parseRtpEncodingParameters(p);var P=xt.parseRtcpParameters(p),ne=xt.matchPrefix(p,"a=end-of-candidates",h).length>0,oe=xt.matchPrefix(p,"a=candidate:").map(function(k){return xt.parseCandidate(k)}).filter(function(k){return k.component===1});if((l.type==="offer"||l.type==="answer")&&!w&&I&&y>0&&c.transceivers[y]&&(c._disposeIceAndDtlsTransports(y),c.transceivers[y].iceGatherer=c.transceivers[0].iceGatherer,c.transceivers[y].iceTransport=c.transceivers[0].iceTransport,c.transceivers[y].dtlsTransport=c.transceivers[0].dtlsTransport,c.transceivers[y].rtpSender&&c.transceivers[y].rtpSender.setTransport(c.transceivers[0].dtlsTransport),c.transceivers[y].rtpReceiver&&c.transceivers[y].rtpReceiver.setTransport(c.transceivers[0].dtlsTransport)),l.type==="offer"&&!w){Z=c.transceivers[y]||c._createTransceiver(b),Z.mid=R,Z.iceGatherer||(Z.iceGatherer=c._createIceGatherer(y,I)),oe.length&&Z.iceTransport.state==="new"&&(ne&&(!I||y===0)?Z.iceTransport.setRemoteCandidates(oe):oe.forEach(function(k){DM(Z.iceTransport,k)})),J=n.RTCRtpReceiver.getCapabilities(b),e<15019&&(J.codecs=J.codecs.filter(function(k){return k.name!=="rtx"})),z=Z.sendEncodingParameters||[{ssrc:(2*y+2)*1001}];var $=!1;if(x==="sendrecv"||x==="sendonly"){if($=!Z.rtpReceiver,V=Z.rtpReceiver||new n.RTCRtpReceiver(Z.dtlsTransport,b),$){var de;H=V.track,B&&B.stream==="-"||(B?(g[B.stream]||(g[B.stream]=new n.MediaStream,Object.defineProperty(g[B.stream],"id",{get:function(){return B.stream}})),Object.defineProperty(H,"id",{get:function(){return B.track}}),de=g[B.stream]):(g.default||(g.default=new n.MediaStream),de=g.default)),de&&(t(H,de),Z.associatedRemoteMediaStreams.push(de)),u.push([H,V,de])}}else Z.rtpReceiver&&Z.rtpReceiver.track&&(Z.associatedRemoteMediaStreams.forEach(function(k){var O=k.getTracks().find(function(q){return q.id===Z.rtpReceiver.track.id});O&&i(O,k)}),Z.associatedRemoteMediaStreams=[]);Z.localCapabilities=J,Z.remoteCapabilities=Y,Z.rtpReceiver=V,Z.rtcpParameters=P,Z.sendEncodingParameters=z,Z.recvEncodingParameters=U,c._transceive(c.transceivers[y],!1,$)}else if(l.type==="answer"&&!w){Z=c.transceivers[y],W=Z.iceGatherer,F=Z.iceTransport,T=Z.dtlsTransport,V=Z.rtpReceiver,z=Z.sendEncodingParameters,J=Z.localCapabilities,c.transceivers[y].recvEncodingParameters=U,c.transceivers[y].remoteCapabilities=Y,c.transceivers[y].rtcpParameters=P,oe.length&&F.state==="new"&&((f||ne)&&(!I||y===0)?F.setRemoteCandidates(oe):oe.forEach(function(k){DM(Z.iceTransport,k)})),(!I||y===0)&&(F.state==="new"&&F.start(W,K,"controlling"),T.state==="new"&&T.start(Q));var ge=YG(Z.localCapabilities,Z.remoteCapabilities),se=ge.codecs.filter(function(k){return k.name.toLowerCase()==="rtx"}).length;!se&&Z.sendEncodingParameters[0].rtx&&delete Z.sendEncodingParameters[0].rtx,c._transceive(Z,x==="sendrecv"||x==="recvonly",x==="sendrecv"||x==="sendonly"),V&&(x==="sendrecv"||x==="sendonly")?(H=V.track,B?(g[B.stream]||(g[B.stream]=new n.MediaStream),t(H,g[B.stream]),u.push([H,V,g[B.stream]])):(g.default||(g.default=new n.MediaStream),t(H,g.default),u.push([H,V,g.default]))):delete Z.rtpReceiver}}),c._dtlsRole===void 0&&(c._dtlsRole=l.type==="offer"?"active":"passive"),c._remoteDescription={type:l.type,sdp:l.sdp},l.type==="offer"?c._updateSignalingState("have-remote-offer"):c._updateSignalingState("stable"),Object.keys(g).forEach(function(p){var y=g[p];if(y.getTracks().length){if(c.remoteStreams.indexOf(y)===-1){c.remoteStreams.push(y);var v=new Event("addstream");v.stream=y,n.setTimeout(function(){c._dispatchEvent("addstream",v)})}u.forEach(function(b){var w=b[0],G=b[1];y.id===b[2].id&&r(c,w,G,[y])})}}),u.forEach(function(p){p[2]||r(c,p[0],p[1],[])}),n.setTimeout(function(){c&&c.transceivers&&c.transceivers.forEach(function(p){p.iceTransport&&p.iceTransport.state==="new"&&p.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),p.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},s.prototype.close=function(){this.transceivers.forEach(function(l){l.iceTransport&&l.iceTransport.stop(),l.dtlsTransport&&l.dtlsTransport.stop(),l.rtpSender&&l.rtpSender.stop(),l.rtpReceiver&&l.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},s.prototype._updateSignalingState=function(l){this.signalingState=l;var c=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",c)},s.prototype._maybeFireNegotiationNeeded=function(){var l=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,n.setTimeout(function(){if(l.needNegotiation){l.needNegotiation=!1;var c=new Event("negotiationneeded");l._dispatchEvent("negotiationneeded",c)}},0))},s.prototype._updateIceConnectionState=function(){var l,c={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(u){u.iceTransport&&!u.rejected&&c[u.iceTransport.state]++}),l="new",c.failed>0?l="failed":c.checking>0?l="checking":c.disconnected>0?l="disconnected":c.new>0?l="new":c.connected>0?l="connected":c.completed>0&&(l="completed"),l!==this.iceConnectionState){this.iceConnectionState=l;var g=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",g)}},s.prototype._updateConnectionState=function(){var l,c={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(u){u.iceTransport&&u.dtlsTransport&&!u.rejected&&(c[u.iceTransport.state]++,c[u.dtlsTransport.state]++)}),c.connected+=c.completed,l="new",c.failed>0?l="failed":c.connecting>0?l="connecting":c.disconnected>0?l="disconnected":c.new>0?l="new":c.connected>0&&(l="connected"),l!==this.connectionState){this.connectionState=l;var g=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",g)}},s.prototype.createOffer=function(){var l=this;if(l._isClosed)return Promise.reject($r("InvalidStateError","Can not call createOffer after close"));var c=l.transceivers.filter(function(f){return f.kind==="audio"}).length,g=l.transceivers.filter(function(f){return f.kind==="video"}).length,u=arguments[0];if(u){if(u.mandatory||u.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");u.offerToReceiveAudio!==void 0&&(u.offerToReceiveAudio===!0?c=1:u.offerToReceiveAudio===!1?c=0:c=u.offerToReceiveAudio),u.offerToReceiveVideo!==void 0&&(u.offerToReceiveVideo===!0?g=1:u.offerToReceiveVideo===!1?g=0:g=u.offerToReceiveVideo)}for(l.transceivers.forEach(function(f){f.kind==="audio"?(c--,c<0&&(f.wantReceive=!1)):f.kind==="video"&&(g--,g<0&&(f.wantReceive=!1))});c>0||g>0;)c>0&&(l._createTransceiver("audio"),c--),g>0&&(l._createTransceiver("video"),g--);var d=xt.writeSessionBoilerplate(l._sdpSessionId,l._sdpSessionVersion++);l.transceivers.forEach(function(f,I){var A=f.track,p=f.kind,y=f.mid||xt.generateIdentifier();f.mid=y,f.iceGatherer||(f.iceGatherer=l._createIceGatherer(I,l.usingBundle));var v=n.RTCRtpSender.getCapabilities(p);e<15019&&(v.codecs=v.codecs.filter(function(w){return w.name!=="rtx"})),v.codecs.forEach(function(w){w.name==="H264"&&w.parameters["level-asymmetry-allowed"]===void 0&&(w.parameters["level-asymmetry-allowed"]="1"),f.remoteCapabilities&&f.remoteCapabilities.codecs&&f.remoteCapabilities.codecs.forEach(function(G){w.name.toLowerCase()===G.name.toLowerCase()&&w.clockRate===G.clockRate&&(w.preferredPayloadType=G.payloadType)})}),v.headerExtensions.forEach(function(w){var G=f.remoteCapabilities&&f.remoteCapabilities.headerExtensions||[];G.forEach(function(x){w.uri===x.uri&&(w.id=x.id)})});var b=f.sendEncodingParameters||[{ssrc:(2*I+1)*1001}];A&&e>=15019&&p==="video"&&!b[0].rtx&&(b[0].rtx={ssrc:b[0].ssrc+1}),f.wantReceive&&(f.rtpReceiver=new n.RTCRtpReceiver(f.dtlsTransport,p)),f.localCapabilities=v,f.sendEncodingParameters=b}),l._config.bundlePolicy!=="max-compat"&&(d+="a=group:BUNDLE "+l.transceivers.map(function(f){return f.mid}).join(" ")+`\r
`),d+=`a=ice-options:trickle\r
`,l.transceivers.forEach(function(f,I){d+=eP(f,f.localCapabilities,"offer",f.stream,l._dtlsRole),d+=`a=rtcp-rsize\r
`,f.iceGatherer&&l.iceGatheringState!=="new"&&(I===0||!l.usingBundle)&&(f.iceGatherer.getLocalCandidates().forEach(function(A){A.component=1,d+="a="+xt.writeCandidate(A)+`\r
`}),f.iceGatherer.state==="completed"&&(d+=`a=end-of-candidates\r
`))});var h=new n.RTCSessionDescription({type:"offer",sdp:d});return Promise.resolve(h)},s.prototype.createAnswer=function(){var l=this;if(l._isClosed)return Promise.reject($r("InvalidStateError","Can not call createAnswer after close"));if(!(l.signalingState==="have-remote-offer"||l.signalingState==="have-local-pranswer"))return Promise.reject($r("InvalidStateError","Can not call createAnswer in signalingState "+l.signalingState));var c=xt.writeSessionBoilerplate(l._sdpSessionId,l._sdpSessionVersion++);l.usingBundle&&(c+="a=group:BUNDLE "+l.transceivers.map(function(d){return d.mid}).join(" ")+`\r
`),c+=`a=ice-options:trickle\r
`;var g=xt.getMediaSections(l._remoteDescription.sdp).length;l.transceivers.forEach(function(d,h){if(!(h+1>g)){if(d.rejected){d.kind==="application"?d.protocol==="DTLS/SCTP"?c+=`m=application 0 DTLS/SCTP 5000\r
`:c+="m=application 0 "+d.protocol+` webrtc-datachannel\r
`:d.kind==="audio"?c+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:d.kind==="video"&&(c+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),c+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+d.mid+`\r
`;return}if(d.stream){var f;d.kind==="audio"?f=d.stream.getAudioTracks()[0]:d.kind==="video"&&(f=d.stream.getVideoTracks()[0]),f&&e>=15019&&d.kind==="video"&&!d.sendEncodingParameters[0].rtx&&(d.sendEncodingParameters[0].rtx={ssrc:d.sendEncodingParameters[0].ssrc+1})}var I=YG(d.localCapabilities,d.remoteCapabilities),A=I.codecs.filter(function(p){return p.name.toLowerCase()==="rtx"}).length;!A&&d.sendEncodingParameters[0].rtx&&delete d.sendEncodingParameters[0].rtx,c+=eP(d,I,"answer",d.stream,l._dtlsRole),d.rtcpParameters&&d.rtcpParameters.reducedSize&&(c+=`a=rtcp-rsize\r
`)}});var u=new n.RTCSessionDescription({type:"answer",sdp:c});return Promise.resolve(u)},s.prototype.addIceCandidate=function(l){var c=this,g;return l&&!(l.sdpMLineIndex!==void 0||l.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(u,d){if(c._remoteDescription)if(!l||l.candidate==="")for(var h=0;h<c.transceivers.length&&!(!c.transceivers[h].rejected&&(c.transceivers[h].iceTransport.addRemoteCandidate({}),g=xt.getMediaSections(c._remoteDescription.sdp),g[h]+=`a=end-of-candidates\r
`,c._remoteDescription.sdp=xt.getDescription(c._remoteDescription.sdp)+g.join(""),c.usingBundle));h++);else{var f=l.sdpMLineIndex;if(l.sdpMid){for(var I=0;I<c.transceivers.length;I++)if(c.transceivers[I].mid===l.sdpMid){f=I;break}}var A=c.transceivers[f];if(A){if(A.rejected)return u();var p=Object.keys(l.candidate).length>0?xt.parseCandidate(l.candidate):{};if(p.protocol==="tcp"&&(p.port===0||p.port===9)||p.component&&p.component!==1)return u();if((f===0||f>0&&A.iceTransport!==c.transceivers[0].iceTransport)&&!DM(A.iceTransport,p))return d($r("OperationError","Can not add ICE candidate"));var y=l.candidate.trim();y.indexOf("a=")===0&&(y=y.substr(2)),g=xt.getMediaSections(c._remoteDescription.sdp),g[f]+="a="+(p.type?y:"end-of-candidates")+`\r
`,c._remoteDescription.sdp=xt.getDescription(c._remoteDescription.sdp)+g.join("")}else return d($r("OperationError","Can not add ICE candidate"))}else return d($r("InvalidStateError","Can not add ICE candidate without a remote description"));u()})},s.prototype.getStats=function(l){if(l&&l instanceof n.MediaStreamTrack){var c=null;if(this.transceivers.forEach(function(u){u.rtpSender&&u.rtpSender.track===l?c=u.rtpSender:u.rtpReceiver&&u.rtpReceiver.track===l&&(c=u.rtpReceiver)}),!c)throw $r("InvalidAccessError","Invalid selector.");return c.getStats()}var g=[];return this.transceivers.forEach(function(u){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(d){u[d]&&g.push(u[d].getStats())})}),Promise.all(g).then(function(u){var d=new Map;return u.forEach(function(h){h.forEach(function(f){d.set(f.id,f)})}),d})};var o=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];o.forEach(function(l){var c=n[l];if(c&&c.prototype&&c.prototype.getStats){var g=c.prototype.getStats;c.prototype.getStats=function(){return g.apply(this).then(function(u){var d=new Map;return Object.keys(u).forEach(function(h){u[h].type=fVe(u[h]),d.set(h,u[h])}),d})}}});var a=["createOffer","createAnswer"];return a.forEach(function(l){var c=s.prototype[l];s.prototype[l]=function(){var g=arguments;return typeof g[0]=="function"||typeof g[1]=="function"?c.apply(this,[arguments[2]]).then(function(u){typeof g[0]=="function"&&g[0].apply(null,[u])},function(u){typeof g[1]=="function"&&g[1].apply(null,[u])}):c.apply(this,arguments)}}),a=["setLocalDescription","setRemoteDescription","addIceCandidate"],a.forEach(function(l){var c=s.prototype[l];s.prototype[l]=function(){var g=arguments;return typeof g[1]=="function"||typeof g[2]=="function"?c.apply(this,arguments).then(function(){typeof g[1]=="function"&&g[1].apply(null)},function(u){typeof g[2]=="function"&&g[2].apply(null,[u])}):c.apply(this,arguments)}}),["getStats"].forEach(function(l){var c=s.prototype[l];s.prototype[l]=function(){var g=arguments;return typeof g[1]=="function"?c.apply(this,arguments).then(function(){typeof g[1]=="function"&&g[1].apply(null)}):c.apply(this,arguments)}}),s};const CVe=Ks(AVe);function see(n){const e=n&&n.navigator,t=function(r){return{name:{PermissionDeniedError:"NotAllowedError"}[r.name]||r.name,message:r.message,constraint:r.constraint,toString(){return this.name}}},i=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(r){return i(r).catch(s=>Promise.reject(t(s)))}}function oee(n){"getDisplayMedia"in n.navigator&&n.navigator.mediaDevices&&(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||(n.navigator.mediaDevices.getDisplayMedia=n.navigator.getDisplayMedia.bind(n.navigator)))}function AF(n,e){if(n.RTCIceGatherer&&(n.RTCIceCandidate||(n.RTCIceCandidate=function(r){return r}),n.RTCSessionDescription||(n.RTCSessionDescription=function(r){return r}),e.version<15025)){const i=Object.getOwnPropertyDescriptor(n.MediaStreamTrack.prototype,"enabled");Object.defineProperty(n.MediaStreamTrack.prototype,"enabled",{set(r){i.set.call(this,r);const s=new Event("enabled");s.enabled=r,this.dispatchEvent(s)}})}n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)&&Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new n.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),n.RTCDtmfSender&&!n.RTCDTMFSender&&(n.RTCDTMFSender=n.RTCDtmfSender);const t=CVe(n,e.version);n.RTCPeerConnection=function(r){return r&&r.iceServers&&(r.iceServers=hVe(r.iceServers,e.version),m5("ICE servers after filtering:",r.iceServers)),new t(r)},n.RTCPeerConnection.prototype=t.prototype}function aee(n){n.RTCRtpSender&&!("replaceTrack"in n.RTCRtpSender.prototype)&&(n.RTCRtpSender.prototype.replaceTrack=n.RTCRtpSender.prototype.setTrack)}const nP=Object.freeze(Object.defineProperty({__proto__:null,shimGetDisplayMedia:oee,shimGetUserMedia:see,shimPeerConnection:AF,shimReplaceTrack:aee},Symbol.toStringTag,{value:"Module"}));function lee(n,e){const t=n&&n.navigator,i=n&&n.MediaStreamTrack;if(t.getUserMedia=function(r,s,o){Lx("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(r).then(s,o)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const r=function(o,a,l){a in o&&!(l in o)&&(o[l]=o[a],delete o[a])},s=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o.audio,"autoGainControl","mozAutoGainControl"),r(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return r(a,"mozAutoGainControl","autoGainControl"),r(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a,"autoGainControl","mozAutoGainControl"),r(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function pVe(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(i)})}function cee(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function CF(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=n.RTCPeerConnection.prototype[r],o={[r](){return arguments[0]=new(r==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};n.RTCPeerConnection.prototype[r]=o[r]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return i.apply(this,[s||null]).then(l=>{if(e.version<53&&!o)try{l.forEach(c=>{c.type=t[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;l.forEach((g,u)=>{l.set(u,Object.assign({},g,{type:t[g.type]||g.type}))})}return l}).then(o,a)}}function gee(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const r=t.apply(this,arguments);return r._pc=this,r}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function uee(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),hp(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function dee(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){Lx("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&t.getTracks().includes(i.track)&&this.removeTrack(i)})})}function hee(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function fee(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const i=arguments[1],r=i&&"sendEncodings"in i;r&&i.sendEncodings.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(r){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i.sendEncodings,o.sendEncodings=i.sendEncodings,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function Iee(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function Aee(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Cee(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const iP=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:fee,shimCreateAnswer:Cee,shimCreateOffer:Aee,shimGetDisplayMedia:pVe,shimGetParameters:Iee,shimGetUserMedia:lee,shimOnTrack:cee,shimPeerConnection:CF,shimRTCDataChannel:hee,shimReceiverGetStats:uee,shimRemoveStream:dee,shimSenderGetStats:gee},Symbol.toStringTag,{value:"Module"}));function pee(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},n.RTCPeerConnection.prototype.addTrack=function(i,...r){return r&&r.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(t);if(i===-1)return;this._localStreams.splice(i,1);const r=t.getTracks();this.getSenders().forEach(s=>{r.includes(s.track)&&this.removeTrack(s)})})}}function mee(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,this.dispatchEvent(s)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(s=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(s)>=0)return;i._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function yee(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,t=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(c,g){const u=arguments.length>=2?arguments[2]:arguments[0],d=t.apply(this,[u]);return g?(d.then(c,g),Promise.resolve()):d},e.createAnswer=function(c,g){const u=arguments.length>=2?arguments[2]:arguments[0],d=i.apply(this,[u]);return g?(d.then(c,g),Promise.resolve()):d};let a=function(l,c,g){const u=r.apply(this,[l]);return g?(u.then(c,g),Promise.resolve()):u};e.setLocalDescription=a,a=function(l,c,g){const u=s.apply(this,[l]);return g?(u.then(c,g),Promise.resolve()):u},e.setRemoteDescription=a,a=function(l,c,g){const u=o.apply(this,[l]);return g?(u.then(c,g),Promise.resolve()):u},e.addIceCandidate=a}function vee(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,i=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=r=>i(bee(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=function(i,r,s){e.mediaDevices.getUserMedia(i).then(r,s)}.bind(e))}function bee(n){return n&&n.video!==void 0?Object.assign({},n,{video:U$(n.video)}):n}function Bee(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const s=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(Lx("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(i.iceServers[o])}i.iceServers=s}return new e(i,r)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Gee(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function wee(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio"),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video")}return e.apply(this,arguments)}}function xee(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}const rP=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:xee,shimCallbacksAPI:yee,shimConstraints:bee,shimCreateOfferLegacy:wee,shimGetUserMedia:vee,shimLocalStreamsAPI:pee,shimRTCIceServerUrls:Bee,shimRemoteStreamsAPI:mee,shimTrackEventTransceiver:Gee},Symbol.toStringTag,{value:"Module"}));function N1(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const r=new e(i),s=T1.parseCandidate(i.candidate),o=Object.assign(r,s);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new e(i)},n.RTCIceCandidate.prototype=e.prototype,hp(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function u0(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(a){if(!a||!a.sdp)return!1;const l=T1.splitSections(a.sdp);return l.shift(),l.some(c=>{const g=T1.parseMLine(c);return g&&g.kind==="application"&&g.protocol.indexOf("SCTP")!==-1})},i=function(a){const l=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const c=parseInt(l[1],10);return c!==c?-1:c},r=function(a){let l=65536;return e.browser==="firefox"&&(e.version<57?a===-1?l=16384:l=2147483637:e.version<60?l=e.version===57?65535:65536:l=2147483637),l},s=function(a,l){let c=65536;e.browser==="firefox"&&e.version===57&&(c=65535);const g=T1.matchPrefix(a.sdp,"a=max-message-size:");return g.length>0?c=parseInt(g[0].substr(19),10):e.browser==="firefox"&&l!==-1&&(c=2147483637),c},o=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const l=i(arguments[0]),c=r(l),g=s(arguments[0],l);let u;c===0&&g===0?u=Number.POSITIVE_INFINITY:c===0||g===0?u=Math.max(c,g):u=Math.min(c,g);const d={};Object.defineProperty(d,"maxMessageSize",{get(){return u}}),this._sctp=d}return o.apply(this,arguments)}}function d0(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const a=arguments[0],l=a.length||a.size||a.byteLength;if(i.readyState==="open"&&r.sctp&&l>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const r=t.apply(this,arguments);return e(r,this),r},hp(n,"datachannel",i=>(e(i.channel,i.target),i))}function pF(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const i=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",r);s.dispatchEvent(o)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function mF(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=r.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&r instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:r.type,sdp:s}):r.sdp=s}return t.apply(this,arguments)}}function k1(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const mVe=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:mF,shimAddIceCandidateNullOrEmpty:k1,shimConnectionState:pF,shimMaxMessageSize:u0,shimRTCIceCandidate:N1,shimSendThrowTypeError:d0},Symbol.toStringTag,{value:"Module"}));function yVe({window:n}={},e={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const t=m5,i=uVe(n),r={browserDetails:i,commonShim:mVe,extractVersion:g0,disableLog:cVe,disableWarnings:gVe};switch(i.browser){case"chrome":if(!$D||!IF||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),r;if(i.version===null)return t("Chrome shim can not determine version, not shimming."),r;t("adapter.js shimming chrome."),r.browserShim=$D,k1(n,i),Q$(n,i),O$(n),IF(n,i),J$(n),tee(n,i),j$(n),q$(n),$$(n),nee(n,i),N1(n),pF(n),u0(n,i),d0(n),mF(n,i);break;case"firefox":if(!iP||!CF||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),r;t("adapter.js shimming firefox."),r.browserShim=iP,k1(n,i),lee(n,i),CF(n,i),cee(n),dee(n),gee(n),uee(n),hee(n),fee(n),Iee(n),Aee(n),Cee(n),N1(n),pF(n),u0(n,i),d0(n);break;case"edge":if(!nP||!AF||!e.shimEdge)return t("MS edge shim is not included in this adapter release."),r;t("adapter.js shimming edge."),r.browserShim=nP,see(n),oee(n),AF(n,i),aee(n),u0(n,i),d0(n);break;case"safari":if(!rP||!e.shimSafari)return t("Safari shim is not included in this adapter release."),r;t("adapter.js shimming safari."),r.browserShim=rP,k1(n,i),Bee(n),wee(n),yee(n),pee(n),mee(n),Gee(n),vee(n),xee(n),N1(n),u0(n,i),d0(n),mF(n,i);break;default:t("Unsupported browser!");break}return r}const sP=yVe({window:typeof window>"u"?void 0:window});function Nc(n,e,t,i){Object.defineProperty(n,e,{get:t,set:i,enumerable:!0,configurable:!0})}var PM=sP.default||sP,Pm=new(function(){function n(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return n.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},n.prototype.isBrowserSupported=function(){var e=this.getBrowser(),t=this.getVersion(),i=this.supportedBrowsers.includes(e);return i?e==="chrome"?t>=this.minChromeVersion:e==="firefox"?t>=this.minFirefoxVersion:e==="safari"?!this.isIOS&&t>=this.minSafariVersion:!1:!1},n.prototype.getBrowser=function(){return PM.browserDetails.browser},n.prototype.getVersion=function(){return PM.browserDetails.version||0},n.prototype.isUnifiedPlanSupported=function(){var e=this.getBrowser(),t=PM.browserDetails.version||0;if(e==="chrome"&&t<this.minChromeVersion)return!1;if(e==="firefox"&&t>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var i,r=!1;try{i=new RTCPeerConnection,i.addTransceiver("audio"),r=!0}catch{}finally{i&&i.close()}return r},n.prototype.toString=function(){return`Supports:
    browser:`.concat(this.getBrowser(),`
    version:`).concat(this.getVersion(),`
    isIOS:`).concat(this.isIOS,`
    isWebRTCSupported:`).concat(this.isWebRTCSupported(),`
    isBrowserSupported:`).concat(this.isBrowserSupported(),`
    isUnifiedPlanSupported:`).concat(this.isUnifiedPlanSupported())},n}()),oP={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},vVe=function(){function n(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=oP,this.browser=Pm.getBrowser(),this.browserVersion=Pm.getVersion(),this.supports=function(){var e={browser:Pm.isBrowserSupported(),webRTC:Pm.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!e.webRTC)return e;var t;try{t=new RTCPeerConnection(oP),e.audioVideo=!0;var i=void 0;try{i=t.createDataChannel("_PEERJSTEST",{ordered:!0}),e.data=!0,e.reliable=!!i.ordered;try{i.binaryType="blob",e.binaryBlob=!Pm.isIOS}catch{}}catch{}finally{i&&i.close()}}catch{}finally{t&&t.close()}return e}(),this.pack=OD.pack,this.unpack=OD.unpack,this._dataCount=1}return n.prototype.noop=function(){},n.prototype.validateId=function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)},n.prototype.chunk=function(e){for(var t=[],i=e.size,r=Math.ceil(i/Bn.chunkedMTU),s=0,o=0;o<i;){var a=Math.min(i,o+Bn.chunkedMTU),l=e.slice(o,a),c={__peerData:this._dataCount,n:s,data:l,total:r};t.push(c),o=a,s++}return this._dataCount++,t},n.prototype.blobToArrayBuffer=function(e,t){var i=new FileReader;return i.onload=function(r){r.target&&t(r.target.result)},i.readAsArrayBuffer(e),i},n.prototype.binaryStringToArrayBuffer=function(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=e.charCodeAt(i)&255;return t.buffer},n.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},n.prototype.isSecure=function(){return location.protocol==="https:"},n}(),Bn=new vVe,See={};Nc(See,"Peer",()=>bF,n=>bF=n);var Kv={},bVe=Object.prototype.hasOwnProperty,Ys="~";function jy(){}Object.create&&(jy.prototype=Object.create(null),new jy().__proto__||(Ys=!1));function BVe(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function Ree(n,e,t,i,r){if(typeof t!="function")throw new TypeError("The listener must be a function");var s=new BVe(t,i||n,r),o=Ys?Ys+e:e;return n._events[o]?n._events[o].fn?n._events[o]=[n._events[o],s]:n._events[o].push(s):(n._events[o]=s,n._eventsCount++),n}function L1(n,e){--n._eventsCount===0?n._events=new jy:delete n._events[e]}function As(){this._events=new jy,this._eventsCount=0}As.prototype.eventNames=function(){var e=[],t,i;if(this._eventsCount===0)return e;for(i in t=this._events)bVe.call(t,i)&&e.push(Ys?i.slice(1):i);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};As.prototype.listeners=function(e){var t=Ys?Ys+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,s=i.length,o=new Array(s);r<s;r++)o[r]=i[r].fn;return o};As.prototype.listenerCount=function(e){var t=Ys?Ys+e:e,i=this._events[t];return i?i.fn?1:i.length:0};As.prototype.emit=function(e,t,i,r,s,o){var a=Ys?Ys+e:e;if(!this._events[a])return!1;var l=this._events[a],c=arguments.length,g,u;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),c){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,i),!0;case 4:return l.fn.call(l.context,t,i,r),!0;case 5:return l.fn.call(l.context,t,i,r,s),!0;case 6:return l.fn.call(l.context,t,i,r,s,o),!0}for(u=1,g=new Array(c-1);u<c;u++)g[u-1]=arguments[u];l.fn.apply(l.context,g)}else{var d=l.length,h;for(u=0;u<d;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),c){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,i);break;case 4:l[u].fn.call(l[u].context,t,i,r);break;default:if(!g)for(h=1,g=new Array(c-1);h<c;h++)g[h-1]=arguments[h];l[u].fn.apply(l[u].context,g)}}return!0};As.prototype.on=function(e,t,i){return Ree(this,e,t,i,!1)};As.prototype.once=function(e,t,i){return Ree(this,e,t,i,!0)};As.prototype.removeListener=function(e,t,i,r){var s=Ys?Ys+e:e;if(!this._events[s])return this;if(!t)return L1(this,s),this;var o=this._events[s];if(o.fn)o.fn===t&&(!r||o.once)&&(!i||o.context===i)&&L1(this,s);else{for(var a=0,l=[],c=o.length;a<c;a++)(o[a].fn!==t||r&&!o[a].once||i&&o[a].context!==i)&&l.push(o[a]);l.length?this._events[s]=l.length===1?l[0]:l:L1(this,s)}return this};As.prototype.removeAllListeners=function(e){var t;return e?(t=Ys?Ys+e:e,this._events[t]&&L1(this,t)):(this._events=new jy,this._eventsCount=0),this};As.prototype.off=As.prototype.removeListener;As.prototype.addListener=As.prototype.on;As.prefixed=Ys;As.EventEmitter=As;Kv=As;var gt={};Nc(gt,"LogLevel",()=>io,n=>io=n);Nc(gt,"default",()=>aP,n=>aP=n);var Ih=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),r,s=[],o;try{for(;(e===void 0||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(a){o={error:a}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return s},Ah=function(n,e,t){if(t||arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return n.concat(s||Array.prototype.slice.call(e))},GVe="PeerJS: ",io;(function(n){n[n.Disabled=0]="Disabled",n[n.Errors=1]="Errors",n[n.Warnings=2]="Warnings",n[n.All=3]="All"})(io||(io={}));var wVe=function(){function n(){this._logLevel=io.Disabled}return Object.defineProperty(n.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!1,configurable:!0}),n.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=io.All&&this._print.apply(this,Ah([io.All],Ih(e),!1))},n.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=io.Warnings&&this._print.apply(this,Ah([io.Warnings],Ih(e),!1))},n.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=io.Errors&&this._print.apply(this,Ah([io.Errors],Ih(e),!1))},n.prototype.setLogFunction=function(e){this._print=e},n.prototype._print=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var r=Ah([GVe],Ih(t),!1);for(var s in r)r[s]instanceof Error&&(r[s]="("+r[s].name+") "+r[s].message);e>=io.All?console.log.apply(console,Ah([],Ih(r),!1)):e>=io.Warnings?console.warn.apply(console,Ah(["WARNING"],Ih(r),!1)):e>=io.Errors&&console.error.apply(console,Ah(["ERROR"],Ih(r),!1))},n}(),aP=new wVe,Zee={};Nc(Zee,"Socket",()=>lP,n=>lP=n);var yl;(function(n){n.Data="data",n.Media="media"})(yl||(yl={}));var Zi;(function(n){n.BrowserIncompatible="browser-incompatible",n.Disconnected="disconnected",n.InvalidID="invalid-id",n.InvalidKey="invalid-key",n.Network="network",n.PeerUnavailable="peer-unavailable",n.SslUnavailable="ssl-unavailable",n.ServerError="server-error",n.SocketError="socket-error",n.SocketClosed="socket-closed",n.UnavailableID="unavailable-id",n.WebRTC="webrtc"})(Zi||(Zi={}));var Cg;(function(n){n.Binary="binary",n.BinaryUTF8="binary-utf8",n.JSON="json"})(Cg||(Cg={}));var Eg;(function(n){n.Message="message",n.Disconnected="disconnected",n.Error="error",n.Close="close"})(Eg||(Eg={}));var Rr;(function(n){n.Heartbeat="HEARTBEAT",n.Candidate="CANDIDATE",n.Offer="OFFER",n.Answer="ANSWER",n.Open="OPEN",n.Error="ERROR",n.IdTaken="ID-TAKEN",n.InvalidKey="INVALID-KEY",n.Leave="LEAVE",n.Expire="EXPIRE"})(Rr||(Rr={}));var y5={};y5=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stückler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Sören Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var xVe=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[s]=r[s])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),SVe=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),r,s=[],o;try{for(;(e===void 0||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(a){o={error:a}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return s},RVe=function(n,e,t){if(t||arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return n.concat(s||Array.prototype.slice.call(e))},ZVe=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},lP=function(n){xVe(e,n);function e(t,i,r,s,o,a){a===void 0&&(a=5e3);var l=n.call(this)||this;l.pingInterval=a,l._disconnected=!0,l._messagesQueue=[];var c=t?"wss://":"ws://";return l._baseUrl=c+i+":"+r+s+"peerjs?key="+o,l}return e.prototype.start=function(t,i){var r=this;this._id=t;var s="".concat(this._baseUrl,"&id=").concat(t,"&token=").concat(i);this._socket||!this._disconnected||(this._socket=new WebSocket(s+"&version="+y5.version),this._disconnected=!1,this._socket.onmessage=function(o){var a;try{a=JSON.parse(o.data),gt.default.log("Server message received:",a)}catch{gt.default.log("Invalid server message",o.data);return}r.emit(Eg.Message,a)},this._socket.onclose=function(o){r._disconnected||(gt.default.log("Socket closed.",o),r._cleanup(),r._disconnected=!0,r.emit(Eg.Disconnected))},this._socket.onopen=function(){r._disconnected||(r._sendQueuedMessages(),gt.default.log("Socket open"),r._scheduleHeartbeat())})},e.prototype._scheduleHeartbeat=function(){var t=this;this._wsPingTimer=setTimeout(function(){t._sendHeartbeat()},this.pingInterval)},e.prototype._sendHeartbeat=function(){if(!this._wsOpen()){gt.default.log("Cannot send heartbeat, because socket closed");return}var t=JSON.stringify({type:Rr.Heartbeat});this._socket.send(t),this._scheduleHeartbeat()},e.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},e.prototype._sendQueuedMessages=function(){var t,i,r=RVe([],SVe(this._messagesQueue),!1);this._messagesQueue=[];try{for(var s=ZVe(r),o=s.next();!o.done;o=s.next()){var a=o.value;this.send(a)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}},e.prototype.send=function(t){if(!this._disconnected){if(!this._id){this._messagesQueue.push(t);return}if(!t.type){this.emit(Eg.Error,"Invalid message");return}if(this._wsOpen()){var i=JSON.stringify(t);this._socket.send(i)}}},e.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},e.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},e}(Kv.EventEmitter),yF={};Nc(yF,"MediaConnection",()=>uP,n=>uP=n);var v5={};Nc(v5,"Negotiator",()=>cP,n=>cP=n);var tw=function(){return tw=Object.assign||function(n){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n},tw.apply(this,arguments)},KG=function(n,e,t,i){function r(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(g){try{c(i.next(g))}catch(u){o(u)}}function l(g){try{c(i.throw(g))}catch(u){o(u)}}function c(g){g.done?s(g.value):r(g.value).then(a,l)}c((i=i.apply(n,e||[])).next())})},DG=function(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,r,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(g){return l([c,g])}}function l(c){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,r&&(s=c[0]&2?r.return:c[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,c[1])).done)return s;switch(r=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,r=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){t.label=c[1];break}if(c[0]===6&&t.label<s[1]){t.label=s[1],s=c;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(c);break}s[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(g){c=[6,g],r=0}finally{i=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},cP=function(){function n(e){this.connection=e}return n.prototype.startConnection=function(e){var t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===yl.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){if(this.connection.type===yl.Data){var i=this.connection,r={ordered:!!e.reliable},s=t.createDataChannel(i.label,r);i.initialize(s)}this._makeOffer()}else this.handleSDP("OFFER",e.sdp)},n.prototype._startPeerConnection=function(){gt.default.log("Creating RTCPeerConnection.");var e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e},n.prototype._setupListeners=function(e){var t=this,i=this.connection.peer,r=this.connection.connectionId,s=this.connection.type,o=this.connection.provider;gt.default.log("Listening for ICE candidates."),e.onicecandidate=function(a){!a.candidate||!a.candidate.candidate||(gt.default.log("Received ICE candidates for ".concat(i,":"),a.candidate),o.socket.send({type:Rr.Candidate,payload:{candidate:a.candidate,type:s,connectionId:r},dst:i}))},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"failed":gt.default.log("iceConnectionState is failed, closing connections to "+i),t.connection.emit("error",new Error("Negotiation of connection to "+i+" failed.")),t.connection.close();break;case"closed":gt.default.log("iceConnectionState is closed, closing connections to "+i),t.connection.emit("error",new Error("Connection to "+i+" closed.")),t.connection.close();break;case"disconnected":gt.default.log("iceConnectionState changed to disconnected on the connection with "+i);break;case"completed":e.onicecandidate=Bn.noop;break}t.connection.emit("iceStateChanged",e.iceConnectionState)},gt.default.log("Listening for data channel"),e.ondatachannel=function(a){gt.default.log("Received data channel");var l=a.channel,c=o.getConnection(i,r);c.initialize(l)},gt.default.log("Listening for remote stream"),e.ontrack=function(a){gt.default.log("Received remote stream");var l=a.streams[0],c=o.getConnection(i,r);if(c.type===yl.Media){var g=c;t._addStreamToMediaConnection(l,g)}}},n.prototype.cleanup=function(){gt.default.log("Cleaning up PeerConnection to "+this.connection.peer);var e=this.connection.peerConnection;if(e){this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=function(){};var t=e.signalingState!=="closed",i=!1;if(this.connection.type===yl.Data){var r=this.connection,s=r.dataChannel;s&&(i=!!s.readyState&&s.readyState!=="closed")}(t||i)&&e.close()}},n.prototype._makeOffer=function(){return KG(this,void 0,Promise,function(){var e,t,i,r,s,o,a;return DG(this,function(l){switch(l.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,l.label=1;case 1:return l.trys.push([1,7,,8]),[4,e.createOffer(this.connection.options.constraints)];case 2:i=l.sent(),gt.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp),l.label=3;case 3:return l.trys.push([3,5,,6]),[4,e.setLocalDescription(i)];case 4:return l.sent(),gt.default.log("Set localDescription:",i,"for:".concat(this.connection.peer)),r={sdp:i,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:Bn.browser},this.connection.type===yl.Data&&(s=this.connection,r=tw(tw({},r),{label:s.label,reliable:s.reliable,serialization:s.serialization})),t.socket.send({type:Rr.Offer,payload:r,dst:this.connection.peer}),[3,6];case 5:return o=l.sent(),o!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(t.emitError(Zi.WebRTC,o),gt.default.log("Failed to setLocalDescription, ",o)),[3,6];case 6:return[3,8];case 7:return a=l.sent(),t.emitError(Zi.WebRTC,a),gt.default.log("Failed to createOffer, ",a),[3,8];case 8:return[2]}})})},n.prototype._makeAnswer=function(){return KG(this,void 0,Promise,function(){var e,t,i,r,s;return DG(this,function(o){switch(o.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,o.label=1;case 1:return o.trys.push([1,7,,8]),[4,e.createAnswer()];case 2:i=o.sent(),gt.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp),o.label=3;case 3:return o.trys.push([3,5,,6]),[4,e.setLocalDescription(i)];case 4:return o.sent(),gt.default.log("Set localDescription:",i,"for:".concat(this.connection.peer)),t.socket.send({type:Rr.Answer,payload:{sdp:i,type:this.connection.type,connectionId:this.connection.connectionId,browser:Bn.browser},dst:this.connection.peer}),[3,6];case 5:return r=o.sent(),t.emitError(Zi.WebRTC,r),gt.default.log("Failed to setLocalDescription, ",r),[3,6];case 6:return[3,8];case 7:return s=o.sent(),t.emitError(Zi.WebRTC,s),gt.default.log("Failed to create answer, ",s),[3,8];case 8:return[2]}})})},n.prototype.handleSDP=function(e,t){return KG(this,void 0,Promise,function(){var i,r,s,o;return DG(this,function(a){switch(a.label){case 0:t=new RTCSessionDescription(t),i=this.connection.peerConnection,r=this.connection.provider,gt.default.log("Setting remote description",t),s=this,a.label=1;case 1:return a.trys.push([1,5,,6]),[4,i.setRemoteDescription(t)];case 2:return a.sent(),gt.default.log("Set remoteDescription:".concat(e," for:").concat(this.connection.peer)),e!=="OFFER"?[3,4]:[4,s._makeAnswer()];case 3:a.sent(),a.label=4;case 4:return[3,6];case 5:return o=a.sent(),r.emitError(Zi.WebRTC,o),gt.default.log("Failed to setRemoteDescription, ",o),[3,6];case 6:return[2]}})})},n.prototype.handleCandidate=function(e){return KG(this,void 0,Promise,function(){var t,i,r,s,o,a;return DG(this,function(l){switch(l.label){case 0:gt.default.log("handleCandidate:",e),t=e.candidate,i=e.sdpMLineIndex,r=e.sdpMid,s=this.connection.peerConnection,o=this.connection.provider,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,s.addIceCandidate(new RTCIceCandidate({sdpMid:r,sdpMLineIndex:i,candidate:t}))];case 2:return l.sent(),gt.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return a=l.sent(),o.emitError(Zi.WebRTC,a),gt.default.log("Failed to handleCandidate, ",a),[3,4];case 4:return[2]}})})},n.prototype._addTracksToConnection=function(e,t){if(gt.default.log("add tracks from stream ".concat(e.id," to peer connection")),!t.addTrack)return gt.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(function(i){t.addTrack(i,e)})},n.prototype._addStreamToMediaConnection=function(e,t){gt.default.log("add stream ".concat(e.id," to media connection ").concat(t.connectionId)),t.addStream(e)},n}(),b5={};Nc(b5,"BaseConnection",()=>gP,n=>gP=n);var MVe=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[s]=r[s])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),gP=function(n){MVe(e,n);function e(t,i,r){var s=n.call(this)||this;return s.peer=t,s.provider=i,s.options=r,s._open=!1,s.metadata=r.metadata,s}return Object.defineProperty(e.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),e}(Kv.EventEmitter),EVe=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[s]=r[s])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),nw=function(){return nw=Object.assign||function(n){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n},nw.apply(this,arguments)},WVe=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},uP=function(n){EVe(e,n);function e(t,i,r){var s=n.call(this,t,i,r)||this;return s._localStream=s.options._stream,s.connectionId=s.options.connectionId||e.ID_PREFIX+Bn.randomToken(),s._negotiator=new v5.Negotiator(s),s._localStream&&s._negotiator.startConnection({_stream:s._localStream,originator:!0}),s}return Object.defineProperty(e.prototype,"type",{get:function(){return yl.Media},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),e.prototype.addStream=function(t){gt.default.log("Receiving stream",t),this._remoteStream=t,n.prototype.emit.call(this,"stream",t)},e.prototype.handleMessage=function(t){var i=t.type,r=t.payload;switch(t.type){case Rr.Answer:this._negotiator.handleSDP(i,r.sdp),this._open=!0;break;case Rr.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:gt.default.warn("Unrecognized message type:".concat(i," from peer:").concat(this.peer));break}},e.prototype.answer=function(t,i){var r,s;if(i===void 0&&(i={}),this._localStream){gt.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=t,i&&i.sdpTransform&&(this.options.sdpTransform=i.sdpTransform),this._negotiator.startConnection(nw(nw({},this.options._payload),{_stream:t}));var o=this.provider._getMessages(this.connectionId);try{for(var a=WVe(o),l=a.next();!l.done;l=a.next()){var c=l.value;this.handleMessage(c)}}catch(g){r={error:g}}finally{try{l&&!l.done&&(s=a.return)&&s.call(a)}finally{if(r)throw r.error}}this._open=!0},e.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,n.prototype.emit.call(this,"close"))},e.ID_PREFIX="mc_",e}(b5.BaseConnection),vF={};Nc(vF,"DataConnection",()=>hP,n=>hP=n);var Mee={};Nc(Mee,"EncodingQueue",()=>dP,n=>dP=n);var FVe=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[s]=r[s])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),dP=function(n){FVe(e,n);function e(){var t=n.call(this)||this;return t.fileReader=new FileReader,t._queue=[],t._processing=!1,t.fileReader.onload=function(i){t._processing=!1,i.target&&t.emit("done",i.target.result),t.doNextTask()},t.fileReader.onerror=function(i){gt.default.error("EncodingQueue error:",i),t._processing=!1,t.destroy(),t.emit("error",i)},t}return Object.defineProperty(e.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),e.prototype.enque=function(t){this.queue.push(t),!this.processing&&this.doNextTask()},e.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},e.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},e}(Kv.EventEmitter),_Ve=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[s]=r[s])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),VVe=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},hP=function(n){_Ve(e,n);function e(t,i,r){var s=n.call(this,t,i,r)||this;return s.stringify=JSON.stringify,s.parse=JSON.parse,s._buffer=[],s._bufferSize=0,s._buffering=!1,s._chunkedData={},s._encodingQueue=new Mee.EncodingQueue,s.connectionId=s.options.connectionId||e.ID_PREFIX+Bn.randomToken(),s.label=s.options.label||s.connectionId,s.serialization=s.options.serialization||Cg.Binary,s.reliable=!!s.options.reliable,s._encodingQueue.on("done",function(o){s._bufferedSend(o)}),s._encodingQueue.on("error",function(){gt.default.error("DC#".concat(s.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),s.close()}),s._negotiator=new v5.Negotiator(s),s._negotiator.startConnection(s.options._payload||{originator:!0}),s}return Object.defineProperty(e.prototype,"type",{get:function(){return yl.Data},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),e.prototype.initialize=function(t){this._dc=t,this._configureDataChannel()},e.prototype._configureDataChannel=function(){var t=this;(!Bn.supports.binaryBlob||Bn.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){gt.default.log("DC#".concat(t.connectionId," dc connection success")),t._open=!0,t.emit("open")},this.dataChannel.onmessage=function(i){gt.default.log("DC#".concat(t.connectionId," dc onmessage:"),i.data),t._handleDataMessage(i)},this.dataChannel.onclose=function(){gt.default.log("DC#".concat(t.connectionId," dc closed for:"),t.peer),t.close()}},e.prototype._handleDataMessage=function(t){var i=this,r=t.data,s=r.constructor,o=this.serialization===Cg.Binary||this.serialization===Cg.BinaryUTF8,a=r;if(o){if(s===Blob){Bn.blobToArrayBuffer(r,function(c){var g=Bn.unpack(c);i.emit("data",g)});return}else if(s===ArrayBuffer)a=Bn.unpack(r);else if(s===String){var l=Bn.binaryStringToArrayBuffer(r);a=Bn.unpack(l)}}else this.serialization===Cg.JSON&&(a=this.parse(r));if(a.__peerData){this._handleChunk(a);return}n.prototype.emit.call(this,"data",a)},e.prototype._handleChunk=function(t){var i=t.__peerData,r=this._chunkedData[i]||{data:[],count:0,total:t.total};if(r.data[t.n]=t.data,r.count++,this._chunkedData[i]=r,r.total===r.count){delete this._chunkedData[i];var s=new Blob(r.data);this._handleDataMessage({data:s})}},e.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,n.prototype.emit.call(this,"close"))},e.prototype.send=function(t,i){if(!this.open){n.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this.serialization===Cg.JSON)this._bufferedSend(this.stringify(t));else if(this.serialization===Cg.Binary||this.serialization===Cg.BinaryUTF8){var r=Bn.pack(t);if(!i&&r.size>Bn.chunkedMTU){this._sendChunks(r);return}Bn.supports.binaryBlob?this._bufferedSend(r):this._encodingQueue.enque(r)}else this._bufferedSend(t)},e.prototype._bufferedSend=function(t){(this._buffering||!this._trySend(t))&&(this._buffer.push(t),this._bufferSize=this._buffer.length)},e.prototype._trySend=function(t){var i=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>e.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){i._buffering=!1,i._tryBuffer()},50),!1;try{this.dataChannel.send(t)}catch(r){return gt.default.error("DC#:".concat(this.connectionId," Error when sending:"),r),this._buffering=!0,this.close(),!1}return!0},e.prototype._tryBuffer=function(){if(this.open&&this._buffer.length!==0){var t=this._buffer[0];this._trySend(t)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},e.prototype._sendChunks=function(t){var i,r,s=Bn.chunk(t);gt.default.log("DC#".concat(this.connectionId," Try to send ").concat(s.length," chunks..."));try{for(var o=VVe(s),a=o.next();!a.done;a=o.next()){var l=a.value;this.send(l,!0)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}},e.prototype.handleMessage=function(t){var i=t.payload;switch(t.type){case Rr.Answer:this._negotiator.handleSDP(t.type,i.sdp);break;case Rr.Candidate:this._negotiator.handleCandidate(i.candidate);break;default:gt.default.warn("Unrecognized message type:",t.type,"from peer:",this.peer);break}},e.ID_PREFIX="dc_",e.MAX_BUFFERED_AMOUNT=8388608,e}(b5.BaseConnection),Eee={};Nc(Eee,"API",()=>AP,n=>AP=n);var fP=function(n,e,t,i){function r(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(g){try{c(i.next(g))}catch(u){o(u)}}function l(g){try{c(i.throw(g))}catch(u){o(u)}}function c(g){g.done?s(g.value):r(g.value).then(a,l)}c((i=i.apply(n,e||[])).next())})},IP=function(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,r,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(g){return l([c,g])}}function l(c){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,r&&(s=c[0]&2?r.return:c[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,c[1])).done)return s;switch(r=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,r=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){t.label=c[1];break}if(c[0]===6&&t.label<s[1]){t.label=s[1],s=c;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(c);break}s[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(g){c=[6,g],r=0}finally{i=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},AP=function(){function n(e){this._options=e}return n.prototype._buildRequest=function(e){var t=this._options.secure?"https":"http",i=this._options,r=i.host,s=i.port,o=i.path,a=i.key,l=new URL("".concat(t,"://").concat(r,":").concat(s).concat(o).concat(a,"/").concat(e));return l.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),l.searchParams.set("version",y5.version),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})},n.prototype.retrieveId=function(){return fP(this,void 0,Promise,function(){var e,t,i;return IP(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(e=r.sent(),e.status!==200)throw new Error("Error. Status:".concat(e.status));return[2,e.text()];case 2:throw t=r.sent(),gt.default.error("Error retrieving ID",t),i="",this._options.path==="/"&&this._options.host!==Bn.CLOUD_HOST&&(i=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+i);case 3:return[2]}})})},n.prototype.listAllPeers=function(){return fP(this,void 0,Promise,function(){var e,t,i;return IP(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(e=r.sent(),e.status!==200)throw e.status===401?(t="",this._options.host===Bn.CLOUD_HOST?t="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":t="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+t)):new Error("Error. Status:".concat(e.status));return[2,e.json()];case 2:throw i=r.sent(),gt.default.error("Error retrieving list peers",i),new Error("Could not get list peers from the server."+i);case 3:return[2]}})})},n}(),TVe=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[s]=r[s])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Q0=function(){return Q0=Object.assign||function(n){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n},Q0.apply(this,arguments)},Um=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},NVe=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),r,s=[],o;try{for(;(e===void 0||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(a){o={error:a}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return s},bF=function(n){TVe(e,n);function e(t,i){var r=n.call(this)||this;r._id=null,r._lastServerId=null,r._destroyed=!1,r._disconnected=!1,r._open=!1,r._connections=new Map,r._lostMessages=new Map;var s;return t&&t.constructor==Object?i=t:t&&(s=t.toString()),i=Q0({debug:0,host:Bn.CLOUD_HOST,port:Bn.CLOUD_PORT,path:"/",key:e.DEFAULT_KEY,token:Bn.randomToken(),config:Bn.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},i),r._options=i,r._options.host==="/"&&(r._options.host=window.location.hostname),r._options.path&&(r._options.path[0]!=="/"&&(r._options.path="/"+r._options.path),r._options.path[r._options.path.length-1]!=="/"&&(r._options.path+="/")),r._options.secure===void 0&&r._options.host!==Bn.CLOUD_HOST?r._options.secure=Bn.isSecure():r._options.host==Bn.CLOUD_HOST&&(r._options.secure=!0),r._options.logFunction&&gt.default.setLogFunction(r._options.logFunction),gt.default.logLevel=r._options.debug||0,r._api=new Eee.API(i),r._socket=r._createServerConnection(),!Bn.supports.audioVideo&&!Bn.supports.data?(r._delayedAbort(Zi.BrowserIncompatible,"The current browser does not support WebRTC"),r):s&&!Bn.validateId(s)?(r._delayedAbort(Zi.InvalidID,'ID "'.concat(s,'" is invalid')),r):(s?r._initialize(s):r._api.retrieveId().then(function(o){return r._initialize(o)}).catch(function(o){return r._abort(Zi.ServerError,o)}),r)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connections",{get:function(){var t,i,r=Object.create(null);try{for(var s=Um(this._connections),o=s.next();!o.done;o=s.next()){var a=NVe(o.value,2),l=a[0],c=a[1];r[l]=c}}catch(g){t={error:g}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}return r},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),e.prototype._createServerConnection=function(){var t=this,i=new Zee.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return i.on(Eg.Message,function(r){t._handleMessage(r)}),i.on(Eg.Error,function(r){t._abort(Zi.SocketError,r)}),i.on(Eg.Disconnected,function(){t.disconnected||(t.emitError(Zi.Network,"Lost connection to server."),t.disconnect())}),i.on(Eg.Close,function(){t.disconnected||t._abort(Zi.SocketClosed,"Underlying socket is already closed.")}),i},e.prototype._initialize=function(t){this._id=t,this.socket.start(t,this._options.token)},e.prototype._handleMessage=function(t){var i,r,s=t.type,o=t.payload,a=t.src;switch(s){case Rr.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case Rr.Error:this._abort(Zi.ServerError,o.msg);break;case Rr.IdTaken:this._abort(Zi.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case Rr.InvalidKey:this._abort(Zi.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case Rr.Leave:gt.default.log("Received leave message from ".concat(a)),this._cleanupPeer(a),this._connections.delete(a);break;case Rr.Expire:this.emitError(Zi.PeerUnavailable,"Could not connect to peer ".concat(a));break;case Rr.Offer:var f=o.connectionId,I=this.getConnection(a,f);if(I&&(I.close(),gt.default.warn("Offer received for existing Connection ID:".concat(f))),o.type===yl.Media){var l=new yF.MediaConnection(a,this,{connectionId:f,_payload:o,metadata:o.metadata});I=l,this._addConnection(a,I),this.emit("call",l)}else if(o.type===yl.Data){var c=new vF.DataConnection(a,this,{connectionId:f,_payload:o,metadata:o.metadata,label:o.label,serialization:o.serialization,reliable:o.reliable});I=c,this._addConnection(a,I),this.emit("connection",c)}else{gt.default.warn("Received malformed connection type:".concat(o.type));return}var g=this._getMessages(f);try{for(var u=Um(g),d=u.next();!d.done;d=u.next()){var h=d.value;I.handleMessage(h)}}catch(A){i={error:A}}finally{try{d&&!d.done&&(r=u.return)&&r.call(u)}finally{if(i)throw i.error}}break;default:if(!o){gt.default.warn("You received a malformed message from ".concat(a," of type ").concat(s));return}var f=o.connectionId,I=this.getConnection(a,f);I&&I.peerConnection?I.handleMessage(t):f?this._storeMessage(f,t):gt.default.warn("You received an unrecognized message:",t);break}},e.prototype._storeMessage=function(t,i){this._lostMessages.has(t)||this._lostMessages.set(t,[]),this._lostMessages.get(t).push(i)},e.prototype._getMessages=function(t){var i=this._lostMessages.get(t);return i?(this._lostMessages.delete(t),i):[]},e.prototype.connect=function(t,i){if(i===void 0&&(i={}),this.disconnected){gt.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Zi.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}var r=new vF.DataConnection(t,this,i);return this._addConnection(t,r),r},e.prototype.call=function(t,i,r){if(r===void 0&&(r={}),this.disconnected){gt.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Zi.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!i){gt.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}var s=new yF.MediaConnection(t,this,Q0(Q0({},r),{_stream:i}));return this._addConnection(t,s),s},e.prototype._addConnection=function(t,i){gt.default.log("add connection ".concat(i.type,":").concat(i.connectionId," to peerId:").concat(t)),this._connections.has(t)||this._connections.set(t,[]),this._connections.get(t).push(i)},e.prototype._removeConnection=function(t){var i=this._connections.get(t.peer);if(i){var r=i.indexOf(t);r!==-1&&i.splice(r,1)}this._lostMessages.delete(t.connectionId)},e.prototype.getConnection=function(t,i){var r,s,o=this._connections.get(t);if(!o)return null;try{for(var a=Um(o),l=a.next();!l.done;l=a.next()){var c=l.value;if(c.connectionId===i)return c}}catch(g){r={error:g}}finally{try{l&&!l.done&&(s=a.return)&&s.call(a)}finally{if(r)throw r.error}}return null},e.prototype._delayedAbort=function(t,i){var r=this;setTimeout(function(){r._abort(t,i)},0)},e.prototype._abort=function(t,i){gt.default.error("Aborting!"),this.emitError(t,i),this._lastServerId?this.disconnect():this.destroy()},e.prototype.emitError=function(t,i){gt.default.error("Error:",i);var r;typeof i=="string"?r=new Error(i):r=i,r.type=t,this.emit("error",r)},e.prototype.destroy=function(){this.destroyed||(gt.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},e.prototype._cleanup=function(){var t,i;try{for(var r=Um(this._connections.keys()),s=r.next();!s.done;s=r.next()){var o=s.value;this._cleanupPeer(o),this._connections.delete(o)}}catch(a){t={error:a}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}this.socket.removeAllListeners()},e.prototype._cleanupPeer=function(t){var i,r,s=this._connections.get(t);if(s)try{for(var o=Um(s),a=o.next();!a.done;a=o.next()){var l=a.value;l.close()}}catch(c){i={error:c}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}},e.prototype.disconnect=function(){if(!this.disconnected){var t=this.id;gt.default.log("Disconnect peer with ID:".concat(t)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=t,this._id=null,this.emit("disconnected",t)}},e.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)gt.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)gt.default.error("In a hurry? We're still trying to make the initial connection!");else throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"))}},e.prototype.listAllPeers=function(t){var i=this;t===void 0&&(t=function(r){}),this._api.listAllPeers().then(function(r){return t(r)}).catch(function(r){return i._abort(Zi.ServerError,r)})},e.DEFAULT_KEY="peerjs",e}(Kv.EventEmitter);See.Peer;const kVe=`
    // Description : Array and textureless GLSL 2D/3D/4D simplex
    //               noise functions.
    //      Author : Ian McEwan, Ashima Arts.
    //  Maintainer : ijm
    //     Lastmod : 20110822 (ijm)
    //     License : Copyright (C) 2011 Ashima Arts. All rights reserved.
    //               Distributed under the MIT License. See LICENSE file.
    //               https://github.com/ashima/webgl-noise
    //
    
    vec3 mod289(vec3 x) {
      return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 mod289(vec4 x) {
      return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 permute(vec4 x) {
         return mod289(((x*34.0)+1.0)*x);
    }
    
    vec4 taylorInvSqrt(vec4 r)
    {
      return 1.79284291400159 - 0.85373472095314 * r;
    }
    
    float snoise(vec3 v)
      {
      const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
      const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
    
    // First corner
      vec3 i  = floor(v + dot(v, C.yyy) );
      vec3 x0 =   v - i + dot(i, C.xxx) ;
    
    // Other corners
      vec3 g = step(x0.yzx, x0.xyz);
      vec3 l = 1.0 - g;
      vec3 i1 = min( g.xyz, l.zxy );
      vec3 i2 = max( g.xyz, l.zxy );
    
      //   x0 = x0 - 0.0 + 0.0 * C.xxx;
      //   x1 = x0 - i1  + 1.0 * C.xxx;
      //   x2 = x0 - i2  + 2.0 * C.xxx;
      //   x3 = x0 - 1.0 + 3.0 * C.xxx;
      vec3 x1 = x0 - i1 + C.xxx;
      vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y
      vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y
    
    // Permutations
      i = mod289(i);
      vec4 p = permute( permute( permute(
                 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
               + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
               + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
    
    // Gradients: 7x7 points over a square, mapped onto an octahedron.
    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)
      float n_ = 0.142857142857; // 1.0/7.0
      vec3  ns = n_ * D.wyz - D.xzx;
    
      vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)
    
      vec4 x_ = floor(j * ns.z);
      vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
    
      vec4 x = x_ *ns.x + ns.yyyy;
      vec4 y = y_ *ns.x + ns.yyyy;
      vec4 h = 1.0 - abs(x) - abs(y);
    
      vec4 b0 = vec4( x.xy, y.xy );
      vec4 b1 = vec4( x.zw, y.zw );
    
      //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;
      //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;
      vec4 s0 = floor(b0)*2.0 + 1.0;
      vec4 s1 = floor(b1)*2.0 + 1.0;
      vec4 sh = -step(h, vec4(0.0));
    
      vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
      vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
    
      vec3 p0 = vec3(a0.xy,h.x);
      vec3 p1 = vec3(a0.zw,h.y);
      vec3 p2 = vec3(a1.xy,h.z);
      vec3 p3 = vec3(a1.zw,h.w);
    
    //Normalise gradients
      vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
      p0 *= norm.x;
      p1 *= norm.y;
      p2 *= norm.z;
      p3 *= norm.w;
    
    // Mix final noise value
      vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
      m = m * m;
      return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                    dot(p2,x2), dot(p3,x3) ) );
      }
              
    
    float fsnoise(float val1, float val2, float val3){
      return snoise(vec3(val1,val2,val3));
    }
    
    vec3 distortFunct(vec3 transformed, float factor) {
      float radiusVariation = -fsnoise(
        transformed.x * radiusNoiseFrequency + time,
        transformed.y * radiusNoiseFrequency + time,
        transformed.z * radiusNoiseFrequency + time 
      ) * radiusVariationAmplitude * factor;
      return normalize(transformed) * (radiusVariation + radius);
    }
    
    vec3 orthogonal(vec3 v) {
      return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0)
      : vec3(0.0, -v.z, v.y));
    }
    
    vec3 distortNormal(vec3 position, vec3 distortedPosition, vec3 normal){
      vec3 tangent1 = orthogonal(normal);
      vec3 tangent2 = normalize(cross(normal, tangent1));
      vec3 nearby1 = position + tangent1 * 0.1;
      vec3 nearby2 = position + tangent2 * 0.1;
      vec3 distorted1 = distortFunct(nearby1, 1.0);
      vec3 distorted2 = distortFunct(nearby2, 1.0);
      return normalize(cross(distorted1 - distortedPosition, distorted2 - distortedPosition));
    }
`,CP=`
    #include <begin_vertex>
    float updateTime = time / 10.0;
    transformed = distortFunct(transformed, 1.0);
    vec3 distortedNormal = distortNormal(position, transformed, normal);
    vNormal = normal + distortedNormal;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(transformed,1.);
`,pP=`
    #include <dithering_fragment>
    float angle = clamp(dot(normalize(vNormal), vec3(0., -1., 0.)), 0., 1.);
    gl_FragColor = vec4(gl_FragColor.rgb * color, gl_FragColor.a);  
    gl_FragColor.rgb = mix(gl_FragColor.rgb, mix(color, vec3(0.), 0.5), angle);
`,iw=n=>{const e=M.useRef(0);return{isReady:t=>{const i=t.elapsedTime,r=i-e.current>1/n;return r&&(e.current=i),r}}},Ec=(n,e,t)=>{const i=iw(n);yn((r,s)=>{i.isReady(r.clock)&&e(r,s)},t)};function LVe(n){const{idea:e,...t}=n,i=M.useMemo(()=>(e==null?void 0:e.getHex())||"#808080",[e]),r=M.useMemo(()=>Math.random(),[]),s=M.useMemo(()=>new zs(i),[i]),o=4,a=.82,l=.154,{col:c}=Tc({col:i}),g=M.useMemo(()=>{const d=new Hu({metalness:.18,roughness:.49,envMapIntensity:.66,side:Bx});return d.onBeforeCompile=function(h){h.uniforms.radius=new zu(o),h.uniforms.time=new zu(0),h.uniforms.color=new zu(s),h.uniforms.radiusVariationAmplitude=new zu(a),h.uniforms.radiusNoiseFrequency=new zu(l);const f=`
        uniform float radius;
        uniform float time;
        uniform vec3 color;
        uniform float radiusVariationAmplitude;
        uniform float radiusNoiseFrequency;
      `;h.vertexShader=f+kVe+h.vertexShader.replace("#include <begin_vertex>",CP),h.fragmentShader=f+h.fragmentShader.replace("#include <dithering_fragment>",pP),d.userData.shader=h},d},[o,s,a,l,pP,CP]),u=iw(50);return yn(d=>{var h;let{clock:f}=d;!(g!=null&&(h=g.userData)!=null&&h.shader)||!u.isReady(f)||(g.userData.shader.uniforms.time.value=f.elapsedTime/6+r*1e3,g.userData.shader.uniforms.color.value.set(c.get()))}),L.createElement("group",pt({name:"spacesvr-basis-idea"},t),L.createElement("mesh",{material:g,scale:.2},L.createElement("sphereGeometry",{args:[o,48,32]})))}class Gd{constructor(e,t,i){return e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=.5),this.setFromCreation(e,t,i),this}setFromCreation(e,t,i){return e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=.5),this.mediation=e,this.specificity=t,this.utility=i,this}setFromHex(e){const t=fEe(sD(e));return t?(this.mediation=t.h/360,this.specificity=t.c/.322,this.utility=t.l,this):(console.warn("idea :: setFromHex - invalid hex color"),this)}updateFromText(e){const t=e.length;return this.mediation=zVe(e),this.specificity=(1-(t==0?1:1/t))*.5,this}setUtility(e){return this.utility=e,this}getHex(){const e=sD({mode:"oklch",l:this.utility,c:this.specificity*.322,h:this.mediation*360});return hEe(e)}getOpposite(){const e=this.mediation+.5>1?this.mediation-.5:this.mediation+.5,t=this.specificity,i=.5-(this.utility-.5);return new Gd().setFromCreation(e,t,i)}clone(){return new Gd(this.mediation,this.specificity,this.utility)}}const HVe=100,zVe=function(n,e){e===void 0&&(e=20);let t=0;for(let r=0;r<n.length;r++)t+=n.substr(r,1).charCodeAt(0);const i=e*HVe;return t%i/i};new Ve(0,-1,0);function XVe(n){const{color:e}=n,t=Bt(i=>i.scene);return M.useLayoutEffect(()=>{const i=t.background,r=e instanceof zs?e:new zs(e);return t.background=r,()=>{t.background=i}},[e]),null}function YVe(n){const{color:e="white",near:t=10,far:i=80}=n,r=Bt(s=>s.scene);return M.useEffect(()=>{const s=e instanceof zs?e:new zs(e);return r.fog=new hZe(s,t,i),()=>{r.fog=null}},[r,e,t,i]),null}function KVe(n){const{height:e=-1e-4,size:t=[100,100],visible:i}=n,[r]=G3e(()=>({rotation:[-Math.PI/2,0,0],position:[0,e,0],args:t,type:"Static"}));return i?L.createElement("mesh",{name:"spacesvr-infinite-plane",ref:r},L.createElement("planeGeometry",{args:t}),L.createElement("meshPhongMaterial",{color:"#660000"})):null}let PG;const h0=128,$l=h0/2,Qm=12,DVe=1;function PVe(){if(PG)return PG;const n=document.createElement("canvas");n.height=h0,n.width=h0;const e=n.getContext("2d");return e.fillStyle="#FFFFFF",e.fillRect(0,0,h0,h0),e.fillStyle="#000000",e.beginPath(),e.arc($l,$l,Qm,0,2*Math.PI),e.fill(),e.strokeStyle="#FFFFFF",e.lineWidth=Math.ceil(DVe),e.beginPath(),e.moveTo($l,$l-Qm),e.lineTo($l,$l+Qm),e.stroke(),e.beginPath(),e.moveTo($l-Qm,$l),e.lineTo($l+Qm,$l),e.stroke(),PG=new CZe(n),PG}const UVe="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/basis/",QVe=new GZe;let f0;const OVe=()=>{if(f0)return;f0=new Ic,f0.setTranscoderPath(UVe);let n;const e=document.createElement("canvas");let t=e.getContext("webgl2");if(t?n=!0:(t=e.getContext("webgl"),n=!1),!t)throw new Error("No WebGL support");e.remove();const i={extensions:new M3e(t),capabilities:{isWebGL2:n}};f0.detectSupport(i)};function Wee(){return function(n){const e=n.toLowerCase().endsWith("ktx2");OVe();const t=e?f0:QVe;return new Promise(i=>t.load(n,i,void 0,r=>{console.error(r),i(PVe())}))}}function B5(n){return vV(Wee(),[n])}B5.preload=function(n){return Y4(Wee(),[n])};B5.clear=function(n){return K4([n])};function JVe(n){const{width:e,height:t,thickness:i=1,material:r,innerFrameMaterial:s}=n,o=M.useMemo(()=>r||new Hu({color:3355443,roughness:.8,metalness:.05}),[r]),a=.075,l=.06,c=.08,g=.05*i,u=5e-4,d=M.useMemo(()=>{const f=new ac(e+l,t+l,a);f.translate(0,0,-a-u);const I=new ac(e+l,g,c);I.translate(0,t/2+l/2-g/2,0);const A=new ac(e+l,g,c);A.translate(0,-t/2-l/2+g/2,0);const p=new ac(g,t+l,c);p.translate(-e/2-l/2+g/2,0,0);const y=new ac(g,t+l,c);y.translate(e/2+l/2-g/2,0,0);const b=Y3e([f,I,A,p,y]);return f.dispose(),I.dispose(),A.dispose(),p.dispose(),y.dispose(),b},[s,g,e,t]),h=M.useMemo(()=>{if(!s)return;const f=new ac(e+l,t+l,a);return f.translate(0,0,-a-u),f},[s,e,t]);return L.createElement("group",{name:"spacesvr-frame"},L.createElement("mesh",{geometry:d,material:o}),h&&s&&L.createElement("mesh",{geometry:h,material:s}))}function jVe(n){const{src:e,size:t=1,framed:i,frameMaterial:r,frameWidth:s=1,innerFrameMaterial:o,...a}=n,l=B5(e),{width:c,height:g}=l.image,u=Math.max(c,g),d=c/u*t,h=g/u*t,f=l.isCompressedTexture;return L.createElement("group",pt({name:"spacesvr-image"},a),L.createElement("mesh",{rotation:f?[0,Math.PI,Math.PI]:[0,0,0]},L.createElement("planeGeometry",{args:[d,h]}),L.createElement("meshBasicMaterial",{map:l,side:Bx,transparent:!0})),i&&L.createElement(JVe,{width:d,height:h,thickness:s,material:r,innerFrameMaterial:o}))}function BF(n){return L.createElement(M.Suspense,{fallback:null},L.createElement(jVe,n))}const qVe=n=>n.index?n.index.count/3:n.attributes.position.count/3,$Ve=function(n,e){if(e===void 0&&(e=0),!n.geometry||!n.geometry.isBufferGeometry)return;const t=n.geometry,i=qVe(t);t.boundsTree||i<e||(n.raycast=RCe,t.computeBoundsTree=ZCe,t.disposeBoundsTree=MCe,t.computeBoundsTree({verbose:!0}))},mP=new Map;function Yo(n,e,t){let i=mP.get(n);return i?t!=null&&t.verbose&&console.log(`[CACHE] ${n} found, returning`):(t!=null&&t.verbose&&console.log(`[CACHE] ${n} not found, creating new`),i=e(),mP.set(n,i)),i}const Hx={getResource:Yo,useResource:(n,e,t)=>{const[i,r]=M.useState(Yo(n,e,t));return M.useEffect(()=>{r(Yo(n,e,t))},[n]),i},get mat_standard_white(){return Yo("mat_standard_white",()=>new Hu({color:"white"}))},get mat_standard_cream_double(){return Yo("mat_standard_cream_double",()=>new Hu({color:"#aaa",side:Bx}))},get mat_standard_black(){return Yo("mat_standard_black",()=>new Hu({color:"black"}))},get mat_standard_rose(){return Yo("mat_standard_rose",()=>new Hu({color:"#ff007f"}))},get mat_standard_red(){return Yo("mat_standard_red",()=>new Hu({color:"#ff0000"}))},get mat_basic_white(){return Yo("mat_basic_white",()=>new eA({color:"white"}))},get mat_basic_black(){return Yo("mat_basic_black",()=>new eA({color:"black"}))},get mat_basic_gray(){return Yo("mat_basic_gray",()=>new eA({color:"#828282"}))},get mat_basic_red(){return Yo("mat_basic_red",()=>new eA({color:"red"}))},get mat_basic_black_wireframe(){return Yo("mat_basic_black_wireframe",()=>new eA({color:"black",wireframe:!0}))}},eTe=()=>{var n,e,t;return((n=document)==null||(e=n.activeElement)==null?void 0:e.tagName)==="INPUT"&&((t=document)==null?void 0:t.hasFocus())},Fee=function(n,e,t){t===void 0&&(t=[]);const{clock:i,size:r,viewport:s}=Bt(),o=r.width/s.width,[a]=M.useState(new mn),[l]=M.useState(new mn),[c]=M.useState(new mn),[g]=M.useState(new mn),u=M.useRef(0),d=M.useCallback(y=>{n.onStart&&n.onStart(y)},[...t]),h=M.useCallback(y=>{n.onMove&&n.onMove(y)},[...t]),f=M.useCallback(y=>{n.onEnd&&n.onEnd(y)},[...t]),I=M.useCallback(y=>{y.preventDefault();const v=y.changedTouches[0];a.set(v.clientX,v.clientY),d({e:y,touch:v,downPoint:a,dragPoint:a,velocity:c})},[d,a,c]),A=M.useCallback(y=>{const v=y.touches[0];l.set(v.clientX,v.clientY);const b=l.sub(a),w=i.elapsedTime,G=w-u.current;c.set(b.x/G/o,b.y/G/o),u.current=w,h({e:y,touch:v,downPoint:a,dragPoint:l,velocity:c,delta:b})},[o,h,i,a,l,c]),p=M.useCallback(y=>{const v=y.changedTouches[0];l.set(v.clientX,v.clientY),g.copy(l).sub(a),f({e:y,touch:v,downPoint:a,dragPoint:l,velocity:c,delta:g})},[f,g,a,l,c]);return M.useEffect(()=>{const y=e||document;return y.addEventListener("touchstart",I),y.addEventListener("touchmove",A),y.addEventListener("touchend",p),()=>{y.removeEventListener("touchstart",I),y.removeEventListener("touchmove",A),y.removeEventListener("touchend",p)}},[e,p,A,I]),{startDrag:I,moveDrag:A,endDrag:p}},tTe=.125,nTe=tTe*2,iTe=.125,rTe=iTe*2,sTe=Math.PI/180/2,Gh=(n,e,t,i)=>{const r=e.fov*sTe,s=2*Math.tan(r)*Math.abs(t),o=s*e.aspect,a=n.x||n[0],l=n.y||n[1],c=a*(o-nTe)*.5,g=l*(s-rTe)*.5;return i?(i.x=c,i.y=g,i):new mn(c,g)},oTe=Un.div`
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
  z-index: 0;

  canvas {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    outline: 0;
  }
`,aTe=u5`
  @font-face {
    font-family: "Quicksand";
    src: url("https://d27rt3a60hh1lx.cloudfront.net/fonts/Quicksand_Bold.otf");
  }

  html {
    position: fixed;
    height: 100%;
    overflow: hidden;
  }

  body {
    margin: 0;
    width: 100vw;
    height: 100vh;
    user-select: none;
    overflow: hidden;
    touch-action: none;
    -webkit-overflow-scrolling: touch;
  }
`;function lTe(){return M.useEffect(()=>{const n=document.createElement("meta");return n.name="viewport",n.content="initial-scale=1, viewport-fit=cover",document.head.append(n),()=>{document.head.removeChild(n)}},[]),L.createElement(C$,{styles:aTe})}const cTe=()=>{const{progress:t,total:i}=gJ(),r=M.useRef(new Date),s=M.useRef(0),o=M.useRef(!1),[,a]=M.useState(0);M.useEffect(()=>{const h=new Date().getTime()-r.current.getTime();Math.min(t-s.current,h<2e3?99:100)>0&&(t===100?(o.current=!0,setTimeout(()=>{o.current&&(s.current=t,a(Math.random()))},300)):(o.current=!1,s.current=t)),t!==100&&(o.current=!1)},[t]);const[l,c]=M.useState(0),[g,u]=M.useState(!1);return M.useEffect(()=>{i>0||(l>0?u(!0):setTimeout(()=>c(l+1),2e3))},[l]),g?100:Math.floor(s.current)},gTe=p$`
  0% {
    transform: translatey(0px);
  }

  50% {
    transform: translatey(-15px);
  }

  100% {
    transform: translatey(0px);
  }
`,uTe=p$`
  0% {
    opacity: 0.8;
  }

  50% {
    opacity: 0.2;
  }

  100% {
    opacity: 0.8;
  }
`,dTe=Un.div`
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  z-index: 11;
  background: white;
  transition: opacity 0.75s ease-in;
  transition-delay: 0.5s;
  opacity: ${n=>n.finished?"0":"1"};
  pointer-events: ${n=>n.finished?"none":"all"};
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  font-family: "Quicksand", sans-serif;
  font-size: 27px;
  @media screen and (max-width: 500px) {
    font-size: 24px;
  }
`,hTe=Un.div`
  animation: ${gTe} 7s ease-in-out infinite;
`,fTe=Un.div`
  position: relative;

  &:before {
    pointer-events: none;
    position: absolute;
    content: "";
    top: 100%;
    left: 5%;
    height: 10px;
    width: 90%;
    background: -webkit-radial-gradient(
      center,
      ellipse,
      rgba(0, 0, 0, 0.35) 0%,
      transparent 80%
    );
    background: radial-gradient(
      ellipse at center,
      rgba(0, 0, 0, 0.35) 0%,
      transparent 80%
    );
    -webkit-transition-duration: 0.3s;
    transition-duration: 0.3s;
    -webkit-transition-property: transform, opacity;
    transition-property: transform, opacity;
    animation: ${uTe} 7s ease-in-out infinite;
  }
`;function ITe(){const n=cTe();return L.createElement(dTe,{finished:n===100},L.createElement(fTe,null,L.createElement(hTe,null,Math.round(n),"%")))}const ATe=Un.div`
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  z-index: 10;
  transition: opacity 0.25s ease;
  background: rgba(0, 0, 0, ${n=>n.dev?0:.25});
  display: flex;
  justify-content: center;
  flex-direction: column;
  align-items: center;
  opacity: ${n=>n.paused?1:0};
  pointer-events: ${n=>n.paused?"all":"none"};
  font-family: "Quicksand", sans-serif;
  font-size: 27px;
  @media screen and (max-width: 500px) {
    font-size: 24px;
  }
`,CTe=Un.div`
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  z-index: -1;
`,pTe=Un.div`
  width: 90%;
  max-width: 400px;
  padding: 20px 20px;
  color: black;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: relative;
  border-radius: 10px;
  background-color: white;
  background-position: center;
  background-size: cover;
  box-sizing: border-box;

  box-shadow: 12px 12px 16px 0 rgba(0, 0, 0, 0.25),
    -8px -8px 12px 0 rgba(255, 255, 255, 0.3);
`,mTe=Un.div`
  width: 90%;
  max-width: 400px;
  height: auto;
  cursor: pointer;
  text-align: center;
  font-size: 1.3em;
  font-family: "Quicksand", sans-serif;
  transition: opacity 0.15s linear;
  margin-top: 20px;
  background: ${n=>n.color};
  color: white;
  //border: 2px solid black;
  line-height: 1em;
  padding: 12px 0;
  border-radius: 10px;
  :hover {
    opacity: 0.5;
  }

  box-shadow: 12px 12px 16px 0 rgba(0, 0, 0, 0.25),
    -8px -8px 12px 0 rgba(255, 255, 255, 0.3);
`,yTe=Un.div`
  width: 100%;
  height: auto;
  margin: 30px 0;
  font-size: 0.7em;
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: center;

  & > p {
    margin: 0.2em;
  }
`,vTe=Un.div`
  border: 1px solid black;
  border-radius: 10px;
  background: rgba(255, 255, 255, 0);
  padding: 5px 10px;
  margin: 8px 4px;
  transition: background 0.15s linear;
  font-size: 0.5em;
  cursor: pointer;

  &:hover {
    background: rgba(0, 0, 0, 0.15);
  }
`,bTe=Un.a`
  border: 1px solid black;
  border-radius: 10px;
  background: rgba(255, 255, 255, 0);
  padding: 5px 10px;
  margin: 8px 4px;
  transition: background 0.15s linear;
  font-size: 0.5em;
  cursor: pointer;
  text-decoration: none;
  color: black !important;

  &:hover {
    background: rgba(0, 0, 0, 0.15);
  }
`,BTe=Un.h1`
  margin: 0;
`,GTe=Un.div`
  width: 100%;
  display: flex;
  justify-content: space-evenly;
  flex-wrap: wrap;
`,wTe=()=>{const[n,e]=M.useState("W/A/S/D");return M.useEffect(()=>{const t=window.self!==window.top;if(!navigator.keyboard||t)return;navigator.keyboard.getLayoutMap().then(r=>{r.get("KeyW")==="z"&&e("Z/Q/S/D")})},[]),n},xTe=()=>{const[n,e]=M.useState(C5?"mobile":"desktop");return{device:{mobile:n==="mobile",desktop:n==="desktop",xr:n==="xr"},setDevice:e}},GF=M.createContext({}),Nr=()=>M.useContext(GF),STe=n=>{const[e,t]=M.useState([]),i=M.useRef(null),[r,s]=M.useState(!0),o=M.useMemo(()=>[],[]),[a,l]=M.useState(!1),c=M.useCallback(u=>{if(s(u),!a){const d=UT.getContext();d.state!=="running"&&d.resume(),l(!0)}o.map(d=>d.apply(null,[u]))},[o,a]);return{...xTe(),name:n,paused:r,setPaused:c,events:o,containerRef:i,menuItems:e,setMenuItems:t}};function RTe(n){const{title:e="spacesvr",pauseMenuItems:t=[],dev:i=!1}=n,{paused:r,setPaused:s,menuItems:o,device:a}=Nr(),l=wTe(),c=M.useCallback(()=>{const d=o.find(h=>h.text==="Enter VR");d&&d.action?d.action():s(!1)},[o,s]),g=M.useMemo(()=>new Gd().setFromCreation(Math.random(),.8,.95).getHex(),[]),u=[...t,{text:"v2.12.2",link:"https://www.npmjs.com/package/spacesvr"},...o];return L.createElement(ATe,{paused:r,dev:i},L.createElement(CTe,{onClick:c}),!i&&L.createElement(L.Fragment,null,L.createElement(pTe,null,L.createElement(BTe,null,e),L.createElement(yTe,null,L.createElement("p",null,"Move – ",a.mobile?"Joystick":l),L.createElement("p",null,"Look – ",a.mobile?"Drag":"Mouse"),L.createElement("p",null,"Pause – ",a.mobile?"Menu Button":"Esc"),L.createElement("p",null,"Cycle Tool – ",a.mobile?"Edge Swipe":"Tab")),L.createElement(GTe,null,u.map(d=>d.link?L.createElement(bTe,{key:d.text,href:d.link,target:"_blank"},d.text):L.createElement(vTe,{key:d.text,onClick:d.action},d.text)))),L.createElement(mTe,{onClick:c,color:g},"continue")))}const ZTe=Un.div`
  position: fixed;
  top: 50%;
  left: 50%;
  z-index: 1;
  mix-blend-mode: difference;

  &::before {
    content: "";
    position: absolute;
    height: 16px;
    width: 1.5px;
    transform: translate(-50%, -50%);
    border-radius: 6px;
    background: #ffffff;
  }

  &::after {
    content: "";
    position: absolute;
    width: 16px;
    height: 1.5px;
    transform: translate(-50%, -50%);
    border-radius: 6px;
    background: #ffffff;
  }
`,MTe=()=>C5?null:L.createElement(ZTe,null);function ETe(){return/(OculusBrowser)/i.test(window.navigator.userAgent)}function WTe(){return/(Mobile VR)/i.test(window.navigator.userAgent)}function G5(){return ETe()||WTe()}function FTe(){const{setMenuItems:n}=Nr(),e=_Te(),t=TTe(),i=VTe();return M.useEffect(()=>{const r=[];e&&r.push(e),t&&r.push(t),i&&r.push(i),n(r)},[e==null?void 0:e.text,t==null?void 0:t.text,i==null?void 0:i.text,n]),null}const _Te=()=>{const n=Bt(a=>a.gl),{setDevice:e,setPaused:t}=Nr(),i=M.useRef(),[r,s]=M.useState("Enter VR"),o=M.useCallback(()=>{async function a(g){g.addEventListener("end",l),await n.xr.setSession(g),s("Exit VR"),e("xr"),t(!1),i.current=g}function l(){var g;(g=i.current)==null||g.removeEventListener("end",l),e(C5?"mobile":"desktop"),s("Enter VR"),t(!0),i.current=void 0}if(i.current===void 0){const g={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]};navigator.xr.requestSession("immersive-vr",g).then(a)}else{var c;(c=i.current)==null||c.end()}},[n.xr,e,t]);if(G5())return{text:r,action:o}},VTe=()=>{if(!G5())return{text:"Open in Meta Quest",link:"https://www.oculus.com/open_url/?url="+window.location.href}},TTe=()=>{const n=document.body,e=n.requestFullscreen||n.webkitRequestFullScreen||n.mozRequestFullScreen||n.msRequestFullscreen||void 0,[t,i]=M.useState(!1),[r]=M.useState(e!==void 0);M.useEffect(()=>{const o=()=>i(document.fullscreenElement!==null);return document.addEventListener("fullscreenchange",o),()=>{document.removeEventListener("fullscreenchange",o)}},[]);const s=M.useCallback(()=>{e&&(document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():e.apply(n,[{navigationUI:"hide"}]))},[n,e]);if(!(!r||G5()))return{text:`${t?"Exit":"Enter"} Fullscreen`,action:s}},NTe={gl:{powerPreference:"high-performance",antialias:!0,depth:!0,alpha:!1,stencil:!1,useLegacyLights:!1,toneMapping:M6},shadows:!1,camera:{position:[0,2,0],near:.01,far:300},dpr:1,raycaster:{far:3},events:void 0};function kTe(){return M.useEffect(()=>{function n(){const e=UT.getContext();document.hidden?e.suspend():e.resume()}return document.addEventListener("visibilitychange",n),()=>document.removeEventListener("visibilitychange",n)},[]),null}function LTe(n){const{loadingScreen:e,pauseMenu:t,dev:i,canvasProps:r,name:s="spacesvr",children:o}=n,a=STe(s);return L.createElement(L.Fragment,null,L.createElement(lTe,null),L.createElement(kTe,null),L.createElement(oTe,{id:"__spacesvr",ref:a.containerRef},L.createElement(GF.Provider,{value:a},e||L.createElement(ITe,null),t||L.createElement(RTe,{dev:i,title:s}),L.createElement(MTe,null)),L.createElement(lJ,pt({},NTe,r),L.createElement(N_e,null,L.createElement(GF.Provider,{value:a},L.createElement(FTe,null),o)))))}const HTe=n=>{const{direction:e}=n,t=M.useRef(),i=M.useRef(),{containerRef:r}=Nr();M.useEffect(()=>{if(r.current)return i.current=document.createElement("div"),i.current.style.position="fixed",i.current.style.left="0",i.current.style.bottom="0",i.current.style.width="40%",i.current.style.maxWidth="160px",i.current.style.height="25%",i.current.style.height="160px",i.current.style.zIndex="5",i.current.classList.add("nipple-container"),r.current.appendChild(i.current),t.current=TWe.create({zone:i.current,mode:"static",position:{left:"50%",top:"50%"},color:"#fff",size:120,restOpacity:.75}),t.current.on("move",(o,a)=>{const l=a.distance/60*Math.cos(a.angle.radian),c=-a.distance/60*Math.sin(a.angle.radian);e.current.set(l,0,c)}),t.current.on("end",()=>{e.current.set(0,0,0)}),i.current.addEventListener("touchstart",o=>{o.preventDefault()}),()=>{t.current&&t.current.destroy()}},[]);const s=u5`
    .nipple-container > * > .front,
    .nipple-container > * > .back {
      background: radial-gradient(white, white 64%, black 86%) !important;
    }
  `;return L.createElement(C$,{styles:s})},zTe=n=>{const{direction:e,flying:t}=n,{paused:i}=Nr(),r=M.useRef([!1,!1,!1,!1,!1]),s=M.useCallback(()=>{const c=r.current,g=-1*Number(c[0])+Number(c[2]);return[-1*Number(c[1])+Number(c[3]),t&&c[4]?1:0,g]},[t]),o=M.useCallback((c,g)=>{switch(c.code||c.key||c.keyCode){case"KeyW":case"KeyI":case"ArrowUp":case"Numpad8":case 38:r.current[0]=g;break;case"KeyA":case"KeyJ":case"ArrowLeft":case"Numpad4":case 37:r.current[1]=g;break;case"KeyS":case"KeyK":case"ArrowDown":case"Numpad5":case"Numpad2":case 40:r.current[2]=g;break;case"KeyD":case"KeyL":case"ArrowRight":case"Numpad6":case 39:r.current[3]=g;break;case"Space":r.current[4]=g;break;default:return}},[]),a=M.useCallback(c=>{if(c.defaultPrevented||c.ctrlKey||c.altKey||c.metaKey)return;o(c,!0);const[g,u,d]=s();e.current.set(g,u,d)},[s,e,o]),l=M.useCallback(c=>{o(c,!1);const[g,u,d]=s();e.current.set(g,u,d)},[s,e,o]);return M.useEffect(()=>{if(i){e.current.set(0,0,0),r.current=[!1,!1,!1,!1,!1];return}return document.addEventListener("keydown",a),document.addEventListener("keyup",l),()=>{document.removeEventListener("keydown",a),document.removeEventListener("keyup",l)}},[i,a,l,e]),null},_ee=1e-4,XTe=_ee,YTe=Math.PI-_ee,yP=.8,vP=Math.PI/2;function KTe(){const n=Bt(g=>g.camera),e=Bt(g=>g.gl),{domElement:t}=e,{paused:i,setPaused:r,events:s}=Nr(),o=M.useRef(!1),[a]=M.useState(new Jg(0,0,0,"YXZ")),l=M.useCallback(()=>t.ownerDocument.pointerLockElement===t,[t]),c=M.useRef(0);return M.useEffect(()=>{const g=f=>{if(!o.current)return;const I=f.movementX||f.mozMovementX||f.webkitMovementX||0,A=f.movementY||f.mozMovementY||f.webkitMovementY||0;a.setFromQuaternion(n.quaternion),a.y-=I*yP*.002,a.x-=A*yP*.002,a.x=Math.max(vP-YTe,Math.min(vP-XTe,a.x)),n.quaternion.setFromEuler(a)};function u(){o.current=!1,r(!0)}function d(){l()?(o.current=!0,i&&r(!1)):(c.current=performance.now(),o.current=!1,i||r(!0))}const{ownerDocument:h}=t;return h.addEventListener("mousemove",g),h.addEventListener("pointerlockchange",d),h.addEventListener("pointerlockerror",u),()=>{h.removeEventListener("mousemove",g),h.removeEventListener("pointerlockchange",d),h.removeEventListener("pointerlockerror",u)}},[i,t,r,a,n.quaternion,l]),M.useEffect(()=>{setTimeout(()=>{!o.current&&!i&&r(!0)},250)},[i,r]),M.useEffect(()=>{const g=u=>{u?t.ownerDocument.exitPointerLock():performance.now()-c.current>1250&&t.requestPointerLock()};return s.push(g),()=>{const u=s.indexOf(g);u>=0&&s.splice(u,1)}},[t,s,l]),null}const rw={pos:new mn(0,0),id:-1},sw=(n,e)=>{const t=e.length;for(let i=0;i<t;i++)if(n===e[i].identifier)return e[i]},Vee=n=>{const e=n.touches[n.touches.length-1].target;return e.classList.contains("nipple-container")||e.classList.contains("front")||e.classList.contains("back")},bP=new mn(.7,.7);function BP(){const n=M.useRef(rw),e=M.useRef(new Jg(0,0,0,"YXZ")),t=Bt(a=>a.camera),i=(a,l)=>{const c=e.current.clone(),g=a-n.current.pos.x,u=l-n.current.pos.y;return c.setFromQuaternion(t.quaternion),c.y=e.current.y-g*bP.x/100,c.x=e.current.x-u*bP.y/100,c.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,c.x)),c},r=a=>{if(n.current.id!==-1)return;if(Vee(a)){n.current=rw;return}const l=a.touches.length-1,{clientX:c,clientY:g,identifier:u}=a.touches[l];n.current={pos:new mn(c,g),id:u},e.current.setFromQuaternion(t.quaternion)},s=a=>{const l=sw(n.current.id,a.touches);if(!l)return;const{clientX:c,clientY:g}=l,u=i(c,g);t.quaternion.setFromEuler(u)},o=a=>{const l=sw(n.current.id,a.changedTouches);if(!l)return;const{clientX:c,clientY:g}=l;e.current=i(c,g),n.current.id=-1};return M.useEffect(()=>(document.addEventListener("touchstart",r),document.addEventListener("touchmove",s),document.addEventListener("touchend",o),()=>{document.removeEventListener("touchstart",r),document.removeEventListener("touchmove",s),document.removeEventListener("touchend",o)}),[o,s,r]),null}const Tee=.9,w5=.225,wF=8,DTe="Sphere",x5={type:DTe,args:[w5,wF,wF]},PTe={...x5,position:[0,-w5,0]},UTe={...x5,position:[0,-(Tee/2),0]},QTe={...x5,position:[0,-(Tee-w5),0]},OTe=n=>{const{paused:e}=Nr(),t=w3e(()=>({mass:0,position:n.current.toArray(),segments:wF,fixedRotation:!0,type:"Dynamic",shapes:[PTe,UTe,QTe]}));return M.useEffect(()=>{e||t[1].mass.set(62)},[e,t]),t},JTe=.008,jTe=n=>{const{fallback:e}=n,t=Bt(I=>I.camera),[i,r]=M.useState(),[s,o]=M.useState(!1),[a,l]=M.useState(0),c=M.useRef(rw),g=M.useRef(0),{alpha:u}=Tc({alpha:a,config:{...xv.default,precision:.001}});M.useEffect(()=>{if(!i){const I=()=>{const A=new fIe(t);A.enabled=!1,r(A)};return window.addEventListener("click",I),()=>{window.removeEventListener("click",I)}}},[i]),yn(()=>{i&&!s&&Object.keys(i.deviceOrientation).length!==0&&(o(!0),i.enabled=!0),i&&(i.alphaOffset=-u.get()*JTe,i.update())});const d=I=>{if(c.current.id!==-1)return;if(Vee(I)){c.current=rw;return}const A=I.touches.length-1,{clientX:p,clientY:y,identifier:v}=I.touches[A];c.current={pos:new mn(p,y),id:v}},h=I=>{const A=sw(c.current.id,I.touches);if(!A)return;const p=A.clientX-c.current.pos.x;l(g.current+p)},f=I=>{const A=sw(c.current.id,I.changedTouches);if(!A)return;const p=A.clientX-c.current.pos.x;l(g.current+p),g.current+=p,c.current.id=-1};return M.useEffect(()=>(document.addEventListener("touchstart",d),document.addEventListener("touchmove",h),document.addEventListener("touchend",f),()=>{document.removeEventListener("touchstart",d),document.removeEventListener("touchmove",h),document.removeEventListener("touchend",f)}),[]),s?null:L.createElement(L.Fragment,null,e)},qTe=(n,e)=>{const t=M.useRef(new Ve),{device:i}=Nr(),r=M.useMemo(()=>new Ve,[]),[s]=M.useState(new Ns),o=M.useRef(0),a=Bt(h=>h.clock),l=M.useRef(new Ve),c=M.useRef(0),g=M.useRef(0),[u]=M.useState(new Ve);return{direction:t,updateVelocity:(h,f)=>{u.x=f.x||0,u.y=0,u.z=f.z||0;const I=u.length()/e,A=(f.y||0)-l.current.y,p=a.getElapsedTime(),y=Math.abs(p-c.current);if(g.current=xA.lerp(g.current,A/y||0,.1),r.x=(t.current.x||0)*.75,r.z=t.current.z||0,r.y=0,r.multiplyScalar(e+Math.abs(g.current)*.085),s.copy(h.quaternion),s.x=0,s.z=0,r.applyQuaternion(s),o.current=xA.lerp(o.current,(t.current.y||0)*.6,.05+I*.075),r.y=Math.min((f.y||0)+o.current,4+I),!i.desktop)n.velocity.set(r.x,r.y,r.z),l.current.set(r.x,r.y,r.z);else{const v=xA.lerp(f.x||0,r.x,.25),b=xA.lerp(f.z||0,r.z,.25);n.velocity.set(v,r.y,b),l.current.set(v,r.y,b)}c.current=p}}},$Te=n=>{const{hand:e="right",increment:t=Math.PI/6,threshold:i=.8}=n,r=p5(e),{player:s}=qi(),o=M.useRef(!1);return yn(()=>{if(r&&r.inputSource.gamepad){const[,,a]=r.inputSource.gamepad.axes;Math.abs(a)>i?(o.current||s.rotateY(-t*Math.sign(a)),o.current=!0):o.current=!1}}),null},e5e=n=>{const{hand:e="left",direction:t}=n,i=p5(e);return yn(()=>{if(i&&i.inputSource.gamepad){const[,,r,s]=i.inputSource.gamepad.axes;t.current.x=r,t.current.z=s}}),null},t5e=n=>{const{direction:e}=n,t=p5("left");return yn(()=>{if(t&&t.inputSource.gamepad){const[i]=t.inputSource.gamepad.buttons;if(!i)return;e.current.y=i.pressed?.5:0}}),null};function n5e(n){const{position:e,direction:t,snapTurn:i,smoothLocomotion:r}=n,{player:s}=qi();return yn(()=>{s.position.copy(e.current),s.position.y-=1.4}),L.createElement(L.Fragment,null,L.createElement(t5e,{direction:t}),L.createElement($Te,i),L.createElement(e5e,pt({},r,{direction:t})),L.createElement(q_e,null))}const i5e=n=>M.useMemo(()=>({lock:()=>n.current=!0,unlock:()=>n.current=!1,isLocked:()=>n.current}),[n]),r5e=(n,e)=>{const t=Bt(o=>o.camera),{bob:i}=Tc({bob:0,config:xv.default}),[r]=M.useState(new Ve);return{update:o=>{const a=e.current.length()>.1,l=Math.abs(n.current.y)<.01;i.set(a&&l?1:0);const c=i.get(),g=Math.sin(o.elapsedTime*20)*.0055*c,u=Math.cos(o.elapsedTime*15+.3)*.002*c;r.set(u,g,0),r.applyQuaternion(t.quaternion),t.position.add(r)}}},Nee=M.createContext({}),S5=()=>M.useContext(Nee),s5e=3.6,o5e=!1;function a5e(n){const{children:e,pos:t=[0,1,0],rot:i=0,flying:r=!1,speed:s=s5e,controls:o={disableGyro:!0}}=n,a=Bt(x=>x.camera),l=Bt(x=>x.raycaster),{device:c}=Nr(),g=M.useRef(new Ve().fromArray(t)),u=M.useRef(new Ve),d=M.useRef(new Ve),h=M.useRef(!1),f=M.useMemo(()=>new WZe(new Ve,new Ve,0,5),[]),[,I]=OTe(g),{direction:A,updateVelocity:p}=qTe(I,s),y=r5e(d,A);M.useEffect(()=>{a.rotation.setFromQuaternion(new Ns().setFromAxisAngle(new Ve(0,1,0),i))},[]),M.useEffect(()=>{const x=I.position.subscribe(R=>u.current.fromArray(R)),B=I.velocity.subscribe(R=>d.current.fromArray(R));return()=>{x(),B()}},[I,I.position,I.velocity]),yn(x=>{let{clock:B}=x;c.desktop&&(f.ray.origin.copy(u.current),f.ray.direction.set(0,0,-1),f.ray.direction.applyQuaternion(a.quaternion)),a.position.copy(u.current),h.current||(p(a,d.current),y.update(B))});const v=M.useCallback(x=>{g.current.copy(x),I.position.set(x.x,x.y,x.z),u.current.copy(x)},[I.position]),b=M.useCallback(x=>{I.velocity.set(x.x,x.y,x.z),d.current.copy(x)},[I.velocity]),w=i5e(h),G={position:{get:()=>u.current.clone(),set:v},velocity:{get:()=>d.current.clone(),set:b},controls:w,raycaster:c.mobile?l:f};return L.createElement(Nee.Provider,{value:G},c.mobile&&L.createElement(L.Fragment,null,(o==null?void 0:o.disableGyro)&&L.createElement(BP,null),!(o!=null&&o.disableGyro)&&L.createElement(jTe,{fallback:L.createElement(BP,null)}),L.createElement(HTe,{direction:A})),c.desktop&&L.createElement(L.Fragment,null,L.createElement(zTe,{direction:A,flying:r}),L.createElement(KTe,null)),c.xr&&L.createElement(n5e,{position:u,direction:A}),o5e,e)}function R5(){const[n,e]=M.useState(0);return M.useCallback(()=>e(Math.random()),[n])}const l5e=n=>{const[e,t]=M.useState(!1);return Ec(5,()=>{const i=n.get();e&&i===0?t(!1):!e&&i>0&&t(!0)}),e};function c5e(){const n=M.useMemo(()=>{const e=new mZe;return e.onBeforeCompile=function(t){t.vertexShader=d5e+t.vertexShader.replace("#include <worldpos_vertex>",`#include <worldpos_vertex>
`+h5e),t.fragmentShader=f5e+t.fragmentShader.replace("#include <color_fragment>",`#include <color_fragment>
  `+I5e)},e},[]);return L.createElement("group",{name:"spacesvr-lost-floor"},L.createElement("mesh",{"rotation-x":-Math.PI/2,material:n},L.createElement("planeGeometry",{args:[1e4,1e4,1,1]})))}const g5e=`
   //
  // Description : Array and textureless GLSL 2D/3D/4D simplex
  //               noise functions.
  //      Author : Ian McEwan, Ashima Arts.
  //  Maintainer : ijm
  //     Lastmod : 20110822 (ijm)
  //     License : Copyright (C) 2011 Ashima Arts. All rights reserved.
  //               Distributed under the MIT License. See LICENSE file.
  //               https://github.com/ashima/webgl-noise
  //
  
  vec3 mod289(vec3 x) {
    return x - floor(x * (1.0 / 289.0)) * 289.0;
  }
  
  vec4 mod289(vec4 x) {
    return x - floor(x * (1.0 / 289.0)) * 289.0;
  }
  
  vec4 permute(vec4 x) {
       return mod289(((x*34.0)+1.0)*x);
  }
  
  vec4 taylorInvSqrt(vec4 r)
  {
    return 1.79284291400159 - 0.85373472095314 * r;
  }
  
  float snoise(vec3 v)
    {
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
  
  // First corner
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;
  
  // Other corners
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );
  
    //   x0 = x0 - 0.0 + 0.0 * C.xxx;
    //   x1 = x0 - i1  + 1.0 * C.xxx;
    //   x2 = x0 - i2  + 2.0 * C.xxx;
    //   x3 = x0 - 1.0 + 3.0 * C.xxx;
    vec3 x1 = x0 - i1 + C.xxx;
    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y
    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y
  
  // Permutations
    i = mod289(i);
    vec4 p = permute( permute( permute(
               i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
             + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
             + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
  
  // Gradients: 7x7 points over a square, mapped onto an octahedron.
  // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)
    float n_ = 0.142857142857; // 1.0/7.0
    vec3  ns = n_ * D.wyz - D.xzx;
  
    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)
  
    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
  
    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);
  
    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );
  
    //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;
    //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;
    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));
  
    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
  
    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);
  
  //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;
  
  // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
    } 
  
`,u5e=`
float fixedpow(float a, float x)
{
    return pow(abs(a), x) * sign(a);
}

float cbrt(float a)
{
    return fixedpow(a, 0.3333333333);
}

vec3 lsrgb2oklab(vec3 c)
{
    float l = 0.4122214708 * c.r + 0.5363325363 * c.g + 0.0514459929 * c.b;
    float m = 0.2119034982 * c.r + 0.6806995451 * c.g + 0.1073969566 * c.b;
    float s = 0.0883024619 * c.r + 0.2817188376 * c.g + 0.6299787005 * c.b;

    float l_ = cbrt(l);
    float m_ = cbrt(m);
    float s_ = cbrt(s);

    return vec3(
        0.2104542553 * l_ + 0.7936177850 * m_ - 0.0040720468 * s_,
        1.9779984951 * l_ - 2.4285922050 * m_ + 0.4505937099 * s_,
        0.0259040371 * l_ + 0.7827717662 * m_ - 0.8086757660 * s_
    );
}

vec3 oklab2lsrgb(vec3 c)
{
    float l_ = c.r + 0.3963377774 * c.g + 0.2158037573 * c.b;
    float m_ = c.r - 0.1055613458 * c.g - 0.0638541728 * c.b;
    float s_ = c.r - 0.0894841775 * c.g - 1.2914855480 * c.b;

    float l = l_ * l_ * l_;
    float m = m_ * m_ * m_;
    float s = s_ * s_ * s_;

    return vec3(
        4.0767416621 * l - 3.3077115913 * m + 0.2309699292 * s,
        -1.2684380046 * l + 2.6097574011 * m - 0.3413193965 * s,
        -0.0041960863 * l - 0.7034186147 * m + 1.7076147010 * s
    );
}
`,d5e=`
  varying vec3 vPos;
`,h5e=`
  vPos = position;
`,f5e=`
  ${g5e}
  ${u5e}
  
  varying vec3 vPos;
`,I5e=`
  diffuseColor.rgb -= 0.2 * (snoise(vPos) + 1.) / 2.;
  diffuseColor.r -= 0.025 * (snoise(-vPos) + 1.) / 2.;
`;new Ve;new Ve;function A5e(n){const{onClick:e,onHover:t,onUnHover:i,children:r}=n;return L.createElement("group",{name:"spacesvr-interactable"},L.createElement(V$,{onHover:t,onBlur:i,onSelect:e?s=>e(s.intersection):void 0},r))}const C5e=.4,p5e=.1;function m5e(n){const{onClick:e,onHover:t,onUnHover:i,raycaster:r,children:s}=n,o=Bt(A=>A.gl),a=Bt(A=>A.clock),{device:l}=Nr(),c=S5(),g=M.useRef(null),u=M.useMemo(()=>({start:new Ve,time:0}),[]),d=M.useRef(),h=r||c.raycaster,f=!!t||!!i,I=M.useCallback(()=>{if(!g.current)return;h.firstHitOnly=!0;const A=h.intersectObject(g.current,!0);return h.firstHitOnly=!1,A.length>0?A[0]:void 0},[h]);return Ec(17,()=>{if(!g.current||!f)return;const A=I();A?(d.current||t&&t(),d.current=A):d.current&&(d.current=void 0,i&&i())}),M.useEffect(()=>{g.current&&g.current.traverse(A=>{const p=A;p.isMesh&&$Ve(p,50)})},[]),M.useEffect(()=>{const A=()=>{h.ray.at(1,u.start),u.time=a.elapsedTime},p=()=>{if(!e||!g.current)return;const b=h.ray.at(1,new Ve),w=u.start.distanceTo(b),G=a.elapsedTime-u.time;if(!(w>p5e||G>C5e))if(f)d.current&&e(d.current);else{const x=I();x&&e(x)}},y=l.mobile?"touchstart":"mousedown",v=l.mobile?"touchend":"mouseup";return o.domElement.addEventListener(y,A),o.domElement.addEventListener(v,p),()=>{o.domElement.removeEventListener(y,A),o.domElement.removeEventListener(v,p)}},[f,h,a,l.mobile,u,I,o.domElement,e]),L.createElement("group",{name:"spacesvr-interactable",ref:g},s)}function y5e(n){const{device:e}=Nr();return e.xr?L.createElement(A5e,n):L.createElement(m5e,n)}const kee=M.createContext({}),kf=()=>M.useContext(kee),v5e=n=>{const[e]=M.useState(()=>new fZe),t=R5(),i=M.useMemo(()=>[],[]),[r,s]=M.useState(n?0:void 0),o=M.useRef(0),[a,l]=M.useState("right"),c=M.useCallback((A,p,y)=>{if(i.find(b=>b.name===A)){console.error(`Toolbelt: Tool with same name already exists: ${A}`);return}i.length===0&&t();const v={name:A,icon:p,orderIndex:y||0};i.push(v),i.sort((b,w)=>b.orderIndex!==w.orderIndex?b.orderIndex-w.orderIndex:b.name.localeCompare(w.name))},[i]),g=M.useCallback(A=>{const p=i.find(y=>y.name===A);p&&i.splice(i.indexOf(p),1)},[i]);M.useEffect(()=>{r!==void 0&&(o.current=r)},[r]);const u=M.useCallback(()=>{l("right"),i.length===1?s(A=>A===void 0?0:void 0):s(A=>A!==void 0?(A+1)%i.length:0)},[i]),d=M.useCallback(()=>{l("left"),i.length===1?s(A=>A===void 0?0:void 0):s(A=>A!==void 0?(A-1+i.length)%i.length:0)},[i]),h=M.useCallback(()=>{s(void 0)},[]),f=M.useCallback(()=>{s(A=>A===void 0?o.current:A)},[]),I=M.useCallback(A=>{const p=i.findIndex(y=>y.name===A);p!==-1&&s(p)},[i]);return{tools:i,activeTool:r!==void 0?i[r]:void 0,grant:c,revoke:g,hide:h,next:u,prev:d,show:f,activeIndex:r,setActiveIndex:s,setActiveTool:I,hudScene:e,direction:a,setDirection:l}},b5e=function(n){n===void 0&&(n=1e3);const e=M.useRef(null),[t,i]=M.useState(!1),r=M.useCallback(()=>{e.current!==null&&clearTimeout(e.current),i(!0),e.current=setTimeout(()=>{i(!1)},n)},[n]);return M.useEffect(()=>()=>{e.current!==null&&clearTimeout(e.current)},[]),{active:t,setActive:r}},xF=40,Lee=10,Om=xF-Lee,GP=25,B5e=Un.div`
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 2;
  padding: ${Om}px ${Om}px 0 ${Om}px;
  border-radius: ${GP}px;
  pointer-events: ${n=>n.open?"all":"none"};

  display: flex;
  max-width: calc(100% - 80px);
  flex-basis: calc(100% - 80px);
  flex-wrap: wrap;
  box-sizing: border-box;
  justify-content: center;
  width: max-content;
  max-height: 100%;
  overflow-y: auto;

  opacity: ${n=>n.open?1:0};
  ${n=>n.open?"transition: opacity 0.075s ease-in-out;":"transition: opacity 0.4s ease-in-out;"};

  @media screen and (max-width: 600px) {
    padding: ${Om}px 10px ${Om}px 10px;
  }

  &:after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: hsl(0deg 0% 90% / 50%);
    border-radius: ${GP}px;
    backdrop-filter: blur(15px);
    z-index: -1;
  }
`,wP=Un.div`
  position: relative;
  width: 125px;
  height: 125px;
  border-radius: 10px;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1;
  margin: 10px 10px ${xF}px 10px;
  
  @media screen and (max-width: 600px) {
    width: 90px;
    height: 90px;
  }
  
  &:before {
    ${n=>!n.active&&"display: none;"}
    content: "";
    position: absolute;
    box-sizing: content-box;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    height: 100%;
    padding: ${Lee}px;
    background: hsl(0deg 0% 50% / 50%);
    border-radius: 10px;
    z-index: -2;
  }
  
  // place text directly below the main box
  &:after {
    ${n=>!n.active&&"display: none;"}
    content: "${n=>n.title}";
    position: absolute;
    bottom: -${xF}px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 1.1rem;
    font-family: sans-serif;
    padding: 4px 10px;
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
    width: 100%;
    text-align: center;
    color: #222;
    

    @media screen and (max-width: 600px) {
      font-size: 0.9rem;
    }
  }
`,G5e=Un.div`
  width: 100%;
  height: 100%;
  background: oklch(75% 0.132 ${n=>n.perc*360});
  font-size: 4rem;
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: sans-serif;
  border-radius: 10px;
  color: #444;

  @media screen and (max-width: 600px) {
    font-size: 3rem;
  }
`,w5e=Un.img`
  width: 100%;
  height: 100%;
  object-fit: contain;
`,x5e=Un.div`
  display: inline-block;
  position: relative;
  border: 6px solid #444;
  border-radius: 50%;
  width: 80px;
  height: 80px;
  box-sizing: content-box;

  &::after {
    content: "";
    width: 84px;
    height: 6px;
    position: absolute;
    left: 50%;
    top: 50%;
    background-color: #444;
    transform: translate(-50%, -50%) rotate(45deg);
  }
`;function S5e(){const{paused:n,containerRef:e}=Nr(),{next:t,prev:i,activeIndex:r,setActiveIndex:s,tools:o,setDirection:a}=kf(),{size:l,gl:c}=Bt(),{active:g,setActive:u}=b5e(850),d=M.useRef(!1),h=screen.width*.05,f=screen.width*.08,I=screen.height*.5,A=M.useRef(!1);Fee({onStart:y=>{let{e:v,touch:b}=y;A.current=!1;const w=Math.min(b.clientX,l.width-b.clientX)<h,G=b.clientY<I;!w||!G||(A.current=!0,d.current=!1,v.preventDefault(),v.stopPropagation(),v.stopImmediatePropagation())},onMove:y=>{let{delta:v}=y;!A.current||d.current||Math.abs(v.x)>f&&(d.current=!0,v.x>0?(u(),t()):(u(),i()))}},c.domElement,[screen.width,screen.height,t,i]),M.useEffect(()=>{const y=v=>{eTe()||v.metaKey||v.ctrlKey||n||v.key=="Tab"&&(v.shiftKey?(a("left"),u(),s(r===void 0?o.length-1:r===0?void 0:(r-1+o.length)%o.length)):(a("right"),u(),r===void 0?s(0):r===o.length-1?s(void 0):s((r+1)%o.length)),v.preventDefault())};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[r,n,s,a,u,o]);const p=M.useCallback(y=>{u(),s(y)},[s,u]);return L.createElement(kde,null,B_.createPortal(L.createElement(B5e,{open:g},L.createElement(wP,{title:"None",active:r===void 0,onClick:()=>p(void 0)},L.createElement(x5e,null)),o.map((y,v)=>L.createElement(wP,{key:`${y.name}-${v}`,title:y.name,active:r===v,onClick:()=>p(v)},y.icon?L.createElement(w5e,{src:y.icon}):L.createElement(G5e,{perc:new Gd().updateFromText(y.name).mediation},y.name.substring(0,1))))),e.current))}function R5e(){return L.createElement("group",{name:"lights"},L.createElement("ambientLight",{intensity:Math.PI*.5}),L.createElement("pointLight",{intensity:Math.PI*.5}))}function Z5e(n){const{enabled:e=!0,directional:t}=n,{scene:i}=Bt(),r=M.useRef(null),s=kf(),o=R5(),a=M.useRef([]),l=M.useRef([]);return Ec(1/2,()=>{const c=[];i.traverse(u=>{u instanceof Y6&&(!t||u instanceof wZe)&&c.push(u)});let g=!1;for(const u of c)if(!l.current.find(d=>d.userData.uuid===u.uuid)){const d=u.clone();d.userData.uuid=u.uuid,l.current.push(d),g=!0}for(const u of l.current)c.find(d=>d.uuid===u.userData.uuid)||(l.current.splice(l.current.indexOf(u),1),u.dispose(),g=!0);g&&(o(),a.current=c)}),Ec(30,c=>{let{camera:g}=c;!e||!r.current||(r.current.position.copy(g.position),l.current.forEach(u=>{const d=a.current.find(h=>h.uuid===u.userData.uuid);d&&u.matrixWorld.copy(d.matrixWorld)}))}),L.createElement(L.Fragment,null,yd(L.createElement("group",{name:"world-lights",ref:r},l.current.map(c=>L.createElement("primitive",{object:c,key:c.uuid}))),s.hudScene))}function M5e(n){const{children:e,showOnSpawn:t=!0,worldLights:i=!0,localLights:r=!0}=n,{camera:s}=Bt(),o=v5e(t),{hudScene:a}=o,[l]=M.useState(()=>s.clone());return yn(c=>{let{gl:g}=c;const u=s;l.position.set(0,0,0),l.quaternion.copy(u.quaternion),l.near=u.near,l.far=u.far,l.aspect=u.aspect,l.fov=u.fov,l.updateProjectionMatrix(),a.position.set(0,0,0),g.autoClear=!1,g.clearDepth(),g.render(a,l),a.position.copy(s.position),a.updateMatrixWorld(!0)},100),L.createElement(kee.Provider,{value:o},L.createElement(S5e,null),r&&yd(L.createElement(R5e,null),a),i&&L.createElement(Z5e,null),e)}const xP=new Ns;class E5e{constructor(e,t){e===void 0&&(e=5),t===void 0&&(t=30),this.velocity=new Float32Array(4),this.stiffness=t,this.damping=e}_velLenSqr(){return this.velocity[0]**2+this.velocity[1]**2+this.velocity[2]**2+this.velocity[3]**2}oscillationStep(e,t,i){const r=e.dot(t);if(r>=.9999&&this._velLenSqr()<1e-6){e.copy(t);return}const s=xP;r<0?(s.x=-t.x,s.y=-t.y,s.z=-t.z,s.w=-t.w):s.copy(t),this.velocity[0]+=(-this.stiffness*(e.x-s.x)-this.damping*this.velocity[0])*i,this.velocity[1]+=(-this.stiffness*(e.y-s.y)-this.damping*this.velocity[1])*i,this.velocity[2]+=(-this.stiffness*(e.z-s.z)-this.damping*this.velocity[2])*i,this.velocity[3]+=(-this.stiffness*(e.w-s.w)-this.damping*this.velocity[3])*i,e.x+=this.velocity[0]*i,e.y+=this.velocity[1]*i,e.z+=this.velocity[2]*i,e.w+=this.velocity[3]*i,e.normalize()}criticallyStep(e,t,i){const r=e.dot(t);if(r>=.9999&&this._velLenSqr()<1e-6){e.copy(t);return}const s=xP;r<0?(s.x=-t.x,s.y=-t.y,s.z=-t.z,s.w=-t.w):s.copy(t);const o=this.damping*this.damping*i,a=1+this.damping*i,l=a*a;return this.velocity[0]=(this.velocity[0]-(e.x-s.x)*o)/l,this.velocity[1]=(this.velocity[1]-(e.y-s.y)*o)/l,this.velocity[2]=(this.velocity[2]-(e.z-s.z)*o)/l,this.velocity[3]=(this.velocity[3]-(e.w-s.w)*o)/l,e.x+=this.velocity[0]*i,e.y+=this.velocity[1]*i,e.z+=this.velocity[2]*i,e.w+=this.velocity[3]*i,e.normalize(),e}}function W5e(n){const{children:e,pos:t,pinY:i=!1,distance:r,range:s=0,bobStrength:o}=n,{velocity:a}=S5(),l=1e-4,c=M.useRef(null),[g]=M.useState(new mn),[u]=M.useState(new mn().fromArray(t)),[d]=M.useState(new Ns),[h]=M.useState(new Ns),[f]=M.useState(new Ns),[I]=M.useState(new Jg(0,0,0,"YXZ")),[A]=M.useState(new Jg(0,0,0,"YXZ")),[p]=M.useState(new Ns),[y]=M.useState(new Ns),[v]=M.useState(new mn),[b,w]=Tc(()=>({offset:[0,0],config:xv.stiff})),G=M.useMemo(()=>new E5e(50,100),[]);return yn((x,B)=>{let{camera:R,clock:Z}=x;if(!c.current)return;const W=1-Math.pow(l,B),F=b.offset.get();g.fromArray(t),g.x+=F[0]||0,g.y+=F[1]||0,u.lerp(g,W),Gh(u,R,r,v),c.current.position.set(v.x,v.y,-r),p.copy(f),y.copy(R.quaternion),A.setFromQuaternion(R.quaternion);let T=p.multiply(y.invert()).y/(B||1e-5),V=(A.x-I.x)/(B||1e-5);if(!(s>0))d.copy(R.quaternion);else{p.copy(d),p.x=0,p.z=0,p.normalize(),y.copy(R.quaternion),y.x=0,y.z=0,y.normalize();const P=p.angleTo(y);if(P>s){const ne=P-s;h.copy(d),h.rotateTowards(R.quaternion,ne),i||(h.x=0,h.z=0,h.normalize())}else V=0,T=0;G.criticallyStep(d,h,B)}const U=a.get().length()>1?1:0,J=o||Math.max(u.length(),.05);V+=Math.sin(Z.elapsedTime*15)*U*.2*J,T+=Math.cos(Z.elapsedTime*20+12)*U*.1*J;const H=.1,Y=.3,K=xA.clamp(-T*H,-Y,Y),Q=xA.clamp(-V*H,-Y,Y);w({offset:[K,Q]}),c.current.position.applyQuaternion(d),c.current.quaternion.copy(R.quaternion),f.copy(R.quaternion),I.setFromQuaternion(R.quaternion)}),L.createElement("group",{name:"spacesvr-hud",ref:c},e)}function F5e(n){const{set:e,distance:t,enabled:i,children:r}=n,s=kf(),{size:o,gl:a}=Bt(),{device:l}=Nr(),{raycaster:c}=S5(),g=M.useRef(null),u=o.height*.28,d=o.width*.3,h=M.useRef(!1);return Fee({onStart:f=>{let{e:I}=f;if(h.current=!1,!g.current||!l.mobile||!i)return;c.intersectObject(g.current,!0).length>0&&(h.current=!0,I.stopPropagation())},onMove:f=>{let{delta:I}=f;h.current&&e({pos:[I.x*.003*t*.7,-I.y*.003*t*(I.y<0?.15:.5),0]})},onEnd:f=>{let{delta:I}=f;h.current&&(I.y>u?s.hide():Math.abs(I.x)>d&&(I.x>0?s.next():s.prev()),e({pos:[0,0,0]}),h.current=!1)}},a.domElement,[l.mobile,i,s.hide,s.next,s.prev]),L.createElement("group",{ref:g},r)}function _5e(n){const{distance:e,name:t,pos:i,disableDraggable:r,children:s}=n,o=kf(),a=Bt(f=>f.camera),l=o.tools.find(f=>f.name==t),c=l?o.tools.indexOf(l):void 0,g=o.activeIndex===c,[u,d]=Tc(()=>({pos:[0,0,0],config:{mass:4,friction:90,tension:800}})),h=M.useRef();return M.useEffect(()=>{if(h.current===o.activeIndex||(h.current=o.activeIndex,c===void 0))return;const f=a,I=1.5;if(g){if(o.direction!=="up"){const{x:A}=Gh([-I,0],f,e),{x:p}=Gh([I,0],f,e),{x:y}=Gh(i,f,e),v=o.direction==="left"?p-y:A+y;u.pos.update({immediate:!0}),d({pos:[v,0,e]}),u.pos.finish(),u.pos.update({immediate:!1})}d({pos:[0,0,0]})}else{const{x:A}=Gh([-I,0],f,e*2),{x:p}=Gh([I,0],f,e*2),{x:y}=Gh(i,f,e),v=(o.direction==="left"?A:p)-y;d({pos:[v,0,0]})}},[g,c,a,e,i,d,u.pos,o.activeIndex,o.activeTool,o.direction]),L.createElement(_g.group,{position:u.pos,name:"onscreen"},L.createElement(F5e,{set:d,distance:e,enabled:g&&!r},s))}function V5e(n){const{children:e,enabled:t=!0,lockX:i=!1,lockY:r=!1,lockZ:s=!1}=n,o=M.useRef(null),[a]=M.useState(new Jg);return Ec(50,l=>{let{camera:c}=l;o.current&&(t?(a.copy(o.current.rotation),o.current.lookAt(c.position),i&&(o.current.rotation.x=a.x),r&&(o.current.rotation.y=a.y),s&&(o.current.rotation.z=a.z)):o.current.rotation.set(0,0,0))}),L.createElement("group",{name:"spacesvr-faceplayer",ref:o},e)}function T5e(n){const{didMount:e,setMounted:t}=n;return e.current=!0,M.useEffect(()=>()=>{t(!0)},[]),null}function N5e(n){const{setPreloadDone:e,children:t}=n,i=Bt(u=>{let{gl:d}=u;return d}),r=Bt(u=>{let{camera:d}=u;return d}),{hudScene:s}=kf(),o=M.useRef(!1),[a,l]=M.useState(!0),[c,g]=M.useState(!1);return M.useEffect(()=>{if(a){l(!1);return}o.current||g(!0)},[a]),M.useLayoutEffect(()=>{if(!c)return;i.compile(s,r);const u=new dZe(128);new H6(.01,1e5,u).update(i,s),u.dispose(),e(!0)},[r,i,s,c,e]),yd(L.createElement("group",{name:"tool-preload"},L.createElement(M.Suspense,{fallback:L.createElement(T5e,{didMount:o,setMounted:g})},t)),s)}function k5e(n){const{children:e,name:t,icon:i,pos:r=[0,0],face:s=!0,pinY:o=!1,range:a,bobStrength:l,orderIndex:c,disableDraggable:g=!1,onSwitch:u}=n,{grant:d,revoke:h,activeTool:f,hudScene:I}=kf(),A=(f==null?void 0:f.name)===t,p=1,[y,v]=M.useState(!1),{prog:b}=Tc({prog:A?1:0,config:{mass:4,friction:90,tension:800}}),w=l5e(b);return M.useEffect(()=>(d(t,i,c),()=>h(t)),[t,i,d,h,c]),M.useEffect(()=>{u&&u((f==null?void 0:f.name)===t)},[f,u,t]),y?w?L.createElement(L.Fragment,null,yd(L.createElement("group",{name:`tool-${t}`},L.createElement(W5e,{pos:r,pinY:o,distance:p,range:a,bobStrength:l},L.createElement(_5e,{distance:p,name:t,pos:r,disableDraggable:g},L.createElement(V5e,{enabled:s},L.createElement(M.Suspense,{fallback:null},w&&e))))),I)):null:L.createElement(N5e,{setPreloadDone:v},e)}function L5e(n){const{children:e,xSpeed:t=0,ySpeed:i=1,zSpeed:r=0}=n,s=M.useRef(null),[o]=M.useState(Math.random());return Ec(75,a=>{let{clock:l}=a;s.current&&(s.current.rotation.x=l.elapsedTime*t*.25+t*o*100,s.current.rotation.y=l.elapsedTime*i*(.25+o/10)+i*o*1e3,s.current.rotation.z=l.elapsedTime*r*.25+r*o*40)}),L.createElement("group",{name:"spacesvr-spinning",ref:s},e)}function H5e(n){const{children:e}=n;M.useMemo(()=>Zd({EffectComposer:CIe,RenderPass:pIe,ShaderPass:P3}),[]);const t=M.useRef(null),{scene:i,camera:r,gl:s,size:o,viewport:a}=Bt(),[l]=M.useState(()=>{const g=new _6(o.width,o.height,{type:oc,format:Yh,encoding:s.outputEncoding,depthBuffer:!0,stencilBuffer:!0,anisotropy:2});return g.samples=4,g});M.useEffect(()=>{var g,u;(g=t.current)==null||g.setSize(o.width,o.height),(u=t.current)==null||u.setPixelRatio(a.dpr)},[s,o,a.dpr]),yn(()=>{var g;t.current&&(t.current.passes=t.current.passes.filter(u=>u!==void 0),(g=t.current)==null||g.render())},1);const c=[];return c.push(L.createElement("renderPass",{key:"renderpass",attach:`passes-${c.length}`,args:[i,r]})),M.Children.forEach(e,g=>{g&&c.push(M.cloneElement(g,{key:c.length,attach:`passes-${c.length}`}))}),L.createElement("effectComposer",{ref:t,args:[s,l]},c)}const z5e=M.createContext({});function X5e(n){const{children:e}=n,{scene:t,camera:i,gl:r}=Bt(),{device:s}=Nr(),o=M.useRef([]),a=R5(),l=M.useCallback(u=>{o.current.push(u),o.current.sort((d,h)=>d.index-h.index),a()},[]),c=M.useCallback(u=>{o.current=o.current.filter(d=>d.uuid!==u),a()},[]),g=o.current.length>0&&!s.xr;return yn(()=>{g||(r.autoClear=!0,r.render(t,i))},1),L.createElement(z5e.Provider,{value:{registerPass:l,unregisterPass:c}},g&&L.createElement(H5e,null,o.current.map(u=>u.node)),e)}const ow=M.forwardRef((n,e)=>{const{args:t,visible:i=!1,color:r="red",onClick:s,onHover:o,onUnHover:a,raycaster:l,...c}=n;return L.createElement(y5e,{onClick:s,onHover:o,onUnHover:a,raycaster:l},L.createElement("mesh",pt({visible:i,name:"spacesvr-hitbox",ref:e},c),L.createElement("boxGeometry",{args:t}),i&&L.createElement("meshBasicMaterial",{color:r,transparent:!0,opacity:.7})))}),SP=[];function bf(n){const{args:[e=1,t=1,i=.25]=[],material:r,children:s,...o}=n,[a,l]=M.useState(new Ve(1,1,1)),c=M.useMemo(()=>{var g,u,d,h;let I,A=1/0;for(const x of SP){const B=x.width/e,R=Math.abs(x.height-t*B),Z=Math.abs(x.depth-i*B);R/x.height<.25&&Z/x.depth<.25&&R+Z<A&&(I=x,A=R+Z)}const p=((g=I)==null?void 0:g.key)??`geo_rounded_box_${e}x${t}x${i}`,y=((u=I)==null?void 0:u.width)??e,v=((d=I)==null?void 0:d.height)??t,b=((h=I)==null?void 0:h.depth)??i,w=Math.min(y,v,b)/2,G=()=>Hx.getResource(p,()=>new $_e(e,t,i,4,w));return I||SP.push({key:p,width:e,height:t,depth:i}),l(new Ve(e/y,t/v,i/b)),G()},[e,t,i]);return L.createElement("group",pt({name:"spacesvr-rounded-box"},o),L.createElement("mesh",{scale:a,material:r,geometry:c},s))}new mn;function Y5e(n){const{children:e,onClick:t,font:i="https://d27rt3a60hh1lx.cloudfront.net/fonts/Quicksand_Bold.otf",fontSize:r=.05,width:s,maxWidth:o,textColor:a="black",color:l="#fff",outline:c=!0,outlineColor:g="white",idea:u,raycaster:d,...h}=n,f=M.useRef(),[I,A]=M.useState([0,0]),[p,y]=M.useState(!1),[v,b]=M.useState(!1),w=M.useMemo(()=>u?u.getHex():l,[l,u]),G=M.useMemo(()=>{const U=u?u.clone():new Gd().setFromHex("#"+new zs(w).getHexString()),J=.175*(U.utility>.5?-1:1);return U.setUtility(U.utility+J),U.getHex()},[w,u]),{animColor:x,scale:B}=Tc({animColor:p?G:w,scale:v?.75:1,...xv.stiff});M.useEffect(()=>{v&&setTimeout(()=>b(!1),150)},[v]);const R=()=>{t&&t(),b(!0)};M.useLayoutEffect(()=>{f.current.addEventListener("synccomplete",()=>{var U;const J=(U=f.current)==null?void 0:U.textRenderInfo;if(!J)return;const H=J.blockBounds[2]-J.blockBounds[0],Y=J.blockBounds[3]-J.blockBounds[1];A([H,Y])}),f.current.sync()},[]);const Z=r*.9,W=o?s?Math.max(s,o):o:1/0,F=(s||I[0])+Z*2,T=I[1]+Z,V=r*1.1,z=c?r*.075:0;return L.createElement("group",pt({name:`spacesvr-button-${e}`},h),L.createElement(_g.group,{scale:B},L.createElement(mf,{ref:f,color:a,font:i,fontSize:r,maxWidth:W,outlineWidth:z,outlineColor:g,anchorY:"middle",textAlign:"center","position-z":V/2+.001,renderOrder:2},e),L.createElement(ow,{args:[F,T,V],onClick:R,onHover:()=>y(!0),onUnHover:()=>y(!1),raycaster:d}),L.createElement(bf,{args:[F,T,V]},L.createElement(_g.meshStandardMaterial,{color:x}))))}function K5e(n){const{value:e,onChange:t,raycaster:i,...r}=n,[s,o]=M.useState(!1),a=e??s,l=w=>{t&&t(w),o(w)},c=.075,g=c*.05,u=2.5*c,d=c*.75,h=u*.1,f=u+g*2,I=d+g,A=c*.8,{posX:p,knobColor:y}=Tc({posX:a?u/2:-u/2,knobColor:a?"#417E25":"#828282",config:{mass:.1}}),[v]=M.useState(new Gd(0,0,1)),[b]=M.useState(new Gd(0,0,.75));return L.createElement("group",pt({name:"spacesvr-switch-input"},r),L.createElement(_g.group,{"position-x":p},L.createElement(LVe,{scale:A,idea:a?v:b})),L.createElement(ow,{args:[A,A,A],onClick:()=>l(!a),"position-x":a?u/2:-u/2,raycaster:i}),L.createElement(ow,{args:[f,I,h],onClick:()=>l(!a),raycaster:i}),L.createElement(bf,{args:[u,d,h]},L.createElement(_g.meshBasicMaterial,{color:y})),L.createElement(bf,{args:[f,I,h],material:Hx.mat_basic_gray,"position-z":-.001}))}const Hee=M.createContext({}),zx=()=>M.useContext(Hee),D5e=()=>{const n=Bt(e=>e.camera);return M.useMemo(()=>{const e=new RZe;return n.add(e),e},[n])},P5e=()=>M.useMemo(()=>{const n=new gs;return n.matrixAutoUpdate=!1,n},[]),U5e=()=>{const{connections:n,connected:e,mediaConnections:t}=zx(),{paused:i}=Nr(),r=D5e(),[s,o]=M.useState(0),a=()=>o(Math.random()),[l,c]=M.useState(!0);M.useEffect(()=>c(i&&l),[i,l]);const g=M.useMemo(()=>[],[]),u=d=>t.has(d.id)&&!d.posAudio;return Ec(3,()=>{if(!e)return;let d=!1;g.map(h=>{n.has(h.id)||(h.posAudio&&(h.posAudio.remove(),h.posAudio=void 0),g.splice(g.indexOf(h),1),d=!0)});for(const h of Array.from(n.keys()))g.some(f=>f.id===h)||(g.push({id:h,posAudio:void 0}),d=!0);l||(g.map(h=>{if(!t.has(h.id)){var f;(f=h.posAudio)==null||f.remove(),h.posAudio=void 0,d=!0}}),g.filter(u).map(h=>{const f=t.get(h.id);if(!f||!f.remoteStream)return;console.log("adding audio for",h.id);const I=document.createElement("audio");I.srcObject=f.remoteStream,I.muted=!0,I.autoplay=!0,I.loop=!0,I.playsInline=!0;const A=new EZe(r);A.userData.peerId=h.id,A.setMediaStreamSource(I.srcObject),A.setRefDistance(2),A.setDirectionalCone(200,290,.35),h.posAudio=A,d=!0})),d&&a()}),g};function Q5e(){const{connected:n,useChannel:e}=zx(),t=M.useRef(null),i=M.useMemo(()=>new PT(.3,.3,1,32),[]),r=M.useMemo(()=>new pZe,[]),s=P5e(),o=U5e(),a=12,l=M.useMemo(()=>new H$.SnapshotInterpolation(a),[]),c=e("player","stream",(g,u)=>{if(!g.conn)return;u[g.conn.peer]=g.data;const d=Object.keys(u).map(h=>({id:h,x:u[h].pos[0],y:u[h].pos[1],z:u[h].pos[2],q:{x:u[h].rot[0],y:u[h].rot[1],z:u[h].rot[2],w:u[h].rot[3]}}));l.vault.add({id:Math.random().toString(),time:new Date().getTime(),state:d})});return Ec(a,g=>{let{camera:u}=g;n&&c.send({pos:u.position.toArray(),rot:u.quaternion.toArray()})}),Ec(55,()=>{if(!t.current)return;const g=l.calcInterpolation("x y z q(quat)");if(!g)return;let u=0;for(const h of g.state){var d;const{x:f,y:I,z:A,q:p}=h;s.position.set(f,I,A),s.position.y-=.2;const y=p;s.quaternion.set(y.x,y.y,y.z,y.w),s.updateMatrix(),t.current.setMatrixAt(u,s.matrix);const v=(d=o[u])==null?void 0:d.posAudio;v&&(s.matrix.decompose(v.position,v.quaternion,v.scale),v.rotation.y+=Math.PI,v.updateMatrix()),u++}t.current.instanceMatrix.needsUpdate=!0}),n?L.createElement("group",{name:"spacesvr-entities"},o.map(g=>g.posAudio&&L.createElement("primitive",{key:g.posAudio.uuid,object:g.posAudio,matrixAutoUpdate:!1})),L.createElement("instancedMesh",{ref:t,args:[i,r,o.length],matrixAutoUpdate:!1})):null}const O5e=function(n){return n===void 0&&(n=window.location.hostname),["localhost","127.0.0.1","","::1"].includes(n)||n.startsWith("192.168.")||n.startsWith("10.0.")||n.endsWith(".local")},RP="spacesvr-local-signalling",J5e=1.25;class j5e{constructor(e){console.info("using local signaller"),e.id&&(this.peerId=e.id)}readStore(){const e=localStorage.getItem(RP);if(!e)return[];try{return JSON.parse(e)}catch{return[]}}writeStore(e){localStorage.setItem(RP,JSON.stringify(e))}cleanStore(){const e=this.readStore(),t=new Date().getTime(),i=e.filter(r=>{const s=t-r.last_seen<=J5e*60*1e3;return s||console.info("removing local peer with id ",r.id),s});this.writeStore(i)}async join(){if(!this.peerId){console.error("peer id not established, aborting signal");return}this.cleanStore(),console.info("local network detected, signalling with localStorage");const e={id:this.peerId,last_seen:new Date().getTime()},t=this.readStore();return t.push(e),this.writeStore(t),t.map(i=>i.id)}async leave(){if(!this.peerId){console.error("peer id not established, aborting signal");return}console.info("updating local signal list to remove self");const e=this.readStore(),t=e.findIndex(i=>i.id===this.peerId);t<0?console.error("peer not in local signal list, aborting ..."):(e.splice(t,1),this.writeStore(e))}async wave(){if(!this.peerId)return console.error("peer id not established, wave failed"),!1;const e=this.readStore();let t=!1;return e.map(i=>{i.id===this.peerId&&(i.last_seen=new Date().getTime(),t=!0)}),this.writeStore(e),t}}class q5e{constructor(e,t){t===void 0&&(t={}),console.info("using muse signaller"),t.sessionId?this.sessionId=t.sessionId:t.worldName?this.worldName=t.worldName:this.worldName=window.location.pathname,this.host=t.host||"https://muse-web.onrender.com",t.sessionPassword&&(this.sessionPassword=t.sessionPassword),e.id&&(this.peerId=e.id)}async callBackend(e,t){return await fetch(`${this.host}/sessions/${e}`,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})}async join(){if(!this.peerId){console.error("peer id not established, aborting signal");return}const e={peer_id:this.peerId};this.sessionId?e.session_id=this.sessionId:e.world=this.worldName,this.sessionPassword&&(e.password=this.sessionPassword);const t=await this.callBackend("join",e);let i=await t.json();if(t.status!==200){i=i,console.error("failed to signal: ",i.message);return}return i=i,this.sessionId=i.session_id,i.peer_ids}async leave(){if(!this.sessionId||!this.peerId){console.error("no session id / peer id, can't leave");return}const e={peer_id:this.peerId,session_id:this.sessionId},t=await this.callBackend("leave",e);if(t.status!==200){const i=await t.json();console.error("leave failed ... ",i.message)}}async wave(){if(!this.sessionId||!this.peerId)return console.error("no session id / peer id, can't wave"),!1;const e={peer_id:this.peerId,session_id:this.sessionId},t=await this.callBackend("wave",e);if(t.status!==200){const i=await t.json();return console.error("wave check failed ... ",i.message),!1}return!0}}const ZP=4,$5e=(n,e,t)=>{const i=M.useRef(0),r=iw(1/(n*60)),s=iw(1/10);yn(o=>{let{clock:a}=o;!e||i.current>ZP||!(i.current>0?s:r).isReady(a)||e.wave().then(c=>{c?i.current=0:i.current+=1,i.current>ZP&&(console.error("too many failed waves, disconnecting ..."),t())})})};class MP{constructor(e,t,i){this.id=e,this.reducer=t,this.connections=i,this.state={}}send(e){for(const[,t]of this.connections.entries())t.open&&t.send({id:this.id,data:e})}receive(e){this.reducer(e,this.state)}}class EP{constructor(e,t,i){this.id=e,this.reducer=t,this.initTime=new Date().getTime(),this.connections=i,this.state={}}send(e){for(const[,t]of this.connections.entries())t.open&&t.send({id:this.id,data:e});this.reducer({id:this.id,data:e},this.state)}receive(e){e.greet?e.time&&e.state&&e.time<this.initTime&&(this.state=e.state,this.initTime=e.time-50):this.reducer(e,this.state)}greet(e){e.send({id:this.id,time:this.initTime,state:this.state,greet:!0})}}const eNe=n=>{const e=M.useMemo(()=>new Map,[]);return{receive:s=>{for(const[o,a]of e.entries())o==s.id&&a.receive(s)},greet:s=>{for(const[,o]of e.entries())o instanceof EP&&o.greet(s)},useChannel:(s,o,a)=>{const l=M.useMemo(()=>o==="stream"?new MP(s,a,n):o==="sync"?new EP(s,a,n):new MP(s,a,n),[s,o]);return M.useEffect(()=>{l.reducer=a},[l,a]),M.useEffect(()=>{if(e.has(l.id))throw new Error(`id '${l.id}' has been taken, can't register channel ...`);return e.set(l.id,l),()=>{e.has(l.id)&&e.delete(l.id)}},[l]),l}}},tNe=function(n,e){n===void 0&&(n=!0);const{paused:t}=Nr(),[i,r]=M.useState(!0);M.useEffect(()=>r(t&&i),[t,i]);function s(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const[o,a]=M.useState();return M.useEffect(()=>{var l;!n||s()&&i||(l=navigator.mediaDevices)==null||l.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,...e?{deviceId:e}:{}}}).then(c=>{a(c)}).catch(c=>{console.error(c)})},[n,i,e]),o},nNe=(n,e,t,i)=>{const r=M.useMemo(()=>new Map,[]),s=tNe(n,i);return M.useEffect(()=>{if(!e||!s||!n)return;const o=c=>{console.log("media connection opened with peer",c.peer),c.answer(s),r.set(c.peer,c),c.on("close",()=>{console.log("closing voice stream with peer",c.peer),r.delete(c.peer)}),c.on("error",g=>{console.error("error with voice stream with peer",c.peer,g),r.delete(c.peer)})},a=c=>{console.log("calling peer with id",c.peer),o(e.call(c.peer,s)),c.on("close",()=>{console.log("closing voice stream with peer",c.peer),r.delete(c.peer)})},l=c=>{c.on("open",()=>a(c))};e.on("call",o),e.on("connection",l);for(const[c,g]of t){if(r.has(c))return;a(g)}return()=>{e.removeListener("call",o),e.removeListener("connection",a)}},[t,e,s,r,n]),M.useEffect(()=>{n||r.forEach(o=>{o.close(),r.delete(o.peer)})},[n,r]),{mediaConnections:r,localStream:s}},SF="spacesvr-ice-servers",iNe=24*60*60*1e3,rNe=n=>{const e={iceServers:n,time:new Date().getTime()};localStorage.setItem(SF,JSON.stringify(e))},sNe=()=>{const n=localStorage.getItem(SF);if(n)try{const e=JSON.parse(n);if(new Date().getTime()-e.time>iNe){localStorage.removeItem(SF);return}return e.iceServers}catch{return}},oNe=async function(n){n===void 0&&(n="https://muse-web.onrender.com");const e=sNe();if(e)return e;try{const r=(await(await fetch(`${n}/sessions/get_ice`)).json()).iceServers;return rNe(r),r}catch(t){console.error("failed to fetch ice servers",t);return}},aNe=n=>{const[e,t]=M.useState(!1),[i,r]=M.useState(),s=M.useMemo(()=>new Map,[]),[o,a]=M.useState(),l=eNe(s),c=y=>{y.on("open",()=>{console.log("connection opened with peer",y.peer),y.on("data",v=>l.receive({conn:y,...v})),y.on("close",()=>{console.log("connection closed with peer"),s.delete(y.peer)}),y.on("error",()=>{console.log("connection closed with peer"),s.delete(y.peer)}),l.greet(y),s.set(y.peer,y)})},g=async y=>{if(console.log("connecting to network"),i){console.error("peer already created, aborting");return}if(e){console.error("already connected, aborting");return}const v={...n,...y};if(!v.iceServers){const G=await oNe(v.host);G&&(v.iceServers=G)}const b={};v.iceServers&&(b.iceServers=v.iceServers);const w=new bF({config:b});w.on("connection",c),w.on("close",u),w.on("error",G=>{if(G.message.includes("Could not connect to peer")){const x=G.message.split(" "),B=x[x.length-1];console.error(`could not establish connection to peer ${B}`)}else console.error(G)}),w.on("open",async()=>{t(!0);const G=O5e()&&!v.host?new j5e(w):new q5e(w,v),x=await G.join();console.log("found peers:",x),x&&(x.map(B=>{if(B===w.id)return;const R=w.connect(B);c(R)}),r(w),a(G))})},u=()=>{if(console.log("disconnecting from network"),!e){console.error("not connected, no need to disconnect");return}if(!i){console.error("peer doesn't exist, no need to disconnect");return}i.disconnected||i.disconnect(),o&&o.leave(),s.forEach(y=>y.close()),i.destroy(),t(!1),r(void 0)};$5e(1,o,u);const[d,h]=M.useState(!!n.voice),[f,I]=M.useState();M.useEffect(()=>h(!!n.voice),[n.voice]);const{mediaConnections:A,localStream:p}=nNe(d,i,s,f);return{connected:e,connect:g,disconnect:u,connections:s,useChannel:l.useChannel,voice:d,setVoice:h,localStream:p,mediaConnections:A,setInputDevice:I}},lNe=(n,e,t)=>{const{time:i=!0,...r}=n,s=M.useMemo(()=>{const o=new Hu({side:Bx,...r});return o.onBeforeCompile=function(a){a.uniforms.time=new zu(0);const l=`
        varying vec2 vUv;
        varying vec3 vNorm;
        varying vec3 vPos;
        uniform float time;
      `,c=`
        vUv = uv;
        vPos = (modelMatrix * vec4(transformed, 1.0)).xyz;
      `;a.vertexShader=l+a.vertexShader.replace("#include <worldpos_vertex>",e+c+`
#include <worldpos_vertex>
`),a.vertexShader=a.vertexShader.replace("#include <begin_vertex>",`#include <begin_vertex>
vNorm = normal;
`),a.fragmentShader=l+a.fragmentShader.replace("#include <emissivemap_fragment>",`#include <emissivemap_fragment>
`+t),o.userData.shader=a},o.customProgramCacheKey=()=>t+e+JSON.stringify(r),o},[t,r,i,e]);return Ec(70,o=>{var a,l;let{clock:c}=o;!i||!((a=s.userData.shader)!=null&&(l=a.uniforms)!=null&&l.time)||(s.userData.shader.uniforms.time.value=c.elapsedTime)}),s},cNe=`
`,gNe="vec3(0.6)",uNe=`
    diffuseColor.rgb = ${gNe};
    
    // apply grip
    float radius = 0.25;
    vec2 l = (fract((vUv - vec2(0.21, 0.)) * vec2(9., 0.)) - vec2(0.5, 0.));
    float blur = 5.;
    float circle_mask = 1.0 - smoothstep(radius - (radius * blur),radius + (radius * blur),dot(l,l) * 2.0);
    float side_mask = pow(abs(dot(vNorm, vec3(1.0, 0.0, 0.0))), 0.9);
    float up_mask = 0.2 * pow(dot(vNorm, vec3(0.0, 1.0, 0.0)), 1.);
    float grip_mask = min(1., (side_mask + up_mask)) * circle_mask;
    diffuseColor.rgb *= clamp(1. - (0.8 * grip_mask), 0., 1.);
    
    // apply speaker and mic
    // create mask for facing the camera
    float facing_mask = pow(clamp(dot(vNorm, vec3(0., 0., 1.0)), 0., 1.), 2000.);
    // create a mask for the bottom of the phone
    float bottom_mask = smoothstep(0.0, 0.2, abs(vUv.y + 0.1));
    float speaker_mask = facing_mask * bottom_mask;
    // diffuseColor.rgb = mix(diffuseColor.rgb, vec3(0.9), speaker_mask);
`;function dNe(n){const{width:e,height:t,depth:i}=n,r=lNe({color:"#cbcbcb"},cNe,uNe),s=e*.22,o=t*.45;return L.createElement("group",{name:"model"},L.createElement(bf,{args:[e,t,i],material:r}),L.createElement(bf,{args:[s,o,i],material:r,"position-x":-e/2+s/2,"position-y":t/2}))}function hNe(n){const{width:e,height:t,children:i,...r}=n,s=.0075;return L.createElement("group",pt({name:"pane"},r),L.createElement("mesh",{material:Hx.mat_standard_black},L.createElement("planeGeometry",{args:[e+s*2,t+s*2]})),L.createElement("mesh",{"position-z":.001},L.createElement("planeGeometry",{args:[e,t]}),L.createElement("meshStandardMaterial",{color:"#20C20E"})),L.createElement("group",{name:"content","position-z":.002},i))}function fNe(n){const{onClick:e,width:t,children:i,index:r,...s}=n,[o,a]=M.useState(!1),{color:l}=Tc({color:o?"#b3b3b3":"#ffffff"}),c=.015,g=.0125,u=.02,d=.01,h=r===0?t-c*4:t-c*2;return L.createElement("group",pt({name:"option"},s),L.createElement(bf,{args:[t,u+g*2,d]},L.createElement(_g.meshStandardMaterial,{color:l})),L.createElement(ow,{args:[t,u+g*2,d],onClick:e,onHover:()=>a(!0),onUnHover:()=>a(!1)}),L.createElement("group",{"position-z":d/2+.001},L.createElement(mf,{fontSize:u,color:"black",anchorX:"left","position-x":-t/2+c,maxWidth:t,whiteSpace:"nowrap",clipRect:[0,-1/0,h,1/0]},i)))}function INe(n){const{value:e,items:t,onChange:i,width:r=1,...s}=n,[o,a]=M.useState(!1),[l,c]=M.useState(!1),[g,u]=M.useState(0),d=t.find(v=>v.value==e)??t[g],h=v=>{const b=t.findIndex(w=>w.value==v);b!==-1&&(i&&i(t[b]),u(b))};M.useEffect(()=>{if(!d)return;const v=t.findIndex(b=>b.value===(d==null?void 0:d.value));v===-1||g===v||u(v)},[t,g,d]);const f=l?[...t].sort((v,b)=>v==d?-1:b==d?1:0):d?[d]:[],I=cfe(f,{keys:v=>v.value,trail:300/t.length,from:{scale:0,y:0},enter:(v,b)=>({scale:1,y:-.05*b}),update:(v,b)=>({scale:1,y:-.05*b}),leave:{scale:0,y:0},reset:o,onRest:()=>a(!1)}),{rot:A,posZ:p}=Tc({rot:l?Math.PI:0,posZ:l?.025:0}),y=v=>{l&&(h(v),a(!0)),c(!l)};return L.createElement("group",pt({name:"spacesvr-dropdown"},s),L.createElement(_g.group,{"position-z":p},I((v,b,w,G)=>{let{scale:x,y:B}=v;return L.createElement(_g.group,{scale:x,"position-y":B},L.createElement(fNe,{onClick:()=>y(b.value),width:r,index:G},b.text))}),t.length>1&&L.createElement(_g.group,{"rotation-z":A,"position-x":r/2-.03/2-.01,"position-z":.01/2+.001},L.createElement(BF,{src:"https://d27rt3a60hh1lx.cloudfront.net/icons/chevron-down.ktx2",scale:.03}))))}function ANe(n){const{localStream:e}=zx(),[t,i]=M.useState(),[r]=M.useState(document.createElement("canvas")),[s]=M.useState(new Uint8Array(128)),o=M.useRef(null);return M.useEffect(()=>{if(!e)return;const a=new(window.AudioContext||window.webkitAudioContext),l=a.createAnalyser();l.fftSize=128;const c=l.frequencyBinCount,g=new Uint8Array(c);l.getByteTimeDomainData(g),l.smoothingTimeConstant=.8,a.createMediaStreamSource(e).connect(l),i(l)},[e]),yn(()=>{const a=r.getContext("2d");if(!t||!a||!o.current)return;o.current.needsUpdate=!0,t.getByteFrequencyData(s),t.smoothingTimeConstant=.85,a.clearRect(0,0,r.width,r.height),a.fillStyle="rgb(0, 0, 0)";const l=6,c=4,g=20,u=r.width/l-c;let d=0;for(let h=0;h<l;h++){const I=(s[h]/256*.8+.2)*r.height;let A=0;for(;A<I;){const p=Math.min(A+g,I);a.fillRect(d,r.height-A,u,g),A=p+c}d+=u+c}}),e?L.createElement("group",pt({name:"voice-levels"},n),L.createElement("mesh",null,L.createElement("planeGeometry",{args:[.095,.075]}),L.createElement("meshStandardMaterial",{transparent:!0},L.createElement("canvasTexture",{ref:o,args:[r],attach:"map"})))):null}function CNe(n){const{width:e,...t}=n,i=.0225,r=.01,s=.0125,a=!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia?"this site cannot access your microphone":"give this site access to your microphone to talk!";return L.createElement("group",t,L.createElement(mf,{fontSize:i,color:"black","position-z":r/2+.001,maxWidth:e,textAlign:"center"},a),L.createElement(bf,{args:[e,i*2+s*4,r],material:Hx.mat_standard_white}))}function pNe(n){const{width:e,...t}=n,{localStream:i,setInputDevice:r}=zx(),[s,o]=M.useState([]),[a,l]=M.useState(),[c,g]=M.useState(!1),[u,d]=M.useState(!1),h=!!i,f=M.useCallback(()=>{var I;(I=navigator.mediaDevices)==null||I.enumerateDevices().then(A=>{A=A.filter(p=>p.kind==="audioinput"),A=A.filter((p,y)=>A.findIndex(v=>v.groupId===p.groupId)===y),o(A)})},[]);return M.useEffect(()=>{i&&f()},[i,f]),M.useEffect(()=>{navigator.mediaDevices&&(navigator.mediaDevices.ondevicechange=()=>f())},[f]),M.useEffect(()=>{const I=i==null?void 0:i.getTracks()[0].getSettings().deviceId;g(!!a&&a!==I)},[i,a]),M.useEffect(()=>{i&&(i.getAudioTracks()[0].enabled=!u)},[i,u]),L.createElement("group",pt({name:"mic-access"},t),L.createElement(hNe,{width:e,height:.1},L.createElement(BF,{src:u||!h?"https://d27rt3a60hh1lx.cloudfront.net/icons/microphone-off.ktx2":"https://d27rt3a60hh1lx.cloudfront.net/icons/microphone.ktx2",scale:.075,"position-x":-e/2+.075/2+.04}),L.createElement("group",{"position-x":e/2-.075/2-.04},c||!h&&L.createElement(L5e,{ySpeed:0,zSpeed:2},L.createElement(BF,{src:"https://d27rt3a60hh1lx.cloudfront.net/icons/loader.ktx2",scale:.075})),!c&&L.createElement(ANe,{"position-x":-.01})),h&&L.createElement("group",{"position-y":-.095},L.createElement(K5e,{value:u,onChange:d,scale:.4,"position-x":.07}),L.createElement(mf,{fontSize:.035,anchorX:"right","position-x":-.01,color:"black"},"mute")),h&&L.createElement(INe,{"position-y":-.15,value:i==null?void 0:i.getTracks()[0].getSettings().deviceId,items:s.map((I,A)=>({text:I.label||`microphone ${A}`,value:I.deviceId})),width:e,"position-z":0,onChange:I=>{r(I.value),l(I.value)}}),!h&&L.createElement(CNe,{"position-y":-.125,"position-z":.15,width:e})))}const mNe="https://d27rt3a60hh1lx.cloudfront.net/fonts/Quicksand_Bold.otf";function yNe(){const n="Walkie Talkie",e=kf(),{device:t}=Nr(),i=.5,r=.55,s=.1;return L.createElement(k5e,{name:n,pos:[0,0],range:t.mobile?0:.2,pinY:!0},L.createElement("group",{"position-y":-.05,scale:1.25},L.createElement(dNe,{width:i,height:r,depth:s}),L.createElement("group",{name:"content","position-z":.1/2+.001},L.createElement(pNe,{"position-y":.15,width:i*.65}),L.createElement(mf,{fontSize:.022,color:"black",font:mNe,maxWidth:i*.5,anchorY:"top","position-y":-.05,textAlign:"center",scale:1.1},`proximity voice chat is enabled in this world.

walk up to someone and say hello!`),L.createElement(Y5e,{onClick:()=>e.hide(),fontSize:.03,"position-y":-.21,"rotation-x":-.4,color:"#f2445e"},"close"))))}function vNe(n){const{children:e,disableEntities:t,autoconnect:i,...r}=n,s=aNe(r),{connected:o,connect:a,disconnect:l}=s;M.useEffect(()=>{i&&a()},[i]);const c=M.useRef(!1);return M.useEffect(()=>{c.current!==o&&(console.info(`network ${o?"connected":"disconnected"}`),c.current=o)},[o]),M.useEffect(()=>(window.addEventListener("beforeunload",l),()=>window.removeEventListener("beforeunload",l)),[l]),L.createElement(Hee.Provider,{value:s},!t&&L.createElement(Q5e,null),s.voice&&L.createElement(yNe,null),e)}const bNe={size:50,allowSleep:!1,gravity:[0,-9.8,0],defaultContactMaterial:{friction:0}};function BNe(n){const{children:e,...t}=n;return L.createElement(Z3e,pt({},bNe,t),L.createElement(M.Suspense,{fallback:null},e))}function GNe(n){const{children:e,environmentProps:t,physicsProps:i,networkProps:r,playerProps:s,toolbeltProps:o,disableGround:a=!1}=n;return L.createElement(LTe,t,L.createElement(BNe,i,L.createElement(a5e,s,L.createElement(M5e,o,L.createElement(vNe,r,L.createElement(X5e,null,!a&&L.createElement(KVe,null),e))))))}Un.div`
  position: absolute;
  display: flex;
  flex-direction: column;
  z-index: 10;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  padding: 25px 25px 30px;
  box-sizing: border-box;
  background: black;
  width: 90vw;
`;Un.div`
  position: absolute;
  z-index: 9;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  background: black;
  opacity: 0.6;
`;Un.img`
  width: 100%;
  height: auto;
  object-fit: contain;
`;Un.p`
  color: white;
  text-align: center;
  font-size: 1.15rem;
`;Un.button`
  background: white;
  border: none;
  color: black;
  padding: 10px 20px;
  font-size: 1rem;
  font-family: inherit;
  border-radius: 10px;
  font-weight: bold;
  margin: 0 auto;
`;function wNe(){return L.createElement("group",{name:"lost-world"},L.createElement(YVe,{color:"white",near:.1,far:15}),L.createElement("directionalLight",{"position-y":1,intensity:1.8}),L.createElement("ambientLight",{intensity:1}),L.createElement(XVe,{color:"white"}),L.createElement(c5e,null))}function xNe(){return We("div",{children:We(GNe,{children:We(wNe,{})})})}function SNe(){return We(O0,{children:We("div",{children:We($Se,{children:cn(qSe,{children:[We(IK,{exact:!0,path:"/",component:rRe}),We(IK,{path:"/vrshow",component:xNe})]})})})})}QM.createRoot(document.getElementById("root")).render(We(L.StrictMode,{children:We(Tve,{children:We(SNe,{})})}));
